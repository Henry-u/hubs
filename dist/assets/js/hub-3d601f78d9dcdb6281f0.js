(function(){var __webpack_modules__={37554:function(){AFRAME.registerComponent("action-to-event",{multiple:!0,schema:{path:{type:"string"},event:{type:"string"},withPermission:{type:"string"}},init(){this.needsPermission=!!this.data.withPermission,this.updatePermissions=()=>{this.needsPermission&&window.APP.hubChannel&&(this.hasPermission=window.APP.hubChannel.canOrWillIfCreator(this.data.withPermission))}},play(){this.el.sceneEl.systems.permissions.onPermissionsUpdated(this.updatePermissions),this.updatePermissions()},pause(){window.APP.hubChannel.removeEventListener("permissions_updated",this.updatePermissions)},tick(){this.needsPermission&&!this.hasPermission||AFRAME.scenes[0].systems.userinput.get(this.data.path)&&this.el.emit(this.data.event)}})},89795:function(){AFRAME.registerComponent("action-to-remove",{multiple:!0,schema:{path:{type:"string"},requireOwnership:{type:"boolean",default:!0}},init(){NAF.utils.getNetworkedEntity(this.el).then((e=>{this.networkedEl=e}))},tick(){AFRAME.scenes[0].systems.userinput.get(this.data.path)&&(this.data.requireOwnership&&this.networkedEl&&!NAF.utils.isMine(this.networkedEl)||this.el.parentNode.removeChild(this.el))}})},798:function(e,t,n){var i=n(99477);AFRAME.registerComponent("ambient-light",{schema:{color:{type:"color"},intensity:{default:1}},init(){this.light=new i.AmbientLight,this.el.setObject3D("ambient-light",this.light)},update(e){this.data.color!==e.color&&(this.light.color.set(this.data.color),this.light.color.convertSRGBToLinear()),this.data.intensity!==e.intensity&&(this.light.intensity=this.data.intensity)},remove:function(){this.el.removeObject3D("ambient-light")}})},24649:function(e,t,n){var i=n(99477),r=n(76030).Z,o=AFRAME.components,s=AFRAME.registerComponent,a=AFRAME.utils;delete AFRAME.components.animation;var l=new i.Color,c=new i.Color,d={};function u(e,t){return d[t=t||"."]||(d[t]={}),-1!==e.indexOf(t)?d[t][e]=e.split(t):d[t][e]=e,d[t][e]}const h=function(e,t,n){var i;return n=n||".",-1!==t.indexOf(n)?(i=u(t,n)).constructor===String?e.getAttribute(i):e.getAttribute(i[0])[i[1]]:e.getAttribute(t)},p=function(e,t,n,i){var r;i=i||".",-1===t.indexOf(i)?e.setAttribute(t,n):(r=u(t,i)).constructor===String?e.setAttribute(r,n):e.setAttribute(r[0],r[1],n)};var m={},f="color",g="rotation",v="scale",b="components";function y(e){e.x=i.MathUtils.degToRad(e.x),e.y=i.MathUtils.degToRad(e.y),e.z=i.MathUtils.degToRad(e.z)}function w(e,t,n){var i;for(i=0;i<t.length;i++)e.addEventListener(t[i],n)}function _(e,t,n){var i;for(i=0;i<t.length;i++)e.removeEventListener(t[i],n)}function E(e,t){var n,i,r;for(i=S(t),r=e,n=0;n<i.length;n++)r=r[i[n]];return r}function A(e,t,n,r){var o,s,a,l;for(t.startsWith("object3D.rotation")&&(n=i.MathUtils.degToRad(n)),s=S(t),l=e,o=0;o<s.length-1;o++)l=l[s[o]];a=s[s.length-1],r!==f?l[a]=n:"r"in l[a]?(l[a].r=n.r,l[a].g=n.g,l[a].b=n.b):(l[a].x=n.r,l[a].y=n.g,l[a].z=n.b)}function S(e){return e in m||(m[e]=e.split(".")),m[e]}function x(e){return e.isRawProperty||e.property.startsWith(b)||e.property.startsWith("object3D")}s("animation",{schema:{autoplay:{default:!0},delay:{default:0},dir:{default:""},dur:{default:1e3},easing:{default:"easeInQuad"},elasticity:{default:400},enabled:{default:!0},from:{default:""},loop:{default:0,parse:function(e){return!0===e||"true"===e||!1!==e&&"false"!==e&&parseInt(e,10)}},property:{default:""},startEvents:{type:"array"},pauseEvents:{type:"array"},resumeEvents:{type:"array"},round:{default:!1},to:{default:""},type:{default:""},isRawProperty:{default:!1}},multiple:!0,init:function(){var e=this;this.eventDetail={name:this.attrName},this.time=0,this.animation=null,this.animationIsPlaying=!1,this.onStartEvent=this.onStartEvent.bind(this),this.beginAnimation=this.beginAnimation.bind(this),this.pauseAnimation=this.pauseAnimation.bind(this),this.resumeAnimation=this.resumeAnimation.bind(this),this.fromColor={},this.toColor={},this.targets={},this.targetsArray=[],this.updateConfigForDefault=this.updateConfigForDefault.bind(this),this.updateConfigForRawColor=this.updateConfigForRawColor.bind(this),this.config={complete:function(){e.animationIsPlaying=!1,e.el.emit("animationcomplete",e.eventDetail,!1),e.id&&e.el.emit("animationcomplete__"+e.id,e.eventDetail,!1)}}},update:function(e){var t=this.config,n=this.data;this.animationIsPlaying=!1,this.data.enabled&&n.property&&(t.autoplay=!1,t.direction=n.dir,t.duration=n.dur,t.easing=n.easing,t.elasticity=n.elasticity,t.loop=n.loop,t.round=n.round,this.createAndStartAnimation())},tick:function(e,t){this.animationIsPlaying&&(this.time+=t,this.animation.tick(this.time))},remove:function(){this.pauseAnimation(),this.removeEventListeners(),this.cancelDelayedStart()},pause:function(){this.paused=!0,this.pausedWasPlaying=this.animationIsPlaying,this.pauseAnimation(),this.removeEventListeners(),this.cancelDelayedStart()},play:function(){this.paused&&(this.paused=!1,this.addEventListeners(),this.pausedWasPlaying&&(this.resumeAnimation(),this.pausedWasPlaying=!1))},createAndStartAnimation:function(){var e=this.data;this.updateConfig(),this.animationIsPlaying=!1,this.animation=r(this.config),this.removeEventListeners(),this.cancelDelayedStart(),this.addEventListeners(),!e.autoplay||e.startEvents&&e.startEvents.length||(e.delay?this.delayTimeout=setTimeout(this.beginAnimation,e.delay):this.beginAnimation())},beginAnimation:function(){this.updateConfig(),this.time=0,this.animationIsPlaying=!0,this.stopRelatedAnimations(),this.el.emit("animationbegin",this.eventDetail,!1)},pauseAnimation:function(){this.animationIsPlaying=!1},resumeAnimation:function(){this.animationIsPlaying=!0},onStartEvent:function(){this.data.enabled&&(this.updateConfig(),this.animation&&this.animation.pause(),this.animation=r(this.config),this.data.delay?setTimeout(this.beginAnimation,this.data.delay):this.beginAnimation())},updateConfigForRawColor:function(){var e,t,n,i=this.config,r=this.data,o=this.el;if(!this.waitComponentInitRawProperty(this.updateConfigForRawColor)){for(t in e=""===r.from?E(o,r.property):r.from,n=r.to,this.setColorConfig(e,n),e=this.fromColor,n=this.toColor,this.targetsArray.length=0,this.targetsArray.push(e),i.targets=this.targetsArray,n)i[t]=n[t];var s;i.update=(s={},function(e){var t;(t=e.animatables[0].target).r===s.r&&t.g===s.g&&t.b===s.b||A(o,r.property,t,r.type)})}},updateConfigForDefault:function(){var e,t,n,i,r=this.config,o=this.data,s=this.el;this.waitComponentInitRawProperty(this.updateConfigForDefault)||(e=""===o.from?x(o)?E(s,o.property):h(s,o.property):o.from,n=o.to,isNaN(e||n)?(e=e?e.toString():e,n=n?n.toString():n):(e=parseFloat(e),n=parseFloat(n)),(t="true"===o.to||"false"===o.to||!0===o.to||!1===o.to)&&(e="true"===o.from||!0===o.from?1:0,n="true"===o.to||!0===o.to?1:0),this.targets.aframeProperty=e,r.targets=this.targets,r.aframeProperty=n,r.update=function(e){var n;(n=e.animatables[0].target.aframeProperty)!==i&&(i=n,t&&(n=n>=1),x(o)?A(s,o.property,n,o.type):p(s,o.property,n))})},updateConfigForVector:function(){var e,t,n,i,r=this.config,o=this.data,s=this.el;for(e in t=""!==o.from?a.coordinates.parse(o.from):h(s,o.property),n=a.coordinates.parse(o.to),o.property===g&&(y(t),y(n)),this.targetsArray.length=0,this.targetsArray.push(t),r.targets=this.targetsArray,n)r[e]=n[e];"position"!==o.property&&o.property!==g&&o.property!==v?r.update=function(){var e={};return function(t){var n=t.animations[0].target;n.x===e.x&&n.y===e.y&&n.z===e.z||(e.x=n.x,e.y=n.y,e.z=n.z,p(s,o.property,n))}}():r.update=(i={},function(e){var t=e.animatables[0].target;o.property===v&&(t.x=Math.max(1e-4,t.x),t.y=Math.max(1e-4,t.y),t.z=Math.max(1e-4,t.z)),t.x===i.x&&t.y===i.y&&t.z===i.z||(i.x=t.x,i.y=t.y,i.z=t.z,s.object3D[o.property].set(t.x,t.y,t.z),s.object3D.matrixNeedsUpdate=!0)})},updateConfig:function(){var e,t,n,i,r,s,a;t=this.el,n=this.data.property,r=(s=n.split("."))[0],a=s[1],e=(i=t.components[r]||o[r])?a&&!i.schema[a]?null:a?i.schema[a].type:i.schema.type:null,x(this.data)&&this.data.type===f?this.updateConfigForRawColor():"vec2"===e||"vec3"===e||"vec4"===e?this.updateConfigForVector():this.updateConfigForDefault()},waitComponentInitRawProperty:function(e){var t,n=this.data,i=this.el,o=this;return""===n.from&&!!n.property.startsWith(b)&&(t=S(n.property)[1],!i.components[t]&&(i.addEventListener("componentinitialized",(function n(s){s.detail.name===t&&(e(),o.animation=r(o.config),i.removeEventListener("componentinitialized",n))})),!0))},stopRelatedAnimations:function(){var e,t;for(t in this.el.components)e=this.el.components[t],t!==this.attrName&&"animation"===e.name&&e.animationIsPlaying&&e.data.property===this.data.property&&(e.animationIsPlaying=!1)},addEventListeners:function(){var e=this.data,t=this.el;w(t,e.startEvents,this.onStartEvent),w(t,e.pauseEvents,this.pauseAnimation),w(t,e.resumeEvents,this.resumeAnimation)},removeEventListeners:function(){var e=this.data,t=this.el;_(t,e.startEvents,this.onStartEvent),_(t,e.pauseEvents,this.pauseAnimation),_(t,e.resumeEvents,this.resumeAnimation)},cancelDelayedStart:function(){this.delayTimeout&&(clearTimeout(this.delayTimeout),this.delayTimeout=null)},setColorConfig:function(e,t){l.set(e),c.set(t),e=this.fromColor,t=this.toColor,e.r=l.r,e.g=l.g,e.b=l.b,t.r=c.r,t.g=c.g,t.b=c.b}})},71010:function(e,t,n){var i=n(99477);const r=302836,o=new i.MeshBasicMaterial({color:r,transparent:!0,opacity:.25,side:i.DoubleSide});AFRAME.registerComponent("audio-zone",{schema:{enabled:{default:!0},inOut:{default:!0},outIn:{default:!0},debuggable:{default:!0}},init(){var e,t;const n=new i.BoxGeometry;this.debugMesh=new i.Mesh(n,o),this.debugMesh.el=this.el.object3D.el;const s=new i.BoxHelper(this.debugMesh,r);this.el.object3D.add(s),this.el.object3D.updateMatrixWorld(!0),null===(e=this.el.sceneEl.systems["audio-debug"])||void 0===e||e.registerZone(this),null===(t=this.el.sceneEl.systems["hubs-systems"])||void 0===t||t.audioZonesSystem.registerZone(this),this.enableDebug(window.APP.store.state.preferences.showAudioDebugPanel)},remove(){var e,t;null===(e=this.el.sceneEl.systems["audio-debug"])||void 0===e||e.unregisterZone(this),null===(t=this.el.sceneEl.systems["hubs-systems"])||void 0===t||t.audioZonesSystem.unregisterZone(this)},update(){this.enableDebug(this.data.debuggable&&window.APP.store.state.preferences.showAudioDebugPanel)},isEnabled(){return this.data.enabled},getBoundingBox:function(){const e=new i.Box3;return function(){return e.copy(this.debugMesh.geometry.boundingBox).applyMatrix4(this.el.object3D.matrixWorld)}}(),enableDebug(e){this.data.debuggable=e,this.el.object3D.visible=e},getAudioParams(){return APP.audioOverrides.get(this.el)},contains(e){return this.getBoundingBox().containsPoint(e)}})},860:function(e,t,n){var i=n(99477);AFRAME.registerComponent("avatar-inspect-collider",{play(){this.el.setObject3D("avatar-inspect-collider",new i.Mesh(new i.BoxGeometry(.3,.8,.3),new i.MeshBasicMaterial({visible:!1})))}})},53738:function(){AFRAME.registerComponent("block-button",{init(){this.onClick=()=>{this.block(this.owner)},NAF.utils.getNetworkedEntity(this.el).then((e=>{this.owner=e.components.networked.data.owner}))},play(){this.el.object3D.addEventListener("interact",this.onClick)},pause(){this.el.object3D.removeEventListener("interact",this.onClick)},block(e){window.APP.hubChannel.hide(e)}})},80040:function(){AFRAME.registerComponent("bone-mute-state-indicator",{schema:{unmutedBoneName:{default:"Watch_Joint_MicON"},mutedBoneName:{default:"Watch_Joint_Muted"},onPos:{default:.81},offPos:{default:.5}},init(){this.onStateToggled=this.onStateToggled.bind(this),this.el.addEventListener("model-loaded",(()=>{this.unmutedBone=this.el.object3D.getObjectByName(this.data.unmutedBoneName),this.mutedBone=this.el.object3D.getObjectByName(this.data.mutedBoneName),this.modelLoaded=!0,this.updateMuteState()})),this.onMicStateChanged=()=>{this.updateMuteState()}},play(){APP.dialog.on("mic-state-changed",this.onMicStateChanged)},pause(){APP.dialog.off("mic-state-changed",this.onMicStateChanged)},updateMuteState(){if(!this.modelLoaded)return;const e=!APP.mediaDevicesManager.isMicEnabled;this.mutedBone.position.y=e?this.data.onPos:this.data.offPos,this.unmutedBone.position.y=e?this.data.offPos:this.data.onPos,this.mutedBone.matrixNeedsUpdate=!0,this.unmutedBone.matrixNeedsUpdate=!0}})},23601:function(){AFRAME.registerComponent("close-vr-notice-button",{init(){this.onClick=()=>{this.el.sceneEl.emit("action_vr_notice_closed")}},play(){this.el.object3D.addEventListener("interact",this.onClick)},pause(){this.el.object3D.removeEventListener("interact",this.onClick)}})},90903:function(){AFRAME.registerComponent("css-class",{schema:{type:"string"},multiple:!0,init(){this.el.classList.add(this.data)},update(e){this.data!==e&&(this.el.classList.remove(e),this.el.classList.add(this.data))},remove(){this.el.classList.remove(this.data)}})},17875:function(){AFRAME.registerComponent("log-events",{init:function(){const e=this.el,t=this.log.bind(this),n=this.el.dispatchEvent;this.el.dispatchEvent=function(){return t(Array.from(arguments)),n.apply(e,arguments)}},log:function(e){let[t]=e;if(["componentchanged"].includes(t.type))return;let n=!0;console.info(`log-events: ${this.el.id} ${t.type} ${JSON.stringify(t.detail,((e,t)=>t&&"object"==typeof t&&void 0===t.length?n?(n=!1,t):"[object]":t))}`)}}),AFRAME.registerComponent("lifecycle-checker",{schema:{name:{type:"string"},tick:{default:!1}},init:function(){this.log("init")},update:function(){this.log("update")},tick:function(){this.data.tick&&this.log("tick")},remove:function(){this.log("remove")},pause:function(){this.log("pause")},play:function(){this.log("play")},log:function(e){console.info(`lifecycle-checker:${this.data.name} ${e}`)}})},19304:function(e,t,n){var i=n(99477);AFRAME.registerComponent("directional-light",{schema:{color:{type:"color"},intensity:{default:1},castShadow:{default:!0},shadowMapResolution:{default:[512,512]},shadowBias:{default:0},shadowRadius:{default:1}},init(){this.light=new i.DirectionalLight,this.light.position.set(0,0,0),this.light.target.position.set(0,0,1),this.light.add(this.light.target),this.el.setObject3D("directional-light",this.light)},update(e){const t=this.light;if(this.data.color!==e.color){const e=new i.Color(this.data.color);e.convertSRGBToLinear(),t.color.copy(e)}this.data.intensity!==e.intensity&&(t.intensity=this.data.intensity),this.data.castShadow!==e.castShadow&&(t.castShadow=this.data.castShadow),this.data.shadowBias!==e.shadowBias&&(t.shadow.bias=this.data.shadowBias),this.data.shadowRadius!==e.shadowRadius&&(t.shadow.radius=this.data.shadowRadius);const[n,r]=this.data.shadowMapResolution,[o,s]=e.shadowMapResolution?e.shadowMapResolution:[512,512];n===o&&r===s||(t.shadow.mapSize.set(n,r),t.shadow.map&&(t.shadow.map.dispose(),t.shadow.map=null)),this.light.shadow.camera.matrixNeedsUpdate=!0},remove:function(){this.el.removeObject3D("directional-light")}})},62399:function(){AFRAME.registerComponent("disable-frustum-culling",{init(){this.el.object3D.traverse((e=>e.frustumCulled=!1))}})},71087:function(){AFRAME.registerComponent("duck",{schema:{initialForce:{default:0},maxForce:{default:6.5},maxScale:{default:5}},init:function(){this.initialScale=this.el.object3D.scale.x,this.maxScale=this.data.maxScale*this.initialScale,NAF.utils.getNetworkedEntity(this.el).then((e=>{this.networkedEntity=e,this.initialScale=this.networkedEntity.object3D.scale.x,this.maxScale=this.data.maxScale*this.initialScale}))},tick:function(){if(!this.networkedEntity||NAF.utils.isMine(this.networkedEntity)){const e=this.networkedEntity||this.el,t=e.object3D.scale.x,n=Math.min(1,(t-this.initialScale)/(this.maxScale-this.initialScale))*this.data.maxForce;if(n>0){const t=Math.random()*Math.PI*2,i=Math.cos(t),r=Math.sin(t);e.setAttribute("body-helper",{gravity:{x:i,y:n,z:r}})}}}})},1248:function(){AFRAME.registerComponent("emit-scene-event-on-remove",{schema:{event:{default:null}},remove(){this.data.event&&this.el.sceneEl.emit(this.data.event,{el:this.el})}})},1200:function(){AFRAME.registerComponent("emit-state-change",{multiple:!0,schema:{state:{type:"string"},transform:{type:"string",oneof:["rising","falling"]},event:{type:"string"}},init(){this.stateadded=this.stateadded.bind(this),this.stateremoved=this.stateremoved.bind(this)},stateadded(e){e.detail===this.data.state&&this.el.emit(this.data.event)},stateremoved(e){e.detail===this.data.state&&this.el.emit(this.data.event)},update(){this.el.removeEventListener("stateadded",this.stateadded),this.el.removeEventListener("stateremoved",this.stateremoved),"rising"===this.data.transform&&this.el.addEventListener("stateadded",this.stateadded),"falling"===this.data.transform&&this.el.addEventListener("stateremoved",this.stateremoved)}})},24842:function(){AFRAME.registerComponent("event-repeater",{schema:{eventSource:{type:"selector"},events:{type:"array"}},play:function(){this.data.eventListeners=[];const e=this.data.events;for(let t=0;t<e.length;t++){const n=e[t];this.data.eventListeners[n]=this._handleEvent.bind(this,n),this.data.eventSource.addEventListener(n,this.data.eventListeners[n])}},pause:function(){const e=this.data.events;for(let t=0;t<e.length;t++){const n=e[t];this.data.eventSource.removeEventListener(n,this.data.eventListeners[n])}this.data.eventListeners=[]},_handleEvent:function(e,t){this.el.emit(e,t.detail)}})},35053:function(e,t,n){var i=n(99477);function r(e,t,n,i,r,o,s){try{var a=e[o](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(i,r)}AFRAME.registerComponent("fader",{schema:{direction:{type:"string",default:"none"}},init(){const e=new i.Mesh(new i.BoxGeometry,new i.MeshBasicMaterial({color:0,side:i.BackSide,opacity:0,transparent:!0,fog:!1}));e.scale.x=e.scale.y=1,e.scale.z=.15,e.matrixNeedsUpdate=!0,this.el.object3DMap.camera.add(e),this.mesh=e},fadeOut(){return this.beginTransition("out")},fadeIn(){return this.beginTransition("in")},beginTransition(e){var t,n=this;return(t=function*(){if(n._resolveFinish)throw new Error("Cannot fade while a fade is happening.");return n.el.setAttribute("fader",{direction:e}),new Promise((t=>{n.mesh.material.opacity===("in"==e?0:1)?t():n._resolveFinish=t}))},function(){var e=this,n=arguments;return new Promise((function(i,o){var s=t.apply(e,n);function a(e){r(s,i,o,a,l,"next",e)}function l(e){r(s,i,o,a,l,"throw",e)}a(void 0)}))})()},tick(e,t){const n=this.mesh.material;this.mesh.visible="out"===this.data.direction||0!==n.opacity,this.mesh.visible&&("in"===this.data.direction?n.opacity=Math.max(0,n.opacity-1/750*Math.min(t,50)):"out"===this.data.direction&&(n.opacity=Math.min(1,n.opacity+1/750*Math.min(t,50))),0!==n.opacity&&1!==n.opacity||("none"!==this.data.direction&&this._resolveFinish&&(this._resolveFinish(),this._resolveFinish=null),this.el.setAttribute("fader",{direction:"none"})))}})},71885:function(e,t,n){var i=n(99477);AFRAME.registerComponent("follow-in-fov",{schema:{target:{type:"selector"},offset:{type:"vec3"},speed:{type:"number",default:.003},angle:{type:"number",default:45}},init(){this.targetPos=new i.Vector3,this.offset=new i.Vector3,this.offset.copy(this.data.offset),this.snappedRot=new i.Euler,this.snappedQ=new i.Quaternion,this.snappedXForm=new i.Matrix4,this.snappedXFormWorld=new i.Matrix4,this.tempVector=new i.Vector3},tick(e,t){if(!this.el.object3D.visible)return;if(!this.data.target)return;const n=this.el.object3D,r=this.data.target.object3D;let o=!1;const s=AFRAME.scenes[0].systems.interaction,a=s.state.rightRemote.hovered||s.state.leftRemote.hovered;if(a){let e=a;for(;e;){if(this.el===e){o=!0;break}e=e.parentNode}}if(o?this._hoveredFrames+=1:this._hoveredFrames=0,this._applyMaskedTargetRotation(-this.data.angle*i.MathUtils.DEG2RAD,r.rotation.y,0,this.snappedXFormWorld),this.targetPos.copy(this.offset),this.targetPos.applyMatrix4(this.snappedXFormWorld),n.parent&&n.parent.worldToLocal(this.targetPos),this.started){const e=(this._hoveredFrames?this.data.speed*(1/(.2*(this._hoveredFrames+5))):this.data.speed)*t;n.position.set(n.position.x+(this.targetPos.x-n.position.x)*e,n.position.y+(this.targetPos.y-n.position.y)*e,n.position.z+(this.targetPos.z-n.position.z)*e)}else n.position.copy(this.targetPos),this.started=!0;this.snappedXFormWorld.decompose(this.tempVector,n.quaternion,this.tempVector),n.matrixNeedsUpdate=!0},reset(){this.started=!1},_applyMaskedTargetRotation(e,t,n,i){const r=this.data.target.object3D;this.snappedRot.set(e,t,n,r.rotation.order),this.snappedQ.setFromEuler(this.snappedRot),this.snappedXForm.compose(r.position,this.snappedQ,r.scale),i.multiplyMatrices(r.parent.matrixWorld,this.snappedXForm)}})},88667:function(e,t,n){var i=n(99477);AFRAME.registerComponent("frustrum",{schema:{culled:{type:"boolean",default:!0}},update:function(){this.updateDescendants(this.data.culled)},remove:function(){this.updateDescendants(!0)},updateDescendants:function(e){this.el.object3D.traverse((function(t){t instanceof i.Mesh&&(t.frustumCulled=e)}))}})},92179:function(){AFRAME.registerComponent("heightfield",{init(){this.el.addEventListener("componentinitialized",(e=>{"static-body"===e.detail.name&&this.generateAndAddHeightfield(this.el.components["static-body"])})),this.el.setAttribute("static-body",{shape:"none",mass:0})},generateAndAddHeightfield(e){const{offset:t,distance:n,data:i}=this.data,r=new CANNON.Quaternion;r.setFromAxisAngle(new CANNON.Vec3(1,0,0),-Math.PI/2);const o=new CANNON.Quaternion;o.setFromAxisAngle(new CANNON.Vec3(0,1,0),-Math.PI/2),o.mult(r,r);const s=new CANNON.Vec3(t.x,t.y,t.z),a=new CANNON.Heightfield(i,{elementSize:n});e.addShape(a,s,r)}})},57886:function(e,t,n){var i=n(99477);AFRAME.registerComponent("hemisphere-light",{schema:{skyColor:{type:"color"},groundColor:{type:"color"},intensity:{default:1}},init(){this.light=new i.HemisphereLight,this.light.position.set(0,0,0),this.light.matrixNeedsUpdate=!0,this.el.setObject3D("hemisphere-light",this.light)},update(e){this.data.skyColor!==e.skyColor&&this.light.color.set(this.data.skyColor),this.data.groundColor!==e.groundColor&&this.light.groundColor.set(this.data.groundColor),this.data.intensity!==e.intensity&&(this.light.intensity=this.data.intensity)},remove:function(){this.el.removeObject3D("hemisphere-light")}})},93289:function(){AFRAME.registerComponent("hide-when-pinned-and-forbidden",{schema:{whenPinned:{type:"boolean"}},init(){this._updateUI=this._updateUI.bind(this),this._updateUIOnStateChange=this._updateUIOnStateChange.bind(this),this.el.sceneEl.addEventListener("stateadded",this._updateUIOnStateChange),this.el.sceneEl.addEventListener("stateremoved",this._updateUIOnStateChange),NAF.utils.getNetworkedEntity(this.el).then((e=>{this.targetEl=e,this._updateUI(),this.targetEl.addEventListener("pinned",this._updateUI),this.targetEl.addEventListener("unpinned",this._updateUI)}))},remove(){this.el.sceneEl.removeEventListener("stateadded",this._updateUIOnStateChange),this.el.sceneEl.removeEventListener("stateremoved",this._updateUIOnStateChange),this.targetEl&&(this.targetEl.removeEventListener("pinned",this._updateUI),this.targetEl.removeEventListener("unpinned",this._updateUI))},_updateUIOnStateChange(e){"frozen"===e.detail&&this._updateUI()},_updateUI(){if(!this.targetEl)return;const e=this.targetEl.components.pinnable&&this.targetEl.components.pinnable.data.pinned;if(this.data.whenPinned)this.el.object3D.visible=!e;else{const t=e&&!window.APP.hubChannel.canOrWillIfCreator("pin_objects");this.el.object3D.visible=!t}}})},89684:function(){AFRAME.registerComponent("hide-when-quality",{schema:{type:"string",default:"low"},update(e){this.data!==e&&this.updateComponentState(window.APP.store.state.preferences.materialQualitySetting)},updateComponentState(e){this.el.setAttribute("visible",e!==this.data)}})},83830:function(){function e(e,t,n,i,r,o,s){try{var a=e[o](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(i,r)}AFRAME.registerComponent("hover-menu",{multiple:!0,schema:{template:{type:"selector"},isFlat:{default:!0},dim:{default:!0},withPermission:{type:"string"}},init(){var t,n=this;return(t=function*(){n.onFrozenStateChange=n.onFrozenStateChange.bind(n),n.hovering=!1,yield n.getHoverMenu(),n.applyHoverState()},function(){var n=this,i=arguments;return new Promise((function(r,o){var s=t.apply(n,i);function a(t){e(s,r,o,a,l,"next",t)}function l(t){e(s,r,o,a,l,"throw",t)}a(void 0)}))})()},getHoverMenu(){return this.menuPromise?this.menuPromise:this.menuPromise=new Promise((e=>{const t=this.el.appendChild(document.importNode(this.data.template.content,!0).children[0]);setTimeout((()=>{if(this.menu=t,"media-mirror-target"!==this.el.parentEl.id)this.el.setAttribute("position-at-border",{target:".hover-container",isFlat:this.data.isFlat,animate:!1,scale:!1});else{const e=this.el.querySelector(".hover-container");e.object3D.position.z=.001,e.object3D.matrixNeedsUpdate=!0}e(this.menu)}))}))},onFrozenStateChange(e){"frozen"!==!e.detail&&this.applyHoverState()},applyHoverState(){if(!this.menu)return;const e=!this.data.withPermission||window.APP.hubChannel.canOrWillIfCreator(this.data.withPermission);this.menu.object3D.visible=e&&!this.el.sceneEl.is("frozen")&&this.hovering,this.data.dim&&this.el.object3DMap.mesh&&this.el.object3DMap.mesh.material&&this.el.object3DMap.mesh.material.color.setScalar(this.menu.object3D.visible?.5:1)},play(){this.el.sceneEl.addEventListener("stateadded",this.onFrozenStateChange),this.el.sceneEl.addEventListener("stateremoved",this.onFrozenStateChange)},pause(){this.el.sceneEl.removeEventListener("stateadded",this.onFrozenStateChange),this.el.sceneEl.removeEventListener("stateremoved",this.onFrozenStateChange)}})},78363:function(){AFRAME.registerComponent("icon-button",{schema:{image:{type:"string"},hoverImage:{type:"string"},activeImage:{type:"string"},activeHoverImage:{type:"string"},disabledImage:{type:"string"},active:{type:"boolean"},disabled:{type:"boolean"},tooltip:{type:"selector"},tooltipText:{type:"string"},activeTooltipText:{type:"string"}},init(){this.el.object3D.matrixNeedsUpdate=!0,this.onHover=()=>{this.hovering=!0,this.data.tooltip&&(this.data.tooltip.object3D.visible=!0),this.updateButtonState()},this.onHoverOut=()=>{this.hovering=!1,this.data.tooltip&&(this.data.tooltip.object3D.visible=!1),this.updateButtonState()}},play(){this.updateButtonState(),this.el.object3D.addEventListener("hovered",this.onHover),this.el.object3D.addEventListener("unhovered",this.onHoverOut)},pause(){this.el.object3D.removeEventListener("hovered",this.onHover),this.el.object3D.removeEventListener("unhovered",this.onHoverOut)},update(){this.updateButtonState()},updateButtonState(){const e=this.hovering,t=this.data.active,n=this.data.disabled;let i;if(i=n?"disabledImage":t?e?"activeHoverImage":"activeImage":e?"hoverImage":"image",this.el.components.sprite?this.data[i]?this.el.setAttribute("sprite","name",this.data[i]):console.warn(`No ${i} image on me.`,this):console.error("No sprite."),this.data.tooltip&&e){const e=(this.data.active?this.data.activeTooltipText:this.data.tooltipText)+(n?" Disabled":"");this.data.tooltip.querySelector("[text]").setAttribute("text","value",e)}}})},69318:function(){AFRAME.registerComponent("inject-main-camera-here",{init(){this.el.setObject3D("camera",this.el.sceneEl.camera)}})},60070:function(){AFRAME.registerComponent("inspect-button",{tick(){this.initializedInTick||(this.initializedInTick=!0,this.el.object3D.addEventListener("holdable-button-down",(()=>{this.el.sceneEl.systems["hubs-systems"].cameraSystem.inspect(this.el,1.5)})),this.el.object3D.addEventListener("holdable-button-up",(()=>{this.el.sceneEl.systems["hubs-systems"].cameraSystem.uninspect()})))}})},53287:function(){AFRAME.registerComponent("inspect-pivot-child-selector",{schema:{selector:{type:"string"}}})},56994:function(){function e(e,t,n,i,r,o,s){try{var a=e[o](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(i,r)}AFRAME.registerComponent("kick-button",{init(){this.onClick=()=>{this.kick(this.owner)},NAF.utils.getNetworkedEntity(this.el).then((e=>{this.owner=e.components.networked.data.owner}))},play(){this.el.object3D.addEventListener("interact",this.onClick)},pause(){this.el.object3D.removeEventListener("interact",this.onClick)},kick(t){var n,i=this;return(n=function*(){i.el.sceneEl.emit("action_kick_client",{clientId:t})},function(){var t=this,i=arguments;return new Promise((function(r,o){var s=n.apply(t,i);function a(t){e(s,r,o,a,l,"next",t)}function l(t){e(s,r,o,a,l,"throw",t)}a(void 0)}))})()}})},92212:function(){AFRAME.registerComponent("leave-room-button",{init(){this.onClick=()=>{this.el.sceneEl.emit("leave_room_requested")}},play(){this.el.object3D.addEventListener("interact",this.onClick)},pause(){this.el.object3D.removeEventListener("interact",this.onClick)}})},29055:function(){function e(e,t,n,i,r,o,s){try{var a=e[o](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(i,r)}AFRAME.registerComponent("mute-button",{init(){this.onClick=()=>{this.mute(this.owner)},NAF.utils.getNetworkedEntity(this.el).then((e=>{this.owner=e.components.networked.data.owner}))},play(){this.el.object3D.addEventListener("interact",this.onClick)},pause(){this.el.object3D.removeEventListener("interact",this.onClick)},mute(t){var n,i=this;return(n=function*(){i.el.sceneEl.emit("action_mute_client",{clientId:t})},function(){var t=this,i=arguments;return new Promise((function(r,o){var s=n.apply(t,i);function a(t){e(s,r,o,a,l,"next",t)}function l(t){e(s,r,o,a,l,"throw",t)}a(void 0)}))})()}})},69369:function(){AFRAME.registerComponent("networked-avatar",{schema:{left_hand_pose:{default:0},right_hand_pose:{default:0}}})},94696:function(){AFRAME.registerComponent("networked-counter",{schema:{max:{default:3}},init(){this.timestamps=new Map,this.el.object3D.visible=!1},remove(){this.timestamps.clear()},count(){return this.timestamps.size},register(e){this.data.max<=0||this.timestamps.has(e)||(this.timestamps.set(e,performance.now()),this.timestamps.size>this.data.max&&this._destroyOldest())},deregister(e){this.timestamps.has(e)&&this.timestamps.delete(e)},_destroyOldest(){const e=this.el.sceneEl.systems.interaction;let t=null,n=Number.MAX_VALUE;this.timestamps.forEach(((i,r)=>{i<n&&!e.isHeld(r)&&NAF.utils.isMine(r)&&(t=r,n=i)})),this._destroy(t)},_destroy(e){e.pause(),this.deregister(e),e.parentNode&&e.parentNode.removeChild(e)}})},37176:function(){AFRAME.registerComponent("optional-alternative-to-not-hide",{})},20882:function(){AFRAME.registerComponent("owned-object-cleanup-timeout",{schema:{ttl:{default:0}},init(){this.timeout=performance.now()+1e3*this.data.ttl},tick(){this.el.components.networked&&NAF.utils.isMine(this.el)&&(this.el.sceneEl.systems.interaction.isHeld(this.el)?this.timeout=performance.now()+1e3*this.data.ttl:(!this.el.components.pinnable||!this.el.components.pinnable.data.pinned)&&performance.now()>=this.timeout&&this.el.parentNode.removeChild(this.el))}})},51274:function(){AFRAME.registerComponent("owned-object-limiter",{schema:{counter:{type:"selector"}},init(){this.counter=this.data.counter.components["networked-counter"]},tick(){this._syncCounterRegistration();const e=this.el.sceneEl.systems.interaction.isHeld(this.el);!e&&this.wasHeld&&this.counter.timestamps.has(this.el)&&this.counter.timestamps.set(this.el,performance.now()),this.wasHeld=e},remove(){this.counter.deregister(this.el)},_syncCounterRegistration(){if(!this.el.components.networked)return;const e=this.el.components.pinnable&&this.el.components.pinnable.data.pinned;NAF.utils.isMine(this.el)&&!e?this.counter.register(this.el):this.counter.deregister(this.el)}})},75743:function(){AFRAME.registerComponent("periodic-full-syncs",{init(){this.lastSync=0},tick(){const e=performance.now();e-this.lastSync>=5e3&&this.el.components&&this.el.components.networked&&(this.lastSync=e,this.el.components.networked.syncAll(null,!0))}})},28246:function(e,t,n){var i=n(99477);AFRAME.registerComponent("point-light",{schema:{color:{type:"color"},intensity:{default:1},range:{default:0},decay:{default:2},castShadow:{default:!0},shadowMapResolution:{default:[512,512]},shadowBias:{default:0},shadowRadius:{default:1}},init(){this.light=new i.PointLight,this.light.shadow.camera.matrixAutoUpdate=!0,this.el.setObject3D("point-light",this.light)},update(e){const t=this.light;if(this.data.color!==e.color){const e=new i.Color(this.data.color);e.convertSRGBToLinear(),t.color.copy(e)}this.data.intensity!==e.intensity&&(t.intensity=this.data.intensity),this.data.range!==e.range&&(t.distance=this.data.range),this.data.decay!==e.decay&&(t.decay=this.data.decay),this.data.castShadow!==e.castShadow&&(t.castShadow=this.data.castShadow),this.data.shadowBias!==e.shadowBias&&(t.shadow.bias=this.data.shadowBias),this.data.shadowRadius!==e.shadowRadius&&(t.shadow.radius=this.data.shadowRadius);const[n,r]=this.data.shadowMapResolution,[o,s]=e.shadowMapResolution?e.shadowMapResolution:[512,512];n===o&&r===s||(t.shadow.mapSize.set(n,r),t.shadow.map&&(t.shadow.map.dispose(),t.shadow.map=null))},remove:function(){this.el.removeObject3D("point-light")}})},96555:function(){AFRAME.registerComponent("replay",{init:function(){this.playhead=0,this.poseIndex=0},tick:function(e,t){let n=!1;for(;!n&&this.playhead>=this.poses[this.poseIndex].timestamp;)this.el.setAttribute("position",this.poses[this.poseIndex].position),this.el.setAttribute("rotation",this.poses[this.poseIndex].rotation),this.el.object3D.matrixNeedsUpdate=!0,this.poseIndex+=1,n=this.poseIndex===this.poses.length;this.playhead+=t,n&&(this.playhead=0,this.poseIndex=0)}})},69921:function(){AFRAME.registerComponent("set-yxz-order",{init:function(){this.el.object3D.rotation.order="YXZ"}})},66210:function(e,t,n){var i=n(99477);AFRAME.registerComponent("spot-light",{schema:{color:{type:"color"},intensity:{default:1},range:{default:0},decay:{default:2},innerConeAngle:{default:0},outerConeAngle:{default:Math.PI/4},castShadow:{default:!0},shadowMapResolution:{default:[512,512]},shadowBias:{default:0},shadowRadius:{default:1}},init(){this.light=new i.SpotLight,this.light.position.set(0,0,0),this.light.target.position.set(0,0,1),this.light.add(this.light.target),this.light.matrixNeedsUpdate=!0,this.light.target.matrixNeedsUpdate=!0,this.el.setObject3D("spot-light",this.light)},update(e){const t=this.light;this.data.color!==e.color&&t.color.set(this.data.color),this.data.intensity!==e.intensity&&(t.intensity=this.data.intensity),this.data.range!==e.range&&(t.distance=this.data.range),this.data.decay!==e.decay&&(t.decay=this.data.decay),this.data.innerConeAngle===e.innerConeAngle&&this.data.outerConeAngle===e.outerConeAngle||(t.angle=this.data.outerConeAngle,t.penumbra=1-this.data.innerConeAngle/this.data.outerConeAngle),this.data.castShadow!==e.castShadow&&(t.castShadow=this.data.castShadow),this.data.shadowBias!==e.shadowBias&&(t.shadow.bias=this.data.shadowBias),this.data.shadowRadius!==e.shadowRadius&&(t.shadow.radius=this.data.shadowRadius);const[n,i]=this.data.shadowMapResolution,[r,o]=e.shadowMapResolution?e.shadowMapResolution:[512,512];n===r&&i===o||(t.shadow.mapSize.set(n,i),t.shadow.map&&(t.shadow.map.dispose(),t.shadow.map=null))},remove:function(){this.el.removeObject3D("spot-light")}})},75287:function(){AFRAME.registerComponent("text-button",{schema:{textHoverColor:{type:"string"},textColor:{type:"string"},backgroundHoverColor:{type:"string"},backgroundColor:{type:"string"}},init(){this.el.object3D.matrixNeedsUpdate=!0,this.onHover=()=>{this.hovering=!0,this.updateButtonState()},this.onHoverOut=()=>{this.hovering=!1,this.updateButtonState()},this.textEl=this.el.querySelector("[text]"),this.el.getObject3D("mesh")?this.el.components.slice9.plane.material.toneMapped=!1:this.el.addEventListener("object3dset",(()=>{this.el.components.slice9.plane.material.toneMapped=!1}),{once:!0})},play(){this.updateButtonState(),this.el.object3D.addEventListener("hovered",this.onHover),this.el.object3D.addEventListener("unhovered",this.onHoverOut)},pause(){this.el.object3D.removeEventListener("hovered",this.onHover),this.el.object3D.removeEventListener("unhovered",this.onHoverOut)},update(){this.updateButtonState()},updateButtonState(){const e=this.hovering;this.el.setAttribute("slice9","color",e?this.data.backgroundHoverColor:this.data.backgroundColor),this.textEl&&this.textEl.setAttribute("text","color",e?this.data.textHoverColor:this.data.textColor)}});const e=function(){};AFRAME.registerComponent("text-raycast-hack",{dependencies:["text"],init(){this.el.getObject3D("text").raycast=e}})},56493:function(){AFRAME.registerComponent("drawing-manager",{schema:{penSpawner:{type:"selector"}},init(){this.el.object3D.visible=!1,this.drawingToPen=new Map,this.data.penSpawner.addEventListener("spawned-entity-created",(()=>{this.drawingEl||this.createDrawing()}))},createDrawing(){return this.createDrawingPromise||(this.createDrawingPromise=new Promise((e=>{this.drawingEl=document.createElement("a-entity"),this.drawingEl.setAttribute("networked","template: #interactable-drawing"),this.el.sceneEl.appendChild(this.drawingEl);const t=n=>{"networked-drawing"===n.detail.name&&(this.drawing=this.drawingEl.components["networked-drawing"],this.drawingEl.removeEventListener("componentinitialized",t),e())};this.drawingEl.addEventListener("componentinitialized",t)}))),this.createDrawingPromise},destroyDrawing(e){this.drawing===e&&(this.drawingToPen.delete(this.drawing),this.drawing=null,this.drawingEl=null,this.createDrawingPromise=null,this.getDrawingPromise=null)},getDrawing(e){return this.getDrawingPromise||(this.getDrawingPromise=new Promise(((t,n)=>{this.drawingEl?!this.drawing||this.drawingToPen.has(this.drawing)&&this.drawingToPen.get(this.drawing)!==e?n():(this.drawingToPen.set(this.drawing,e),t(this.drawing)):this.createDrawing().then((()=>{this.drawingToPen.set(this.drawing,e),t(this.drawing)}))}))),this.getDrawingPromise},returnDrawing(e){this.drawingToPen.has(this.drawing)&&this.drawingToPen.get(this.drawing)===e&&this.drawingToPen.delete(this.drawing)}})},91016:function(){AFRAME.registerComponent("track-pose",{schema:{path:{type:"string"}},play(){this.didRegister||(this.didRegister=!0,this.el.sceneEl.systems["hubs-systems"].cursorPoseTrackingSystem.register(this.el.object3D,this.data.path))},remove(){this.didRegister&&this.el.sceneEl.systems["hubs-systems"].cursorPoseTrackingSystem.unregister(this.el.object3D)}})},14208:function(e,t,n){var i=n(99477);const r=new i.Vector3,o=new i.Vector3,s=new i.Vector3;AFRAME.registerComponent("trigger-volume",{schema:{colliders:{type:"selectorAll"},size:{type:"vec3",default:{x:1,y:1,z:1}},target:{type:"selector"},enterComponent:{type:"string"},enterProperty:{type:"string"},enterValue:{default:"",parse:e=>"object"==typeof e?e:JSON.parse(e),stringify:JSON.stringify},leaveComponent:{type:"string"},leaveProperty:{type:"string"},leaveValue:{default:"",parse:e=>"object"==typeof e?e:JSON.parse(e),stringify:JSON.stringify}},init(){this.boundingBox=new i.Box3,this.collidingLastFrame={}},update(){this.el.object3D.getWorldPosition(o),r.copy(this.data.size),this.boundingBox.setFromCenterAndSize(o,r)},tick(){if(!this.data.target)return;const e=this.data.colliders;for(let t=0;t<e.length;t++){const n=e[t].object3D;n.getWorldPosition(s);const i=this.boundingBox.containsPoint(s),r=this.collidingLastFrame[n.id];i&&!r?this.data.target.setAttribute(this.data.enterComponent,this.data.enterProperty,this.data.enterValue):!i&&r&&this.data.target.setAttribute(this.data.leaveComponent,this.data.leaveProperty,this.data.leaveValue),this.collidingLastFrame[n.id]=i}}})},51337:function(){AFRAME.registerComponent("video-pause-state",{schema:{paused:{default:!1}},init(){this.onPauseStateChange=this.onPauseStateChange.bind(this),this.videoComponent=this.el.components["media-video"],this.videoComponent?this.onVideoLoaded():(this.onVideoLoaded=this.onVideoLoaded.bind(this),this.el.addEventListener("video-loaded",this.onVideoLoaded))},onVideoLoaded(){this.videoComponent=this.el.components["media-video"],this.video=this.videoComponent.video,this.video.addEventListener("pause",this.onPauseStateChange)},onPauseStateChange(){this.el.setAttribute("paused",this.video.paused)},update(){this.video&&this.data.paused!==this.video.paused&&this.videoComponent.togglePlaying()},remove(){this.video&&this.video.removeEventListener("pause",this.onPauseStateChange),this.el.removeEventListener("video-loaded",this.onVideoLoaded)}})},30010:function(){AFRAME.registerComponent("visibility-by-path",{schema:{path:{type:"string"}},tick(){const e=!!AFRAME.scenes[0].systems.userinput.get(this.data.path);this.el.object3D.visible!==e&&this.el.setAttribute("visible",e)}})},72336:function(){AFRAME.registerComponent("visibility-on-content-types",{schema:{contentTypes:{type:"string"},contentSubtype:{type:"string"},visible:{type:"boolean",default:!0}},init(){this.updateVisibility=this.updateVisibility.bind(this),NAF.utils.getNetworkedEntity(this.el).then((e=>{this.networkedEl=e,e.addEventListener("media_resolved",(e=>{let{detail:{contentType:t}}=e;return this.updateVisibility(t)})),this.updateVisibility()})).catch((()=>{}))},updateVisibility(e){const t=this.networkedEl.components["media-loader"],n=this.networkedEl.components["media-image"],i=this.networkedEl.components["media-video"],r=this.networkedEl.components["media-pdf"],o=e||i&&i.data.contentType||n&&n.data.contentType||r&&r.data.contentType;let s=!this.data.contentTypes;if(this.data.contentTypes&&o)for(const e of this.data.contentTypes.split(" ")){const t=o.toLowerCase().split(";")[0];if(t===e||e.endsWith("/")&&t.startsWith(e)){s=!0;break}}const a=!this.data.contentSubtype||t.data.contentSubtype&&t.data.contentSubtype===this.data.contentSubtype,l=!(!s||!a);this.el.object3D.visible=this.data.visible?l:!l}})},44874:function(){AFRAME.registerComponent("visible-if-permitted",{schema:{type:"string"},init(){this.updateVisibility=this.updateVisibility.bind(this),this.updateVisibility(),window.APP.hubChannel.addEventListener("permissions_updated",this.updateVisibility)},updateVisibility(){this.el.object3D.visible=this.el.sceneEl.systems.permissions.canOrWillIfCreator(this.data)},remove(){window.APP.hubChannel.removeEventListener("permissions_updated",this.updateVisibility)}})},90785:function(){AFRAME.registerComponent("visible-to-owner",{init(){this.onStateChange=e=>{this.el.setAttribute("visible",e.detail.newOwner===NAF.clientId)},NAF.utils.getNetworkedEntity(this.el).then((e=>{e.addEventListener("ownership-changed",this.onStateChange),this.el.setAttribute("visible",NAF.utils.isMine(e))}))}})},40177:function(e,t,n){"use strict";n.d(t,{gi:function(){return F8},P0:function(){return N8},cl:function(){return V8},f7:function(){return H8}});var i={};n.r(i),n.d(i,{$isStringType:function(){return Tt},AEntity:function(){return Ut},AmbientLightTag:function(){return qt},AnimationMixer:function(){return ti},AudioEmitter:function(){return oi},AudioParams:function(){return Di},AudioSettingsChanged:function(){return si},AudioSource:function(){return Ri},AudioTarget:function(){return Ti},AudioZone:function(){return Oi},Billboard:function(){return Ei},CameraTool:function(){return Wn},Constraint:function(){return gn},ConstraintHandLeft:function(){return bn},ConstraintHandRight:function(){return vn},ConstraintRemoteLeft:function(){return wn},ConstraintRemoteRight:function(){return yn},CursorRaycastable:function(){return Xt},Deletable:function(){return ai},DestroyAtExtremeDistance:function(){return Bn},DirectionalLight:function(){return Zt},EntityStateDirty:function(){return jt},EnvironmentSettings:function(){return li},FloatyObject:function(){return Un},GLTFModel:function(){return zt},HandCollisionTarget:function(){return En},HandLeft:function(){return rn},HandRight:function(){return nn},Held:function(){return fn},HeldHandLeft:function(){return hn},HeldHandRight:function(){return un},HeldRemoteLeft:function(){return mn},HeldRemoteRight:function(){return pn},HemisphereLightTag:function(){return Gt},Holdable:function(){return Jt},HoldableButton:function(){return Pn},HoverButton:function(){return xn},HoverMenuChild:function(){return On},HoveredHandLeft:function(){return ln},HoveredHandRight:function(){return an},HoveredRemoteLeft:function(){return dn},HoveredRemoteRight:function(){return cn},IgnoreSpaceBubble:function(){return jn},Inspectable:function(){return Rn},Interacted:function(){return tn},LightTag:function(){return Wt},LinearRotate:function(){return Ii},LinearScale:function(){return Ni},LinearTranslate:function(){return Li},Link:function(){return hi},LinkHoverMenu:function(){return di},LinkHoverMenuItem:function(){return ui},MakeKinematicOnRelease:function(){return zn},MaterialTag:function(){return Ai},MediaFrame:function(){return It},MediaImage:function(){return Kn},MediaLoaded:function(){return Gn},MediaLoader:function(){return Zn},MediaLoading:function(){return Vn},MediaPDF:function(){return Jn},MediaVideo:function(){return ei},Mirror:function(){return Ci},MyCameraTool:function(){return qn},NavMesh:function(){return Qn},NetworkDebug:function(){return fi},NetworkDebugRef:function(){return gi},Networked:function(){return Rt},NetworkedFloatyObject:function(){return Hn},NetworkedMediaFrame:function(){return Lt},NetworkedPDF:function(){return $n},NetworkedTransform:function(){return Vt},NetworkedVideo:function(){return ni},NetworkedWaypoint:function(){return bi},NotRemoteHoverTarget:function(){return $t},Object3DTag:function(){return Ht},ObjectMenu:function(){return ci},ObjectMenuTarget:function(){return mi},ObjectSpawner:function(){return _i},OffersHandConstraint:function(){return An},OffersRemoteConstraint:function(){return _n},Owned:function(){return Dt},PDFMenu:function(){return pi},ParticleEmitterTag:function(){return ki},Pen:function(){return kn},PhysicsShape:function(){return In},Pinnable:function(){return Nn},Pinned:function(){return Fn},PointLightTag:function(){return Yt},PreventAudioBoost:function(){return Dn},ReflectionProbe:function(){return Ft},RemoteHoverTarget:function(){return Kt},RemoteLeft:function(){return sn},RemoteRight:function(){return on},RemoveNetworkedEntityButton:function(){return en},Rigidbody:function(){return Ln},SceneLoader:function(){return Xn},ScenePreviewCamera:function(){return ji},SceneRoot:function(){return Yn},SimpleWater:function(){return Pi},SingleActionButton:function(){return Cn},Skybox:function(){return wi},Slice9:function(){return Bt},SpotLightTag:function(){return Qt},Static:function(){return Tn},TextButton:function(){return Mn},TextTag:function(){return Nt},TogglesHoveredActionSet:function(){return Sn},UVScroll:function(){return Si},VideoMenu:function(){return ri},VideoMenuItem:function(){return ii},VideoTextureSource:function(){return xi},VideoTextureTarget:function(){return Mi},Waypoint:function(){return vi},WaypointPreview:function(){return yi}});var r={};n.r(r),n.d(r,{anyEntityWith:function(){return qo},findAncestorEntity:function(){return Go},findAncestorWithComponent:function(){return Yo},findChildWithComponent:function(){return Qo},hasAnyComponent:function(){return Zo}}),n(92087),n(82801),n(84633),n(61295),n.p,n.p,n.p,n.p,n.p;const o={en:"English","zh-cn":"简体中文",pt:"Portugês (Brasil)",ja:"日本語",es:"Español",ru:"Pусский",fr:"Français",ko:"한국어",de:"Deutsch","zh-tw":"繁體中文"},s={jp:"ja"};function a(e,t){if(e){if("string"==typeof e)return l(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?l(e,t):void 0}}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function d(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(Object(n),!0).forEach((function(t){u(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function u(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var h={"app-name":"App","editor-name":"Scene Editor","contact-email":"info@istudyonline.com.au","company-name":"Company","share-hashtag":"#app","app-description":"Gather share and collaborate together in a virtual, private and safe space","app-tagline":"Private social VR in your web browser"},p="en",m=new Map,f=p,g=h;function v(e){var t=function(e){var t,n=navigator.languages?function(e){if(Array.isArray(e))return l(e)}(t=navigator.languages)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(t)||a(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}():navigator.language?[navigator.language]:navigator.userLanguage?[navigator.userLanguage]:void 0;e&&"browser"!==e&&n.unshift(e);for(var i=0;i<n.length;i++){var r=n[i];if(Object.prototype.hasOwnProperty.call(o,r))return r;Object.prototype.hasOwnProperty.call(s,r)&&Object.prototype.hasOwnProperty.call(s,r);var c=r.split("-")[0].toLowerCase();if(Object.prototype.hasOwnProperty.call(o,c))return c;if(Object.prototype.hasOwnProperty.call(s,c))return s[c]}return p}(e);t===p?(f=t,g=h,window.dispatchEvent(new CustomEvent("locale-updated"))):m.has(t)?(f=t,window.dispatchEvent(new CustomEvent("locale-updated"))):n(37472)("./".concat(t,".json")).then((function(e){var n=e.default;f=t,g=d(d({},h),n),window.dispatchEvent(new CustomEvent("locale-updated"))}))}var b=window.setInterval((function(){window.APP&&window.APP.store&&(window.clearInterval(b),v(window.APP.store.state.preferences.locale),window.APP.store.addEventListener("statechanged",(function(){v(window.APP.store.state.preferences.locale)})))}),100),y=function(){return f},w=function(){if(m.has(f))return m.get(f);if(k.APP_CONFIG&&k.APP_CONFIG.translations&&k.APP_CONFIG.translations[f]){var e=k.APP_CONFIG.translations[f];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&e[t]&&(g[t]=e[t])}var n=[];for(var i in g)Object.prototype.hasOwnProperty.call(g,i)&&n.push([i,g[i]]);var r=n.map((function(e){var t,n,i=(n=2,function(e){if(Array.isArray(e))return e}(t=e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,r,o=[],s=!0,a=!1;try{for(n=n.call(e);!(s=(i=n.next()).done)&&(o.push(i.value),!t||o.length!==t);s=!0);}catch(e){a=!0,r=e}finally{try{s||null==n.return||n.return()}finally{if(a)throw r}}return o}}(t,n)||a(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}());return[i[0],i[1].replace(/%([\w-.]+)%/i,(function(e,t){return g[t]}))]})).reduce((function(e,t){return e[t[0]]=t[1],e}),{});return m.set(f,r),r},_={},E=!1;["RETICULUM_SERVER","THUMBNAIL_SERVER","CORS_PROXY_SERVER","NON_CORS_PROXY_DOMAINS","SENTRY_DSN","GA_TRACKING_ID","SHORTLINK_DOMAIN","BASE_ASSETS_PATH","UPLOADS_HOST"].forEach((function(e){var t=document.querySelector("meta[name='env:".concat(e.toLowerCase(),"']"));_[e]=t?t.getAttribute("content"):{NODE_ENV:"production",SHORTLINK_DOMAIN:"hub.link",RETICULUM_SERVER:"dev.reticulum.io",THUMBNAIL_SERVER:"nearspark-dev.reticulum.io",CORS_PROXY_SERVER:"hubs-proxy.com",NON_CORS_PROXY_DOMAINS:"hubs.local,dev.reticulum.io,hubs-upload-cdn.com",BASE_ASSETS_PATH:"/"}[e];var i="BASE_ASSETS_PATH";e===i&&_[i]&&(_[i].startsWith("http")||(_[i]=new URL(_[i],window.location).toString()),n.p=_[i])}));var A=!!document.querySelector("meta[name='env:thumbnail_server']");if(_.IS_LOCAL_OR_CUSTOM_CLIENT=!A,_.AVAILABLE_INTEGRATIONS=window.AVAILABLE_INTEGRATIONS||{},{NODE_ENV:"production",SHORTLINK_DOMAIN:"hub.link",RETICULUM_SERVER:"dev.reticulum.io",THUMBNAIL_SERVER:"nearspark-dev.reticulum.io",CORS_PROXY_SERVER:"hubs-proxy.com",NON_CORS_PROXY_DOMAINS:"hubs.local,dev.reticulum.io,hubs-upload-cdn.com",BASE_ASSETS_PATH:"/"}.APP_CONFIG&&(window.APP_CONFIG={NODE_ENV:"production",SHORTLINK_DOMAIN:"hub.link",RETICULUM_SERVER:"dev.reticulum.io",THUMBNAIL_SERVER:"nearspark-dev.reticulum.io",CORS_PROXY_SERVER:"hubs-proxy.com",NON_CORS_PROXY_DOMAINS:"hubs.local,dev.reticulum.io,hubs-upload-cdn.com",BASE_ASSETS_PATH:"/"}.APP_CONFIG),window.APP_CONFIG){_.APP_CONFIG=window.APP_CONFIG;var S=_.APP_CONFIG.theme;if(S){var x=[];for(var M in S)Object.prototype.hasOwnProperty.call(S,M)&&x.push("--".concat(M,": ").concat(S[M],";"));var P=document.createElement("style");P.innerHTML=":root{".concat(x.join("\n"),"}"),document.head.insertBefore(P,document.head.firstChild)}_.APP_CONFIG.features||(_.APP_CONFIG.features={})}else _.APP_CONFIG={features:{}};_.feature=function(e){var t=_.APP_CONFIG&&_.APP_CONFIG.features&&_.APP_CONFIG.features[e];return("boolean"==typeof t||"enable_spoke"===e)&&"enable_spoke"===e&&E||t};var C={};_.image=function(e,t){var n=_.APP_CONFIG&&_.APP_CONFIG.images&&_.APP_CONFIG.images[e]||C[e];return n&&t?"url(".concat(n,")"):n},_.link=function(e,t){return _.APP_CONFIG&&_.APP_CONFIG.links&&_.APP_CONFIG.links[e]||t},_.setIsAdmin=function(e){E=e},_.isAdmin=function(){return E},_.integration=function(e){var t=_.AVAILABLE_INTEGRATIONS;return!Object.prototype.hasOwnProperty.call(t,e)||t[e]},_.translation=function(e){var t=y(),n=_.APP_CONFIG&&_.APP_CONFIG.translations||{};return n[t]&&n[t][e]||n.en&&n.en[e]||function(e){return g[e]}(e)||""};var k=_;function O(){const e=new URLSearchParams(location.search),t=k.feature("default_room_id");return e.get("hub_id")||("/"===document.location.pathname&&t?t:document.location.pathname.substring(1).split("/")[0])}function T(e){let{presence:t}=e;const n=Object.getOwnPropertyNames(t.state).length;document.querySelector("#hud-presence-count").setAttribute("text","value",n.toString())}function R(e){const t=APP.hubChannel.presence.state;return t&&t[e]&&t[e].metas[0].roles.owner}function D(){const e=O();return!!k.feature("is_locked_down_demo_room")&&k.feature("is_locked_down_demo_room").replace(/\s/g,"").split(",").includes(e)}n(92874);const j=function(e,t){return new Promise((n=>{t.addEventListener(e,n,{once:!0})}))},L=function(){return"complete"===document.readyState||"loaded"===document.readyState||"interactive"===document.readyState?Promise.resolve(null):j("DOMContentLoaded",window)},I=function(e){return new Promise((t=>{setTimeout(t,e)}))};var N=n(40660),F=n(5664),B=n(36808),V=n.n(B),U=n(46489),H=n.n(U),z=n(67930);let W=null;function q(){return null===W&&(W=/\b(Macintosh|iPad|iPhone)\b/i.test(navigator.userAgent)&&function(){let e=!1;if("maxTouchPoints"in navigator)e=navigator.maxTouchPoints>0;else if("msMaxTouchPoints"in navigator)e=navigator.msMaxTouchPoints>0;else{const t=window.matchMedia&&matchMedia("(pointer:coarse)");if(t&&"(pointer:coarse)"===t.media)e=!!t.matches;else if("orientation"in window)e=!0;else{const t=navigator.userAgent;e=/\b(BlackBerry|webOS|iPhone|IEMobile)\b/i.test(t)||/\b(Android|Windows Phone|iPad|iPod)\b/i.test(t)}}return e}()),W}const Z=/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i,G=/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw-(n|u)|c55\/|capi|ccwa|cdm-|cell|chtm|cldc|cmd-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc-s|devi|dica|dmob|do(c|p)o|ds(12|-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(-|_)|g1 u|g560|gene|gf-5|g-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd-(m|p|t)|hei-|hi(pt|ta)|hp( i|ip)|hs-c|ht(c(-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i-(20|go|ma)|i230|iac( |-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|-[a-w])|libw|lynx|m1-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|-([1-8]|c))|phil|pire|pl(ay|uc)|pn-2|po(ck|rt|se)|prox|psio|pt-g|qa-a|qc(07|12|21|32|60|-[2-7]|i-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h-|oo|p-)|sdk\/|se(c(-|0|1)|47|mc|nd|ri)|sgh-|shar|sie(-|m)|sk-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h-|v-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl-|tdg-|tel(i|m)|tim-|t-mo|to(pl|sh)|ts(70|m-|m3|m5)|tx-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas-|your|zeto|zte-/i;function Y(){return window.navigator.maxTouchPoints&&window.navigator.maxTouchPoints>2&&/MacIntel/.test(navigator.platform)}function Q(){return/iPad|iPhone|iPod/.test(window.navigator.platform)||Y()}function X(){return/(OculusBrowser)/i.test(window.navigator.userAgent)||/(Mobile VR)/i.test(window.navigator.userAgent)}var K=function(){let e=!1;var t;return t=window.navigator.userAgent||window.navigator.vendor||window.opera,(Z.test(t)||G.test(t.substr(0,4)))&&(e=!0),(Q()||function(e){const t=window.navigator.userAgent;return Y()||/ipad|Nexus (7|9)|xoom|sch-i800|playbook|tablet|kindle/i.test(t)}()||/R7 Build/.test(window.navigator.userAgent))&&(e=!0),q()&&(e=!0),X()&&(e=!1),function(){return e}}(),$=n(27185),J=n(73887),ee=n(5274);const te=ee.Z.create({baseURL:"/api",withCredentials:!0,timeout:18e4}),ne=[],ie=ee.Z.CancelToken,re=e=>{for(const t in ne){const n=JSON.stringify(e.data);ne[t].u===e.url+"&"+n&&(ne[t].f(),ne.splice(t,1))}};te.interceptors.request.use((e=>{re(e),e.cancelToken=new ie((t=>{ne.push({u:e.url+"&"+JSON.stringify(e.data),f:t})}));const t=window.APP.store;return console.log("store.userinfo",t.state.userinfo),t.state.userinfo&&t.state.userinfo.token&&(e.headers["X-Auth-Token"]=t.state.userinfo.token,e.headers["X-Auth-Type"]="app",e.headers["Content-Type"]="application/json"),e}),(e=>Promise.reject(e))),te.interceptors.response.use((e=>{const t=e.data;return re(e.config),200!==t.code&&402===t.code?Promise.reject(t.message):t}),(e=>"Cancel"!==e.constructor.name?Promise.reject(e):Promise.reject({})));var oe=te;function se(e){return oe({url:"/v1/sel/stoseller/deleteClassroomId",method:"post",data:e})}function ae(e,t,n,i,r,o,s){try{var a=e[o](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(i,r)}function le(e){return function(){var t=this,n=arguments;return new Promise((function(i,r){var o=e.apply(t,n);function s(e){ae(o,i,r,s,a,"next",e)}function a(e){ae(o,i,r,s,a,"throw",e)}s(void 0)}))}}function ce(){return!!k.RETICULUM_SERVER}function de(){return ce()&&document.location.host!==k.RETICULUM_SERVER}function ue(e,t,n,i){let r;e||(e=de()?new URLSearchParams(location.search).get("hub_id"):location.pathname.split("/")[1]),de()?(r=new URL("/hub.html",location.href),r.searchParams.set("hub_id",e)):r=new URL(`/${e}${n?`/${n}`:""}`,location.href);for(const e in t)Object.prototype.hasOwnProperty.call(t,e)&&r.searchParams.set(e,t[e]);return i&&(r.hash=i),r}const he=document.createElement("a");let pe,me=null,fe=!1;function ge(e,t,n,i){return void 0===t&&(t=!1),void 0===n&&(n=null),void 0===i&&(i=null),n||ce()?`https://${n||k.RETICULUM_SERVER}${i?`:${i}`:""}${e}`:t?(he.href=e,he.href):e}function ve(){return be.apply(this,arguments)}function be(){return be=le((function*(){me||(!fe&&document.querySelector("meta[name='ret:version']")?me={version:document.querySelector("meta[name='ret:version']").getAttribute("value"),pool:document.querySelector("meta[name='ret:pool']").getAttribute("value"),phx_host:document.querySelector("meta[name='ret:phx_host']").getAttribute("value")}:yield fetch(ge("/api/v1/meta")).then(function(){var e=le((function*(e){me=yield e.json()}));return function(t){return e.apply(this,arguments)}}()));const e=new URLSearchParams(location.search).get("phx_host");return e&&(me.phx_host=e),me})),be.apply(this,arguments)}function ye(){return ye=le((function*(){const e=new URLSearchParams(location.search);let t=e.get("phx_host");const n=yield ve();t=t||k.RETICULUM_SOCKET_SERVER||n.phx_host;const i=e.get("phx_port")||(ce()?new URL(`${document.location.protocol}//${k.RETICULUM_SERVER}`).port:"443");pe={host:t,port:i}})),ye.apply(this,arguments)}function we(){return _e.apply(this,arguments)}function _e(){return(_e=le((function*(){fe=!0,me=null}))).apply(this,arguments)}function Ee(){return Ae.apply(this,arguments)}function Ae(){return Ae=le((function*(e,t,n){void 0===e&&(e=!1),void 0===t&&(t=null),void 0===n&&(n=J.sk);const i=new URLSearchParams(location.search),r=function(){var e=le((function*(){yield function(){return ye.apply(this,arguments)}();const{host:e,port:t}=pe;return`${i.get("phx_protocol")||k.RETICULUM_SOCKET_PROTOCOL||("https:"===document.location.protocol?"wss:":"ws:")}//${e}${t?`:${t}`:""}`}));return function(){return e.apply(this,arguments)}}(),o=yield r();console.log(`Phoenix Socket URL: ${o}`);const s={};e&&(s.logger=(e,t,n)=>{console.log(`${e}: ${t}`,n)}),t&&(s.params=t);const a=new n(`${o}/socket`,s);return a.connect(),a.onError(le((function*(){we();const e=new URL(a.endPoint).pathname,t=`${yield r()}${e}`;console.log(`Socket error, changed endpoint to ${t}`),a.endPoint=t}))),a})),Ae.apply(this,arguments)}function Se(e,t,n){return void 0===t&&(t="GET"),function(e,t,n,i){void 0===n&&(n="GET");const r=ge(t),o={headers:{"content-type":"application/json"},method:n};return e&&(o.headers.authorization=`bearer ${e}`),i&&(o.body=JSON.stringify(i)),fetch(r,o).then(function(){var e=le((function*(e){const t=yield e.text();try{return JSON.parse(t)}catch(e){return t}}));return function(t){return e.apply(this,arguments)}}())}(ot.state.credentials.token,e,t,n)}function xe(e,t){const n=Object.entries(e||{}).find((e=>{let[n]=e;return n===t}))||[],i=n[1];return i&&i.metas&&i.metas[0]||{}}function Me(e,t){return(xe(e,t)||{}).profile||{}}function Pe(e,t){const n=["phx_close","phx_error","phx_reply","presence_state","presence_diff"];for(let r=0,o=e.bindings.length;r<o;r++){const o=e.bindings[r];(i=o.event).startsWith("chan_reply_")||n.includes(i)||t.bindings.push(o)}var i;t.bindingRef=e.bindingRef}function Ce(e,t,n){const i=t.channel(e.topic,n||e.params);Pe(e,i);for(let t=0,n=e.pushBuffer.length;t<n;t++){const n=e.pushBuffer[t];i.push(n.event,n.payload,n.timeout)}const r=e.joinPush,o=i.join();for(let e=0,t=r.recHooks.length;e<t;e++){const t=r.recHooks[e];o.receive(t.status,t.callback)}return new Promise((t=>{o.receive("ok",(()=>{e.bindings=[],t(i)}))}))}function ke(e){const t=[];for(const n of Object.values(e))for(const e of n.metas)e.profile&&e.profile.discordBridges&&Array.prototype.push.apply(t,e.profile.discordBridges.map((e=>e.channel.name)));return t}const Oe=function(){var e=le((function*(e,t){let{ret_pool:n,ret_version:i}=e,r=!1,o=0;for(;!r&&o<10&&!t();){try{const e=5e3*o+(0===o?15e3*Math.random():0);console.log(`[reconnect] Getting reticulum meta in ${Math.ceil(e/1e3)} seconds.${o?` (Attempt ${o+1} of 10)`:""}`),yield I(e),we(),console.log("[reconnect] Getting reticulum meta."+(o?` (Attempt ${o+1} of 10)`:""));const{pool:t,version:s}=yield ve();r=n===t&&i===s}catch{r=!1}o+=1}return r}));return function(t,n){return e.apply(this,arguments)}}();var Te=n.p+"assets/models/DefaultAvatar-c1f54532db88e7e88b3e..glb";function Re(e,t,n,i,r,o,s){try{var a=e[o](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(i,r)}const De=["Baers-Pochard","Baikal-Teal","Barrows-Goldeneye","Blue-Billed","Blue-Duck","Blue-Winged","Brown-Teal","Bufflehead","Canvasback","Cape-Shoveler","Chestnut-Teal","Chiloe-Wigeon","Cinnamon-Teal","Comb-Duck","Common-Eider","Common-Goldeneye","Common-Merganser","Common-Pochard","Common-Scoter","Common-Shelduck","Cotton-Pygmy","Crested-Duck","Crested-Shelduck","Eatons-Pintail","Falcated","Ferruginous","Freckled-Duck","Gadwall","Garganey","Greater-Scaup","Green-Pygmy","Grey-Teal","Hardhead","Harlequin","Hartlaubs","Hooded-Merganser","Kelp-Goose","King-Eider","Lake-Duck","Laysan-Duck","Lesser-Scaup","Long-Tailed","Maccoa-Duck","Mallard","Mandarin","Marbled-Teal","Mellers-Duck","Merganser","Northern-Pintail","Orinoco-Goose","Paradise-Shelduck","Plumed-Whistler","Puna-Teal","Pygmy-Goose","Radjah-Shelduck","Red-Billed","Red-Crested","Red-Shoveler","Ring-Necked","Ringed-Teal","Rosy-Billed","Ruddy-Shelduck","Salvadoris-Teal","Scaly-Sided","Shelduck","Shoveler","Silver-Teal","Smew","Spectacled-Eider","Spot-Billed","Spotted-Whistler","Steamerduck","Stellers-Eider","Sunda-Teal","Surf-Scoter","Tufted-Duck","Velvet-Scoter","Wandering-Whistler","Whistling-duck","White-Backed","White-Cheeked","White-Winged","Wigeon","Wood-Duck","Yellow-Billed"];function je(e){return e[Math.floor(Math.random()*e.length)]}function Le(){return Ie.apply(this,arguments)}function Ie(){var e;return e=function*(){const e=(yield Se("/api/v1/media/search?filter=default&source=avatar_listings")).entries||[];return 0===e.length?new URL(Te,location.href).href:je(e.map((e=>e.id)))},Ie=function(){var t=this,n=arguments;return new Promise((function(i,r){var o=e.apply(t,n);function s(e){Re(o,i,r,s,a,"next",e)}function a(e){Re(o,i,r,s,a,"throw",e)}s(void 0)}))},Ie.apply(this,arguments)}const Ne=Object.freeze({PERMISSIONS_STATUS_CHANGED:"permissions_status_changed",MIC_SHARE_STARTED:"mic_share_started",MIC_SHARE_ENDED:"mic_share_ended",VIDEO_SHARE_STARTED:"video_share_started",VIDEO_SHARE_ENDED:"video_share_ended",DEVICE_CHANGE:"devicechange"}),Fe=Object.freeze({GRANTED:"granted",DENIED:"denied",PROMPT:"prompt"}),Be=Object.freeze({MICROPHONE:"microphone",SPEAKERS:"speakers",CAMERA:"camera",SCREEN:"screen"}),Ve="none";let Ue,He;!function(e){e[e.ALL=-1]="ALL",e[e.NONE=0]="NONE",e[e.INTERACTABLES=1]="INTERACTABLES",e[e.ENVIRONMENT=2]="ENVIRONMENT",e[e.AVATAR=4]="AVATAR",e[e.HANDS=8]="HANDS",e[e.MEDIA_FRAMES=16]="MEDIA_FRAMES",e[e.DEFAULT_INTERACTABLE=31]="DEFAULT_INTERACTABLE",e[e.UNOWNED_INTERACTABLE=25]="UNOWNED_INTERACTABLE",e[e.DEFAULT_SPAWNER=9]="DEFAULT_SPAWNER"}(Ue||(Ue={})),function(e){e.NONE="NONE",e.SMAA="SMAA",e.MSAA_2X="MSAA_2X",e.MSAA_4X="MSAA_4X",e.MSAA_8X="MSAA_8X"}(He||(He={}));const ze="https://istudyonline.com.au/privacy",We="https://istudyonline.com.au/term";var qe;function Ze(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function Ge(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ze(Object(n),!0).forEach((function(t){Ye(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ze(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Ye(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Qe(e,t,n,i,r,o,s){try{var a=e[o](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(i,r)}function Xe(e){return function(){var t=this,n=arguments;return new Promise((function(i,r){var o=e.apply(t,n);function s(e){Qe(o,i,r,s,a,"next",e)}function a(e){Qe(o,i,r,s,a,"throw",e)}s(void 0)}))}}const Ke="___hubs_store",$e=Symbol(),Je="ret-oauth-flow-account-credentials",et=new N.Validator,tt=function(){const e=["low","medium","high"];if(window.AFRAME&&(AFRAME.utils.device.isMobile()||AFRAME.utils.device.isMobileVR())){const t=(0,z.c)("default_mobile_material_quality");return t&&-1!==e.indexOf(t)?t:"low"}const t=(0,z.c)("default_material_quality");return t&&-1!==e.indexOf(t)?t:"high"}(),nt=(null===(qe=window.AFRAME)||void 0===qe?void 0:qe.utils.device.isMobileVR())&&navigator.userAgent.match(/Firefox/),it={id:"/HubsStore",definitions:{profile:{type:"object",additionalProperties:!1,properties:{displayName:{type:"string",pattern:"^[A-Za-z0-9_~ -]{3,32}$"},avatarId:{type:"string"},personalAvatarId:{type:"string"}}},credentials:{type:"object",additionalProperties:!1,properties:{token:{type:["null","string"]},email:{type:["null","string"]}}},userinfo:{type:"object",additionalProperties:!1,properties:{memberid:{type:["null","string"]},sellerid:{type:["null","string"]},storeid:{type:["null","string"]},name:{type:["null","string"]},avatar:{type:["null","string"]},token:{type:["null","string"]}}},activity:{type:"object",additionalProperties:!1,properties:{hasFoundFreeze:{type:"boolean"},hasChangedName:{type:"boolean"},hasAcceptedProfile:{type:"boolean"},lastEnteredAt:{type:"string"},hasPinned:{type:"boolean"},hasRotated:{type:"boolean"},hasRecentered:{type:"boolean"},hasScaled:{type:"boolean"},hasHoveredInWorldHud:{type:"boolean"},hasOpenedShare:{type:"boolean"},entryCount:{type:"number"}}},settings:{type:"object",additionalProperties:!1,properties:{lastUsedMicDeviceId:{type:"string"},micMuted:{type:"bool"}}},preferences:{type:"object",additionalProperties:!1,properties:{shouldPromptForRefresh:{type:"bool",default:!1},preferredMic:{type:"string",default:Ve},preferredSpeakers:{type:"string",default:Ve},preferredCamera:{type:"string",default:Ve},muteMicOnEntry:{type:"bool",default:!1},disableLeftRightPanning:{type:"bool",default:!1},audioNormalization:{type:"bool",default:0},invertTouchscreenCameraMove:{type:"bool",default:!0},enableOnScreenJoystickLeft:{type:"bool",default:K()},enableOnScreenJoystickRight:{type:"bool",default:K()},enableGyro:{type:"bool",default:!0},animateWaypointTransitions:{type:"bool",default:!0},showFPSCounter:{type:"bool",default:!1},allowMultipleHubsInstances:{type:"bool",default:!1},disableIdleDetection:{type:"bool",default:!1},fastRoomSwitching:{type:"bool",default:!1},lazyLoadSceneMedia:{type:"bool",default:!1},preferMobileObjectInfoPanel:{type:"bool",default:!1},maxResolutionWidth:{type:"number",default:void 0},maxResolutionHeight:{type:"number",default:void 0},globalVoiceVolume:{type:"number",default:100},globalMediaVolume:{type:"number",default:100},globalSFXVolume:{type:"number",default:100},snapRotationDegrees:{type:"number",default:45},materialQualitySetting:{type:"string",default:tt},enableDynamicShadows:{type:"bool",default:!1},disableSoundEffects:{type:"bool",default:!1},disableMovement:{type:"bool",default:!1},disableBackwardsMovement:{type:"bool",default:!1},disableStrafing:{type:"bool",default:!1},disableTeleporter:{type:"bool",default:!1},disableAutoPixelRatio:{type:"bool",default:!1},movementSpeedModifier:{type:"number",default:1},disableEchoCancellation:{type:"bool",default:nt},disableNoiseSuppression:{type:"bool",default:nt},disableAutoGainControl:{type:"bool",default:nt},locale:{type:"string",default:"browser"},showRtcDebugPanel:{type:"bool",default:!1},showAudioDebugPanel:{type:"bool",default:!1},enableAudioClipping:{type:"bool",default:!1},audioClippingThreshold:{type:"number",default:.015},audioPanningQuality:{type:"string",default:/Android/.test(window.navigator.userAgent)&&!X()?"Low":"High"},theme:{type:"string",default:void 0},cursorSize:{type:"number",default:1},nametagVisibility:{type:"string",default:"showAll"},nametagVisibilityDistance:{type:"number",default:5},avatarVoiceLevels:{type:"object"},enablePostEffects:{type:"bool",default:!1},enableBloom:{type:"bool",default:!0},aaMode:{type:"string",default:He.MSAA_4X}}},confirmedDiscordRooms:{type:"array",items:{type:"string"}},confirmedBroadcastedRooms:{type:"array",items:{type:"string"}},uploadPromotionTokens:{type:"array",items:{type:"object",additionalProperties:!1,properties:{fileId:{type:"string"},promotionToken:{type:"string"}}}},creatorAssignmentTokens:{type:"array",items:{type:"object",additionalProperties:!1,properties:{hubId:{type:"string"},creatorAssignmentToken:{type:"string"}}}},embedTokens:{type:"array",items:{type:"object",additionalProperties:!1,properties:{hubId:{type:"string"},embedToken:{type:"string"}}}},onLoadActions:{type:"array",items:{type:"object",additionalProperties:!1,properties:{action:{type:"string"},args:{type:"object"}}}}},type:"object",properties:{profile:{$ref:"#/definitions/profile"},credentials:{$ref:"#/definitions/credentials"},userinfo:{$ref:"#/definitions/userinfo"},activity:{$ref:"#/definitions/activity"},settings:{$ref:"#/definitions/settings"},preferences:{$ref:"#/definitions/preferences"},confirmedDiscordRooms:{$ref:"#/definitions/confirmedDiscordRooms"},confirmedBroadcastedRooms:{$ref:"#/definitions/confirmedBroadcastedRooms"},uploadPromotionTokens:{$ref:"#/definitions/uploadPromotionTokens"},creatorAssignmentTokens:{$ref:"#/definitions/creatorAssignmentTokens"},embedTokens:{$ref:"#/definitions/embedTokens"},onLoadActions:{$ref:"#/definitions/onLoadActions"}},additionalProperties:!1};class rt extends $.EventTarget{constructor(){var e;super(),e=this,this._signOutOnExpiredAuthToken=()=>{this.state.credentials.token&&1e3*H()(this.state.credentials.token).exp<=Date.now()&&this.update({credentials:{token:null,email:null},userinfo:{memberid:null,sellerid:null,storeid:null,name:null,avatar:null,classroomid:null,token:null}})},this.initProfile=Xe((function*(){e._shouldResetAvatarOnInit?yield e.resetToRandomDefaultAvatar():e.update({profile:Ge({avatarId:yield Le()},e.state.profile||{})}),e.state.activity.hasChangedName||e.update({profile:{displayName:`${je(De)}-${Math.floor(1e4+1e4*Math.random())}`}})})),this.resetToRandomDefaultAvatar=Xe((function*(){e.update({profile:Ge(Ge({},e.state.profile||{}),{},{avatarId:yield Le()})})})),this._preferences={},null===localStorage.getItem(Ke)&&localStorage.setItem(Ke,JSON.stringify({})),window.addEventListener("storage",(e=>{e.key===Ke&&(delete this[$e],this.dispatchEvent(new CustomEvent("statechanged")))})),this.update({activity:{},settings:{},credentials:{},userinfo:{},profile:{},confirmedDiscordRooms:[],confirmedBroadcastedRooms:[],uploadPromotionTokens:[],creatorAssignmentTokens:[],embedTokens:[],onLoadActions:[],preferences:{}}),this._shouldResetAvatarOnInit=!1;const t=V().getJSON(Je);t&&(this.update({credentials:t}),this._shouldResetAvatarOnInit=!0,V().remove(Je)),this._signOutOnExpiredAuthToken();const n=(()=>{let e;return()=>{const t=this.state.preferences.theme;(e||t)&&e!==t&&this.dispatchEvent(new CustomEvent("themechanged",{detail:{current:t,previous:e}})),e=t,console.log("Theme updated to: ",t)}})();this.addEventListener("statechanged",n)}get state(){if(!Object.prototype.hasOwnProperty.call(this,$e)){const e=this[$e]=JSON.parse(localStorage.getItem(Ke));e.preferences||(e.preferences={}),this._preferences=Ge({},e.preferences);for(const[t,n]of Object.entries(it.definitions.preferences.properties))Object.prototype.hasOwnProperty.call(n,"default")&&(Object.prototype.hasOwnProperty.call(e.preferences,t)?e.preferences[t]===n.default&&delete this._preferences[t]:e.preferences[t]=n.default)}return this[$e]}get credentialsAccountId(){return this.state.credentials.token?H()(this.state.credentials.token).sub:null}resetConfirmedBroadcastedRooms(){this.clearStoredArray("confirmedBroadcastedRooms")}resetTipActivityFlags(){this.update({activity:{hasRotated:!1,hasPinned:!1,hasRecentered:!1,hasScaled:!1,entryCount:0}})}bumpEntryCount(){const e=this.state.activity.entryCount||0;this.update({activity:{entryCount:e+1}})}enqueueOnLoadAction(e,t){this.update({onLoadActions:[{action:e,args:t}]})}executeOnLoadActions(e){for(let t=0;t<this.state.onLoadActions.length;t++){const{action:n,args:i}=this.state.onLoadActions[t];"emit_scene_event"===n&&e.emit(i.event,i.detail)}this.clearOnLoadActions()}clearOnLoadActions(){this.clearStoredArray("onLoadActions")}clearStoredArray(e){const t={};t[e]=[],this.update(t,{arrayMerge:(e,t)=>t})}update(e,t){const n=(0,F.Z)(Ge(Ge({},this.state),{},{preferences:this._preferences}),e,t),{valid:i,errors:r}=et.validate(n,it);if(i||r.forEach((e=>{console.error(`Removing invalid preference from store: ${e.message}`),delete e.instance[e.argument]})),e.preferences){for(const[e,t]of Object.entries(n.preferences))it.definitions.preferences.properties[e]&&Object.prototype.hasOwnProperty.call(it.definitions.preferences.properties[e],"default")&&t===it.definitions.preferences.properties[e].default&&delete n.preferences[e];this._preferences=n.preferences}return localStorage.setItem(Ke,JSON.stringify(n)),delete this[$e],void 0!==e.profile&&this.dispatchEvent(new CustomEvent("profilechanged")),this.dispatchEvent(new CustomEvent("statechanged")),n}getEmbedTokenForHub(e){const t=this.state.embedTokens.find((t=>t.hubId===e.hub_id));return t?t.embedToken:null}clearUserInfo(){this.update({userinfo:{memberid:null,sellerid:null,storeid:null,name:null,avatar:null,classroomid:null,token:null}})}updateClassRoomID(e){this.update({userinfo:Ge(Ge({},this.state.userinfo),{},{classroomid:e})})}get schema(){return it}}const ot=new rt;var st;const at="#FF3464",lt="#FF74A4",ct={"action-color":at,"action-label-color":at,"action-color-disabled":lt,"action-color-highlight":lt,"action-text-color":"#FFFFFF","action-subtitle-color":"#F0F0F0","notice-background-color":"#2F80ED","notice-text-color":"#FFFFFF","favorited-color":"#FFC000","nametag-color":"#000000","nametag-volume-color":"#7ED320","nametag-text-color":"#FFFFFF","nametag-border-color":"#7ED320","nametag-border-color-raised-hand":"#FFCD74"},dt=(()=>{var e,t;let n={NODE_ENV:"production",SHORTLINK_DOMAIN:"hub.link",RETICULUM_SERVER:"dev.reticulum.io",THUMBNAIL_SERVER:"nearspark-dev.reticulum.io",CORS_PROXY_SERVER:"hubs-proxy.com",NON_CORS_PROXY_DOMAINS:"hubs.local,dev.reticulum.io,hubs-upload-cdn.com",BASE_ASSETS_PATH:"/"}.APP_CONFIG;return!n&&{NODE_ENV:"production",SHORTLINK_DOMAIN:"hub.link",RETICULUM_SERVER:"dev.reticulum.io",THUMBNAIL_SERVER:"nearspark-dev.reticulum.io",CORS_PROXY_SERVER:"hubs-proxy.com",NON_CORS_PROXY_DOMAINS:"hubs.local,dev.reticulum.io,hubs-upload-cdn.com",BASE_ASSETS_PATH:"/"}.STORYBOOK_APP_CONFIG&&(n=JSON.parse({NODE_ENV:"production",SHORTLINK_DOMAIN:"hub.link",RETICULUM_SERVER:"dev.reticulum.io",THUMBNAIL_SERVER:"nearspark-dev.reticulum.io",CORS_PROXY_SERVER:"hubs-proxy.com",NON_CORS_PROXY_DOMAINS:"hubs.local,dev.reticulum.io,hubs-upload-cdn.com",BASE_ASSETS_PATH:"/"}.STORYBOOK_APP_CONFIG)),n||(n=window.APP_CONFIG),null!==(e=n)&&void 0!==e&&null!==(t=e.theme)&&void 0!==t&&t.error&&console.error(`Custom themes failed to load.\n${n.theme.error}\nIf you are an admin, reconfigure your themes in the admin panel.`),n})(),ut=(null==dt||null===(st=dt.theme)||void 0===st?void 0:st.themes)||[];function ht(){return void 0!==window.matchMedia?window.matchMedia("(prefers-color-scheme: dark)"):{matches:!1,addEventListener:()=>{},removeEventListener:()=>{}}}function pt(e){const t=ht();return t.addEventListener?t.addEventListener("change",e):t.addListener(e),[t,()=>{t.removeEventListener?t.removeEventListener("change",e):t.removeListener(e)}]}function mt(e){if(!Array.isArray(ut))return;const t=e&&ut.find((t=>t.id===e));return t||(ht().matches&&ut.find((e=>e.darkModeDefault))||ut.find((e=>e.default))||ut[0])}function ft(){var e,t;return mt(null===(e=ot.state)||void 0===e||null===(t=e.preferences)||void 0===t?void 0:t.theme)}function gt(e){var t;const n=ft();return(null==n||null===(t=n.variables)||void 0===t?void 0:t[e])||ct[e]}function vt(){const e=gt("action-color"),t=gt("action-color-highlight");document.querySelector("#rounded-text-button")&&(document.querySelector("#rounded-text-button").setAttribute("text-button",`textHoverColor: ${t}; textColor: ${e}; backgroundColor: #fff; backgroundHoverColor: #aaa;`),document.querySelector("#rounded-button").setAttribute("text-button",`textHoverColor: ${t}; textColor: ${e}; backgroundColor: #fff; backgroundHoverColor: #aaa;`),document.querySelector("#rounded-text-action-button").setAttribute("text-button",`textHoverColor: #fff; textColor: #fff; backgroundColor: ${e}; backgroundHoverColor: ${t}`),document.querySelector("#rounded-action-button").setAttribute("text-button",`textHoverColor: #fff; textColor: #fff; backgroundColor: ${e}; backgroundHoverColor: ${t}`))}function bt(e){ot.addEventListener("themechanged",e);const[t,n]=pt(e);return()=>{ot.removeEventListener("themechanged",e),n()}}L().then((()=>{({NODE_ENV:"production",SHORTLINK_DOMAIN:"hub.link",RETICULUM_SERVER:"dev.reticulum.io",THUMBNAIL_SERVER:"nearspark-dev.reticulum.io",CORS_PROXY_SERVER:"hubs-proxy.com",NON_CORS_PROXY_DOMAINS:"hubs.local,dev.reticulum.io,hubs-upload-cdn.com",BASE_ASSETS_PATH:"/"}).NODE||(k.APP_CONFIG&&k.APP_CONFIG.theme&&k.APP_CONFIG.theme["dark-theme"]?document.body.classList.add("dark-theme"):document.body.classList.add("light-theme"),vt(),bt(vt))})),n(55478);var yt=n.p+"assets/models/LoadingEnvironment-dbb8b37cc3bf422a5f53..glb";n(3400),AFRAME.utils.device.isMobile=K;var wt=n(99477),_t=n(11227),Et=n.n(_t);const At=new URLSearchParams(location.search),St=(0,z.Z)("debug"),xt=At.get("log_filter")||St&&"naf-janus-adapter:*,naf-dialog-adapter:*,mediasoup*";xt&&Et().enable(xt);const Mt=AFRAME.THREE;function Pt(e){const t=e.getContext();return t.getParameter(t.VERSION).split(" ")[1]}n(26684),n(68117);var Ct=n(82701);function kt(e,t){return void 0===t&&(t=!0),(n,i,r)=>{const o={dataType:i,data:r};n&&(o.clientId=n);const s="open"===e.socket.connectionState();if(s||t)if("um"===o.dataType?o.data.d.find((e=>e.isFirstSync)):o.data.isFirstSync)s?e.push("naf",o):e.push("naf",AFRAME.utils.clone(o));else{const t=AFRAME.utils.clone(o);if("um"===t.dataType)for(let e=0;e<t.data.d.length;e++)delete t.data.d[e].isFirstSync;else delete t.data.isFirstSync;e.push("nafr",{naf:JSON.stringify(t)})}}}var Ot=n(24251);(0,Ot.setDefaultSize)(1e4),(0,Ot.setRemovedRecycleThreshold)(.2);const Tt=Symbol("isStringType"),Rt=(0,Ot.defineComponent)({id:Ot.Types.ui32,creator:Ot.Types.ui32,owner:Ot.Types.ui32,lastOwnerTime:Ot.Types.ui32,timestamp:Ot.Types.ui32});Rt.id[Tt]=!0,Rt.creator[Tt]=!0,Rt.owner[Tt]=!0;const Dt=(0,Ot.defineComponent)(),jt=(0,Ot.defineComponent)(),Lt=(0,Ot.defineComponent)({capturedNid:Ot.Types.ui32,scale:[Ot.Types.f32,3]});Lt.capturedNid[Tt]=!0;const It=(0,Ot.defineComponent)({capturedNid:Ot.Types.ui32,scale:[Ot.Types.f32,3],mediaType:Ot.Types.ui8,bounds:[Ot.Types.f32,3],preview:Ot.Types.eid,previewingNid:Ot.Types.eid}),Nt=(0,Ot.defineComponent)(),Ft=(0,Ot.defineComponent)(),Bt=(0,Ot.defineComponent)({insets:[Ot.Types.ui32,4],size:[Ot.Types.f32,2]}),Vt=(0,Ot.defineComponent)({position:[Ot.Types.f32,3],rotation:[Ot.Types.f32,4],scale:[Ot.Types.f32,3]}),Ut=(0,Ot.defineComponent)(),Ht=(0,Ot.defineComponent)(),zt=(0,Ot.defineComponent)(),Wt=(0,Ot.defineComponent)(),qt=(0,Ot.defineComponent)(),Zt=(0,Ot.defineComponent)(),Gt=(0,Ot.defineComponent)(),Yt=(0,Ot.defineComponent)(),Qt=(0,Ot.defineComponent)(),Xt=(0,Ot.defineComponent)(),Kt=(0,Ot.defineComponent)(),$t=(0,Ot.defineComponent)(),Jt=(0,Ot.defineComponent)(),en=(0,Ot.defineComponent)(),tn=(0,Ot.defineComponent)(),nn=(0,Ot.defineComponent)(),rn=(0,Ot.defineComponent)(),on=(0,Ot.defineComponent)(),sn=(0,Ot.defineComponent)(),an=(0,Ot.defineComponent)(),ln=(0,Ot.defineComponent)(),cn=(0,Ot.defineComponent)(),dn=(0,Ot.defineComponent)(),un=(0,Ot.defineComponent)(),hn=(0,Ot.defineComponent)(),pn=(0,Ot.defineComponent)(),mn=(0,Ot.defineComponent)(),fn=(0,Ot.defineComponent)(),gn=(0,Ot.defineComponent)(),vn=(0,Ot.defineComponent)(),bn=(0,Ot.defineComponent)(),yn=(0,Ot.defineComponent)(),wn=(0,Ot.defineComponent)(),_n=(0,Ot.defineComponent)(),En=(0,Ot.defineComponent)(),An=(0,Ot.defineComponent)(),Sn=(0,Ot.defineComponent)(),xn=(0,Ot.defineComponent)({type:Ot.Types.ui8}),Mn=(0,Ot.defineComponent)({labelRef:Ot.Types.eid}),Pn=(0,Ot.defineComponent)(),Cn=(0,Ot.defineComponent)(),kn=(0,Ot.defineComponent)(),On=(0,Ot.defineComponent)(),Tn=(0,Ot.defineComponent)(),Rn=(0,Ot.defineComponent)(),Dn=(0,Ot.defineComponent)(),jn=(0,Ot.defineComponent)(),Ln=(0,Ot.defineComponent)({bodyId:Ot.Types.ui16,mass:Ot.Types.f32,gravity:[Ot.Types.f32,3],linearDamping:Ot.Types.f32,angularDamping:Ot.Types.f32,linearSleepingThreshold:Ot.Types.f32,angularSleepingThreshold:Ot.Types.f32,angularFactor:[Ot.Types.f32,3],type:Ot.Types.ui8,activationState:Ot.Types.ui8,collisionFilterGroup:Ot.Types.ui32,collisionFilterMask:Ot.Types.ui32,flags:Ot.Types.ui8}),In=(0,Ot.defineComponent)({bodyId:Ot.Types.ui16,shapeId:Ot.Types.ui16,type:Ot.Types.ui8,fit:Ot.Types.ui8,halfExtents:[Ot.Types.f32,3],minHalfExtent:Ot.Types.f32,maxHalfExtent:Ot.Types.f32,sphereRadius:Ot.Types.f32,cylinderAxis:Ot.Types.ui8,margin:Ot.Types.f32,offset:[Ot.Types.f32,3],orientation:[Ot.Types.f32,4],heightfieldData:[Ot.Types.f32],heightfieldDistance:Ot.Types.f32,flags:Ot.Types.ui8}),Nn=(0,Ot.defineComponent)(),Fn=(0,Ot.defineComponent)(),Bn=(0,Ot.defineComponent)(),Vn=(0,Ot.defineComponent)(),Un=(0,Ot.defineComponent)({flags:Ot.Types.ui8,releaseGravity:Ot.Types.f32}),Hn=(0,Ot.defineComponent)({flags:Ot.Types.ui8}),zn=(0,Ot.defineComponent)(),Wn=(0,Ot.defineComponent)({snapTime:Ot.Types.f32,state:Ot.Types.ui8,captureDurIdx:Ot.Types.ui8,trackTarget:Ot.Types.eid,snapMenuRef:Ot.Types.eid,nextButtonRef:Ot.Types.eid,prevButtonRef:Ot.Types.eid,snapRef:Ot.Types.eid,cancelRef:Ot.Types.eid,recVideoRef:Ot.Types.eid,screenRef:Ot.Types.eid,selfieScreenRef:Ot.Types.eid,cameraRef:Ot.Types.eid,countdownLblRef:Ot.Types.eid,captureDurLblRef:Ot.Types.eid,sndToggleRef:Ot.Types.eid}),qn=(0,Ot.defineComponent)(),Zn=(0,Ot.defineComponent)({src:Ot.Types.ui32,flags:Ot.Types.ui8});Zn.src[Tt]=!0;const Gn=(0,Ot.defineComponent)(),Yn=(0,Ot.defineComponent)(),Qn=(0,Ot.defineComponent)(),Xn=(0,Ot.defineComponent)({src:Ot.Types.ui32});Xn.src[Tt]=!0;const Kn=(0,Ot.defineComponent)({cacheKey:Ot.Types.ui32});Kn.cacheKey[Tt]=!0;const $n=(0,Ot.defineComponent)({pageNumber:Ot.Types.ui8}),Jn=(0,Ot.defineComponent)({pageNumber:Ot.Types.ui8});Jn.map=new Map;const ei=(0,Ot.defineComponent)({autoPlay:Ot.Types.ui8}),ti=(0,Ot.defineComponent)(),ni=(0,Ot.defineComponent)({time:Ot.Types.f32,flags:Ot.Types.ui8}),ii=(0,Ot.defineComponent)(),ri=(0,Ot.defineComponent)({videoRef:Ot.Types.eid,timeLabelRef:Ot.Types.eid,trackRef:Ot.Types.eid,headRef:Ot.Types.eid,playIndicatorRef:Ot.Types.eid,pauseIndicatorRef:Ot.Types.eid}),oi=(0,Ot.defineComponent)({flags:Ot.Types.ui8});oi.audios=new Map,oi.params=new Map;const si=(0,Ot.defineComponent)(),ai=(0,Ot.defineComponent)(),li=(0,Ot.defineComponent)();li.map=new Map;const ci=(0,Ot.defineComponent)({pinButtonRef:Ot.Types.eid,unpinButtonRef:Ot.Types.eid,cameraFocusButtonRef:Ot.Types.eid,cameraTrackButtonRef:Ot.Types.eid,removeButtonRef:Ot.Types.eid,dropButtonRef:Ot.Types.eid,inspectButtonRef:Ot.Types.eid,deserializeDrawingButtonRef:Ot.Types.eid,openLinkButtonRef:Ot.Types.eid,refreshButtonRef:Ot.Types.eid,cloneButtonRef:Ot.Types.eid,rotateButtonRef:Ot.Types.eid,mirrorButtonRef:Ot.Types.eid,scaleButtonRef:Ot.Types.eid,targetRef:Ot.Types.eid}),di=(0,Ot.defineComponent)({targetObjectRef:Ot.Types.eid,linkButtonRef:Ot.Types.eid}),ui=(0,Ot.defineComponent)(),hi=(0,Ot.defineComponent)({url:Ot.Types.ui32});hi.url[Tt]=!0;const pi=(0,Ot.defineComponent)({prevButtonRef:Ot.Types.eid,nextButtonRef:Ot.Types.eid,pageLabelRef:Ot.Types.eid,targetRef:Ot.Types.eid,clearTargetTimer:Ot.Types.f64}),mi=(0,Ot.defineComponent)(),fi=(0,Ot.defineComponent)(),gi=(0,Ot.defineComponent)({ref:Ot.Types.eid}),vi=(0,Ot.defineComponent)({flags:Ot.Types.ui8}),bi=(0,Ot.defineComponent)({occupied:Ot.Types.ui8}),yi=(0,Ot.defineComponent)(),wi=(0,Ot.defineComponent)(),_i=(0,Ot.defineComponent)({src:Ot.Types.ui32,flags:Ot.Types.ui8}),Ei=(0,Ot.defineComponent)({onlyY:Ot.Types.ui8}),Ai=(0,Ot.defineComponent)(),Si=(0,Ot.defineComponent)({speed:[Ot.Types.f32,2],increment:[Ot.Types.f32,2],offset:[Ot.Types.f32,2]}),xi=(0,Ot.defineComponent)({fps:Ot.Types.ui8,resolution:[Ot.Types.ui16,2]}),Mi=(0,Ot.defineComponent)({source:Ot.Types.eid,flags:Ot.Types.ui8}),Pi=(0,Ot.defineComponent)(),Ci=(0,Ot.defineComponent)(),ki=(0,Ot.defineComponent)({src:Ot.Types.ui32}),Oi=(0,Ot.defineComponent)({flags:Ot.Types.ui8}),Ti=(0,Ot.defineComponent)({minDelay:Ot.Types.ui32,maxDelay:Ot.Types.ui32,source:Ot.Types.eid,flags:Ot.Types.ui8}),Ri=(0,Ot.defineComponent)({flags:Ot.Types.ui8}),Di=(0,Ot.defineComponent)(),ji=(0,Ot.defineComponent)({duration:Ot.Types.f32,positionOnly:Ot.Types.ui8}),Li=(0,Ot.defineComponent)({duration:Ot.Types.f32,targetX:Ot.Types.f32,targetY:Ot.Types.f32,targetZ:Ot.Types.f32}),Ii=(0,Ot.defineComponent)({duration:Ot.Types.f32,targetX:Ot.Types.f32,targetY:Ot.Types.f32,targetZ:Ot.Types.f32,targetW:Ot.Types.f32}),Ni=(0,Ot.defineComponent)({duration:Ot.Types.f32,targetX:Ot.Types.f32,targetY:Ot.Types.f32,targetZ:Ot.Types.f32});function Fi(e){const t=e.sceneEl.is("frozen"),n=e.components.pinnable&&e.components.pinnable.data.pinned,i=!!e.components["super-spawner"],r=i&&"#interactable-emoji"===e.components["super-spawner"].data.template,o=(e.components.emoji||r?window.APP.hubChannel.can("spawn_emoji"):window.APP.hubChannel.can("spawn_and_move_media"))&&(!n||window.APP.hubChannel.can("pin_objects"));return(i||!n||t)&&o}function Bi(e,t){const n="string"==typeof e,i=n?e:e.component;return n?t.components.findIndex((e=>e===i)):t.components.findIndex((t=>t.component===i&&t.property===e.property))}let Vi=null;function Ui(e,t,n){const{template:i,creator:r,isPinned:o}=e,s=t===r;return!(!i.endsWith("-waypoint-avatar")&&!i.endsWith("-media-frame"))||(i.endsWith("-avatar")?s:i.endsWith("-media")?(!o||n.pin_objects)&&(s||n.spawn_and_move_media):i.endsWith("-camera")?s||n.spawn_camera:i.endsWith("-pen")||i.endsWith("-drawing")?s||n.spawn_drawing:!!i.endsWith("-emoji")&&(s||n.spawn_emoji))}function Hi(e){const t=NAF.connection.adapter.getPendingDataForNetworkId(e);if(t){if(t.owner&&!window.APP.hubChannel.presence.state[t.owner])return;const{template:e,creator:n}=t,i=NAF.schemas.schemaDict[e],r=t.components[Bi("pinnable",i)];return{template:e,creator:n,isPinned:r&&r.pinned}}const n=NAF.entities.getEntity(e);if(!n)return null;const{template:i,creator:r}=n.components.networked.data;return{template:i,creator:r,isPinned:n.components.pinnable&&n.components.pinnable.data.pinned}}function zi(e,t,n){const i=Hi(e.networkId);if(!i)return!1;if(Ui(i,t,n))return!0;{const{template:t}=i;return function(e,t){null===Vi&&function(){Vi={};const{schemaDict:e}=NAF.schemas;for(const t in e){if(!Object.prototype.hasOwnProperty.call(e,t))continue;const n=e[t];Vi[t]=(n.nonAuthorizedComponents||[]).map((e=>Bi(e,n))).map((e=>e.toString()))}}();const n=Vi[e];for(const e in t.components)Object.prototype.hasOwnProperty.call(t.components,e)&&(n.includes(e)||(t.components[e]=null))}(t,e),!0}}const Wi={};function qi(e,t){if(Wi[t.networkId]){const e=Wi[t.networkId].data,n=e.components;Object.assign(e,t),e.components=Object.assign(n,t.components)}else Wi[t.networkId]={dataType:"u",data:t,clientId:e.clientId,from_session_id:e.from_session_id}}const Zi={};function Gi(e){Wi[e]&&(NAF.connection.adapter.handleIncomingNAF(Wi[e]),delete Wi[e])}function Yi(e,t,n,i,r,o,s){try{var a=e[o](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(i,r)}function Qi(e){return function(){var t=this,n=arguments;return new Promise((function(i,r){var o=e.apply(t,n);function s(e){Yi(o,i,r,s,a,"next",e)}function a(e){Yi(o,i,r,s,a,"throw",e)}s(void 0)}))}}const Xi=function(){var e=Qi((function*(){const e=Date.now(),t=new Date((yield fetch(document.location.href,{method:"HEAD",cache:"no-cache"})).headers.get("Date")).getTime()+500,n=Date.now();return t+(n-e)/2-n}));return function(){return e.apply(this,arguments)}}(),Ki=(()=>{let e=0;const t=[];let n=0;const i=function(){var r=Qi((function*(){t[n%10]=yield Xi(),n+=1,e=t.reduce(((e,t)=>e+t),0)/t.length,10==t.length?setTimeout(i,3e5):i()}));return function(){return r.apply(this,arguments)}}();return i(),()=>e})();function $i(){return Date.now()+Ki()}function Ji(){return new Promise((e=>{setTimeout(e,0)}))}function er(e){e.components["animation-mixer"]&&(e.querySelector("[loop-animation]")||e.setAttribute("loop-animation",""))}NAF.adapters.register("phoenix",class{constructor(){this.handleIncomingNAF=e=>{const t=function(e){const{dataType:t,from_session_id:n}=e;if("u"===t&&e.data.isFirstSync&&!e.data.persistent)return e;const i=window.APP.hubChannel.presence.state[n];if(!i)return Zi;const r=i.metas[0].permissions;if("um"===t){let t=!1,i=!1;for(const o in e.data.d){if(!Object.prototype.hasOwnProperty.call(e.data.d,o))continue;const s=e.data.d[o];s.persistent&&!NAF.entities.getEntity(s.networkId)?(qi(e,s),e.data.d[o]=null,i=!0):zi(s,n,r)||(e.data.d[o]=null,t=!0)}return(t||i)&&(e.data.d=e.data.d.filter((e=>null!=e))),e}if("u"===t)return e.data.persistent&&!NAF.entities.getEntity(e.data.networkId)?(Wi[e.data.networkId]=e,Zi):zi(e.data,n,r)?e:Zi;if("r"===t){const t=Hi(e.data.networkId);return t&&Ui(t,n,r)?e:Zi}return e}(e);t.dataType&&(t.source="phx-reliable",!this.frozen||"um"!==t.dataType&&"u"!==t.dataType?this.nafMessageReceived(t.from_session_id,t.dataType,t.data,t.source):this.storeMessage(t))},this.refs=new Map,this.frozenUpdates=new Map,this._blockedClients=new Map}setServerUrl(){}setApp(){}setRoom(){}setWebRtcOptions(){}setServerConnectListeners(e,t){this.nafConnectSuccess=e,this.nafConnectFailed=t}setRoomOccupantListener(){}setDataChannelListeners(e,t,n){this.nafOccupantJoined=e,this.nafOccupantLeave=t,this.nafMessageReceived=n}connect(){var e=this;return Qi((function*(){e.refs.set("naf",e.hubChannel.channel.on("naf",e.handleIncomingNAF)),e.refs.set("nafr",e.hubChannel.channel.on("nafr",(t=>{let{parsed:n}=t;e.handleIncomingNAF(n)}))),e.nafConnectSuccess(e.session_id),e.reliableTransport=kt(e.hubChannel.channel,!0),e.unreliableTransport=kt(e.hubChannel.channel,!1),e.hubChannel.presence.list((e=>e)).forEach(e.nafOccupantJoined),e.refs.set("hub:join",e.events.on("hub:join",(t=>{let{key:n}=t;return e.nafOccupantJoined(n)}))),e.refs.set("hub:leave",e.events.on("hub:leave",(t=>{let{key:n}=t;return e.nafOccupantLeave(n)})))}))()}shouldStartConnectionTo(){}startStreamConnection(){}closeStreamConnection(){}getConnectStatus(){}getMediaStream(){return Promise.reject("getMediaStream not implemented in phoenix-adapter")}getServerTime(){return $i()}sendData(e,t,n){this.unreliableTransport(e,t,n)}sendDataGuaranteed(e,t,n){this.reliableTransport(e,t,n)}broadcastData(e,t){this.unreliableTransport(void 0,e,t)}broadcastDataGuaranteed(e,t){this.reliableTransport(void 0,e,t)}disconnect(){this.hubChannel.presence.list((e=>e)).forEach(this.nafOccupantLeave),this.hubChannel.channel.off("naf",this.refs.get("naf")),this.hubChannel.channel.off("nafr",this.refs.get("nafr")),this.events.off("hub:join",this.refs.get("hub:join")),this.events.off("hub:leave",this.refs.get("hub:leave")),this.refs.delete("naf"),this.refs.delete("nafr"),this.refs.delete("hub:join"),this.refs.delete("hub:leave")}toggleFreeze(){this.frozen?this.unfreeze():this.freeze()}freeze(){this.frozen=!0}unfreeze(){this.frozen=!1,this.flushPendingUpdates()}flushPendingUpdates(){for(const[e,t]of this.frozenUpdates){const n=this.getPendingData(e,t);if(!n)continue;const i="um"===t.dataType?"u":t.dataType;this.nafMessageReceived(null,i,n,t.source)}this.frozenUpdates.clear()}getPendingData(e,t){if(!t)return null;const n="um"===t.dataType?this.dataForUpdateMultiMessage(e,t):t.data;return n.owner&&this._blockedClients.has(n.owner)?null:n}getPendingDataForNetworkId(e){return this.getPendingData(e,this.frozenUpdates.get(e))}storeMessage(e){if("um"===e.dataType)for(let t=0,n=e.data.d.length;t<n;t++)this.storeSingleMessage(e,t);else this.storeSingleMessage(e)}storeSingleMessage(e,t){const n=void 0!==t?e.data.d[t]:e.data,i=e.dataType,r=n.networkId;if(this.frozenUpdates.has(r)){const t=this.frozenUpdates.get(r),o="um"===t.dataType?this.dataForUpdateMultiMessage(r,t):t.data,s=n.lastOwnerTime<o.lastOwnerTime,a=n.lastOwnerTime===o.lastOwnerTime;if(s||a&&o.owner>n.owner)return;"r"===i?o&&o.isFirstSync?this.frozenUpdates.delete(r):this.frozenUpdates.set(r,e):o.components&&n.components&&Object.assign(o.components,n.components)}else this.frozenUpdates.set(r,e)}dataForUpdateMultiMessage(e,t){for(let n=0,i=t.data.d.length;n<i;n++){const i=t.data.d[n];if(i.networkId===e)return i}return null}block(e){this._blockedClients.set(e,!0)}unblock(e){this._blockedClients.delete(e)}});var tr=n(50960),nr=n(99293),ir=n(26729),rr=n.n(ir);function or(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function sr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?or(Object(n),!0).forEach((function(t){ar(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):or(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function ar(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function lr(e,t,n,i,r,o,s){try{var a=e[o](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(i,r)}function cr(e){return function(){var t=this,n=arguments;return new Promise((function(i,r){var o=e.apply(t,n);function s(e){lr(o,i,r,s,a,"next",e)}function a(e){lr(o,i,r,s,a,"throw",e)}s(void 0)}))}}const dr=(0,_t.debug)("naf-dialog-adapter:debug"),ur=(0,_t.debug)("naf-dialog-adapter:error"),hr=(0,_t.debug)("naf-dialog-adapter:info"),pr={optional:[{googDscp:!0}]},mr=[{scaleResolutionDownBy:4,maxBitrate:5e5},{scaleResolutionDownBy:2,maxBitrate:1e6},{scaleResolutionDownBy:1,maxBitrate:5e6}],fr=[{dtx:!0,maxBitrate:15e5},{dtx:!0,maxBitrate:6e6}],gr="dialog-connection-connected",vr="dialog-connection-error-fatal";class br extends(rr()){constructor(){super(),this._micShouldBeEnabled=!1,this._micProducer=null,this._cameraProducer=null,this._shareProducer=null,this._localMediaStream=null,this._consumers=new Map,this._pendingMediaRequests=new Map,this._blockedClients=new Map,this._forceTcp=!1,this._forceTurn=!1,this._iceTransportPolicy=null,this.scene=null,this._serverParams={},this._consumerStats={}}get consumerStats(){return this._consumerStats}get downlinkBwe(){return this._downlinkBwe}getIceServers(e,t,n){const i=[];return this._serverUrl=`wss://${e}:${t}`,n&&n.enabled?(n.transports.forEach((t=>{this._forceTcp||i.push({urls:`turns:${e}:${t.port}`,username:n.username,credential:n.credential}),i.push({urls:`turns:${e}:${t.port}?transport=tcp`,username:n.username,credential:n.credential})})),i.push({urls:"stun:stun1.l.google.com:19302"})):i.push({urls:"stun:stun1.l.google.com:19302"},{urls:"stun:stun2.l.google.com:19302"}),i}getServerStats(){var e=this;return cr((function*(){if(!e._protoo.connected)return;const t={};try{var n,i;if(null===(n=e._sendTransport)||void 0===n||!n._closed){const n=t[e._sendTransport.id]={};n.name="Send",n.stats=yield e._protoo.request("getTransportStats",{transportId:e._sendTransport.id}),t[e._sendTransport.id].producers={};for(const n of e._sendTransport._producers){const i=n[0];t[e._sendTransport.id].producers[i]=yield e._protoo.request("getProducerStats",{producerId:i})}}if(null===(i=e._recvTransport)||void 0===i||!i._closed){const n=t[e._recvTransport.id]={};n.name="Receive",n.stats=yield e._protoo.request("getTransportStats",{transportId:e._recvTransport.id}),t[e._recvTransport.id].consumers={};for(const n of e._recvTransport._consumers){const i=n[0];t[e._recvTransport.id].consumers[i]=yield e._protoo.request("getConsumerStats",{consumerId:i})}}return t}catch(t){return e.emitRTCEvent("error","Adapter",(()=>`Error getting the server status: ${t}`)),{error:`Error getting the server status: ${t}`}}}))()}iceRestart(e){var t=this;return cr((function*(){t.emitRTCEvent("log","RTC",(()=>`Restarting ${e.id===t._sendTransport.id?"send":"receive"} transport ICE`));const n=yield t._protoo.request("restartIce",{transportId:e.id});yield e.restartIce({iceParameters:n})}))()}recreateSendTransport(e){var t=this;return cr((function*(){t.emitRTCEvent("log","RTC",(()=>"Recreating send transport ICE")),yield t.closeSendTransport(),yield t.createSendTransport(e)}))()}restartSendICE(){var e=this;return cr((function*(){if(e._protoo&&e._protoo.connected)try{var t;if(null!==(t=e._sendTransport)&&void 0!==t&&t._closed){const{host:t,port:n,turn:i}=e._serverParams,r=e.getIceServers(t,n,i);yield e.recreateSendTransport(r)}else yield e.iceRestart(e._sendTransport)}catch(t){e.emitRTCEvent("error","RTC",(()=>`Send transport [recreate] failed: ${t}`))}}))()}checkSendIceStatus(e){"failed"===e&&this.restartSendICE()}recreateRecvTransport(e){var t=this;return cr((function*(){t.emitRTCEvent("log","RTC",(()=>"Recreating receive transport ICE")),yield t.closeRecvTransport(),yield t.createRecvTransport(e),yield t._protoo.request("refreshConsumers")}))()}restartRecvICE(){var e=this;return cr((function*(){if(e._protoo&&e._protoo.connected)try{var t;if(null!==(t=e._recvTransport)&&void 0!==t&&t._closed){const{host:t,port:n,turn:i}=e._serverParams,r=e.getIceServers(t,n,i);yield e.recreateRecvTransport(r)}else yield e.iceRestart(e._recvTransport)}catch(t){e.emitRTCEvent("error","RTC",(()=>`Receive transport [recreate] failed: ${t}`))}}))()}checkRecvIceStatus(e){"failed"===e&&this.restartRecvICE()}connect(e){var t=this;let{serverUrl:n,roomId:i,serverParams:r,scene:o,clientId:s,forceTcp:a,forceTurn:l,iceTransportPolicy:c}=e;return cr((function*(){t._serverUrl=n,t._roomId=i,t._serverParams=r,t._clientId=s,t.scene=o,t._forceTcp=a,t._forceTurn=l,t._iceTransportPolicy=c;const e=new URL(t._serverUrl);e.searchParams.append("roomId",t._roomId),e.searchParams.append("peerId",t._clientId);const d=new nr.qo(e.toString(),{retry:{retries:2}});return t._protoo=new nr._z(d),t._protoo.on("disconnected",(()=>{t.emitRTCEvent("info","Signaling",(()=>"Disconnected")),t.cleanUpLocalState()})),t._protoo.on("failed",(e=>{t.emitRTCEvent("error","Signaling",(()=>`Failed: ${e}, retrying...`))})),t._protoo.on("close",cr((function*(){t.emitRTCEvent("error","Signaling",(()=>"Closed")),t._retryConnectWithNewHost()}))),t._protoo.on("request",function(){var e=cr((function*(e,n,i){var r;switch(t.emitRTCEvent("info","Signaling",(()=>{var t;return`Request [${e.method}]: ${null===(t=e.data)||void 0===t?void 0:t.id}`})),dr('proto "request" event [method:%s, data:%o]',e.method,null===(r=e.data)||void 0===r?void 0:r.id),e.method){case"newConsumer":{const{peerId:i,producerId:r,id:o,kind:s,rtpParameters:a,appData:l}=e.data;try{const e=yield t._recvTransport.consume({id:o,producerId:r,kind:s,rtpParameters:a,appData:sr(sr({},l),{},{peerId:i})});if(t._consumers.set(e.id,e),e.on("transportclose",(()=>{t.emitRTCEvent("error","RTC",(()=>"Consumer transport closed")),t.removeConsumer(e.id)})),"video"===s){const{spatialLayers:n,temporalLayers:i}=tr.parseScalabilityMode(e.rtpParameters.encodings[0].scalabilityMode);t._consumerStats[e.id]=t._consumerStats[e.id]||{},t._consumerStats[e.id].spatialLayers=n,t._consumerStats[e.id].temporalLayers=i}n(),t.resolvePendingMediaRequestForTrack(i,e.track),t.emit("stream_updated",i,s)}catch(e){throw t.emitRTCEvent("error","Adapter",(()=>`Error: ${e}`)),ur('"newConsumer" request failed:%o',e),e}break}}}));return function(t,n,i){return e.apply(this,arguments)}}()),t._protoo.on("notification",(e=>{switch(dr('proto "notification" event [method:%s, data:%o]',e.method,e.data),e.method){case"newPeer":break;case"peerClosed":{const{peerId:n}=e.data;t.closePeer(n);break}case"consumerClosed":{const{consumerId:n}=e.data,i=t._consumers.get(n);if(!i){hr(`consumerClosed event received without related consumer: ${n}`);break}i.close(),t.removeConsumer(i.id);break}case"peerBlocked":{const{peerId:t}=e.data;document.body.dispatchEvent(new CustomEvent("blocked",{detail:{clientId:t}}));break}case"peerUnblocked":{const{peerId:t}=e.data;document.body.dispatchEvent(new CustomEvent("unblocked",{detail:{clientId:t}}));break}case"downlinkBwe":t._downlinkBwe=e.data;break;case"consumerLayersChanged":{const{consumerId:n,spatialLayer:i,temporalLayer:r}=e.data;if(!t._consumers.get(n)){hr(`consumerLayersChanged event received without related consumer: ${n}`);break}t._consumerStats[n]=t._consumerStats[n]||{},t._consumerStats[n].spatialLayer=i,t._consumerStats[n].temporalLayer=r;break}case"consumerScore":{const{consumerId:n,score:i}=e.data;if(!t._consumers.get(n)){hr(`consumerScore event received without related consumer: ${n}`);break}t._consumerStats[n]=t._consumerStats[n]||{},t._consumerStats[n].score=i}}})),new Promise(((e,n)=>{t._protoo.on("open",cr((function*(){t.emitRTCEvent("info","Signaling",(()=>"Open"));try{yield t._joinRoom(),e(),t.emit(gr)}catch(e){t.emitRTCEvent("warn","Adapter",(()=>`Error during connect: ${ur}`)),n(e),t.emit(vr)}})))}))}))()}_retryConnectWithNewHost(){var e=this;return cr((function*(){e.cleanUpLocalState(),e._protoo.removeAllListeners();const t=yield APP.hubChannel.getHost(),{host:n,port:i}=t,r=`wss://${n}:${i}`;if(e._serverUrl===r)return console.error("Reconnect to dialog failed."),void e.emit(vr);console.log(`The Dialog server has changed to ${r}, reconnecting with the new server...`),yield e.connect({serverUrl:r,roomId:e._roomId,serverParams:t,scene:e.scene,clientId:e._clientId,forceTcp:e._forceTcp,forceTurn:e._forceTurn,iceTransportPolicy:e._iceTransportPolicy})}))()}closePeer(e){const t=this._pendingMediaRequests.get(e);t&&(hr("The user disconnected before the media stream was resolved."),t.audio&&t.audio.resolve(null),t.video&&t.video.resolve(null),this._pendingMediaRequests.delete(e))}resolvePendingMediaRequestForTrack(e,t){const n=this._pendingMediaRequests.get(e);if(n&&n[t.kind]){const e=n[t.kind].resolve;delete n[t.kind],e(new MediaStream([t]))}n&&0===Object.keys(n).length&&this._pendingMediaRequests.delete(e)}removeConsumer(e){this.emitRTCEvent("info","RTC",(()=>`Consumer removed: ${e}`)),this._consumers.delete(e)}getMediaStream(e,t){let n;if(void 0===t&&(t="audio"),this._clientId===e?"audio"===t&&this._micProducer?n=this._micProducer.track:"video"===t&&(this._cameraProducer&&!this._cameraProducer.closed?n=this._cameraProducer.track:this._shareProducer&&!this._shareProducer.closed&&(n=this._shareProducer.track)):this._consumers.forEach((i=>{i.appData.peerId===e&&t==i.track.kind&&(n=i.track)})),n)return dr(`Already had ${t} for ${e}`),Promise.resolve(new MediaStream([n]));{dr(`Waiting on ${t} for ${e}`),this._pendingMediaRequests.has(e)||this._pendingMediaRequests.set(e,{});const n=this._pendingMediaRequests.get(e),i=new Promise(((e,i)=>n[t]={resolve:e,reject:i}));return n[t].promise=i,i.catch((t=>{this.emitRTCEvent("error","Adapter",(()=>`getMediaStream error: ${t}`)),console.warn(`${e} getMediaStream Error`,t)})),i}}createSendTransport(e){var t=this;return cr((function*(){const n=yield t._protoo.request("createWebRtcTransport",{producing:!0,consuming:!1,sctpCapabilities:void 0});t._sendTransport=t._mediasoupDevice.createSendTransport({id:n.id,iceParameters:n.iceParameters,iceCandidates:n.iceCandidates,dtlsParameters:n.dtlsParameters,sctpParameters:n.sctpParameters,iceServers:e,iceTransportPolicy:t._iceTransportPolicy,proprietaryConstraints:pr}),t._sendTransport.on("connect",((e,n,i)=>{let{dtlsParameters:r}=e;t.emitRTCEvent("info","RTC",(()=>"Send transport [connect]")),t._sendTransport.observer.on("close",(()=>{t.emitRTCEvent("info","RTC",(()=>"Send transport [close]"))})),t._sendTransport.observer.on("newproducer",(e=>{t.emitRTCEvent("info","RTC",(()=>`Send transport [newproducer]: ${e.id}`))})),t._sendTransport.observer.on("newconsumer",(e=>{t.emitRTCEvent("info","RTC",(()=>`Send transport [newconsumer]: ${e.id}`))})),t._protoo.request("connectWebRtcTransport",{transportId:t._sendTransport.id,dtlsParameters:r}).then(n).catch(i)})),t._sendTransport.on("connectionstatechange",(e=>{let n="info";"failed"!==e&&"disconnected"!==e||(n="error"),t.emitRTCEvent(n,"RTC",(()=>`Send transport [connectionstatechange]: ${e}`)),t.checkSendIceStatus(e)})),t._sendTransport.on("produce",function(){var e=cr((function*(e,n,i){let{kind:r,rtpParameters:o,appData:s}=e;t.emitRTCEvent("info","RTC",(()=>`Send transport [produce]: ${r}`));try{const{id:e}=yield t._protoo.request("produce",{transportId:t._sendTransport.id,kind:r,rtpParameters:o,appData:s});n({id:e})}catch(e){t.emitRTCEvent("error","Signaling",(()=>`[produce] error: ${e}`)),i(e)}}));return function(t,n,i){return e.apply(this,arguments)}}())}))()}closeSendTransport(){var e=this;return cr((function*(){var t,n,i,r,o,s;e._micProducer&&(e._micProducer.close(),(null===(i=e._protoo)||void 0===i?void 0:i.connected)&&(null===(r=e._protoo)||void 0===r||r.request("closeProducer",{producerId:e._micProducer.id})),e._micProducer=null),e._videoProducer&&(e._videoProducer.close(),(null===(o=e._protoo)||void 0===o?void 0:o.connected)&&(null===(s=e._protoo)||void 0===s||s.request("closeProducer",{producerId:e._videoProducer.id})),e._videoProducer=null);const a=null===(t=e._sendTransport)||void 0===t?void 0:t.id;if(e._sendTransport&&!e._sendTransport._closed&&(e._sendTransport.close(),e._sendTransport=null),null!==(n=e._protoo)&&void 0!==n&&n.connected)try{yield e._protoo.request("closeWebRtcTransport",{transportId:a})}catch(e){ur(e)}}))()}createRecvTransport(e){var t=this;return cr((function*(){const n=yield t._protoo.request("createWebRtcTransport",{producing:!1,consuming:!0,sctpCapabilities:void 0});t._recvTransport=t._mediasoupDevice.createRecvTransport({id:n.id,iceParameters:n.iceParameters,iceCandidates:n.iceCandidates,dtlsParameters:n.dtlsParameters,sctpParameters:n.sctpParameters,iceServers:e,iceTransportPolicy:t._iceTransportPolicy}),t._recvTransport.on("connect",((e,n,i)=>{let{dtlsParameters:r}=e;t.emitRTCEvent("info","RTC",(()=>"Receive transport [connect]")),t._recvTransport.observer.on("close",(()=>{t.emitRTCEvent("info","RTC",(()=>"Receive transport [close]"))})),t._recvTransport.observer.on("newproducer",(e=>{t.emitRTCEvent("info","RTC",(()=>`Receive transport [newproducer]: ${e.id}`))})),t._recvTransport.observer.on("newconsumer",(e=>{t.emitRTCEvent("info","RTC",(()=>`Receive transport [newconsumer]: ${e.id}`))})),t._protoo.request("connectWebRtcTransport",{transportId:t._recvTransport.id,dtlsParameters:r}).then(n).catch(i)})),t._recvTransport.on("connectionstatechange",(e=>{let n="info";"failed"!==e&&"disconnected"!==e||(n="error"),t.emitRTCEvent(n,"RTC",(()=>`Receive transport [connectionstatechange]: ${e}`)),t.checkRecvIceStatus(e)}))}))()}closeRecvTransport(){var e=this;return cr((function*(){var t,n;const i=null===(t=e._recvTransport)||void 0===t?void 0:t.id;if(e._recvTransport&&!e._recvTransport._closed&&(e._recvTransport.close(),e._recvTransport=null),null!==(n=e._protoo)&&void 0!==n&&n.connected)try{yield e._protoo.request("closeWebRtcTransport",{transportId:i})}catch(e){ur(e)}}))()}_joinRoom(){var e=this;return cr((function*(){dr("_joinRoom()"),e._mediasoupDevice=new tr.Device({});const t=yield e._protoo.request("getRouterRtpCapabilities");yield e._mediasoupDevice.load({routerRtpCapabilities:t});const{host:n,port:i,turn:r}=e._serverParams,o=e.getIceServers(n,i,r);yield e.createSendTransport(o),yield e.createRecvTransport(o),yield e._protoo.request("join",{displayName:e._clientId,device:e._device,rtpCapabilities:e._mediasoupDevice.rtpCapabilities,sctpCapabilities:e._useDataChannel?e._mediasoupDevice.sctpCapabilities:void 0,token:APP.hubChannel.token}),e._localMediaStream&&(yield e.setLocalMediaStream(e._localMediaStream))}))()}setLocalMediaStream(e){var t=this;return cr((function*(){if(!t._sendTransport)return void console.error("Tried to setLocalMediaStream before a _sendTransport existed");t.emitRTCEvent("info","RTC",(()=>"Creating missing producers"));let n=!1,i=!1;yield Promise.all(e.getTracks().map(function(){var e=cr((function*(e){"audio"===e.kind?(n=!0,t._micProducer?t._micProducer.track!==e&&(t._micProducer.track.stop(),t._micProducer.replaceTrack(e)):(t._micProducer=yield t._sendTransport.produce({track:e,pause:!t._micShouldBeEnabled,stopTracks:!1,codecOptions:{opusStereo:!1,opusDtx:!0},zeroRtpOnPause:!0,disableTrackOnPause:!0}),t._micProducer.on("transportclose",(()=>{t.emitRTCEvent("info","RTC",(()=>"Mic transport closed")),t._micProducer=null})),t.emit("mic-state-changed",{enabled:t.isMicEnabled}))):(i=!0,e._hubs_contentHint===Be.SCREEN?(yield t.disableCamera(),yield t.enableShare(e)):e._hubs_contentHint===Be.CAMERA&&(yield t.disableShare(),yield t.enableCamera(e))),t.resolvePendingMediaRequestForTrack(t._clientId,e)}));return function(t){return e.apply(this,arguments)}}())),!n&&t._micProducer&&(t._protoo.request("closeProducer",{producerId:t._micProducer.id}),t._micProducer.close(),t._micProducer=null),i||(t.disableCamera(),t.disableShare()),t._localMediaStream=e}))()}enableCamera(e){var t=this;return cr((function*(){t._cameraProducer=yield t._sendTransport.produce({track:e,stopTracks:!1,codecOptions:{videoGoogleStartBitrate:1e3},encodings:mr,zeroRtpOnPause:!0,disableTrackOnPause:!0}),t._cameraProducer.on("transportclose",(()=>{t.emitRTCEvent("info","RTC",(()=>"Camera transport closed")),t.disableCamera()})),t._cameraProducer.observer.on("trackended",(()=>{t.emitRTCEvent("info","RTC",(()=>"Camera track ended")),t.disableCamera()}))}))()}disableCamera(){var e=this;return cr((function*(){if(e._cameraProducer){e._cameraProducer.close();try{e._sendTransport.closed||(yield e._protoo.request("closeProducer",{producerId:e._cameraProducer.id}))}catch(e){console.error(`disableCamera(): ${e}`)}e._cameraProducer=null}}))()}enableShare(e){var t=this;return cr((function*(){t._shareProducer=yield t._sendTransport.produce({track:e,stopTracks:!1,codecOptions:{videoGoogleStartBitrate:1e3},encodings:fr,zeroRtpOnPause:!0,disableTrackOnPause:!0,appData:{share:!0}}),t._shareProducer.on("transportclose",(()=>{t.emitRTCEvent("info","RTC",(()=>"Desktop Share transport closed")),t.disableShare()})),t._shareProducer.observer.on("trackended",(()=>{t.emitRTCEvent("info","RTC",(()=>"Desktop Share transport track ended")),t.disableShare()}))}))()}disableShare(){var e=this;return cr((function*(){if(e._shareProducer){e._shareProducer.close();try{e._sendTransport.closed||(yield e._protoo.request("closeProducer",{producerId:e._shareProducer.id}))}catch(e){console.error(`disableShare(): ${e}`)}e._shareProducer=null}}))()}toggleMicrophone(){this.isMicEnabled?this.enableMicrophone(!1):this.enableMicrophone(!0)}enableMicrophone(e){this._micProducer?(e&&!this.isMicEnabled?(this._micProducer.resume(),this._protoo.request("resumeProducer",{producerId:this._micProducer.id})):!e&&this.isMicEnabled&&(this._micProducer.pause(),this._protoo.request("pauseProducer",{producerId:this._micProducer.id})),this._micShouldBeEnabled=e,this.emit("mic-state-changed",{enabled:this.isMicEnabled})):console.error("Tried to toggle mic but there's no producer.")}get isMicEnabled(){return this._micProducer&&!this._micProducer.paused}cleanUpLocalState(){this._sendTransport&&this._sendTransport.close(),this._sendTransport=null,this._recvTransport&&this._recvTransport.close(),this._recvTransport=null,this._micProducer=null,this._shareProducer=null,this._cameraProducer=null}disconnect(){dr("disconnect()"),this.cleanUpLocalState(),this._protoo&&(this._protoo.removeAllListeners(),this._protoo.connected&&(this._protoo.close(),this.emitRTCEvent("info","Signaling",(()=>"[close]"))))}kick(e){return this._protoo.request("kick",{room_id:this.room,user_id:e,token:APP.hubChannel.token}).then((()=>{document.body.dispatchEvent(new CustomEvent("kicked",{detail:{clientId:e}}))}))}block(e){return this._protoo.request("block",{whom:e}).then((()=>{this._blockedClients.set(e,!0),document.body.dispatchEvent(new CustomEvent("blocked",{detail:{clientId:e}}))}))}unblock(e){return this._protoo.request("unblock",{whom:e}).then((()=>{this._blockedClients.delete(e),document.body.dispatchEvent(new CustomEvent("unblocked",{detail:{clientId:e}}))}))}emitRTCEvent(e,t,n){if(!window.APP.store.state.preferences.showRtcDebugPanel)return;const i=(new Date).toLocaleTimeString("en-US",{hour12:!1,hour:"numeric",minute:"numeric",second:"numeric"});this.scene.emit("rtc_event",{level:e,tag:t,time:i,msg:n()})}}let yr=null;const wr=new Map,_r=(0,Ot.defineQuery)([Rt]),Er=new Set,Ar=new Set,Sr=[],xr=[],Mr=[],Pr=[],Cr=new Set;function kr(e){return wr.has(e)}function Or(e){return Rt.creator[e]===APP.getSid("reticulum")}function Tr(e){return Rt.creator[e]===APP.getSid(NAF.clientId)}const Rr=1e3/12,Dr=Object.getOwnPropertySymbols(Lt.scale).find((e=>"parentArray"==e.description)),jr=Object.getOwnPropertySymbols(Lt).find((e=>"storeFlattened"==e.description)),Lr=(e,t)=>{if(ArrayBuffer.isView(e))e[t]=e.slice(0);else{const n=e[Dr].slice(0);e[t]=e.map(((t,i)=>{const{length:r}=e[i],o=r*i,s=o+r;return n.subarray(o,s)}))}return t};function Ir(e){const t=e.map(((e,t)=>Lr(e,Symbol(`netshadow-${t}`))));return{serialize(n,i,r,o,s){const a=[];r.push(a);for(let n=0;n<e.length;n++){const l=e[n],c=l[t[n]];if(ArrayBuffer.isView(l[i])){for(let e=0;e<l[i].length;e++)if(o||c[i][e]!==l[i][e]){a.push(n),r.push(Array.from(l[i]));break}s&&c[i].set(l[i])}else(o||c[i]!==l[i])&&(a.push(n),r.push(l[Tt]?APP.getString(l[i]):l[i])),s&&(c[i]=l[i])}return!!a.length||(r.pop(),!1)},deserialize(n,i,r){const o=r[r.cursor++];for(let n=0;n<o.length;n++){const s=o[n],a=e[s],l=a[t[s]];if(ArrayBuffer.isView(a[i]))a[i].set(r[r.cursor++]),l[i].set(a[i]);else{const e=r[r.cursor++];a[i]=a[Tt]?APP.getSid(e):e,l[i]=a[i]}}}}}function Nr(e){return Ir(e[jr])}const Fr=Nr(Lt),Br=new Map;Br.set(0,(e=>{let{data:t}=e;return{version:1,data:t}}));const Vr={componentName:"networked-media-frame",serialize:Fr.serialize,deserialize:Fr.deserialize,serializeForStorage:function(e){return{version:1,data:{capturedNid:io(Lt.capturedNid,e),scale:io(Lt.scale,e)}}},deserializeFromStorage:oo(Br,(function(e,t){let{version:n,data:i}=t;if(1!==n)return!1;const{capturedNid:r,scale:o}=i;return ro(Lt.capturedNid,e,r),ro(Lt.scale,e,o),!0}))},Ur=new Map,Hr=Nr($n),zr={componentName:"networked-pdf",serialize:Hr.serialize,deserialize:Hr.deserialize,serializeForStorage:function(e){return{version:1,data:{pageNumber:io($n.pageNumber,e)}}},deserializeFromStorage:oo(Ur,(function(e,t){let{version:n,data:i}=t;if(1!==n)return!1;const{pageNumber:r}=i;return ro($n.pageNumber,e,r),!0}))},Wr=Nr(Vt),qr=new Map,Zr={componentName:"networked-transform",serialize:Wr.serialize,deserialize:Wr.deserialize,serializeForStorage:function(e){return{version:1,data:{position:io(Vt.position,e),rotation:io(Vt.rotation,e),scale:io(Vt.scale,e)}}},deserializeFromStorage:oo(qr,(function(e,t){let{version:n,data:i}=t;if(1!==n)return!1;const{position:r,rotation:o,scale:s}=i;return ro(Vt.position,e,r),ro(Vt.rotation,e,o),ro(Vt.scale,e,s),!0}))},Gr=Nr(ni),Yr=new Map,Qr={componentName:"networked-video",serialize:Gr.serialize,deserialize:Gr.deserialize,serializeForStorage:function(e){return{version:1,data:{time:io(ni.time,e),flags:io(ni.flags,e)}}},deserializeFromStorage:oo(Yr,(function(e,t){let{version:n,data:i}=t;if(1!==n)return!1;const{time:r,flags:o}=i;return ro(ni.time,e,r),ro(ni.flags,e,o),!0}))},Xr=Nr(bi),Kr=new Map,$r={componentName:"networked-waypoint",serialize:Xr.serialize,deserialize:Xr.deserialize,serializeForStorage:function(e){return{version:1,data:{}}},deserializeFromStorage:oo(Kr,(function(e,t){let{version:n}=t;return 1===n}))};function Jr(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function eo(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const to=new Map;to.set(Lt,Vr),to.set(Vt,Zr),to.set(ni,Qr),to.set(bi,$r),to.set(Hn,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Jr(Object(n),!0).forEach((function(t){eo(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Jr(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({componentName:"networked-floaty-object"},Nr(Hn))),to.set($n,zr);const no=Array.from(to.keys());function io(e,t){return ArrayBuffer.isView(e[t])?Array.from(e[t]):e[Tt]?APP.getString(e[t]):e[t]}function ro(e,t,n){ArrayBuffer.isView(e[t])?e[t].set(n):e[t]=e[Tt]?APP.getString(n):n}function oo(e,t){return function(n,i){let r=i;for(;e.has(r.version);)r=e.get(r.version)(r);if(!t(n,r))throw console.error("Failed to deserialize component data.",{original:i,migrated:r}),new Error("Failed to deserialize component data.")}}const so=(()=>{const e=Ir([Rt.lastOwnerTime,Rt.owner]).serialize,t=[];return function(n,i,r,o){const s=e(n,i,t,r,o);return t.length=0,s}})();function ao(e,t,n,i,r,o){const s={creates:[],updates:[],deletes:[]};return t.forEach((e=>{const{prefabName:t,initialData:n}=wr.get(e);s.creates.push({version:1,networkId:APP.getString(Rt.id[e]),prefabName:t,initialData:n})})),n.forEach((t=>{const n={nid:APP.getString(Rt.id[t]),lastOwnerTime:Rt.lastOwnerTime[t],timestamp:Rt.timestamp[t],owner:APP.getString(Rt.owner[t]),componentIds:[],data:[]},r=i.includes(t);for(let i=0;i<no.length;i++){const s=no[i];(0,Ot.hasComponent)(e,s,t)&&to.get(s).serialize(e,t,n.data,r,o)&&n.componentIds.push(i)}(so(e,t,r,o)||n.componentIds.length)&&s.updates.push(n)})),r.forEach((e=>{const t=Rt.id[e];s.deletes.push(APP.getString(t))})),s.creates.length||s.updates.length||s.deletes.length?s:null}function lo(e,t,n,i,r,o,s){try{var a=e[o](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(i,r)}function co(e){return uo.apply(this,arguments)}function uo(){var e;return e=function*(e){const t=ge(`/${e}/objects.gltf`),n=yield fetch(t),i=(yield n.json()).nodes.filter((e=>!function(e){return!!(e.version&&e.creates&&e.updates&&e.deletes)}(e)));if(e===APP.hub.hub_id){const e=function(e){const t={creates:[],updates:[],deletes:[]};return e.forEach((e=>{const n=e.name,i={version:1,networkId:n,prefabName:"media",initialData:{src:e.extensions.HUBS_components.media.src,resize:!0,recenter:!0,animateLoad:!0,isObjectMenuTarget:!0}};t.creates.push(i);const r={data:{"networked-transform":{version:1,data:{position:e.translation||[0,0,0],rotation:e.rotation||[0,0,0,1],scale:e.scale||[1,1,1]}}},nid:n,lastOwnerTime:1,timestamp:1,owner:"reticulum"};t.updates.push(r)})),t.creates.length||t.updates.length?t:null}(i);e&&(e.fromClientId="reticulum",Sr.push(e))}},uo=function(){var t=this,n=arguments;return new Promise((function(i,r){var o=e.apply(t,n);function s(e){lo(o,i,r,s,a,"next",e)}function a(e){lo(o,i,r,s,a,"throw",e)}s(void 0)}))},uo.apply(this,arguments)}var ho=n(99477);const po=["emissive","emissiveMap","emissiveIntensity"];function mo(e,t){e.material&&(Array.isArray(e.material)?e.material.forEach(t):t(e.material))}function fo(e,t){e.material&&(Array.isArray(e.material)?e.material=e.material.map(t):e.material=t(e.material))}function go(e,t){return e.material?Array.isArray(e.material)?e.material.map(t):[t(e.material)]:[]}class vo extends ho.MeshBasicMaterial{static fromMeshStandardMaterial(e){const t=new vo;return ho.Material.prototype.copy.call(t,e),t.onBeforeRender=e.onBeforeRender,t.color.copy(e.color),t.emissive.copy(e.emissive),t.emissiveIntensity=e.emissiveIntensity,t.emissiveMap=e.emissiveMap,t.map=e.map,t.lightMap=e.lightMap,t.lightMapIntensity=e.lightMapIntensity*Math.PI,t.aoMap=e.aoMap,t.aoMapIntensity=e.aoMapIntensity,t.alphaMap=e.alphaMap,t.wireframe=e.wireframe,t.wireframeLinewidth=e.wireframeLinewidth,t.wireframeLinecap=e.wireframeLinecap,t.wireframeLinejoin=e.wireframeLinejoin,t}constructor(e){void 0===e&&(e={});let{emissive:t,emissiveMap:n,emissiveIntensity:i}=e;super(function(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}(e,po)),this.onBeforeCompile=e=>{e.uniforms.emissive=this._emissive,e.uniforms.emissiveIntensity=this._emissiveIntensity,e.uniforms.emissiveMap=this._emissiveMap,e.fragmentShader=e.fragmentShader.replace("#include <lightmap_pars_fragment>","#include <lightmap_pars_fragment>\n      uniform vec3 emissive;\n      uniform sampler2D emissiveMap;\n      "),e.fragmentShader=e.fragmentShader.replace("#include <envmap_fragment>","#include <envmap_fragment>\n\n      vec3 totalEmissiveRadiance = emissive;\n      #include <emissivemap_fragment>\n      outgoingLight += totalEmissiveRadiance;\n\n      ")},this._emissive={value:t||new ho.Color},this._emissiveIntensity={value:void 0===i?1:i},this._emissiveMap={value:n}}get emissive(){return this._emissive.value}set emissive(e){this._emissive.value=e}get emissiveIntensity(){return this._emissiveIntensity.value}set emissiveIntensity(e){this._emissiveIntensity.value=e}get emissiveMap(){return this._emissiveMap.value}set emissiveMap(e){this._emissiveMap.value=e}copy(e){return super.copy(e),this.emissive.copy(e.emissive),this.emissiveIntensity=e.emissiveIntensity,this.emissiveMap=e.emissiveMap,this}}class bo extends ho.MeshPhongMaterial{constructor(){super(...arguments),this.onBeforeCompile=e=>{e.vertexShader=e.vertexShader.replace("varying vec3 vNormal;","varying vec3 vNormal;\n      #ifdef USE_TANGENT\n        varying vec3 vTangent;\n        varying vec3 vBitangent;\n      #endif\n      "),e.vertexShader=e.vertexShader.replace("vNormal = normalize( transformedNormal );","vNormal = normalize( transformedNormal );\n      \n        #ifdef USE_TANGENT\n      \n          vTangent = normalize( transformedTangent );\n          vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n      \n        #endif\n      "),e.fragmentShader=e.fragmentShader.replace("#include <lights_phong_pars_fragment>","#include <lights_phong_pars_fragment>\n      #ifndef FLAT_SHADED\n\n        #ifdef USE_TANGENT\n          varying vec3 vTangent;\n          varying vec3 vBitangent;\n        #endif\n\n      #endif\n      ")}}static fromMeshStandardMaterial(e){const t=new bo;return ho.Material.prototype.copy.call(t,e),t.onBeforeRender=e.onBeforeRender,t.color.copy(e.color),t.map=e.map,t.lightMap=e.lightMap,t.lightMapIntensity=e.lightMapIntensity,t.aoMap=e.aoMap,t.aoMapIntensity=e.aoMapIntensity,t.emissive.copy(e.emissive),t.emissiveMap=e.emissiveMap,t.emissiveIntensity=e.emissiveIntensity,t.normalMapType=e.normalMapType,t.normalMap=e.normalMap,t.normalScale.copy(e.normalScale),t.bumpMap=e.bumpMap,t.bumpScale=e.bumpScale,t.displacementMap=e.displacementMap,t.displacementScale=e.displacementScale,t.displacementBias=e.displacementBias,t.alphaMap=e.alphaMap,t.reflectivity=.5,t.refractionRatio=e.refractionRatio,t.wireframe=e.wireframe,t.wireframeLinewidth=e.wireframeLinewidth,t.wireframeLinecap=e.wireframeLinecap,t.wireframeLinejoin=e.wireframeLinejoin,t}}function yo(e,t){return e.isMeshStandardMaterial?"medium"===t?bo.fromMeshStandardMaterial(e):"low"===t?vo.fromMeshStandardMaterial(e):e:e}function wo(e){if(e.dash&&e.dash.reset(),e.image instanceof HTMLVideoElement){const t=e.image;t.pause(),t.src="",t.load()}e.hls&&(e.hls.stopLoad(),e.hls.detachMedia(),e.hls.destroy(),e.hls=null),e.dispose()}let _o;!function(e){e[e.CAMERA_LAYER_DEFAULT=0]="CAMERA_LAYER_DEFAULT",e[e.CAMERA_LAYER_XR_LEFT_EYE=1]="CAMERA_LAYER_XR_LEFT_EYE",e[e.CAMERA_LAYER_XR_RIGHT_EYE=2]="CAMERA_LAYER_XR_RIGHT_EYE",e[e.CAMERA_LAYER_REFLECTION=3]="CAMERA_LAYER_REFLECTION",e[e.CAMERA_LAYER_INSPECT=4]="CAMERA_LAYER_INSPECT",e[e.CAMERA_LAYER_VIDEO_TEXTURE_TARGET=5]="CAMERA_LAYER_VIDEO_TEXTURE_TARGET",e[e.CAMERA_LAYER_THIRD_PERSON_ONLY=6]="CAMERA_LAYER_THIRD_PERSON_ONLY",e[e.CAMERA_LAYER_FIRST_PERSON_ONLY=7]="CAMERA_LAYER_FIRST_PERSON_ONLY",e[e.CAMERA_LAYER_UI=8]="CAMERA_LAYER_UI",e[e.CAMERA_LAYER_FX_MASK=9]="CAMERA_LAYER_FX_MASK"}(_o||(_o={}));var Eo=n(99477);const Ao=new Eo.Vector3;function So(e,t){return e.updateMatrices(),t.setFromMatrixPosition(e.matrixWorld),t}function xo(e){e.map&&e.map.dispose(),e.lightMap&&e.lightMap.dispose(),e.bumpMap&&e.bumpMap.dispose(),e.normalMap&&e.normalMap.dispose(),e.specularMap&&e.specularMap.dispose(),e.envMap&&e.envMap.dispose(),e.aoMap&&e.aoMap.dispose(),e.metalnessMap&&e.metalnessMap.dispose(),e.roughnessMap&&e.roughnessMap.dispose(),e.emissiveMap&&e.emissiveMap.dispose(),e.dispose(),e.eid&&(0,Ot.removeEntity)(APP.world,e.eid)}function Mo(e){e instanceof Eo.Mesh&&(e.geometry&&e.geometry.dispose(),mo(e.material,xo))}new Eo.Quaternion;const Po=(new Eo.Matrix4).identity(),Co=new Eo.Matrix4,ko=1e-11;function Oo(e,t){e.matrixIsModified||e.applyMatrix4(Po),Co.copy(e.matrixWorld),e.matrixWorld.copy(t),e.parent?(e.parent.updateMatrices(),e.matrix.copy(e.parent.matrixWorld).invert().multiply(t)):e.matrix.copy(t),e.matrix.decompose(e.position,e.quaternion,e.scale),Co.near(e.matrixWorld,ko)?e.matrixWorld.copy(Co):e.childrenNeedMatrixWorldUpdate=!0}function To(e,t,n){n(e,t);for(let i=0;i<e.children.length;i++)To(e.children[i],t.children[i],n)}function Ro(e,t){const n=new Map,i=new Map,r=e.clone();return To(e,r,((e,t)=>{var i;n.set(e,t),null!==(i=e.userData.gltfExtensions)&&void 0!==i&&i.MOZ_hubs_components&&(t.userData.gltfExtensions.MOZ_hubs_components=e.userData.gltfExtensions.MOZ_hubs_components)})),e.traverse((e=>{const r=n.get(e);t&&(r.uuid=e.uuid),i.set(e.uuid,r.uuid)})),e.traverse((e=>{const t=n.get(e);if(!t)return;if(t.onBeforeRender=e.onBeforeRender,e.animations&&(t.animations=e.animations.map((e=>function(e,t){const n=e.tracks.map((e=>function(e,t){const{nodeName:n,objectName:i,objectIndex:r,propertyName:o,propertyIndex:s}=Eo.PropertyBinding.parseTrackName(e.name);let a="";if(void 0!==n){const e=t.get(n);void 0===e&&console.warn(`Could not find KeyframeTrack target with uuid: "${n}"`),a+=e}void 0!==i&&(a+="."+i),void 0!==r&&(a+="["+r+"]"),void 0!==o&&(a+="."+o),void 0!==s&&(a+="["+s+"]");const l=e.clone();return l.name=a,l}(e,t)));return new Eo.AnimationClip(e.name,e.duration,n)}(e,i)))),e.isMesh&&e.geometry.boundsTree&&(t.geometry.boundsTree=e.geometry.boundsTree),(t.isDirectionalLight||t.isSpotLight)&&e.target&&(t.target=n.get(e.target)),!e.isSkinnedMesh)return;const r=e.skeleton.bones;t.skeleton=e.skeleton.clone(),t.skeleton.bones=r.map((e=>{if(!n.has(e))throw new Error("Required bones are not descendants of the given object.");return n.get(e)})),t.bind(t.skeleton,e.bindMatrix)})),r}function Do(e,t){let n=[e];for(;n.length;){const e=n.shift();if(t(e))return e;e.children&&(n=n.concat(e.children))}return null}const jo=function(){const e=new Eo.Matrix4,t={position:new Eo.Vector3,quaternion:new Eo.Quaternion,scale:new Eo.Vector3},n={position:new Eo.Vector3,quaternion:new Eo.Quaternion,scale:new Eo.Vector3},i={position:new Eo.Vector3,quaternion:new Eo.Quaternion,scale:new Eo.Vector3};return function(r,o,s,a){return n.quaternion.setFromRotationMatrix(e.extractRotation(r)),t.quaternion.setFromRotationMatrix(e.extractRotation(o)),i.quaternion.slerpQuaternions(n.quaternion,t.quaternion,s),i.position.lerpVectors(n.position.setFromMatrixColumn(r,3),t.position.setFromMatrixColumn(o,3),s),i.scale.lerpVectors(n.scale.setFromMatrixScale(r),t.scale.setFromMatrixScale(o),s),a.compose(i.position,i.quaternion,i.scale)}}();new Eo.Vector3,new Eo.Vector3;const Lo=function(){const e=new Eo.Matrix4,t=new Eo.Vector3,n=new Eo.Vector3,i=new Eo.Vector3,r=new Eo.Vector3,o=new Eo.Vector3,s=new Eo.Matrix4;return function(a,l){return e.identity().extractRotation(s.copy(a)),t.setFromMatrixColumn(e,2).multiplyScalar(-1),n.copy(t).sub(o.copy(t).projectOnVector(r.set(0,1,0))).normalize(),i.crossVectors(n,r),l.makeBasis(i,r,n.multiplyScalar(-1)),l.scale(o.setFromMatrixScale(s)),l.setPosition(o.setFromMatrixColumn(s,3)),l}}(),Io=function(){const e=new Eo.Matrix4,t=new Eo.Matrix4,n=new Eo.Matrix4;return function(i,r,o){Lo(i,e),n.copy(e).invert().multiply(i),Lo(r,t),o.copy(t).multiply(n)}}(),No=function(){const e=new Eo.Matrix4,t=new Eo.Matrix4,n=new Eo.Matrix4,i=new Eo.Vector3;return function(r,o,s){return e.copy(r),s.copy(n.makeRotationY(o).multiply(t.extractRotation(e))).scale(i.setFromMatrixScale(e)).setPosition(i.setFromMatrixPosition(e))}}(),Fo=function(){const e=new Eo.Matrix4,t=new Eo.Matrix4,n=new Eo.Matrix4,i=new Eo.Matrix4;return function(r,o,s){r.updateMatrices(),e.copy(r.matrixWorld).invert(),o.updateMatrices(),t.multiplyMatrices(e,o.matrixWorld),n.copy(t).invert(),i.multiplyMatrices(s,n),Oo(r,i)}}();function Bo(e,t,n,i,r){void 0===r&&(r=!0);const o=new Eo.PlaneBufferGeometry(e,t,n,i);if(!1===r){const e=o.getAttribute("uv");for(let t=0;t<e.count;t++)e.setY(t,1-e.getY(t))}return o}function Vo(e){return"Head"===e.name||e.parent&&Vo(e.parent)}function Uo(e){const t=[];return e.skeleton.bones.forEach(((e,n)=>{Vo(e)&&t.push(n)})),t.length?(e.layers.set(_o.CAMERA_LAYER_THIRD_PERSON_ONLY),function(e,t){const n=new Eo.SkinnedMesh(e.geometry.clone(),e.material);n.name=`${e.name}(headless)`,n.frustumCulled=e.frustumCulled,n.layers.set(_o.CAMERA_LAYER_FIRST_PERSON_ONLY);const i=n.geometry,r=i.getAttribute("skinIndex").array,o=[];for(let e=0;e<r.length;e+=4)o.push([r[e],r[e+1],r[e+2],r[e+3]]);const s=i.getAttribute("skinWeight").array,a=[];for(let e=0;e<s.length;e+=4)a.push([s[e],s[e+1],s[e+2],s[e+3]]);const l=i.getIndex();if(!l)throw new Error("The geometry doesn't have an index buffer");const c=Array.from(l.array),d=function(e,t,n,i){let r=0;if(null!=t&&t.length>0)for(let o=0;o<e.length;o+=3){const s=e[o],a=e[o+1],l=e[o+2],c=t[s],d=n[s];if(c[0]>0&&i.includes(d[0]))continue;if(c[1]>0&&i.includes(d[1]))continue;if(c[2]>0&&i.includes(d[2]))continue;if(c[3]>0&&i.includes(d[3]))continue;const u=t[a],h=n[a];if(u[0]>0&&i.includes(h[0]))continue;if(u[1]>0&&i.includes(h[1]))continue;if(u[2]>0&&i.includes(h[2]))continue;if(u[3]>0&&i.includes(h[3]))continue;const p=t[l],m=n[l];p[0]>0&&i.includes(m[0])||p[1]>0&&i.includes(m[1])||p[2]>0&&i.includes(m[2])||p[3]>0&&i.includes(m[3])||(e[r++]=s,e[r++]=a,e[r++]=l)}return r}(c,a,o,t),u=[];for(let e=0;e<d;e++)u[e]=c[e];return i.setIndex(u),e.onBeforeRender&&(n.onBeforeRender=e.onBeforeRender),n.bind(new Eo.Skeleton(e.skeleton.bones,e.skeleton.boneInverses),new Eo.Matrix4),n}(e,t)):(e.layers.enable(_o.CAMERA_LAYER_THIRD_PERSON_ONLY),void e.layers.enable(_o.CAMERA_LAYER_FIRST_PERSON_ONLY))}const Ho=function(){const e=new Eo.Vector3,t=new Eo.Vector3,n=new Eo.Vector3;return function(i){return AFRAME.scenes[0].systems["hubs-systems"].cameraSystem.viewingCamera.getWorldPosition(n),i.getWorldPosition(t),i.getWorldDirection(e),e.dot(t.sub(n))<0}}();function zo(e,t){if(t(e))for(let n=0;n<e.children.length;n++)zo(e.children[n],t)}const Wo=new Map;function qo(e,t){Wo.has(t)||Wo.set(t,(0,Ot.defineQuery)([t]));const n=Wo.get(t)(e);return n.length?n[0]:null}function Zo(e,t,n){for(let i=0;i<t.length;i++)if((0,Ot.hasComponent)(e,t[i],n))return!0;return!1}function Go(e,t,n){const i=function(e,t){let n=e;for(;n;){if(t(n))return n;n=n.parent}return null}(e.eid2obj.get(t),(e=>!(!e.eid||!n(e.eid))));return i&&i.eid}function Yo(e,t,n){return Go(e,n,(n=>(0,Ot.hasComponent)(e,t,n)))}function Qo(e,t,n){const i=e.eid2obj.get(n);if(i){let n;return zo(i,(i=>!i.eid||!(0,Ot.hasComponent)(e,t,i.eid)||(n=i.eid,!1))),n}}function Xo(e){let{key:t}=e;const n=APP.getSid(t);n!==yr&&(Mr.push(n),Er.add(n),Ar.delete(n))}function Ko(e){let{key:t}=e;const n=APP.getSid(t);n!==yr&&(Pr.push(n),Er.delete(n),Ar.add(n))}function $o(e){let{from_session_id:t,data:n,dataType:i}=e;"nn"==i&&(n.fromClientId=t,Sr.push(n))}function Jo(e){const{from_session_id:t,naf:n}=e;e.parsed=JSON.parse(n),e.parsed.from_session_id=t,$o(e.parsed)}function es(e){const t=e.create_message.networkId;e.update_messages.forEach((e=>{e.owner="reticulum"})),Sr.push({fromClientId:"reticulum",creates:[e.create_message],updates:e.update_messages,deletes:[]}),xr.push({nid:t,creator:"reticulum"})}function ts(e){es(e.data[0])}function ns(e){}function is(e){xr.push(e)}function rs(e,t,n,i,r,o,s){try{var a=e[o](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(i,r)}function os(e){return function(){var t=this,n=arguments;return new Promise((function(i,r){var o=e.apply(t,n);function s(e){rs(o,i,r,s,a,"next",e)}function a(e){rs(o,i,r,s,a,"throw",e)}s(void 0)}))}}function ss(e,t){return!!Go(e,t,(e=>kr(e)&&Or(e)))}function as(){return(as=os((function*(e,t,n){const i=function(e,t){const n=APP.getString(Rt.id[t]),i=function(e){const{prefabName:t,initialData:n}=wr.get(e);return{version:1,networkId:APP.getString(Rt.id[e]),prefabName:t,initialData:n}}(t),r=[];return e.eid2obj.get(t).traverse((t=>{t.eid&&(0,Ot.hasComponent)(e,Rt,t.eid)&&r.push(gs(e,t.eid))})),{nid:n,create_message:i,updates:r}}(t,n);return ms(e,"save_entity_state",i)}))).apply(this,arguments)}function ls(){return(ls=os((function*(e,t,n){return ms(e,"update_entity_state",gs(t,n))}))).apply(this,arguments)}function cs(e,t,n){return ds.apply(this,arguments)}function ds(){return(ds=os((function*(e,t,n){if(!kr(n))throw new Error("Tried to delete entity state for non-network instantiated entity.");if(!Or(n))throw new Error("Tried to delete entity state for non-pinned entity.");return ms(e,"delete_entity_state",{nid:APP.getString(Rt.id[n])})}))).apply(this,arguments)}function us(e){return hs.apply(this,arguments)}function hs(){return(hs=os((function*(e){(yield fs(e)).data.forEach((e=>es(e)))}))).apply(this,arguments)}function ps(e,t){const n={nid:APP.getString(Rt.id[t]),lastOwnerTime:Rt.lastOwnerTime[t],timestamp:Rt.timestamp[t],owner:APP.getString(Rt.owner[t]),data:{}};for(let i=0;i<no.length;i++){const r=no[i];if((0,Ot.hasComponent)(e,r,t)){const e=to.get(r);e.serializeForStorage&&(n.data[e.componentName]=e.serializeForStorage(t))}}return n}function ms(e,t,n){if(!yr)throw new Error("Cannot get/set entity states without a local client ID.");return(0,z.Z)("entity_state_api")?new Promise(((i,r)=>{e.channel.push(t,n).receive("ok",i).receive("error",r)})):(console.warn("Entity state API is inactive. Would have sent:",{command:t,payload:n}),Promise.reject())}function fs(e){return ms(e,"list_entities")}function gs(e,t){const n=APP.getString(Rt.id[t]);return{root_nid:kr(t)?n:APP.getString(Rt.creator[t]),nid:n,update_message:ps(e,t)}}const vs=(0,Ot.defineQuery)([Rt]);function bs(){return(bs=os((function*(e,t){console.warn("Deleting ALL saved entity states..."),vs(t).forEach((n=>{kr(n)&&Or(n)&&cs(e,t,n)}))}))).apply(this,arguments)}function ys(){return(ys=os((function*(e){fs(e).then((t=>{var n,i,r,o;n=t,i=`hub-${e.hubId}`,r="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(n)),(o=document.createElement("a")).setAttribute("href",r),o.setAttribute("download",`${i}.json`),document.body.appendChild(o),o.click(),o.remove()}))}))).apply(this,arguments)}window.deleteAllEntityStates=()=>{!function(e,t){bs.apply(this,arguments)}(APP.hubChannel,APP.world)},window.download=()=>{!function(e){ys.apply(this,arguments)}(APP.hubChannel)},window.loadFromJson=()=>{!function(e){const t=document.createElement("input");t.setAttribute("type","file"),t.setAttribute("multiple",""),document.body.appendChild(t),t.click(),t.addEventListener("change",(n=>{n.target.files[0].text().then((t=>{JSON.parse(t).data.forEach((t=>{!function(e){const t=NAF.utils.createNetworkId();e.create_message.networkId=t,e.update_messages.forEach((e=>{const n=e.nid.split(".");n.shift(),n.unshift(t),e.nid=n.join(".")}))}(t),function(e,t){ms(e,"save_entity_state",{nid:t.create_message.networkId,create_message:t.create_message,updates:t.update_messages.map((e=>({root_nid:t.create_message.networkId,nid:e.nid,update_message:e})))})}(e,t)}))})),t.remove()}))}(APP.hubChannel)};var ws=n.p+"assets/camera_tool-3e037f329d63a7f9013d..glb",_s=n(28212),Es=n(25428),As=n(21422),Ss=n(60727),xs=n(82854),Ms=n(1217),Ps=n(26499),Cs=n(92666),ks=n(99477);function Os(e,t,n,i,r,o,s){try{var a=e[o](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(i,r)}const Ts=Q(),Rs=void 0!==window.createImageBitmap&&!1===/Firefox/.test(navigator.userAgent)&&!Ts;class Ds extends ks.TextureLoader{constructor(e){super(e)}load(e,t,n,i){const r=e=>{!function(e){if(!Ts||"low"!==window.APP.store.state.preferences.materialQualitySetting)return e;const t=e.image;if(!t||void 0===t.width||void 0===t.height)return e;if(t.width<=2048&&t.height<=2048)return e;const n=Math.min(2048/t.width,2048/t.height),i=Math.round(t.width*n),r=Math.round(t.height*n),o=document.createElement("canvas");o.width=i,o.height=r,o.getContext("2d").drawImage(t,0,0,i,r),e.image=o,void 0!==t.close&&t.close(),e.format=ks.RGBAFormat,e.type=ks.UnsignedByteType}(e),t&&t(e)},o=Rs?this._loadImageBitmapTexture(e,r,n,i):super.load(e,r,n,i);return o.onUpdate=function(){o.image.close&&o.image.close(),o.image=null},o}loadAsync(e,t){var n,i=this;return(n=function*(){return new Promise(((n,r)=>{i.load(e,n,t,r)}))},function(){var e=this,t=arguments;return new Promise((function(i,r){var o=n.apply(e,t);function s(e){Os(o,i,r,s,a,"next",e)}function a(e){Os(o,i,r,s,a,"throw",e)}s(void 0)}))})()}_loadImageBitmapTexture(e,t,n,i){const r=new ks.Texture,o=new ks.ImageBitmapLoader(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(e,(n=>{r.image=n,r.needsUpdate=!0,ks.Cache.remove(this.manager.resolveURL(e)),void 0!==t&&t(r)}),n,i),r.flipY=!1,r}}var js=n(39367),Ls=n(74937),Is=n(86309),Ns=n(45866);function Fs(e,t,n,i,r,o,s){try{var a=e[o](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(i,r)}function Bs(e){return function(){var t=this,n=arguments;return new Promise((function(i,r){var o=e.apply(t,n);function s(e){Fs(o,i,r,s,a,"next",e)}function a(e){Fs(o,i,r,s,a,"throw",e)}s(void 0)}))}}const Vs=(k.NON_CORS_PROXY_DOMAINS||"").split(",");k.CORS_PROXY_SERVER&&Vs.push(k.CORS_PROXY_SERVER.split(":")[0]),Vs.push(document.location.hostname);const Us={gltf:"model/gltf",glb:"model/gltf-binary",png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg",pdf:"application/pdf",mp4:"video/mp4",mp3:"audio/mpeg",basis:"image/basis",ktx2:"image/ktx2",m3u8:"application/vnd.apple.mpegurl",mpd:"application/dash+xml"},Hs=e=>Vs.find((t=>e.endsWith(t))),zs=e=>{if(!e.startsWith("http:")&&!e.startsWith("https:"))return e;try{const t=new URL(e);if(Hs(t.hostname))return e}catch(e){}return`https://${k.CORS_PROXY_SERVER}/${e}`};function Ws(e,t){return function(e,t){return new URL(t,e)}(e,t).href}const qs=e=>t=>{if("basis_transcoder.js"===t)return js.Z;if("basis_transcoder.wasm"===t)return Is.Z;if("draco_wasm_wrapper.js"===t)return Ls.Z;if("draco_decoder.wasm"===t)return Ns.Z;if("string"!=typeof t||""===t)return"";if(/^(https?:)?\/\//i.test(t))return zs(t);if(/^data:.*,.*$/i.test(t))return t;if(/^blob:.*$/i.test(t))return t;if(k.CORS_PROXY_SERVER){const n=`https://${k.CORS_PROXY_SERVER}/`;if(e.startsWith(n)){const i=decodeURIComponent(e.substring(n.length)).split("/"),r=new URL(t).pathname;return n+(i.slice(0,i.length-1).join("/")+"/")+r}}return t},Zs=/data:([a-zA-Z0-9]+\/[a-zA-Z0-9-.+]+).*,.*/,Gs=e=>{if(!e)return;if(e.startsWith("hubs://")&&e.endsWith("/video"))return"video/vnd.hubs-webrtc";if(e.startsWith("data:")){const t=Zs.exec(e);t.length>0&&t[1]}const t=new URL(e,window.location).pathname.split(".").pop();return Us[t]},Ys=new Map;function Qs(e){return Xs.apply(this,arguments)}function Xs(){return Xs=Bs((function*(e){if(!e)return!1;e.startsWith("http")||(e="https://"+e);const{origin:t}=new URL(e);if(Ys.has(t))return Ys.get(t);let n;try{n=(yield fetch(zs(t),{method:"HEAD"})).headers.has("hub-name")}catch(e){n=!1}return Ys.set(t,n),n})),Xs.apply(this,arguments)}const Ks=/https?:\/\/[^/]+\/scenes\/[a-zA-Z0-9]{7}(?:\/|$)/,$s=/https?:\/\/[^/]+\/avatars\/(?<id>[a-zA-Z0-9]{7})(?:\/|$)/,Js=/(https?:\/\/)?[^/]+\/(?<id>[a-zA-Z0-9]{7})(?:\/|$)/,ea=function(){var e=Bs((function*(e){return(yield Qs(e))&&new URL(e).origin===document.location.origin}));return function(t){return e.apply(this,arguments)}}(),ta=function(){var e=Bs((function*(e){return(yield Qs(e))&&Ks.test(e)}));return function(t){return e.apply(this,arguments)}}(),na=function(){var e=Bs((function*(e){return(yield ta(e))&&(yield ea(e))}));return function(t){return e.apply(this,arguments)}}(),ia=function(){var e=Bs((function*(e){return(yield Qs(e))&&$s.test(e)}));return function(t){return e.apply(this,arguments)}}(),ra=function(){var e=Bs((function*(e){return(yield ia(e))&&(yield ea(e))}));return function(t){return e.apply(this,arguments)}}(),oa=function(){var e=Bs((function*(e){var t;return(yield Qs(e))&&!(yield ia(e))&&!(yield ta(e))&&(null===(t=e.match(Js))||void 0===t?void 0:t.groups.id)}));return function(t){return e.apply(this,arguments)}}();function sa(e){let t=0;const n={};return e.onmessage=t=>{const{id:i,result:r,err:o}=t.data,s=n[i];null==s?console.error(`Unknown message with ID ${i} received from ${e}.`):(delete n[i],null!=o?s.reject(new Error(o)):s.resolve(r))},function(i,r,o){void 0===o&&(o={});const s=t++,a=new Promise(((e,t)=>{n[s]={resolve:e,reject:t}}));return e.postMessage(Object.assign(o,{id:s,payload:i}),r),a}}var aa=n(20477),la=n.n(aa),ca=n(99477);function da(e,t,n,i,r,o,s){try{var a=e[o](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(i,r)}function ua(e){return function(){var t=this,n=arguments;return new Promise((function(i,r){var o=e.apply(t,n);function s(e){da(o,i,r,s,a,"next",e)}function a(e){da(o,i,r,s,a,"throw",e)}s(void 0)}))}}ca.Mesh.prototype.raycast=As.uL;const ha=new class{constructor(){this.cache=new Map}set(e,t){return t.scene.userData.gltfCacheKey=e,this.cache.set(e,{gltf:t,count:0}),this.retain(e)}has(e){return this.cache.has(e)}get(e){return this.cache.get(e)}retain(e){const t=this.cache.get(e);return t.count++,t}release(e){const t=this.cache.get(e);t?(t.count--,t.count<=0&&(t.gltf.scene.dispose(),this.cache.delete(e))):console.error(`Releasing uncached gltf ${e}`)}},pa=new Map,ma=sa(new function(){return la()('!function(){"use strict";var e,t,i=(e=function(e,t){var i="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;function n(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var i=t.shift();if(i){if("object"!=typeof i)throw new TypeError(i+"must be non-object");for(var a in i)n(i,a)&&(e[a]=i[a])}}return e},t.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var a={arraySet:function(e,t,i,n,a){if(t.subarray&&e.subarray)e.set(t.subarray(i,i+n),a);else for(var r=0;r<n;r++)e[a+r]=t[i+r]},flattenChunks:function(e){var t,i,n,a,r,o;for(n=0,t=0,i=e.length;t<i;t++)n+=e[t].length;for(o=new Uint8Array(n),a=0,t=0,i=e.length;t<i;t++)r=e[t],o.set(r,a),a+=r.length;return o}},r={arraySet:function(e,t,i,n,a){for(var r=0;r<n;r++)e[a+r]=t[i+r]},flattenChunks:function(e){return[].concat.apply([],e)}};t.setTyped=function(e){e?(t.Buf8=Uint8Array,t.Buf16=Uint16Array,t.Buf32=Int32Array,t.assign(t,a)):(t.Buf8=Array,t.Buf16=Array,t.Buf32=Array,t.assign(t,r))},t.setTyped(i)},e(t={exports:{}},t.exports),t.exports);i.assign,i.shrinkBuf,i.setTyped,i.Buf8,i.Buf16,i.Buf32;var n=function(e,t,i,n){for(var a=65535&e|0,r=e>>>16&65535|0,o=0;0!==i;){i-=o=i>2e3?2e3:i;do{r=r+(a=a+t[n++]|0)|0}while(--o);a%=65521,r%=65521}return a|r<<16|0},a=function(){for(var e,t=[],i=0;i<256;i++){e=i;for(var n=0;n<8;n++)e=1&e?3988292384^e>>>1:e>>>1;t[i]=e}return t}(),r=function(e,t,i,n){var r=a,o=n+i;e^=-1;for(var s=n;s<o;s++)e=e>>>8^r[255&(e^t[s])];return-1^e},o=function(e,t){var i,n,a,r,o,s,f,l,d,c,h,u,w,b,p,m,k,_,v,g,y,x,B,E,S;i=e.state,n=e.next_in,E=e.input,a=n+(e.avail_in-5),r=e.next_out,S=e.output,o=r-(t-e.avail_out),s=r+(e.avail_out-257),f=i.dmax,l=i.wsize,d=i.whave,c=i.wnext,h=i.window,u=i.hold,w=i.bits,b=i.lencode,p=i.distcode,m=(1<<i.lenbits)-1,k=(1<<i.distbits)-1;e:do{w<15&&(u+=E[n++]<<w,w+=8,u+=E[n++]<<w,w+=8),_=b[u&m];t:for(;;){if(u>>>=v=_>>>24,w-=v,0==(v=_>>>16&255))S[r++]=65535&_;else{if(!(16&v)){if(0==(64&v)){_=b[(65535&_)+(u&(1<<v)-1)];continue t}if(32&v){i.mode=12;break e}e.msg="invalid literal/length code",i.mode=30;break e}g=65535&_,(v&=15)&&(w<v&&(u+=E[n++]<<w,w+=8),g+=u&(1<<v)-1,u>>>=v,w-=v),w<15&&(u+=E[n++]<<w,w+=8,u+=E[n++]<<w,w+=8),_=p[u&k];i:for(;;){if(u>>>=v=_>>>24,w-=v,!(16&(v=_>>>16&255))){if(0==(64&v)){_=p[(65535&_)+(u&(1<<v)-1)];continue i}e.msg="invalid distance code",i.mode=30;break e}if(y=65535&_,w<(v&=15)&&(u+=E[n++]<<w,(w+=8)<v&&(u+=E[n++]<<w,w+=8)),(y+=u&(1<<v)-1)>f){e.msg="invalid distance too far back",i.mode=30;break e}if(u>>>=v,w-=v,y>(v=r-o)){if((v=y-v)>d&&i.sane){e.msg="invalid distance too far back",i.mode=30;break e}if(x=0,B=h,0===c){if(x+=l-v,v<g){g-=v;do{S[r++]=h[x++]}while(--v);x=r-y,B=S}}else if(c<v){if(x+=l+c-v,(v-=c)<g){g-=v;do{S[r++]=h[x++]}while(--v);if(x=0,c<g){g-=v=c;do{S[r++]=h[x++]}while(--v);x=r-y,B=S}}}else if(x+=c-v,v<g){g-=v;do{S[r++]=h[x++]}while(--v);x=r-y,B=S}for(;g>2;)S[r++]=B[x++],S[r++]=B[x++],S[r++]=B[x++],g-=3;g&&(S[r++]=B[x++],g>1&&(S[r++]=B[x++]))}else{x=r-y;do{S[r++]=S[x++],S[r++]=S[x++],S[r++]=S[x++],g-=3}while(g>2);g&&(S[r++]=S[x++],g>1&&(S[r++]=S[x++]))}break}}break}}while(n<a&&r<s);n-=g=w>>3,u&=(1<<(w-=g<<3))-1,e.next_in=n,e.next_out=r,e.avail_in=n<a?a-n+5:5-(n-a),e.avail_out=r<s?s-r+257:257-(r-s),i.hold=u,i.bits=w},s=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],f=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],l=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],d=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64],c=function(e,t,n,a,r,o,c,h){var u,w,b,p,m,k,_,v,g,y=h.bits,x=0,B=0,E=0,S=0,R=0,A=0,Z=0,T=0,O=0,U=0,L=null,C=0,N=new i.Buf16(16),D=new i.Buf16(16),I=null,F=0;for(x=0;x<=15;x++)N[x]=0;for(B=0;B<a;B++)N[t[n+B]]++;for(R=y,S=15;S>=1&&0===N[S];S--);if(R>S&&(R=S),0===S)return r[o++]=20971520,r[o++]=20971520,h.bits=1,0;for(E=1;E<S&&0===N[E];E++);for(R<E&&(R=E),T=1,x=1;x<=15;x++)if(T<<=1,(T-=N[x])<0)return-1;if(T>0&&(0===e||1!==S))return-1;for(D[1]=0,x=1;x<15;x++)D[x+1]=D[x]+N[x];for(B=0;B<a;B++)0!==t[n+B]&&(c[D[t[n+B]]++]=B);if(0===e?(L=I=c,k=19):1===e?(L=s,C-=257,I=f,F-=257,k=256):(L=l,I=d,k=-1),U=0,B=0,x=E,m=o,A=R,Z=0,b=-1,p=(O=1<<R)-1,1===e&&O>852||2===e&&O>592)return 1;for(;;){_=x-Z,c[B]<k?(v=0,g=c[B]):c[B]>k?(v=I[F+c[B]],g=L[C+c[B]]):(v=96,g=0),u=1<<x-Z,E=w=1<<A;do{r[m+(U>>Z)+(w-=u)]=_<<24|v<<16|g|0}while(0!==w);for(u=1<<x-1;U&u;)u>>=1;if(0!==u?(U&=u-1,U+=u):U=0,B++,0==--N[x]){if(x===S)break;x=t[n+c[B]]}if(x>R&&(U&p)!==b){for(0===Z&&(Z=R),m+=E,T=1<<(A=x-Z);A+Z<S&&!((T-=N[A+Z])<=0);)A++,T<<=1;if(O+=1<<A,1===e&&O>852||2===e&&O>592)return 1;r[b=U&p]=R<<24|A<<16|m-o|0}}return 0!==U&&(r[m+U]=x-Z<<24|64<<16|0),h.bits=R,0},h=0,u=-2,w=1,b=12,p=30,m=852,k=592;function _(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function v(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new i.Buf16(320),this.work=new i.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function g(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=w,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new i.Buf32(m),t.distcode=t.distdyn=new i.Buf32(k),t.sane=1,t.back=-1,h):u}function y(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,g(e)):u}function x(e,t){var i,n;return e&&e.state?(n=e.state,t<0?(i=0,t=-t):(i=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?u:(null!==n.window&&n.wbits!==t&&(n.window=null),n.wrap=i,n.wbits=t,y(e))):u}function B(e,t){var i,n;return e?(n=new v,e.state=n,n.window=null,(i=x(e,t))!==h&&(e.state=null),i):u}var E,S,R=!0;function A(e){if(R){var t;for(E=new i.Buf32(512),S=new i.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(c(1,e.lens,0,288,E,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;c(2,e.lens,0,32,S,0,e.work,{bits:5}),R=!1}e.lencode=E,e.lenbits=9,e.distcode=S,e.distbits=5}function Z(e,t,n,a){var r,o=e.state;return null===o.window&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new i.Buf8(o.wsize)),a>=o.wsize?(i.arraySet(o.window,t,n-o.wsize,o.wsize,0),o.wnext=0,o.whave=o.wsize):((r=o.wsize-o.wnext)>a&&(r=a),i.arraySet(o.window,t,n-a,r,o.wnext),(a-=r)?(i.arraySet(o.window,t,n-a,a,0),o.wnext=a,o.whave=o.wsize):(o.wnext+=r,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=r))),0}var T={inflateReset:y,inflateReset2:x,inflateResetKeep:g,inflateInit:function(e){return B(e,15)},inflateInit2:B,inflate:function(e,t){var a,s,f,l,d,m,k,v,g,y,x,B,E,S,R,T,O,U,L,C,N,D,I,F,H=0,z=new i.Buf8(4),j=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return u;(a=e.state).mode===b&&(a.mode=13),d=e.next_out,f=e.output,k=e.avail_out,l=e.next_in,s=e.input,m=e.avail_in,v=a.hold,g=a.bits,y=m,x=k,D=h;e:for(;;)switch(a.mode){case w:if(0===a.wrap){a.mode=13;break}for(;g<16;){if(0===m)break e;m--,v+=s[l++]<<g,g+=8}if(2&a.wrap&&35615===v){a.check=0,z[0]=255&v,z[1]=v>>>8&255,a.check=r(a.check,z,2,0),v=0,g=0,a.mode=2;break}if(a.flags=0,a.head&&(a.head.done=!1),!(1&a.wrap)||(((255&v)<<8)+(v>>8))%31){e.msg="incorrect header check",a.mode=p;break}if(8!=(15&v)){e.msg="unknown compression method",a.mode=p;break}if(g-=4,N=8+(15&(v>>>=4)),0===a.wbits)a.wbits=N;else if(N>a.wbits){e.msg="invalid window size",a.mode=p;break}a.dmax=1<<N,e.adler=a.check=1,a.mode=512&v?10:b,v=0,g=0;break;case 2:for(;g<16;){if(0===m)break e;m--,v+=s[l++]<<g,g+=8}if(a.flags=v,8!=(255&a.flags)){e.msg="unknown compression method",a.mode=p;break}if(57344&a.flags){e.msg="unknown header flags set",a.mode=p;break}a.head&&(a.head.text=v>>8&1),512&a.flags&&(z[0]=255&v,z[1]=v>>>8&255,a.check=r(a.check,z,2,0)),v=0,g=0,a.mode=3;case 3:for(;g<32;){if(0===m)break e;m--,v+=s[l++]<<g,g+=8}a.head&&(a.head.time=v),512&a.flags&&(z[0]=255&v,z[1]=v>>>8&255,z[2]=v>>>16&255,z[3]=v>>>24&255,a.check=r(a.check,z,4,0)),v=0,g=0,a.mode=4;case 4:for(;g<16;){if(0===m)break e;m--,v+=s[l++]<<g,g+=8}a.head&&(a.head.xflags=255&v,a.head.os=v>>8),512&a.flags&&(z[0]=255&v,z[1]=v>>>8&255,a.check=r(a.check,z,2,0)),v=0,g=0,a.mode=5;case 5:if(1024&a.flags){for(;g<16;){if(0===m)break e;m--,v+=s[l++]<<g,g+=8}a.length=v,a.head&&(a.head.extra_len=v),512&a.flags&&(z[0]=255&v,z[1]=v>>>8&255,a.check=r(a.check,z,2,0)),v=0,g=0}else a.head&&(a.head.extra=null);a.mode=6;case 6:if(1024&a.flags&&((B=a.length)>m&&(B=m),B&&(a.head&&(N=a.head.extra_len-a.length,a.head.extra||(a.head.extra=new Array(a.head.extra_len)),i.arraySet(a.head.extra,s,l,B,N)),512&a.flags&&(a.check=r(a.check,s,B,l)),m-=B,l+=B,a.length-=B),a.length))break e;a.length=0,a.mode=7;case 7:if(2048&a.flags){if(0===m)break e;B=0;do{N=s[l+B++],a.head&&N&&a.length<65536&&(a.head.name+=String.fromCharCode(N))}while(N&&B<m);if(512&a.flags&&(a.check=r(a.check,s,B,l)),m-=B,l+=B,N)break e}else a.head&&(a.head.name=null);a.length=0,a.mode=8;case 8:if(4096&a.flags){if(0===m)break e;B=0;do{N=s[l+B++],a.head&&N&&a.length<65536&&(a.head.comment+=String.fromCharCode(N))}while(N&&B<m);if(512&a.flags&&(a.check=r(a.check,s,B,l)),m-=B,l+=B,N)break e}else a.head&&(a.head.comment=null);a.mode=9;case 9:if(512&a.flags){for(;g<16;){if(0===m)break e;m--,v+=s[l++]<<g,g+=8}if(v!==(65535&a.check)){e.msg="header crc mismatch",a.mode=p;break}v=0,g=0}a.head&&(a.head.hcrc=a.flags>>9&1,a.head.done=!0),e.adler=a.check=0,a.mode=b;break;case 10:for(;g<32;){if(0===m)break e;m--,v+=s[l++]<<g,g+=8}e.adler=a.check=_(v),v=0,g=0,a.mode=11;case 11:if(0===a.havedict)return e.next_out=d,e.avail_out=k,e.next_in=l,e.avail_in=m,a.hold=v,a.bits=g,2;e.adler=a.check=1,a.mode=b;case b:if(5===t||6===t)break e;case 13:if(a.last){v>>>=7&g,g-=7&g,a.mode=27;break}for(;g<3;){if(0===m)break e;m--,v+=s[l++]<<g,g+=8}switch(a.last=1&v,g-=1,3&(v>>>=1)){case 0:a.mode=14;break;case 1:if(A(a),a.mode=20,6===t){v>>>=2,g-=2;break e}break;case 2:a.mode=17;break;case 3:e.msg="invalid block type",a.mode=p}v>>>=2,g-=2;break;case 14:for(v>>>=7&g,g-=7&g;g<32;){if(0===m)break e;m--,v+=s[l++]<<g,g+=8}if((65535&v)!=(v>>>16^65535)){e.msg="invalid stored block lengths",a.mode=p;break}if(a.length=65535&v,v=0,g=0,a.mode=15,6===t)break e;case 15:a.mode=16;case 16:if(B=a.length){if(B>m&&(B=m),B>k&&(B=k),0===B)break e;i.arraySet(f,s,l,B,d),m-=B,l+=B,k-=B,d+=B,a.length-=B;break}a.mode=b;break;case 17:for(;g<14;){if(0===m)break e;m--,v+=s[l++]<<g,g+=8}if(a.nlen=257+(31&v),v>>>=5,g-=5,a.ndist=1+(31&v),v>>>=5,g-=5,a.ncode=4+(15&v),v>>>=4,g-=4,a.nlen>286||a.ndist>30){e.msg="too many length or distance symbols",a.mode=p;break}a.have=0,a.mode=18;case 18:for(;a.have<a.ncode;){for(;g<3;){if(0===m)break e;m--,v+=s[l++]<<g,g+=8}a.lens[j[a.have++]]=7&v,v>>>=3,g-=3}for(;a.have<19;)a.lens[j[a.have++]]=0;if(a.lencode=a.lendyn,a.lenbits=7,I={bits:a.lenbits},D=c(0,a.lens,0,19,a.lencode,0,a.work,I),a.lenbits=I.bits,D){e.msg="invalid code lengths set",a.mode=p;break}a.have=0,a.mode=19;case 19:for(;a.have<a.nlen+a.ndist;){for(;T=(H=a.lencode[v&(1<<a.lenbits)-1])>>>16&255,O=65535&H,!((R=H>>>24)<=g);){if(0===m)break e;m--,v+=s[l++]<<g,g+=8}if(O<16)v>>>=R,g-=R,a.lens[a.have++]=O;else{if(16===O){for(F=R+2;g<F;){if(0===m)break e;m--,v+=s[l++]<<g,g+=8}if(v>>>=R,g-=R,0===a.have){e.msg="invalid bit length repeat",a.mode=p;break}N=a.lens[a.have-1],B=3+(3&v),v>>>=2,g-=2}else if(17===O){for(F=R+3;g<F;){if(0===m)break e;m--,v+=s[l++]<<g,g+=8}g-=R,N=0,B=3+(7&(v>>>=R)),v>>>=3,g-=3}else{for(F=R+7;g<F;){if(0===m)break e;m--,v+=s[l++]<<g,g+=8}g-=R,N=0,B=11+(127&(v>>>=R)),v>>>=7,g-=7}if(a.have+B>a.nlen+a.ndist){e.msg="invalid bit length repeat",a.mode=p;break}for(;B--;)a.lens[a.have++]=N}}if(a.mode===p)break;if(0===a.lens[256]){e.msg="invalid code -- missing end-of-block",a.mode=p;break}if(a.lenbits=9,I={bits:a.lenbits},D=c(1,a.lens,0,a.nlen,a.lencode,0,a.work,I),a.lenbits=I.bits,D){e.msg="invalid literal/lengths set",a.mode=p;break}if(a.distbits=6,a.distcode=a.distdyn,I={bits:a.distbits},D=c(2,a.lens,a.nlen,a.ndist,a.distcode,0,a.work,I),a.distbits=I.bits,D){e.msg="invalid distances set",a.mode=p;break}if(a.mode=20,6===t)break e;case 20:a.mode=21;case 21:if(m>=6&&k>=258){e.next_out=d,e.avail_out=k,e.next_in=l,e.avail_in=m,a.hold=v,a.bits=g,o(e,x),d=e.next_out,f=e.output,k=e.avail_out,l=e.next_in,s=e.input,m=e.avail_in,v=a.hold,g=a.bits,a.mode===b&&(a.back=-1);break}for(a.back=0;T=(H=a.lencode[v&(1<<a.lenbits)-1])>>>16&255,O=65535&H,!((R=H>>>24)<=g);){if(0===m)break e;m--,v+=s[l++]<<g,g+=8}if(T&&0==(240&T)){for(U=R,L=T,C=O;T=(H=a.lencode[C+((v&(1<<U+L)-1)>>U)])>>>16&255,O=65535&H,!(U+(R=H>>>24)<=g);){if(0===m)break e;m--,v+=s[l++]<<g,g+=8}v>>>=U,g-=U,a.back+=U}if(v>>>=R,g-=R,a.back+=R,a.length=O,0===T){a.mode=26;break}if(32&T){a.back=-1,a.mode=b;break}if(64&T){e.msg="invalid literal/length code",a.mode=p;break}a.extra=15&T,a.mode=22;case 22:if(a.extra){for(F=a.extra;g<F;){if(0===m)break e;m--,v+=s[l++]<<g,g+=8}a.length+=v&(1<<a.extra)-1,v>>>=a.extra,g-=a.extra,a.back+=a.extra}a.was=a.length,a.mode=23;case 23:for(;T=(H=a.distcode[v&(1<<a.distbits)-1])>>>16&255,O=65535&H,!((R=H>>>24)<=g);){if(0===m)break e;m--,v+=s[l++]<<g,g+=8}if(0==(240&T)){for(U=R,L=T,C=O;T=(H=a.distcode[C+((v&(1<<U+L)-1)>>U)])>>>16&255,O=65535&H,!(U+(R=H>>>24)<=g);){if(0===m)break e;m--,v+=s[l++]<<g,g+=8}v>>>=U,g-=U,a.back+=U}if(v>>>=R,g-=R,a.back+=R,64&T){e.msg="invalid distance code",a.mode=p;break}a.offset=O,a.extra=15&T,a.mode=24;case 24:if(a.extra){for(F=a.extra;g<F;){if(0===m)break e;m--,v+=s[l++]<<g,g+=8}a.offset+=v&(1<<a.extra)-1,v>>>=a.extra,g-=a.extra,a.back+=a.extra}if(a.offset>a.dmax){e.msg="invalid distance too far back",a.mode=p;break}a.mode=25;case 25:if(0===k)break e;if(B=x-k,a.offset>B){if((B=a.offset-B)>a.whave&&a.sane){e.msg="invalid distance too far back",a.mode=p;break}B>a.wnext?(B-=a.wnext,E=a.wsize-B):E=a.wnext-B,B>a.length&&(B=a.length),S=a.window}else S=f,E=d-a.offset,B=a.length;B>k&&(B=k),k-=B,a.length-=B;do{f[d++]=S[E++]}while(--B);0===a.length&&(a.mode=21);break;case 26:if(0===k)break e;f[d++]=a.length,k--,a.mode=21;break;case 27:if(a.wrap){for(;g<32;){if(0===m)break e;m--,v|=s[l++]<<g,g+=8}if(x-=k,e.total_out+=x,a.total+=x,x&&(e.adler=a.check=a.flags?r(a.check,f,x,d-x):n(a.check,f,x,d-x)),x=k,(a.flags?v:_(v))!==a.check){e.msg="incorrect data check",a.mode=p;break}v=0,g=0}a.mode=28;case 28:if(a.wrap&&a.flags){for(;g<32;){if(0===m)break e;m--,v+=s[l++]<<g,g+=8}if(v!==(4294967295&a.total)){e.msg="incorrect length check",a.mode=p;break}v=0,g=0}a.mode=29;case 29:D=1;break e;case p:D=-3;break e;case 31:return-4;default:return u}return e.next_out=d,e.avail_out=k,e.next_in=l,e.avail_in=m,a.hold=v,a.bits=g,(a.wsize||x!==e.avail_out&&a.mode<p&&(a.mode<27||4!==t))&&Z(e,e.output,e.next_out,x-e.avail_out)?(a.mode=31,-4):(y-=e.avail_in,x-=e.avail_out,e.total_in+=y,e.total_out+=x,a.total+=x,a.wrap&&x&&(e.adler=a.check=a.flags?r(a.check,f,x,e.next_out-x):n(a.check,f,x,e.next_out-x)),e.data_type=a.bits+(a.last?64:0)+(a.mode===b?128:0)+(20===a.mode||15===a.mode?256:0),(0===y&&0===x||4===t)&&D===h&&(D=-5),D)},inflateEnd:function(e){if(!e||!e.state)return u;var t=e.state;return t.window&&(t.window=null),e.state=null,h},inflateGetHeader:function(e,t){var i;return e&&e.state?0==(2&(i=e.state).wrap)?u:(i.head=t,t.done=!1,h):u},inflateSetDictionary:function(e,t){var i,a=t.length;return e&&e.state?0!==(i=e.state).wrap&&11!==i.mode?u:11===i.mode&&n(1,t,a,0)!==i.check?-3:Z(e,t,a,a)?(i.mode=31,-4):(i.havedict=1,h):u},inflateInfo:"pako inflate (from Nodeca project)"},O=!0,U=!0;try{String.fromCharCode.apply(null,[0])}catch(e){O=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){U=!1}for(var L=new i.Buf8(256),C=0;C<256;C++)L[C]=C>=252?6:C>=248?5:C>=240?4:C>=224?3:C>=192?2:1;L[254]=L[254]=1;var N=function(e){var t,n,a,r,o,s=e.length,f=0;for(r=0;r<s;r++)55296==(64512&(n=e.charCodeAt(r)))&&r+1<s&&56320==(64512&(a=e.charCodeAt(r+1)))&&(n=65536+(n-55296<<10)+(a-56320),r++),f+=n<128?1:n<2048?2:n<65536?3:4;for(t=new i.Buf8(f),o=0,r=0;o<f;r++)55296==(64512&(n=e.charCodeAt(r)))&&r+1<s&&56320==(64512&(a=e.charCodeAt(r+1)))&&(n=65536+(n-55296<<10)+(a-56320),r++),n<128?t[o++]=n:n<2048?(t[o++]=192|n>>>6,t[o++]=128|63&n):n<65536?(t[o++]=224|n>>>12,t[o++]=128|n>>>6&63,t[o++]=128|63&n):(t[o++]=240|n>>>18,t[o++]=128|n>>>12&63,t[o++]=128|n>>>6&63,t[o++]=128|63&n);return t},D=function(e,t){var n,a,r,o,s=t||e.length,f=new Array(2*s);for(a=0,n=0;n<s;)if((r=e[n++])<128)f[a++]=r;else if((o=L[r])>4)f[a++]=65533,n+=o-1;else{for(r&=2===o?31:3===o?15:7;o>1&&n<s;)r=r<<6|63&e[n++],o--;o>1?f[a++]=65533:r<65536?f[a++]=r:(r-=65536,f[a++]=55296|r>>10&1023,f[a++]=56320|1023&r)}return function(e,t){if(t<65537&&(e.subarray&&U||!e.subarray&&O))return String.fromCharCode.apply(null,i.shrinkBuf(e,t));for(var n="",a=0;a<t;a++)n+=String.fromCharCode(e[a]);return n}(f,a)},I=function(e,t){var i;for((t=t||e.length)>e.length&&(t=e.length),i=t-1;i>=0&&128==(192&e[i]);)i--;return i<0||0===i?t:i+L[e[i]]>t?i:t},F={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8},H={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},z=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0},j=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1},M=Object.prototype.toString;function K(e){if(!(this instanceof K))return new K(e);this.options=i.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new z,this.strm.avail_out=0;var n=T.inflateInit2(this.strm,t.windowBits);if(n!==F.Z_OK)throw new Error(H[n]);this.header=new j,T.inflateGetHeader(this.strm,this.header)}function P(e,t){var i=new K(t);if(i.push(e,!0),i.err)throw i.msg||H[i.err];return i.result}K.prototype.push=function(e,t){var n,a,r,o,s,f,l=this.strm,d=this.options.chunkSize,c=this.options.dictionary,h=!1;if(this.ended)return!1;a=t===~~t?t:!0===t?F.Z_FINISH:F.Z_NO_FLUSH,"string"==typeof e?l.input=function(e){for(var t=new i.Buf8(e.length),n=0,a=t.length;n<a;n++)t[n]=e.charCodeAt(n);return t}(e):"[object ArrayBuffer]"===M.call(e)?l.input=new Uint8Array(e):l.input=e,l.next_in=0,l.avail_in=l.input.length;do{if(0===l.avail_out&&(l.output=new i.Buf8(d),l.next_out=0,l.avail_out=d),(n=T.inflate(l,F.Z_NO_FLUSH))===F.Z_NEED_DICT&&c&&(f="string"==typeof c?N(c):"[object ArrayBuffer]"===M.call(c)?new Uint8Array(c):c,n=T.inflateSetDictionary(this.strm,f)),n===F.Z_BUF_ERROR&&!0===h&&(n=F.Z_OK,h=!1),n!==F.Z_STREAM_END&&n!==F.Z_OK)return this.onEnd(n),this.ended=!0,!1;l.next_out&&(0!==l.avail_out&&n!==F.Z_STREAM_END&&(0!==l.avail_in||a!==F.Z_FINISH&&a!==F.Z_SYNC_FLUSH)||("string"===this.options.to?(r=I(l.output,l.next_out),o=l.next_out-r,s=D(l.output,r),l.next_out=o,l.avail_out=d-o,o&&i.arraySet(l.output,l.output,r,o,0),this.onData(s)):this.onData(i.shrinkBuf(l.output,l.next_out)))),0===l.avail_in&&0===l.avail_out&&(h=!0)}while((l.avail_in>0||0===l.avail_out)&&n!==F.Z_STREAM_END);return n===F.Z_STREAM_END&&(a=F.Z_FINISH),a===F.Z_FINISH?(n=T.inflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===F.Z_OK):a!==F.Z_SYNC_FLUSH||(this.onEnd(F.Z_OK),l.avail_out=0,!0)},K.prototype.onData=function(e){this.chunks.push(e)},K.prototype.onEnd=function(e){e===F.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var J={Inflate:K,inflate:P,inflateRaw:function(e,t){return(t=t||{}).raw=!0,P(e,t)},ungzip:P},Y=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.dataView=new DataView(t),this.position=0}return e.prototype.skip=function(e){this.position+=e},e.prototype.readBytes=function(e){var t=4===e?"getUint32":2===e?"getUint16":"getUint8",i=this.position;return this.position+=e,this.dataView[t](i,!0)},e}(),G=function(e){for(var t=new Y(e),i={};;){var n=t.readBytes(4);if(67324752!==n){if(33639248!==n)break;V(t)}else{var a=$(t);i[a.name]={buffer:a.buffer}}}return i},$=function(e){var t=0,i=void 0;e.skip(4);var n=e.readBytes(2);e.skip(8);var a=e.readBytes(4);e.skip(4);var r=e.readBytes(2),o=e.readBytes(2),s=[],f=new Uint8Array(a);for(t=0;t<r;t++)s.push(String.fromCharCode(e.readBytes(1)));for(e.skip(o),t=0;t<a;t++)f[t]=e.readBytes(1);switch(n){case 0:i=f;break;case 8:i=new Uint8Array(J.inflate(f,{raw:!0}));break;default:console.log(s.join("")+": unsupported compression type"),i=f}return{name:s.join(""),buffer:i}},V=function(e){e.skip(24);var t=e.readBytes(2),i=e.readBytes(2),n=e.readBytes(2);e.skip(12),e.skip(t),e.skip(i),e.skip(n)},X="function"==typeof Promise?Promise:function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var i=function(){};return t((function(){i()})),{then:function(e){i=e}}},q=0,W=void 0,Q=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._id=q,this._listeners={},this.url=t,this.files=null,q++}return e.unzip=function(t){return new X((function(i){var n=new e,a=new FileReader;a.onload=function(e){var t=e.target.result;n.files=G(t),i(n)},t instanceof Blob&&a.readAsArrayBuffer(t)}))},e.prototype.load=function(){var e=this;return new X((function(t){var i=Date.now(),n=new XMLHttpRequest;n.open("GET",e.url,!0),n.responseType="arraybuffer",n.onprogress=function(t){e.dispatch({type:"progress",loaded:t.loaded,total:t.total,elapsedTime:Date.now()-i})},n.onload=function(){e.files=G(n.response),e.dispatch({type:"load",elapsedTime:Date.now()-i}),t()},n.send()}))},e.prototype.extractAsBlobUrl=function(e,t){if(this.files[e].url)return this.files[e].url;var i=new Blob([this.files[e].buffer],{type:t});return this.files[e].url=URL.createObjectURL(i),this.files[e].url},e.prototype.extractAsText=function(e){var t=this.files[e].buffer;if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(t);for(var i="",n=0,a=t.length;n<a;n++)i+=String.fromCharCode(t[n]);return decodeURIComponent(escape(i))},e.prototype.extractAsJSON=function(e){return JSON.parse(this.extractAsText(e))},e.prototype.loadThreeJSON=function(e){var t=this,i=this.extractAsJSON(e),n=e.replace(/\\/.+\\.json$/,"/"),a="__ziploader_"+this._id+"__",r=new RegExp(a);return-1!==!W.Loader.Handlers.handlers.indexOf(r)&&W.Loader.Handlers.add(r,{load:function(e){return t.loadThreeTexture(e.replace(r,""))}}),W.JSONLoader.prototype.parse(i,a+n)},e.prototype.loadThreeTexture=function(e){var t=new W.Texture,i=/\\.jpg$/.test(e)?"image/jpeg":/\\.png$/.test(e)?"image/png":/\\.gif$/.test(e)?"image/gif":void 0,n=new Blob([this.files[e].buffer],{type:i});return t.image=new Image,t.image.addEventListener("load",(function e(){t.needsUpdate=!0,t.image.removeEventListener("load",e),URL.revokeObjectURL(t.image.src)})),t.image.src=URL.createObjectURL(n),t},e.prototype.on=function(e,t){this._listeners[e]||(this._listeners[e]=[]),-1===this._listeners[e].indexOf(t)&&this._listeners[e].push(t)},e.prototype.off=function(e,t){var i=this._listeners[e];if(i){var n=i.indexOf(t);-1!==n&&i.splice(n,1)}},e.prototype.dispatch=function(e){var t=this._listeners[e.type];if(t){e.target=this;for(var i=t.length,n=0;n<i;n++)t[n].call(this,e)}},e.prototype.clear=function(e){if(e)return URL.revokeObjectURL(this.files[e].url),void delete this.files[e];for(var t in this.files)URL.revokeObjectURL(this.files[t].url);if(delete this.files,W){var i="__ziploader_"+this._id+"__";W.Loader.Handlers.handlers.some((function(e,t){if(e instanceof RegExp&&e.source===i)return W.Loader.Handlers.handlers.splice(t,2),!0}))}},e.install=function(e){e.THREE&&(W=e.THREE)},e}();function ee(e,t,i,n,a,r,o){try{var s=e[r](o),f=s.value}catch(e){return void i(e)}s.done?t(f):Promise.resolve(f).then(n,a)}function te(e){return function(){var t=this,i=arguments;return new Promise((function(n,a){var r=e.apply(t,i);function o(e){ee(r,n,a,o,s,"next",e)}function s(e){ee(r,n,a,o,s,"throw",e)}o(void 0)}))}}function ie(){return(ie=te((function*(e){const t=new Q(e);return t.load().then((()=>{const e={},i=i=>(e[i]=e[i]||t.extractAsBlobUrl(i),e[i]),n=JSON.parse(t.extractAsText("scene.gltf"));return n.buffers&&n.buffers.forEach((e=>e.uri=i(e.uri))),n.images&&n.images.forEach((e=>e.uri=i(e.uri))),e["scene.gtlf"]=URL.createObjectURL(new Blob([JSON.stringify(n,null,2)],{type:"text/plain"})),e}))}))).apply(this,arguments)}self.onmessage=function(){var e=te((function*(e){try{const t=yield function(e){return ie.apply(this,arguments)}(e.data.payload);self.postMessage({id:e.data.id,result:t})}catch(t){self.postMessage({id:e.data.id,err:t.message})}}));return function(t){return e.apply(this,arguments)}}()}();\n',"Worker",void 0,void 0)});function fa(e,t,n){if(AFRAME.components[t])if(AFRAME.components[t].multiple&&Array.isArray(n))for(let i=0;i<n.length;i++)e.setAttribute(t+"__"+i,n[i]);else e.setAttribute(t,n);else console.warn(`Inflator failed. "${t}" component does not exist.`)}function ga(e){const t=Ro(e.scene);return{animations:t.animations,scene:t}}function va(e){const t=e.userData.gltfExtensions&&(e.userData.gltfExtensions.MOZ_hubs_components||e.userData.gltfExtensions.HUBS_components),n=e.userData.components;return t||n}function ba(e){const t=e.material;return t?va(t):null}AFRAME.GLTFModelPlus={components:{},registerComponent(e,t,n){n=n||fa,AFRAME.GLTFModelPlus.components[e]={inflator:n,componentName:t}}};const ya=function(e,t,n,i,r){void 0===r&&(r=1),"Chest"===t.name?t.name="Spine":"Root Scene"===t.name?t.name="AvatarRoot":"Bot_Skinned"===t.name&&(t.name="AvatarMesh");const o=[],s=t.children.slice(0);for(const t of s){const i=ya(e,t,n);i&&o.push(i)}const a=va(t),l=ba(t);if(!(a||l||t.name in n||o.length||i))return null;const c=document.createElement("a-entity");c.append.apply(c,o);const d=(t.name||t.uuid).replace(/[^\w-]/g,"");c.classList.add(d),"YXZ"!==t.rotation.order&&t.rotation.setFromQuaternion(t.quaternion,"YXZ"),c.object3D.position.copy(t.position),c.object3D.rotation.copy(t.rotation),c.object3D.scale.copy(t.scale).multiplyScalar(r),c.object3D.matrixNeedsUpdate=!0,t.matrixAutoUpdate=!1,t.matrix.identity(),t.matrix.decompose(t.position,t.rotation,t.scale),c.setObject3D(t.type.toLowerCase(),t),a&&"nav-mesh"in a&&c.setObject3D("mesh",t),c.object3D.name=t.name,c.object3D.uuid=t.uuid,t.uuid=ca.MathUtils.generateUUID(),t.animations&&(t.parent.animations=t.animations),t.morphTargetInfluences&&(t.parent.morphTargetInfluences=t.morphTargetInfluences);const u=t.userData.gltfIndex;return void 0!==u&&(e[u]=c),c};function wa(){return wa=ua((function*(e,t){let n=!0;const i=[];e.object3D.traverse(function(){var e=ua((function*(e){const r={};r.promise=new Promise((e=>r.resolve=e)),i.push(r),n||(yield i.shift().promise),n=!1;const o=va(e),s=e.el;function a(e){for(const n in e){const i=e[n];"node"===(null==i?void 0:i.__mhc_link_type)&&void 0!==i.index&&(t[i.index]?e[n]=t[i.index].object3D:(console.warn("inflateComponents: invalid node reference",n),e[n]=null))}return e}if(o&&s)for(const e in o)if(Object.prototype.hasOwnProperty.call(o,e)&&Object.prototype.hasOwnProperty.call(AFRAME.GLTFModelPlus.components,e)){const{componentName:n,inflator:i}=AFRAME.GLTFModelPlus.components[e];yield i(s,n,a(o[e]),o,t)}const l=ba(e);if(l&&s)for(const e in l)if(Object.prototype.hasOwnProperty.call(l,e)&&Object.prototype.hasOwnProperty.call(AFRAME.GLTFModelPlus.components,e)){const{componentName:n,inflator:i}=AFRAME.GLTFModelPlus.components[e];yield i(s,n,a(l[e]),l,t)}r.resolve()}));return function(t){return e.apply(this,arguments)}}()),yield i.shift().promise})),wa.apply(this,arguments)}function _a(e,t,n){const i=e.querySelectorAll("."+t);for(const e of i){const t=n.cloneNode(!0);for(const{name:n,value:i}of t.attributes)e.setAttribute(n,i);for(;t.children.length>0;)e.appendChild(t.children[0])}}function Ea(e){return e.extensions&&e.extensions.MOZ_hubs_components?e.extensions.MOZ_hubs_components:e.extensions&&e.extensions.HUBS_components?e.extensions.HUBS_components:e.extras&&e.extras.gltfExtensions&&e.extras.gltfExtensions.MOZ_hubs_components?e.extras.gltfExtensions.MOZ_hubs_components:void 0}const Aa=e=>{const t=window.APP.store.state.preferences.materialQualitySetting;return fo(e,(e=>yo(e,t))),e};let Sa,xa;class Ma{constructor(e,t){this.parser=e,this.jsonPreprocessor=t,this.name="MOZ_hubs_plugin",e.textureLoader=new Ds(e.options.manager)}beforeRoot(){const e=this.parser,t=this.jsonPreprocessor;t&&(e.json=t(e.json));let n=0;e.json.extensions&&e.json.extensions.MOZ_hubs_components&&Object.prototype.hasOwnProperty.call(e.json.extensions.MOZ_hubs_components,"version")&&(n=e.json.extensions.MOZ_hubs_components.version),function(e,t){if(e<2){const e=t.nodes.find((e=>{const t=Ea(e);return t&&t.heightfield&&t["nav-mesh"]}));e&&(e.extensions&&e.extensions.MOZ_hubs_components?delete e.extensions.MOZ_hubs_components.heightfield:e.extensions&&e.extensions.HUBS_components?delete e.extensions.HUBS_components.heightfield:e.extras&&e.extras.gltfExtensions&&e.extras.gltfExtensions.MOZ_hubs_components&&delete e.extras.gltfExtensions.MOZ_hubs_components)}if(e<4&&t.nodes)for(const e of t.nodes){const t=Ea(e);if(!t)continue;const n=t["spot-light"]||t["point-light"];n&&0===n.range&&(n.decay=0)}}(n,e.json);const i=e.json.nodes;if(i)for(let e=0;e<i.length;e++){const t=i[e];t.extras||(t.extras={}),t.extras.gltfIndex=e}}afterRoot(e){if(e.scene.traverse((e=>{e.matrixAutoUpdate=ca.Object3D.DefaultMatrixAutoUpdate,Aa(e)})),e.animations)for(const t of e.animations)for(const n of t.tracks){const t=ca.PropertyBinding.parseTrackName(n.name);for(const i of e.scenes){const e=ca.PropertyBinding.findNode(i,t.nodeName);if(e){n.name=n.name.replace(/^[^.]*\./,e.uuid+".");break}}}e.scene.animations=e.animations}}class Pa{constructor(e){this.parser=e,this.name="MOZ_hubs_components"}afterRoot(e){let{scenes:t,parser:n}=e;const i=[],r=(e,t)=>{var r,o;const s=null===(r=n.associations.get(t))||void 0===r?void 0:r[e];if(void 0===s)return;const a=null===(o=n.json[e][s].extensions)||void 0===o?void 0:o[this.name];if(a){t.userData.gltfExtensions=Object.assign(t.userData.gltfExtensions||{},{MOZ_hubs_components:a});for(const e in a){const t=a[e];for(const r in t){("video-texture-target"===e&&"srcNode"===r||"audio-target"===e&&"srcNode"===r)&&"number"==typeof t[r]&&(console.warn(`Found an outdated ${e} 'srcNode' property, fixing. Make sure you are using the latest exporter.`),t[r]={__mhc_link_type:"node",index:t[r]});const o=t[r],s=null==o?void 0:o.__mhc_link_type;s&&void 0!==o.index&&i.push(n.getDependency(s,o.index).then((e=>{var i;if("node"!==s)return"texture"!==s||null!==(i=n.json.textures[o.index].extensions)&&void 0!==i&&i.MOZ_texture_rgbe||(e.encoding=ca.sRGBEncoding),t[r]=e,e})))}}}};for(let e=0;e<t.length;e++)n.associations.set(t[e],{scenes:e}),t[e].traverse((e=>{r("scenes",e),r("nodes",e),go(e,r.bind(this,"materials"))}));return Promise.all(i)}}class Ca{constructor(e){this.parser=e,this.name="MOZ_lightmap"}loadMaterial(e){const t=this.parser,n=t.json.materials[e];if(!n.extensions||!n.extensions[this.name])return null;const i=n.extensions[this.name],r=[];return r.push(t.loadMaterial(e)),r.push(t.getDependency("texture",i.index)),Promise.all(r).then((e=>{const t=e[0],n=e[1];return t.lightMap=n,t.lightMapIntensity=void 0!==i.intensity?i.intensity:1,t.isMeshBasicMaterial&&(t.lightMapIntensity*=Math.PI),t}))}}class ka{constructor(e){this.parser=e,this.name="MOZ_HUBS_texture_basis",this.basisLoader=null}loadTexture(e){const t=this.parser,n=t.json.textures[e];if(!n.extensions||!n.extensions[this.name])return null;if(null===this.basisLoader&&(this.basisLoader=new Ss.g(t.options.manager).detectSupport(AFRAME.scenes[0].renderer)),!this.basisLoader)return null;console.warn(`The ${this.name} extension is deprecated, you should use KHR_texture_basisu instead.`);const i=n.extensions[this.name].source;return t.loadTextureImage(e,i,this.basisLoader)}}class Oa{constructor(e,t){this.parser=e,this.loader=t,this.name="MOZ_texture_rgbe"}loadTexture(e){const t=this.parser,n=t.json.textures[e];if(!n.extensions||!n.extensions[this.name])return null;const i=n.extensions[this.name].source;return t.loadTextureImage(e,i,this.loader).then((e=>(e.minFilter==ca.NearestMipmapNearestFilter||e.minFilter==ca.NearestMipmapLinearFilter?e.minFilter=ca.NearestFilter:e.minFilter!=ca.LinearMipmapNearestFilter&&e.minFilter!=ca.LinearMipmapLinearFilter||(e.minFilter=ca.LinearFilter),e)))}}function Ta(e,t,n,i){return Ra.apply(this,arguments)}function Ra(){return Ra=ua((function*(e,t,n,i){let r,o=e;t&&(t.includes("model/gltf+zip")||t.includes("application/x-zip-compressed"))&&(r=yield ma(o),o=r["scene.gtlf"]);const s=(0,z.Z)("rangerequests"),a=new ca.LoadingManager;a.setURLModifier(qs(o));const l=new Ms.E(a);return l.register((e=>new Pa(e))).register((e=>new Ma(e,i))).register((e=>new Ca(e))).register((e=>new ka(e))).register((e=>new Oa(e,(new Cs.x).setDataType(ca.HalfFloatType)))).register((e=>new Es.Z(e,{loadingMode:s?"progressive":"all",onLoadMesh:(e,t,n,i)=>{if(!s)return t;if(n===i||0===e.levels.length)return t;let r=null;for(let t=i;t>n;t--)if("Object3D"!==e.levels[t].object.type){r=t;break}if(null===r)return t;t=t.clone(),Aa(t);const o=t.material.onBeforeRender;return t.material=t.material.clone(),t.material.onBeforeRender=o,t.material.onBeforeCompile=e.levels[r].object.material.onBeforeCompile,t}}))),!Sa&&AFRAME&&AFRAME.scenes&&AFRAME.scenes[0]&&(Sa=new Ps.a(a).detectSupport(AFRAME.scenes[0].renderer)),!xa&&AFRAME&&AFRAME.scenes&&AFRAME.scenes[0]&&(xa=new xs._(a)),Sa&&l.setKTX2Loader(Sa),xa&&l.setDRACOLoader(xa),new Promise(((e,t)=>{const i=t=>{const n=new Set;t.scenes.forEach((e=>{e.traverse((e=>{var t;e.geometry&&n.add(e.geometry),go(e,(function(e){n.add(e)}));const i=null===(t=e.userData.gltfExtensions)||void 0===t?void 0:t.MOZ_hubs_components;if(i)for(const e in i){const t=i[e];for(const e in t){const i=t[e];i&&(i.isTexture||i.isGeometry)&&n.add(i)}}})),e.associations=t.parser.associations,e.dispose=function(){n.forEach((e=>{e.isMaterial?xo(e):e.dispose()}))}})),e(t)};s?_s.Z.load(o,l,i,n,t):l.load(o,i,n,t)})).finally((()=>{r&&Object.keys(r).forEach(URL.revokeObjectURL)}))})),Ra.apply(this,arguments)}function Da(e){if(ha.has(e))return ha.retain(e),ga(ha.get(e).gltf);throw new Error(`Model not in cache: ${e}`)}function ja(e){return La.apply(this,arguments)}function La(){return(La=ua((function*(e,t,n,i){if(void 0===t&&(t=null),void 0===n&&(n=!1),void 0===i&&(i=null),console.log(`Loading model ${e}`),n){if(ha.has(e))return ha.retain(e),ga(ha.get(e).gltf);if(pa.has(e)){const t=yield pa.get(e);return ha.retain(e),ga(t)}{const n=Ta(e,t,null,i);pa.set(e,n);const r=yield n;return pa.delete(e),ha.set(e,r),ga(r)}}return Ta(e,t,null,i)}))).apply(this,arguments)}function Ia(e){if(e&&"#"===e.charAt(0)){const t=document.getElementById(e.substring(1));if(t)return t.getAttribute("src")}return e}AFRAME.registerComponent("gltf-model-plus",{schema:{src:{type:"string"},contentType:{type:"string"},useCache:{default:!0},inflate:{default:!1},modelToWorldScale:{type:"number",default:1}},init(){this.jsonPreprocessor=null,this.loadTemplates()},play(){this.el.components["listed-media"]&&this.el.sceneEl.emit("listed_media_changed")},update(){this.applySrc(Ia(this.data.src),this.data.contentType)},remove(){if(this.data.useCache){const e=Ia(this.data.src);e&&ha.release(e)}},loadTemplates(){this.templates={},this.el.querySelectorAll(":scope > template").forEach((e=>{const t=document.importNode(e.firstElementChild||e.content.firstElementChild,!0);this.templates[e.getAttribute("data-name")]=t}))},applySrc(e,t){var n=this;return ua((function*(){try{if(e===n.lastSrc)return;const i=n.lastSrc;if(n.lastSrc=e,!e)return void(n.inflatedEl&&(console.warn("gltf-model-plus set to an empty source, unloading inflated model."),n.disposeLastInflatedEl()));n.el.emit("model-loading");const r=yield ja(e,t,n.data.useCache,n.jsonPreprocessor);if(e!=n.lastSrc)return;n.disposeLastInflatedEl(),n.model=r.scene,r.animations.length>0?(n.el.setAttribute("animation-mixer",{}),n.el.components["animation-mixer"].initMixer(r.animations)):n.model.traverse((e=>{const t=e.isMesh&&e.geometry.isBufferGeometry,n=t&&e.geometry.boundsTree;if(t&&!n&&e.geometry.attributes.position){const t=e.geometry;if(t.attributes.position.isInterleavedBufferAttribute||t.index&&t.index.isInterleavedBufferAttribute)return void console.warn("Skipping generaton of MeshBVH for interleaved geoemtry as it is not supported");const n=t.index?t.index.count/3:t.attributes.position.count/3;n>1e3&&n<1e6&&(t.boundsTree=new As.rk(e.geometry,{strategy:0,maxDepth:30}))}}));const o={};let s=n.model;if(n.data.inflate&&(n.inflatedEl=ya(o,n.model,n.templates,!0,n.data.modelToWorldScale))){if(n.el.appendChild(n.inflatedEl),s=n.inflatedEl.object3D,s.visible=!1,yield Ji(),e!=n.lastSrc)return;yield function(e,t){return wa.apply(this,arguments)}(n.inflatedEl,o);for(const e in n.templates)_a(n.el,e,n.templates[e])}const a=[];s.traverse((e=>{const t=e.el;t&&a.push((()=>e.el=t))})),i&&n.data.useCache&&ha.release(i),n.el.setObject3D("mesh",s),a.forEach((e=>e())),s.visible=!0,n.el.emit("model-loaded",{format:"gltf",model:s})}catch(t){ha.release(e),console.error("Failed to load glTF model",t,n),n.el.emit("model-error",{format:"gltf",src:e})}}))()},disposeLastInflatedEl(){this.inflatedEl&&(this.inflatedEl.parentNode.removeChild(this.inflatedEl),this.inflatedEl.object3D.traverse((e=>{e.material&&e.material.dispose&&e.material.dispose(),e.geometry&&(e.geometry.dispose&&e.geometry.dispose(),e.geometry.boundsTree=null)})),delete this.inflatedEl,this.el.removeAttribute("animation-mixer"))}});var Na=n(56983);let Fa,Ba,Va;!function(e){e[e.BOX=0]="BOX",e[e.CYLINDER=1]="CYLINDER",e[e.SPHERE=2]="SPHERE",e[e.CAPSULE=3]="CAPSULE",e[e.CONE=4]="CONE",e[e.HULL=5]="HULL",e[e.HACD=6]="HACD",e[e.VHACD=7]="VHACD",e[e.MESH=8]="MESH",e[e.HEIGHTFIELD=9]="HEIGHTFIELD"}(Fa||(Fa={})),function(e){e[e.ALL=0]="ALL",e[e.MANUAL=1]="MANUAL"}(Ba||(Ba={})),function(e){e[e.X=0]="X",e[e.Y=1]="Y",e[e.Z=2]="Z"}(Va||(Va={}));const Ua={type:Fa.HULL,fit:Ba.ALL,halfExtents:[1,1,1],minHalfExtent:0,maxHalfExtent:Number.POSITIVE_INFINITY,sphereRadius:NaN,cylinderAxis:Va.Y,margin:.01,offset:[0,0,0],orientation:[0,0,0,1],heightfieldData:[],heightfieldDistance:1,includeInvisible:!1},Ha={INCLUDE_INVISIBLE:1},za=e=>Object.values(Na.tl.SHAPE)[In.type[e]],Wa=e=>Object.values(Na.tl.FIT)[In.fit[e]],qa=e=>{switch(In.cylinderAxis[e]){case Va.X:return"x";case Va.Y:return"y";case Va.Z:return"z"}};function Za(e,t,n){const i=Object.assign({},Ua,n);return(0,Ot.addComponent)(e,In,t),In.type[t]=i.type,In.fit[t]=i.fit,In.halfExtents[t].set(i.halfExtents),In.minHalfExtent[t]=i.minHalfExtent,In.maxHalfExtent[t]=i.maxHalfExtent,In.sphereRadius[t]=i.sphereRadius,In.cylinderAxis[t]=i.cylinderAxis,In.margin[t]=i.margin,In.offset[t].set(i.offset),In.heightfieldData[t]=i.heightfieldData.slice(),In.heightfieldDistance[t]=i.heightfieldDistance,In.orientation[t].set(i.orientation),n.includeInvisible&&(In.flags[t]|=Ha.INCLUDE_INVISIBLE),t}var Ga=n(21896);let Ya;!function(e){e.FLAT="flat",e.SPHERE_EQUIRECTANGULAR="360-equirectangular"}(Ya||(Ya={}));var Qa=n(99477);const Xa=new Image;Xa.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAABLAAAAV4CAMAAACHM9SQAAAAVFBMVEUAAADu7u45OTlmZmbExMTa2tqqqqoeHh739/eMjIyKiooAAAC3t7dRUVHk5OR6enqbm5vPz883NzecnJzFxcUAAAAAAAAAAAAAAAAAAAAAAAD///+BLmiLAAAAG3RSTlN/74+fz9+/h/evrwDHl+ent9ePt89xNyBRYgrhA2luAABGR0lEQVR42uzcu23EQAxAQeaM96Ptv1A7sGUDwl16JDBTxAPJFRT5tOa+RgB8yLj2XPkUj1ptrQIKGHu9D9aZagWUMeabYC25AkoZ80WwzhUAxeyTtzBeAaWN9QzWDICS5h0svQKqm7/B0iugvPk/WCsAClt/wTru7UBp49zB2gFQ2pXfwgEL6GD9BMtCCJQ3TmYYsIAWZmYYsIAWRmb4pAHoYWV4IgR62Bk2QqCHkWEjBJpY4Y0QaGKGExbQxA6/GQWauMLNHWhCrgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAC+2IMDAQAAAAAg/9dGUFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVUV9uBAAAAAAADI/7URVFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVWFnTtKbRCKoih61YgarCa0f3f+8yzmu6BgjM+y1jA2hwMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD8b90wzM1LvegCoFRd/qGvFu3L87a4B8DpptziEQCnG3OLJgBON+QGfQCcr84N2gAoQC9hAVfR5rqvACjAKGEBVzHnqmcAlKDLVWajQCEqCQu4iluuqAKgDI9ccQuA/erYr5GwgA9o+vsHqnsdAHt9Z06x3yRhAQfrft70ozBKWMCx6ikX7eGHDXMA7NJUb7uqqiWsX/buLMdtGAjCsEiKiwbUBj/y/vcMEsBZx2MH7tJi/98d3CgVaTYApUu7iuIHG6YOAJ6Qa/slaB9sqB0APFlfGUasSoUFQCS49ocgfbCBzV8ADOors4jleR0ZgEKugnM8R4UFwJ6fFFc7VxZ8ATA3OknPtLSbOgAwqa+uUvecQIUFwFhtN5SserAhdQDwRH0lmCsTFRYAQX0liVg9C74ACOorScQaqLAACOorScQa2VEPQFBfaSJWYcEXAEF9JYlYkQoLgKC+kuy2qeyoByCoryS7IoaTLfjyPoRhGJZ0tQzDHILnbQlgTz62K2XE8qeosPI4L7WPrrTbyhT7tISR0QVsz6/tQbF7Rjn2gi8/L/1U2v8osV/C0UYu8OpSe1DonrAetcLK451RdW9s1YXr+sB2ZrdBxFqOWGH5oU7NQqwzy3+AbXinj1jhaAu+/NC7Zsn1HwwtYAO5yiNWPlKFlUN1TcH1M2U8IHeRRyx3lB31eYmlCUWCFqDmnThi9YdY8OVTbHpT4vQQkPJRG7GW/SusnGLbiqvkLEAptbt6wwcbpm5TeYltWxPfhsAd4vsN3u7qaO02FNbSdrDufnMDeF03iiybKRN3q7ByKm0vridmASJZ+JBf3WlHfehL21WcOwASF9lDfsMuFVaIbX/ug9tZgIR3oojlH/u4fJVvQb4MgS34KIpY5d4NiZcdVz8wsgCJpIlY69cV1muPK0YWoDI7RcRavrw0//LjipEFiHgniFjh9th7j3HFyAI0crWPWHmrCuty2HHFyAI0UrulGDzYUDqZMLVjc6kDYGx01uso+g0qLH+Ee1f3OP6xA2z223fPt+5LJ5FTOwfHdyFgLdm+MjOqK6zZtdOgygKsDcX0Ib/yT4X1dl+DfBcCOt5ZRqz494Kv9zkb/MxKyAJs5WoYsaquwhqPfjb4Kc4LAWPJLmINsh31ZynbKd8BsdFZRSwvWvDlTxmvCFmAgo9WEav8rLDeu736XSRkAbaSUcRaBTvq87kOBzkuBOSGYrKOYrFf8BVOdPfqlp4HSQFT3lls/ArtO0fb/o29u8ttHIQCKAwGG1zZxEnm7e5/n6OOlCqZxo7/giGcbwWtqtzCCca0d+CtnJVHbvWFDbbUs6ITrgrAG0NWs/rChi+2g791bAuBXfV680V+ds+EdZVPwrYQGLf9vFOzsrqH3c7gfxZtFIA9NRuXWL2I2OIPi3KIFIij9ds+X17kRL4a0ykAe6r0piVWLeLIV6MCIQvYlbNbllidBPIV6R2Ip9mwxGqlI18xsYCIer36XqtKDPlqkufLQmBfVVh9T4x35KsXeBga2Fmz9rM1kK843gDE1vp1t8w48hUTC4iu0jMv8uMuGSYWcDhnZy+xeHiQiQUcrZm5xOLhQSYWcLxev15i8aYJJhaQhipMLbHIV0wsIClNrUaQr5hYQGraXj1DvuLeZKBIpeUrzrwD+SovX/3oFYCslJivbjx3NwA5KTRfcdsMkKFi89WN5vVfQC4Kzlc3tQKQhZLzFW+mQLHONscUUni+4jgWShVEztndvFt8vvqR3Z8O2MLJN53XMUTyFV8VokxGJLuRRb66E/iqEAUZ5EZ3efyzJl8R3lEsK3dy6O/kK8I7yhXkgU094iaQr7TWof4W9PE/DM/ooCjyv5B0zLrKUbw+d8NXf3Hq0aU3X42tvSzDiXdgOSN3ku/vB+UrbYfTRb3gTNstG1tkLGChQZ7RTZK7jCPyVd2dnJqvH85a5uJyLGBDc0+8v0fPV7ozTi3Xt2cvr5GxgE3NPe3+fpWo6uGi1jNWy0s8Bg0sI1PqhHYacfNVPTj1TzYzi7MNKICROyn395j5yje92kdbywQ2hcCG5p5wfzdeYqmN2lE1ucxiUwisbu7p9verROI7o/bWahnHphCYL8gstlcHcn8kDt849Q6mlhFsCoGVzT3V/j6er/IYV9+MlWfYFAJrm3ui/d15eS6fcTW+ymJTCMw3yBL6WqnZMgtYnVPP5dSyPM8U4qNZuZNsf+/k3eqxRpfZyOKZQny0IJLByHJB3kobFUll5QlueAdmkTXqk4qs0vIot93g5K9CdweWN/eU+/tf9u52O1EYCMBwEsiHHMAK/pv7v889Wwu1q6vgoiaz73MFtudok7fj0MnT9JV5rSAX6O7AAh/yKNs4c1cJ4b01ixRzyKK7Q69WHmdvxqysXmoO9eplh6xgAKW8nMm8v/cyK7Ne3drsxbw7cF9mXxR+8UUqfZi3cV6epTaASp2cyb6/d0k2ZTuzWhHXws4AGu3kTP79fZQt+Wjea5/kHKMNwIqQXUB/b3W16Z+XXKZHgRXNvYT+7mUjKYtFqvMaCo5YwMLmnueizuuiVZGvZvEgJxyxgFXNvYz+3iUV+erylssRC7hjJ1uzTTQ/ZPmas1ppEOSEIxbwvL/uyVrbe3+o6zqE8NE0TVVVwzBE81NWL/rt01c3PrE4YgH/mLC/P5TaEELTNPuq6oZhMI/IJLznkq+uf2IxiwX8zXxU8t7Xp6NSMx+V8sk8m4b3PsMvrgT5xLg7cMswmBK5pCRfzYJMWNoAaLOTR2WWry7DnKrBWAC/BS35anYUEY5YgE4HLfnq/tZ6dadJ4L8TbUG7r1Z8r5DJBkAjl7QdOD5/IoZHAZX2skrK/91byUnJ2+oBXBe05KtZECG7A0odZbG6jLfuQUTI7oBK0WobSYqW7A5o5ZKWfDXphOwOaFXJAraEfHW+tZ7sDug0qslXEy9bSgZAPo5a8tXEJe6EgFaxl1vS3pRmZMkMoJazWvLVxDOKBahVFfGoiRVc4k4IqDVqyVeTwJ0Q0KvN+Empbx8f5f+EQF5iX9auvrsq7oSAXs4qyVcTz+wooFen7F3qZDvWAMjLmPWTUtdreUAhoFirJF99iYkdM4BiXia+xGnRPwV2zACKOasjX32JiWF3QLEuqboABQYbAM1GHfnqS0wMNgBv05mna8t41MRCtWylNwBWCdKYp9tpqjWVbEbTrwV4vngUSWpuazflOO5OxAJWcLbY5VSr5HrEImIBy1WJgaBHJCaxgJcL/KV/TGDFDPBi8SjfRoPlIl8nBF7LWd4578/uxe4yBH6xd0fJbcJQAEUhcWWYaU3pr/a/z04/PE2pwIqjwIt9zhKciWwukt6uXocHmApxmFF1hx0lmxhD7Hb3qUNFvvJlH+OZUHWH9+Qr4f3YZ8JfHbCdr+y7DvNMqLrDpvRY45jrhXwm9CAOFfmq6OIwbq2fuY25A9bzlWnEocbnGJ0DVflKeP+QPrfRAWXJhSfh5n15TQg1+apsEN733dgwdcB2vhLew0SsR5nNAVfN85XwHidi2dcAH7rCKXU0mEXh+wHuzlduGv8j4E4sx59hI18J77FudrcRC4r5ql4vvN92thELPkFyYOSveNXdRiwo5yvhvaXZte7Q2EtvP+Nb8fa6e8UBpXwlvHddwL3ubsSCQr4S3hubbHWHw/OVqcT3H86RC+H+fOU/6VM5mwPH5yt1pVLvbA4cn6+uBm/cN10sWBAgXwnvVWa3ukOEfCW81zj5jCFEvlKEK3y3YEGIfGUqRYVkwYIY+Up4vy25XwaC5CvjoG8aLVgQJV95ZLFgwVLEpxTh3YIFBZHzlfBuwYJ/Rc5X7pizYMFbsfOV8L5pNDYHIuUr46C3jF5qwH3Oc14Q3pcsWBBDMV8J70sRf9NasHg605DXmZVwZcGCAFIuEd7/F/Dws/uweC7nOe/gYsFaOlmwIFy+Ut1XfDOEAuLlK7OoLFjwZfJV7hX3kt4gVZCvvorcxNTBc9gnX51scy96sV8E3uFHn1fIVzt4dbIc6o15B4MfAGum3ITfrzyFlFfYLloU9Q/QwW/27na3URiIwnBswJiVCWHVf+f+73O1kaq2wQVc5WNw3+cWotieYzPzCyTlEV+tszZHlXZY+AU2e4vyRCjP3KR6PiVE/fqzHi9y4b5KTKoHzDxnIL5aN3KKBcysVzPx1bpBPHQHjKxXbPxbEu9GARvrVWTff1Lmrr8noGL59Yr46tl68QwLsLBedcRX2xox5AswsF7Rq2+PxKsG4PXrFfHVPh2XG8C63unRHM0DdulFNyxg3VmP1hG37zOJ5jLAqjdlEF8VsTUxR/EEVCooj159+xnr586nz6hW0BLxVRlrjxo40qJWg7IYNbGXxYqQzB2V8lG3iK+KWKwIydxRJ++0QHxVwmRFSOaOOjktMSm1gM2KkMwdVUq6RXxVxub+wbkWNQpaYNREEaMXIBxsUaFRC8RXxex9R0hvGdTIO2UxKbWMtRn1RFioUqcb9OorZzFyp1UDKhT0BfHVj5h8EsfhFtUZtcSoiVImI3deYaE6NwEW8dXrOYluo8B2XkJ8ZcAgiZGEwJ5/B5NSX87pXtgwUJmvBSHxlQGDJAbmADsKQkZNvJ6jPwawuZsTX9kwSKK1DLBdEDIp9fV6p3txJ6AqrT6jV58BQXfTnoCaDHpHfGWEl8Qzd2CjIGTUhA2tqAiB7aZ9TEq1YBIVIbBRfRBfWeHEHSGwMZaeXn1GBFERAk9L3CO7upkzLzcfqIrTf7wWNcRJ4jtCYK36YDSOFUGSaI4MPCVxP/O63VAjRSpC1KTV1UFv0Xs/NsNwCaH9EEIYhqYZj7pseicidyDLH3K96v10Se3ZRa1y3ZzC1Bxs5WoP93MA3zD+73j8H6RvLml2KhO7OUxHubcMEpE7kOUPtF75Ic1RPxe79Mf+qjXqimbuwLcHLOutLfvmMkfdQ+yS6RLRO0l89wzkNEe4H2xCF3VX5zQZXbR6JxG5A3mzJNPvRf2li3qILlg8fLzpijcN+Mfe3ea2DQNBGBapTxuSE6P9N/e/ZxGkQZPYTpyCEkfr97mCoTV3uCRxKXvXq3ZOWlPq3BZag1hgAV8nWJa3AoztPGkD56PRNtqgF5xAB67Jtl/HqtXqsmaZrLMOkuS85AV+yHiBNeyyWr3qHPKsJ73axYwJ8D3nBdapKWJ87lVD6nJT1zLpFUOjwBWdX/fRnidV0x+bH9hBvWKBhUiSZDWg+F+LqyjLrNd6xQIL+CLiNQqwxmGSgfvSLO8fgwUWAkqSz7xPe5aLuzrDHdSriQUWAmmNmo+2l5N0R8nynr96MTRAHJ3Nt2FWru4uWd7PQjKDhUiyS0NoWK62LVljr3c4RQhccfBoCE3L1bcly/c+GU4RIqLk0BBm33K1VclqJ/3FAgu4ZTH4Lx9nubv+Xpl73M7bXoimq/9f7jF39Z1VR0nH33rHaNsW8JJqXxreJu3E0Kwln/QeM6PA6hcD5IDh1e0oaw/xFSMNiKar+1/+axfd4Mp94S99QOIO3DLVXGAtJ+3O0NzguONA4o5YnlRKZ/WlfmLcZV3GVyTuwOodYY4btt+3yDLccuAQIYKZVEhncWzuJtdF1kV8xYw7sMFFDdmoEbrKcu0y6yMaQmCLjrCLvTl46ZTN4ysaQsSTqvyZjz539NWcyVqSPqEhBLY4R9gbfaibmcfmjeEIGteMIpxnFXJ0yZm/ZZO9z7rG8jFbwEOvMpLDKd8KpqPZXX2cIURg4/ZfRw7SDr4ZLOMrzhAiolaF5PqnfAvYbrfwMGllSwNEM6uM/vHiq39Strmrj4kGhNarjKNJzlzHdDSLr6RzA4QzqpDs8qFWMhg8NUGAhehaldG7fKjVzE7xFRNYiGlQGcdHr1dSP9rEV0xgIah+w45wCbc9+FHKNmeSCNwR06Qieo9GqLKUTVaZBO6IadmuAzkovpQthtDS2AARHVTG8pDjVxdSaxBfsUGIsGYVkSyC5upO2eEMJRuECKtXEWfqlaR5NIivpKcGCGpSEUfqlfTsEF8x0IDAFpWxUK+m1iPEY6ABcT2piIn9QY/4inqF0AYV0T98vepGjweCqFeI7LzBMbpF8T2bvBc7N0BgJxXRNrfl8PPtNvEVVyIjOBXR19/Kr+mUTa4Ao14htqwi8kPXK5f4inqF6NrVP5SdP0Z/h6ExeYCR/OoPe3eX2yoMhGHYv2AQCdBezv73eaRWOo2qJE2CjYf4ffbAMP4wM3h3g+Tg6h+Gqkleyz5+vg/i7XWSQWj4wqjVEl9Rr9CAVTJw7V7A+jO+inIL9Qqo8etzaPdCg5r4SkYDvD8r27lWPxAmr2XCavIGaEDRLmOVt6YnvmJeH9rQ53hYGg3cQ69lAeOZeoU2uIIN1ixvrdOwauJLYH47GuFlK1v/ga0hzVriKz4Poh2zbDU2ecPdOi0DVhOfB9GOQTay1Z/YGtZewaZU4nY0p5ONRm0jsJKNIXTdMn5Zum4KMVoRecv4KhJfoSVdoQart7K3dA7L/NGb6z782K3nfeKrmfgKuKRmKeForguypxSn+cM8wi/hTHwFHFSQTWz9XwjTupzMU/p5Om85hOlYNUF8hQYF2cRXznBi581L3LCmg8dXK/EVmhNli1j1QBiX3mwxh/T8IUzHplTiK7QpyhbuiQOhsmr1bVifPIQpWTUhiWX0aFGUDUKtU1GavMnEDZb4CjiIWKDBmuQ3jc3VDx8ePYQpWTVBfIVWxQINlhQVvcnOhUfiKyWbUomv0K6Yv8GyUlDwpgg3WeIrQLuYvcEapJzgTDGuS3fjK2b1AdVFeZnbO3GPzlxX/mA4EV8BCsTcQUqQS8qzqwdLVhrVrJogvkLTYuaTiZNLx/tt7lpybk/EV4AKMfOrPkoRU2/28pmIrwClorzG7pm4x5PZkQu/4istm1KJr9C8kHesjJX80mJ2NljiK0CjoL7BqrHCyoX/8ZWWVRPEV4AxQXuDNZkqvnP0yKZUQJMuZ4P1KblZbypxVmQyWjalEl8Brxes8f6d0cNcFb2nnxY1s/qIr4AvQ8YGq2vrOSW+Av6iomD5m3dGj3hX9BYtqyaIr4Atq+rjLj/l2JNR7P6mVOIroAiX769nETn4bYYLxFeAQk6eFu42WE1sNJ6Jr4AqdDZYwWhGfAVUYjU2WKrPQfdXTRBfAQWd8zRYvpl6RXwF1BPyNFjnVh5UT3wF1DNlabCGVurVp9xGfAWUtmSpJraNekV8BdQ153jvD4efzvBNzaoJzVUbqMjJM5bSDdZq9PJWbiG+AnbRq5rbZxWfhIivgPqsorEymh/VSW4jvgJ2suoZK5P01iviK0CFSU+DtRitTsRXgArD1gYrvH9vQXz1j717W1YUhoIwzMEQmEJlj5fr/d9zpvR2R0iwsLP4v3eAatukAURc9wYs+5DQqKK+AlRE2+iWCFjew0UXLI36CjhWqzGM3DeaqK8AJZddRzovztPFNFoS9RVwuEVht69tNFFfAVr6PbMywT5DM15E6itATBSYldF8XjvqK0DOrTxgtZ5/EFJfAYLmrwcsyQd2sDTqK+BbpvKA5XcDi/oK0NQV7/b5/UVEfQWoar87jPynkXOnvgJUXcqeqsFt4z7YQS7UV0CuqXBWxumdnPefmqC+Ar6rK9vtc/pV+uPqK7lXNVCFtiRgOT3S0FNfAdrmkt0+nwHrYWnUV4CCnoBFfQXUIo4ErNVPTVBfASICAWvlS6nUV4CMJXdp/cdhwKK+AuoQM09J9f6SRpztDeorQEjIvPXs7tGlvgLqsdjvznLr+Up9BdQjJgLWSW49U18BVQk5AcvbrWfqK6Auy3kDVhcsifoKUBRPG7Cor4D6hK0Bq/MVsKbRkqivAFH3c+72UV8BNYrjtkesGx0FrEh9BdRp3hawLvYRoREgUl/1vM2AXP3GW89+hpFF6qvBlgZApnCyWZnBDjK8n+DS/DAjIG451ayMSH31vMP40wDIFMcTBaxOpL4ahf4xBaoyrwas3kvAumvUVw974YgWkO26GrCCk4ClU1+9/G0A5AorAWvyEbBWPjVxaH31cm8A5OpXTkm1LgKWVH31xLkGYE/E6h3v9vVa9dV/nGsAikz+h5FF6qtZKXMClRqdDyPr1Vc6F5WA6gy+d/u6m6UcWl+1mtMVQGXiaGZuZ2UU66unsQFQYHC82/ewVcfXVy8NgLKIlZiVqT1gidZXnBwFdhgSAcsqD1gq21et8cICPib6DFgP1fpKZx4McKPygNUFO8iQterK3RxgJ4fDyP/Yu4PkxGEgCsOyZNmCIsbULPv+95yERZhUxZZsg+jW/N8RWKgez+pWZjdDvfpK20EONMn0YuR68arz6y2auuQJNMnyWpnV9kpBfcX0M7Bba3v7wiRrFNRXCuYrgaaYXSvjb7JGRX3FgQXs1dTevnFIskJJfcWBBTgCVu640lJfsRAL+O8DVv640lJfsRALMBSw+v7DPZu/JMmoV19FfekTaNaf15Y8QUTi2T1TiJKhqb7iwAKcuicbhtUrXl3vTf4XzNdXSWO/B7RqeFYMyRVk09m7o8ZTlMrmkvqK0h1Yo24o51xSkMWzP3ZaJcnTVl9xrQHQNvXclX6BnC7B7eHnKPVNmfrKyEtCQCPqBayHFOfgtvCnPklt+frqlKw8fQY0onLAeoiXc3B5/nq5JdlAX33FgQUYDlj/mOJlDh/jr3tRw2nopyR1lddXY7Sw2BBoSpWAlddNMfbf4tQlebtcfWViEyvQkiDPcV284mXWzvqKFcnAy0yvXYw8iFmZ+srGKlagKSd5jo/WAlauvtrzEwHQPfUsRk3+yCwT7xICd0oDll/6AmnU4fqKp+qBTwSsGuYXjF4mB4CA9UV5ffWlcwCOGAlYO+orWw/MAs0YCFhV6qu7mwOgYG/fpaWAtb2+Yh0WsEjhUM7iYmR7DtZXPPwM/KRv6nl5MbI5m+orJnOAFVoD1rj0BdKc9frqmuSBi+5Ahs6AdXa/szeUk6uvjhkdgLcHLNdIwMrUVzf5xr1RII+A9ZOd+oprWMBBkYC1o77iVgPwDlcC1o76ilsNwBbapp7bCFg76ivW9wEZCqeem1iMPHm3ZpY7PhIC5VQGrCYWI/djSdvHR0KgmNKA1cJi5NllJPnER0KgnM6A1cBamRSKnhXiIyGwBWtlMg7XV/nncZgkBEopXCtjP2D144Z30JgkBIoQsF5jdnle6NyBjTQO5VgPWCm4ArPQuQMbKZx6th6wJl/xZezBAdjDC4uR7/VV6a/FPXegnNKAZXwx8uwW5P8R8ogqsEJnwDK9GDkFV6ijwgLe6MZiZJm8KxSECgt4n8BaGelHV6qnwgK20jeU85e9u91xEwaiMOxPbBAkkP6c+7/PVmmr3VWbDSYkHuL3uYRIHh0Dc3LkWpm55P7MIyygkMKt5+MGrOyLfi4eYQEFCFj7OrnSn4u2UWAtAta+xqSohQdAzYD1Q3TLs6o/6gBAMfJN1tV5oxoMgGKu7WLkMZkyUfioASiisVbmVjFyFsXy2RRywo0QqMblhmtlojOlFm6EQBGNW89HrJXJ87adANqRgfVUbj0fMGBFZ8pFboRAAQJWpXh11Qs3QqAAAatSvLqywjtCYDUCVoWXgx964UYIVDM9uRh5EZXGZLax3AiBemKLxchxqrUT8MEZAJUOYHegrWfrqy9dipwMgFK2uWLk3KX6811kMAColbk7rhQsXXIjBBTWyqgLWCGpWLrkkTtAwLonOB2tFlT3AQSsO4LT8skaj9yBijecQX8PVu6Smp0AHrkDFW841tzigo5LYe6Sop0AvnIHNhhfUJOS+vojK85J09Il/5YDVDyA0XzPB6koL17Z0iXfNAAbhJe98HKzlTpsl7TNd75pABTWynzlQ5ZXy6NXON8JWIC+Wpl/pD7KK8UhmR15AhZQ4NAB6zf33czS+Jz9k0jAAgooPYDOFHH9Ik+W/0wrlTsBBCzg6jh/XuyDlWfJo/+YVvp2AghYwBa27ulz/ZJF9o9Wk/mLgAW8jV72MZrtpnmxspe8zN58pnO+E7CAilvPzjzGnceY5UGncbiYr5TOdwIWoLAYucx07uJJtrDLOEzmf1TOdwIWoLAYeevYCtHKOvYUumFK5gal852ABSjs7XvExZ+HbgwxWpvlC2tPMYRuHvzF3Kew1YKABaisldlPulyZUhprw37pDABdvX1v5jrflbykAJrjaKErEoQeLGAttQewlYAlFI0Ca6k9gK2cviA0uQNrqT2AZ9MEAhawntoDGE0bCFjAemoPYCP/BErAAsq8Ta3MEQXZjTcADtHbd1ReRLhDA0X0LeW0ErAoRgaKqdt6buX0sfUMrKf2ALZy+th6Bn6yd28pDQRREECT4CMBUYKf2f8+xV+jMAWBqfaes4fbVKb7VrarHcAh0ydgwXa1A/h2mEHAgv28thQjL0LAglBjrcyUUie1MpBp7HWa8mL7orcPQoWPtoesxJ2OlnIg0rgVN2X6Xmw9Q0LAyghY8F8IWGplYBkClloZWIWAJWDBMp6VOiVOamVgPx+mT28frMLWc+RkKQdChY+2p0zfk61niAhYmdJi5ClHPAhYgcobijlHPAhYm5We74OOeOjbipsyfcfbo5yHHPFQuBU3ZPrUykCkM2BNmT69fZBpfFM0ZfoulnIgVPimSMCydwn3SgPWYYZPAQsSnQFryPTp7YOIgJVqvKGYc8SDgLWX01nAgkjjVtyU6VMrA7G+K68pAev2MNcDkLkIWGplYBVHP2/09sEiLoqRBSxYha1nAQtWobcvcxWwICJgZRqfgAzauwQBay/vamUgImAFSs93AQsErHul5/ucV2tQOIAClrUA+KF2AKf8vBGwIFT433pTvh8LWJCpvKMXsAQs+E3jlsmU6VOMDKHGLZMh0/ddjGzvErYTsEKlxchDvvlB4SeZKQHrbOsZIo13XlMClloZCDW+aZgSsNTKwHatEyhgCVhwp3UCFSMLWPCHuk/uUy7on9TK8MXeveUmDANRADWhhSDxSvlk//vsT78qleAoqseZc/Zg68bMXKgUcMo9yekb1MpAlZCRIcvnzSRgQUujgPW+vaUcqBRwCCtLwLraeoY6Eb9xkgQstTLQ1FHAUisDvTiZwRKwoBeTGawWAetagHqjuFAXsKwFQJVwP9NneY/ZWcqBauGmRu8lhYetZ6gVMDTkOH6DgAVtXZ4rmEoKipGhsftzBbeSgWJkWCZW12iSJ3e9fbBMrKGGHHlBrQwsEW6oIcdIkd4+WCLaO3KOL8KfgGUIBKqEe8LK8UX4YesZFgj3hJXii3Cw9Qz14j1hjSWDScCCBcJNYaWYGlWMDO1NDqBiZOjFGufwUrZPrQy0d5QYKjbE/dssVIv2MpPhCetkKQfau5uC1NsHvZi8yQhY0Is13tzL9glYEIE/f1GMDL24yAyKkaEXN2/ubziolYEIDt7c5w2j3j6IYI3GlK+ycWplIIZPVQ1qZaAXOz8SCljQC6txAhb0Yo2phnPZNgELgtj74UvAgl6cHMM5k1oZCMIY1py93j6I4uwczrhayoEoJnOjamWgF58uLLUy0AttWAIWdGPnwhKwoBdPF9b/BKxRwAIX1m9RA9bGp2vhL+GmuMtmPfT2QSAurFeGnaUcCMSF9crB1vM3e3eQ6yYQBAEUM2CwFL7567r/PaNIkaIozm4W0/DeESwZFUN3DYykeWD937wLWDASDyy1MlBGi0l3tTJQhAeWgAVltHRwTFc0q5WBwbR08J6uaEkv3xMwzAPrkic0s61nGE2Lm+o/W209w2ha3JrzUROwYDhNhFArA1W0xM3PevughiMd7NPlqJWBAc3pYZsu5qVWBgY0x+SogAVFbFblPnhZyoEhxVzDv/T2wZj2dLBOl6K3Dwb18JlQMTJU8RUFMwIWFLFKEnr7oIrF+snHX8TRHgzoh3cftTJQxRmz7n9ZbD3DsF5OawQsqKJJEwIWVDEnJrEELCjCxTCKkaGMh1aCP5paGRjad6J1VK0M1LAktnP09kENp0ihVgaqeFv01dsHVczxnVDAgir2RO2ogAU1fKWPvfo+oYAF41vSyTmV9kxixAMGd6p/+l2M7DQPhtf8UX95WsqBAjb/VFvPUMYjye1r/NTKQA2LBToBC6o4k9tPNghYUMSR20csAQvK2G8fsbwVQxnr3SPWrFYGynjm5hFrjWl/qKIlyY1XoJutZ6hj29PPMZVj6xkqWZPcd6NQrQyUcqaj91TLJmBBKUc6ehQ7d//J3h0kNwoDURhGAgmRwjYulu/+95xy4ixInIynBjDd+r8TJAt3PbXUTSZgAbYUVdt3j2JbBWDLKKnSH+654u4dYNNFkqrcuDkwlANY0xdJNb53j4GpZ8CcpDoPhR0BC7Bnkmq8KZxFwALs6SXVd1MYCwELsChpXXNjQCBgASZNWlcxkDhGsVYGMKmXamtjzVXeiwIuJK3s2hxbLGIoBzBq0E09r7FikJh6BozqiyTV03g/i4AF2DXqppb3o6MIWIBhrVZXDrt+NIuABZh21p3/2/5ZBCzAtixVUrEGqeql0IADfZGqqFinajp1gGNXSRVUrFORxFAOYFwrSe4r1ke9YuoZsC5JkvOK1RYRsAAPJt24rliDRMACXFi03V2+x5olAhbgRNaCuymdrJvKtugAXn2JWN4moUef/xZQq6ytdC/fjxXPeue0OwfUJ+qTux/3KeiOoRzAiU6bKS/9ec9FH5h6BtyI+sbDt3T6Ue8IWIArnZZcHAs/j4MELMCXqO+sX6vNuiNgAc50+sJ6yIpJHwhYgDtR31kOWctuO2tlAF9GbSycmt20SUvVfMYMqENftLUuNj86/uUgU8/AgWRtruRmB7logalnwJ++aHvhrdnYJWiBgAW4NOsRWyWrTVoiYAFOJT1kp2Q9LFemH2cA+EmrnYS32KyuH5I2NjUADqPTXsLaN4Z9LnqEN6OAV33RftKbnbMgQznAAc3aU+jaZgXxl3BFxx1wLGlfYTz9b7VK+gVPGgDHWj3hMDmrzWf9jdVhSAAHGCl8KE3/XLTidC36HR13wLk+6DVKypf45N94ea5YcSAEvGv1QiWNU3tqfhRPw3gNepqHPc8ADncoXAjpOuZpGNq7YZjy2KWglwkv/1wZgEMdCo+MtX3AQf1h745yE4aBIIBaQEiQICmif77/PSu1Us+Q2X3vECN7dp1cJy6EkOI+cSGEFMvEhBBCXLaJlVEIcUz+LQM4tRPsNpyFr/bB2a375M8xgJNTYymwIIdtrF/7AALYxlJgQY7vyWsAERTvfpMDOS7dn0Er3CHIq/eo0MYoRHnMxhTuEKbxqFBeQZy2ibUZEEKerssNfvMMiXp+HMuAECK1XMeSVxCqYWLJK4jVboFUXkGwZol1G0CwVoklryBco8SSVxCvTWLJKyigyaxQXkEJLRLLfBCqqP9KR15BHdVfQssrqKR2YnnvDLV8ZlnbdQC1vKquN/heHxRUdCFrl1dQ0fqe9dzWAZRUr3o3HoS6HrV+/6Vuh9JKFVnqKyhufc4qnuorKO9T41q4fQ2gvhLXQttX0EX+tNB1EPq4Zh+yTAehlctt5no7XkEzj9RDlrYdGgo9ZC3admgpsMnajgE0lTYuNByEzqLuhYvhIDQXU74r24Ex7hGR5TYIP+zd0W6DIACG0VmEUgLW9pb3f8/d7GJZss2t2mpyzkN8gV8SOci90LdB4CDJMl4Bn51i36tBroAvwj6TNfjpIHCMZMkV8J2wry0ryhVwjPnd1A785lR38S5rlCtgicvUXysnz0SBpdqY+3LugsBLnS+xL+JwBezA89esbLkC/i2Mz2tWjsXhCjhAs9QKWEeoU99SrkGtgNWcLrfcNxGT3QpYXZtjXjlWjlbAdtp8G1YarZJYAZs7h3SbHmpVLfc3gGc5h7nGv2ZrmMb5qlXAa7RQ0hin3H+ShzjW+dpcAYFduLdwLSWlVMcPKaW5lNDuOgUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADwzh4cCAAAAAAA+b82gqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqsF8HuQkDQRQF24bBBhlCwrLvf88sQNgWICSHQYlSdYLZzNNvAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAKC+Lt6i6wLgB9qhyczDrnZMVqXP7MsuABY69XnWtFFRV/JiMLOAZU551e+jnkNelQBYoM2JJqrZ5sQp4H8bymgf3LMvoyHOjjm1ilc4ltHHOLBGh1ikm70f/rAy+3bcs8rbs+wzpzbxCusc7S6tyZlu4Rp0VvJaXftA3BCs5+oHq7wnWG3OfAkWv8I2H2nKZh4SwXqufrDWb1pYgvXN3rkt2wnCADSAXNyDt+6+5f//s/fBFGJoKx07zXo7CoiZzToIiMoTmfEK87YlqQpLZrCw6jGsUcKiPTkDKizlEcx4jSnLBlVYMuOFFRMZDB8mrBnPB1VYyjOYUSLDd1RYMuOFBVs5Zuw4YcHHcmwCFZbyDERhlZ+rCquD8cKCzfw4ZGGgsCCUf1kqLOUhiMIqI7sqrB7GCwvifKxmnRzAUGGBzd4YHyyosJSnMGMHC3xBhSUzWFiUccKiqLCUxyAKq/zYVFgdqLBUWArDcGHRhc4qrA5UWCoshTBOWD784DBI2OCCuM2hdXQP0zSFfbN3Ciu6+UuxOWxLd5ZlDiHM7vesa7c5hL15tWXe2XJpupC/hGJ2Uk3n8DXd0i2sZtzzNOXd/S1hxR9hUGEp45mZwfWAZwLbguL+1TxAcdlgwUyuW1hvJOy0bYRzrnS8Lm9nKvX7hq/Si7mD4W7CTamcssARd5+w4F8kaXVzpEQabtku9G5xcj9Lw/yKsPBEZ3h7hbXiGWNBUX5LWJyxprawyhQ7bcueWX8qC8smfn7STnWxb0E578RWQxZWDDT3atlbZJRFSiBJxZST/XVhvasyBghLCq8srIBnkvpKuUFYkGRhxY+IlbCsxxbGdQgrGjxzkBbNrMTnldOqyhS7hbUYboFHzMicYgRCSI2ktr6WWXqFxQc+bUOExYf3sLKwNiRsoCg3CGsShRVL1540UoYgC4uKwJzkYle2WFY51AK0UFlYLmHNEWldeGMVndd4C5QtYU3aZGExziu8xwiLD6/lhMXUM4Ci3CGsII1hnXyFJBfHJAnrzf72rRGLrecQ2nnWzhmItngPvi40fEXnXLMubNgkvX9BWDZhk3mUsA4mvFEQlsczuq+fcpOwMha2lrDOCYivWCZOWM02t1S+koudUSZfBEPmDZ49JfiK9vNk12AShSVHKI0RFk++FlagegNFuUdYKxYsFVYN6ytKvhSW4SYIoxEkIimH4vhgdJCRI0VGAsJaXIMSsrAOZBkvLIq7EpbTCUJliLC2RmORhGVRYrsQVmYfsCYUWG5YuC/mlgmkqF7JBvxzYc34HGH5C2FZoxOEyghhuVT5QBaWQYkUWWHN7ATh0t9GZuzBDRAWvTtrutNavEFY5kHCQscLy+sEodKNPDH2nW339YOcLKwZKWn1PiElcMKyiR3j8aTQ7CLAMhvaRrgWlaYcDsNVQhaWIXmlU3u7T+i3CBA3ejBw3cdk1tQrLLbiZjUDhUXDuyIls8IKOkGoDH+XcIVOYRmazcWvWdaqY9EUlmHHNlx78ea71Zzn9uKv5aeqCcGga8WXqfZHCl9PuQnb/ULTXIHmTCMSqXVNS4QsCssgwbtYyhgjLBpeTw9zwlp0glAZLqwpdgprwzOZe8unLSyaaOGak4lM1T+QY/UUO10TFXuCYRb2Ac/Y9qnUKMhYZj5wL0kbcrNHv7CoCNKrhH6csGh4Mw1vW1g0VgYU5XZhpR3gQlh+39wXykSV9F7i2hTWfPEGoaHTlYWjzjKz/TRfCVEKBrMMjHEQ8ebBrUYPlYImtsYfu4W1IzLfrw8DhCWH17WFdegEoTJWWGaPcMZdrdjmV/x42qZrYVnDyY52Hya2Nl76dIKjZ+RgBCY34yBiwsRFIp7OpErH6Eha0yssz9vejxOWHF4qrKAThMroHpaZLN9uA8hG4E5RYRk6EETY2WmliIXUuB3LdtR2qBByJywk1kH4EhwLK1K7ReTTul5hJV5KdoCwxPCGlrAWpFpVlCFjWIFrQoYXSwKKwUKuheWvnhUyFmZHSFXHbeaH1idhfkrIzRvVV819w0JwhJUmphF1TNgEYcWrzqMfIqw6QFkQljE6QagMEhbliF3PVZm0Lv7cUTck3lc0obx2dOa9EnqFJeeWmnvALnZyyVrzkPuE5WgcKPsQYfEdYSoshgMUZZSw8GgLK/K/+nzRalbiIXlR54pduHpZmbBElvL7uUPV3DN2EYBGxnP1kYXFS28ZIKzeAFn+TUpFuXGL5Ex1ElrCWi96QuHiKqZOfqkSg128HiSsqV9Y4UpYThQWF92CfZ6wdIJQuUVYgd3eU9hkXBSW6xWWh98V1vbvC2v6T4Slb+Qog7eX8R3COi6EsHX3sN61sP69R0LtYWkPSyGMFxY1RZSE1T+G5S+Fhcv/M4a1S2Pi+2+MYcV/YAxr1TEs5X5hZSzssrCyJDNeWKn698utZ3+xxAcJa8dCfrFYoOViZMImCGu5KmN7iLASkryKcoOw+OYrC2vn/s/L67B2YqzIi/AD8DxIWHN1hGW5ex3WDpTjIcLyWddhKX9NWIcsrIUfV3XkVC0s90a2YNr6/w1h2f7ORBTvXBYWGH7y1uJThAUrkssoShe/1RC9LKyY2GZj8IRtCIv8hZltcv7fEBYk0tnkuO1dwoNXwfEcYdlEX9FWlAGD7t3CYqTTt1tDNPxUYWJa9ESa+qOENTGp5zpEmX0l+Pi93RrQkbo9R1jw1qlCZfRnvvofCWGr5uxbXx19NYUFjrY5riLGth9B07N6WK7dl7CN7pRjvgtrPXYLyyLhfQr9k4QFH3WqUBkkrGWq9CMJKyakbS8CQNyZraSIsC57Gkszv6PTTs8SFqR6Qz1uA7uEhGmLAGBDQklY1P409D/KeJawotEXCpX7hLVOPzgMUlyHsCDwG4vLe7qD79scDo+Xs273SLAPE1agcdjdsswHEkhSgjF/vqd7+lrGw4QFTvd0V24QloiBHmFF01EQKyybuG3XLUpMDxt0h2i6IxHTv/nVnN8RFrzxzBsUZYSwsiCsclrA8cKCGYVRexZjnyYsORSlC/m+QVjuHxEWeDzjQFHuF5axgrB6zRKAEZbwJVWPlyxPW9bAvJ4j3d3vCwvyPyIsm3SjZGW0sDboFBbk32qlrvkc9aIfgeAJj1uH9YWPUpdVvjsjCkt+HE/PEhY43RlLGSysAN3CgiCUwwur/lzV0mes8LyFo4yxuMKX1PbVLAlLdnpyDxMWZERyWFFuFVbaQRAWIYjl8MKCN/81Lc8V+3rgSncmFOzlF4M1yTpZWIKx0usp28t4+E5c9XOqyjhheQuSsCjWcOXIwgLPb0PyNu1in/hqzne2ZpWN44NGdd0jrIKd6jKWx+yH5Us9k04VKoOE5Z24o1zNvDLlyMKKhn90spOpi33mu4QlW1XlFCIU+JQhQqew+DJyfM4Gfr4kfaNOFSp3CyuZI7+isAUmx5LXc8qwAIjCKldg3RDnI5VzJrunvvx8YjtrNk0OWGZPrdYnLL6MbJ+046gno3s6Vag8jOhe4QuvJcKdLNsePrNv/8780uK+V/mDFLNvCV9Cuq4ydDcERVEURVEU5RN7cCAAAAAAAOT/2giqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqsJuHawqDANRAB1tNXkPFMTl/f//tDuFICIiWHrOcgITspibAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIBnWivYuv1inI2l2OpdbWg1dHzdYOVT+aUXtOOh51Db1S79fCrYJRmKf0mO9a45yfTkbEoy12C89r9WLflGrlx7kk0H1pykr/wz+wFtutvXKgms+vnAuiZbD6xdFlasT0150G/sne3SmyAQhQVU0MGvpP+8//tsNcUDHAixST/SvDvTaQORhcPuIxq0y1S9n/1dYDVCiC9gFUxvczT2l0v1SbYIITDiZsuwN10T/EOm1tDE+0n6t4AF71/AKti0RdbHXQ5tiAKwpNgi8steACwjdjNvSqwvYFXVPw4s+/6y/DKwYOrjkP0bTHmJLTvxjmfCL2BV1T8OrPojb99swPqsi+DfbQAWlq3vt279Alb1DsD6vNT9Ahbs9cDCR1H5pqdOe5+GrusSS1utum5SVDpRaeFArmV36McjwJLdDwdDlWtCMrBoBMNJYN13O2FI5zWREzVLE5M5Klm5HzWkgaWHXDcklEvXFoDFPWYF0KmUflFnJurMOQcDzxabzqkIsc4Ai0OBnaXH9NGXlhGwKuFEvpFLNUjh/dPNRqwigvJaFkuTB5rtKxLn9mangFxMugGFigKw2nHdTfTk2bihyCywuubn0a2MgAW1YACWbkXarW6dJk1Uk5cNg0F/rjIzmkWRIK4z7FPV5md7tYyAhSaNq0N7h3JQDJHUbYoTraARhxKluLRma4qlPg5Dj1tBzZxwwDLkTM+YubBXwte/HuDJswud8HhaoD4Nk8a0fN71NQErSFkHrHZdkcKDPwdigvQLitGWbqJSNhl8hYB1zTSg7Qqz+g6w5Mg/f7JncU0Da/CP7k8AS4qM28mUfo9l2QAsGfYHpr/dEeRKPjFtkSukDGlcJdsTMgbW1pUCsDiU+pAnw+YhDawWR5mpqgJJRozthAOSIW2T4NgHsHyxal0CFmRE10P1bdIXit/wvs2fAdZ19YDVmZuCQkSS7UFjhDCuGKWrK71WbIP5GXq3v20ErPbWrIm8IUhvNaPOAqsWty647CLPwmUkjZ671z4MrDbntl0DTQydJkm21gPWYNAbuvGIKgiS8imG6Cjj+mn9lNFjoM+ogzGgygwRsOz6CLCukf6tzxNl1iSwKCT6fQwYgdCY/YcdSOFFNc0wRk3tAVgQCxNeAtY3N2WgL9S34TBxjD+TtvpMi4HVeMAyYrsisK3cZ3ZXsdXu18RDye4oHxbgrd1K561U0Y45P2OaSW8X7NuR1gfWzdsF3qYgpcW8x0C9HZIF1laptPve2gS8Mq1C4zUDS5rjeN1tPpdEOF8ul/0aerdDjMPtGLht0SG5Q82wKFeIuWswBPQVrRu1fw4QkSALBAl8Wp+fUhwCV9PuynopU/+os2q/uSN4DKY9qsQSAEtsf+o2hI2+XPZvOY2q6dbIgPZbL/q2oGtsqwhYCIlhV8DIZV1rtfseMYtwoAoOIIMmGZhXYg7EB7Ds5lrpI5hG/XPUoxv1Jb4HandRvQbNAPVd5hzD9PMM5ar6SIuBtaWpPpQzcxAwy1YDHukDIE5ue0yK8CC1xHEAKB3tb3MdAUsMPtqEHzxW+1V5YLVByCnvmFEGVVcC1h7Jyl/BF266F90GNXKkX+MgG86oFq3SqAdfkIoFYZ8CPutg8Xf1+hldpWjr6SODKrknDoC1mVB3fyVENzTah+8G4yRlHG5xzhkxbih9wkFOhthUqPDoUURg3cqTgZvuEbA6nhahPfVH7Q+zRmu9y7PPfczpABYEX6CcCjJxrGD2OM6v0GZdzf4Pp6j7IJJE6YMLRByD1QVWO4pScDMtMsByfOEpti4+GL4AVhdds6kCsDJuF3yso46PtAMiJRtapVE3LAiIlTxVDMecquiG1hWOcXkF6XBy4ioAy7VZAFadCCWBecdgGFjS3zvvDsOh9qwDiS4jytl1YuYWxiiIJe8DS6JB+hy1N0F7l1rIs4+0EFgtQOEyj0/9kEwDWN7jU1upRGn4vB3K4vy/RsBaojW5df8K4TfcAZYMUWBcz1GDO2YRsASWf+jCg8CSYe8MciNUns+SksREqzzqYe8yt7sZfOooda07qo81UABWoM/o9FFxlRYRsPryPiyZbGTCFVu6CRHJ38AzrkjPOCjIAOtwjHf+1IRRAmcGWIxFBSxBxMS8CHRcCPGZW7zUhoZut7k2a4h6FX4tONC6IDDJXcwGy2Y2jirXUBMuf9k9r0vqLLDG5KaYzrXF6ACwBt6PZh4FVhNUO7czCOj1SLNsq0wMhvJocTMlqKo5BGnj9Yrs+95NmiAXFmeqtD6WqqYQWKYqA6ujRmbXPk4dbIAOTiAilk6fdEALlQm4CaTuKfZbxihkuA8spiLiPU4LhI343PtWob6R2QrAIt1SEW5T25yqhkspMha6tQlghRDUDj+as0JlgWV5TyjOqhTrwZdmplOdB1bB7eDCfkggH0Zi8jmeES7TVStnBh8N8zfBrdRR7fQZ0Z5fpYC1B4DVJBsxmTomPwcQuHI552BAG2GgcXQwwQmj1NEMsDRPGRgbx/cUXFuYN3+K4vXAGg/1ee08K9/2lMZNE2ER5PiRTcwoZTrNzLCGFh/oTSYrdBZYbexQJWAImABYSZh0jwJrjgmkKpfsgYGcBdl4UYioV+mqlfrGY1GBOYUpZTzJDLUHAiAhC8ASvLAcXTXmpqAz3LGP8WEHU0YGZhgXGQyGxzrlgIUYztwKcHU8TP0zzz58lbXPUHOzelaMCMQl2xL8MCVqpDiVFp/f553uKWBNqc1Qp4DFX8eiC8DCr/XPPUsIt4blQxcLstFgAI9cFbMn7hWbwI8o6RykbKad7gVgoVPcCFL8CWCdczCvSeN5b3KdEfDla9tngYUYpvguAAv77Zb+g5/NoTA7BSw8ZcCPEsiaSikHTgELqftqYLUErOblwFrZaJGZky0/6nwVVDsPrCYNdPkqYInfCayyg4IM5t68M7DEWWB1vwgsPIe0mvrtXgL1h4G1bB/JLBbXtcCeXS4V6oEV1lAAVm6yzUtWWBPd6Hr9CkuQQa2kbNNDKyz7SyssQ51pCkD5bSus5WXAOudgzssAG/6VFdb+8TidXavPtAKwTrzQaOga7MpB6TxiJy/9+kFdKQFreP4e1shJ0RCnEjydTwOLOVk0yNas0U739J2VqXQPS6OCbrWxle9haaoiYD1zD+t5YJUdnHsHEa8r+R4WwzEPLNzqZyjmgcV59o5vM/9zwJpL73nC1ueRShemTDVxmS0By4WKphGcAFb5V8IMIupngIV8KhvL1sUQAah0umr1c4dtwFjIcNIhAjaJqtPA4k5JN4bngXXOgUzL8PyvhDILLJ4yhFsZWMizr42jWWDhFFD+3wAxR6UdR5rDQJSA5WomSoYTwOKtUigBsCSBUZrngDWT0KRgWsz8Pqze+ecq3oeFF1lhA1LyP1TE3hbSpyUJuvPAmpPtL68B1kkHBrMcyEB6znxPDzFLCSV+ZR/WVAYWrPnIV7gWgRUtqmVq42ffNE1P+ZksLe90LwNrjjdvy/UEsLB1KM6FHsDChuXw+OeApdHxzNbWvGwdpPF3ukv3pTG10x3Y5VUiX/KK/E537fTB/npUnQeWjh/7llimPA2skw5sfDMI3yQEUey773MwtVlgYcMh77O7D6ypaZrr//Rm298ILKQXhz5Ov8j4ZOlAjsNgGdYysBxurB+MZ4FVtYkH4gTfQnb/RHtPAauy1HGKOZYNwOKD64IgwC5nmkJSQ5PMs4TfUNdQ1XlgVU0USgvafxpYJx3IjAzsmsUvP0u4ELAwZfwsYQFYKqiZP/Ym1iPAwuN9MnjqVUJ9X3rtSq+uFBcgURjB9WRWUwIWFmJWO8yJdTUngaWFCzK8/a6ntzU0DqjwysDCHZMysGQQpnqMBU6LCVqGo0aiXQOYqUCQwWlMmWb5NQU9brrn9JEmls6cAhYaaWTwLkX5ImDBAV43kXZAMtAD+XDlVIT4QqJXviIWX8UTPNTha9CgEgiFPLCqMDQ+9v84fAhYiNV+U0mrxlO8PV4NqztkhFc6G0517Nzth+3WintjXxlY1XLsBdf7ZnErTgELb15QutKqNRhK6n1Y24DlvHePRoGT8v4QwB1gIR1Er/Ga4SDkSLbv7J3hckQwFIUTkbBGGO2+/7O2tPqVK+5kdHZqOL92YpNcB58fOJnNJA+Lvf49jd8x5J05iwBtRmCS6OtEHpZf+dMuwc0mO2QCCyNKNxbc4v9fACtjAmmDkofVTA4PPPRe52HFL7O6RdRC6z5VrQp+cur3HuSlgIX1pZuuPzu1XlIasFBcRlTS60k71ledbEXcJlAoVGAxMupMHrCIKkZhM3GU8mTiKKp+xkoDi994kvgwzEvbSBxF1CwMKc1e4miRShwtF4mjVr4gzHjIFmUesMAeottxYGVOQH7tbIOvlBdtZ14BrOkCQF3FLVlJHMXHaBRg0cfak64f+jpg8Zwd1Y3ImhbBb8hLdwmAm6MCVWBx+qDWZAJLstI6TvrUn2qZ6U4crwqs7WTwaFDSTHaGeqiZPklDHjZxHKp2L9O93NjGeAyXByzF/+PAypsA83BPKOUiwDIhEYAfbTLTPXD7IRhTeUoYzr1C+8uAhfphtitUS/J82+/DZmtjhFiWZo5eVoElR669M7nAYmZ2RQJLlievEKrpdGAxouaJtI1Vc7plzdKQQRpSjL1wC/EVUN1urJozsG3ZK1jqywSWZsRxYOVPIG1Aey4CLG69detWXvl6CSw2tVb0UYBFpTZc+GvCPLm+afoNt+LY/rbZqqzB1zRNNBli5HjoqFWOkvfK4z/HxIhK5dgm6Vsk63E7hhTMqRw2YVBU6jvkv2LEyybAhoxTFWDhv8lQ8mDqlV4zuu/WafS48rpO/1oTsG7dunUD6wy6gfXBTh2QAAAAAAj6/7odgY4QhLUhLBDWhrBAWBvCAmFtCAuEtSEsENaGsIidOiYCAISBANYfOoN/tQjAQHuXiAjCWkNY8DlJbjFPJ10AAAAAAAAAAAAAAAAAjz04EAAAAAAA8n9tBFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVhT04EAAAAAAA8n9tBFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVad9ebhuIYSiKcv/W+sz0X2iAxDEMu4BQyDlFXIgUCAAA8D+MAjjCqKsAjnDVLoAj7JoFcIRZqwCOsCq27sARRiqWWMARdipmQuAIKxUzIXCCkVTinxA4wEwquT2xgPZGkkpssYD+5iNYcZ4DNLfzEyxDIdDduB/BMhQC3a08g+WnEGht5ltFsYDmZn5UFAvobeah8mvZvAMNjZXPYOV2Bg20c915qryYHllAK2PlRSWSBfQ05p1XlTdraxbQwNgrbyqf1tyXagF/Zlx7rnz6AsK3+OQ/Kq5iAAAAAElFTkSuQmCC";const Ka=new Qa.Texture(Xa);Xa.onload=()=>{Ka.needsUpdate=!0};var $a=n(99477);const Ja=Object.freeze({Blend:"blend",Mask:"mask",Opaque:"opaque"});function el(e){const t=new $a.SphereBufferGeometry(1,64,32);if(t.scale(-1,1,1),!e.flipY){const e=t.attributes.uv.array;for(let t=1;t<e.length;t+=2)e[t]=1-e[t]}const n=new $a.MeshBasicMaterial;n.toneMapped,n.transparent=e===Ka,n.map=e,n.needsUpdate=!0;const i=new $a.Mesh(t,n);return i.layers.set(_o.CAMERA_LAYER_FX_MASK),i}function tl(e,t,n,i){void 0===n&&(n=Ja.Opaque),void 0===i&&(i=.5);const r=Bo(Math.min(1,1/t),Math.min(1,t),1,1,e.flipY),o=new $a.MeshBasicMaterial;switch(o.toneMapped,o.side=$a.DoubleSide,n){case Ja.Mask:o.transparent=!1,o.alphaTest=i;break;case Ja.Blend:o.transparent=!0,o.alphaTest=0;break;case Ja.Opaque:default:o.transparent=!1}o.map=e,o.needsUpdate=!0;const s=new $a.Mesh(r,o);return s.layers.set(_o.CAMERA_LAYER_FX_MASK),s}class nl{constructor(){this.cache=new Map}static key(e,t){return`${e}_${t}`}set(e,t,n){const i=n.image,r=nl.key(e,t);return this.cache.set(r,{cacheKey:r,texture:n,ratio:(i.videoHeight||i.height)/(i.videoWidth||i.width),count:0}),this.retain(e,t)}has(e,t){return this.cache.has(nl.key(e,t))}get(e,t){return this.cache.get(nl.key(e,t))}retain(e,t){const n=this.cache.get(nl.key(e,t));return n.count++,n}release(e,t){this.releaseByKey(nl.key(e,t))}releaseByKey(e){const t=this.cache.get(e);t?(t.count--,t.count<=0&&(wo(t.texture),this.cache.delete(e))):console.error(`Releasing uncached texture. The cacheKey is: ${e}`)}}const il=1,rl=2,ol=3,sl=4,al={URL_IMAGE:0,URL_VIDEO:1,URL_MODEL:2,URL_PDF:3,URL_AUDIO:4,FILE_IMAGE:8,FILE_VIDEO:9,FILE_MODEL:10,FILE_PDF:11,FILE_AUDIO:12,CLIPBOARD_IMAGE:16,CLIPBOARD_VIDEO:17,CLIPBOARD_MODEL:18,CLIPBOARD_PDF:19,CLIPBOARD_AUDIO:20,SPAWNER_IMAGE:24,SPAWNER_VIDEO:25,SPAWNER_MODEL:26,SPAWNER_PDF:27,SPAWNER_AUDIO:28,CAMERA:30,UNKNOWN:31};function ll(e,t,n,i,r){return e===il?t:e===rl?n:e===ol?i:r}const cl={"image/":[al.URL_IMAGE,al.FILE_IMAGE,al.CLIPBOARD_IMAGE,al.SPAWNER_IMAGE],"model/":[al.URL_MODEL,al.FILE_MODEL,al.CLIPBOARD_MODEL,al.SPAWNER_MODEL],"application/x-zip-compressed":[al.URL_MODEL,al.FILE_MODEL,al.CLIPBOARD_MODEL,al.SPAWNER_MODEL],"video/":[al.URL_VIDEO,al.FILE_VIDEO,al.CLIPBOARD_VIDEO,al.SPAWNER_VIDEO],"application/vnd.apple.mpegurl":[al.URL_VIDEO,al.FILE_VIDEO,al.CLIPBOARD_VIDEO,al.SPAWNER_VIDEO],"application/x-mpegurl":[al.URL_VIDEO,al.FILE_VIDEO,al.CLIPBOARD_VIDEO,al.SPAWNER_VIDEO],"audio/":[al.URL_AUDIO,al.FILE_AUDIO,al.CLIPBOARD_AUDIO,al.SPAWNER_AUDIO],"application/pdf":[al.URL_PDF,al.FILE_PDF,al.CLIPBOARD_PDF,al.SPAWNER_PDF]},dl={".m3u8":[al.URL_VIDEO,al.FILE_VIDEO,al.CLIPBOARD_VIDEO,al.SPAWNER_VIDEO]},ul=[],hl=[],pl=["MeshStandardMaterial","MeshBasicMaterial","MeshPhongMaterial"];AFRAME.registerComponent("hoverable-visuals",{schema:{enableSweepingEffect:{type:"boolean",default:!0}},init(){this.uniforms=null,this.geometryRadius=0,this.sweepParams=[0,0]},remove(){this.uniforms=null,this.boundingBox=null;const e=AFRAME.utils.device.isMobile(),t=AFRAME.utils.device.isMobileVR();this.isTouchscreen=e&&!t},tick(e){if(!this.uniforms||!this.uniforms.length)return;const t=this.el.sceneEl.is("frozen"),n=Fi(this.el),i=this.el.sceneEl.systems["hubs-systems"].cursorTogglingSystem;let r,o;const s=this.el.sceneEl.systems.interaction;if(s.ready){if(s.state.leftHand.hovered!==this.el||s.state.leftHand.held||(r=s.options.leftHand.entity.object3D),s.state.leftRemote.hovered!==this.el||s.state.leftRemote.held||i.leftToggledOff||(r=s.options.leftRemote.entity.object3D),s.state.rightRemote.hovered!==this.el||s.state.rightRemote.held||i.rightToggledOff||(o=s.options.rightRemote.entity.object3D),s.state.rightHand.hovered!==this.el||s.state.rightHand.held||(o=s.options.rightHand.entity.object3D),r&&r.matrixWorld.toArray(ul),o&&o.matrixWorld.toArray(hl),r||o||t){const e=this.el.object3D.matrixWorld.elements[13],t=this.el.object3D.matrixWorld.elements[4],n=this.el.object3D.matrixWorld.elements[5],i=this.el.object3D.matrixWorld.elements[6],r=Math.sqrt(t*t+n*n+i*i)*this.geometryRadius;this.sweepParams[0]=e-r,this.sweepParams[1]=e+r}for(let i=0,s=this.uniforms.length;i<s;i++){const s=this.uniforms[i];s.hubs_EnableSweepingEffect.value=this.data.enableSweepingEffect&&n,s.hubs_IsFrozen.value=t,s.hubs_SweepParams.value=this.sweepParams,s.hubs_HighlightInteractorOne.value=!!r&&n&&!this.isTouchscreen,s.hubs_InteractorOnePos.value[0]=ul[12],s.hubs_InteractorOnePos.value[1]=ul[13],s.hubs_InteractorOnePos.value[2]=ul[14],s.hubs_HighlightInteractorTwo.value=!!o&&n&&!this.isTouchscreen,s.hubs_InteractorTwoPos.value[0]=hl[12],s.hubs_InteractorTwoPos.value[1]=hl[13],s.hubs_InteractorTwoPos.value[2]=hl[14],(r||o||t)&&(s.hubs_Time.value=e)}}}});var ml=n(68337),fl=n.n(ml),gl=n(10248);function vl(e,t){return function(e,t){return e.startsWith("video/")||e.startsWith("application/dash")||AFRAME.utils.material.isHLS(t,e)}(e,t)?Ml.VIDEO:function(e){return e.startsWith("audio/")}(e)?Ml.AUDIO:function(e){return e.startsWith("image/")}(e)?Ml.IMAGE:function(e){return e.startsWith("application/pdf")}(e)?Ml.PDF:function(e){return e.includes("application/octet-stream")||e.includes("x-zip-compressed")||e.startsWith("model/gltf")}(e)?Ml.MODEL:function(e){return e.startsWith("text/html")}(e)?Ml.HTML:null}var bl=n(7189),yl=n(49945),wl=n(67631),_l=n.n(wl),El=n(76030),Al=n(99477);function Sl(e,t,n,i,r,o,s){try{var a=e[o](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(i,r)}function xl(e){return function(){var t=this,n=arguments;return new Promise((function(i,r){var o=e.apply(t,n);function s(e){Sl(o,i,r,s,a,"next",e)}function a(e){Sl(o,i,r,s,a,"throw",e)}s(void 0)}))}}const Ml={MODEL:1,IMAGE:2,VIDEO:4,PDF:8,HTML:16,AUDIO:32};Ml.ALL=Ml.MODEL|Ml.IMAGE|Ml.VIDEO|Ml.PDF|Ml.HTML|Ml.AUDIO,Ml.ALL_2D=Ml.IMAGE|Ml.VIDEO|Ml.PDF|Ml.HTML;const Pl=new Map([[Ml.MODEL,"model"],[Ml.IMAGE,"image"],[Ml.VIDEO,"video"],[Ml.PDF,"pdf"],[Ml.HTML,"html"],[Ml.AUDIO,"audio"]]),Cl=fl()();Cl.tlds(gl);const kl=ge("/api/v1/media"),Ol=AFRAME.utils.device.isMobile(),Tl=AFRAME.utils.device.isMobile(),Rl=new Map,Dl=function(e){void 0===e&&(e=!1);const t=Ol||Tl;return e?t?"low_360":"high_360":t?"low":"high"},jl=function(){var e=xl((function*(e,t,n,i){void 0===t&&(t=null),void 0===n&&(n=1);const r=`${e}_${n}`;if(!i&&Rl.has(r))return Rl.get(r);const o=fetch(kl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({media:{url:e,quality:t||Dl()},version:n})}).then(function(){var t=xl((function*(t){if(!t.ok){const n=`Error resolving url "${e}":`;try{const e=yield t.text();throw new Error(n+" "+e)}catch(e){throw new Error(n+" "+t.statusText)}}return t.json()}));return function(e){return t.apply(this,arguments)}}());return Rl.set(r,o),o}));return function(t){return e.apply(this,arguments)}}(),Ll=(e,t)=>{const n=new FormData;return n.append("media",e),n.append("promotion_mode","with_token"),t&&n.append("desired_content_type",t),fetch(function(e,t){if(void 0===t&&(t=!1),!pe)return console.warn("Cannot call getDirectReticulumFetchUrl before connectToReticulum. Returning non-direct url."),ge(e,t);const{host:n,port:i}=pe;return ge(e,t,n,i)}("/api/v1/media"),{method:"POST",body:n}).then((e=>e.json()))};function Il(e){return Cl.test(e)?e.indexOf("://")>=0?e:`https://${e}`:e}const Nl=function(e,t,n,i,r,o,s,a,l,c,d){void 0===i&&(i=null),void 0===r&&(r=!1),void 0===o&&(o=!1),void 0===s&&(s=!0),void 0===a&&(a={}),void 0===l&&(l=!0),void 0===c&&(c=null),void 0===d&&(d=null);const u=AFRAME.scenes[0],h=document.createElement("a-entity"),p=NAF.utils.createNetworkId();if(l)h.setAttribute("networked",{template:t,networkId:p});else{const e=document.importNode(document.body.querySelector(t).content,!0).firstElementChild.cloneNode(!0),n=e.attributes;for(let e=0;e<n.length;e++)h.setAttribute(n[e].name,n[e].value);for(;e.firstElementChild;)h.appendChild(e.firstElementChild)}const m=e instanceof File,f=function(e){const t=document.querySelectorAll("[media-loader]");let n=1;for(const i of t){const t=i.components["media-loader"];t.data&&t.data.src===e&&(n=Math.max(n,t.data.version))}return n}(e);h.setAttribute("media-loader",{fitToBox:o,resolve:r,animate:s,src:"string"==typeof e?Il(e)||e:"",version:f,contentSubtype:i,fileIsOwned:!m,linkedEl:d,mediaOptions:a}),h.object3D.matrixNeedsUpdate=!0,(c||u).appendChild(h);const g=new Promise((function(t){m?function(e,t){const n=new FileReader;n.onload=function(e){const n=new DataView(e.target.result);if(65496!=n.getUint16(0,!1))return t(-2);const i=n.byteLength;let r=2;for(;r<i;){if(n.getUint16(r+2,!1)<=8)return t(-1);const e=n.getUint16(r,!1);if(r+=2,65505==e){if(1165519206!=n.getUint32(r+=2,!1))return t(-1);const e=18761==n.getUint16(r+=6,!1);r+=n.getUint32(r+4,e);const i=n.getUint16(r,e);r+=2;for(let o=0;o<i;o++)if(274==n.getUint16(r+12*o,e))return t(n.getUint16(r+12*o+8,e))}else{if(65280!=(65280&e))break;r+=n.getUint16(r,!1)}}return t(-1)},n.readAsArrayBuffer(e)}(e,(e=>{t(e)})):t(1)}));if(m){const t="video-camera"===i?"video/mp4":e.type||Gs(e.name);Ll(e,t).then((e=>{const t=new URL(zs(e.origin));t.searchParams.set("token",e.meta.access_token),h.setAttribute("media-loader",{resolve:!1,src:t.href,fileId:e.file_id}),window.APP.store.update({uploadPromotionTokens:[{fileId:e.file_id,promotionToken:e.meta.promotion_token}]})})).catch((e=>{console.error("Media upload failed",e),h.setAttribute("media-loader",{src:"error"})}))}else e instanceof MediaStream&&h.setAttribute("media-loader",{src:`hubs://clients/${NAF.clientId}/video`});return n&&h.addEventListener("media_resolved",(e=>{let{detail:t}=e;const i=function(e,t,n){for(const n in cl)if(t.toLowerCase().startsWith(n))return ll(e,...cl[n]);if(n)for(const t in dl)if(n.toLowerCase().endsWith(t))return ll(e,...dl[t]);return al.UNKNOWN}(n,t.contentType,t.src);u.emit("object_spawned",{objectType:i})})),{entity:h,orientation:g}},Fl=function(e,t,n,i,r,o){void 0===n&&(n=null),void 0===i&&(i=!0),void 0===r&&(r=!1),void 0===o&&(o=null),n||({src:n}=e.components["media-loader"].data);const{contentSubtype:s,fitToBox:a,mediaOptions:l}=e.components["media-loader"].data;return Nl(n,t,il,s,!0,a,!1,l,i,o,r?e:null)};function Bl(e){const t=[];return e.traverse((e=>{e.material&&!e.isTroikaText&&(e.reflectionProbeMode="dynamic",fo(e,(n=>{if(n.hubs_InjectedCustomShaderChunks)return n;if(!pl.includes(n.type))return n;if(e.el&&(e.el.classList.contains("ui")||e.el.classList.contains("hud")||e.el.getAttribute("text-button")))return n;const i=n.clone();return i.onBeforeRender=n.onBeforeRender,i.onBeforeCompile=(e,i)=>{-1!=e.vertexShader.indexOf("#include <skinning_vertex>")&&(n.onBeforeCompile&&n.onBeforeCompile(e,i),e.uniforms.hubs_IsFrozen={value:!1},e.uniforms.hubs_EnableSweepingEffect={value:!1},e.uniforms.hubs_SweepParams={value:[0,0]},e.uniforms.hubs_InteractorOnePos={value:[0,0,0]},e.uniforms.hubs_InteractorTwoPos={value:[0,0,0]},e.uniforms.hubs_HighlightInteractorOne={value:!1},e.uniforms.hubs_HighlightInteractorTwo={value:!1},e.uniforms.hubs_Time={value:0},e.vertexShader=["varying vec3 hubs_WorldPosition;","uniform bool hubs_IsFrozen;","uniform bool hubs_HighlightInteractorOne;","uniform bool hubs_HighlightInteractorTwo;\n"].join("\n")+e.vertexShader.replace("#include <skinning_vertex>","#include <skinning_vertex>\n             if (hubs_HighlightInteractorOne || hubs_HighlightInteractorTwo || hubs_IsFrozen) {\n              vec4 wt = modelMatrix * vec4(transformed, 1);\n\n              // Used in the fragment shader below.\n              hubs_WorldPosition = wt.xyz;\n            }"),e.fragmentShader=["varying vec3 hubs_WorldPosition;","uniform bool hubs_IsFrozen;","uniform bool hubs_EnableSweepingEffect;","uniform vec2 hubs_SweepParams;","uniform bool hubs_HighlightInteractorOne;","uniform vec3 hubs_InteractorOnePos;","uniform bool hubs_HighlightInteractorTwo;","uniform vec3 hubs_InteractorTwoPos;","uniform float hubs_Time;\n"].join("\n")+e.fragmentShader.replace("#include <output_fragment>","#include <output_fragment>\nif (hubs_HighlightInteractorOne || hubs_HighlightInteractorTwo || hubs_IsFrozen) {\n  float ratio = 0.0;\n  float size = hubs_SweepParams.t - hubs_SweepParams.s;\n\n  if (hubs_EnableSweepingEffect) {\n    float line = mod(hubs_Time / 500.0 * size, size * 3.0) + hubs_SweepParams.s - size / 3.0;\n\n    if (hubs_WorldPosition.y < line) {\n      // Highlight with a sweeping gradient.\n      ratio = max(0.0, 1.0 - (line - hubs_WorldPosition.y) / (size * 1.5));\n    }\n  }\n\n  // Highlight with a gradient falling off with distance.\n  float pulse = 1.0 / (size + 0.2) * 8.0 + 1.0 / (size + 0.3) * 3.0 * (sin(hubs_Time / 1000.0) + 1.0);\n\n  if (hubs_HighlightInteractorOne) {\n    float dist1 = distance(hubs_WorldPosition, hubs_InteractorOnePos);\n    ratio += -min(1.0, pow(dist1 * pulse, 3.0)) + 1.0;\n  } \n\n  if (hubs_HighlightInteractorTwo) {\n    float dist2 = distance(hubs_WorldPosition, hubs_InteractorTwoPos);\n    ratio += -min(1.0, pow(dist2 * pulse, 3.0)) + 1.0;\n  }\n\n  ratio = min(1.0, ratio);\n\n  // Gamma corrected highlight color\n  vec3 highlightColor = vec3(0.184, 0.499, 0.933);\n\n  gl_FragColor.rgb = (gl_FragColor.rgb * (1.0 - ratio)) + (highlightColor * ratio);\n}\n"),t.push(e.uniforms))},i.needsUpdate=!0,i.hubs_InjectedCustomShaderChunks=!0,i})))})),t}function Vl(e){return window.APP.store.state.uploadPromotionTokens.find((t=>t.fileId===e))}const Ul=new Al.Vector3;function Hl(e,t,n,i,r,o){void 0===r&&(r=!1),void 0===o&&(o=.75);const{entity:s,orientation:a}=Nl(t,"#interactable-media",void 0,n,!1),l=e.object3D.position;s.object3D.position.set(l.x,l.y,l.z),s.object3D.rotation.copy(e.object3D.rotation),r&&s.object3D.rotateY(Math.PI);const c=i%6+3;Ul.set(Math.cos(2*Math.PI*(c/6))*o,Math.sin(2*Math.PI*(c/6))*o,.001*c-.05),e.object3D.localToWorld(Ul),s.object3D.visible=!1;const d=()=>{s.object3D.visible=!0,s.setAttribute("animation__photo_pos",{property:"position",dur:800,from:{x:l.x,y:l.y,z:l.z},to:{x:Ul.x,y:Ul.y,z:Ul.z},easing:"easeOutElastic"})};let u=null;if(n.startsWith("photo"))s.addEventListener("image-loaded",d,{once:!0}),u="photo";else{if(!n.startsWith("video"))return void console.error("invalid type "+n);s.addEventListener("video-loaded",d,{once:!0}),u="video"}return s.object3D.matrixNeedsUpdate=!0,s.addEventListener("media_resolved",(()=>{e.emit(`${u}_taken`,s.components["media-loader"].data.src)}),{once:!0}),{entity:s,orientation:a}}const zl=(new Ds).setCrossOrigin("anonymous");function Wl(e,t){return ql.apply(this,arguments)}function ql(){return(ql=xl((function*(e,t){let n;if(t){const i=new Image;i.crossOrigin="anonymous";const r=new Promise((e=>i.addEventListener("load",e,{once:!0})));i.src=e,yield r;const o=document.createElement("canvas");o.width=i.width,o.height=i.height;const s=o.getContext("2d");s.drawImage(i,0,0),yield t(s,i.width,i.height),n=new Al.CanvasTexture(o)}else try{n=yield zl.loadAsync(e)}catch(t){throw new Error(`'${e}' could not be fetched (Error code: ${t.status}; Response: ${t.statusText})`)}return n.encoding=Al.sRGBEncoding,n.anisotropy=4,n}))).apply(this,arguments)}const Zl=Q();function Gl(e){const t=document.createElement(e);return t.setAttribute("playsinline",""),t.setAttribute("webkit-playsinline",""),t.autoplay=!0,t.muted=Zl,t.preload="auto",t.crossOrigin="anonymous",t.volume=0,t}function Yl(e,t,n){const i=function(){const t={};return function(n){const i=n.animatables[0].target;i.x=Math.max(Number.MIN_VALUE,i.x),i.y=Math.max(Number.MIN_VALUE,i.y),i.z=Math.max(Number.MIN_VALUE,i.z),i.x===t.x&&i.y===t.y&&i.z===t.z||(t.x=i.x,t.y=i.y,t.z=i.z,e.scale.set(i.x,i.y,i.z),e.matrixNeedsUpdate=!0)}}(),r={duration:400,easing:"easeOutElastic",elasticity:400,loop:0,round:!1,x:e.scale.x,y:e.scale.y,z:e.scale.z,targets:[t],update:e=>i(e),complete:e=>{i(e),n&&n()}};return e.scale.copy(t),e.matrixNeedsUpdate=!0,(0,El.Z)(r)}function Ql(){const e=document.querySelector("#media-mirror-target");if(e.firstChild)return e.firstChild.setAttribute("animation__remove",{property:"scale",dur:200,to:{x:.01,y:.01,z:.01},easing:"easeInQuad"}),new Promise((t=>{e.firstChild.addEventListener("animationcomplete",(()=>{e.removeChild(e.firstChild),e.parentEl.object3D.visible=!1,t()}))}))}function Xl(e){return fetch(e,{method:"HEAD"}).then((e=>e.headers.get("content-type")))}function Kl(e){let t;try{t=new URL(e)}catch(n){try{t=new URL(`https://${e}`)}catch(e){return null}}return t}function $l(){return($l=xl((function*(e){const t=Kl(e);if(!t)throw new Error(`Cannot fetch data for URL: ${e}`);let n,i,r=t.href,o=null;const s=Hs(t.hostname)&&(Gs(t.href)||"").startsWith("model/gltf");if("data:"!=t.protocol&&"hubs:"!=t.protocol&&!s){const e=yield jl(t.href);r=e.origin,r.startsWith("//")&&(r=`${location.protocol}${r}`),o=e.origin_audio,o&&o.startsWith("//")&&(o=location.protocol+o),n=e.meta&&e.meta.expected_content_type||n,i=e.meta&&e.meta.thumbnail&&zs(e.meta.thumbnail)}const a=zs(r);return n||(n=Gs(r)||(yield Xl(a))),"application/octet-stream"===n&&(n=Gs(r)||n),"audio/x-mpegurl"!==n&&"audio/mpegurl"!==n||(n="application/vnd.apple.mpegurl"),{accessibleUrl:a,canonicalUrl:r,canonicalAudioUrl:o,contentType:n,mediaType:vl(n,r),thumbnail:i}}))).apply(this,arguments)}function Jl(e,t,n){const i=(0,bl.Sy)().create();return i.extend("RequestModifier",(function(){return{modifyRequestHeader:e=>e,modifyRequestURL:zs}})),i.on(bl.Sy.events.ERROR,n),i.initialize(t,e),i.setTextDefaultEnabled(!1),i.clearDefaultUTCTimingSources(),i.addUTCTimingSource("urn:mpeg:dash:utc:http-xsdate:2014",zs("https://time.akamai.com/?iso")),i}function ec(e,t,n){const i=`https://${k.CORS_PROXY_SERVER}/`,r=e.startsWith(i)?e.substring(i.length):e,o=new(_l())({debug:(0,z.Z)("hlsDebug"),xhrSetup:(e,t)=>{t.startsWith(i)&&(t=t.substring(i.length)),t.startsWith("http")||(t=(0,yl.buildAbsoluteURL)(r,t.startsWith("/")?t:`/${t}`)),e.open("GET",zs(t),!0)}});return o.loadSource(e),o.attachMedia(t),o.on(_l().Events.ERROR,(function(e,t){if(t.fatal)switch(t.type){case _l().ErrorTypes.NETWORK_ERROR:o.startLoad();break;case _l().ErrorTypes.MEDIA_ERROR:o.recoverMediaError();break;default:return void n(e)}})),o}var tc=n(99477);const nc=new tc.LoadingManager;let ic,rc;function oc(e){return rc||(rc=new Ss.g(nc).detectSupport(AFRAME.scenes[0].renderer)),new Promise(((t,n)=>{rc.load(e,(function(e){e.encoding=tc.sRGBEncoding,e.onUpdate=function(){e.mipmaps.length=0},t(e)}),void 0,(function(t){console.error(t),n(new Error(`'${e}' could not be fetched (Error: ${t}`))}))}))}function sc(e){return ic||(ic=new Ps.a(nc).detectSupport(AFRAME.scenes[0].renderer)),new Promise(((t,n)=>{ic.load(e,(function(e){e.encoding=tc.sRGBEncoding,e.onUpdate=function(){e.mipmaps.length=0},e.anisotropy=4,t(e)}),void 0,(function(t){console.error(t),n(new Error(`'${e}' could not be fetched (Error: ${t}`))}))}))}nc.setURLModifier((function(e){return"basis_transcoder.js"===e?js.Z:"basis_transcoder.wasm"===e?Is.Z:e}));var ac=n(99477);function lc(e,t,n,i,r,o,s){try{var a=e[o](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(i,r)}class cc extends ac.Texture{constructor(e,t,n){super(document.createElement("canvas")),this.image.width=e[0].width,this.image.height=e[0].height,this._ctx=this.image.getContext("2d"),this.generateMipmaps=!1,this.isVideoTexture=!0,this.minFilter=ac.NearestFilter,this.frames=e,this.delays=t,this.disposals=n,this.frame=0,this.frameStartTime=Date.now()}update(){if(!this.frames||!this.delays||!this.disposals)return;const e=Date.now();e-this.frameStartTime>this.delays[this.frame]&&(2===this.disposals[this.frame]&&this._ctx.clearRect(0,0,this.image.width,this.image.width),this.frame=(this.frame+1)%this.frames.length,this.frameStartTime=e,this._ctx.drawImage(this.frames[this.frame],0,0,this.image.width,this.image.height),this.needsUpdate=!0)}}const dc=sa(new function(){return la()('self.onmessage=s=>{try{const e=function(s){let e=0;const r=[];let a=null;const o=[],t=[];let n=0;if(71!==s[0]||73!==s[1]||70!==s[2]||56!==s[3]||57!==s[4]||97!==s[5])throw new Error("parseGIF: no GIF89a");{e+=13+ +!!(128&s[10])*Math.pow(2,1+(7&s[10]))*3;const l=s.subarray(0,e);for(;s[e]&&59!==s[e];){const c=e,f=s[e];if(33===f){const o=s[++e];if(-1===[1,254,249,255].indexOf(o))throw new Error("parseGIF: unknown label");for(249===o&&r.push(10*(s[e+3]+(s[e+4]<<8))),255===o&&(n=s[e+15]+(s[e+16]<<8));s[++e];)e+=s[e];249===o&&(a=s.subarray(c,e+1),t.push(a[3]>>2&7))}else{if(44!==f)throw new Error("parseGIF: unknown blockId");{for(e+=9,e+=1+ +!!(128&s[e])*(3*Math.pow(2,1+(7&s[e])));s[++e];)e+=s[e];const r=s.subarray(c,e+1);o.push(URL.createObjectURL(new Blob([l,a,r])))}}e++}}return{delayTimes:r,loopCnt:n,frames:o,disposals:t}}(new Uint8Array(s.data.payload));self.postMessage({id:s.data.id,result:e})}catch(e){self.postMessage({id:s.data.id,err:e.message})}};\n',"Worker",void 0,void 0)});function uc(e){return hc.apply(this,arguments)}function hc(){var e;return e=function*(e){return new Promise(((t,n)=>{fetch(e,{mode:"cors"}).then((e=>e.arrayBuffer())).then((e=>dc(e,[e]))).then((n=>{const{frames:i,delayTimes:r,disposals:o}=n;let s=0;for(let n=0;n<i.length;n++){const a=new Image;a.onload=a=>{if(s++,i[n]=a.target,s===i.length){const n=new cc(i,r,o);n.image.src=e,n.encoding=ac.sRGBEncoding,n.minFilter=ac.LinearFilter,t(n)}},a.src=i[n]}})).catch(n)}))},hc=function(){var t=this,n=arguments;return new Promise((function(i,r){var o=e.apply(t,n);function s(e){lc(o,i,r,s,a,"next",e)}function a(e){lc(o,i,r,s,a,"throw",e)}s(void 0)}))},hc.apply(this,arguments)}let pc;class mc extends Error{constructor(){super(),this.name="CoroutineTimerError",this.message="Cannot call coroutine timer functions outside of coroutines."}}const fc=function(){let e=0;return function(){return e++}}();const gc=Promise.resolve();function vc(){return gc}function bc(e,t){let n,i=!1,r=!1;const o=new Map,s=function*(){for(;;){const s=performance.now();if(o.forEach(((e,t)=>{let{repeat:n,fn:i,ms:r,exp:a}=e;s>a&&(i(),n?o.set(t,{repeat:n,fn:i,exp:a+r,ms:r}):o.delete(t))})),i){yield;continue}pc=o;const a=r?e.throw(n):e.next(n),l=a.done;let c=a.value;if(r=!1,pc=null,l)return c;if(c.$rollback===wc&&(t.push(c.rollback),c=c.promise),c.__proto__!==Promise.prototype)throw console.error("Coroutine yielded value that was not a promise or cancelable.",c,e),new Error("Coroutine yielded value that was not a promise or cancelable.");i=!0,c.then((e=>{i=!1,n=e})).catch((e=>{i=!1,r=!0,n=e}))}}();return function(){return s.next()}}class yc{constructor(){this.jobs=new Map}add(e,t){if(this.jobs.has(e))throw new Error(`Job already exists for key ${e}`);this.jobs.set(e,{startCallback:t,abortController:new AbortController,rollbacks:[]})}has(e){return this.jobs.has(e)}stop(e){const t=this.jobs.get(e);if(!t)return!1;t.abortController.abort();for(let e=t.rollbacks.length-1;e>=0;e--)t.rollbacks[e]();return this.jobs.delete(e),!0}tick(){this.jobs.forEach(((e,t)=>{if(!e.coroutine){const t=()=>{e.rollbacks.length=0};e.coroutine=bc(e.startCallback(t,e.abortController.signal),e.rollbacks)}e.coroutine().done&&this.jobs.delete(t)}))}}const wc=Symbol("rollback");class _c{constructor(e,t){this.promise=void 0,this.rollback=void 0,this.$rollback=wc,this.promise=e,this.rollback=t}}function Ec(e,t){return new _c(e,t)}function Ac(e,t,n,i,r,o,s){try{var a=e[o](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(i,r)}function Sc(e){return function(){var t=this,n=arguments;return new Promise((function(i,r){var o=e.apply(t,n);function s(e){Ac(o,i,r,s,a,"next",e)}function a(e){Ac(o,i,r,s,a,"throw",e)}s(void 0)}))}}const xc=new nl;xc.cache.set(nl.key("error",1),{cacheKey:nl.key("error",1),texture:Ka,ratio:1400/1200,count:1});const Mc=new Map;function Pc(e,t){if(!xc.has(e,t))throw new Error(`Texture not in cache: ${e} ${t}`);return xc.retain(e,t)}function Cc(e,t,n){return kc.apply(this,arguments)}function kc(){return(kc=Sc((function*(e,t,n){if(xc.has(e,t))return xc.retain(e,t);const i=nl.key(e,t);if(Mc.has(i))return yield Mc.get(i),xc.retain(e,t);const r=function(e,t){if(e.includes("image/gif"))return uc(t);if(e.includes("image/basis"))return oc(t);if(e.includes("image/ktx2"))return sc(t);if(e.startsWith("image/"))return Wl(t);throw new Error(`Unknown image content type: ${e}`)}(n,e);Mc.set(i,r);try{const n=yield r;return xc.set(e,t,n)}finally{Mc.delete(i)}}))).apply(this,arguments)}function Oc(e){return Tc.apply(this,arguments)}function Tc(){return(Tc=Sc((function*(e){xc.releaseByKey(e)}))).apply(this,arguments)}var Rc=n.p+"assets/models/LoadingObject_Atom-be9548cf39e6a9f498ea..glb",Dc=n(99477);let jc=new Dc.Mesh(new Dc.BoxGeometry,new Dc.MeshBasicMaterial);function*Lc(e){let{properties:t,durationMS:n,easing:i,fn:r}=e;const o=t.map((e=>{let[t]=e;return"number"==typeof t?t:(new wt.Vector3).copy(t)})),s=performance.now(),a=s+n;let l=s;for(;l<a;){const e=i((l-s)/(a-s));for(let n=0;n<o.length;n++)"number"==typeof o[n]?o[n]=wt.MathUtils.lerp(t[n][0],t[n][1],e):o[n].lerpVectors(t[n][0],t[n][1],e);r(o),yield Promise.resolve(),l=performance.now()}for(let e=0;e<o.length;e++)"number"==typeof o[e]?o[e]=t[e][1]:o[e].copy(t[e][1]);r(o)}function Ic(e,t,n){let i=0;e.eid2obj.get(n).traverse((function(n){n.eid&&(0,Ot.hasComponent)(e,Rt,n.eid)&&(Nc(n.eid,`${t}.${i}`,t),i+=1)}))}function Nc(e,t,n){Rt.id[e]=APP.getSid(t),APP.world.nid2eid.set(Rt.id[e],e),Rt.creator[e]=APP.getSid(n),Rt.owner[e]=APP.getSid("reticulum"),Rt.lastOwnerTime[e]=0}function Fc(e){return e*(2-e)}ja(Rc,null,!0).then((e=>{Mo(jc),jc=e.scene}));const Bc=function(){const e=.3/(2*Math.PI),t=Math.asin(1)*e;return function(n){return 1-1*Math.pow(2,-10*(n=+n))*Math.sin((n+t)/e)}}();var Vc=n(99477);function*Uc(e,t,n,i){const{scene:r,animations:o}=yield ja(t,n,i,null);return r.animations=o,r.mixer=new Vc.AnimationMixer(r),Lh(e,kh("entity",{model:{model:r}}))}var Hc=n(58395);const zc=Jn.map;function*Wc(e,t){let{pdf:n,canvasContext:i,material:r}=e;const o=yield n.getPage(t),s=o.getViewport({scale:3});r.map.image.width=s.width,r.map.image.height=s.height;const a=o.render({canvasContext:i,viewport:s,intent:"print"});return yield a.promise,r.map.needsUpdate=!0,r.needsUpdate=!0,{width:s.width,height:s.height}}Hc.GlobalWorkerOptions.workerSrc=n(44412).Z;const qc=new yc,Zc=(0,Ot.defineQuery)([Jn,$n]),Gc=(0,Ot.exitQuery)(Zc);function Yc(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function Qc(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Yc(Object(n),!0).forEach((function(t){Xc(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Yc(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Xc(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class Kc extends wt.VideoTexture{constructor(e,t,n,i,r,o,s,a,l){super(e,t,n,i,r,o,s,a,l),this.isDashVideoTexture=void 0,this.player=void 0,this.isDashVideoTexture=!0,this.player=null}dispose(){super.dispose(),null!==this.player&&(this.player.reset(),this.player=null)}}class $c extends wt.VideoTexture{constructor(e,t,n,i,r,o,s,a,l){super(e,t,n,i,r,o,s,a,l),this.isHLSVideoTexture=void 0,this.player=void 0,this.isHLSVideoTexture=!0,this.player=null}dispose(){super.dispose(),null!==this.player&&(this.player.stopLoad(),this.player.detachMedia(),this.player.destroy(),this.player=null)}}function Jc(e,t,n,i,r,o,s){try{var a=e[o](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(i,r)}function ed(){var e;return e=function*(e,t){const n=Gl("video");let i=null;return new Promise(((r,o)=>{let s;const a=function(e){n.onerror=null,clearTimeout(s),o(e)};t.startsWith("application/dash")?(i=new Kc(n),i.player=Jl(e,n,a)):AFRAME.utils.material.isHLS(e,t)&&(i=new $c(n),_l().isSupported()?i.player=ec(e,n,a):n.canPlayType(t)||a("HLS unsupported")),null===i&&(i=new wt.VideoTexture(n),n.src=e,n.onerror=a),i.minFilter=wt.LinearFilter,i.encoding=wt.sRGBEncoding;const l=()=>{if(!0===i.isHLSVideoTexture&&!0===i.player.streamController.audioOnly?(i.image.videoWidth=1,i.image.videoHeight=1,1):(i.image.videoHeight||i.image.height)&&(i.image.videoWidth||i.image.width)){n.onerror=null;const e=i.image.videoHeight||i.image.height,t=i.image.videoWidth||i.image.width;r({texture:i,audioSourceEl:i.image,ratio:e/t})}else s=setTimeout(l,500)};l()}))},ed=function(){var t=this,n=arguments;return new Promise((function(i,r){var o=e.apply(t,n);function s(e){Jc(o,i,r,s,a,"next",e)}function a(e){Jc(o,i,r,s,a,"throw",e)}s(void 0)}))},ed.apply(this,arguments)}function td(e,t,n,i,r,o,s){try{var a=e[o](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(i,r)}function nd(){var e;return e=function*(e){const t=Gl("video"),n=new wt.VideoTexture(t);return new Promise(((i,r)=>{let o;t.src=e,t.onerror=function(e){t.onerror=null,clearTimeout(o),r(e)};const s=()=>{t.readyState>0?(t.onerror=null,i({texture:n,ratio:3/4})):o=setTimeout(s,500)};s()}))},nd=function(){var t=this,n=arguments;return new Promise((function(i,r){var o=e.apply(t,n);function s(e){td(o,i,r,s,a,"next",e)}function a(e){td(o,i,r,s,a,"throw",e)}s(void 0)}))},nd.apply(this,arguments)}var id=n(99477);function*rd(e,t){for(;(0,Ot.hasComponent)(e,Zn,t);)yield vc()}const od={[Ml.IMAGE]:(e,t)=>{let{accessibleUrl:n,contentType:i}=t;return function*(e,t,n){const{texture:i,ratio:r,cacheKey:o}=yield function(e,t,n){const i=Cc(e,1,n);return Ec(i,(()=>{i.then((e=>{let{cacheKey:t}=e;Oc(t)}))}))}(t,0,n);let s=Ja.Blend;return"image/gif"===n?s=Ja.Mask:"image/jpeg"===n&&(s=Ja.Opaque),Lh(e,kh("entity",{name:"Image",image:{texture:i,ratio:r,projection:Ya.FLAT,alphaMode:s,cacheKey:o}}))}(e,n,i)},[Ml.VIDEO]:(e,t)=>{let{accessibleUrl:n,contentType:i}=t;return function*(e,t,n){const{texture:i,ratio:r}=yield function(e,t){return ed.apply(this,arguments)}(t,n);return Lh(e,kh("entity",{name:"Video",networked:!0,networkedVideo:!0,grabbable:{cursor:!0,hand:!1},video:{texture:i,ratio:r,autoPlay:!0,projection:Ya.FLAT}}))}(e,n,i)},[Ml.MODEL]:(e,t)=>{let{accessibleUrl:n,contentType:i}=t;return Uc(e,n,i,!0)},[Ml.PDF]:(e,t)=>{let{accessibleUrl:n}=t;return function*(e,t){const n=yield*function*(e){const t=yield(0,Hc.getDocument)(e).promise,n=document.createElement("canvas"),i=n.getContext("2d"),r=new wt.CanvasTexture(n);r.encoding=wt.sRGBEncoding,r.minFilter=wt.LinearFilter;const o=new wt.MeshBasicMaterial;return o.map=r,o.side=wt.DoubleSide,o.transparent=!1,{pdf:t,canvasContext:i,material:o}}(t),{width:i,height:r}=yield*Wc(n,1);return Lh(e,kh("entity",{name:"PDF",scale:[Math.min(1,i/r),Math.min(1,r/i),1],networked:!0,grabbable:{cursor:!0,hand:!1},pdf:Qc({pageNumber:1},n)}))}(e,n)},[Ml.AUDIO]:(e,t)=>{let{accessibleUrl:n}=t;return function*(e,t){const{texture:n,ratio:i}=yield function(e){return nd.apply(this,arguments)}(t);return Lh(e,kh("entity",{name:"Audio",networked:!0,networkedVideo:!0,grabbable:{cursor:!0,hand:!1},video:{texture:n,ratio:i,autoPlay:!0,projection:Ya.FLAT}}))}(e,n)}},sd={RECENTER:1,RESIZE:2,ANIMATE_LOAD:4,IS_OBJECT_MENU_TARGET:8};function*ad(e,t){const n=e.eid2obj.get(t),i=e=>{let[t,i]=e;n.position.copy(t),n.scale.copy(i),n.matrixNeedsUpdate=!0},r=(new wt.Vector3).copy(n.scale).multiplyScalar(.001),o=(new wt.Vector3).copy(n.scale),s=(new wt.Vector3).copy(n.position).multiplyScalar(.001),a=(new wt.Vector3).copy(n.position);i([s,r]),yield vc(),yield*Lc({properties:[[s,a],[r,o]],durationMS:400,easing:Fc,fn:i})}function ld(e,t,n){const i=e.eid2obj.get(n),r=e.eid2obj.get(t);i.add(r)}class cd extends Error{constructor(e,t){var n;super(),this.name="UnsupportedMediaTypeError",this.message=`Cannot load media for entity ${e}. No loader for media type ${t} (${n=t,Pl.get(n)||"unknown"}).`}}function*dd(e,t){let n=0;const i=function(i,r){if(!pc)throw new mc;const o=performance.now(),s=fc();return pc.set(s,{repeat:!1,fn:()=>{n=Lh(e,kh("entity",{name:"Loading Object",object3D:jc.clone()})),ld(e,n,t)},ms:400,exp:o+400}),s}();yield Ec(Promise.resolve(),(()=>n&&(0,Ot.removeEntity)(e,n)));const r=APP.getString(Zn.src[t]);let o;try{const n=yield function(e){return $l.apply(this,arguments)}(r),i=n.mediaType&&od[n.mediaType];if(!i)throw new cd(t,n.mediaType);o=yield*i(e,n),(0,Ot.addComponent)(e,Gn,o)}catch(t){console.error(t),o=Lh(e,kh("entity",{image:{texture:Pc("error",1).texture,ratio:1400/1200,projection:Ya.FLAT,alphaMode:Ja.Blend,cacheKey:nl.key("error",1)}}))}return function(e){if(!pc)throw new mc;pc.delete(e)}(i),n&&(0,Ot.removeEntity)(e,n),o}const ud=new yc,hd=(0,Ot.defineQuery)([Zn]),pd=(0,Ot.enterQuery)(hd),md=(0,Ot.exitQuery)(hd);function fd(e,t,n){let{src:i,recenter:r,resize:o,animateLoad:s,isObjectMenuTarget:a}=n;(0,Ot.addComponent)(e,Zn,t);let l=0;r&&(l|=sd.RECENTER),o&&(l|=sd.RESIZE),s&&(l|=sd.ANIMATE_LOAD),a&&(l|=sd.IS_OBJECT_MENU_TARGET),Zn.flags[t]=l,Zn.src[t]=APP.getSid(i)}let gd,vd;!function(e){e[e.STATIC=0]="STATIC",e[e.DYNAMIC=1]="DYNAMIC",e[e.KINEMATIC=2]="KINEMATIC"}(gd||(gd={})),function(e){e[e.ACTIVE_TAG=0]="ACTIVE_TAG",e[e.ISLAND_SLEEPING=1]="ISLAND_SLEEPING",e[e.WANTS_DEACTIVATION=2]="WANTS_DEACTIVATION",e[e.DISABLE_DEACTIVATION=3]="DISABLE_DEACTIVATION",e[e.DISABLE_SIMULATION=4]="DISABLE_SIMULATION"}(vd||(vd={}));const bd={type:gd.DYNAMIC,mass:1,gravity:[0,-9.8,0],linearDamping:.01,angularDamping:.01,linearSleepingThreshold:1.6,angularSleepingThreshold:2.5,angularFactor:[1,1,1],activationState:vd.ACTIVE_TAG,emitCollisionEvents:!1,disableCollision:!1,collisionGroup:1,collisionMask:1,scaleAutoUpdate:!0},yd=1,wd=2,_d=4,Ed=e=>Object.values(Na.tl.TYPE)[Ln.type[e]],Ad=e=>Object.values(Na.tl.ACTIVATION_STATE)[Ln.activationState[e]];function Sd(e,t,n){const i=Object.assign({},bd,n);return(0,Ot.addComponent)(e,Ln,t),Ln.type[t]=i.type,Ln.mass[t]=i.mass,Ln.gravity[t].set(i.gravity),Ln.linearDamping[t]=i.linearDamping,Ln.angularDamping[t]=i.angularDamping,Ln.linearSleepingThreshold[t]=i.linearSleepingThreshold,Ln.angularSleepingThreshold[t]=i.angularSleepingThreshold,Ln.angularFactor[t].set(i.angularFactor),Ln.activationState[t]=i.activationState,n.emitCollisionEvents&&(Ln.flags[t]|=yd),n.disableCollision&&(Ln.flags[t]|=wd),Ln.collisionFilterGroup[t]=i.collisionGroup,Ln.collisionFilterMask[t]=i.collisionMask,i.scaleAutoUpdate&&(Ln.flags[t]|=_d),t}const xd={bounds:{x:1,y:1,z:1},mediaType:"all"},Md={cursor:!0,hand:!0},Pd=["visible","frustum","frustrum","shadow","networked"];function Cd(e,t,n,i){Object.keys(n).forEach((r=>{const o=r.replace(/-(\w)/g,((e,t)=>t.toUpperCase()));if(Pd.includes(o))return;if(!function(e){return Object.prototype.hasOwnProperty.call(jh,e)}(o))return void console.warn(`Failed to inflate unknown component called ${o}`,n[r]);const s=n[r];Object.keys(s).forEach((t=>{const n=s[t],r=null==n?void 0:n.__mhc_link_type;if(r){if("node"!==r)throw new Error("Non node link types should be resolved before inflateModel is called");const o=i.get(n.index);o?s[t]=o:(s[t]=(0,Ot.addEntity)(e),i.set(n.index,s[t]))}})),jh[o](e,t,s)}))}function kd(e,t,n){fd(e,t,{src:n.src,recenter:!1,resize:!1,animateLoad:!1,isObjectMenuTarget:!1})}var Od=n(99477);const Td={front:wt.FrontSide,back:wt.BackSide,double:wt.DoubleSide},Rd={anchorX:"center",anchorY:"middle",clipRect:null,color:"#ffffff",curveRadius:0,depthOffset:0,direction:"auto",fillOpacity:1,fontUrl:null,fontSize:.075,glyphGeometryDetail:1,gpuAccelerateSDF:!0,letterSpacing:0,lineHeight:"normal",maxWidth:1/0,opacity:1,outlineBlur:0,outlineColor:"#000000",outlineOffsetX:0,outlineOffsetY:0,outlineOpacity:1,outlineWidth:0,overflowWrap:"normal",sdfGlyphSize:null,side:"front",strokeColor:"grey",strokeOpacity:1,strokeWidth:0,textAlign:"center",textIndent:0,value:"",whiteSpace:"normal"};var Dd=n(99477);function jd(e,t,n){(0,Ot.addComponent)(e,li,t);const i=li.map,r=Object.assign(i.get(t)||{},n);i.set(t,r)}var Ld=n.p+"assets/images/sprites/notice/spawn-point-cff9b979dda317481758..png";function Id(e,t){if((0,Ot.hasComponent)(e,Ut,t)){const n=e.eid2obj.get(t).el;!NAF.utils.isMine(n)&&NAF.utils.takeOwnership(n)}else(0,Ot.addComponent)(e,Dt,t),Rt.lastOwnerTime[t]=Math.max($i(),Rt.lastOwnerTime[t]+1),Rt.owner[t]=APP.getSid(NAF.clientId)}function Nd(e,t){if((0,Ot.hasComponent)(e,Ut,t))throw new Error("Cannot take soft ownership of AEntities.");(0,Ot.addComponent)(e,Dt,t),Rt.lastOwnerTime[t]=Rt.timestamp[t]+1,Rt.owner[t]=APP.getSid(NAF.clientId)}let Fd;!function(e){e[e.canBeSpawnPoint=1]="canBeSpawnPoint",e[e.canBeOccupied=2]="canBeOccupied",e[e.canBeClicked=4]="canBeClicked",e[e.willDisableMotion=8]="willDisableMotion",e[e.willDisableTeleporting=16]="willDisableTeleporting",e[e.willMaintainInitialOrientation=32]="willMaintainInitialOrientation",e[e.snapToNavMesh=64]="snapToNavMesh"}(Fd||(Fd={}));const Bd=(0,Ot.defineQuery)([vi]);let Vd=0;function Ud(e,t){if(!(0,Ot.hasComponent)(e,Dt,t))throw new Error("Tried to occupy waypoint before owning it.");bi.occupied[t]=1,Vd=t}function Hd(e){return Bd(e).filter((t=>{const n=vi.flags[t]&Fd.canBeSpawnPoint,i=vi.flags[t]&Fd.canBeOccupied;return n&&i&&!bi.occupied[t]&&Yo(e,Yn,t)}))}function*zd(e,t,n){return Zd(e,n,t,!0),Nd(e,n),Ud(e,n),yield I(2e3),!(!(0,Ot.entityExists)(e,n)||!(0,Ot.hasComponent)(e,Dt,n)||(Id(e,n),0))}let Wd=null;function qd(e,t){Wd=bc(function*(e,t){if(yield*function*(e,t){for(let n=0;n<3;n++){const n=Hd(e);if(!n.length)return!1;const i=n[Math.floor(Math.random()*n.length)];if(yield*zd(e,t,i))return!0}return!1}(e,t))return;const n=function(e){return Bd(e).filter((t=>{const n=vi.flags[t]&Fd.canBeSpawnPoint,i=vi.flags[t]&Fd.canBeOccupied;return n&&!i&&Yo(e,Yn,t)}))}(e);n.length?Zd(e,n[Math.floor(Math.random()*n.length)],t,!0):(console.warn("Could not find any available spawn points, spawning at the origin."),t.enqueueWaypointTravelTo((new wt.Matrix4).identity(),!0,{willDisableMotion:!1,willDisableTeleporting:!1,snapToNavMesh:!0,willMaintainInitialOrientation:!1}))}(e,t))}function Zd(e,t,n,i){const r=e.eid2obj.get(t);r.updateMatrices(),n.enqueueWaypointTravelTo(r.matrixWorld,i||!window.APP.store.state.preferences.animateWaypointTransitions,{willDisableMotion:!!(vi.flags[t]&Fd.willDisableMotion),willDisableTeleporting:!!(vi.flags[t]&Fd.willDisableTeleporting),snapToNavMesh:!!(vi.flags[t]&Fd.snapToNavMesh),willMaintainInitialOrientation:!!(vi.flags[t]&Fd.willMaintainInitialOrientation)})}const Gd=(0,Ot.defineQuery)([vi,dn]),Yd=(0,Ot.defineQuery)([vi,cn]),Qd=(0,Ot.exitQuery)((0,Ot.defineQuery)([Dt]));let Xd;const Kd=[];function $d(){return Promise.all(Kd)}function Jd(e){Kd.push(e)}function eu(e,t,n){(0,Ot.addComponent)(e,vi,t);let i=0;if(n.canBeSpawnPoint&&(i|=Fd.canBeSpawnPoint),n.canBeOccupied&&(i|=Fd.canBeOccupied),n.canBeClicked&&(i|=Fd.canBeClicked),n.willDisableMotion&&(i|=Fd.willDisableMotion),n.willDisableTeleporting&&(i|=Fd.willDisableTeleporting),n.willMaintainInitialOrientation&&(i|=Fd.willMaintainInitialOrientation),n.snapToNavMesh&&(i|=Fd.snapToNavMesh),vi.flags[t]=i,vi.flags[t]&Fd.canBeOccupied&&((0,Ot.addComponent)(e,Rt,t),(0,Ot.addComponent)(e,bi,t)),n.canBeClicked){const{texture:n,cacheKey:i}=Pc(Ld,1);Lh(e,kh("entity",{name:"Waypoint",ref:Mh(t),cursorRaycastable:!0,remoteHoverTarget:!0,singleActionButton:!0},kh("entity",{name:"Waypoint Icon",position:[0,1.6,-.15],scale:[.5,.5,.5],image:{texture:n,ratio:1,projection:Ya.FLAT,alphaMode:Ja.Blend,cacheKey:i}})))}}Jd(Cc(Ld,1,"image/png"));var tu=n(99477);const nu={size:1,envMapTexture:null},iu={intensity:1},ru={skyColor:"#ffffff",groundColor:"#ffffff",intensity:1},ou={color:"#ffffff",intensity:1,range:0,decay:2,castShadow:!0,shadowMapResolution:[512,512],shadowBias:0,shadowRadius:1},su={color:"#ffffff",intensity:1,range:0,decay:2,innerConeAngle:0,outerConeAngle:Math.PI/4,castShadow:!0,shadowMapResolution:[512,512],shadowBias:0,shadowRadius:1};var au=n(38780),lu=n(99477);const{AmbientLight:cu,BackSide:du,BoxBufferGeometry:uu,CubeCamera:hu,LinearFilter:pu,Mesh:mu,Object3D:fu,PMREMGenerator:gu,RGBAFormat:vu,Scene:bu,ShaderMaterial:yu,sRGBEncoding:wu,UniformsLib:_u,UniformsUtils:Eu,Vector3:Au,WebGLCubeRenderTarget:Su}=lu;class xu extends fu{constructor(){super();const e=new yu({fragmentShader:xu.shader.fragmentShader,vertexShader:xu.shader.vertexShader,uniforms:Eu.clone(xu.shader.uniforms),side:du,fog:!0});this.sky=new mu(xu._geometry,e),this.sky.name="Sky",this.add(this.sky),this._inclination=0,this._azimuth=.15,this._distance=8e3,this.updateSunPosition()}get turbidity(){return this.sky.material.uniforms.turbidity.value}set turbidity(e){this.sky.material.uniforms.turbidity.value=e}get rayleigh(){return this.sky.material.uniforms.rayleigh.value}set rayleigh(e){this.sky.material.uniforms.rayleigh.value=e}get luminance(){return this.sky.material.uniforms.luminance.value}set luminance(e){this.sky.material.uniforms.luminance.value=e}get mieCoefficient(){return this.sky.material.uniforms.mieCoefficient.value}set mieCoefficient(e){this.sky.material.uniforms.mieCoefficient.value=e}get mieDirectionalG(){return this.sky.material.uniforms.mieDirectionalG.value}set mieDirectionalG(e){this.sky.material.uniforms.mieDirectionalG.value=e}get inclination(){return this._inclination}set inclination(e){this._inclination=e,this.updateSunPosition()}get azimuth(){return this._azimuth}set azimuth(e){this._azimuth=e,this.updateSunPosition()}get distance(){return this._distance}set distance(e){this._distance=e,this.updateSunPosition()}updateSunPosition(){const e=Math.PI*(this._inclination-.5),t=2*Math.PI*(this._azimuth-.5),n=Math.min(1e3,this._distance),i=n*Math.cos(t),r=n*Math.sin(t)*Math.sin(e),o=n*Math.sin(t)*Math.cos(e);this.sky.material.uniforms.sunPosition.value.set(i,r,o).normalize(),this.sky.scale.set(n,n,n)}generateEnvironmentMap(e){const t=new bu,n=new hu(1,1e5,new Su(512));t.add(n),t.add(this.sky),n.update(e,t),this.add(this.sky);const i=e.xr.enabled;e.xr.enabled=!1;const r=new gu(e),o=r.fromCubemap(n.renderTarget.texture).texture;return e.xr.enabled=i,r.dispose(),n.renderTarget.dispose(),o}generateLightProbe(e){const t=new bu;t.add(this.sky);const n=new hu(1,1e5,new Su(512,{format:vu,magFilter:pu,minFilter:pu,encoding:wu}));t.add(n),t.add(this.sky),n.update(e,t),this.add(this.sky);const i=au.F.fromCubeRenderTarget(e,n.renderTarget);return n.renderTarget.dispose(),i}copy(e,t){if(void 0===t&&(t=!0),t&&this.remove(this.sky),super.copy(e,t),t){const t=e.children.indexOf(e.sky);-1!==t&&(this.sky=this.children[t])}return this.turbidity=e.turbidity,this.rayleigh=e.rayleigh,this.luminance=e.luminance,this.mieCoefficient=e.mieCoefficient,this.mieDirectionalG=e.mieDirectionalG,this.inclination=e.inclination,this.azimuth=e.azimuth,this.distance=e.distance,this}}xu.shader={uniforms:Eu.merge([_u.fog,{luminance:{value:1},turbidity:{value:10},rayleigh:{value:2},mieCoefficient:{value:.005},mieDirectionalG:{value:.8},sunPosition:{value:new Au}}]),vertexShader:"\n#include <common>\n#include <fog_pars_vertex>\n\nuniform vec3 sunPosition;\nuniform float rayleigh;\nuniform float turbidity;\nuniform float mieCoefficient;\n\nvarying vec3 vWorldPosition;\nvarying vec3 vSunDirection;\nvarying float vSunfade;\nvarying vec3 vBetaR;\nvarying vec3 vBetaM;\nvarying float vSunE;\n\nconst vec3 up = vec3( 0.0, 1.0, 0.0 );\n\n// constants for atmospheric scattering\nconst float e = 2.71828182845904523536028747135266249775724709369995957;\nconst float pi = 3.141592653589793238462643383279502884197169;\n\n// wavelength of used primaries, according to preetham\nconst vec3 lambda = vec3( 680E-9, 550E-9, 450E-9 );\n// this pre-calcuation replaces older TotalRayleigh(vec3 lambda) function:\n// (8.0 * pow(pi, 3.0) * pow(pow(n, 2.0) - 1.0, 2.0) * (6.0 + 3.0 * pn)) / (3.0 * N * pow(lambda, vec3(4.0)) * (6.0 - 7.0 * pn))\nconst vec3 totalRayleigh = vec3( 5.804542996261093E-6, 1.3562911419845635E-5, 3.0265902468824876E-5 );\n\n// mie stuff\n// K coefficient for the primaries\nconst float v = 4.0;\nconst vec3 K = vec3( 0.686, 0.678, 0.666 );\n// MieConst = pi * pow( ( 2.0 * pi ) / lambda, vec3( v - 2.0 ) ) * K\nconst vec3 MieConst = vec3( 1.8399918514433978E14, 2.7798023919660528E14, 4.0790479543861094E14 );\n\n// earth shadow hack\n// cutoffAngle = pi / 1.95;\nconst float cutoffAngle = 1.6110731556870734;\nconst float steepness = 1.5;\nconst float EE = 1000.0;\n\nfloat sunIntensity( float zenithAngleCos ) {\n  zenithAngleCos = clamp( zenithAngleCos, -1.0, 1.0 );\n  return EE * max( 0.0, 1.0 - pow( e, -( ( cutoffAngle - acos( zenithAngleCos ) ) / steepness ) ) );\n}\n\nvec3 totalMie( float T ) {\n  float c = ( 0.2 * T ) * 10E-18;\n  return 0.434 * c * MieConst;\n}\n\nvoid main() {\n  #include <begin_vertex>\n\n  vec4 worldPosition = modelMatrix * vec4( position, 1.0 );\n  vWorldPosition = worldPosition.xyz;\n\n  #include <project_vertex>\n\n  vSunDirection = normalize( sunPosition );\n\n  vSunE = sunIntensity( dot( vSunDirection, up ) );\n\n  vSunfade = 1.0 - clamp( 1.0 - exp( ( sunPosition.y / 450000.0 ) ), 0.0, 1.0 );\n\n  float rayleighCoefficient = rayleigh - ( 1.0 * ( 1.0 - vSunfade ) );\n\n  // extinction (absorbtion + out scattering)\n  // rayleigh coefficients\n  vBetaR = totalRayleigh * rayleighCoefficient;\n\n  // mie coefficients\n  vBetaM = totalMie( turbidity ) * mieCoefficient;\n\n  #include <fog_vertex>\n}\n",fragmentShader:"\n#include <common>\n#include <fog_pars_fragment>\n\nvarying vec3 vWorldPosition;\nvarying vec3 vSunDirection;\nvarying float vSunfade;\nvarying vec3 vBetaR;\nvarying vec3 vBetaM;\nvarying float vSunE;\n\nuniform float luminance;\nuniform float mieDirectionalG;\n\nconst vec3 cameraPos = vec3( 0.0, 0.0, 0.0 );\n\n// constants for atmospheric scattering\nconst float pi = 3.141592653589793238462643383279502884197169;\n\nconst float n = 1.0003; // refractive index of air\nconst float N = 2.545E25; // number of molecules per unit volume for air at\n// 288.15K and 1013mb (sea level -45 celsius)\n\n// optical length at zenith for molecules\nconst float rayleighZenithLength = 8.4E3;\nconst float mieZenithLength = 1.25E3;\nconst vec3 up = vec3( 0.0, 1.0, 0.0 );\n// 66 arc seconds -> degrees, and the cosine of that\nconst float sunAngularDiameterCos = 0.999956676946448443553574619906976478926848692873900859324;\n\n// 3.0 / ( 16.0 * pi )\nconst float THREE_OVER_SIXTEENPI = 0.05968310365946075;\n// 1.0 / ( 4.0 * pi )\nconst float ONE_OVER_FOURPI = 0.07957747154594767;\n\nfloat rayleighPhase( float cosTheta ) {\n  return THREE_OVER_SIXTEENPI * ( 1.0 + pow( cosTheta, 2.0 ) );\n}\n\nfloat hgPhase( float cosTheta, float g ) {\n  float g2 = pow( g, 2.0 );\n  float inverse = 1.0 / pow( 1.0 - 2.0 * g * cosTheta + g2, 1.5 );\n  return ONE_OVER_FOURPI * ( ( 1.0 - g2 ) * inverse );\n}\n\n// Filmic ToneMapping http://filmicgames.com/archives/75\nconst float A = 0.15;\nconst float B = 0.50;\nconst float C = 0.10;\nconst float D = 0.20;\nconst float E = 0.02;\nconst float F = 0.30;\n\nconst float whiteScale = 1.0748724675633854; // 1.0 / Uncharted2Tonemap(1000.0)\n\nvec3 Uncharted2Tonemap( vec3 x ) {\n  return ( ( x * ( A * x + C * B ) + D * E ) / ( x * ( A * x + B ) + D * F ) ) - E / F;\n}\n\nvoid main() {\n  // optical length\n  // cutoff angle at 90 to avoid singularity in next formula.\n  float zenithAngle = acos( max( 0.0, dot( up, normalize( vWorldPosition - cameraPos ) ) ) );\n  float inverse = 1.0 / ( cos( zenithAngle ) + 0.15 * pow( 93.885 - ( ( zenithAngle * 180.0 ) / pi ), -1.253 ) );\n  float sR = rayleighZenithLength * inverse;\n  float sM = mieZenithLength * inverse;\n\n  // combined extinction factor\n  vec3 Fex = exp( -( vBetaR * sR + vBetaM * sM ) );\n\n  // in scattering\n  float cosTheta = dot( normalize( vWorldPosition - cameraPos ), vSunDirection );\n\n  float rPhase = rayleighPhase( cosTheta * 0.5 + 0.5 );\n  vec3 betaRTheta = vBetaR * rPhase;\n\n  float mPhase = hgPhase( cosTheta, mieDirectionalG );\n  vec3 betaMTheta = vBetaM * mPhase;\n\n  vec3 Lin = pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * ( 1.0 - Fex ), vec3( 1.5 ) );\n  Lin *= mix( vec3( 1.0 ), pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * Fex, vec3( 1.0 / 2.0 ) ), clamp( pow( 1.0 - dot( up, vSunDirection ), 5.0 ), 0.0, 1.0 ) );\n\n  // nightsky\n  vec3 direction = normalize( vWorldPosition - cameraPos );\n  float theta = acos( direction.y ); // elevation --\x3e y-axis, [-pi/2, pi/2]\n  float phi = atan( direction.z, direction.x ); // azimuth --\x3e x-axis [-pi/2, pi/2]\n  vec2 uv = vec2( phi, theta ) / vec2( 2.0 * pi, pi ) + vec2( 0.5, 0.0 );\n  vec3 L0 = vec3( 0.1 ) * Fex;\n\n  // composition + solar disc\n  float sundisk = smoothstep( sunAngularDiameterCos, sunAngularDiameterCos + 0.00002, cosTheta );\n  L0 += ( vSunE * 19000.0 * Fex ) * sundisk;\n\n  vec3 texColor = ( Lin + L0 ) * 0.04 + vec3( 0.0, 0.0003, 0.00075 );\n\n  vec3 curr = Uncharted2Tonemap( ( log2( 2.0 / pow( luminance, 4.0 ) ) ) * texColor );\n  vec3 color = curr * whiteScale;\n\n  vec3 retColor = pow( color, vec3( 1.0 / ( 1.2 + ( 1.2 * vSunfade ) ) ) );\n\n  gl_FragColor = vec4( retColor, 1.0 );\n\n  #include <fog_fragment>\n}\n"},xu._geometry=new uu(1,1,1),AFRAME.registerComponent("skybox",{schema:{turbidity:{type:"number",default:10},rayleigh:{type:"number",default:2},luminance:{type:"number",default:1},mieCoefficient:{type:"number",default:.005},mieDirectionalG:{type:"number",default:.8},inclination:{type:"number",default:0},azimuth:{type:"number",default:.15},distance:{type:"number",default:8e3}},init(){this.sky=new xu,this.el.setObject3D("mesh",this.sky)},update(e){if(this.data.turbidity!==e.turbidity&&(this.sky.turbidity=this.data.turbidity),this.data.rayleigh!==e.rayleigh&&(this.sky.rayleigh=this.data.rayleigh),this.data.luminance!==e.luminance&&(this.sky.luminance=this.data.luminance),this.data.mieCoefficient!==e.mieCoefficient&&(this.sky.mieCoefficient=this.data.mieCoefficient),this.data.mieDirectionalG!==e.mieDirectionalG&&(this.sky.mieDirectionalG=this.data.mieDirectionalG),this.data.inclination!==e.inclination&&(this.sky.inclination=this.data.inclination,this.el.object3D.matrixNeedsUpdate=!0),this.data.azimuth!==e.azimuth&&(this.sky.azimuth=this.data.azimuth,this.el.object3D.matrixNeedsUpdate=!0),this.data.distance!==e.distance){const e=this.data.distance;this.sky.distance=1===this.el.object3D.scale.x?e:1,this.sky.matrixNeedsUpdate=!0}"medium"===window.APP.store.state.preferences.materialQualitySetting&&(this.el.setObject3D("ambient-light",new cu(16777215,.3)),this.el.setObject3D("light-probe",this.sky.generateLightProbe(this.el.sceneEl.renderer)))},remove(){this.el.removeObject3D("mesh")}});const Mu={turbidity:10,rayleigh:2,luminance:1,mieCoefficient:.005,mieDirectionalG:.8,inclination:0,azimuth:.15,distance:8e3},Pu=(0,Ot.defineComponent)(),Cu=(0,Ot.defineQuery)([Un,Ln,(0,Ot.Not)(gn),Pu]),ku=(0,Ot.exitQuery)((0,Ot.defineQuery)([Ln,gn,zn])),Ou=1,Tu=2,Ru=4,Du=(0,Ot.enterQuery)((0,Ot.defineQuery)([Un,Ln])),ju=(0,Ot.defineQuery)([Un,Ln,gn]),Lu=(0,Ot.exitQuery)(ju),Iu=(0,Ot.enterQuery)(ju),Nu=(0,Ot.defineQuery)([Un,Hn]);let Fu;!function(e){e[e.APPLY_GRAVITY=1]="APPLY_GRAVITY"}(Fu||(Fu={}));const Bu=new Map,Vu=(0,Ot.enterQuery)((0,Ot.defineQuery)([_i,tn])),Uu=(0,Ot.exitQuery)((0,Ot.defineQuery)([_i]));const Hu=1,zu=2;var Wu=n(64866),qu=n.p+"assets/waternormals-537ec85b965d414829ab..jpg";class Zu{constructor(e,t,n,i){void 0===e&&(e=new wt.Vector2(1,1)),void 0===t&&(t=new wt.Vector2(1,1)),void 0===n&&(n=.0025),void 0===i&&(i=!0),this.speed=void 0,this.scale=void 0,this.height=void 0,this.alternate=void 0,this.speed=e,this.scale=t,this.height=n,this.alternate=i}}let Gu;class Yu extends wt.Mesh{constructor(e){let{resolution:t=24,lowQuality:n=!1}=e;Gu||(Gu=(new Ds).load(qu));const i=new wt.PlaneBufferGeometry(10,10,t,t);i.rotateX(-Math.PI/2);const r={ripplesSpeed:{value:.25},ripplesScale:{value:1},time:{value:0}},o=n?wt.MeshPhongMaterial:wt.MeshStandardMaterial;Gu.wrapS=Gu.wrapT=wt.RepeatWrapping;const s=new o({color:21727,normalMap:Gu,roughness:.5,metalness:.5});s.name="SimpleWaterMaterial",s.onBeforeCompile=e=>{Object.assign(e.uniforms,r),e.vertexShader=e.vertexShader.replace("#include <fog_pars_vertex>","\n          #include <fog_pars_vertex>\n          varying vec3 vWPosition;\n        "),e.vertexShader=e.vertexShader.replace("#include <fog_vertex>","\n          #include <fog_vertex>\n          vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;\n        "),e.fragmentShader=e.fragmentShader.replace("#include <normalmap_pars_fragment>","\n          #include <normalmap_pars_fragment>\n  \n          uniform float time;\n          uniform float ripplesSpeed;\n          uniform float ripplesScale;\n        \n          varying vec3 vWPosition;\n        \n          vec4 getNoise(vec2 uv){\n            float timeOffset = time * ripplesSpeed;\n            uv = (uv - 0.5) * (1.0 / ripplesScale);\n            vec2 uv0 = (uv/103.0)+vec2(timeOffset/17.0, timeOffset/29.0);\n            vec2 uv1 = uv/107.0-vec2(timeOffset/-19.0, timeOffset/31.0);\n            vec2 uv2 = uv/vec2(897.0, 983.0)+vec2(timeOffset/101.0, timeOffset/97.0);\n            vec2 uv3 = uv/vec2(991.0, 877.0)-vec2(timeOffset/109.0, timeOffset/-113.0);\n            vec4 noise = (texture2D(normalMap, uv0)) +\n                         (texture2D(normalMap, uv1)) +\n                         (texture2D(normalMap, uv2)) +\n                         (texture2D(normalMap, uv3));\n            return noise / 4.0;\n          }\n        "),e.fragmentShader=e.fragmentShader.replace("#include <normal_fragment_maps>","\n            // Workaround for Adreno 3XX dFd*( vec3 ) bug. See #9988\n  \n            vec3 eye_pos = -vViewPosition;\n            vec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n            vec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n            vec2 st0 = dFdx( vUv.st );\n            vec2 st1 = dFdy( vUv.st );\n  \n            float scale = sign( st1.t * st0.s - st0.t * st1.s ); // we do not care about the magnitude\n  \n            vec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );\n            vec3 T = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );\n            vec3 N = normalize( normal );\n            mat3 tsn = mat3( S, T, N );\n  \n            vec3 mapN = getNoise(vWPosition.xz).xyz * 2.0 - 1.0;\n  \n            mapN.xy *= normalScale;\n            mapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n  \n            normal = normalize( tsn * mapN );\n          ")},super(i,s),this.lowQuality=void 0,this.waterUniforms=void 0,this.resolution=void 0,this.octaves=void 0,this.simplex=void 0,this.waterMaterial=void 0,this.resolution=t,this.lowQuality=n,this.waterMaterial=s,this.waterUniforms=r,this.lowQuality?this.material instanceof wt.MeshPhongMaterial&&this.material.specular.set(16777215):this.receiveShadow=!0;const a=this.geometry.attributes.position;a instanceof wt.BufferAttribute&&a.setUsage(wt.DynamicDrawUsage),this.octaves=[new Zu(new wt.Vector2(.5,.5),new wt.Vector2(1,1),.01,!0),new Zu(new wt.Vector2(.05,6),new wt.Vector2(1,20),.1,!1)],this.simplex=new Wu.L}get opacity(){return this.waterMaterial.opacity}set opacity(e){this.waterMaterial.opacity=e,this.waterMaterial.transparent=1!==e}get color(){return this.waterMaterial.color}get tideHeight(){return this.octaves[0].height}get tideScale(){return this.octaves[0].scale}get tideSpeed(){return this.octaves[0].speed}set tideHeight(e){this.octaves[0].height=e}get waveHeight(){return this.octaves[1].height}set waveHeight(e){this.octaves[1].height=e}get waveScale(){return this.octaves[1].scale}get waveSpeed(){return this.octaves[1].speed}set ripplesSpeed(e){this.waterUniforms.ripplesSpeed.value=e}get ripplesSpeed(){return this.waterUniforms.ripplesSpeed.value}set ripplesScale(e){this.waterUniforms.ripplesScale.value=e}get ripplesScale(){return this.waterUniforms.ripplesScale.value}update(e){const t=this.geometry.attributes.position;for(let n=0;n<=this.resolution;n++)for(let i=0;i<=this.resolution;i++){let r=0;for(let t=0;t<this.octaves.length;t++){const o=this.octaves[t];if(o.alternate){const t=this.simplex.noise(n*o.scale.x/this.resolution,i*o.scale.y/this.resolution);r+=Math.cos(t+o.speed.length()*e)*o.height}else r+=(this.simplex.noise((n*o.scale.x+e*o.speed.x)/this.resolution,(i*o.scale.y+e*o.speed.y)/this.resolution)-.5)*o.height}t.setY(n*(this.resolution+1)+i,r)}this.geometry.computeVertexNormals(),t.needsUpdate=!0,this.waterUniforms.time.value=e}clone(e){return void 0===e&&(e=!0),new this.constructor(this.waterMaterial.normalMap,this.resolution,this.lowQuality).copy(this,e)}copy(e,t){return void 0===t&&(t=!0),super.copy(e,t),this.opacity=e.opacity,this.color.copy(e.color),this.tideHeight=e.tideHeight,this.tideScale.copy(e.tideScale),this.tideSpeed.copy(e.tideSpeed),this.waveHeight=e.waveHeight,this.waveScale.copy(e.waveScale),this.waveSpeed.copy(e.waveSpeed),this.ripplesSpeed=e.ripplesSpeed,this.ripplesScale=e.ripplesScale,this}}const Qu={opacity:1,color:"#0054df",tideHeight:.01,tideScale:{x:1,y:1},tideSpeed:{x:.5,y:.5},waveHeight:.1,waveScale:{x:1,y:20},waveSpeed:{x:.05,y:6},ripplesScale:1,ripplesSpeed:.25};var Xu=n(40580);const Ku=new wt.PlaneGeometry,$u=window.innerWidth*window.devicePixelRatio,Ju=window.innerHeight*window.devicePixelRatio,eh={color:"#7f7f7f"};var th=n.p+"assets/images/warning_icon-2d854aef091eedb0ab59..png",nh=n(60062);const ih=new URL(th,window.location.href).href,rh={src:th,startColor:"#ffffff",middleColor:"#ffffff",endColor:"#ffffff",startOpacity:1,middleOpacity:1,endOpacity:1,colorCurve:"linear",sizeCurve:"linear",startSize:.25,endSize:.25,sizeRandomness:0,ageRandomness:10,lifetime:5,lifetimeRandomness:5,particleCount:100,startVelocity:{x:0,y:0,z:.5},endVelocity:{x:0,y:0,z:0},velocityCurve:"linear",angularVelocity:0},oh={enabled:!0,inOut:!0,outIn:!0,debuggable:!0,dynamic:!1},sh=1,ah=2,lh=4,ch={minDelay:.01,maxDelay:.13,debug:!1},dh={minDelay:.01,maxDelay:.13,debug:!1};var uh=n(99477);const hh={position:{x:0,y:0,z:0},scale:{x:1,y:1,z:1},rotation:{x:0,y:0,z:0}},ph=["linear","inverse","exponential"];let mh,fh,gh,vh;!function(e){e[e.MEDIA_VIDEO=0]="MEDIA_VIDEO",e[e.AVATAR_AUDIO_SOURCE=1]="AVATAR_AUDIO_SOURCE",e[e.SFX=2]="SFX",e[e.AUDIO_TARGET=3]="AUDIO_TARGET",e[e.AUDIO_ZONE=4]="AUDIO_ZONE"}(mh||(mh={})),function(e){e.Stereo="stereo",e.PannerNode="pannernode"}(fh||(fh={})),function(e){e.Linear="linear",e.Inverse="inverse",e.Exponential="exponential"}(gh||(gh={})),function(e){e.HRTF="HRTF",e.EqualPower="equalpower"}(vh||(vh={}));const bh={audioType:fh.PannerNode,distanceModel:gh.Inverse,panningModel:vh.HRTF,rolloffFactor:5,refDistance:5,maxDistance:1e4,coneInnerAngle:180,coneOuterAngle:360,coneOuterGain:.9,gain:1},yh={audioType:fh.PannerNode,distanceModel:gh.Inverse,panningModel:vh.HRTF,rolloffFactor:5,refDistance:5,maxDistance:1e4,coneInnerAngle:360,coneOuterAngle:0,coneOuterGain:.9,gain:.5},wh={audioType:fh.PannerNode,distanceModel:gh.Inverse,panningModel:vh.HRTF,rolloffFactor:5,refDistance:8,maxDistance:1e4,coneInnerAngle:170,coneOuterAngle:300,coneOuterGain:.3,gain:1};function _h(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function Eh(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?_h(Object(n),!0).forEach((function(t){Ah(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):_h(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Ah(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Jd(new Promise((e=>{(0,Ga.C5)({characters:"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ-_<()>[]|0123456789"},e)})));const Sh=["position","rotation","scale","visible","name","layers"];class xh{constructor(e){this.current=void 0,this.current=e}}function Mh(e){return void 0===e&&(e=null),new xh(e)}function Ph(e,t){return null===t.current&&(t.current=(0,Ot.addEntity)(e)),t.current}function Ch(e){return Sh.includes(e)}function kh(e,t){t=t||{};for(var n=arguments.length,i=new Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];if("function"==typeof e)return e(t,i);if("entity"===e){const e={},n={};let r;for(const i in t)if(Ch(i))e[i]=t[i];else if("ref"===i)r=t[i];else{const e=i;n[e]=!0===t[e]?{}:t[e]}return{attrs:e,components:n,children:i.flat(),ref:r}}throw new Error(`invalid tag "${e}"`)}function Oh(e,t,n){if((0,Ot.hasComponent)(e,Ht,t))throw new Error("Tried to add an object3D tag to an entity that already has one");return(0,Ot.addComponent)(e,Ht,t),e.eid2obj.set(t,n),n.eid=t,t}const Th=function(e,t){return void 0===t&&(t={}),(n,i,r)=>{r=Object.assign({},t,r),(0,Ot.addComponent)(n,e,i,!0),Object.keys(r).forEach((t=>{const n=e[t];if(!n)return void console.error(`${t} is not a valid property of`,e);const o=r[t];if(n[Tt]){if(o&&"string"!=typeof o)throw new TypeError(`Expected ${t} to be a string, got an ${typeof o} (${o})`);n[i]=APP.getSid(o)}else n[i]=o}))}},Rh={grabbable:function(e,t,n){(n=Object.assign({},Md,n)).hand&&((0,Ot.addComponent)(e,En,t),(0,Ot.addComponent)(e,An,t)),n.cursor&&((0,Ot.addComponent)(e,Xt,t),(0,Ot.addComponent)(e,Kt,t),(0,Ot.addComponent)(e,_n,t)),(0,Ot.addComponent)(e,Jt,t)},billboard:Th(Ei),link:function(e,t,n){return(0,Ot.addComponent)(e,hi,t),(0,Ot.addComponent)(e,Kt,t),(0,Ot.addComponent)(e,Xt,t),hi.url[t]=APP.getSid(n.href),t},ambientLight:function(e,t,n){n=Object.assign({},iu,n);const i=new wt.AmbientLight;return i.color.set(n.color).convertSRGBToLinear(),i.intensity=n.intensity,Oh(e,t,i),(0,Ot.addComponent)(e,Wt,t),(0,Ot.addComponent)(e,qt,t),t},directionalLight:function(e,t,n){const i=new wt.DirectionalLight;return i.position.set(0,0,0),i.target.position.set(0,0,1),i.add(i.target),i.color.set(n.color).convertSRGBToLinear(),i.intensity=n.intensity,i.castShadow=n.castShadow,i.shadow.bias=n.shadowBias,i.shadow.radius=n.shadowRadius,i.shadow.mapSize.set(n.shadowMapResolution[0],n.shadowMapResolution[1]),Oh(e,t,i),(0,Ot.addComponent)(e,Wt,t),(0,Ot.addComponent)(e,Zt,t),t},hemisphereLight:function(e,t,n){const i=Object.assign({},ru,n),r=new wt.HemisphereLight;return r.position.set(0,0,0),r.color.set(i.skyColor).convertSRGBToLinear(),r.groundColor.set(i.groundColor).convertSRGBToLinear(),r.intensity=i.intensity,Oh(e,t,r),(0,Ot.addComponent)(e,Wt,t),(0,Ot.addComponent)(e,wt.HemisphereLight,t),t},pointLight:function(e,t,n){const i=Object.assign({},ou,n),r=new wt.PointLight;return r.color.set(i.color).convertSRGBToLinear(),r.intensity=i.intensity,r.distance=i.range,r.decay=i.decay,r.castShadow=i.castShadow,r.shadow.bias=i.shadowBias,r.shadow.mapSize.fromArray(i.shadowMapResolution),r.shadow.camera.matrixAutoUpdate=!0,Oh(e,t,r),(0,Ot.addComponent)(e,Wt,t),(0,Ot.addComponent)(e,Yt,t),t},spotLight:function(e,t,n){const i=Object.assign({},su,n),r=new wt.SpotLight;return r.position.set(0,0,0),r.target.position.set(0,0,1),r.add(r.target),r.color.set(i.color).convertSRGBToLinear(),r.intensity=i.intensity,r.distance=i.range,r.decay=i.decay,r.angle=i.outerConeAngle,r.penumbra=1-i.innerConeAngle/i.outerConeAngle,r.castShadow=i.castShadow,r.shadow.mapSize.set(i.shadowMapResolution[0],i.shadowMapResolution[1]),r.shadow.bias=i.shadowBias,r.shadow.radius=i.shadowRadius,Oh(e,t,r),(0,Ot.addComponent)(e,Wt,t),(0,Ot.addComponent)(e,Qt,t),t},mirror:function(e,t,n){n=Object.assign({},eh,n);const i=Ku,r=new Xu.r(i,{color:n.color,textureWidth:$u,textureHeight:Ju}),o=r.onBeforeRender;return r.onBeforeRender=function(e,t,n,i,s,a){const l=e.render;e.render=function(t,n){n.layers.enable(_o.CAMERA_LAYER_THIRD_PERSON_ONLY),n.layers.enable(_o.CAMERA_LAYER_VIDEO_TEXTURE_TARGET),r.onBeforeRender=o,l.call(e,t,n)},o(e,t,n,i,s,a),e.render=l},Oh(e,t,r),(0,Ot.addComponent)(e,Ci,t),t},audioZone:function(e,t,n){n=Object.assign({},oh,n),(0,Ot.addComponent)(e,Oi,t),n.enabled&&(Oi.flags[t]|=1),n.inOut&&(Oi.flags[t]|=2),n.outIn&&(Oi.flags[t]|=4),n.debuggable&&(Oi.flags[t]|=8),n.dynamic&&(Oi.flags[t]|=16)},audioParams:function(e,t,n){(0,Ot.addComponent)(e,Di,t),APP.audioOverrides.set(t,n)}},Dh=Eh(Eh({},Rh),{},{cursorRaycastable:Th(Xt),remoteHoverTarget:Th(Kt),isNotRemoteHoverTarget:Th($t),handCollisionTarget:Th(En),offersRemoteConstraint:Th(_n),offersHandConstraint:Th(An),singleActionButton:Th(Cn),holdableButton:Th(Pn),textButton:Th(Mn),hoverButton:Th(xn),holdable:Th(Jt),deletable:Th(ai),rigidbody:Sd,physicsShape:Za,floatyObject:Th(Un),networkedFloatyObject:Th(Hn),makeKinematicOnRelease:Th(zn),destroyAtExtremeDistance:Th(Bn),networkedTransform:Th(Vt),networked:Th(Rt),objectMenu:Th(ci),linkHoverMenu:Th(di),linkHoverMenuItem:Th(ui),pdfMenu:Th(pi),cameraTool:Th(Wn,{captureDurIdx:1}),animationMixer:Th(ti),networkedVideo:Th(ni),videoMenu:Th(ri),videoMenuItem:Th(ii),sceneRoot:Th(Yn),sceneLoader:Th(Xn),networkDebug:Th(fi),waypointPreview:Th(yi),pdf:function(e,t,n){return Oh(e,t,new wt.Mesh(Bo(1,1,1,1,n.material.map.flipY),n.material)),(0,Ot.addComponent)(e,Jn,t),zc.set(t,n),(0,Ot.addComponent)(e,Rt,t),(0,Ot.addComponent)(e,$n,t),$n.pageNumber[t]=1,t},mediaLoader:fd,mediaFrame:function(e,t,n){n=Object.assign({},xd,n);const i=new wt.Mesh(new wt.BoxBufferGeometry(n.bounds.x,n.bounds.y,n.bounds.z),new wt.ShaderMaterial({uniforms:{color:{value:new wt.Color(3113197)}},vertexShader:"\n            varying vec2 vUv;\n            void main()\n            {\n              gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n              vUv = uv;\n            }\n          ",fragmentShader:"\n            // adapted from https://www.shadertoy.com/view/Mlt3z8\n            float bayerDither2x2( vec2 v ) {\n              return mod( 3.0 * v.y + 2.0 * v.x, 4.0 );\n            }\n            float bayerDither4x4( vec2 v ) {\n              vec2 P1 = mod( v, 2.0 );\n              vec2 P2 = mod( floor( 0.5  * v ), 2.0 );\n              return 4.0 * bayerDither2x2( P1 ) + bayerDither2x2( P2 );\n            }\n\n            varying vec2 vUv;\n            uniform vec3 color;\n            void main() {\n              float alpha = max(step(0.45, abs(vUv.x - 0.5)), step(0.45, abs(vUv.y - 0.5))) - 0.5;\n              if( ( bayerDither4x4( floor( mod( gl_FragCoord.xy, 4.0 ) ) ) ) / 16.0 >= alpha ) discard;\n              gl_FragColor = vec4(color, 1.0);\n            }\n          ",side:wt.DoubleSide}));i.layers.set(_o.CAMERA_LAYER_UI),i.parent=new wt.Group,Oh(e,t,i),(0,Ot.addComponent)(e,It,t,!0),(0,Ot.addComponent)(e,Lt,t,!0),(0,Ot.hasComponent)(e,Rt,t)||(0,Ot.addComponent)(e,Rt,t),It.mediaType[t]={all:Ml.ALL,"all-2d":Ml.ALL_2D,model:Ml.MODEL,image:Ml.IMAGE,video:Ml.VIDEO,pdf:Ml.PDF}[n.mediaType],It.bounds[t].set([n.bounds.x,n.bounds.y,n.bounds.z]),Sd(e,t,{type:gd.KINEMATIC,collisionGroup:Ue.MEDIA_FRAMES,collisionMask:Ue.INTERACTABLES,disableCollision:!0}),Za(e,t,{type:Fa.BOX,fit:Ba.MANUAL,halfExtents:[n.bounds.x/2,n.bounds.y/2,n.bounds.z/2]})},object3D:Oh,slice9:function(e,t,n){let{size:i,insets:r,texture:o}=n;const s=new Od.PlaneBufferGeometry(1,1,3,3),a=new Od.MeshBasicMaterial({map:o,transparent:!0,toneMapped:!1});Oh(e,t,new Od.Mesh(s,a)),(0,Ot.addComponent)(e,Bt,t),Bt.insets[t].set(r),Bt.size[t].set(i),function(e,t){const n=e.eid2obj.get(t).geometry,i=n.attributes.position.array,r=n.attributes.uv.array,[o,s]=Bt.size[t],[a,l,c,d]=Bt.insets[t];function u(e,t,n){i[3*e]=t,i[3*e+1]=n}function h(e,t,n){r[2*e]=t,r[2*e+1]=n}const p={left:c/128,right:d/128,top:a/128,bottom:l/128};h(1,p.left,1),h(2,p.right,1),h(4,0,p.bottom),h(5,p.left,p.bottom),h(6,p.right,p.bottom),h(7,1,p.bottom),h(8,0,p.top),h(9,p.left,p.top),h(10,p.right,p.top),h(11,1,p.top),h(13,p.left,0),h(14,p.right,0);const m=o/2,f=s/2,g=.1-m,v=m-.1,b=f-.1,y=.1-f;u(0,-m,f),u(1,g,f),u(2,v,f),u(3,m,f),u(4,-m,b),u(5,g,b),u(6,v,b),u(7,m,b),u(8,-m,y),u(9,g,y),u(10,v,y),u(11,m,y),u(13,g,-f),u(14,v,-f),u(12,-m,-f),u(15,m,-f),n.attributes.position.needsUpdate=!0,n.attributes.uv.needsUpdate=!0}(e,t)},text:function(e,t,n){const i=Object.assign({},Rd,n),r=new Ga.xv;r.material.toneMapped=!1,r.text=i.value,r.material.side=Td[i.side],r.material.opacity=i.opacity,r.font=i.fontUrl,r.anchorX=i.anchorX,r.anchorY=i.anchorY,r.clipRect=i.clipRect,r.color=i.color,r.curveRadius=i.curveRadius,r.depthOffset=i.depthOffset,r.direction=i.direction,r.fillOpacity=i.fillOpacity,r.fontSize=i.fontSize,r.glyphGeometryDetail=i.glyphGeometryDetail,r.gpuAccelerateSDF=i.gpuAccelerateSDF,r.letterSpacing=i.letterSpacing,r.lineHeight=i.lineHeight,r.maxWidth=i.maxWidth,r.outlineBlur=i.outlineBlur,r.outlineColor=i.outlineColor,r.outlineOffsetX=i.outlineOffsetX,r.outlineOffsetY=i.outlineOffsetY,r.outlineOpacity=i.outlineOpacity,r.outlineWidth=i.outlineWidth,r.overflowWrap=i.overflowWrap,r.sdfGlyphSize=i.sdfGlyphSize,r.strokeColor=i.strokeColor,r.strokeOpacity=i.strokeOpacity,r.strokeWidth=i.strokeWidth,r.textAlign=i.textAlign,r.textIndent=i.textIndent,r.whiteSpace=i.whiteSpace,r.sync(),(0,Ot.addComponent)(e,Nt,t),Oh(e,t,r)},model:function(e,t,n){let{model:i}=n;const r=[],o=new Map;i.traverse((n=>{var s;const a=n.userData.gltfIndex;let l;l=n===i?t:void 0!==a&&o.has(a)?o.get(a):(0,Ot.addEntity)(e),void 0!==a&&o.set(a,l);const c=null===(s=n.userData.gltfExtensions)||void 0===s?void 0:s.MOZ_hubs_components;c&&Cd(e,l,c,o),go(n,(function(t){var n;const i=t.eid||(0,Ot.addEntity)(e);(0,Ot.hasComponent)(e,Ai,i)||function(e,t,n){if((0,Ot.hasComponent)(e,Ai,t))throw new Error("Tried to add an Material tag to an entity that already has one");(0,Ot.addComponent)(e,Ai,t),e.eid2mat.set(t,n),n.eid=t}(e,i,t);const r=null===(n=t.userData.gltfExtensions)||void 0===n?void 0:n.MOZ_hubs_components;r&&Cd(e,i,r,o)}));const d=e.eid2obj.get(l);if(d){if("Object3D"!==n.type)throw console.error(n,d),new Error("Failed to inflate model. Unexpected object type found before swap.");if(n===i)throw new Error("Failed to inflate model. Can't inflate alternative object type on root scene.");r.push([n,d])}else Oh(e,l,n)})),r.forEach((e=>{let[t,n]=e;for(let e=t.children.length-1;e>=0;e--)n.add(t.children[e]);n.position.copy(t.position),n.quaternion.copy(t.quaternion),n.scale.copy(t.scale),n.matrixNeedsUpdate=!0,n.uuid=t.uuid,t.parent.add(n),t.removeFromParent()})),i.traverse((e=>{var t;const n=(null===(t=e.userData.gltfExtensions)||void 0===t?void 0:t.MOZ_hubs_components)||{};if(n.visible){const{visible:t}=n.visible;e.visible=t}if(n.shadow){const{cast:t,receive:i}=n.shadow;e.traverse((e=>{e.castShadow=t,e.receiveShadow=i}))}if(n.frustrum&&(n.frustum=n.frustrum),n.frustum){const{culled:t}=n.frustum;e.traverse((e=>{e.frustumCulled=t}))}})),(0,Ot.addComponent)(e,zt,t)},image:function(e,t,n){let{texture:i,ratio:r,projection:o,alphaMode:s,cacheKey:a}=n;return Oh(e,t,o===Ya.SPHERE_EQUIRECTANGULAR?el(i):tl(i,r,s)),(0,Ot.addComponent)(e,Kn,t),Kn.cacheKey[t]=APP.getSid(a),t},video:function(e,t,n){let{texture:i,ratio:r,projection:o,autoPlay:s}=n;return Oh(e,t,o===Ya.SPHERE_EQUIRECTANGULAR?el(i):tl(i,r)),(0,Ot.addComponent)(e,ei,t),ei.autoPlay[t]=s?1:0,t}}),jh=Eh(Eh({},Rh),{},{pdf:function(e,t,n){fd(e,t,{src:n.src,recenter:!1,resize:!1,animateLoad:!1,isObjectMenuTarget:!1})},audio:kd,video:kd,image:function(e,t,n){fd(e,t,{src:n.src,recenter:!1,resize:!1,animateLoad:!1,isObjectMenuTarget:!1})},model:function(e,t,n){fd(e,t,{src:n.src,recenter:!0,resize:!1,animateLoad:!1,isObjectMenuTarget:!1})},reflectionProbe:function(e,t,n){const{envMapTexture:i,size:r}=Object.assign({},nu,n);i.flipY=!0,i.mapping=tu.EquirectangularReflectionMapping;const o=(new tu.Box3).setFromCenterAndSize(new tu.Vector3,(new tu.Vector3).setScalar(2*r));(0,Ot.addComponent)(e,Ft,t);const s=new tu.ReflectionProbe(o,i);if(Oh(e,t,s),AFRAME.scenes[0].systems["hubs-systems"].environmentSystem.debugMode){const e=(new tu.Box3).setFromCenterAndSize(new tu.Vector3,(new tu.Vector3).setScalar(2*r));s.add(new tu.Box3Helper(e,new tu.Color(Math.random(),Math.random(),Math.random())))}},navMesh:Th(Qn),waypoint:eu,environmentSettings:jd,fog:function(e,t,n){console.warn("The `fog` component is deprecated. Use the `fogX` properties on the `environment-settings` component instead."),jd(e,t,{fogType:n.type,fogColor:new Dd.Color(n.color),fogNear:n.near,fogFar:n.far,fogDensity:n.density})},background:function(e,t,n){console.warn("The `background` component is deprecated. Use the `backgroundColor` on the `environment-settings` component instead."),jd(e,t,{backgroundColor:new Dd.Color(n.backgroundColor)})},spawnPoint:function(e,t,n){return console.warn("The `spawn-point` component is deprecated. Use the `waypoint` component with `canBeSpawnPoint` instead."),eu(e,t,{canBeSpawnPoint:!0,canBeOccupied:!1,canBeClicked:!1,willDisableMotion:!1,willDisableTeleporting:!1,willMaintainInitialOrientation:!1,snapToNavMesh:!1})},skybox:function(e,t,n){console.warn("The `skybox` component is deprecated. Use the `envMapTexture` and `backgroundTexture` on `environment-settings` instead.");const i=new xu;Object.assign(i,Mu,n),Oh(e,t,i),(0,Ot.addComponent)(e,wi,t)},spawner:function(e,t,n){var i;fd(e,t,{src:n.src,recenter:!1,resize:!1,animateLoad:!1,isObjectMenuTarget:!1}),(0,Ot.addComponent)(e,En,t),(0,Ot.addComponent)(e,Xt,t),(0,Ot.addComponent)(e,Kt,t),(0,Ot.addComponent)(e,Cn,t),(0,Ot.addComponent)(e,_i,t),_i.src[t]=APP.getSid(n.src),_i.flags[t]=null!==(i=n.mediaOptions)&&void 0!==i&&i.applyGravity?Fu.APPLY_GRAVITY:0,Sd(e,t,{mass:0,collisionGroup:Ue.DEFAULT_SPAWNER,collisionMask:Ue.INTERACTABLES,disableCollision:!0})},videoTextureTarget:function(e,t,n){(0,Ot.addComponent)(e,Mi,t),Mi.source[t]=n.srcNode;let i=0;n.targetBaseColorMap&&(i|=Hu),n.targetEmissiveMap&&(i|=zu),Mi.flags[t]=i},videoTextureSource:Th(xi),uvScroll:function(e,t,n){var i,r;(0,Ot.addComponent)(e,Si,t),Si.speed[t].set([n.speed.x,n.speed.y]),Si.increment[t].set([(null===(i=n.increment)||void 0===i?void 0:i.x)||0,(null===(r=n.increment)||void 0===r?void 0:r.y)||0])},simpleWater:function(e,t,n){n=Object.assign({},Qu,n);const i="high"!==APP.store.state.preferences.materialQualitySetting,r=new Yu({lowQuality:i});r.opacity=n.opacity,r.color.set(n.color),r.tideHeight=n.tideHeight,r.tideScale.set(n.tideScale.x,n.tideScale.y),r.tideSpeed.set(n.tideSpeed.x,n.tideSpeed.y),r.waveHeight=n.waveHeight,r.waveScale.set(n.waveScale.x,n.waveScale.y),r.waveSpeed.set(n.waveSpeed.x,n.waveSpeed.y),r.ripplesScale=n.ripplesScale,r.ripplesSpeed=n.ripplesSpeed,Oh(e,t,r),(0,Ot.addComponent)(e,Pi,t)},particleEmitter:function(e,t,n){n=Object.assign({},rh,n);const i=new nh.Vo(null);return i.visible=!1,Oh(e,t,i),(0,Ot.addComponent)(e,ki,t),ki.src[t]=APP.getSid(n.src||ih),i.startColor.set(n.startColor),i.middleColor.set(n.middleColor),i.endColor.set(n.endColor),i.startOpacity=n.startOpacity,i.middleOpacity=n.middleOpacity,i.endOpacity=n.endOpacity,i.colorCurve=n.colorCurve,i.sizeCurve=n.sizeCurve,i.startSize=n.startSize,i.endSize=n.endSize,i.sizeRandomness=n.sizeRandomness,i.ageRandomness=n.ageRandomness,i.lifetime=n.lifetime,i.lifetimeRandomness=n.lifetimeRandomness,i.particleCount=n.particleCount,i.startVelocity.set(n.startVelocity.x,n.startVelocity.y,n.startVelocity.z),i.endVelocity.set(n.endVelocity.x,n.endVelocity.y,n.endVelocity.z),i.velocityCurve=n.velocityCurve,i.angularVelocity=n.angularVelocity,t},zoneAudioSource:function(e,t,n){n=Object.assign({},ch,n),(0,Ot.addComponent)(e,Ri,t);let i=0;n.onlyMods&&(i|=sh),n.muteSelf&&(i|=ah),n.debug&&(i|=lh),Ri.flags[t]=i},audioTarget:function(e,t,n){n=Object.assign({},dh,n),(0,Ot.addComponent)(e,Ti,t),Ti.maxDelay[t]=n.maxDelay,Ti.maxDelay[t]=n.maxDelay,Ti.source[t]=n.srcNode,n.debug&&(Ti.flags[t]|=1)},ammoShape:function(e,t,n){Za(e,t,{type:Object.values(Na.tl.SHAPE).indexOf(n.type),fit:Object.values(Na.tl.FIT).indexOf(n.fit),halfExtents:[n.halfExtents.x,n.halfExtents.y,n.halfExtents.z],minHalfExtent:n.minHalfExtent,maxHalfExtent:n.maxHalfExtent,sphereRadius:n.sphereRadius,offset:[n.offset.x,n.offset.y,n.offset.z],includeInvisible:n.includeInvisible})},boxCollider:function(e,t,n){n=Object.assign({},hh,n);const i=new wt.Euler;i.set(n.rotation.x,n.rotation.y,n.rotation.z);const r=(new uh.Quaternion).setFromEuler(i);Za(e,t,{type:Fa.BOX,fit:Ba.MANUAL,offset:[n.position.x,n.position.y,n.position.z],halfExtents:[n.scale.x/2,n.scale.y/2,n.scale.z/2],orientation:[r.x,r.y,r.z,r.w]})},trimesh:function(e,t){Za(e,t,{type:Fa.MESH,fit:Ba.ALL,includeInvisible:!0,margin:.01})},heightfield:function(e,t,n){Za(e,t,{type:Fa.HEIGHTFIELD,fit:Ba.MANUAL,margin:.01,offset:[n.offset.x,n.offset.y,n.offset.z],heightfieldDistance:n.distance,heightfieldData:n.data})},audioSettings:function(e,t,n){const i=Object.assign({},bh,{distanceModel:n.avatarDistanceModel,rolloffFactor:n.avatarRolloffFactor,refDistance:n.avatarRefDistance,maxDistance:n.avatarMaxDistance}),r=Object.assign({},yh,{distanceModel:n.mediaDistanceModel,rolloffFactor:n.mediaRolloffFactor,refDistance:n.mediaRefDistance,maxDistance:n.mediaMaxDistance,coneInnerAngle:n.mediaConeInnerAngle,coneOuterAngle:n.mediaConeOuterAngle,coneOuterGain:n.mediaConeOuterGain,gain:n.mediaVolume});APP.sceneAudioDefaults.set(mh.MEDIA_VIDEO,r),APP.sceneAudioDefaults.set(mh.AVATAR_AUDIO_SOURCE,i)}});function Lh(e,t){const n=t.ref?Ph(e,t.ref):(0,Ot.addEntity)(e);Object.keys(t.components).forEach((i=>{if(!function(e){return Object.prototype.hasOwnProperty.call(Dh,e)}(i))throw new Error(`Failed to inflate unknown component called ${i}`);const r=t.components[i];for(const t in r){const n=r[t];n instanceof xh&&(r[t]=Ph(e,n))}Dh[i](e,n,t.components[i])}));let i=e.eid2obj.get(n);return i||(i=new wt.Group,Oh(e,n,i)),t.attrs.position&&i.position.fromArray(t.attrs.position),t.attrs.rotation&&i.rotation.fromArray(t.attrs.rotation),t.attrs.scale&&i.scale.fromArray(t.attrs.scale),t.attrs.name&&(i.name=t.attrs.name),void 0!==t.attrs.layers&&(i.layers.mask=t.attrs.layers),void 0!==t.attrs.visible&&(i.visible=t.attrs.visible),t.children.forEach((t=>{const n=Lh(e,t);i.add(e.eid2obj.get(n))})),n}var Ih=n.p+"assets/hud/button.9-fb5457e28aa46b0b041d..png";const Nh=["text","width","height","texture","name","type"];function Fh(){return Fh=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},Fh.apply(this,arguments)}const Bh=zl.load(Ih);let Vh;function Uh(e){let{text:t,width:n,height:i,texture:r=Bh,name:o="Button",type:s}=e,a=function(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}(e,Nh);const l=Mh();return kh("entity",Fh({name:o,slice9:{size:[n,i],insets:[64,66,64,66],texture:r},cursorRaycastable:!0,remoteHoverTarget:!0,hoverButton:{type:s},textButton:{labelRef:l},singleActionButton:!0,layers:1<<_o.CAMERA_LAYER_UI},a),kh("entity",{ref:l,layers:1<<_o.CAMERA_LAYER_UI,text:{value:t,color:"#000000",textAlign:"center",anchorX:"center",anchorY:"middle"},position:[0,0,.01],name:`${o} Label`}))}!function(e){e[e.DEFAULT=0]="DEFAULT",e[e.ACTION=1]="ACTION"}(Vh||(Vh={}));var Hh=n(99477);const zh=["text"];function Wh(){return Wh=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},Wh.apply(this,arguments)}function qh(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function Zh(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?qh(Object(n),!0).forEach((function(t){Gh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):qh(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Gh(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Yh(e){let{text:t={}}=e,n=function(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}(e,zh);for(var i=arguments.length,r=new Array(i>1?i-1:0),o=1;o<i;o++)r[o-1]=arguments[o];return kh("entity",Wh({name:"Label",text:Zh({value:r.join("\n")},t),layers:1<<_o.CAMERA_LAYER_UI},n))}Jd(ja(ws,null,!0));const Qh=new Map;function Xh(e,t){if("reticulum"===e)return!0;const n=Qh.get(t).permission;return!n||APP.hubChannel.userCan(e,n)}function Kh(e,t,n){if(!Xh(NAF.clientId,t))throw new Error(`You do not have permission to spawn ${t}`);const i=$h(e,t,n,NAF.utils.createNetworkId(),NAF.clientId);return Id(e,i),i}function $h(e,t,n,i,r){const o=Lh(e,Qh.get(t).template(n));if(!(0,Ot.hasComponent)(e,Rt,o))throw new Error("Networked prefabs must have the Networked component");const s=e.eid2obj.get(o);return wr.set(o,{prefabName:t,initialData:n}),function(e,t,n,i){let r=0;e.eid2obj.get(n).traverse((function(n){n.eid&&(0,Ot.hasComponent)(e,Rt,n.eid)&&(Nc(n.eid,0===r?t:`${t}.${r}`,0===r?i:t),r+=1)}))}(e,i,o,r),AFRAME.scenes[0].object3D.add(s),o}function Jh(e,t){return!!Rt.owner[e]&&!(Rt.lastOwnerTime[e]<t.lastOwnerTime)&&(Rt.lastOwnerTime[e]>t.lastOwnerTime||t.owner!==(n=APP.getString(Rt.owner[e]),i=t.owner,"reticulum"===n?i:"reticulum"===i||n<i?n:i));var n,i}Qh.set("camera",{permission:"spawn_camera",template:function(){const e=Mh(),t=Mh(),n=Mh(),i=Mh(),r=Mh(),o=Mh(),s=Mh(),a=Mh(),l=Mh(),c=Mh(),d=Mh(),u=Mh(),h=new Hh.MeshBasicMaterial({toneMapped:!1}),p=new Hh.PlaneBufferGeometry(.28,.28/(1280/720)),m=new Hh.PerspectiveCamera(50,1280/720,.1,3e4);m.layers.enable(_o.CAMERA_LAYER_VIDEO_TEXTURE_TARGET),m.layers.enable(_o.CAMERA_LAYER_THIRD_PERSON_ONLY);const f=.2,g=[.4,.4,.4],v=[.2,.2,.2],b=.1;return kh("entity",{name:"Camera Tool",networked:!0,networkedTransform:!0,cursorRaycastable:!0,remoteHoverTarget:!0,handCollisionTarget:!0,offersRemoteConstraint:!0,offersHandConstraint:!0,makeKinematicOnRelease:!0,holdable:!0,floatyObject:!0,rigidbody:{collisionGroup:Ue.INTERACTABLES,collisionMask:Ue.HANDS},physicsShape:{halfExtents:[.22,.14,.1]},cameraTool:{snapMenuRef:e,nextButtonRef:t,prevButtonRef:n,snapRef:i,cancelRef:r,recVideoRef:o,screenRef:s,selfieScreenRef:a,cameraRef:l,countdownLblRef:c,captureDurLblRef:d,sndToggleRef:u}},kh("entity",{name:"Screen",object3D:new Hh.Mesh(p,h),ref:s,position:[0,0,-.042],rotation:[0,Math.PI,0]}),kh("entity",{name:"Selfie Screen",ref:a,object3D:new Hh.Mesh(p,h),position:[0,.4,0],scale:[-2,2,2]}),kh("entity",{name:"Camera Model",model:{model:Da(ws).scene},scale:[2,2,2]}),kh("entity",{ref:l,object3D:m,position:[0,0,.05],rotation:[0,Math.PI,0]}),kh("entity",{name:"Snap Menu",ref:e},kh(Yh,{ref:c,position:[0,0,b+.002]}),kh(Yh,{ref:d,position:[0,0,b+.002]}),kh(Uh,{ref:r,scale:g,position:[0,.1,b],width:.4,height:f,text:"Cancel"}),kh(Uh,{ref:i,scale:g,position:[0,.1,b],width:.4,height:f,type:Vh.ACTION,text:"Photo"}),kh(Uh,{ref:n,scale:v,position:[-.082,0,b],width:f,height:f,text:"<"}),kh(Uh,{ref:o,scale:g,position:[0,-.1,b],width:.4,height:f,type:Vh.ACTION,text:"Video"}),kh(Uh,{ref:t,scale:v,position:[.082,0,b],width:f,height:f,text:">"}),kh(Uh,{ref:u,scale:v,position:[0,-.17,b],width:.6,height:f,text:"Sound OFF"})))}}),Qh.set("cube",{template:function(){return kh("entity",{name:"Media Frame",networked:!0,networkedTransform:!0,cursorRaycastable:!0,remoteHoverTarget:!0,handCollisionTarget:!0,offersRemoteConstraint:!0,offersHandConstraint:!0,floatyObject:!0,destroyAtExtremeDistance:!0,holdable:!0,rigidbody:{gravity:-9.8,collisionGroup:Ue.INTERACTABLES,collisionMask:Ue.HANDS|Ue.ENVIRONMENT|Ue.INTERACTABLES|Ue.AVATAR},physicsShape:{fit:Ba.MANUAL,type:Fa.BOX,halfExtents:[.5,.5,.5]},object3D:new Hh.Mesh(new Hh.BoxBufferGeometry,new Hh.MeshStandardMaterial)},kh("entity",{mediaFrame:!0,position:[0,1,0]}))}}),Qh.set("media",{template:function(e){return kh("entity",{name:"Interactable Media",networked:!0,networkedTransform:!0,mediaLoader:e,deletable:!0,grabbable:{cursor:!0,hand:!0},destroyAtExtremeDistance:!0,floatyObject:{flags:Ou,releaseGravity:0},networkedFloatyObject:{flags:Ou},rigidbody:{type:gd.KINEMATIC,collisionGroup:Ue.INTERACTABLES,collisionMask:Ue.HANDS},scale:[1,1,1]})}});const ep=new Map,tp=(0,Ot.enterQuery)((0,Ot.defineQuery)([Rt]));function np(e,t,n,i,r,o,s){try{var a=e[o](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(i,r)}function ip(e){return rp.apply(this,arguments)}function rp(){var e;return e=function*(e,t,n){if(void 0===t&&(t=!0),void 0===n&&(n=null),e===APP.hub.hub_id)return void console.log("Change hub called with the current hub id. This is a noop.");APP.hideHubPresenceEvents=!0;const i=AFRAME.scenes[0];let r;Object.keys(APP.hubChannel.presence.state).forEach((e=>{const t=APP.getSid(e);t!==yr&&Pr.push(t)})),Pr.push(APP.getSid("reticulum"));try{r=yield APP.hubChannel.migrateToHub(e)}catch(t){return console.warn(`Failed to join hub ${e}: ${t.reason}|${t.message}`),void APP.messageDispatch.log("joinFailed",{message:t.message})}const o=r.hubs[0];if(t){const t=new URLSearchParams(location.search),i={};for(const[e,n]of t.entries())"hub_id"!==e&&(i[e]=n);window.history.pushState(null,null,ue(e,i,o.slug,n))}APP.hub=o,H8(o,APP.hubChannel),i.emit("hub_updated",{hub:o}),APP.subscriptions.setSubscribed(r.subscriptions.web_push),N8({hubIsBound:r.hub_requires_oauth,initialIsFavorited:r.subscriptions.favorites}),NAF.entities.removeRemoteEntities(),yield NAF.connection.adapter.disconnect(),yield APP.dialog.disconnect(),(0,z.Z)("newLoader")||(document.querySelectorAll("[pinnable]").forEach((e=>{e.components.pinnable.data.pinned&&e.parentNode.removeChild(e)})),document.querySelectorAll("#objects-scene .Room_Objects").forEach((e=>{e.children.length||e.parentNode.parentNode.removeChild(e.parentNode)}))),NAF.connection.connectedClients={},NAF.connection.activeDataChannels={},(Sr.length||ep.size)&&(console.log(`Deleting ${Sr.length+ep.size} unapplied network messages from previous hub.`),Sr.length=0,ep.clear()),NAF.room=o.hub_id,((0,z.Z)("newLoader")||document.querySelector("#environment-scene").childNodes[0].components["gltf-model-plus"].data.src!==(yield F8(o)))&&document.getElementById("viewing-camera").components.fader.fadeOut().then((()=>{i.emit("reset_scene"),V8(o,APP.entryManager)})),APP.retChannel.push("change_hub",{hub_id:o.hub_id}),yield Promise.all([APP.dialog.connect({serverUrl:`wss://${o.host}:${o.port}`,roomId:o.hub_id,serverParams:{host:o.host,port:o.port,turn:o.turn},scene:i,clientId:APP.dialog._clientId,forceTcp:APP.dialog._forceTcp,forceTurn:APP.dialog._forceTurn,iceTransportPolicy:APP.dialog._iceTransportPolicy}),NAF.connection.adapter.connect()]),(0,z.Z)("newLoader")?(us(APP.hubChannel),co(e)):function(e){const t=document.querySelector("#objects-scene"),n=ge(`/${e}/objects.gltf`),i=document.createElement("a-entity");i.setAttribute("gltf-model-plus",{src:n,useCache:!1,inflate:!0}),t.appendChild(i)}(e),APP.hubChannel.sendEnteredEvent(),APP.messageDispatch.receive({type:"hub_changed",hubName:o.name,showLineBreak:!0})},rp=function(){var t=this,n=arguments;return new Promise((function(i,r){var o=e.apply(t,n);function s(e){np(o,i,r,s,a,"next",e)}function a(e){np(o,i,r,s,a,"throw",e)}s(void 0)}))},rp.apply(this,arguments)}window.changeHub=ip,window.addEventListener("popstate",(function(){const e=new URLSearchParams(location.search).get("hub_id")||document.location.pathname.substring(1).split("/")[0];e!==APP.hub.hub_id&&ip(e,!1)})),n(24649),n(798);var op=n(99477);const sp=[];class ap{tick(e){for(let t=0;t<sp.length;t++){const n=sp[t];n.mixer&&n.mixer.update(e/1e3)}}}function lp(e,t){for(;e&&(!e.components||!e.components[t]);)e=e.parentNode;return e}function cp(e,t){window.APP.componentRegistry=window.APP.componentRegistry||{},window.APP.componentRegistry[t]=window.APP.componentRegistry[t]||[],window.APP.componentRegistry[t].push(e)}function dp(e,t){window.APP.componentRegistry&&window.APP.componentRegistry[t]&&window.APP.componentRegistry[t].splice(window.APP.componentRegistry[t].indexOf(e),1)}function up(){if(!(window.APP&&window.APP.componentRegistry&&window.APP.hubChannel&&window.APP.hubChannel.presence))return null;const e=window.APP.componentRegistry["player-info"]||[],t=window.APP.hubChannel.presence.state;for(let n=0;n<e.length;n++){const i=e[n],r=t[i.playerSessionId];if(r&&r.metas[0]&&r.metas[0].streaming)return i}return null}AFRAME.registerComponent("animation-mixer",{initMixer(e){this.mixer=new op.AnimationMixer(this.el.object3D),this.el.object3D.animations=e,this.animations=e},play(){sp.push(this)},pause(){sp.splice(sp.indexOf(this),1)}});var hp=n(99477);function pp(e,t,n,i,r,o,s){try{var a=e[o](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(i,r)}function mp(e){return function(){var t=this,n=arguments;return new Promise((function(i,r){var o=e.apply(t,n);function s(e){pp(o,i,r,s,a,"next",e)}function a(e){pp(o,i,r,s,a,"throw",e)}s(void 0)}))}}function fp(e){const t=((e,t)=>{e.getByteTimeDomainData(t);let n=0;for(let e=0;e<t.length;e++){const i=(t[e]-128)/128;n+=i*i}return Math.sqrt(n/t.length)})(e.analyser,e.levels),n=Math.log(hp.MathUtils.mapLinear(t,0,1,1,Math.E));e.volume=n<.08?0:n;const i=e.volume>e.prevVolume?.35:.3;e.volume=i*e.volume+(1-i)*e.prevVolume,e.prevVolume=e.volume}function gp(e){const t=lp(e,"ik-root");if(t&&"avatar-rig"===t.id)return e.sceneEl.systems["local-audio-analyser"];{const t=lp(e,"networked-audio-analyser");return t?t.components["networked-audio-analyser"]:null}}AFRAME.registerComponent("networked-audio-analyser",{init(){var e=this;return mp((function*(){e.volume=0,e.prevVolume=0,e.disableUpdates=!0,e.avatarIsTalking=!1,e._updateAnalysis=e._updateAnalysis.bind(e),e._runScheduledWork=e._runScheduledWork.bind(e),e.el.sceneEl.systems["frame-scheduler"].schedule(e._runScheduledWork,"audio-analyser"),e.el.addEventListener("sound-source-set",(t=>{const n=hp.AudioContext.getContext();e.analyser=n.createAnalyser(),e.analyser.fftSize=32,e.levels=new Uint8Array(e.analyser.fftSize),t.detail.soundSource.connect(e.analyser)}),{once:!0}),e.playerSessionId=lp(e.el,"player-info").components["player-info"].playerSessionId,cp(e,"networked-audio-analyser")}))()},remove:function(){dp(this,"networked-audio-analyser"),this.el.sceneEl.systems["frame-scheduler"].unschedule(this._runScheduledWork,"audio-analyser")},tick:function(e){this.disableUpdates||this._updateAnalysis(e)},_runScheduledWork:function(){this.disableUpdates&&this._updateAnalysis()},_updateAnalysis:function(e){this.analyser&&(fp(this),this.volume<1e-5?(e&&this.lastSeenVolume&&this.lastSeenVolume<e-1e4&&(this.disableUpdates=!0),e&&this.lastSeenVolume&&this.lastSeenVolume<e-1e3&&(this.avatarIsTalking=!1)):(e&&(this.lastSeenVolume=e),this.disableUpdates=!1,this.avatarIsTalking=!0))}}),AFRAME.registerSystem("local-audio-analyser",{init(){this.volume=0,this.prevVolume=0,this.onMicEnabled=this.onMicEnabled.bind(this),this.el.addEventListener(Ne.MIC_SHARE_STARTED,this.onMicEnabled)},remove(){this.el.removeEventListener(Ne.MIC_SHARE_STARTED,this.onMicEnabled)},onMicEnabled(){const e=this.el.sceneEl.systems["hubs-systems"].audioSystem;this.analyser=e.outboundAnalyser,this.levels=e.analyserLevels},tick:function(){this.analyser&&(APP.dialog.isMicEnabled?fp(this):(this.prevVolume=this.volume,this.volume=0))}}),AFRAME.registerComponent("scale-audio-feedback",{schema:{minScale:{default:1},maxScale:{default:1.5}},init(){var e=this;return mp((function*(){yield L(),e.cameraEl=document.getElementById("viewing-camera")}))()},tick(){var e;this.cameraEl&&(this.analyser||(this.analyser=gp(this.el)),this.el.object3D.scale.setScalar(hp.MathUtils.mapLinear((null===(e=this.analyser)||void 0===e?void 0:e.volume)||0,0,1,this.data.minScale,this.data.maxScale)),this.el.object3D.matrixNeedsUpdate=!0)}}),AFRAME.registerComponent("morph-audio-feedback",{schema:{name:{default:""},minValue:{default:0},maxValue:{default:2}},init(){const e=[];this.el.object3DMap.skinnedmesh?e.push(this.el.object3DMap.skinnedmesh):this.el.object3DMap.group&&this.el.object3DMap.group.traverse((t=>t.isSkinnedMesh&&e.push(t))),e.length&&(this.morphs=e.map((e=>({mesh:e,morphNumber:e.morphTargetDictionary[this.data.name]}))).filter((e=>void 0!==e.morphNumber)))},tick(){if(!this.morphs||!this.morphs.length)return;this.analyser||(this.analyser=gp(this.el));const{minValue:e,maxValue:t}=this.data,n=hp.MathUtils.mapLinear(Fc(this.analyser?this.analyser.volume:0),0,1,e,t);for(let e=0;e<this.morphs.length;e++)this.morphs[e].mesh.morphTargetInfluences[this.morphs[e].morphNumber]=n}});const vp={MIC:["mic-0.png","mic-1.png","mic-2.png","mic-3.png","mic-4.png","mic-5.png","mic-6.png","mic-7.png"],MIC_HOVER:["mic-0_hover.png","mic-1_hover.png","mic-2_hover.png","mic-3_hover.png","mic-4_hover.png","mic-5_hover.png","mic-6_hover.png","mic-7_hover.png"],MIC_OFF:["mic-off-0.png","mic-off-1.png","mic-off-2.png","mic-off-3.png","mic-off-4.png","mic-off-5.png","mic-off-6.png","mic-off-7.png"],MIC_OFF_HOVER:["mic-off-0_hover.png","mic-off-1_hover.png","mic-off-2_hover.png","mic-off-3_hover.png","mic-off-4_hover.png","mic-off-5_hover.png","mic-off-6_hover.png","mic-off-7_hover.png"]};AFRAME.registerComponent("mic-button",{schema:{active:{type:"boolean"},tooltip:{type:"selector"},tooltipText:{type:"string"},activeTooltipText:{type:"string"}},init(){this.prevSpriteName="",this.el.object3D.matrixNeedsUpdate=!0,this.hovering=!1,this.onHover=()=>{this.hovering=!0,this.data.tooltip.setAttribute("visible",!0)},this.onHoverOut=()=>{this.hovering=!1,this.data.tooltip.setAttribute("visible",!1)}},play(){this.el.object3D.addEventListener("hovered",this.onHover),this.el.object3D.addEventListener("unhovered",this.onHoverOut)},pause(){this.el.object3D.removeEventListener("hovered",this.onHover),this.el.object3D.removeEventListener("unhovered",this.onHoverOut)},update(){this.data.tooltip&&(this.textEl=this.data.tooltip.querySelector("[text]"))},tick(){const e=this.el.sceneEl.systems["local-audio-analyser"],t=this.data.active,n=this.hovering;var i;const r=vp[t?n?"MIC_HOVER":"MIC":n?"MIC_OFF_HOVER":"MIC_OFF"][(i=e.volume,hp.MathUtils.clamp(Math.ceil(hp.MathUtils.mapLinear(i-.05,0,1,0,7)),0,7))];r!==this.prevSpriteName&&(this.prevSpriteName=r,this.el.setAttribute("sprite","name",r)),this.data.tooltip&&n&&(this.textEl=this.textEl||this.data.tooltip.querySelector("[text]"),this.textEl.setAttribute("text","value",t?this.data.activeTooltipText:this.data.tooltipText))}});var bp=n.p+"assets/hud/action_button.9-f0aef3dace9ffbe1320d..png",yp=n.p+"assets/hud/nametag.9-1089683afbd6258f15df..png",wp=n.p+"assets/hud/nametag-border.9-11ab40141a95edd37651..png",_p=n(99477);const Ep={"action-button":{tex:zl.load(bp),width:128,height:128},button:{tex:zl.load(Ih),width:128,height:128},nametag:{tex:zl.load(yp),width:128,height:128},"nametag-border":{tex:zl.load(wp),width:128,height:128}};AFRAME.registerComponent("slice9",{schema:{alphaTest:{default:0},bottom:{default:0,min:0},color:{type:"color",default:"#fff"},debug:{default:!1},height:{default:1,min:0},left:{default:0,min:0},opacity:{default:1,min:0,max:1},padding:{default:.1,min:.01},right:{default:0,min:0},side:{default:"front",oneOf:["front","back","double"]},src:{oneOf:Object.keys(Ep)},top:{default:0,min:0},transparent:{default:!0},width:{default:1,min:0},usingCustomMaterial:{default:!1},usingAtlas:{default:!1},uvAtlasMin:{type:"vec2"},uvAtlasMax:{type:"vec2"}},init:function(){const e=this.data;this.textureSrc=null;const t=this.geometry=new _p.PlaneBufferGeometry(e.width,e.height,3,3);if(e.usingCustomMaterial)this.plane=new _p.Mesh(t);else{const n=new _p.MeshBasicMaterial({alphaTest:e.alphaTest,color:e.color,opacity:e.opacity,transparent:e.transparent,wireframe:e.debug});this.plane=new _p.Mesh(t,n)}this.el.setObject3D("mesh",this.plane)},regenerateMesh:function(){const e=this.data;let t;const n=this.geometry.attributes.position.array,i=this.geometry.attributes.uv.array;let r;if(this.plane.material&&!this.plane.material.map)return;function o(e,t,i){n[3*e]=t,n[3*e+1]=i}function s(t,n,r){e.usingAtlas&&(n=e.uvAtlasMin.x+n*(e.uvAtlasMax.x-e.uvAtlasMin.x),r=e.uvAtlasMin.y+r*(e.uvAtlasMax.y-e.uvAtlasMin.y)),i[2*t]=n,i[2*t+1]=r}e.usingCustomMaterial?(t=1,r=1):(t=Ep[e.src].height,r=Ep[e.src].width);const a={left:e.left/r,right:e.right/r,top:e.top/t,bottom:e.bottom/t};s(1,a.left,1),s(2,a.right,1),s(4,0,a.bottom),s(5,a.left,a.bottom),s(6,a.right,a.bottom),s(7,1,a.bottom),s(8,0,a.top),s(9,a.left,a.top),s(10,a.right,a.top),s(11,1,a.top),s(13,a.left,0),s(14,a.right,0),e.usingAtlas&&(s(0,0,1),s(3,1,1),s(12,0,0),s(15,1,0));const l=e.width/2,c=e.height/2,d=-l+e.padding,u=l-e.padding,h=c-e.padding,p=-c+e.padding;o(0,-l,c),o(1,d,c),o(2,u,c),o(3,l,c),o(4,-l,h),o(5,d,h),o(6,u,h),o(7,l,h),o(8,-l,p),o(9,d,p),o(10,u,p),o(11,l,p),o(13,d,-c),o(14,u,-c),o(12,-l,-c),o(15,l,-c),this.geometry.attributes.position.needsUpdate=!0,this.geometry.attributes.uv.needsUpdate=!0},update:function(e){const t=this.data,n=AFRAME.utils.diff(t,e);t.usingCustomMaterial||(this.plane.material.alphaTest=t.alphaTest,this.plane.material.color.setStyle(t.color),this.plane.material.opacity=t.opacity,this.plane.material.transparent=t.transparent,this.plane.material.wireframe=t.debug,this.plane.material.side=function(e){switch(e){case"back":return _p.BackSide;case"double":return _p.DoubleSide;default:return _p.FrontSide}}(t.side),this.plane.material.needsUpdate=!0,"src"in n&&this.updateMap()),("width"in n||"height"in n||"padding"in n||"left"in n||"top"in n||"bottom"in n||"right"in n)&&this.regenerateMesh()},setMap(e){this.plane.material.map=e,this.plane.material.needsUpdate=!0,this.regenerateMesh()},updateMap:function(){const e=this.data.src;if(e){if(e===this.textureSrc)return;return this.textureSrc=e,void this.setMap(Ep[e].tex)}this.plane.material.map&&this.setMap(null)},remove(){var e;null===(e=this.geometry)||void 0===e||e.dispose()}}),n(90903),n(19304),n(71087),n(92179),n(57886),n(89684),AFRAME.registerComponent("layers",{schema:{mask:{default:_o.CAMERA_LAYER_DEFAULT},recursive:{default:!1}},init(){this.update=this.update.bind(this),this.el.addEventListener("object3dset",this.update)},update(){const e=this.el.object3D;this.data.recursive?e.traverse((e=>e.layers.mask=this.data.mask)):e.layers.mask=this.data.mask},remove(){this.el.removeEventListener("object3dset",this.update)}});var Ap=n(99477);AFRAME.registerComponent("loop-animation",{schema:{paused:{type:"boolean",default:!1},clip:{type:"string",default:""},activeClipIndex:{type:"int",default:0},startOffset:{type:"number",default:0},timeScale:{type:"number",default:1},activeClipIndices:{type:"array"}},init(){this.mixerEl=lp(this.el,"animation-mixer"),this.currentActions=[],this.mixerEl||console.warn("loop-animation component could not find an animation-mixer in its ancestors.")},update(e){if(this.mixerEl&&(e.clip===this.data.clip&&e.activeClipIndex===this.data.activeClipIndex||this.updateClip(),e.paused!==this.data.paused))for(let e=0;e<this.currentActions.length;e++)this.currentActions[e].paused=this.data.paused},updateClip(){const{mixer:e,animations:t}=this.mixerEl.components["animation-mixer"],{clip:n,activeClipIndex:i}=this.data,{activeClipIndices:r}=this.data;if(0===t.length)return;let o=[];if(r&&r.length>0)o=r.map((e=>t[e]));else if(""!==n){const e=n.split(",");for(let n=0;n<e.length;n++){const i=e[n],r=t.find((e=>{let{name:t}=e;return t===i}));r?o.push(r):console.warn(`Could not find animation named '${i}' in ${this.el.className}`)}}else o=[t[i]];if(o&&o.length){this.currentActions.length=0;for(let t=0;t<o.length;t++){const n=e.clipAction(o[t],this.el.object3D);n.enabled=!0,n.time=this.data.startOffset,n.timeScale=this.data.timeScale,n.setLoop(Ap.LoopRepeat,1/0).play(),this.currentActions.push(n)}}},destroy(){for(let e=0;e<this.currentActions.length;e++)this.currentActions[e].enabled=!1,this.currentActions[e].stop();this.currentActions.length=0}});var Sp=n(99477);const xp=new Map,Mp=[];class Pp{tick(e){for(let t=0;t<Mp.length;t++){const n=Mp[t],{offset:i,instances:r}=xp.get(n),{component:o}=r[0];i.addScaledVector(o.data.speed,e/1e3),i.x=i.x%1,i.y=i.y%1;const s=o.data.increment;n.offset.x=s.x?i.x-i.x%s.x:i.x,n.offset.y=s.y?i.y-i.y%s.y:i.y}}}AFRAME.registerComponent("uv-scroll",{schema:{speed:{type:"vec2",default:{x:0,y:0}},increment:{type:"vec2",default:{x:0,y:0}}},play(){const e=this.el.getObject3D("mesh")||this.el.getObject3D("skinnedmesh"),t=e&&e.material;if(t){const n={component:this,mesh:e};this.instance=n,this.map=t.map||t.emissiveMap,this.map&&!xp.has(this.map)?(xp.set(this.map,{offset:new Sp.Vector2,instances:[n]}),Mp.push(this.map)):this.map?(console.warn("Multiple uv-scroll instances added to objects sharing a texture, only the speed/increment from the first one will have any effect"),xp.get(this.map).instances.push(n)):console.warn("Ignoring uv-scroll added to mesh with no scrollable texture.")}},pause(){if(this.map){const e=xp.get(this.map).instances;e.splice(e.indexOf(this.instance),1),e.length||(xp.delete(this.map),Mp.splice(Mp.indexOf(this.map),1))}}});var Cp=n(99477);function kp(e,t){let n=e;for(;n;){if(n===t)return!0;if(!n.visible)return!1;n=n.parent}return console.error(`Root ${t} is not an ancestor of node ${e}`),!1}const Op=new Cp.Box3(new Cp.Vector3(-.001,-.001,-.001),new Cp.Vector3(.001,.001,.001)),Tp=function(){const e=new Cp.Vector3,t=new Cp.Matrix4,n=new Cp.Matrix4;return function(i,r,o){r.makeEmpty(),i.updateMatrices(),t.copy(i.matrixWorld).invert(),i.traverse((s=>{if((!o||kp(s,i))&&(s.updateMatrices(),n.multiplyMatrices(t,s.matrixWorld),s.geometry))if(s.isTroikaText)r.union(Op);else if(s.geometry.isGeometry)for(let t=0;t<s.geometry.vertices;t++)e.copy(s.geometry.vertices[t]).applyMatrix4(n),isNaN(e.x)||r.expandByPoint(e);else if(s.geometry.isBufferGeometry&&s.geometry.attributes.position){const t=s.geometry.attributes.position.array,i=s.geometry.attributes.position.itemSize;for(let o=0;o<s.geometry.attributes.position.count;o++){if(2===i)e.set(t[2*o],t[2*o+1],0);else{if(3!==i)return;e.fromBufferAttribute(s.geometry.attributes.position,o)}e.applyMatrix4(n),isNaN(e.x)||r.expandByPoint(e)}}}))}}(),Rp=function(){const e=new Cp.Box3;return function(t,n,i){return n.makeEmpty(),t.updateMatrices(),t.traverse((r=>{if(i&&!kp(r,t))return;r.updateMatrices();const o=r.geometry;null!=o&&(null==o.boundingBox&&o.computeBoundingBox(),n.union(e.copy(o.boundingBox).applyMatrix4(r.matrixWorld)))})),n}}(),Dp=new Cp.Euler;function jp(e,t,n){const i=new Cp.Box3;return Dp.copy(e.object3D.rotation),e.object3D.rotation.set(0,0,0),e.object3D.updateMatrices(!0,!0),t.updateMatrices(!0,!0),t.updateMatrixWorld(!0),Rp(t,i,!1),i.isEmpty()||(n||(e.object3D.worldToLocal(i.min),e.object3D.worldToLocal(i.max)),e.object3D.rotation.copy(Dp),e.object3D.matrixNeedsUpdate=!0),t.matrixWorldNeedsUpdate=!0,t.updateMatrices(),i}function Lp(e,t){if(t.isEmpty())return 1;const{max:n,min:i}=t,r=Math.abs(n.x-i.x),o=Math.abs(n.y-i.y),s=Math.abs(n.z-i.z);return e/Math.max(r,o,s)}var Ip=n.p+"assets/sfx/tick-59255da401cd3e2e6902..mp3",Np=n.p+"assets/sfx/teleport-loop-c7d8bb02701652fb6a28..mp3",Fp=n.p+"assets/sfx/quickTurn-54e7ca2f3d39b2745569..mp3",Bp=n.p+"assets/sfx/tap_mellow-4c3f907e642163a981d3..mp3",Vp=n.p+"assets/sfx/PenSpawn-d9558e3a5ea6a046c32d..mp3",Up=n.p+"assets/sfx/PenDraw1-439b3330c632fecf6013..mp3",Hp=n.p+"assets/sfx/PicSnapHey-fe3580dfa7104909f7bc..mp3",zp=n.p+"assets/sfx/welcome-2ccec1ba515216873929..mp3",Wp=n.p+"assets/sfx/quack-81a8a68bf9982b77b774..mp3",qp=n.p+"assets/sfx/specialquack-2019d6c5254b30919be2..mp3",Zp=n.p+"assets/sfx/pop-ba3b4e96b6968f022159..mp3",Gp=n.p+"assets/sfx/Eb_blip-cce5ceea0305c7eea647..mp3",Yp=n.p+"assets/sfx/tack-c01cd9b2c61cf929b1b1..mp3",Qp=n.p+"assets/sfx/A_bendUp-fcac930e7eacf149f382..mp3",Xp=n.p+"assets/sfx/suspense-b50d3f2ae4461cb64317..mp3",Kp=n.p+"assets/sfx/emoji-2982d00170d8f5f7051d..mp3",$p=n.p+"assets/sfx/tone-8251ff41390db0564a08..mp3";const Jp=Object.freeze(new Map([[mh.MEDIA_VIDEO,yh],[mh.AVATAR_AUDIO_SOURCE,bh],[mh.AUDIO_TARGET,wh]]));function em(e,t){e.panner&&(e.setDistanceModel(t.distanceModel),e.setRolloffFactor(t.rolloffFactor),e.setRefDistance(t.refDistance),e.setMaxDistance(t.maxDistance),e.panner.panningModel=t.panningModel,e.panner.coneInnerAngle=t.coneInnerAngle,e.panner.coneOuterAngle=t.coneOuterAngle,e.panner.coneOuterGain=t.coneOuterGain),e.gain.gain.setTargetAtTime(t.gain,e.context.currentTime,.1)}function tm(){switch(APP.store.state.preferences.audioPanningQuality){case"High":return vh.HRTF;case"Low":return vh.EqualPower;default:return null}}function nm(e){var t;const n=APP.sourceType.get(e),i=Jp.get(n),r=APP.sceneAudioDefaults.get(n),o=APP.audioOverrides.get(e),s=APP.audioDebugPanelOverrides.get(n),a=APP.zoneOverrides.get(e),l={},c=tm(),d=n===mh.AVATAR_AUDIO_SOURCE&&!APP.moderatorAudioSource.has(e);null!==c&&(l.panningModel=c),APP.store.state.preferences.disableLeftRightPanning&&(l.audioType=fh.Stereo);const u=Object.assign({},i,r,o,s,a,l);return APP.clippingState.has(e)||APP.mutedState.has(e)||d&&(null===(t=APP.hub.member_permissions)||void 0===t||!t.voice_chat)?u.gain=0:APP.gainMultipliers.has(e)&&(u.gain=u.gain*APP.gainMultipliers.get(e)),APP.supplementaryAttenuation.has(e)&&(u.gain=u.gain*APP.supplementaryAttenuation.get(e)),u}function im(e){const t=Jp.get(e),n=APP.sceneAudioDefaults.get(e),i=APP.audioDebugPanelOverrides.get(e);return Object.assign({},t,n,i)}function rm(e,t){if(e.isEntity){const n=e,i=nm(n);(void 0===t.panner&&i.audioType===fh.PannerNode||void 0!==t.panner&&i.audioType===fh.Stereo)&&n.emit("audio_type_changed"),em(t,i)}else{const t=e;(0,Ot.addComponent)(APP.world,si,t)}}function om(e,t){if(t.panner)return!1;const n=APP.sourceType.get(e),i=Jp.get(n),r=APP.sceneAudioDefaults.get(n),o=APP.audioDebugPanelOverrides.get(n),s=APP.audioOverrides.get(e),a=APP.zoneOverrides.get(e);return Object.assign({},i,r,o,s,a).audioType===fh.PannerNode}var sm=n(99477);let am=0;const lm=am++,cm=am++,dm=am++,um=am++,hm=am++,pm=am++,mm=am++,fm=am++,gm=am++,vm=am++,bm=am++,ym=am++,wm=am++,_m=am++,Em=am++,Am=am++,Sm=am++,xm=am++,Mm=am++,Pm=am++,Cm=am++,km=am++,Om=am++,Tm=am++,Rm=am++,Dm=am++;class jm{constructor(e){this.pendingAudioSourceNodes=[],this.pendingPositionalAudios=[],this.positionalAudiosStationary=[],this.positionalAudiosFollowingObject3Ds=[],this.audioContext=sm.AudioContext.getContext(),this.scene=e;const t=[[lm,Ip],[cm,Ip],[dm,Ip],[um,Ip],[hm,Ip],[pm,Ip],[Om,Ip],[mm,Np],[fm,Fp],[gm,Fp],[vm,Ip],[bm,Bp],[ym,Vp],[wm,Up],[_m,Hp],[Em,zp],[Am,Wp],[Sm,qp],[xm,Zp],[Mm,Gp],[Pm,Yp],[Cm,Xp],[km,Qp],[Tm,Gp],[Rm,Kp],[Dm,$p]],n=new Map,i=e=>{let t=n.get(e);return t||(t=fetch(e).then((e=>e.arrayBuffer())).then((e=>function(e,t){return new Promise(((n,i)=>{e.decodeAudioData(t,n,i)}))}(this.audioContext,e))),n.set(e,t)),t};this.sounds=new Map,t.map((e=>{let[t,n]=e;i(n).then((e=>{this.sounds.set(t,e)}))})),this.isDisabled=window.APP.store.state.preferences.disableSoundEffects,window.APP.store.addEventListener("statechanged",(()=>{const e=window.APP.store.state.preferences.disableSoundEffects;e&&!this.isDisabled&&this.stopAllPositionalAudios(),this.isDisabled=e}))}enqueueSound(e,t){if(this.isDisabled)return null;const n=this.sounds.get(e);if(!n)return null;const i=this.audioContext.createBufferSource();return i.buffer=n,this.scene.systems["hubs-systems"].audioSystem.addAudio({sourceType:mh.SFX,node:i}),i.loop=t,this.pendingAudioSourceNodes.push(i),i}enqueuePositionalSound(e,t){if(this.isDisabled)return null;const n=this.sounds.get(e);if(!n)return null;const i=window.APP.store.state.preferences.disableLeftRightPanning,r=i?new sm.Audio(this.scene.audioListener):new sm.PositionalAudio(this.scene.audioListener);if(r.setBuffer(n),r.loop=t,!i){const e=tm();null!==e&&(r.panner.panningModel=e)}return this.pendingPositionalAudios.push(r),this.scene.systems["hubs-systems"].audioSystem.addAudio({sourceType:mh.SFX,node:r}),r}playPositionalSoundAt(e,t,n){const i=this.enqueuePositionalSound(e,n);if(!i)return null;i.position.copy(t),i.matrixWorldNeedsUpdate=!0,this.positionalAudiosStationary.push(i)}playPositionalSoundFollowing(e,t,n){const i=this.enqueuePositionalSound(e,n);return i?(this.positionalAudiosFollowingObject3Ds.push({positionalAudio:i,object3D:t}),i):null}playSoundOneShot(e){return this.enqueueSound(e,!1)}playSoundLooped(e){return this.enqueueSound(e,!0)}playSoundLoopedWithGain(e){if(this.isDisabled)return null;const t=this.sounds.get(e);if(!t)return null;const n=this.audioContext.createBufferSource(),i=this.audioContext.createGain();return n.buffer=t,n.connect(i),this.scene.systems["hubs-systems"].audioSystem.addAudio({sourceType:mh.SFX,node:i}),n.loop=!0,this.pendingAudioSourceNodes.push(n),{gain:i,source:n}}stopSoundNode(e){const t=this.pendingAudioSourceNodes.indexOf(e);-1!==t?this.pendingAudioSourceNodes.splice(t,1):(e.stop(),this.scene.systems["hubs-systems"].audioSystem.removeAudio({node:e}))}stopPositionalAudio(e){const t=this.pendingPositionalAudios.indexOf(e);-1!==t?this.pendingPositionalAudios.splice(t,1):(e.isPlaying&&e.stop(),e.parent&&e.removeFromParent()),this.positionalAudiosStationary=this.positionalAudiosStationary.filter((t=>t!==e)),this.positionalAudiosFollowingObject3Ds=this.positionalAudiosFollowingObject3Ds.filter((t=>{let{positionalAudio:n}=t;return n!==e})),this.scene.systems["hubs-systems"].audioSystem.removeAudio({node:e})}stopAllPositionalAudios(){for(let e=this.positionalAudiosStationary.length-1;e>=0;e--){const t=this.positionalAudiosStationary[e];this.stopPositionalAudio(t)}for(let e=this.positionalAudiosFollowingObject3Ds.length-1;e>=0;e--){const t=this.positionalAudiosFollowingObject3Ds[e].positionalAudio;this.stopPositionalAudio(t)}}tick(){if(!this.isDisabled){for(let e=0;e<this.pendingAudioSourceNodes.length;e++)this.pendingAudioSourceNodes[e].start();this.pendingAudioSourceNodes.length=0;for(let e=0;e<this.pendingPositionalAudios.length;e++){const t=this.pendingPositionalAudios[e];this.scene.object3D.add(t),t.play()}this.pendingPositionalAudios.length=0;for(let e=this.positionalAudiosStationary.length-1;e>=0;e--){const t=this.positionalAudiosStationary[e];t.isPlaying||this.stopPositionalAudio(t)}for(let e=this.positionalAudiosFollowingObject3Ds.length-1;e>=0;e--){const t=this.positionalAudiosFollowingObject3Ds[e],n=t.positionalAudio,i=t.object3D;n.isPlaying&&i.parent?(i.updateMatrices(),Oo(n,i.matrixWorld)):this.stopPositionalAudio(n)}}}}var Lm=n(97807),Im=n(99477);function Nm(e,t,n,i,r,o,s){try{var a=e[o](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(i,r)}function Fm(e){return function(){var t=this,n=arguments;return new Promise((function(i,r){var o=e.apply(t,n);function s(e){Nm(o,i,r,s,a,"next",e)}function a(e){Nm(o,i,r,s,a,"throw",e)}s(void 0)}))}}let Bm;function Vm(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function Um(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Vm(Object(n),!0).forEach((function(t){Hm(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Vm(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Hm(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}L().then((()=>{ja(Rc).then((e=>{Bm=e}))})),AFRAME.registerComponent("media-loader",{schema:{playSoundEffect:{default:!0},fileId:{type:"string"},fileIsOwned:{type:"boolean"},src:{type:"string"},version:{type:"number",default:1},fitToBox:{default:!1},moveTheParentNotTheMesh:{default:!1},resolve:{default:!1},contentType:{default:null},contentSubtype:{default:null},animate:{default:!0},linkedEl:{default:null},mediaOptions:{default:{},parse:e=>"object"==typeof e?e:JSON.parse(e),stringify:JSON.stringify}},init(){this.onError=this.onError.bind(this),this.showLoader=this.showLoader.bind(this),this.clearLoadingTimeout=this.clearLoadingTimeout.bind(this),this.onMediaLoaded=this.onMediaLoaded.bind(this),this.handleLinkedElRemoved=this.handleLinkedElRemoved.bind(this),this.refresh=this.refresh.bind(this),this.animating=!1;try{NAF.utils.getNetworkedEntity(this.el).then((e=>{this.networkedEl=e})).catch((()=>{}))}catch(e){}},updateScale:function(){const e=new Im.Vector3,t=new Im.Matrix4,n=new Im.Matrix4,i=new Im.Vector3,r=new Im.Quaternion,o=new Im.Vector3,s=new Im.Box3;return function(a,l){this.el.object3D.updateMatrices();const c=this.el.getObject3D("mesh");if(c.updateMatrices(),l)a&&console.warn("Unexpected combination of inputs. Can fit the mesh to a box OR move the parent to the mesh, but did not expect to do both.",this.el),t.copy(c.matrixWorld),Rp(c,s),e.addVectors(s.min,s.max).multiplyScalar(.5),this.el.object3D.matrixWorld.decompose(i,r,o),n.compose(e,r,o),Oo(this.el.object3D,n),c.updateMatrices(),Oo(c,t);else{const t=jp(this.el,c),n=a?Lp(.5,t):1,{min:i,max:r}=t;e.addVectors(i,r).multiplyScalar(.5*n),c.scale.multiplyScalar(n),c.position.sub(e),c.matrixNeedsUpdate=!0}}}(),removeShape(e){this.el.getAttribute("shape-helper__"+e)&&this.el.removeAttribute("shape-helper__"+e)},tick(e,t){this.loaderMixer&&this.loaderMixer.update(t/1e3)},handleLinkedElRemoved(e){"media-loader"===e.detail.name&&(this.data.linkedEl.removeEventListener("componentremoved",this.handleLinkedElRemoved),Ql())},remove(){this.data.linkedEl&&this.data.linkedEl.removeEventListener("componentremoved",this.handleLinkedElRemoved);const e=this.el.sceneEl.systems["hubs-systems"].soundEffectsSystem;this.loadingSoundEffect&&(e.stopPositionalAudio(this.loadingSoundEffect),this.loadingSoundEffect=null),this.loadedSoundEffect&&(e.stopPositionalAudio(this.loadedSoundEffect),this.loadedSoundEffect=null)},onError(){this.el.removeAttribute("gltf-model-plus"),this.el.removeAttribute("media-pager"),this.el.removeAttribute("media-video"),this.el.removeAttribute("audio-zone-source"),this.el.removeAttribute("media-pdf"),this.el.setAttribute("media-image",{src:"error"}),this.clearLoadingTimeout()},showLoader(){if(this.el.object3DMap.mesh)return void this.clearLoadingTimeout();const e=!!Bm,t=e?Ro(Bm.scene):new Im.Mesh(new Im.BoxGeometry,new Im.MeshBasicMaterial);this.el.setObject3D("mesh",t),this.updateScale(!0,!1),e&&(this.loaderMixer=new Im.AnimationMixer(t),this.loadingClip=this.loaderMixer.clipAction(t.animations[0]),this.loadingScaleClip=this.loaderMixer.clipAction(new Im.AnimationClip(null,1e3,[new Im.VectorKeyframeTrack(".scale",[0,.2],[0,0,0,t.scale.x,t.scale.y,t.scale.z])])),setTimeout((()=>{this.loaderMixer&&this.el.setAttribute("shape-helper__loader",{type:Lm.SHAPE.BOX})}),200),this.loadingClip.play(),this.loadingScaleClip.play()),this.el.sceneEl.is("entered")&&(!this.networkedEl||NAF.utils.isMine(this.networkedEl))&&this.data.playSoundEffect&&(this.loadingSoundEffect=this.el.sceneEl.systems["hubs-systems"].soundEffectsSystem.playPositionalSoundFollowing(Cm,this.el.object3D,!0)),delete this.showLoaderTimeout},clearLoadingTimeout(){clearTimeout(this.showLoaderTimeout),this.loadingSoundEffect&&(this.el.sceneEl.systems["hubs-systems"].soundEffectsSystem.stopPositionalAudio(this.loadingSoundEffect),this.loadingSoundEffect=null),this.loaderMixer&&(this.loadingClip.stop(),this.loadingScaleClip.stop(),delete this.loaderMixer,delete this.loadingScaleClip,delete this.loadingClip),delete this.showLoaderTimeout,this.removeShape("loader")},updateHoverableVisuals:function(){const e=new Im.Box3,t=new Im.Sphere;return function(){const n=this.el.components["hoverable-visuals"];n&&(this.injectedCustomShaderChunks||(this.injectedCustomShaderChunks=!0,n.uniforms=Bl(this.el.object3D)),e.setFromObject(this.el.object3DMap.mesh),e.getBoundingSphere(t),n.geometryRadius=t.radius/this.el.object3D.scale.y)}}(),onMediaLoaded(e,t){void 0===e&&(e=null);const n=this.el;this.clearLoadingTimeout(),this.el.sceneEl.is("entered")&&this.data.playSoundEffect&&(this.loadedSoundEffect=this.el.sceneEl.systems["hubs-systems"].soundEffectsSystem.playPositionalSoundFollowing(km,this.el.object3D,!1));const i=()=>{this.animating=!1,e&&n.setAttribute("shape-helper",{type:e,minHalfExtent:.04}),this.updateHoverableVisuals(),this.data.linkedEl&&(this.el.sceneEl.systems["linked-media"].registerLinkage(this.data.linkedEl,this.el),this.data.linkedEl.addEventListener("componentremoved",this.handleLinkedElRemoved)),this.contentBounds=jp(this.el,this.el.getObject3D("mesh")).getSize(new Im.Vector3),n.emit("media-loaded"),n.eid&&(0,Ot.entityExists)(APP.world,n.eid)&&(0,Ot.removeComponent)(APP.world,Vn,n.eid)};if(this.data.animate){if(!this.animating){this.animating=!0,t&&this.updateScale(this.data.fitToBox,this.data.moveTheParentNotTheMesh);const e=this.el.getObject3D("mesh"),n={x:.001,y:.001,z:.001};n.x=e.scale.x<n.x?.001*e.scale.x:n.x,n.y=e.scale.y<n.y?.001*e.scale.x:n.y,n.z=e.scale.z<n.z?.001*e.scale.x:n.z,Yl(e,n,i)}}else t&&this.updateScale(this.data.fitToBox,this.data.moveTheParentNotTheMesh),i()},refresh(){(!this.networkedEl||NAF.utils.isMine(this.networkedEl)||NAF.utils.takeOwnership(this.networkedEl))&&this.el.setAttribute("media-loader",{version:Math.floor(Date.now()/1e3)})},update(e,t){var n=this;return Fm((function*(){const{version:i,contentSubtype:r}=n.data;let o=n.data.src;if(!o)return;const s=e.src!==o;!(!e.version||e.version===i)&&(n.el.emit("media_refreshing"),n.data.animate=!1,n.data.playSoundEffect=NAF.utils.isMine(n.networkedEl)),t&&(n.el.removeAttribute("gltf-model-plus"),n.el.removeAttribute("media-pager"),n.el.removeAttribute("media-video"),n.el.removeAttribute("audio-zone-source"),n.el.removeAttribute("media-pdf"),n.el.removeAttribute("media-image"));try{!t&&!s||n.showLoaderTimeout||(n.showLoaderTimeout=setTimeout(n.showLoader,100),(0,Ot.addComponent)(APP.world,Vn,n.el.eid)),"#"===o.charAt(0)&&(o=n.data.src=`${window.location.origin}${window.location.pathname}${window.location.search}${o}`);let e,a=o,l=null,c=o,d=n.data.contentType;const u=new URL(o),h=Hs(u.hostname)&&(Gs(o)||"").startsWith("model/gltf");if(n.data.resolve&&!o.startsWith("data:")&&!o.startsWith("hubs:")&&!h){const r=!(!n.data.mediaOptions.projection||!n.data.mediaOptions.projection.startsWith("360")),s=Dl(r),c=yield jl(o,s,i,t);a=c.origin,a.startsWith("//")&&(a=location.protocol+a),l=c.origin_audio,l&&l.startsWith("//")&&(l=location.protocol+l),d=c.meta&&c.meta.expected_content_type||d,e=c.meta&&c.meta.thumbnail&&zs(c.meta.thumbnail)}if(c=zs(a),d=d||Gs(a)||(yield Xl(c)),"application/octet-stream"===d&&(d=Gs(a)||d),"audio/x-mpegurl"!==d&&"audio/mpegurl"!==d||(d="application/vnd.apple.mpegurl"),t||s?n.el.emit("media_resolved",{src:o,raw:c,contentType:d}):n.el.emit("media_refreshed",{src:o,raw:c,contentType:d}),d.startsWith("video/")||d.startsWith("audio/")||d.startsWith("application/dash")||AFRAME.utils.material.isHLS(a,d)){let e,t,i;if(n.data.linkedEl){const r=n.data.linkedEl.components["media-video"];e=r.videoTexture,t=r.audioSource,i=r.mediaElementAudioSource}const r=parseInt(u.searchParams.get("t")),o=parseInt(new URLSearchParams(u.hash.substring(1)).get("t"))||r||0;n.el.removeAttribute("gltf-model-plus"),n.el.removeAttribute("media-image"),n.el.removeAttribute("media-pdf"),n.el.setAttribute("floaty-object",{reduceAngularFloat:!0,releaseGravity:-1}),n.el.addEventListener("video-loaded",(e=>{n.onMediaLoaded("flat"===e.detail.projection?Lm.SHAPE.BOX:null)}),{once:!0}),n.el.setAttribute("media-video",Object.assign({},n.data.mediaOptions,{src:c,audioSrc:l?zs(l):null,time:o,contentType:d,linkedVideoTexture:e,linkedAudioSource:t,linkedMediaElementAudioSource:i})),n.el.setAttribute("audio-zone-source",{}),n.el.components["position-at-border__freeze"]&&n.el.setAttribute("position-at-border__freeze",{isFlat:!0}),n.el.components["position-at-border__freeze-unprivileged"]&&n.el.setAttribute("position-at-border__freeze-unprivileged",{isFlat:!0})}else if(d.startsWith("image/"))n.el.removeAttribute("gltf-model-plus"),n.el.removeAttribute("media-video"),n.el.removeAttribute("audio-zone-source"),n.el.removeAttribute("media-pdf"),n.el.removeAttribute("media-pager"),n.el.addEventListener("image-loaded",(e=>{n.onMediaLoaded("flat"===e.detail.projection?Lm.SHAPE.BOX:null),"photo-camera"===r?n.el.setAttribute("hover-menu__photo",{template:"#photo-hover-menu",isFlat:!0}):n.data.mediaOptions.href&&n.el.setAttribute("hover-menu__link",{template:"#link-hover-menu",isFlat:!0})}),{once:!0}),n.el.setAttribute("floaty-object",{reduceAngularFloat:!0,releaseGravity:-1}),n.el.setAttribute("media-image",Object.assign({},n.data.mediaOptions,{src:c,version:i,contentType:d})),n.el.components["position-at-border__freeze"]&&n.el.setAttribute("position-at-border__freeze",{isFlat:!0}),n.el.components["position-at-border__freeze-unprivileged"]&&n.el.setAttribute("position-at-border__freeze-unprivileged",{isFlat:!0});else if(d.startsWith("application/pdf"))n.el.removeAttribute("gltf-model-plus"),n.el.removeAttribute("media-video"),n.el.removeAttribute("audio-zone-source"),n.el.removeAttribute("media-image"),n.el.setAttribute("media-pdf",Object.assign({},n.data.mediaOptions,{src:c,contentType:d})),n.el.setAttribute("media-pager",{}),n.el.setAttribute("floaty-object",{reduceAngularFloat:!0,releaseGravity:-1}),n.el.addEventListener("pdf-loaded",(()=>{n.clearLoadingTimeout(),n.onMediaLoaded(Lm.SHAPE.BOX)}),{once:!0}),n.el.components["position-at-border__freeze"]&&n.el.setAttribute("position-at-border__freeze",{isFlat:!0}),n.el.components["position-at-border__freeze-unprivileged"]&&n.el.setAttribute("position-at-border__freeze-unprivileged",{isFlat:!0});else if(d.includes("application/octet-stream")||d.includes("x-zip-compressed")||d.startsWith("model/gltf"))n.el.removeAttribute("media-image"),n.el.removeAttribute("media-video"),n.el.removeAttribute("audio-zone-source"),n.el.removeAttribute("media-pdf"),n.el.removeAttribute("media-pager"),n.el.addEventListener("model-loaded",(()=>{n.onMediaLoaded(Lm.SHAPE.HULL,!0),er(n.el)}),{once:!0}),n.el.addEventListener("model-error",n.onError,{once:!0}),Object.prototype.hasOwnProperty.call(n.data.mediaOptions,"applyGravity")&&n.el.setAttribute("floaty-object",{modifyGravityOnRelease:!n.data.mediaOptions.applyGravity}),n.el.setAttribute("gltf-model-plus",Object.assign({},n.data.mediaOptions,{src:c,contentType:d,inflate:!0,modelToWorldScale:n.data.fitToBox?1e-4:1}));else{if(!d.startsWith("text/html"))throw new Error(`Unsupported content type: ${d}`);n.el.removeAttribute("gltf-model-plus"),n.el.removeAttribute("media-video"),n.el.removeAttribute("audio-zone-source"),n.el.removeAttribute("media-pdf"),n.el.removeAttribute("media-pager"),n.el.addEventListener("image-loaded",Fm((function*(){const e=n.el.sceneEl.systems.permissions.can("update_hub");(yield ra(o))?n.el.setAttribute("hover-menu__hubs-item",{template:"#avatar-link-hover-menu",isFlat:!0}):(yield oa(o))||(yield na(o))&&e?n.el.setAttribute("hover-menu__hubs-item",{template:"#hubs-destination-hover-menu",isFlat:!0}):n.el.setAttribute("hover-menu__link",{template:"#link-hover-menu",isFlat:!0}),n.onMediaLoaded(Lm.SHAPE.BOX)})),{once:!0}),n.el.setAttribute("floaty-object",{reduceAngularFloat:!0,releaseGravity:-1}),n.el.setAttribute("media-image",Object.assign({},n.data.mediaOptions,{src:e,version:i,contentType:Gs(e)||"image/png"})),n.el.components["position-at-border__freeze"]&&n.el.setAttribute("position-at-border__freeze",{isFlat:!0}),n.el.components["position-at-border__freeze-unprivileged"]&&n.el.setAttribute("position-at-border__freeze-unprivileged",{isFlat:!0})}}catch(e){n.el.components["position-at-border__freeze"]&&n.el.setAttribute("position-at-border__freeze",{isFlat:!0}),n.el.components["position-at-border__freeze-unprivileged"]&&n.el.setAttribute("position-at-border__freeze-unprivileged",{isFlat:!0}),console.error("Error adding media",e),n.onError()}}))()}}),AFRAME.registerComponent("media-pager",{schema:{index:{default:0},maxIndex:{default:0}},init(){this.onNext=this.onNext.bind(this),this.onPrev=this.onPrev.bind(this),this.onSnap=this.onSnap.bind(this),this.update=this.update.bind(this),this.el.setAttribute("hover-menu__pager",{template:"#pager-hover-menu",isFlat:!0}),this.el.components["hover-menu__pager"].getHoverMenu().then((e=>{this.el.parentNode&&(this.hoverMenu=e,this.nextButton=this.el.querySelector(".next-button [text-button]"),this.prevButton=this.el.querySelector(".prev-button [text-button]"),this.snapButton=this.el.querySelector(".snap-button [text-button]"),this.pageLabel=this.el.querySelector(".page-label"),this.nextButton.object3D.addEventListener("interact",this.onNext),this.prevButton.object3D.addEventListener("interact",this.onPrev),this.snapButton.object3D.addEventListener("interact",this.onSnap),this.update(),this.el.emit("pager-loaded"))})),NAF.utils.getNetworkedEntity(this.el).then((e=>{this.networkedEl=e,this.networkedEl.addEventListener("pinned",this.update),this.networkedEl.addEventListener("unpinned",this.update),window.APP.hubChannel.addEventListener("permissions_updated",this.update)})).catch((()=>{})),this.el.addEventListener("pdf-loaded",this.update)},update(e){var t=this;return Fm((function*(){if(t.networkedEl&&NAF.utils.isMine(t.networkedEl)&&e&&"number"==typeof e.index&&e.index!==t.data.index&&t.el.emit("owned-pager-page-changed"),t.pageLabel&&t.pageLabel.setAttribute("text","value",`${t.data.index+1}/${t.data.maxIndex+1}`),t.prevButton&&t.nextButton){const e=t.el.components["media-loader"].data.linkedEl||t.el,n=e.components.pinnable&&e.components.pinnable.data.pinned;t.prevButton.object3D.visible=t.nextButton.object3D.visible=!n||window.APP.hubChannel.can("pin_objects")}}))()},onNext(){if(this.networkedEl&&!NAF.utils.isMine(this.networkedEl)&&!NAF.utils.takeOwnership(this.networkedEl))return;const e=Math.min(this.data.index+1,this.data.maxIndex);this.el.setAttribute("media-pdf","index",e),this.el.setAttribute("media-pager","index",e)},onPrev(){if(this.networkedEl&&!NAF.utils.isMine(this.networkedEl)&&!NAF.utils.takeOwnership(this.networkedEl))return;const e=Math.max(this.data.index-1,0);this.el.setAttribute("media-pdf","index",e),this.el.setAttribute("media-pager","index",e)},onSnap(){this.el.emit("pager-snap-clicked")},remove(){this.networkedEl&&(this.networkedEl.removeEventListener("pinned",this.update),this.networkedEl.removeEventListener("unpinned",this.update)),this.nextButton.object3D.removeEventListener("interact",this.onNext),this.prevButton.object3D.removeEventListener("interact",this.onPrev),this.snapButton.object3D.removeEventListener("interact",this.onSnap),window.APP.hubChannel.removeEventListener("permissions_updated",this.update),this.el.removeEventListener("pdf-loaded",this.update)}}),n(28246),AFRAME.registerComponent("quack",{schema:{quackPercentage:{default:1},specialQuackPercentage:{default:.01}},init:function(){this.wasInteracting=!1,NAF.utils.getNetworkedEntity(this.el).then((e=>{this.networkedEntity=e}))},tick:function(){const e=AFRAME.scenes[0].systems.interaction.isHeld(this.networkedEntity||this.el);e&&!this.wasInteracting&&this.quack(),this.wasInteracting=e},quack:function(){const e=Math.random();e<this.data.specialQuackPercentage?this.el.sceneEl.systems["hubs-systems"].soundEffectsSystem.playSoundOneShot(Sm):e<this.data.quackPercentage&&this.el.sceneEl.systems["hubs-systems"].soundEffectsSystem.playSoundOneShot(Am)}});const zm={noop:"/noop",actions:{}};zm.actions.log="/actions/log",zm.actions.toggleScreenShare="/actions/toggleScreenShare",zm.actions.snapRotateLeft="/actions/snapRotateLeft",zm.actions.snapRotateRight="/actions/snapRotateRight",zm.actions.angularVelocity="/actions/angularVelocity",zm.actions.logDebugFrame="/actions/logDebugFrame",zm.actions.logInteractionState="/actions/logInteractionState",zm.actions.debugUserInput={},zm.actions.debugUserInput.describeCurrentMasks="/actions/debugUserInput/describeCurrentMasks",zm.actions.cameraDelta="/actions/cameraDelta",zm.actions.lobbyCameraDelta="/actions/lobbyCameraDelta",zm.actions.characterAcceleration="/actions/characterAcceleration",zm.actions.dCharSpeed="/actions/dCharSpeed",zm.actions.boost="/actions/boost",zm.actions.startGazeTeleport="/actions/startTeleport",zm.actions.stopGazeTeleport="/actions/stopTeleport",zm.actions.spawnPen="/actions/spawnPen",zm.actions.ensureFrozen="/actions/ensureFrozen",zm.actions.toggleFreeze="/actions/toggleFreeze",zm.actions.thaw="/actions/thaw",zm.actions.muteMic="/actions/muteMic",zm.actions.toggleFly="/actions/toggleFly",zm.actions.toggleUI="/actions/toggleUI",zm.actions.toggleRecord="/actions/toggleRecord",zm.actions.waypointDeltaDistance="/actions/waypointDeltaDistance",zm.actions.focusChat="/actions/focusChat",zm.actions.focusChatCommand="/actions/focusChatCommand",zm.actions.toggleCamera="/actions/toggleCamera",zm.actions.takeSnapshot="/actions/takeSnapshot",zm.actions.mediaExit="/actions/mediaExit",zm.actions.mediaSearch1="/actions/mediaSearch1",zm.actions.mediaSearch2="/actions/mediaSearch2",zm.actions.mediaSearch3="/actions/mediaSearch3",zm.actions.mediaSearch4="/actions/mediaSearch4",zm.actions.mediaSearch5="/actions/mediaSearch5",zm.actions.mediaSearch6="/actions/mediaSearch6",zm.actions.mediaSearch7="/actions/mediaSearch7",zm.actions.mediaSearch8="/actions/mediaSearch8",zm.actions.transformModifier="/actions/transformModifier",zm.actions.rayObjectRotation="/actions/rayObjectRotation",zm.actions.cursor={},zm.actions.cursor.right={},zm.actions.cursor.right.pose="/actions/cursor/right/Pose",zm.actions.cursor.right.hideLine="/actions/cursor/right/HideLine",zm.actions.cursor.right.grab="/actions/cursor/right/Grab",zm.actions.cursor.right.drop="/actions/cursor/right/Drop",zm.actions.cursor.right.modDelta="/actions/cursor/right/ModDelta",zm.actions.cursor.right.startDrawing="/actions/cursor/right/StartDrawing",zm.actions.cursor.right.stopDrawing="/actions/cursor/right/StopDrawing",zm.actions.cursor.right.undoDrawing="/actions/cursor/right/UndoDrawing",zm.actions.cursor.right.penNextColor="/actions/cursor/right/PenNextColor",zm.actions.cursor.right.penPrevColor="/actions/cursor/right/PenPrevColor",zm.actions.cursor.right.scalePenTip="/actions/cursor/right/ScalePenTip",zm.actions.cursor.right.scaleGrabbedGrabbable="/actions/cursor/right/ScaleGrabbedGrabbable",zm.actions.cursor.right.mediaVolumeMod="/actions/cursor/right/mediaVolumeMod",zm.actions.cursor.right.takeSnapshot="/actions/cursor/right/TakeSnapshot",zm.actions.cursor.right.wake="/actions/cursor/right/wake",zm.actions.cursor.right.togglePlayVideo="/actions/cursor/right/TogglePlayVideo",zm.actions.cursor.right.deleteEntity="/actions/cursor/right/DeleteEntity",zm.actions.cursor.left={},zm.actions.cursor.left.pose="/actions/cursor/left/Pose",zm.actions.cursor.left.hideLine="/actions/cursor/left/HideLine",zm.actions.cursor.left.grab="/actions/cursor/left/Grab",zm.actions.cursor.left.drop="/actions/cursor/left/Drop",zm.actions.cursor.left.modDelta="/actions/cursor/left/ModDelta",zm.actions.cursor.left.startDrawing="/actions/cursor/left/StartDrawing",zm.actions.cursor.left.stopDrawing="/actions/cursor/left/StopDrawing",zm.actions.cursor.left.undoDrawing="/actions/cursor/left/UndoDrawing",zm.actions.cursor.left.penNextColor="/actions/cursor/left/PenNextColor",zm.actions.cursor.left.penPrevColor="/actions/cursor/left/PenPrevColor",zm.actions.cursor.left.scalePenTip="/actions/cursor/left/ScalePenTip",zm.actions.cursor.left.scaleGrabbedGrabbable="/actions/cursor/left/ScaleGrabbedGrabbable",zm.actions.cursor.left.mediaVolumeMod="/actions/cursor/left//mediaVolumeMod",zm.actions.cursor.left.takeSnapshot="/actions/cursor/left/TakeSnapshot",zm.actions.cursor.left.wake="/actions/cursor/left/wake",zm.actions.cursor.left.togglePlayVideo="/actions/cursor/left/TogglePlayVideo",zm.actions.cursor.left.deleteEntity="/actions/cursor/left/DeleteEntity",zm.actions.pen={},zm.actions.pen.remove="/actions/pen/remove",zm.actions.rightHand={},zm.actions.rightHand.matrix="/actions/rightHand/matrix",zm.actions.rightHand.pose="/actions/rightHandPose",zm.actions.rightHand.grab="/actions/rightHandGrab",zm.actions.rightHand.drop="/actions/rightHandDrop",zm.actions.rightHand.modDelta="/actions/rightHandModDelta",zm.actions.rightHand.startDrawing="/actions/rightHandStartDrawing",zm.actions.rightHand.stopDrawing="/actions/rightHandStopDrawing",zm.actions.rightHand.undoDrawing="/actions/rightHandUndoDrawing",zm.actions.rightHand.switchDrawMode="/actions/rightHandSwitchDrawMode",zm.actions.rightHand.penNextColor="/actions/rightHandPenNextColor",zm.actions.rightHand.penPrevColor="/actions/rightHandPenPrevColor",zm.actions.rightHand.scalePenTip="/actions/rightHandScalePenTip",zm.actions.rightHand.startTeleport="/actions/rightHand/startTeleport",zm.actions.rightHand.stopTeleport="/actions/rightHand/stopTeleport",zm.actions.rightHand.takeSnapshot="/actions/rightHandTakeSnapshot",zm.actions.rightHand.thumb="/actions/rightHand/thumbDown",zm.actions.rightHand.index="/actions/rightHand/indexDown",zm.actions.rightHand.middleRingPinky="/actions/rightHand/middleRingPinkyDown",zm.actions.leftHand={},zm.actions.leftHand.matrix="/actions/leftHand/matrix",zm.actions.leftHand.pose="/actions/leftHandPose",zm.actions.leftHand.grab="/actions/leftHandGrab",zm.actions.leftHand.drop="/actions/leftHandDrop",zm.actions.leftHand.modDelta="/actions/leftHandModDelta",zm.actions.leftHand.startDrawing="/actions/leftHandStartDrawing",zm.actions.leftHand.stopDrawing="/actions/leftHandStopDrawing",zm.actions.leftHand.undoDrawing="/actions/leftHandUndoDrawing",zm.actions.leftHand.switchDrawMode="/actions/leftHandSwitchDrawMode",zm.actions.leftHand.penNextColor="/actions/leftHandPenNextColor",zm.actions.leftHand.penPrevColor="/actions/leftHandPenPrevColor",zm.actions.leftHand.scalePenTip="/actions/leftHandScalePenTip",zm.actions.leftHand.startTeleport="/actions/leftHand/startTeleport",zm.actions.leftHand.stopTeleport="/actions/leftHand/stopTeleport",zm.actions.leftHand.takeSnapshot="/actions/leftHandTakeSnapshot",zm.actions.leftHand.thumb="/actions/leftHand/thumbDown",zm.actions.leftHand.index="/actions/leftHand/indexDown",zm.actions.leftHand.middleRingPinky="/actions/leftHand/middleRingPinkyDown",zm.actions.camera={},zm.actions.camera.exitMirror="/actions/cameraExitMirror",zm.actions.startInspecting="/actions/startInspecting",zm.actions.startInspectingSelf="/actions/startInspectingSelf",zm.actions.stopInspecting="/actions/stopInspecting",zm.actions.inspectZoom="/actions/inspectZoom",zm.actions.inspectPanY="/actions/inspectPanY",zm.actions.resetInspectView="/actions/resetInspectView",zm.actions.nextCameraMode="/actions/nextCameraMode",zm.actions.spawnEmoji0="/actions/spawnEmoji0",zm.actions.spawnEmoji1="/actions/spawnEmoji1",zm.actions.spawnEmoji2="/actions/spawnEmoji2",zm.actions.spawnEmoji3="/actions/spawnEmoji3",zm.actions.spawnEmoji4="/actions/spawnEmoji4",zm.actions.spawnEmoji5="/actions/spawnEmoji5",zm.actions.spawnEmoji6="/actions/spawnEmoji6",zm.haptics={},zm.haptics.actuators={},zm.haptics.actuators.left="/haptics/actuators/left",zm.haptics.actuators.right="/haptics/actuators/right",zm.device={},zm.device.mouse={},zm.device.mouse.coords="/device/mouse/coords",zm.device.mouse.movementXY="/device/mouse/movementXY",zm.device.mouse.buttonLeft="/device/mouse/buttonLeft",zm.device.mouse.buttonRight="/device/mouse/buttonRight",zm.device.mouse.buttonMiddle="/device/mouse/buttonMiddle",zm.device.mouse.wheel="/device/mouse/wheel",zm.device.smartMouse={},zm.device.smartMouse.cursorPose="/device/smartMouse/cursorPose",zm.device.smartMouse.cameraDelta="/device/smartMouse/cameraDelta",zm.device.smartMouse.shouldMoveCamera="/device/smartMouse/shouldMoveCamera",zm.device.touchscreen={},zm.device.touchscreen.cursorPose="/device/touchscreen/cursorPose",zm.device.touchscreen.touchCameraDelta="/device/touchscreen/touchCameraDelta",zm.device.touchscreen.gyroCameraDelta="/device/touchscreen/gyroCameraDelta",zm.device.touchscreen.cameraDelta="/device/touchscreen/cameraDelta",zm.device.touchscreen.pinch={},zm.device.touchscreen.pinch.delta="/device/touchscreen/pinch/delta",zm.device.touchscreen.pinch.initialDistance="/device/touchscreen/pinch/initialDistance",zm.device.touchscreen.pinch.currentDistance="/device/touchscreen/pinch/currentDistance",zm.device.touchscreen.isTouching="/device/touchscreen/isTouching",zm.device.touchscreen.isTouchingGrabbable="/device/touchscreen/isTouchingGrabbable",zm.device.touchscreen.tap1="/device/touchscreen/tap1",zm.device.touchscreen.tap2="/device/touchscreen/tap2",zm.device.touchscreen.tap3="/device/touchscreen/tap3",zm.device.touchscreen.tap4="/device/touchscreen/tap4",zm.device.touchscreen.tap5="/device/touchscreen/tap5",zm.device.touchscreen.anything="/device/touchscreen/anything",zm.device.gyro={},zm.device.gyro.averageDeltaX="/device/gyro/averageDeltaX",zm.device.gyro.averageDeltaY="/device/gyro/averageDeltaY",zm.device.hud={},zm.device.hud.penButton="/device/hud/penButton",zm.device.keyboard={map:new Map,key:function(e){let t=this.map.get(e);return t||(t=`/device/keyboard/${" "===e?"space":e.toLowerCase()}`,this.map.set(e,t),t)}},zm.device.gamepad=e=>({button:t=>({pressed:`/device/gamepad/${e}/button/${t}/pressed`,touched:`/device/gamepad/${e}/button/${t}/touched`,value:`/device/gamepad/${e}/button/${t}/value`}),axis:t=>`/device/gamepad/${e}/axis/${t}`});const Wm="/device/xbox/";zm.device.xbox={v:e=>`/vars/xbox/${e}`,button:e=>({pressed:`${Wm}button/${e}/pressed`,touched:`${Wm}button/${e}/touched`,value:`${Wm}button/${e}/value`}),axis:e=>`${Wm}axis/${e}`,axesSum:`${Wm}axis/sum`},zm.device.oculusgo={button:e=>({pressed:`/device/oculusgo/button/${e}/pressed`,touched:`/device/oculusgo/button/${e}/touched`,value:`/device/oculusgo/button/${e}/value`}),axis:e=>`/device/oculusgo/axis/${e}`,trigger:{pressed:"/device/oculusgo/button/trigger/pressed",touched:"/device/oculusgo/button/trigger/touched",value:"/device/oculusgo/button/trigger/value"},touchpad:{pressed:"/device/oculusgo/button/touchpad/pressed",touched:"/device/oculusgo/button/touchpad/touched",value:"/device/oculusgo/button/touchpad/value",axisX:"/device/oculusgo/axis/touchpadX",axisY:"/device/oculusgo/axis/touchpadY"},pose:"/device/oculusgo/pose",matrix:"/device/oculusgo/matrix",v:e=>`/vars/oculusgo/${e}`};const qm="/device/gearVRController/";zm.device.gearVRController={button:e=>({pressed:`${qm}button/${e}/pressed`,touched:`${qm}button/${e}/touched`,value:`${qm}button/${e}/value`}),axis:e=>`${qm}axis/${e}`,pose:`${qm}pose`,matrix:`${qm}matrix`,v:e=>`/vars/gearVRController/${e}`};const Zm="/device/daydream/";zm.device.daydream={button:e=>({pressed:`${Zm}button/${e}/pressed`,touched:`${Zm}button/${e}/touched`,value:`${Zm}button/${e}/value`}),axis:e=>`${Zm}axis/${e}`,pose:`${Zm}pose`,matrix:`${Zm}matrix`};const Gm="/device/rightOculusTouch/";zm.device.rightOculusTouch={button:e=>({pressed:`${Gm}button/${e}/pressed`,touched:`${Gm}button/${e}/touched`,value:`${Gm}button/${e}/value`}),axis:e=>`${Gm}axis/${e}`,axesSum:`${Gm}axis/sum`,pose:`${Gm}pose`,matrix:`${Gm}matrix`};const Ym="/device/leftOculusTouch/";function Qm(e,t,n){return{pressed:`${e}${t}/button/${n}/pressed`,touched:`${e}${t}/button/${n}/touched`,value:`${e}${t}/button/${n}/value`}}function Xm(e,t,n){return{axisX:`${e}${t}/axis/${n}X`,axisY:`${e}${t}/axis/${n}Y`}}function Km(e){const t="/device/wmr/";return{touchpad:Um(Um({},Qm(t,e,"touchpad")),Xm(t,e,"touchpad")),trigger:Qm(t,e,"trigger"),grip:Qm(t,e,"grip"),menu:Qm(t,e,"menu"),joystick:Xm(t,e,"joystick"),pose:`${t}${e}/pose`,matrix:`${t}${e}/matrix`}}zm.device.leftOculusTouch={button:e=>({pressed:`${Ym}button/${e}/pressed`,touched:`${Ym}button/${e}/touched`,value:`${Ym}button/${e}/value`}),axis:e=>`${Ym}axis/${e}`,axesSum:`${Ym}axis/sum`,pose:`${Ym}pose`,matrix:`${Ym}matrix`},zm.device.vive={},zm.device.vive.left={button:e=>({pressed:`/device/vive/left/button/${e}/pressed`,touched:`/device/vive/left/button/${e}/touched`,value:`/device/vive/left/button/${e}/value`}),axis:e=>`/device/vive/left/axis/${e}`,axesSum:"/device/vive/left/axis/sum",pose:"/device/vive/left/pose",matrix:"/device/vive/left/matrix"},zm.device.vive.right={button:e=>({pressed:`/device/vive/right/button/${e}/pressed`,touched:`/device/vive/right/button/${e}/touched`,value:`/device/vive/right/button/${e}/value`}),axis:e=>`/device/vive/right/axis/${e}`,axesSum:"/device/vive/right/axis/sum",pose:"/device/vive/right/pose",matrix:"/device/vive/right/matrix"},zm.device.wmr={},zm.device.wmr.v=e=>`/vars/wmr/${e}`,zm.device.wmr.k=e=>`/vars/wmr/keyboard/${e}`,zm.device.wmr.left=Km("left"),zm.device.wmr.right=Km("right");const $m="/device/webxr/";zm.device.webxr={},zm.device.webxr.right={button:{trigger:Qm($m,"right","trigger"),grip:Qm($m,"right","grip"),touchpad:Qm($m,"right","touchpad"),a:Qm($m,"right","a"),b:Qm($m,"right","b"),thumbStick:Qm($m,"right","thumbStick")},axis:{touchpadX:`${$m}right/axis/touchpadX`,touchpadY:`${$m}right/axis/touchpadY`,joyX:`${$m}right/axis/joyX`,joyY:`${$m}right/axis/joyY`},pose:`${$m}right/pose`,matrix:`${$m}right/matrix`},zm.device.webxr.left={button:{trigger:Qm($m,"left","trigger"),grip:Qm($m,"left","grip"),touchpad:Qm($m,"left","touchpad"),a:Qm($m,"left","a"),b:Qm($m,"left","b"),thumbStick:Qm($m,"left","thumbStick")},axis:{touchpadX:`${$m}left/axis/touchpadX`,touchpadY:`${$m}left/axis/touchpadY`,joyX:`${$m}left/axis/joyX`,joyY:`${$m}left/axis/joyY`},pose:`${$m}left/pose`,matrix:`${$m}left/matrix`};const Jm={isHoldable:Jt,offersRemoteConstraint:_n,isHandCollisionTarget:En,offersHandConstraint:An,togglesHoveredActionSet:Sn,singleActionButton:Cn,holdableButton:Pn,isPen:kn,isHoverMenuChild:On,isStatic:Tn,inspectable:Rn,preventAudioBoost:Dn,ignoreSpaceBubble:jn};function ef(e,t){return e&&(0,Ot.hasComponent)(APP.world,Jm[t],e.eid)}AFRAME.registerComponent("tags",{schema:{isHandCollisionTarget:{default:!1},isHoldable:{default:!1},offersHandConstraint:{default:!1},offersRemoteConstraint:{default:!1},togglesHoveredActionSet:{default:!1},singleActionButton:{default:!1},holdableButton:{default:!1},isPen:{default:!1},isHoverMenuChild:{default:!1},isStatic:{default:!1},inspectable:{default:!1},preventAudioBoost:{default:!1},ignoreSpaceBubble:{default:!1}},update(){this.didUpdateOnce&&console.warn("Do not edit tags with .setAttribute"),this.didUpdateOnce=!0,Object.entries(this.data).forEach((e=>{let[t,n]=e;n&&(0,Ot.addComponent)(APP.world,Jm[t],this.el.eid)}))}});var tf=n(99477);const nf=(0,z.c)("fov"),rf=(0,z.Z)("thirdPerson");const of=function(){const e=new tf.Vector3;return function(t,n,i){t.decompose(n,i,e)}}(),sf=(new tf.Matrix4).identity(),af=function(){const e=new tf.Quaternion,t=new tf.Vector3,n=new tf.Quaternion,i=new tf.Vector3,r=new tf.Quaternion,o=new tf.Vector3,s=new tf.Vector3,a=new tf.Vector3,l=new tf.Vector3,c=new tf.Quaternion,d=new tf.Vector3(1,1,1),u=new tf.Matrix4,h=new tf.Quaternion,p=new tf.Quaternion;return function(m,f,g,v,b,y,w,_){m.updateMatrices(),of(m.matrixWorld,t,e),g.updateMatrices(),of(g.matrixWorld,i,n),f.getWorldQuaternion(r),h.setFromAxisAngle(o.set(0,1,0).applyQuaternion(e),.1*v*w),c.copy(n).premultiply(h),a.subVectors(i,t);const E=1-y*w,A=a.length()*E;A>.1&&A<100&&a.multiplyScalar(E),p.setFromAxisAngle(s.set(1,0,0).applyQuaternion(c),.1*b*w),c.premultiply(p),l.addVectors(t,a.applyQuaternion(h).applyQuaternion(p)).add(o.set(0,1,0).multiplyScalar(_*A).applyQuaternion(c)),u.compose(l,c,d),Fo(f,g,u)}}(),lf=function(){const e=new tf.Quaternion,t=new tf.Vector3,n=new tf.Quaternion,i=new tf.Vector3,r=new tf.Vector3,o=new tf.Vector3,s=new tf.Vector3(.3,.3,.3),a=new tf.Object3D;return function(l,c,d,u,h){a.parent||(AFRAME.scenes[0].object3D.add(a),a.applyMatrix4(sf)),u.updateMatrices(),of(u.matrixWorld,t,e),of(c.matrixWorld,i,n),l.getWorldQuaternion(n);const p=jp(d.el,d.el.getObject3D("mesh")||d,!0);p.min.x===1/0&&(p.min.subVectors(t,s),p.max.addVectors(t,s)),p.getCenter(o);const m=d.el.sceneEl.is("vr-mode"),f=function(e,t,n,i,r){const o=Math.max(Math.abs(n.max.y-i.y),Math.abs(i.y-n.min.y)),s=Math.max(Math.abs(n.max.x-i.x),Math.abs(i.x-n.min.x)),a=Eo.MathUtils.degToRad(e/2),l=Math.atan(Math.tan(a)*t)*(r?.5:1),c=Math.abs(1.05*o/Math.tan(a)),d=Math.abs(1.05*s/Math.tan(l)),u=Math.abs(n.max.z-i.z)+Math.max(c,d);return(r?Math.max(.25,u):u)||1.25}(d.el.sceneEl.camera.fov,d.el.sceneEl.camera.aspect,p,o,m)*h;a.position.addVectors(t,r.set(0,0,1).multiplyScalar(f).applyQuaternion(e)),a.quaternion.copy(e),a.matrixNeedsUpdate=!0,a.updateMatrices(),Fo(l,c,a.matrixWorld)}}(),cf={0:1,1:2,2:0},df=function(e){e.isLight&&e.layers.enable(_o.CAMERA_LAYER_INSPECT)},uf=new tf.Layers;uf.set(_o.CAMERA_LAYER_FIRST_PERSON_ONLY);const hf=function(e){e.layers.test(uf)||e.layers.enable(_o.CAMERA_LAYER_INSPECT)},pf=function(e){e.layers.test(uf)||e.layers.disable(_o.CAMERA_LAYER_INSPECT)};class mf{constructor(e,t){this.tick=function(){const e=new tf.Matrix4;let t;return function(n,i){this.viewingCamera.matrixNeedsUpdate=!0,this.viewingCamera.updateMatrix(),this.viewingCamera.updateMatrixWorld();const r=n.is("entered");if(t=t||document.getElementById("ui-root"),!r&&t&&t.firstChild&&t.firstChild.classList.contains("isGhost")&&0!==this.mode&&3!==this.mode){this.mode=0;const e=new tf.Vector3,t=new tf.Quaternion,i=new tf.Vector3;this.viewingRig.object3D.updateMatrices(),this.viewingRig.object3D.matrixWorld.decompose(e,t,i),e.setFromMatrixPosition(this.viewingCamera.matrixWorld),e.y=e.y-1.6,Oo(this.avatarRig.object3D,(new tf.Matrix4).compose(e,t,i)),n.systems["hubs-systems"].characterController.fly=!0,this.avatarPOV.object3D.updateMatrices(),Oo(this.avatarPOV.object3D,this.viewingCamera.matrixWorld)}if(!this.enteredScene&&r&&(this.enteredScene=!0,this.mode=0),this.avatarPOVRotator=this.avatarPOVRotator||this.avatarPOV.components["pitch-yaw-rotator"],this.viewingCameraRotator=this.viewingCameraRotator||this.viewingCamera.el.components["pitch-yaw-rotator"],this.avatarPOVRotator.on=!0,this.viewingCameraRotator.on=!0,this.userinput=this.userinput||n.systems.userinput,this.interaction=this.interaction||n.systems.interaction,this.userinput.get(zm.actions.startInspecting)&&3!==this.mode){const e=this.interaction.state.rightRemote.hovered||this.interaction.state.leftRemote.hovered;e&&this.inspect(e,1.5)}else 3===this.mode&&this.userinput.get(zm.actions.stopInspecting)&&(n.emit("uninspect"),this.uninspect());if(this.userinput.get(zm.actions.nextCameraMode)&&this.nextMode(),this.ensureListenerIsParentedCorrectly(n),0===this.mode)this.viewingCameraRotator.on=!1,this.avatarRig.object3D.updateMatrices(),Oo(this.viewingRig.object3D,this.avatarRig.object3D.matrixWorld),n.is("vr-mode")?(this.viewingCamera.updateMatrices(),Oo(this.avatarPOV.object3D,this.viewingCamera.matrixWorld)):(this.avatarPOV.object3D.updateMatrices(),Oo(this.viewingCamera,this.avatarPOV.object3D.matrixWorld));else if(1===this.mode||2===this.mode)1===this.mode?e.makeTranslation(0,1,3):e.makeTranslation(0,2,8),this.avatarRig.object3D.updateMatrices(),this.viewingRig.object3D.matrixWorld.copy(this.avatarRig.object3D.matrixWorld).multiply(e),Oo(this.viewingRig.object3D,this.viewingRig.object3D.matrixWorld),this.avatarPOV.object3D.quaternion.copy(this.viewingCamera.quaternion),this.avatarPOV.object3D.matrixNeedsUpdate=!0;else if(3===this.mode){this.avatarPOVRotator.on=!1,this.viewingCameraRotator.on=!1;const e=this.userinput.get(n.is("entered")?zm.actions.cameraDelta:zm.actions.lobbyCameraDelta);if(e){const t=(AFRAME.utils.device.isMobile()?-.6:1)*e[0]||0,n=(AFRAME.utils.device.isMobile()?-1.2:1)*e[1]||0;this.horizontalDelta=(this.horizontalDelta+t)/2,this.verticalDelta=(this.verticalDelta+n)/2}else(Math.abs(this.verticalDelta)>1e-4||Math.abs(this.horizontalDelta)>1e-4)&&(this.verticalDelta=.9*this.verticalDelta,this.horizontalDelta=.9*this.horizontalDelta);const t=.001*this.userinput.get(zm.actions.inspectZoom);t?this.inspectZoom=t+5*this.inspectZoom/6:Math.abs(this.inspectZoom)>1e-4&&(this.inspectZoom=.9*this.inspectZoom);const r=this.userinput.get(zm.actions.inspectPanY)||0;this.userinput.get(zm.actions.resetInspectView)&&lf(this.viewingRig.object3D,this.viewingCamera,this.inspectable,this.pivot,1),this.snapshot.audio&&Oo(this.snapshot.audio,this.audioSourceTargetTransform),(Math.abs(this.verticalDelta)>.001||Math.abs(this.horizontalDelta)>.001||Math.abs(this.inspectZoom)>.001||Math.abs(r)>1e-4)&&af(this.pivot,this.viewingRig.object3D,this.viewingCamera,this.horizontalDelta,this.verticalDelta,this.inspectZoom,i,r)}}}(),this.viewingCamera=e,this.lightsEnabled="true"===localStorage.getItem("show-background-while-inspecting"),this.verticalDelta=0,this.horizontalDelta=0,this.inspectZoom=0,this.mode=4,this.snapshot={audioTransform:new tf.Matrix4,matrixWorld:new tf.Matrix4},this.audioSourceTargetTransform=new tf.Matrix4,nf&&(this.viewingCamera.fov=nf),this.viewingCamera.layers.enable(_o.CAMERA_LAYER_VIDEO_TEXTURE_TARGET),this.viewingCamera.layers.enable(_o.CAMERA_LAYER_FIRST_PERSON_ONLY),this.viewingCamera.layers.enable(_o.CAMERA_LAYER_UI),this.viewingCamera.layers.enable(_o.CAMERA_LAYER_FX_MASK);const n=t.xr,i=n.updateCamera;n.updateCamera=function(e){i(e);const t=n.getCamera();t.layers.mask=e.layers.mask,t.cameras.length&&(t.cameras[0].layers.set(_o.CAMERA_LAYER_XR_LEFT_EYE),t.cameras[0].layers.mask|=e.layers.mask,t.cameras[1].layers.set(_o.CAMERA_LAYER_XR_RIGHT_EYE),t.cameras[1].layers.mask|=e.layers.mask)},L().then((()=>{this.avatarPOV=document.getElementById("avatar-pov-node"),this.avatarRig=document.getElementById("avatar-rig"),this.viewingRig=document.getElementById("viewing-rig");const e=new tf.Mesh(new tf.BoxGeometry(100,100,100),new tf.MeshBasicMaterial({color:131586,side:tf.BackSide}));e.layers.set(_o.CAMERA_LAYER_INSPECT),this.viewingRig.object3D.add(e)}))}nextMode(){3!==this.mode?rf&&4!==this.mode&&(this.mode=cf[this.mode]||0):this.uninspect()}inspect(e,t,n){void 0===n&&(n=!0);const{inspectable:i,pivot:r}=function(e){const t=function(e){let t=e;for(;t;){if(ef(t,"inspectable"))return t.object3D;t=t.parentNode}return console.warn("could not find inspectable in hierarchy"),e.object3D}(e),n=function(e){const t=e.components["inspect-pivot-child-selector"]&&e.components["inspect-pivot-child-selector"].data.selector;if(!t)return e.object3D;const n=e.querySelector(t);return n?n.object3D:(console.error(`Failed to find pivot for selector: ${t}`,e),e.object3D)}(t.el);return{inspectable:t,pivot:n}}(e);if(this.verticalDelta=0,this.horizontalDelta=0,this.inspectZoom=0,3===this.mode)return;const o=AFRAME.scenes[0];o.object3D.traverse(df),o.classList.add("hand-cursor"),o.classList.remove("no-cursor"),this.snapshot.mode=this.mode,this.mode=3,this.inspectable=i,this.pivot=r;const s=o.is("vr-mode")?o.renderer.xr.getCamera():o.camera;this.snapshot.mask=s.layers.mask,this.lightsEnabled?(s.layers.disable(_o.CAMERA_LAYER_FIRST_PERSON_ONLY),s.layers.enable(_o.CAMERA_LAYER_THIRD_PERSON_ONLY)):this.hideEverythingButThisObject(i),this.viewingCamera.updateMatrices(),this.snapshot.matrixWorld.copy(this.viewingRig.object3D.matrixWorld),this.snapshot.audio=!(i.el&&ef(i.el,"preventAudioBoost"))&&function(e){let t;return e.traverse((e=>{t||"Audio"!==e.type||(t=e)})),t}(i),this.snapshot.audio&&(this.snapshot.audio.updateMatrices(),this.snapshot.audioTransform.copy(this.snapshot.audio.matrixWorld),o.audioListener.updateMatrices(),this.audioSourceTargetTransform.makeTranslation(0,0,-.25).premultiply(o.audioListener.matrixWorld),Oo(this.snapshot.audio,this.audioSourceTargetTransform)),this.ensureListenerIsParentedCorrectly(o),lf(this.viewingRig.object3D,this.viewingCamera,this.inspectable,this.pivot,t||1),n&&o.emit("inspect-target-changed")}uninspect(e){if(void 0===e&&(e=!0),3!==this.mode)return;const t=AFRAME.scenes[0];t.is("entered")&&(t.classList.remove("hand-cursor"),t.classList.add("no-cursor")),this.showEverythingAsNormal(),this.inspectable=null,this.pivot=null,this.snapshot.audio&&(Oo(this.snapshot.audio,this.snapshot.audioTransform),this.snapshot.audio=null),this.mode=this.snapshot.mode,4===this.snapshot.mode&&Oo(this.viewingRig.object3D,this.snapshot.matrixWorld),this.snapshot.mode=null,this.tick(AFRAME.scenes[0]),e&&t.emit("inspect-target-changed")}toggleLights(){if(this.lightsEnabled=!this.lightsEnabled,localStorage.setItem("show-background-while-inspecting",this.lightsEnabled.toString()),3===this.mode&&this.inspectable)if(this.lightsEnabled){this.showEverythingAsNormal();const e=AFRAME.scenes[0],t=e.is("vr-mode")?e.renderer.xr.getCamera():e.camera;t.layers.disable(_o.CAMERA_LAYER_FIRST_PERSON_ONLY),t.layers.enable(_o.CAMERA_LAYER_THIRD_PERSON_ONLY)}else this.hideEverythingButThisObject(this.inspectable);AFRAME.scenes[0].emit("inspect-lights-changed")}ensureListenerIsParentedCorrectly(e){e.audioListener&&this.avatarPOV&&(3===this.mode&&e.audioListener.parent!==this.avatarPOV.object3D?this.avatarPOV.object3D.add(e.audioListener):0!==this.mode&&1!==this.mode&&2!==this.mode||e.audioListener.parent===this.viewingCamera||this.viewingCamera.add(e.audioListener))}hideEverythingButThisObject(e){this.notHiddenObject=e,e.traverse(hf);const t=AFRAME.scenes[0];(t.is("vr-mode")?t.renderer.xr.getCamera():t.camera).layers.set(_o.CAMERA_LAYER_INSPECT)}showEverythingAsNormal(){this.notHiddenObject&&(this.notHiddenObject.traverse(pf),this.notHiddenObject=null);const e=AFRAME.scenes[0];(e.is("vr-mode")?e.renderer.xr.getCamera():e.camera).layers.mask=this.snapshot.mask}}var ff=n(99477);function gf(){const e=up();return e?e.el.querySelector(".camera").object3D:null}function vf(e,t,n){return(1-n)*e+n*t}const bf=new ff.Quaternion;AFRAME.registerComponent("scene-preview-camera",{schema:{duration:{default:90,type:"number"},positionOnly:{default:!1,type:"boolean"}},init:function(){const e=AFRAME.scenes[0].systems["hubs-systems"]||AFRAME.scenes[0].systems["scene-systems"];e&&e.scenePreviewCameraSystem.register(this.el),this.startPoint=this.el.object3D.position.clone(),this.startRotation=this.el.object3D.quaternion.clone(),this.targetPoint=this.el.object3D.position.clone(),this.targetPoint.y=Math.max(this.targetPoint.y-1.5,1),this.targetPoint.add(new ff.Vector3(2,0,-2));const t=new ff.Euler(-.15,0,.15);this.targetRotation=new ff.Quaternion,this.targetRotation.setFromEuler(t),this.targetRotation.premultiply(this.startRotation),this.startTime=performance.now(),this.backwards=!1,this.ranOnePass=!1},tick2:function(){const e=this.el.sceneEl.systems["hubs-systems"];let t;if(e&&(e.cameraSystem.mode=4,t=gf()),t)Oo(this.el.object3D,t.matrixWorld),this.el.object3D.translateZ(-.1),this.el.object3D.matrixNeedsUpdate=!0;else{let e=(performance.now()-this.startTime)/(1e3*this.data.duration);e=Math.min(1,Math.max(0,e)),this.ranOnePass?e=e<.5?2*e*e:(4-2*e)*e-1:e*=2-e;const t=this.backwards?this.targetPoint:this.startPoint,n=this.backwards?this.startPoint:this.targetPoint,i=this.backwards?this.targetRotation:this.startRotation,r=this.backwards?this.startRotation:this.targetRotation;bf.slerpQuaternions(i,r,e),this.el.object3D.position.set(vf(t.x,n.x,e),vf(t.y,n.y,e),vf(t.z,n.z,e)),this.data.positionOnly||this.el.object3D.rotation.setFromQuaternion(bf),this.el.object3D.matrixNeedsUpdate=!0,e>=.9999&&(this.ranOnePass=!0,this.backwards=!this.backwards,this.startTime=performance.now())}},remove:function(){var e,t;const n=(null===(e=AFRAME.scenes[0])||void 0===e?void 0:e.systems["hubs-systems"])||(null===(t=AFRAME.scenes[0])||void 0===t?void 0:t.systems["scene-systems"]);n&&n.scenePreviewCameraSystem.unregister(this.el)}}),n(66210),AFRAME.registerComponent("floaty-object",{schema:{modifyGravityOnRelease:{default:!1},releaseGravity:{default:-2},reduceAngularFloat:{default:!1},unthrowable:{default:!1}},init(){(0,Ot.addComponent)(APP.world,Un,this.el.object3D.eid)},update(){Un.flags[this.el.eid]=(this.data.modifyGravityOnRelease&&Ou)|(this.data.reduceAngularFloat&&Tu)|(this.data.unthrowable&&Ru),Un.releaseGravity[this.el.eid]=this.data.releaseGravity}});var yf=n(99477);function wf(e,t,n,i,r,o,s){try{var a=e[o](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(i,r)}AFRAME.registerComponent("super-spawner",{schema:{src:{default:""},resolve:{default:!1},template:{default:""},spawnScale:{type:"vec3",default:{x:NaN,y:NaN,z:NaN}},spawnCooldown:{default:1},spawnEvent:{type:"string"},animateFromCursor:{type:"boolean"},mediaOptions:{default:{},parse:e=>"object"==typeof e?e:JSON.parse(e),stringify:JSON.stringify}},init(){this.cooldownTimeout=null,this.handPosition=new yf.Vector3,this.onSpawnEvent=this.onSpawnEvent.bind(this),this.sceneEl=this.el.sceneEl,this.tempSpawnHandPosition=new yf.Vector3,this.handleMediaLoaded=this.handleMediaLoaded.bind(this),this.spawnedMediaScale=null},play(){this.el.addEventListener("media-loaded",this.handleMediaLoaded),this.data.spawnEvent&&this.el.sceneEl.addEventListener(this.data.spawnEvent,this.onSpawnEvent)},pause(){this.el.removeEventListener("media-loaded",this.handleMediaLoaded),this.data.spawnEvent&&this.el.sceneEl.removeEventListener(this.data.spawnEvent,this.onSpawnEvent),this.cooldownTimeout&&(clearTimeout(this.cooldownTimeout),this.cooldownTimeout=null,this.el.setAttribute("visible",!0),this.el.classList.add("interactable"))},handleMediaLoaded(e){const t=e.target;var n,i;this.spawnedMediaScale=t.object3D.scale.clone(),n=this.spawnedMediaScale,i=this.data.spawnScale,n.set(null===i.x?n.x:i.x,null===i.y?n.y:i.y,null===i.z?n.z:i.z);const r=Lp(t.components["media-image"]||t.components["media-video"]||t.components["media-pdf"]?1:.5,jp(t,t.object3D));this.spawnedMediaScale.divideScalar(r)},onSpawnEvent(e){var t,n=this;return(t=function*(){if(n.cooldownTimeout||!n.el.sceneEl.is("entered"))return;const t=Nl(n.data.src,n.data.template,sl,null,n.data.resolve,!1,{x:null===n.data.spawnScale.x?1:n.data.spawnScale.x,y:null===n.data.spawnScale.y?1:n.data.spawnScale.y,z:null===n.data.spawnScale.z?1:n.data.spawnScale.z},n.data.mediaOptions).entity,i=n.el.sceneEl.systems.interaction;if(!i.ready)return;const r=e.detail&&e.detail.object3D||i.options.rightRemote.entity.object3D,o=-1===r.el.id.indexOf("right"),s=o?i.options.leftHand.entity.object3D:i.options.rightHand.entity.object3D;r.getWorldPosition(t.object3D.position),r.getWorldQuaternion(t.object3D.quaternion),t.object3D.matrixNeedsUpdate=!0,n.el.emit("spawned-entity-created",{target:t});const a=AFRAME.scenes[0].systems.userinput,l=n.data.animateFromCursor&&(a.get(zm.actions.rightHand.matrix)||a.get(zm.actions.leftHand.matrix));n.activateCooldown(),yield j("model-loaded",t),r.getWorldPosition(t.object3D.position),r.getWorldQuaternion(t.object3D.quaternion),t.object3D.matrixNeedsUpdate=!0,l?(s.getWorldPosition(n.handPosition),t.setAttribute("animation__spawn-at-cursor",{property:"position",delay:500,dur:1500,from:{x:t.object3D.position.x,y:t.object3D.position.y,z:t.object3D.position.z},to:{x:n.handPosition.x,y:n.handPosition.y,z:n.handPosition.z},easing:"easeInOutBack"})):((0,Ot.addComponent)(APP.world,fn,t.eid),o?(0,Ot.addComponent)(APP.world,mn,t.eid):(0,Ot.addComponent)(APP.world,pn,t.eid)),n.el.sceneEl.systems["hubs-systems"]&&n.el.sceneEl.systems["hubs-systems"].physicsSystem.resetDynamicBody(t.components["body-helper"].uuid),t.addEventListener("media-loaded",(()=>{n.el.emit("spawned-entity-loaded",{target:t})}),{once:!0})},function(){var e=this,n=arguments;return new Promise((function(i,r){var o=t.apply(e,n);function s(e){wf(o,i,r,s,a,"next",e)}function a(e){wf(o,i,r,s,a,"throw",e)}s(void 0)}))})()},activateCooldown(){if(this.data.spawnCooldown>0){const[e,t,n]=[this.el.object3D.scale.x,this.el.object3D.scale.y,this.el.object3D.scale.z];this.el.setAttribute("visible",!1),this.el.object3D.scale.set(.001,.001,.001),this.el.object3D.matrixNeedsUpdate=!0,this.el.classList.remove("interactable"),this.el.setAttribute("body-helper",{collisionFilterMask:Ue.NONE}),this.cooldownTimeout=setTimeout((()=>{this.el.setAttribute("visible",!0),this.el.classList.add("interactable"),this.el.setAttribute("body-helper",{collisionFilterMask:Ue.DEFAULT_SPAWNER}),this.el.removeAttribute("animation__spawner-cooldown"),this.el.setAttribute("animation__spawner-cooldown",{property:"scale",delay:50,dur:350,from:{x:.001,y:.001,z:.001},to:{x:e,y:t,z:n},easing:"easeOutElastic"}),setTimeout((()=>{this.cooldownTimeout=null}),400)}),1e3*this.data.spawnCooldown)}}}),n(15335);var _f=n(99477);function Ef(e,t,n,i,r,o,s){try{var a=e[o](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(i,r)}function Af(e,t){_f.Mesh.call(this,e);const n=void 0!==(t=t||{}).time?t.time:0,i=void 0!==t.waterNormals?t.waterNormals:null,r=void 0!==t.sunDirection?t.sunDirection:new _f.Vector3(.70707,.70707,0),o=new _f.Color(void 0!==t.sunColor?t.sunColor:16777215),s=new _f.Color(void 0!==t.waterColor?t.waterColor:8355711),a=void 0!==t.eye?t.eye:new _f.Vector3(0,0,0),l=void 0!==t.distortionScale?t.distortionScale:20,c=void 0!==t.side?t.side:_f.FrontSide,d=void 0!==t.fog&&t.fog,u={uniforms:_f.UniformsUtils.merge([_f.UniformsLib.lights,{normalSampler:{value:null},time:{value:0},size:{value:1},distortionScale:{value:20},sunColor:{value:new _f.Color(8355711)},sunDirection:{value:new _f.Vector3(.70707,.70707,0)},eye:{value:new _f.Vector3},waterColor:{value:new _f.Color(5592405)}}]),vertexShader:"\n      uniform float time;\n      varying vec4 worldPosition;\n\n      void main() {\n      \tworldPosition = modelMatrix * vec4( position, 1.0 );\n      \tvec4 mvPosition =  modelViewMatrix * vec4( position, 1.0 );\n      \tgl_Position = projectionMatrix * mvPosition;\n\n      }\n    ",fragmentShader:`\n      uniform float time;\n      uniform float size;\n      uniform float distortionScale;\n      uniform sampler2D normalSampler;\n      uniform vec3 sunColor;\n      uniform vec3 sunDirection;\n      uniform vec3 eye;\n      uniform vec3 waterColor;\n\n      varying vec4 worldPosition;\n\n      vec4 getNoise( vec2 uv ) {\n      \tvec2 uv0 = ( uv / 103.0 ) + vec2(time / 17.0, time / 29.0);\n      \tvec2 uv1 = uv / 107.0-vec2( time / -19.0, time / 31.0 );\n      \tvec2 uv2 = uv / vec2( 8907.0, 9803.0 ) + vec2( time / 101.0, time / 97.0 );\n      \tvec2 uv3 = uv / vec2( 1091.0, 1027.0 ) - vec2( time / 109.0, time / -113.0 );\n      \tvec4 noise = texture2D( normalSampler, uv0 ) +\n      \t\ttexture2D( normalSampler, uv1 ) +\n      \t\ttexture2D( normalSampler, uv2 ) +\n      \t\ttexture2D( normalSampler, uv3 );\n      \treturn noise * 0.5 - 1.0;\n      }\n\n      void sunLight( const vec3 surfaceNormal, const vec3 eyeDirection, float shiny, float spec, float diffuse, inout vec3 diffuseColor, inout vec3 specularColor ) {\n      \tvec3 reflection = normalize( reflect( -sunDirection, surfaceNormal ) );\n      \tfloat direction = max( 0.0, dot( eyeDirection, reflection ) );\n      \tspecularColor += pow( direction, shiny ) * sunColor * spec;\n      \tdiffuseColor += max( dot( sunDirection, surfaceNormal ), 0.0 ) * sunColor * diffuse;\n      }\n\n      ${_f.ShaderChunk.common}\n      ${_f.ShaderChunk.packing}\n      ${_f.ShaderChunk.bsdfs}\n      ${_f.ShaderChunk.lights_pars_begin}\n\n      void main() {\n      \tvec4 noise = getNoise( worldPosition.xz * size );\n      \tvec3 surfaceNormal = normalize( noise.xzy * vec3( 1.5, 1.0, 1.5 ) );\n\n      \tvec3 diffuseLight = vec3(0.0);\n      \tvec3 specularLight = vec3(0.0);\n\n      \tvec3 worldToEye = eye-worldPosition.xyz;\n      \tvec3 eyeDirection = normalize( worldToEye );\n      \tsunLight( surfaceNormal, eyeDirection, 100.0, 2.0, 0.5, diffuseLight, specularLight );\n\n      \tfloat theta = max( dot( eyeDirection, surfaceNormal ), 0.0 );\n      \tfloat rf0 = 0.3;\n      \tfloat reflectance = rf0 + ( 1.0 - rf0 ) * pow( ( 1.0 - theta ), 5.0 );\n      \tvec3 scatter = max( 0.0, dot( surfaceNormal, eyeDirection ) ) * waterColor;\n      \tvec3 albedo = mix( ( sunColor * diffuseLight * 0.3 + scatter ), ( 0.5 + specularLight ), reflectance);\n      \tvec3 outgoingLight = albedo;\n      \tgl_FragColor = vec4( outgoingLight, 1 );\n      }\n    `},h=new _f.ShaderMaterial({fragmentShader:u.fragmentShader,vertexShader:u.vertexShader,uniforms:_f.UniformsUtils.clone(u.uniforms),transparent:!1,lights:!0,side:c,fog:d});h.uniforms.time.value=n,h.uniforms.normalSampler.value=i,h.uniforms.sunColor.value=o,h.uniforms.waterColor.value=s,h.uniforms.sunDirection.value=r,h.uniforms.distortionScale.value=l,h.uniforms.eye.value=a,this.material=h}function Sf(){var e;return e=function*(e){const t=yield new Promise(((t,n)=>(new Ds).load(e,t,void 0,n)));return t.wrapS=t.wrapT=_f.RepeatWrapping,t.needsUpdate=!0,t},Sf=function(){var t=this,n=arguments;return new Promise((function(i,r){var o=e.apply(t,n);function s(e){Ef(o,i,r,s,a,"next",e)}function a(e){Ef(o,i,r,s,a,"throw",e)}s(void 0)}))},Sf.apply(this,arguments)}function xf(e,t){return e&&t&&e.x===t.x&&e.y===t.y}function Mf(e,t,n,i,r,o,s){try{var a=e[o](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(i,r)}Af.prototype=Object.create(_f.Mesh.prototype),Af.prototype.constructor=_f.Water,AFRAME.registerComponent("water",{schema:{waterColor:{type:"color",default:"#001e0f"},distortionScale:{type:"number",default:3.7},sunColor:{type:"color",default:"#ffffff"},inclination:{type:"number",default:0},azimuth:{type:"number",default:0},distance:{type:"number",default:1},speed:{type:"number",default:.1},forceMobile:{type:"boolean",default:!1}},init(){const e=this.el.getObject3D("mesh"),t=e.geometry;e.visible=!1,function(e){return Sf.apply(this,arguments)}(qu).then((e=>{const n={textureWidth:512,textureHeight:512,waterNormals:e,sunDirection:this.data.sunDirection,sunColor:new _f.Color(this.data.sunColor),waterColor:new _f.Color(this.data.waterColor),distortionScale:this.data.distortionScale,fog:!1};AFRAME.utils.device.isMobile()||AFRAME.utils.device.isMobileVR()||this.data.forceMobile?this.water=new Af(t,n):(this.water=new _f.Water(t,n),this.water.mirrorCamera.layers.set(_o.CAMERA_LAYER_REFLECTION)),this.el.setObject3D("water",this.water)}))},update(e){if(this.data.forceMobile!==e.forceMobile)return this.el.removeObject3D("water"),void this.init();if(!this.water)return;const t=this.water.material.uniforms;if(this.data.waterColor!==e.waterColor&&t.waterColor.value.setStyle(this.data.waterColor),this.data.distortionScale!==e.distortionScale&&(t.distortionScale.value=this.data.distortionScale),this.data.sunColor!==e.sunColor&&t.sunColor.value.setStyle(this.data.sunColor),this.data.inclination!==e.inclination||this.data.azimuth!==e.azimuth||this.data.distance!==e.distance){const e=Math.PI*(this.data.inclination-.5),n=2*Math.PI*(this.data.azimuth-.5),i=this.data.distance,r=i*Math.cos(n),o=i*Math.sin(n)*Math.sin(e),s=i*Math.sin(n)*Math.cos(e);t.sunDirection.value.set(r,o,s)}},tick(e){this.water&&(this.water.material.uniforms.time.value=e/1e3*this.data.speed)},remove(){this.el.removeObject3D("water"),this.el.getObject3D("mesh").visible=!0}}),AFRAME.registerComponent("simple-water",{schema:{opacity:{type:"number",default:1},color:{type:"color"},tideHeight:{type:"number",default:.01},tideScale:{type:"vec2",default:{x:1,y:1}},tideSpeed:{type:"vec2",default:{x:.5,y:.5}},waveHeight:{type:"number",default:.1},waveScale:{type:"vec2",default:{x:1,y:20}},waveSpeed:{type:"vec2",default:{x:.05,y:6}},ripplesScale:{type:"number",default:1},ripplesSpeed:{type:"number",default:.25}},init(){const e="high"!==APP.store.state.preferences.materialQualitySetting;this.water=new Yu({lowQuality:e}),this.el.setObject3D("mesh",this.water)},update(e){this.data.opacity!==e.opacity&&(this.water.opacity=this.data.opacity),this.data.color!==e.color&&this.water.color.set(this.data.color),this.data.tideHeight!==e.tideHeight&&(this.water.tideHeight=this.data.tideHeight),xf(this.data.tideScale,e.tideScale)||this.water.tideScale.copy(this.data.tideScale),xf(this.data.tideSpeed,e.tideSpeed)||this.water.tideSpeed.copy(this.data.tideSpeed),this.data.waveHeight!==e.waveHeight&&(this.water.waveHeight=this.data.waveHeight),xf(this.data.waveScale,e.waveScale)||this.water.waveScale.copy(this.data.waveScale),xf(this.data.waveSpeed,e.waveSpeed)||this.water.waveSpeed.copy(this.data.waveSpeed),this.data.ripplesScale!==e.ripplesScale&&(this.water.ripplesScale=this.data.ripplesScale),this.data.ripplesSpeed!==e.ripplesSpeed&&(this.water.ripplesSpeed=this.data.ripplesSpeed)},tick(e){this.water.update(e/1e3)},remove(){const e=this.el.getObject3D("mesh");e.geometry.dispose(),e.material.dispose(),this.el.removeObject3D("mesh")}}),n(14208),n(51337);const Pf=new URL(th,window.location.href).href;AFRAME.registerComponent("particle-emitter",{schema:{resolve:{type:"boolean",default:!0},src:{type:"string",default:Pf},startColor:{type:"color"},middleColor:{type:"color"},endColor:{type:"color"},startOpacity:{type:"number",default:1},middleOpacity:{type:"number",default:1},endOpacity:{type:"number",default:1},colorCurve:{type:"string",default:"linear"},sizeCurve:{type:"string",default:"linear"},startSize:{type:"number",default:1},endSize:{type:"number",default:1},sizeRandomness:{type:"number"},ageRandomness:{type:"number"},lifetime:{type:"number",default:1},lifetimeRandomness:{type:"number"},particleCount:{type:"number",default:10},startVelocity:{type:"vec3",default:{x:0,y:0,z:1}},endVelocity:{type:"vec3",default:{x:0,y:0,z:1}},velocityCurve:{type:"string",default:"linear"},angularVelocity:{type:"number"}},init(){this.particleEmitter=new nh.Vo(null),this.particleEmitter.visible=!1,this.el.setObject3D("particle-emitter",this.particleEmitter),this.updateParticles=!1,this.data.src===Pf&&(this.data.resolve=!1)},setTexture(e,t){var n,i=this;return(n=function*(){let n=e;if(t){let t=(yield jl(e)).origin;t.startsWith("//")&&(t=location.protocol+t),n=zs(t)}const r=yield zl.loadAsync(n);i.data.src===e&&(i.particleEmitter.material.uniforms.map.value=r,i.particleEmitter.visible=!0,i.updateParticles=!0)},function(){var e=this,t=arguments;return new Promise((function(i,r){var o=n.apply(e,t);function s(e){Mf(o,i,r,s,a,"next",e)}function a(e){Mf(o,i,r,s,a,"throw",e)}s(void 0)}))})()},remove(){Mo(this.particleEmitter)},update(e){const t=this.data,n=this.particleEmitter;e.src!==t.src&&this.setTexture(t.src,t.resolve).catch(console.error),e.startColor===t.startColor&&e.startSize===t.startSize&&e.sizeRandomness===t.sizeRandomness&&e.ageRandomness===t.ageRandomness&&e.lifetime===t.lifetime&&e.lifetimeRandomness===t.lifetimeRandomness&&e.particleCount===t.particleCount||(this.updateParticles=!0),n.startColor.set(t.startColor),n.middleColor.set(t.middleColor),n.endColor.set(t.endColor),n.startOpacity=t.startOpacity,n.middleOpacity=t.middleOpacity,n.endOpacity=t.endOpacity,n.colorCurve=t.colorCurve,n.sizeCurve=t.sizeCurve,n.startSize=t.startSize,n.endSize=t.endSize,n.sizeRandomness=t.sizeRandomness,n.ageRandomness=t.ageRandomness,n.lifetime=t.lifetime,n.lifetimeRandomness=t.lifetimeRandomness,n.particleCount=t.particleCount,n.startVelocity.copy(t.startVelocity),n.endVelocity.copy(t.endVelocity),n.velocityCurve=t.velocityCurve,n.angularVelocity=t.angularVelocity},tick(e,t){this.updateParticles&&(this.particleEmitter.updateParticles(),this.updateParticles=!1),this.particleEmitter.visible&&this.particleEmitter.update(t/1e3)}}),n(71010);var Cf=n(99477);AFRAME.registerComponent("audio-zone-source",{init(){var e;this.originalAudioParamsData=null,null===(e=this.el.sceneEl.systems["hubs-systems"])||void 0===e||e.audioZonesSystem.registerSource(this)},remove(){var e;APP.zoneOverrides.delete(this.el),null===(e=this.el.sceneEl.systems["hubs-systems"])||void 0===e||e.audioZonesSystem.unregisterSource(this)},getPosition:(()=>{const e=new Cf.Vector3;return function(){const t=APP.audios.get(this.el);return t?t.getWorldPosition(e):e.set(0,0,0),e}})(),apply(e){APP.zoneOverrides.set(this.el,e);const t=APP.audios.get(this.el);t&&rm(this.el,t)},restore(){APP.zoneOverrides.delete(this.el);const e=APP.audios.get(this.el);e&&rm(this.el,e)}});var kf=n(99477);Ga.xv.prototype.isTroikaText=!0;const Of={front:kf.FrontSide,back:kf.BackSide,double:kf.DoubleSide};function Tf(e){return{default:e,parse:function(e){return"string"==typeof e&&e.indexOf("%")>0?e:(e=+e,isNaN(e)?0:e)},stringify:function(e){return""+e}}}AFRAME.registerComponent("text",{schema:{textAlign:{type:"string",default:"left",oneOf:["left","right","center","justify"]},anchorX:{default:"center",oneOf:["left","right","center"]},anchorY:{default:"middle",oneOf:["top","top-baseline","middle","bottom-baseline","bottom"]},clipRect:{type:"string",default:"",parse:function(e){return e&&(e=e.split(/[\s,]+/).reduce((function(e,t){return t=+t,isNaN(t)||e.push(t),e}),[])),e&&4===e.length?e:null},stringify:function(e){return e?e.join(" "):""}},color:{type:"color",default:"#FFF"},curveRadius:{type:"number",default:0},depthOffset:{type:"number",default:0},direction:{type:"string",default:"auto",oneOf:["auto","ltr","rtl"]},fillOpacity:{type:"number",default:1},fontUrl:{type:"string"},fontSize:{type:"number",default:.075},letterSpacing:{type:"number",default:0},lineHeight:{type:"number"},maxWidth:{type:"number",default:1/0},outlineBlur:Tf(0),outlineColor:{type:"color",default:"#000"},outlineOffsetX:Tf(0),outlineOffsetY:Tf(0),outlineOpacity:{type:"number",default:1},outlineWidth:Tf(0),overflowWrap:{type:"string",default:"normal",oneOf:["normal","break-word"]},strokeColor:{type:"color",default:"grey"},strokeOpacity:{type:"number",default:1},strokeWidth:Tf(0),value:{type:"string",default:""},textIndent:{type:"number",default:0},whiteSpace:{default:"normal",oneOf:["normal","nowrap"]},opacity:{type:"number",default:1},side:{default:"front",oneOf:["front","back","double"]}},init:function(){this.troikaTextMesh=new Ga.xv,this.troikaTextMesh.material.toneMapped=!1,this.el.setObject3D("text",this.troikaTextMesh)},update:function(){const e=this.data,t=this.troikaTextMesh;t.text=e.value||"",t.textAlign=e.textAlign,t.anchorX=e.anchorX,t.anchorY=e.anchorY,t.color=e.color,t.material.side=Of[e.side],t.material.opacity=e.opacity,t.curveRadius=e.curveRadius,t.depthOffset=e.depthOffset||0,t.direction=e.direction,t.fillOpacity=e.fillOpacity,t.font=e.fontUrl,t.fontSize=e.fontSize,t.letterSpacing=e.letterSpacing||0,t.clipRect=e.clipRect,t.lineHeight=e.lineHeight||"normal",t.outlineBlur=e.outlineBlur,t.outlineColor=e.outlineColor,t.outlineOffsetX=e.outlineOffsetX,t.outlineOffsetY=e.outlineOffsetY,t.outlineOpacity=e.outlineOpacity,t.outlineWidth=e.outlineWidth,t.overflowWrap=e.overflowWrap,t.strokeColor=e.strokeColor,t.strokeOpacity=e.strokeOpacity,t.strokeWidth=e.strokeWidth,t.textIndent=e.textIndent,t.whiteSpace=e.whiteSpace,t.maxWidth=e.maxWidth,t.sync((()=>{this.el.emit("text-updated",this)}))},remove:function(){this.troikaTextMesh.dispose()},getSize:function(){const e=new kf.Vector3;return function(t){this.troikaTextMesh.geometry.boundingBox.getSize(e),t.set(e.x*this.troikaTextMesh.scale.x,e.y*this.troikaTextMesh.scale.y,e.z*this.troikaTextMesh.scale.z)}}()}),n(88667),n(69318);const Rf=function(e,t,n){if(e&&e.length)for(const i of e)t.length&&t.forEach((e=>{i.addEventListener(e,n)}))},Df=function(e,t,n){if(e&&e.length)for(const i of e)t.length&&t.forEach((e=>{i.removeEventListener(e,n)}))};AFRAME.registerComponent("mute-mic",{schema:{eventSrc:{type:"selectorAll"},toggleEvents:{type:"array"},muteEvents:{type:"array"},unmuteEvents:{type:"array"}},init:function(){this.onToggle=this.onToggle.bind(this),this.onMute=this.onMute.bind(this),this.onUnmute=this.onUnmute.bind(this)},play:function(){const{eventSrc:e,toggleEvents:t,muteEvents:n,unmuteEvents:i}=this.data;Rf(e,t,this.onToggle),Rf(e,n,this.onMute),Rf(e,i,this.onUnmute)},pause:function(){const{eventSrc:e,toggleEvents:t,muteEvents:n,unmuteEvents:i}=this.data;Df(e,t,this.onToggle),Df(e,n,this.onMute),Df(e,i,this.onUnmute)},onToggle:function(){APP.mediaDevicesManager.toggleMic(),this.el.sceneEl.is("entered")&&this.el.sceneEl.systems["hubs-systems"].soundEffectsSystem.playSoundOneShot(pm)},onMute:function(){APP.mediaDevicesManager.micEnabled=!1},onUnmute:function(){APP.mediaDevicesManager.micEnabled=!0}}),n(80040);const jf=1e-8,Lf=[];class If{tick(){for(let e=0;e<Lf.length;e++){const t=Lf[e],n=t.el.object3D,{visible:i,scale:r}=n,{updateWhileInvisible:o}=t.data;(i!==t.lastVisible||o)&&(!i||1===r.x&&1===r.y&&1===r.z?i||r.x===jf&&r.y===jf&&r.z===jf||(r.setScalar(jf),n.matrixNeedsUpdate=!0):(r.setScalar(1),n.matrixNeedsUpdate=!0),o&&n.matrixNeedsUpdate&&n.updateMatrixWorld(!0,!0)),t.lastVisible=i}}updateMatrices(){for(let e=0;e<Lf.length;e++){const t=Lf[e].el.object3D;t.matrixNeedsUpdate&&t.updateMatrixWorld()}}}AFRAME.registerComponent("bone-visibility",{schema:{updateWhileInvisible:{type:"boolean",default:!1}},play(){Lf.push(this)},pause(){Lf.splice(Lf.indexOf(this),1)}}),n(35053),AFRAME.registerComponent("in-world-hud",{init(){this.mic=this.el.querySelector(".mic"),this.spawn=this.el.querySelector(".spawn"),this.pen=this.el.querySelector(".penhud"),this.cameraBtn=this.el.querySelector(".camera-btn"),this.inviteBtn=this.el.querySelector(".invite-btn"),this.background=this.el.querySelector(".bg"),this.onMicStateChanged=()=>{this.mic.setAttribute("mic-button","active",APP.dialog.isMicEnabled)},APP.dialog.on("mic-state-changed",this.onMicStateChanged),this.updateButtonStates=()=>{this.mic.setAttribute("mic-button","active",APP.dialog.isMicEnabled),this.pen.setAttribute("icon-button","active",this.el.sceneEl.is("pen")),this.cameraBtn.setAttribute("icon-button","active",this.el.sceneEl.is("camera")),window.APP.hubChannel&&(this.spawn.setAttribute("icon-button","disabled",!window.APP.hubChannel.can("spawn_and_move_media")),this.pen.setAttribute("icon-button","disabled",!window.APP.hubChannel.can("spawn_drawing")),this.cameraBtn.setAttribute("icon-button","disabled",!window.APP.hubChannel.can("spawn_camera")))},this.onStateChange=e=>{"frozen"!==e.detail&&"pen"!==e.detail&&"camera"!==e.detail||this.updateButtonStates()},this.onMicClick=()=>{APP.mediaDevicesManager.toggleMic()},this.onSpawnClick=()=>{window.APP.hubChannel.can("spawn_and_move_media")&&this.el.emit("action_spawn")},this.onPenClick=e=>{window.APP.hubChannel.can("spawn_drawing")&&(this.el.emit("spawn_pen",{object3D:e.object3D}),this.el.sceneEl.systems["hubs-systems"].soundEffectsSystem.playSoundOneShot(ym))},this.onCameraClick=()=>{window.APP.hubChannel.can("spawn_camera")&&this.el.emit("action_toggle_camera")},this.onInviteClick=()=>{this.el.emit("action_invite")},this.onHubUpdated=e=>{this.inviteBtn.object3D.visible="invite"!==e.detail.hub.entry_mode}},play(){this.el.sceneEl.addEventListener("stateadded",this.onStateChange),this.el.sceneEl.addEventListener("stateremoved",this.onStateChange),this.el.sceneEl.systems.permissions.onPermissionsUpdated(this.updateButtonStates),this.el.sceneEl.addEventListener("hub_updated",this.onHubUpdated),this.updateButtonStates(),this.mic.object3D.addEventListener("interact",this.onMicClick),this.spawn.object3D.addEventListener("interact",this.onSpawnClick),this.pen.object3D.addEventListener("interact",this.onPenClick),this.cameraBtn.object3D.addEventListener("interact",this.onCameraClick),this.inviteBtn.object3D.addEventListener("interact",this.onInviteClick)},pause(){this.el.sceneEl.removeEventListener("stateadded",this.onStateChange),this.el.sceneEl.removeEventListener("stateremoved",this.onStateChange),window.APP.hubChannel.removeEventListener("permissions_updated",this.updateButtonStates),this.el.sceneEl.removeEventListener("hub_updated",this.onHubUpdated),this.mic.object3D.removeEventListener("interact",this.onMicClick),this.spawn.object3D.removeEventListener("interact",this.onSpawnClick),this.pen.object3D.removeEventListener("interact",this.onPenClick),this.cameraBtn.object3D.removeEventListener("interact",this.onCameraClick),this.inviteBtn.object3D.removeEventListener("interact",this.onInviteClick)}});var Nf=n.p+"assets/images/emojis/emoji_0-ea438f6c80ed98bd6ce4..png",Ff=n.p+"assets/images/emojis/emoji_1-a2a3def1cbe7b1cab6b4..png",Bf=n.p+"assets/images/emojis/emoji_2-22a6538c405a142e5f09..png",Vf=n.p+"assets/images/emojis/emoji_3-79b826f8c604368bf598..png",Uf=n.p+"assets/images/emojis/emoji_4-0945a7b12c8afde9fa53..png",Hf=n.p+"assets/images/emojis/emoji_5-163760db6e6ed6ac410b..png",zf=n.p+"assets/images/emojis/emoji_6-b2dc349dc9efc5c2f4d4..png",Wf=n.p+"assets/models/emojis/emoji_0-82cb7fa66d0085cdce3e..glb",qf=n.p+"assets/models/emojis/emoji_1-6de09cde8060041a13a3..glb",Zf=n.p+"assets/models/emojis/emoji_2-388a5dcc6abbd8af65dd..glb",Gf=n.p+"assets/models/emojis/emoji_3-d91cafdae2cc873ad6bd..glb",Yf=n.p+"assets/models/emojis/emoji_4-811adc7ad88f8c492d23..glb",Qf=n.p+"assets/models/emojis/emoji_5-adbeb125f7965080497d..glb",Xf=n.p+"assets/models/emojis/emoji_6-100384d004c018ecd702..glb";const Kf=["model","particle"];function $f(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function Jf(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?$f(Object(n),!0).forEach((function(t){eg(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$f(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function eg(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const tg=[{id:"smile",model:Wf,particle:Nf},{id:"laugh",model:qf,particle:Ff},{id:"clap",model:Zf,particle:Bf},{id:"heart",model:Gf,particle:Vf},{id:"wave",model:Yf,particle:Uf},{id:"angry",model:Qf,particle:Hf},{id:"cry",model:Xf,particle:zf}].map((e=>{let{model:t,particle:n}=e;return Jf(Jf({},function(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}(e,Kf)),{},{model:new URL(t,window.location).href,particleEmitterConfig:{src:new URL(n,window.location).href,resolve:!1,particleCount:20,startSize:.01,endSize:.2,sizeRandomness:.05,lifetime:1,lifetimeRandomness:.2,ageRandomness:1,startVelocity:{x:0,y:1,z:0},endVelocity:{x:0,y:.25,z:0},startOpacity:1,middleOpacity:1,endOpacity:0}})}));function ng(e){let{model:t,particleEmitterConfig:n}=e;const{entity:i}=Nl(t,"#interactable-emoji");i.setAttribute("offset-relative-to",{target:"#avatar-pov-node",offset:{x:0,y:0,z:-1.5}}),i.addEventListener("model-loaded",(()=>{i.querySelector(".particle-emitter").setAttribute("particle-emitter",n),i.setAttribute("emoji",{particleEmitterConfig:n})}))}AFRAME.registerComponent("emoji",{schema:{emitDecayTime:{default:1.5},emitFadeTime:{default:.5},emitEndTime:{default:0},particleEmitterConfig:{default:null,parse:e=>"object"==typeof e?e:JSON.parse(e),stringify:JSON.stringify}},init(){this.data.emitEndTime=performance.now()+1e3*this.data.emitDecayTime,this.physicsSystem=this.el.sceneEl.systems["hubs-systems"].physicsSystem},play(){const e=this.el.components["media-loader"];-1!==tg.find((t=>t.model!==e.data.src))?(this.el.sceneEl.systems["hubs-systems"].soundEffectsSystem.playPositionalSoundFollowing(Rm,this.el.object3D),this.particleEmitter=this.el.querySelector(".particle-emitter")):this.el.parentNode.removeChild(this.el)},update(){!this.particleConfig&&this.data.particleEmitterConfig&&(this.particleConfig=Object.assign({},this.data.particleEmitterConfig),this.originalParticleCount=this.particleConfig.particleCount)},tick(){const e=this.el.components.networked.initialized&&this.el.components.networked.isMine();if(this.particleConfig&&e){const e=performance.now();this.el.sceneEl.systems.interaction.isHeld(this.el)&&(this.data.emitEndTime=e+1e3*this.data.emitDecayTime);const t=1e3*this.data.emitFadeTime;if(e<this.data.emitEndTime&&this.particleConfig.startOpacity<1)this.particleConfig.particleCount=this.originalParticleCount,this.particleConfig.startOpacity=1,this.particleConfig.middleOpacity=1,this.particleEmitter.setAttribute("particle-emitter",this.particleConfig,!0);else if(e>=this.data.emitEndTime&&this.particleConfig.startOpacity>.001){const n=1-Math.min(e-this.data.emitEndTime,t)/t,i=n<.001&&this.particleConfig.particleCount>0?0:this.originalParticleCount;this.particleConfig.particleCount=i,this.particleConfig.startOpacity=n,this.particleConfig.middleOpacity=n,this.particleEmitter.setAttribute("particle-emitter",this.particleConfig,!0)}}}});var ig=n(99477);function rg(e,t,n,i,r){const o=1&e?-1:1;r.y=0,t%2==0?(r.x=(i/2+n/2+Math.floor(e/2)*(n+i))*o,r.z=Math.floor(e/2)*n/2):0!==e&&(r.x=(n+i)*Math.floor((e+1)/2)*-o,r.z=Math.floor((e+1)/2)*n/2)}AFRAME.registerComponent("emoji-hud",{schema:{spawnerScale:{default:.1},spawnedScale:{default:.5},camera:{type:"selector",default:"#avatar-pov-node"},hudAngle:{default:-.5},minHudAngle:{default:-.2},maxHudAngle:{default:.7},hudDistance:{default:.4},spawnerPlatformWidth:{default:.0625},spawnerPlatformSpacing:{default:.021}},init:(()=>{const e=new ig.Vector3,t=new ig.Vector3;return function(){this._onFrozen=this._onFrozen.bind(this),this._onThaw=this._onThaw.bind(this);const n=this.data.spawnerPlatformWidth,i=this.data.spawnerPlatformSpacing;this.spawnerEntities=[];for(let r=0;r<tg.length;r++){const o=document.createElement("a-entity");o.setAttribute("media-loader",{src:tg[r].model}),o.setAttribute("hoverable-visuals",""),o.setAttribute("scale",{x:this.data.spawnerScale,y:this.data.spawnerScale,z:this.data.spawnerScale}),o.setAttribute("is-remote-hover-target",""),o.setAttribute("tags",{isHandCollisionTarget:!1}),o.setAttribute("visibility-while-frozen",{requireHoverOnNonMobile:!1,withPermission:"spawn_emoji"}),o.setAttribute("css-class","interactable"),o.setAttribute("body-helper",{mass:0,type:Lm.TYPE.STATIC,collisionFilterGroup:Ue.INTERACTABLES,collisionFilterMask:Ue.DEFAULT_SPAWNER}),o.addEventListener("spawned-entity-created",(t=>{if(this.el.sceneEl.is("vr-mode"))return;const n=t.detail.target.object3D,i=this.data.camera.object3D;n.updateMatrices(),i.getWorldPosition(e),n.lookAt(e.x,n.position.y,e.z),n.matrixNeedsUpdate=!0})),o.addEventListener("spawned-entity-loaded",(e=>{const t=tg[r].particleEmitterConfig;e.detail.target.querySelector(".particle-emitter").setAttribute("particle-emitter",t),e.detail.target.setAttribute("emoji",{particleEmitterConfig:t})})),o.setAttribute("super-spawner",{src:tg[r].model,template:"#interactable-emoji",spawnScale:{x:this.data.spawnedScale,y:this.data.spawnedScale,z:this.data.spawnedScale}}),rg(r,tg.length,n,i,t),o.object3D.position.copy(t),o.object3D.matrixNeedsUpdate=!0,this.el.appendChild(o),this.spawnerEntities.push(o)}}})(),play(){this.el.sceneEl.addEventListener("stateadded",this._onFrozen),this.el.sceneEl.addEventListener("stateremoved",this._onThaw),this._updateOffset()},pause(){this.el.sceneEl.removeEventListener("stateadded",this._onFrozen),this.el.sceneEl.removeEventListener("stateremoved",this._onThaw)},_onFrozen(e){if("frozen"===e.detail){this._updateOffset();for(let e=0;e<this.spawnerEntities.length;e++)(0,Ot.addComponent)(APP.world,En,this.spawnerEntities[e].eid)}},_onThaw(e){if("frozen"===e.detail)for(let e=0;e<this.spawnerEntities.length;e++)(0,Ot.removeComponent)(APP.world,En,this.spawnerEntities[e].eid)},_updateOffset:function(){const e=new ig.Vector3,t=new ig.Vector3,n=new ig.Vector3,i=new ig.Vector3,r=new ig.Vector3(1,0,0);return function(){const o=this.el.object3D,s=this.data.camera.object3D;s.updateMatrices(),t.set(0,0,-1),t.transformDirection(s.matrixWorld),n.set(0,0,-1),n.transformDirection(s.matrixWorld),n.projectOnPlane(ig.Object3D.DefaultUp).normalize();const a=Math.sign(ig.Object3D.DefaultUp.dot(t))*n.angleTo(t),l=a-Math.max(this.data.minHudAngle,Math.min(this.data.maxHudAngle,a));i.set(0,0,-1),i.applyAxisAngle(r,this.data.hudAngle-l),i.multiplyScalar(this.data.hudDistance),s.localToWorld(i),o.parent.worldToLocal(i),o.position.copy(i),o.updateMatrices(!0),s.getWorldPosition(e),o.lookAt(e),o.matrixNeedsUpdate=!0}}()});var og=n(59694),sg=n.n(og),ag="virtual-gamepad-controls__touchZone__s5d9p",lg="virtual-gamepad-controls__mockJoystick__uIAar",cg="virtual-gamepad-controls__hidden__kFvSs",dg="virtual-gamepad-controls__inner__B2zxf",ug=n(99477);function hg(e,t){t.parentNode.insertBefore(e,t.nextSibling)}AFRAME.registerComponent("virtual-gamepad-controls",{schema:{},init(){this.characterController=this.el.sceneEl.systems["hubs-systems"].characterController,this.onEnterVr=this.onEnterVr.bind(this),this.onExitVr=this.onExitVr.bind(this),this.onFirstInteraction=this.onFirstInteraction.bind(this),this.onMoveJoystickChanged=this.onMoveJoystickChanged.bind(this),this.onMoveJoystickEnd=this.onMoveJoystickEnd.bind(this),this.onLookJoystickChanged=this.onLookJoystickChanged.bind(this),this.onLookJoystickEnd=this.onLookJoystickEnd.bind(this),this.mockJoystickContainer=document.createElement("div"),this.mockJoystickContainer.classList.add("virtual-gamepad-controls__mockJoystickContainer__KBQOm"),this.leftMock=document.createElement("div"),this.leftMock.classList.add(lg),this.leftMockSmall=document.createElement("div"),this.leftMockSmall.classList.add(lg,dg),this.leftMock.appendChild(this.leftMockSmall),this.mockJoystickContainer.appendChild(this.leftMock),this.rightMock=document.createElement("div"),this.rightMock.classList.add(lg),this.rightMockSmall=document.createElement("div"),this.rightMockSmall.classList.add(lg,dg),this.rightMock.appendChild(this.rightMockSmall),this.mockJoystickContainer.appendChild(this.rightMock),this.enableLeft=window.APP.store.state.preferences.enableOnScreenJoystickLeft,this.enableRight=window.APP.store.state.preferences.enableOnScreenJoystickRight,(this.enableLeft||this.enableRight)&&hg(this.mockJoystickContainer,this.el.sceneEl.canvas),this.enableLeft?this.createLeftStick():(this.leftMock.classList.add(cg),this.leftMockSmall.classList.add(cg)),this.enableRight?this.createRightStick():(this.rightMock.classList.add(cg),this.rightMockSmall.classList.add(cg)),this.onPreferenceChange=this.onPreferenceChange.bind(this),window.APP.store.addEventListener("statechanged",this.onPreferenceChange),this.inVr=!1,this.moving=!1,this.rotating=!1,this.displacement=new ug.Vector3,this.lookDy=0,this.lookDx=0,this.el.sceneEl.addEventListener("enter-vr",this.onEnterVr),this.el.sceneEl.addEventListener("exit-vr",this.onExitVr)},onPreferenceChange(){const e=window.APP.store.state.preferences.enableOnScreenJoystickLeft,t=window.APP.store.state.preferences.enableOnScreenJoystickRight;(this.enableLeft!==e||this.enableRight!==t)&&(!e&&!t||this.mockJoystickContainer.parentNode||hg(this.mockJoystickContainer,this.el.sceneEl.canvas),!this.enableLeft&&e?this.createLeftStick():this.enableLeft&&!e&&(this.leftMock.classList.add(cg),this.leftMockSmall.classList.add(cg),this.leftStick.destroy(),this.leftTouchZone.parentNode.removeChild(this.leftTouchZone),this.leftStick=null,this.leftTouchZone=null),!this.enableRight&&t?this.createRightStick():this.enableRight&&!t&&(this.rightMock.classList.add(cg),this.rightMockSmall.classList.add(cg),this.rightStick.destroy(),this.rightTouchZone.parentNode.removeChild(this.rightTouchZone),this.rightStick=null,this.rightTouchZone=null),this.enableLeft=e,this.enableRight=t,this.enableLeft&&(this.leftMock.classList.remove(cg),this.leftMockSmall.classList.remove(cg),this.leftStick.on("start",this.onFirstInteraction)),this.enableRight&&(this.rightMock.classList.remove(cg),this.rightMockSmall.classList.remove(cg),this.rightStick.on("start",this.onFirstInteraction)),this.enableLeft||this.enableRight||!this.mockJoystickContainer.parentNode||this.mockJoystickContainer.parentNode.removeChild(this.mockJoystickContainer))},createRightStick(){this.rightTouchZone=document.createElement("div"),this.rightTouchZone.classList.add(ag,"virtual-gamepad-controls__right__CheCZ"),hg(this.rightTouchZone,this.mockJoystickContainer),this.rightStick=sg().create({mode:"static",position:{left:"50%",top:"50%"},zone:this.rightTouchZone,color:"white",fadeTime:0}),this.rightStick[0].ui.el.style.removeProperty("z-index"),this.rightStick.on("start",this.onFirstInteraction),this.rightStick.on("move",this.onLookJoystickChanged),this.rightStick.on("end",this.onLookJoystickEnd)},createLeftStick(){this.leftTouchZone=document.createElement("div"),this.leftTouchZone.classList.add(ag,"virtual-gamepad-controls__left__SOA3B"),hg(this.leftTouchZone,this.mockJoystickContainer),this.leftStick=sg().create({mode:"static",position:{left:"50%",top:"50%"},zone:this.leftTouchZone,color:"white",fadeTime:0}),this.leftStick[0].ui.el.style.removeProperty("z-index"),this.leftStick.on("start",this.onFirstInteraction),this.leftStick.on("move",this.onMoveJoystickChanged),this.leftStick.on("end",this.onMoveJoystickEnd)},onFirstInteraction(){this.leftStick&&this.leftStick.off("start",this.onFirstInteraction),this.rightStick&&this.rightStick.off("start",this.onFirstInteraction),this.mockJoystickContainer.parentNode&&this.mockJoystickContainer.parentNode.removeChild(this.mockJoystickContainer)},onMoveJoystickChanged(e,t){if(window.APP.preferenceScreenIsVisible)return;const n=t.angle.radian,i=t.force<1?t.force:1;this.displacement.set(Math.cos(n),0,-Math.sin(n)).multiplyScalar(1.85*i),this.moving=!0},onMoveJoystickEnd(){this.moving=!1,this.displacement.set(0,0,0)},onLookJoystickChanged(e,t){if(window.APP.preferenceScreenIsVisible)return;const n=t.angle.radian,i=t.force<1?t.force:1;this.rotating=!0,this.lookDy=-Math.cos(n)*i*.025,this.lookDx=Math.sin(n)*i*.025},onLookJoystickEnd(){this.rotating=!1,this.lookDx=0,this.lookDy=0,this.el.sceneEl.emit("rotateX",this.lookDx)},tick(){this.inVr||(this.moving&&this.characterController.enqueueRelativeMotion(this.displacement),this.rotating&&(this.characterController.enqueueInPlaceRotationAroundWorldUp(this.lookDy),this.el.sceneEl.emit("rotateX",this.lookDx)))},onEnterVr(){this.inVr=!0,this.leftTouchZone&&(this.leftTouchZone.style.display="none"),this.rightTouchZone&&(this.rightTouchZone.style.display="none")},onExitVr(){this.inVr=!1,this.leftTouchZone&&(this.leftTouchZone.style.display="block"),this.rightTouchZone&&(this.rightTouchZone.style.display="block")},remove(){this.el.sceneEl.removeEventListener("entervr",this.onEnterVr),this.el.sceneEl.removeEventListener("exitvr",this.onExitVr),this.mockJoystickContainer.parentNode&&this.mockJoystickContainer.parentNode.removeChild(this.mockJoystickContainer),this.leftTouchZone&&this.leftTouchZone.parentNode.removeChild(this.leftTouchZone),this.rightTouchZone&&this.rightTouchZone.parentNode.removeChild(this.rightTouchZone)}});var pg=n(99477);const{Vector3:mg,Quaternion:fg,Matrix4:gg,Euler:vg}=pg,bg=(0,Ot.defineQuery)([Wn]);AFRAME.registerComponent("ik-root",{schema:{camera:{type:"string",default:".camera"},leftController:{type:"string",default:".left-controller"},rightController:{type:"string",default:".right-controller"}},update(e){this.data.camera!==e.camera&&(this.camera=this.el.querySelector(this.data.camera)),this.data.leftController!==e.leftController&&(this.leftController=this.el.querySelector(this.data.leftController)),this.data.rightController!==e.rightController&&(this.rightController=this.el.querySelector(this.data.rightController))}});const yg={left:(new gg).makeRotationFromEuler(new vg(-Math.PI/2,Math.PI/2,0)),right:(new gg).makeRotationFromEuler(new vg(-Math.PI/2,-Math.PI/2,0))},wg=function(){const e=new pg.Vector3(0,-1,0),t=new pg.Vector3,n=new pg.Vector3;return function(i,r){return t.setFromMatrixColumn(i,2).projectOnPlane(e),n.setFromMatrixColumn(r,2).projectOnPlane(e),t.angleTo(n)}}();AFRAME.registerComponent("ik-controller",{schema:{leftEye:{type:"string",default:"LeftEye"},rightEye:{type:"string",default:"RightEye"},head:{type:"string",default:"Head"},neck:{type:"string",default:"Neck"},leftHand:{type:"string",default:"LeftHand"},rightHand:{type:"string",default:"RightHand"},chest:{type:"string",default:"Spine"},rotationSpeed:{default:8},maxLerpAngle:{default:90*pg.MathUtils.DEG2RAD},alwaysUpdate:{type:"boolean",default:!1}},init(){this._runScheduledWork=this._runScheduledWork.bind(this),this._updateIsInView=this._updateIsInView.bind(this),this.flipY=(new gg).makeRotationY(Math.PI),this.cameraForward=new gg,this.headTransform=new gg,this.hipsPosition=new mg,this.invHipsToHeadVector=new mg,this.middleEyeMatrix=new gg,this.middleEyePosition=new mg,this.invMiddleEyeToHead=new gg,this.cameraYRotation=new vg,this.cameraYQuaternion=new fg,this.invHipsQuaternion=new fg,this.headQuaternion=new fg,this.rootToChest=new gg,this.invRootToChest=new gg,this.ikRoot=function(e){for(;e&&(!e.components||!e.components["ik-root"]);)e=e.parentNode;return e&&e.components["ik-root"]}(this.el),this.isInView=!0,this.hasConvergedHips=!1,this.lastCameraTransform=new pg.Matrix4,L().then((()=>{this.playerCamera=document.getElementById("viewing-camera").getObject3D("camera")})),this.el.sceneEl.systems["frame-scheduler"].schedule(this._runScheduledWork,"ik"),this.forceIkUpdate=!0},remove(){this.el.sceneEl.systems["frame-scheduler"].unschedule(this._runScheduledWork,"ik")},update(e){this.avatar=this.el.object3D,this.data.leftEye!==e.leftEye&&(this.leftEye=this.el.object3D.getObjectByName(this.data.leftEye)),this.data.rightEye!==e.rightEye&&(this.rightEye=this.el.object3D.getObjectByName(this.data.rightEye)),this.data.head!==e.head&&(this.head=this.el.object3D.getObjectByName(this.data.head)),this.data.neck!==e.neck&&(this.neck=this.el.object3D.getObjectByName(this.data.neck)),this.data.leftHand!==e.leftHand&&(this.leftHand=this.el.object3D.getObjectByName(this.data.leftHand)),this.data.rightHand!==e.rightHand&&(this.rightHand=this.el.object3D.getObjectByName(this.data.rightHand)),this.data.chest!==e.chest&&(this.chest=this.el.object3D.getObjectByName(this.data.chest)),this.middleEyePosition.addVectors(this.leftEye.position,this.rightEye.position),this.middleEyePosition.divideScalar(2),this.middleEyeMatrix.makeTranslation(this.middleEyePosition.x,this.middleEyePosition.y,this.middleEyePosition.z),this.invMiddleEyeToHead=this.middleEyeMatrix.copy(this.middleEyeMatrix).invert(),this.invHipsToHeadVector.addVectors(this.chest.position,this.neck.position).add(this.head.position).negate()},tick(e,t){if(!this.ikRoot)return;const n=this.ikRoot.el.object3D;n.updateMatrices();const{camera:i,leftController:r,rightController:o}=this.ikRoot;i.object3D.updateMatrix();const s=!this.lastCameraTransform.equals(i.object3D.matrix);if(this.data.alwaysUpdate||this.forceIkUpdate||this.isInView&&(s||!this.hasConvergedHips)){s&&this.lastCameraTransform.copy(i.object3D.matrix);const{avatar:e,head:r,neck:o,chest:a,cameraForward:l,headTransform:c,invMiddleEyeToHead:d,invHipsToHeadVector:u,flipY:h,cameraYRotation:p,cameraYQuaternion:m,invHipsQuaternion:f,rootToChest:g,invRootToChest:v}=this;l.multiplyMatrices(i.object3D.matrix,h),c.multiplyMatrices(l,d),e.position.setFromMatrixPosition(c).add(u),e.matrixNeedsUpdate=!0,p.setFromRotationMatrix(l,"YXZ"),p.x=0,p.z=0,m.setFromEuler(p),this._hadFirstTick?(i.object3D.updateMatrices(),e.updateMatrices(),Math.PI-wg(i.object3D.matrixWorld,e.matrixWorld)>this.data.maxLerpAngle?e.quaternion.copy(m):e.quaternion.slerpQuaternions(e.quaternion,m,this.data.rotationSpeed*t/1e3)):e.quaternion.copy(m),this.hasConvergedHips=function(e,t,n){return Math.abs(t.x-n.x)<e&&Math.abs(t.y-n.y)<e&&Math.abs(t.z-n.z)<e&&Math.abs(t.w-n.w)<e||Math.abs(-t.x-n.x)<e&&Math.abs(-t.y-n.y)<e&&Math.abs(-t.z-n.z)<e&&Math.abs(-t.w-n.w)<e}(1e-4,m,e.quaternion),f.copy(e.quaternion).invert(),r.quaternion.setFromRotationMatrix(c).premultiply(f),e.updateMatrix(),g.multiplyMatrices(e.matrix,a.matrix),v.copy(g).invert(),n.matrixNeedsUpdate=!0,o.matrixNeedsUpdate=!0,r.matrixNeedsUpdate=!0,a.matrixNeedsUpdate=!0}const{leftHand:a,rightHand:l}=this;a&&this.updateHand(yg.left,a,r.object3D,!0,this.isInView),l&&this.updateHand(yg.right,l,o.object3D,!1,this.isInView),this.forceIkUpdate=!1,this._hadFirstTick||(this.ikRoot.el.object3D.visible=!0,this._hadFirstTick=!0,this.el.emit("ik-first-tick"))},updateHand(e,t,n,i,r){const o=t.matrix,s=t.el.components["personal-space-invader"];s?s.setAlwaysHidden(!n.visible):t.visible=n.visible,n.visible&&(r||this.forceIkUpdate||this.data.alwaysUpdate)&&(o.multiplyMatrices(this.invRootToChest,n.matrix),o.multiply(e),t.position.setFromMatrixPosition(o),t.rotation.setFromRotationMatrix(o),t.matrixNeedsUpdate=!0)},_runScheduledWork(){this.forceIkUpdate=!0,this._updateIsInView()},_updateIsInView:function(){const e=new pg.Frustum,t=new pg.Matrix4,n=new pg.Vector3,i=(n,i)=>(t.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),e.setFromProjectionMatrix(t),e.containsPoint(i));return function(){if(this.playerCamera&&!this.data.alwaysUpdate&&(this.ikRoot.camera.object3D.getWorldPosition(n),this.isInView=i(this.playerCamera,n),!this.isInView)){const e=APP.world,t=bg(e);for(const r of t){const t=e.eid2obj.get(Wn.screenRef[r]),o=e.eid2obj.get(Wn.cameraRef[r]);if(this.isInView=t.visible&&i(o,n),this.isInView)break}}}}()});const _g="open";AFRAME.registerComponent("hand-controls2",{schema:{default:"left"},init(){this.pose=_g},poseForFingers:(e,t,n)=>e||t||n?e&&t&&n?"fist":!e&&t&&n?"thumbUp":e||t||!n?e||!t||n?!e||t||n?e&&t&&!n?"pinch":e&&!t&&n?"point":(console.warn(`Did not find matching pose for thumb ${e}, index ${t}, middleRingPinky ${n}`),_g):"thumbDown":"indexDown":"mrpDown":_g,tick(){const e=this.data,t=AFRAME.scenes[0].systems.userinput,n="left"===e?zm.actions.leftHand:zm.actions.rightHand,i=t.get(n.thumb),r=t.get(n.index),o=t.get(n.middleRingPinky),s=this.poseForFingers(i,r,o);s!==this.pose&&(this.el.emit("hand-pose",{previous:this.pose,current:s}),this.pose=s)}}),AFRAME.registerComponent("hover-visuals",{schema:{hand:{type:"string"}},init(){this.handleLeftVisuals=this.handleLeftVisuals.bind(this),this.handleRightVisuals=this.handleRightVisuals.bind(this),this.hadLeftVisualLastFrame=!1,this.hadRightVisualLastFrame=!1,this.uniforms=null,this.sweepParams=[0,1]},remove(){this.uniforms=null},tick(){this.uniforms&&this.uniforms.length&&("left"===this.data.hand?this.handleLeftVisuals():this.handleRightVisuals())},handleLeftVisuals:function(){const e=AFRAME.scenes[0].systems.interaction,t=e.state.leftHand.held||e.state.leftHand.hovered,n=!t||!Fi(t);if(n&&!this.hadLeftVisualLastFrame)return;this.hadLeftVisualLastFrame=!n;const i=this.el.object3D.matrixWorld.elements;for(let e=0,t=this.uniforms.length;e<t;e++){const t=this.uniforms[e];t.hubs_HighlightInteractorOne.value=!n,t.hubs_InteractorOnePos.value[0]=i[12],t.hubs_InteractorOnePos.value[1]=i[13],t.hubs_InteractorOnePos.value[2]=i[14]}},handleRightVisuals:function(){const e=AFRAME.scenes[0].systems.interaction,t=e.state.rightHand.held||e.state.rightHand.hovered,n=!t||!Fi(t);if(n&&!this.hadRightVisualLastFrame)return;this.hadRightVisualLastFrame=!n;const i=this.el.object3D.matrixWorld.elements;for(let e=0,t=this.uniforms.length;e<t;e++){const t=this.uniforms[e];t.hubs_SweepParams.value=this.sweepParams,t.hubs_HighlightInteractorTwo.value=!n,t.hubs_InteractorTwoPos.value[0]=i[12],t.hubs_InteractorTwoPos.value[1]=i[13],t.hubs_InteractorTwoPos.value[2]=i[14]}}});var Eg=n(99477);AFRAME.registerComponent("offset-relative-to",{schema:{target:{type:"selector"},offset:{type:"vec3"},on:{type:"string"},orientation:{default:1},selfDestruct:{default:!1},lookAt:{default:!1}},init(){this.updateOffset=this.updateOffset.bind(this),L().then((()=>{this.data.on?this.el.sceneEl.addEventListener(this.data.on,this.updateOffset):this.updateOffset()}))},updateOffset:function(){const e=new Eg.Vector3(0,1,0),t=new Eg.Vector3(0,0,-1),n=Math.PI/2,i=new Eg.Vector3,r=new Eg.Vector3;return function(){const o=this.el.object3D,s=this.data.target.object3D;switch(i.copy(this.data.offset),s.localToWorld(i),o.parent&&o.parent.worldToLocal(i),o.position.copy(i),this.data.lookAt?(s.getWorldPosition(r),o.updateMatrices(!0),o.lookAt(r)):s.getWorldQuaternion(o.quaternion),this.data.orientation){case 8:o.rotateOnAxis(t,3*n);break;case 7:o.rotateOnAxis(t,3*n),o.rotateOnAxis(e,2*n);break;case 6:o.rotateOnAxis(t,n);break;case 5:o.rotateOnAxis(t,n),o.rotateOnAxis(e,2*n);break;case 4:o.rotateOnAxis(t,2*n),o.rotateOnAxis(e,2*n);break;case 3:o.rotateOnAxis(t,2*n);break;case 2:o.rotateOnAxis(e,2*n)}o.matrixNeedsUpdate=!0,this.data.selfDestruct&&(this.data.on&&this.el.sceneEl.removeEventListener(this.data.on,this.updateOffset),this.el.removeAttribute("offset-relative-to"))}}()});var Ag=n.p+"assets/images/avatar_unavailable-3c26fe87ea4867fb7e30..png";function Sg(e,t,n,i,r,o,s){try{var a=e[o](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(i,r)}function xg(e){return function(){var t=this,n=arguments;return new Promise((function(i,r){var o=e.apply(t,n);function s(e){Sg(o,i,r,s,a,"next",e)}function a(e){Sg(o,i,r,s,a,"throw",e)}s(void 0)}))}}const Mg="/api/v1/avatars",Pg={SKINNABLE:"skinnable",URL:"url"};function Cg(e){return e.startsWith("http")?Pg.URL:Pg.SKINNABLE}function kg(){return(kg=xg((function*(e){const t=yield Se(`/api/v1/avatars/${e}`);return t&&t.avatars&&t.avatars[0]}))).apply(this,arguments)}function Og(e){return Tg.apply(this,arguments)}function Tg(){return Tg=xg((function*(e){switch(Cg(e)){case Pg.SKINNABLE:return function(e){return kg.apply(this,arguments)}(e);case Pg.URL:return{avatar_id:e,gltf_url:zs(e)}}})),Tg.apply(this,arguments)}function Rg(){return(Rg=xg((function*(e){return Og(e).then((e=>e&&e.gltf_url))}))).apply(this,arguments)}function Dg(e){switch(Cg(e)){case Pg.SKINNABLE:return function(e){return Rg.apply(this,arguments)}(e);case Pg.URL:return zs(e);default:return e}}function jg(){return(jg=xg((function*(e){return Cg(e)===Pg.SKINNABLE?Og(e).then((e=>e.files.thumbnail)):Ag}))).apply(this,arguments)}const Lg="Bot_PBS";function Ig(e){if(e.materials.find((e=>e.name===Lg)))return e;function t(t){if(!t.primitives)return;const n=t.primitives.find((e=>void 0!==e.material));return n&&e.materials[n.material]}let n=e.scenes[e.scene].nodes.slice(0);for(;n.length;){const i=e.nodes[n.shift()],r=void 0!==i.mesh&&t(e.meshes[i.mesh]);if(r){r.name=Lg;break}i.children&&(n=n.concat(i.children))}return e}function Ng(e,t){return Fg.apply(this,arguments)}function Fg(){return(Fg=xg((function*(e,t){return Se(Mg,"POST",{avatar:{parent_avatar_listing_id:e,name:t,files:{}}})}))).apply(this,arguments)}function Bg(e){const{nodes:t}=e;if(!t.some((e=>"Head"===e.name))){const n=e.scenes[e.scene].nodes[0];t.push({name:"LeftEye",extensions:{MOZ_hubs_components:{}}}),t.push({name:"RightEye",extensions:{MOZ_hubs_components:{}}}),t.push({name:"Head",children:[n,t.length-1,t.length-2],extensions:{MOZ_hubs_components:{"scale-audio-feedback":""}}}),t.push({name:"Neck",children:[t.length-1]}),t.push({name:"Spine",children:[t.length-1]}),t.push({name:"Hips",children:[t.length-1]}),t.push({name:"AvatarRoot",children:[t.length-1]}),e.scenes[e.scene].nodes[0]=t.length-1}return e}AFRAME.registerComponent("player-info",{schema:{avatarSrc:{type:"string"},avatarType:{type:"string",default:Pg.SKINNABLE},muted:{default:!1},isSharingAvatarCamera:{default:!1}},init(){this.applyProperties=this.applyProperties.bind(this),this.handleModelError=this.handleModelError.bind(this),this.handleRemoteModelError=this.handleRemoteModelError.bind(this),this.update=this.update.bind(this),this.onPresenceUpdated=this.onPresenceUpdated.bind(this),this.onMicStateChanged=this.onMicStateChanged.bind(this),this.onAvatarModelLoaded=this.onAvatarModelLoaded.bind(this),this.isLocalPlayerInfo="avatar-rig"===this.el.id,this.playerSessionId=null,this.isLocalPlayerInfo||NAF.utils.getNetworkedEntity(this.el).then((e=>{this.playerSessionId=NAF.utils.getCreator(e);const t=window.APP.hubChannel.presence.state[this.playerSessionId];t&&(this.permissions=t.metas[0].permissions)})),cp(this,"player-info")},remove(){const e=this.el.querySelector("[avatar-audio-source]");APP.isAudioPaused.delete(e),dp(this,"player-info")},onAvatarModelLoaded(e){this.applyProperties(e);const t=this.el.querySelector(".model");if(this.isLocalPlayerInfo&&e.target===t){let e=!1;t.object3D.traverse((function(t){if(t.isSkinnedMesh){const n=Uo(t);n&&(e=!0,t.parent.add(n))}})),e||t.object3D.traverse((function(e){e.isMesh&&e.layers.set(_o.CAMERA_LAYER_THIRD_PERSON_ONLY)}))}},play(){this.el.addEventListener("model-loaded",this.onAvatarModelLoaded),this.el.sceneEl.addEventListener("presence_updated",this.onPresenceUpdated),this.isLocalPlayerInfo?this.el.querySelector(".model").addEventListener("model-error",this.handleModelError):this.el.querySelector(".model").addEventListener("model-error",this.handleRemoteModelError),window.APP.store.addEventListener("statechanged",this.update),this.el.sceneEl.addEventListener("stateadded",this.update),this.el.sceneEl.addEventListener("stateremoved",this.update),this.isLocalPlayerInfo&&APP.dialog.on("mic-state-changed",this.onMicStateChanged)},pause(){this.el.removeEventListener("model-loaded",this.onAvatarModelLoaded),this.el.sceneEl.removeEventListener("presence_updated",this.onPresenceUpdated),this.isLocalPlayerInfo?this.el.querySelector(".model").removeEventListener("model-error",this.handleModelError):this.el.querySelector(".model").removeEventListener("model-error",this.handleRemoteModelError),this.el.sceneEl.removeEventListener("stateadded",this.update),this.el.sceneEl.removeEventListener("stateremoved",this.update),window.APP.store.removeEventListener("statechanged",this.update),this.isLocalPlayerInfo&&APP.dialog.off("mic-state-changed",this.onMicStateChanged)},onPresenceUpdated(e){this.updateFromPresenceMeta(e.detail)},updateFromPresenceMeta(e){!this.playerSessionId&&this.isLocalPlayerInfo&&(this.playerSessionId=NAF.clientId),this.playerSessionId&&this.playerSessionId===e.sessionId&&(this.permissions=e.permissions)},update(e){this.data.muted!==e.muted&&this.el.emit("remote_mute_updated",{muted:this.data.muted}),this.applyProperties()},can(e){return!!this.permissions&&this.permissions[e]},applyProperties(e){const t=this.el.querySelector(".model");if(this.data.avatarSrc&&t&&(t.components["gltf-model-plus"].jsonPreprocessor=Bg,t.setAttribute("gltf-model-plus","src",this.data.avatarSrc)),!e||e.target===t){const e=Bl(this.el.object3D);this.el.querySelectorAll("[hover-visuals]").forEach((t=>{t.components["hover-visuals"].uniforms=e}))}const n=t.querySelectorAll("[video-texture-target]"),i=this.isLocalPlayerInfo?NAF.clientId:this.playerSessionId;for(const e of Array.from(n))e.setAttribute("video-texture-target",{src:this.data.isSharingAvatarCamera?`hubs://clients/${i}/video`:""}),this.isLocalPlayerInfo&&e.setAttribute("emit-scene-event-on-remove",`event:${Ne.VIDEO_SHARE_ENDED}`);const r=this.el.querySelector("[avatar-audio-source]");this.data.muted?APP.isAudioPaused.add(r):APP.isAudioPaused.delete(r)},handleModelError(){window.APP.store.resetToRandomDefaultAvatar()},handleRemoteModelError(){this.data.avatarSrc=Te,this.applyProperties()},onMicStateChanged(e){let{enabled:t}=e;this.el.setAttribute("player-info",{muted:!t})}});var Vg=n(41017),Ug=n.n(Vg),Hg=n.p+"assets/hud/hand-raised-730127585a9ea9b61196..png",zg=n(99477);function Wg(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function qg(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Wg(Object(n),!0).forEach((function(t){Zg(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Wg(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Zg(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Gg(e,t,n,i,r,o,s){try{var a=e[o](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(i,r)}const Yg=(0,z.Z)("debug"),Qg={duration:400,easing:"easeOutQuart",elasticity:400,loop:0,round:!1},Xg=new zg.PlaneBufferGeometry(1,.025),Kg=new zg.MeshBasicMaterial({color:"#7ED320"}),$g=new zg.CircleBufferGeometry(.01,6),Jg=zl.load(Hg),ev=Bo(.2,.2,1,1,Jg.flipY),tv=new zg.MeshBasicMaterial({transparent:!0,map:Jg});AFRAME.registerComponent("name-tag",{schema:{},init(){this.store=window.APP.store,this.displayName=null,this.identityName=null,this.isTalking=!1,this.isTyping=!1,this.isOwner=!1,this.isRecording=!1,this.isHandRaised=!1,this.volumeAvg=new(Ug())(128),this.shouldBeVisible=!0,this.size=new zg.Vector3,this.avatarAABB=new zg.Box3,this.avatarAABBSize=new zg.Vector3,this.avatarAABBCenter=new zg.Vector3,this.nametagHeight=0,this.isAvatarReady=!1,this.lastUpdateTime=Date.now(),this.onPresenceUpdated=this.onPresenceUpdated.bind(this),this.onModelLoading=this.onModelLoading.bind(this),this.onModelLoaded=this.onModelLoaded.bind(this),this.onModelIkFirstTick=this.onModelIkFirstTick.bind(this),this.onStateChanged=this.onStateChanged.bind(this),this.nametag=this.el.object3D,this.nametagIdentityName=this.el.querySelector(".identityName").object3D,this.nametagBackground=this.el.querySelector(".nametag-background").object3D,this.nametagStatusBorder=this.el.querySelector(".nametag-status-border").object3D,this.recordingBadge=this.el.querySelector(".recordingBadge").object3D,this.modBadge=this.el.querySelector(".modBadge").object3D,this.nametagText=this.el.querySelector(".nametag-text").object3D,this.handRaised=new zg.Mesh(ev,tv),this.handRaised.position.set(0,-.3,.001),this.el.object3D.add(this.handRaised),this.nametagVolume=new zg.Mesh(Xg,Kg),this.nametagVolume.position.set(0,-.075,.001),this.nametagVolume.visible=!1,this.el.object3D.add(this.nametagVolume),this.nametagTyping=new zg.Group,this.nametagTyping.position.set(0,-.075,.001);for(let e=0;e<5;e++){const t=new zg.Mesh($g,new zg.MeshBasicMaterial({transparent:!0,color:16777215,depthWrite:!1}));t.position.x=.035*e-.07,this.nametagTyping.add(t)}this.el.object3D.add(this.nametagTyping),this.updateTheme(),NAF.utils.getNetworkedEntity(this.el).then((e=>{this.playerSessionId=NAF.utils.getCreator(e);const t=window.APP.hubChannel.presence.state[this.playerSessionId];t&&this.updateFromPresenceMeta(t.metas[0])})),Yg&&(this.avatarAABBHelper=new zg.Box3Helper(this.avatarAABB,16776960),this.el.sceneEl.object3D.add(this.avatarAABBHelper)),this.onStateChanged()},remove(){Yg&&this.el.sceneEl.object3D.remove(this.avatarAABBHelper)},tick:(()=>{let e=0;const t=new zg.Vector3,n=new zg.Matrix4;return function(i){this.isAvatarReady?(this.wasTalking=this.isTalking,this.isTalking=this.audioAnalyzer.avatarIsTalking,this.shouldBeVisible?(this.nametag.visible=!0,this.isTalking!==this.wasTalking&&this.resizeNameTag(),this.isTalking?(this.nametagVolume.visible=this.isTalking,this.nametagVolume.scale.setX(this.audioAnalyzer.volume*this.size.x),this.nametagVolume.matrixNeedsUpdate=!0,this.nametagTyping.visible=!1):this.isTyping?(this.nametagTyping.visible=!0,e=i,this.nametagTyping.traverse((t=>{t.material&&(t.material.opacity=(Math.sin(e/150)+1)/2,e-=150)}))):this.nametagTyping.visible=!1,this.nametagStatusBorder.visible=this.isTyping||this.isTalking||this.isHandRaised,this.recordingBadge.visible=this.isRecording,this.modBadge.visible=this.isOwner&&!this.isRecording,this.handRaised.visible=this.isHandRaised,this.neck.getWorldPosition(t),t.setY(this.nametagElPosY+this.ikRoot.position.y),n.copy(this.nametag.matrixWorld),n.setPosition(t),Oo(this.nametag,n)):this.nametag.visible=!1,Yg&&(this.updateAvatarModelAABB(),this.avatarAABBHelper.matrixNeedsUpdate=!0,this.avatarAABBHelper.updateMatrixWorld(!0))):this.nametag.visible=!1}})(),play(){this.el.parentEl.addEventListener("model-loading",this.onModelLoading),this.el.parentEl.addEventListener("model-loaded",this.onModelLoaded),this.el.parentEl.addEventListener("ik-first-tick",this.onModelIkFirstTick),this.el.sceneEl.addEventListener("presence_updated",this.onPresenceUpdated),window.APP.store.addEventListener("statechanged",this.onStateChanged),this.el.sceneEl.systems["hubs-systems"].nameTagSystem.register(this)},pause(){this.el.parentEl.removeEventListener("model-loading",this.onModelLoading),this.el.parentEl.removeEventListener("model-loaded",this.onModelLoaded),this.el.parentEl.removeEventListener("ik-first-tick",this.onModelIkFirstTick),this.el.sceneEl.removeEventListener("presence_updated",this.onPresenceUpdated),window.APP.store.removeEventListener("statechanged",this.onStateChanged),this.el.sceneEl.systems["hubs-systems"].nameTagSystem.unregister(this)},onPresenceUpdated(e){let{detail:t}=e;t.sessionId===this.playerSessionId&&this.updateFromPresenceMeta(t)},updateFromPresenceMeta(e){this.displayName=e.profile.displayName,this.identityName=e.profile.identityName,this.isRecording=!(!e.streaming&&!e.recording),this.isOwner=!(!e.roles||!e.roles.owner),this.isTyping=!!e.typing,this.isHandRaised=!!e.hand_raised,this.isAvatarReady&&(this.updateDisplayName(),this.updateHandRaised(),this.resizeNameTag())},updateDisplayName(){this.displayName&&this.displayName!==this.prevDisplayName&&(this.nametagText.el.addEventListener("text-updated",(()=>{this.nametagText.el&&(this.nametagText.el.components.text.getSize(this.size),this.size.x=Math.max(this.size.x,.6),this.resizeNameTag())}),{once:!0}),this.displayName.length>18&&(this.displayName=this.displayName.slice(0,18).concat("...")),this.nametagText.el.setAttribute("text",{value:this.displayName}),this.prevDisplayName=this.displayName),this.identityName&&(this.identityName.length>18&&(this.identityName=this.identityName.slice(0,18).concat("...")),this.nametagIdentityName.el.setAttribute("text",{value:this.identityName}))},onModelLoading(){this.model=null,this.isAvatarReady=!1},onModelLoaded(e){let{detail:{model:t}}=e;this.model=t},onModelIkFirstTick(){var e,t=this;return(e=function*(){yield Ji(),t.ikRoot=lp(t.el,"ik-root").object3D,t.neck=t.ikRoot.el.querySelector(".Neck").object3D,t.audioAnalyzer=t.ikRoot.el.querySelector(".AvatarRoot").components["networked-audio-analyser"],t.updateAvatarModelAABB();const e=new zg.Vector3;t.nametagHeight=Math.abs(e.subVectors(t.ikRoot.position,t.avatarAABBCenter).y)+t.avatarAABBSize.y/2+.2,t.nametagElPosY=t.nametagHeight+(t.isHandRaised?.2:0),t.nametagText.el.components.text.getSize(t.size),t.size.x=Math.max(t.size.x,.6),t.isAvatarReady=!0,t.updateDisplayName(),t.updateHandRaised(),t.resizeNameTag()},function(){var t=this,n=arguments;return new Promise((function(i,r){var o=e.apply(t,n);function s(e){Gg(o,i,r,s,a,"next",e)}function a(e){Gg(o,i,r,s,a,"throw",e)}s(void 0)}))})()},updateTheme(){this.nametagStatusBorder.el.setAttribute("slice9","color",gt(this.isHandRaised?"nametag-border-color-raised-hand":"nametag-border-color")),Kg.color.set(gt("nametag-volume-color")),this.nametagBackground.el.setAttribute("slice9","color",gt("nametag-color")),this.nametagText.el.setAttribute("text","color",gt("nametag-text-color"))},onStateChanged(){this.updateTheme()},resizeNameTag(){this.nametagBackground.el.setAttribute("slice9",{width:this.size.x+.1,height:.25}),this.nametagStatusBorder.el.setAttribute("slice9",{width:this.size.x+.1+.035,height:.25+.035})},updateHandRaised(){this.nametagStatusBorder.el.setAttribute("slice9","color",gt(this.isHandRaised?"nametag-border-color-raised-hand":"nametag-border-color"));const e=this.isHandRaised?1:0;(0,El.Z)(qg(qg({},Qg),{},{targets:{x:this.handRaised.scale.x,y:this.handRaised.scale.y,z:this.handRaised.scale.z},x:e,y:e,z:e,update:e=>{this.handRaised.scale.set(e.animatables[0].target.x,e.animatables[0].target.y,e.animatables[0].target.z),this.handRaised.matrixNeedsUpdate=!0}})),(0,El.Z)(qg(qg({},Qg),{},{targets:{y:this.nametagElPosY},y:this.nametagHeight+(this.isHandRaised?.2:0),update:e=>{this.nametagElPosY=e.animatables[0].target.y}}))},updateAvatarModelAABB(){this.model&&(this.avatarAABB.setFromObject(this.model),this.avatarAABB.getSize(this.avatarAABBSize),this.avatarAABB.getCenter(this.avatarAABBCenter))}}),n(17875);var nv=n(27006);const iv={open:"allOpen",thumbDown:"thumbDown",indexDown:"indexDown",mrpDown:"mrpDown",thumbUp:"thumbsUp",point:"point",fist:"allGrip",pinch:"pinch"},rv=["allOpen","thumbDown","indexDown","mrpDown","thumbsUp","point","allGrip","pinch"];AFRAME.registerComponent("hand-pose",{multiple:!0,init(){this.pose=0,this.animatePose=this.animatePose.bind(this);const e=lp(this.el,"animation-mixer"),t="left"==this.id?"_L":"_R";if(this.mixer=e&&e.components["animation-mixer"].mixer,!this.mixer||!this.mixer.clipAction(iv.open+t))return console.warn("Avatar does not an 'allOpen' animation, disabling hand animations"),void this.el.removeAttribute("hand-pose");this.from=this.to=this.mixer.clipAction(iv.open+t),this.from.play(),this.networkField=`${this.id}_hand_pose`;const n=e=>{if(!e)return void window.setTimeout((()=>{n(this.el)}),1e3);return e.components&&e.components["networked-avatar"]||n(e.parentEl)};this.networkedAvatar=n(this.el)},tick(){this.networkedAvatar&&this.networkedAvatar.data&&this.networkedAvatar.data[this.networkField]!==this.pose&&(this.animatePose(rv[this.pose],rv[this.networkedAvatar.data[this.networkField]]),this.pose=this.networkedAvatar.data[this.networkField])},animatePose(e,t){this.from&&this.from.stop(),this.to&&this.to.stop();const n="left"==this.id?"_L":"_R";this.from=this.mixer.clipAction(e+n),this.to=this.mixer.clipAction(t+n),this.from&&(this.from.setLoop(nv.jAl,-1),this.from.clampWhenFinished=!0,this.from.fadeOut(.065),this.from.play()),this.to&&(this.to.setLoop(nv.jAl,-1),this.to.clampWhenFinished=!0,this.to.fadeIn(.065),this.to.play()),this.mixer.update(.001)}}),AFRAME.registerComponent("hand-pose-controller",{multiple:!0,schema:{eventSrc:{type:"selector"},networkedAvatar:{type:"selector"}},init:function(){this.setHandPose=this.setHandPose.bind(this)},play:function(){this.data.eventSrc.addEventListener("hand-pose",this.setHandPose)},pause:function(){this.data.eventSrc.removeEventListener("hand-pose",this.setHandPose)},setHandPose:function(e){this.data.networkedAvatar.setAttribute("networked-avatar",`${this.id}_hand_pose`,rv.indexOf(iv[e.detail.current]))}});var ov=n(99477);const sv=2*Math.PI;AFRAME.registerComponent("hud-controller",{schema:{head:{type:"selector"},offset:{default:.7},lookCutoff:{default:20},animRange:{default:30},yawCutoff:{default:50}},init(){this.onChildHovered=this.onChildHovered.bind(this),this.removeHoverEvents=this.removeHoverEvents.bind(this),this.isYLocked=!1,this.lockedHeadPositionY=0,this.lookDir=new ov.Vector3,this.lookEuler=new ov.Euler,this.store=window.APP.store,this.hoverableChildren=this.el.querySelectorAll("[is-remote-hover-target]")},tick(){const e=this.el.object3D,t=this.data.head.object3DMap.camera,{offset:n,lookCutoff:i,animRange:r,yawCutoff:o}=this.data,s=t.rotation.x*ov.MathUtils.RAD2DEG,a=function(e,t){const n=Math.abs(t-e)%sv;return n>Math.PI?sv-n:n}(t.rotation.y,e.rotation.y)*ov.MathUtils.RAD2DEG,l=!this.store.state.activity.hasHoveredInWorldHud;let c=1-ov.MathUtils.clamp(i-s,0,r)/r;l&&(c=1),1===c?(this.lockedHeadPositionY=t.position.y,this.hudLocked=!0):this.hudLocked&&s<i-r/2&&(this.hudLocked=!1),this.hudLocked&&(c=1);const d=a>=o||s<i-r/2;d&&(this.lookDir.set(0,0,-1),this.lookDir.applyQuaternion(t.quaternion),this.lookDir.add(t.position),e.position.x=this.lookDir.x,e.position.z=this.lookDir.z,e.rotation.copy(t.rotation),e.rotation.x=0,e.rotation.z=0),e.visible=(!d||l)&&0===this.el.sceneEl.systems["hubs-systems"].cameraSystem.mode&&!D(),e.position.y=(this.isYLocked?this.lockedHeadPositionY:t.position.y)+n+(1-c)*n,e.rotation.x=(1-c)*ov.MathUtils.DEG2RAD*90,e.matrixNeedsUpdate=!0},play(){for(let e=0;e<this.hoverableChildren.length;e++)this.hoverableChildren[e].object3D.addEventListener("hovered",this.onChildHovered)},pause(){this.removeHoverEvents()},removeHoverEvents(){for(let e=0;e<this.hoverableChildren.length;e++)this.hoverableChildren[e].object3D.removeEventListener("hovered",this.onChildHovered)},onChildHovered(){this.store.state.activity.hasHoveredInWorldHud||(this.store.update({activity:{hasHoveredInWorldHud:!0}}),this.removeHoverEvents())}}),AFRAME.registerComponent("freeze-controller",{init:function(){this.onToggle=this.onToggle.bind(this)},tick:function(){const e=this.el.sceneEl;if(e.is("entered"))if(3===e.systems["hubs-systems"].cameraSystem.mode)this.el.is("frozen")&&this.onToggle(),NAF.connection.adapter.frozen||NAF.connection.adapter.toggleFreeze(),this.wasInspecting=!0;else if(this.wasInspecting)NAF.connection.adapter.frozen&&NAF.connection.adapter.toggleFreeze(),this.wasInspecting=!1;else{const t=e.systems.userinput,n=t.get(zm.actions.ensureFrozen),i=t.get(zm.actions.thaw),r=t.get(zm.actions.toggleFreeze);(this.el.is("frozen")&&i||!this.el.is("frozen")&&n||r)&&this.onToggle()}},onToggle:function(){window.APP.store.update({activity:{hasFoundFreeze:!0}}),NAF.connection.adapter&&(NAF.connection.adapter.toggleFreeze(),NAF.connection.adapter.frozen?(this.el.sceneEl.systems["hubs-systems"].soundEffectsSystem.playSoundOneShot(Mm),this.el.addState("frozen")):(this.el.sceneEl.systems["hubs-systems"].soundEffectsSystem.playSoundOneShot(cm),this.el.removeState("frozen")))}}),n(78363),n(75287),n(53738),n(29055),n(56994),n(23601),n(92212),n(44874),n(72336),n(93289);var av=n(99477);const lv=AFRAME.utils.device.isMobile();AFRAME.registerComponent("visibility-while-frozen",{schema:{withinDistance:{type:"number"},visible:{type:"boolean",default:!0},requireHoverOnNonMobile:{type:"boolean",default:!0},withPermission:{type:"string"},withoutPermission:{type:"string"},visibleIfOwned:{type:"boolean",default:!0}},init(){this.updateVisibility=this.updateVisibility.bind(this),this.camWorldPos=new av.Vector3,this.objWorldPos=new av.Vector3,L().then((()=>{this.cameraEl=document.getElementById("viewing-camera"),this.updateVisibility()}));let e=this.el;for(;e!==document;){if(null!==e.getAttribute("is-remote-hover-target")){this.hoverable=e;break}e=e.parentNode}!this.hoverable&&this.data.requireHoverOnNonMobile&&console.error("Didn't find a remote hover target."),this.data.visibleIfOwned||NAF.utils.getNetworkedEntity(this.el).then((e=>{this.networkedEl=e})).then((()=>{})),this.onStateChange=e=>{"frozen"!==!e.detail&&this.updateVisibility()},this.updateVisibility()},tick(){const e=this.el.sceneEl.is("frozen"),t=this.el.object3D.visible,n=e===!this.data.visible;!t&&n||this.updateVisibility()},updateVisibility(){if(!this.cameraEl)return;const e=this.el.sceneEl.is("frozen");let t=!0;const n=this.el.object3D.visible;this.data.withinDistance&&(n||this.el.object3D.updateMatrices(!0,!0),So(this.cameraEl.object3DMap.camera,this.camWorldPos),this.objWorldPos.copy(this.el.object3D.position),this.el.object3D.localToWorld(this.objWorldPos),t=this.camWorldPos.distanceToSquared(this.objWorldPos)<this.data.withinDistance*this.data.withinDistance);const i=this.el.sceneEl.systems["transform-selected-object"].transforming,r=this.el.sceneEl.systems.interaction.isHoldingAnything();if(this.data.withPermission&&this.data.withoutPermission)throw new Error("only withPermission or withoutPermission can be speciifed on visibility-while-frozen, not both.");let o=!!(!this.data.withPermission&&!this.data.withoutPermission||this.data.withPermission&&window.APP.hubChannel&&window.APP.hubChannel.canOrWillIfCreator(this.data.withPermission)||this.data.withoutPermission&&window.APP.hubChannel&&!window.APP.hubChannel.canOrWillIfCreator(this.data.withoutPermission))&&(e&&this.data.visible||!e&&!this.data.visible)&&t&&!i&&!r;this.data.requireHoverOnNonMobile&&!lv&&(o=o&&(this.hoverable&&(this.el.sceneEl.systems.interaction.state.rightRemote.hovered===this.hoverable||this.el.sceneEl.systems.interaction.state.leftRemote.hovered===this.hoverable)||n)),this.data.visibleIfOwned||(o=o&&this.networkedEl&&!NAF.utils.isMine(this.networkedEl)),n!==o&&this.el.setAttribute("visible",o)},play(){this.el.sceneEl.addEventListener("stateadded",this.onStateChange),this.el.sceneEl.addEventListener("stateremoved",this.onStateChange),this.hoverable&&(this.hoverable.object3D.addEventListener("hovered",this.updateVisibility),this.hoverable.object3D.addEventListener("unhovered",this.updateVisibility))},pause(){this.el.sceneEl.removeEventListener("stateadded",this.onStateChange),this.el.sceneEl.removeEventListener("stateremoved",this.onStateChange),this.hoverable&&(this.hoverable.object3D.addEventListener("hovered",this.updateVisibility),this.hoverable.object3D.addEventListener("unhovered",this.updateVisibility))}}),AFRAME.registerComponent("ui-class-while-frozen",{init(){this.onStateChange=e=>{"frozen"!==!e.detail&&this.el.classList.toggle("ui",this.el.sceneEl.is("frozen"))},this.el.classList.toggle("ui",this.el.sceneEl.is("frozen"))},play(){this.el.sceneEl.addEventListener("stateadded",this.onStateChange),this.el.sceneEl.addEventListener("stateremoved",this.onStateChange)},pause(){this.el.sceneEl.removeEventListener("stateadded",this.onStateChange),this.el.sceneEl.removeEventListener("stateremoved",this.onStateChange)}});var cv=n(99477);function dv(e){let t=null;return{update:function(){t("renderer.info.memory.geometries").set(e.info.memory.geometries),t("renderer.info.programs").set(e.info.programs.length),t("renderer.info.memory.textures").set(e.info.memory.textures),t("renderer.info.render.calls").set(e.info.render.calls),t("renderer.info.render.triangles").set(e.info.render.triangles),t("renderer.info.render.points").set(e.info.render.points)},start:function(){},end:function(){},attach:function(e){t=e},values:{"renderer.info.memory.geometries":{caption:"Geometries"},"renderer.info.memory.textures":{caption:"Textures"},"renderer.info.programs":{caption:"Programs"},"renderer.info.render.calls":{caption:"Calls"},"renderer.info.render.triangles":{caption:"Triangles",over:1e5},"renderer.info.render.points":{caption:"Points"}},groups:[{caption:"Three.js - Memory",values:["renderer.info.memory.geometries","renderer.info.programs","renderer.info.memory.textures"]},{caption:"Three.js - Render",values:["renderer.info.render.calls","renderer.info.render.triangles","renderer.info.render.points"]}],fractions:[]}}const uv="a-hidden";let hv;const pv=(0,Ot.defineQuery)(),mv=(0,Ot.defineQuery)([Ut]);AFRAME.registerComponent("stats-plus",{schema:{default:!1},init(){this.onExpand=this.onExpand.bind(this),this.onCollapse=this.onCollapse.bind(this),this.onEnterVr=this.onEnterVr.bind(this),this.onExitVr=this.onExitVr.bind(this);const e=this.el.sceneEl;if(this.stats=function(e){const t=e.isMobile?[]:[new dv(e.renderer)];return new window.rStats({css:[],values:{fps:{caption:"fps",below:30}},groups:[{caption:"Framerate",values:["fps","raf","physics"]},{caption:"BitECS",values:["entities","a-entities","queries"]}],plugins:t})}(e),this.statsEl=document.querySelector(".rs-base"),!this.statsEl)return;const t=document.createElement("div");t.classList.add("rs-header");const n=document.createElement("h1");n.innerHTML="Stats",t.appendChild(n);const i=document.createElement("div");i.classList.add("rs-collapse-btn"),i.innerHTML="X",i.addEventListener("click",this.onCollapse),t.appendChild(i),this.statsEl.insertBefore(t,this.statsEl.firstChild),this.fpsEl=document.createElement("div"),this.fpsEl.addEventListener("click",this.onExpand),this.fpsEl.classList.add("rs-fps-counter"),document.body.appendChild(this.fpsEl),this.lastFpsUpdate=performance.now(),this.lastFps=0,this.frameCount=0,this.inVR=e.is("vr-mode"),this.showFPSCounter=window.APP.store.state.preferences.showFPSCounter,this.fpsEl.style.display=this.showFPSCounter?"block":"none",e.isMobile&&(this.statsEl.classList.add("rs-mobile"),this.fpsEl.classList.add("rs-mobile")),e.addEventListener("enter-vr",this.onEnterVr),e.addEventListener("exit-vr",this.onExitVr),this.vrStatsEnabled=(0,z.Z)("vrstats"),this.vrStatsEnabled&&this.initVRStats(),this.lastUpdate=0,hv=Object.getOwnPropertySymbols(APP.world).find((e=>"queries"==e.description))},initVRStats(){this.vrPanel=document.createElement("a-entity"),this.vrPanel.setAttribute("text",{maxWidth:.5,value:"_",anchorY:"bottom"}),this.vrPanel.addEventListener("loaded",(()=>this.vrPanel.object3D.traverse((e=>{e.material&&(e.material.depthTest=!1)}))),{once:!0}),this.el.append(this.vrPanel);const e=new cv.Mesh(new cv.PlaneBufferGeometry(.1,.12),new cv.MeshBasicMaterial({color:3355443,depthTest:!1}));e.position.set(-.2,.055,0),this.el.object3D.add(e)},toggleVRStats(){this.vrStatsEnabled?(this.el.object3D.visible=!1,this.vrStatsEnabled=!1):(this.vrPanel||this.initVRStats(),this.el.object3D.visible=!0,this.vrStatsEnabled=!0)},update(e){e!==this.data&&(this.data?(this.statsEl.classList.remove(uv),this.fpsEl.classList.add(uv)):(this.statsEl.classList.add(uv),this.fpsEl.classList.remove(uv)))},tick(e){const t=this.stats;if(this.statsEl&&(this.showFPSCounter!==window.APP.store.state.preferences.showFPSCounter&&(this.showFPSCounter=window.APP.store.state.preferences.showFPSCounter,this.fpsEl.style.display=this.showFPSCounter?"block":"none"),this.showFPSCounter)){if(this.data||this.vrStatsEnabled)t("rAF").tick(),t("FPS").frame(),t("physics").set(this.el.sceneEl.systems["hubs-systems"].physicsSystem.stepDuration),t("queries").set(APP.world[hv].size),t("entities").set(pv(APP.world).length),t("a-entities").set(mv(APP.world).length),t().update();else if(!this.inVR){const e=performance.now();if(this.frameCount++,e>=this.lastFpsUpdate+1e3){const t=Math.round(this.frameCount/((e-this.lastFpsUpdate)/1e3));t!==this.lastFps&&(this.fpsEl.innerHTML=Math.round(t)+" FPS",this.lastFps=t),this.lastFpsUpdate=e,this.frameCount=0}}this.vrStatsEnabled&&e-this.lastUpdate>100&&(this.vrPanel.setAttribute("text","value",[`f ${t("fps").value().toFixed(0)}`,`r ${t("raf").value().toFixed(0)}`,`p ${t("physics").value().toFixed(0)}`,`c ${this.el.sceneEl.renderer.info.render.calls}`,`t ${(this.el.sceneEl.renderer.info.render.triangles/1e3).toFixed(0)}k`].join("\n")),this.lastUpdate=e)}},onEnterVr(){this.inVR=!0,this.el.sceneEl.isMobile&&(this.statsEl.classList.add(uv),this.fpsEl.classList.add(uv))},onExitVr(){this.inVR=!1,this.el.sceneEl.isMobile&&(this.data?this.statsEl.classList.remove(uv):this.fpsEl.classList.remove(uv))},onExpand(){this.el.setAttribute(this.name,!0)},onCollapse(){this.el.setAttribute(this.name,!1)},remove(){this.el.sceneEl.removeEventListener("enter-vr",this.hide),this.el.sceneEl.removeEventListener("exit-vr",this.show),this.statsEl&&(this.statsEl.parentNode.removeChild(this.statsEl),this.fpsEl.parentNode.removeChild(this.fpsEl))}}),n(69369);var fv=n.p+"assets/images/audio-301f6b0b1159e8fc8523..png";function gv(e,t,n,i,r,o,s){try{var a=e[o](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(i,r)}let vv;function bv(){vv=vv||document.querySelector("#media-mirror-target");const e=vv.firstChild;return e&&e.components["media-loader"]&&e.components["media-loader"].data.linkedEl}function yv(){var e;return e=function*(){const e=bv();if(!e)return;yield Ql();const{entity:t}=Fl(e,"#linked-media",e.components["media-loader"].data.src,!1,!0,vv);t.object3D.scale.set(.75,.75,.75),t.object3D.matrixNeedsUpdate=!0;const n=t.querySelector("[refresh-media-button]");n&&n.parentNode.removeChild(n);const i=t.querySelector("[local-refresh-media-button]");i&&i.parentNode.removeChild(i),vv.parentEl.components["follow-in-fov"].reset(),vv.parentEl.object3D.visible=!0},yv=function(){var t=this,n=arguments;return new Promise((function(i,r){var o=e.apply(t,n);function s(e){gv(o,i,r,s,a,"next",e)}function a(e){gv(o,i,r,s,a,"throw",e)}s(void 0)}))},yv.apply(this,arguments)}var wv=n(81249),_v=n.n(wv);function Ev(e,t){const n=Math.min(1,1/t),i=Math.min(1,t);e.object3DMap.mesh.scale.set(n,i,1),e.object3DMap.mesh.matrixNeedsUpdate=!0}const Av=(0,Ct.detect)(),Sv=["iOS","Mac OS"].includes(Av.os)&&["safari","ios"].includes(Av.name);var xv=n(99477);function Mv(e,t,n,i,r,o,s){try{var a=e[o](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(i,r)}function Pv(e){return function(){var t=this,n=arguments;return new Promise((function(i,r){var o=e.apply(t,n);function s(e){Mv(o,i,r,s,a,"next",e)}function a(e){Mv(o,i,r,s,a,"throw",e)}s(void 0)}))}}const Cv={once:!0},kv={type:"image/png"},Ov=Q(),Tv=(new Ds).load(fv),Rv=[];for(let e=0;e<=20;e++){let t="[";for(let n=1;n<=20;n++)t+=e>=n?"|":" ";t+="]",Rv[e]=t}function Dv(e){let t=Math.floor(e),n=Math.floor(t/3600);t-=3600*n;let i=Math.floor(t/60);return t-=60*i,n<10&&(n=`0${n}`),i<10&&(i=`0${i}`),t<10&&(t=`0${t}`),"00"===n?`${i}:${t}`:`${n}:${i}:${t}`}AFRAME.registerComponent("media-video",{schema:{src:{type:"string"},audioSrc:{type:"string"},contentType:{type:"string"},loop:{type:"boolean",default:!0},hidePlaybackControls:{type:"boolean",default:!1},videoPaused:{type:"boolean"},projection:{type:"string",default:"flat"},time:{type:"number"},tickRate:{default:1e3},syncTolerance:{default:2},linkedVideoTexture:{default:null},linkedAudioSource:{default:null},linkedMediaElementAudioSource:{default:null}},init(){APP.gainMultipliers.set(this.el,1),this.onPauseStateChange=this.onPauseStateChange.bind(this),this.updateHoverMenu=this.updateHoverMenu.bind(this),this.tryUpdateVideoPlaybackState=this.tryUpdateVideoPlaybackState.bind(this),this.ensureOwned=this.ensureOwned.bind(this),this.isMineOrLocal=this.isMineOrLocal.bind(this),this.updateSrc=this.updateSrc.bind(this),this.seekForward=this.seekForward.bind(this),this.seekBack=this.seekBack.bind(this),this.volumeUp=this.volumeUp.bind(this),this.volumeDown=this.volumeDown.bind(this),this.snap=this.snap.bind(this),this.changeVolumeBy=this.changeVolumeBy.bind(this),this.togglePlaying=this.togglePlaying.bind(this),this.setupAudio=this.setupAudio.bind(this),this.audioSystem=this.el.sceneEl.systems["hubs-systems"].audioSystem,this.lastUpdate=0,this.videoMutedAt=0,this.localSnapCount=0,this.isSnapping=!1,this.videoIsLive=null,this.onSnapImageLoaded=()=>this.isSnapping=!1,this.hasAudioTracks=!1,this.el.setAttribute("hover-menu__video",{template:"#video-hover-menu",isFlat:!0}),this.el.components["hover-menu__video"].getHoverMenu().then((e=>{this.el.parentNode&&(this.hoverMenu=e,this.playbackControls=this.el.querySelector(".video-playback"),this.playPauseButton=this.el.querySelector(".video-playpause-button"),this.volumeUpButton=this.el.querySelector(".video-volume-up-button"),this.volumeDownButton=this.el.querySelector(".video-volume-down-button"),this.seekForwardButton=this.el.querySelector(".video-seek-forward-button"),this.seekBackButton=this.el.querySelector(".video-seek-back-button"),this.snapButton=this.el.querySelector(".video-snap-button"),this.timeLabel=this.el.querySelector(".video-time-label"),this.volumeLabel=this.el.querySelector(".video-volume-label"),this.linkButton=this.el.querySelector(".video-link-button"),this.playPauseButton.object3D.addEventListener("interact",this.togglePlaying),this.seekForwardButton.object3D.addEventListener("interact",this.seekForward),this.seekBackButton.object3D.addEventListener("interact",this.seekBack),this.volumeUpButton.object3D.addEventListener("interact",this.volumeUp),this.volumeDownButton.object3D.addEventListener("interact",this.volumeDown),this.snapButton.object3D.addEventListener("interact",this.snap),this.updateVolumeLabel(),this.updateHoverMenu(),this.updatePlaybackState())})),NAF.utils.getNetworkedEntity(this.el).then((e=>{this.networkedEl=e,Gi(this.networkedEl.components.networked.data.networkId),this.updatePlaybackState(),this.networkedEl.addEventListener("pinned",this.updateHoverMenu),this.networkedEl.addEventListener("unpinned",this.updateHoverMenu),window.APP.hubChannel.addEventListener("permissions_updated",this.updateHoverMenu),Ov||"scene"!==NAF.utils.getNetworkOwner(this.networkedEl)||setTimeout((()=>{"scene"===NAF.utils.getNetworkOwner(this.networkedEl)&&NAF.utils.takeOwnership(this.networkedEl)}),2e3+Math.floor(2e3*Math.random()))})).catch((()=>{this.updatePlaybackState()}));let{disableLeftRightPanning:e,audioPanningQuality:t}=APP.store.state.preferences;this.onPreferenceChanged=()=>{const n=APP.store.state.preferences.disableLeftRightPanning,i=APP.store.state.preferences.audioPanningQuality,r=e!==n&&this.audio&&this.mediaElementAudioSource,o=t!==i;e=n,t=i,r?this.setupAudio():o&&rm(this.el,this.audio)},APP.store.addEventListener("statechanged",this.onPreferenceChanged),this.el.addEventListener("audio_type_changed",this.setupAudio)},play(){this.el.components["listed-media"]&&this.el.sceneEl.emit("listed_media_changed")},isMineOrLocal(){return!this.el.components.networked||this.networkedEl&&NAF.utils.isMine(this.networkedEl)},ensureOwned(){return!this.el.components.networked||this.networkedEl&&NAF.utils.isMine(this.networkedEl)||NAF.utils.takeOwnership(this.networkedEl)},seekForward(){!this.videoIsLive&&this.ensureOwned()&&(this.video.currentTime+=30,this.el.setAttribute("media-video","time",this.video.currentTime))},seekBack(){!this.videoIsLive&&this.ensureOwned()&&(this.video.currentTime-=10,this.el.setAttribute("media-video","time",this.video.currentTime))},changeVolumeBy(e){let t=APP.gainMultipliers.get(this.el);t=xv.MathUtils.clamp(t+e,0,2),APP.gainMultipliers.set(this.el,t),this.updateVolumeLabel();const n=APP.audios.get(this.el);n&&rm(this.el,n)},volumeUp(){this.changeVolumeBy(.2)},volumeDown(){this.changeVolumeBy(-.2)},snap(){var e=this;return Pv((function*(){if(e.isSnapping)return;e.isSnapping=!0,e.el.sceneEl.systems["hubs-systems"].soundEffectsSystem.playSoundOneShot(_m);const t=document.createElement("canvas");t.width=e.video.videoWidth,t.height=e.video.videoHeight,t.getContext("2d").drawImage(e.video,0,0,t.width,t.height);const n=yield new Promise((e=>t.toBlob(e))),i=new File([n],"snap.png",kv);e.localSnapCount++;const{entity:r}=Hl(e.el,i,"photo-snapshot",e.localSnapCount);r.addEventListener("image-loaded",e.onSnapImageLoaded,Cv)}))()},togglePlaying(){Ov&&this.video.paused&&this.isMineOrLocal()?this.video.play():this.ensureOwned()&&this.tryUpdateVideoPlaybackState(!this.data.videoPaused)},onPauseStateChange(){Ov&&this.video.paused&&this.isMineOrLocal()||this._ignorePauseStateChanges||(this.el.setAttribute("media-video","videoPaused",this.video.paused),this.video.paused?APP.isAudioPaused.add(this.el):APP.isAudioPaused.delete(this.el),this.networkedEl&&NAF.utils.isMine(this.networkedEl)&&this.el.emit("owned-video-state-changed"))},updatePlaybackState(e){this.updateHoverMenu(),this.video&&(e||this.networkedEl&&!NAF.utils.isMine(this.networkedEl))&&(Math.abs(this.data.time-this.video.currentTime)>this.data.syncTolerance?this.tryUpdateVideoPlaybackState(this.data.videoPaused,this.data.time):this.tryUpdateVideoPlaybackState(this.data.videoPaused))},tryUpdateVideoPlaybackState(e,t){this._playbackStateChangeTimeout&&(clearTimeout(this._playbackStateChangeTimeout),delete this._playbackStateChangeTimeout),!1===this.videoIsLive&&void 0!==t&&(this.video.currentTime=t),this.hoverMenu&&this.playPauseButton.setAttribute("icon-button","active",e),e?this.video.pause():this.video.play().catch((()=>{e===this.data.videoPaused&&(this._playbackStateChangeTimeout=setTimeout((()=>this.tryUpdateVideoPlaybackState(e,t)),1e3))}))},update(e){this.updatePlaybackState(),this.data.src&&this.data.src!==e.src&&this.updateSrc(e)},setupAudio(){this.removeAudio(),APP.sourceType.set(this.el,mh.MEDIA_VIDEO),this.data.videoPaused?APP.isAudioPaused.add(this.el):APP.isAudioPaused.delete(this.el);const{audioType:e}=nm(this.el),t=this.el.sceneEl.audioListener;e===fh.PannerNode?this.audio=new xv.PositionalAudio(t):this.audio=new xv.Audio(t),this.audio.gain.gain.value=0,this.audioSystem.addAudio({sourceType:mh.MEDIA_VIDEO,node:this.audio}),this.audio.setNodeSource(this.mediaElementAudioSource),this.el.setObject3D("sound",this.audio),this.audio.updateMatrixWorld(),APP.audios.set(this.el,this.audio),rm(this.el,this.audio),this.mediaElementAudioSource.mediaElement.volume=1},updateSrc(e){var t=this;return Pv((function*(){const{src:n,linkedVideoTexture:i,linkedAudioSource:r,linkedMediaElementAudioSource:o}=t.data;let s,a;t.cleanUp(),t.mesh&&t.mesh.material&&(t.mesh.material.map=null,t.mesh.material.needsUpdate=!0);try{if(i?(s=i,a=r):(t.el.emit("video-loading"),({texture:s,audioSourceEl:a}=yield t.createVideoTextureAudioSourceEl()),bv()===t.el&&(yield function(){return yv.apply(this,arguments)}())),t.hasAudioTracks=!!(l=a)&&(void 0!==l.audioTracks?l.audioTracks.length>0:0===l.videoWidth&&0===l.videoHeight||(void 0!==l.mozHasAudio?l.mozHasAudio:void 0!==l.webkitAudioDecodedByteCount&&l.webkitAudioDecodedByteCount>0)),t.data.src!==n)return void wo(s);if(t.mediaElementAudioSource=null,n.startsWith("hubs://")||Ov&&!_v().satisfies((0,Ct.detect)().version,">=13.1.2")||(t.mediaElementAudioSource=o||t.el.sceneEl.audioListener.context.createMediaElementSource(a),t.hasAudioTracks&&t.setupAudio()),t.video=s.image,t.video.loop=t.data.loop,t.video.addEventListener("pause",t.onPauseStateChange),t.video.addEventListener("play",t.onPauseStateChange),s.hls){const e=()=>{s.hls.currentLevel>=0&&(t.videoIsLive=s.hls.levels[s.hls.currentLevel].details.live,t.updateHoverMenu())};s.hls.on(_l().Events.LEVEL_LOADED,e),s.hls.on(_l().Events.LEVEL_SWITCHED,e),s.hls.currentLevel>=0&&e()}else t.videoIsLive=t.video.duration===1/0,t.updateHoverMenu();if(Ov){const e=document.getElementById("video-unmute");t.el.appendChild(document.importNode(e.content,!0)),t.el.setAttribute("position-at-border__unmute-ui",{target:".unmute-ui",isFlat:!0})}t.videoTexture=s,t.audioSource=a}catch(e){console.error("Error loading video",t.data.src,e),s=Ka,t.videoTexture=t.audioSource=null}var l;const c=t.data.projection;if(!t.mesh||c!==e.projection){const e=new xv.MeshBasicMaterial;let n;e.toneMapped=!1,"360-equirectangular"===c?(n=new xv.SphereBufferGeometry(1,64,32),n.scale(-1,1,1)):(n=Bo(void 0,void 0,void 0,void 0,s.isVideoTexture?s.flipY:Tv.flipY),e.side=xv.DoubleSide),t.mesh=new xv.Mesh(n,e),t.mesh.layers.set(_o.CAMERA_LAYER_FX_MASK),t.el.setObject3D("mesh",t.mesh)}s.isVideoTexture?(t.mesh.material.map=s,"flat"===c&&Ev(t.el,(s.image.videoHeight||s.image.height)/(s.image.videoWidth||s.image.width))):t.mesh.material.map=Tv,t.mesh.material.needsUpdate=!0,t.updatePlaybackState(!0),t.video&&t.video.muted&&(t.videoMutedAt=performance.now()),t.el.emit("video-loaded",{projection:c})}))()},createVideoTextureAudioSourceEl(){var e=this;return Pv((function*(){const t=e.data.src,n=e.data.contentType;let i;return new Promise(function(){var r=Pv((function*(r,o){e._audioSyncInterval&&(clearInterval(e._audioSyncInterval),e._audioSyncInterval=null);let s=!1;const a=function(e){s||(s=!0,clearTimeout(i),o(e))},l=Gl("video");let c,d,u;if(n.startsWith("audio/")?(c=new xv.Texture,c.image=l,u=()=>l.readyState>0):(c=new xv.VideoTexture(l),c.minFilter=xv.LinearFilter,c.encoding=xv.sRGBEncoding,u=()=>{if(c.hls&&c.hls.streamController.audioOnly){d=l;const e=c.hls;return c=new xv.Texture,c.image=l,c.hls=e,!0}return(c.image.videoHeight||c.image.height)&&(c.image.videoWidth||c.image.width)}),t.startsWith("hubs://")){const n=t.substring(7).split("/")[1],i=yield APP.dialog.getMediaStream(n,"video");e._onStreamUpdated&&APP.dialog.off("stream_updated",e._onStreamUpdated),e._onStreamUpdated=function(){var e=Pv((function*(e,t){if(e===n&&"video"===t){const t=yield APP.dialog.getMediaStream(e,"video").catch((t=>{console.error(`Error getting video stream for ${e}`,t)}));t&&(l.srcObject=new MediaStream(t))}}));return function(t,n){return e.apply(this,arguments)}}(),APP.dialog.on("stream_updated",e._onStreamUpdated,e),l.srcObject=new MediaStream(i.getVideoTracks())}else n.startsWith("application/dash")?c.dash=Jl(t,l,a):AFRAME.utils.material.isHLS(t,n)?_l().isSupported()?(c.hls&&(c.hls.stopLoad(),c.hls.detachMedia(),c.hls.destroy(),c.hls=null),c.hls=ec(t,l,a)):l.canPlayType(n)?(l.src=t,l.onerror=a):a("HLS unsupported"):(l.src=t,l.onerror=Sv?Pv((function*(){l.onerror=a;try{const e=yield fetch(t);l.srcObject=yield e.blob()}catch(e){a(e)}})):a,e.data.audioSrc&&(l.muted=!0,d=Gl("audio"),d.src=e.data.audioSrc,d.onerror=a,e._audioSyncInterval=setInterval((()=>{Math.abs(d.currentTime-l.currentTime)>=.33&&(d.currentTime=l.currentTime),l.paused!==d.paused&&(l.paused?d.pause():d.play(),d.currentTime=l.currentTime)}),1e3)));const h=()=>{u()?(s=!0,r({texture:c,audioSourceEl:d||c.image})):i=setTimeout(h,500)};h()}));return function(e,t){return r.apply(this,arguments)}}())}))()},updateHoverMenu(){if(!this.hoverMenu)return;const e=this.el.components["media-loader"].data,t=e.linkedEl||this.el,n=t.components.pinnable&&t.components.pinnable.data.pinned;this.playbackControls.object3D.visible=!this.data.hidePlaybackControls&&!!this.video,this.timeLabel.object3D.visible=!this.data.hidePlaybackControls,this.volumeLabel.object3D.visible=this.volumeUpButton.object3D.visible=this.volumeDownButton.object3D.visible=this.hasAudioTracks&&!this.data.hidePlaybackControls&&!!this.video,this.snapButton.object3D.visible=!!this.video&&!this.data.contentType.startsWith("audio/")&&window.APP.hubChannel.can("spawn_and_move_media"),this.seekForwardButton.object3D.visible=!!this.video&&!this.videoIsLive;const i=!!this.video&&!this.videoIsLive&&(!n||window.APP.hubChannel.can("pin_objects"));this.playPauseButton.object3D.visible=this.seekForwardButton.object3D.visible=this.seekBackButton.object3D.visible=i,this.linkButton.object3D.visible=!!e.mediaOptions.href,this.videoIsLive&&this.timeLabel.setAttribute("text","value","LIVE")},updateVolumeLabel(){const e=APP.gainMultipliers.get(this.el);this.volumeLabel.setAttribute("text","value",0===e?"MUTE":Rv[Math.floor(e/.1)])},tick:function(){if(!this.video)return;const e=this.el.sceneEl.systems.userinput,t=this.el.sceneEl.systems.interaction,n=e.get(zm.actions.cursor.right.mediaVolumeMod);t.state.rightRemote.hovered===this.el&&n&&this.changeVolumeBy(n);const i=e.get(zm.actions.cursor.left.mediaVolumeMod);t.state.leftRemote.hovered===this.el&&i&&this.changeVolumeBy(i);const r=t.isHeld(this.el);if(this.wasHeld&&!r&&(this.localSnapCount=0),this.wasHeld=r,this.hoverMenu&&this.hoverMenu.object3D.visible&&!this.videoIsLive&&this.timeLabel.setAttribute("text","value",`${Dv(this.video.currentTime)} / ${Dv(this.video.duration)}`),!this.data.videoPaused&&!1===this.videoIsLive&&this.networkedEl&&NAF.utils.isMine(this.networkedEl)){const e=performance.now();e-this.lastUpdate>this.data.tickRate&&(this.el.setAttribute("media-video","time",this.video.currentTime),this.lastUpdate=e)}},cleanUp(){this.videoTexture&&!this.data.linkedVideoTexture&&wo(this.videoTexture)},remove(){this.cleanUp(),APP.isAudioPaused.delete(this.el),this.mesh&&this.el.removeObject3D("mesh"),this._audioSyncInterval&&(clearInterval(this._audioSyncInterval),this._audioSyncInterval=null),APP.gainMultipliers.delete(this.el),APP.audios.delete(this.el),APP.sourceType.delete(this.el),APP.supplementaryAttenuation.delete(this.el),this.removeAudio(),this.networkedEl&&(this.networkedEl.removeEventListener("pinned",this.updateHoverMenu),this.networkedEl.removeEventListener("unpinned",this.updateHoverMenu)),window.APP.hubChannel.removeEventListener("permissions_updated",this.updateHoverMenu),this.video&&(this.video.removeEventListener("pause",this.onPauseStateChange),this.video.removeEventListener("play",this.onPauseStateChange),APP.dialog.off("stream_updated",this._onStreamUpdated)),this.hoverMenu&&(this.playPauseButton.object3D.removeEventListener("interact",this.togglePlaying),this.volumeUpButton.object3D.removeEventListener("interact",this.volumeUp),this.volumeDownButton.object3D.removeEventListener("interact",this.volumeDown),this.seekForwardButton.object3D.removeEventListener("interact",this.seekForward),this.seekBackButton.object3D.removeEventListener("interact",this.seekBack),this.snapButton.object3D.removeEventListener("interact",this.snap)),window.APP.store.removeEventListener("statechanged",this.onPreferenceChanged),this.el.addEventListener("audio_type_changed",this.setupAudio)},removeAudio(){this.audio&&(this.el.removeObject3D("sound"),this.audioSystem.removeAudio({node:this.audio}),delete this.audio)}});var jv=n(99477);function Lv(e,t,n,i,r,o,s){try{var a=e[o](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(i,r)}function Iv(e){return function(){var t=this,n=arguments;return new Promise((function(i,r){var o=e.apply(t,n);function s(e){Lv(o,i,r,s,a,"next",e)}function a(e){Lv(o,i,r,s,a,"throw",e)}s(void 0)}))}}const Nv={once:!0},Fv={type:"image/png"};Hc.GlobalWorkerOptions.workerSrc=n(44412).Z,AFRAME.registerComponent("media-pdf",{schema:{src:{type:"string"},projection:{type:"string",default:"flat"},contentType:{type:"string"},index:{default:0}},init(){this.snap=this.snap.bind(this),this.canvas=document.createElement("canvas"),this.canvasContext=this.canvas.getContext("2d"),this.localSnapCount=0,this.isSnapping=!1,this.onSnapImageLoaded=()=>this.isSnapping=!1,this.texture=new jv.CanvasTexture(this.canvas),this.texture.encoding=jv.sRGBEncoding,this.texture.minFilter=jv.LinearFilter,this.el.addEventListener("pager-snap-clicked",(()=>this.snap()))},play(){this.el.components["listed-media"]&&this.el.sceneEl.emit("listed_media_changed")},snap(){var e=this;return Iv((function*(){if(e.isSnapping)return;e.isSnapping=!0,e.el.sceneEl.systems["hubs-systems"].soundEffectsSystem.playSoundOneShot(_m);const t=yield new Promise((t=>e.canvas.toBlob(t))),n=new File([t],"snap.png",Fv);e.localSnapCount++;const{entity:i}=Hl(e.el,n,"photo-snapshot",e.localSnapCount,!1,1);i.addEventListener("image-loaded",e.onSnapImageLoaded,Nv)}))()},update(e){var t=this;return Iv((function*(){let n,i=1;try{const{src:r,index:o}=t.data;if(!r)return;if(t.renderTask&&(yield t.renderTask.promise,r!==t.data.src||o!==t.data.index))return;if(t.el.emit("pdf-loading"),r!==e.src){const e=t.data.src,n=yield Hc.getDocument(r).promise;if(e!==t.data.src)return;t.pdf=n,t.el.setAttribute("media-pager",{maxIndex:t.pdf.numPages-1})}const s=yield t.pdf.getPage(o+1);if(r!==t.data.src||o!==t.data.index)return;const a=s.getViewport({scale:3}),l=a.width,c=a.height;if(n=t.texture,i=c/l,t.canvas.width=l,t.canvas.height=c,t.renderTask=s.render({canvasContext:t.canvasContext,viewport:a}),yield t.renderTask.promise,t.renderTask=null,r!==t.data.src||o!==t.data.index)return}catch(e){console.error("Error loading PDF",t.data.src,e),n=Ka}if(!t.mesh){const e=new jv.MeshBasicMaterial,i=Bo(1,1,1,1,n.flipY);e.side=jv.DoubleSide,t.mesh=new jv.Mesh(i,e),t.el.setObject3D("mesh",t.mesh)}t.mesh.material.transparent=n==Ka,t.mesh.material.map=n,t.mesh.material.map.needsUpdate=!0,t.mesh.material.needsUpdate=!0,Ev(t.el,i),t.el.components["media-pager"]&&t.el.components["media-pager"].data.index!==t.data.index&&t.el.setAttribute("media-pager",{index:t.data.index}),t.el.emit("pdf-loaded",{src:t.data.src})}))()}});var Bv=n(99477);function Vv(e,t,n,i,r,o,s){try{var a=e[o](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(i,r)}const Uv=new nl,Hv=new Map,zv={texture:Ka,ratio:1400/1200};AFRAME.registerComponent("media-image",{schema:{src:{type:"string"},version:{type:"number"},projection:{type:"string",default:"flat"},contentType:{type:"string"},alphaMode:{type:"string",default:void 0},alphaCutoff:{type:"number"}},play(){this.el.components["listed-media"]&&this.el.sceneEl.emit("listed_media_changed")},remove(){this.currentSrcIsRetained&&(Uv.release(this.data.src,this.data.version),this.currentSrcIsRetained=!1)},update(e){var t,n=this;return(t=function*(){let t,i=1;try{const{src:r,version:o,contentType:s}=n.data;if(!r)return;let a;if(n.el.emit("image-loading"),n.mesh&&n.mesh.material.map&&(r!==e.src||o!==e.version)&&(n.mesh.material.map=null,n.mesh.material.needsUpdate=!0,n.mesh.material.map!==Ka&&(Uv.release(e.src,e.version),n.currentSrcIsRetained=!1)),Uv.has(r,o))a=n.currentSrcIsRetained?Uv.get(r,o):Uv.retain(r,o);else{const e=nl.key(r,o);if("error"===r)a=zv;else if(Hv.has(e))yield Hv.get(e),a=Uv.retain(r,o);else{let n;if(s.includes("image/gif"))n=uc(r);else if(s.includes("image/basis"))n=oc(r);else if(s.includes("image/ktx2"))n=sc(r);else{if(!s.startsWith("image/"))throw new Error(`Unknown image content type: ${s}`);n=Wl(r)}Hv.set(e,n),t=yield n,Hv.delete(e),a=Uv.set(r,o,t)}if(n.data.src!==r||n.data.version!==o||!n.el.parentNode)return void Uv.release(r,o)}t=a.texture,i=a.ratio,n.currentSrcIsRetained=!0}catch(e){console.error("Error loading image",n.data.src,e),t=Ka,n.currentSrcIsRetained=!1}const r=n.data.projection;if(!n.mesh||r!==e.projection){const e=new Bv.MeshBasicMaterial;let i;if(e.toneMapped=!1,"360-equirectangular"===r){if(i=new Bv.SphereBufferGeometry(1,64,32),i.scale(-1,1,1),!t.flipY){const e=i.attributes.uv.array;for(let t=1;t<e.length;t+=2)e[t]=1-e[t]}}else i=Bo(1,1,1,1,t.flipY),e.side=Bv.DoubleSide;n.mesh=new Bv.Mesh(i,e),n.mesh.layers.set(_o.CAMERA_LAYER_FX_MASK),n.el.setObject3D("mesh",n.mesh)}if(t==Ka)n.mesh.material.transparent=!0;else switch(n.data.alphaMode){case"opaque":n.mesh.material.transparent=!1;break;case"mask":n.mesh.material.transparent=!1,n.mesh.material.alphaTest=n.data.alphaCutoff;break;default:n.mesh.material.transparent=!0,n.mesh.material.alphaTest=0}n.mesh.material.map=t,n.mesh.material.needsUpdate=!0,"flat"===r&&Ev(n.el,i),n.el.emit("image-loaded",{src:n.data.src,projection:r})},function(){var e=this,n=arguments;return new Promise((function(i,r){var o=t.apply(e,n);function s(e){Vv(o,i,r,s,a,"next",e)}function a(e){Vv(o,i,r,s,a,"throw",e)}s(void 0)}))})()}});const Wv=21,qv=8,Zv=1/(Wv/2),Gv=(qv-1)/(Wv/2);function Yv(e){return Math.min(Wv-1,e<=1.001?Math.floor(e/Zv):Math.floor(Wv/2+(e-1)/Gv))}function Qv(e,t,n){const i=APP.store.state.preferences.avatarVoiceLevels||{};i[e]={gainMultiplier:t,muted:n},APP.store.update({preferences:{avatarVoiceLevels:i}})}var Xv=n(99477);AFRAME.registerComponent("avatar-volume-controls",{init(){this.volumeUp=this.volumeUp.bind(this),this.volumeDown=this.volumeDown.bind(this),this.volumeUpButton=this.el.querySelector(".avatar-volume-up-button"),this.volumeDownButton=this.el.querySelector(".avatar-volume-down-button"),this.muteButton=this.el.querySelector(".avatar-mute-button"),this.volumeLabel=this.el.querySelector(".avatar-volume-label"),this.volumeUpButton.object3D.addEventListener("interact",this.volumeUp),this.volumeDownButton.object3D.addEventListener("interact",this.volumeDown),this.update=this.update.bind(this),this.normalizer=null,window.APP.store.addEventListener("statechanged",this.update),this.audioEl=this.el.parentEl.parentEl.querySelector("[avatar-audio-source]"),this.playerInfo=lp(this.el,"player-info").components["player-info"],this.onRemoteMuteUpdated=this.onRemoteMuteUpdated.bind(this),this.playerInfo.el.addEventListener("remote_mute_updated",this.onRemoteMuteUpdated),this.muteButton.object3D.visible=this.playerInfo.data.muted;const e=(t=this.playerInfo.displayName,null===(n=APP.store.state.preferences.avatarVoiceLevels)||void 0===n?void 0:n[t]);var t,n;this.updateGainMultiplier(void 0===e?1:e.gainMultiplier),this.updateLocalMuted(void 0!==e&&e.muted)},remove(){APP.gainMultipliers.delete(this.audioEl),window.APP.store.removeEventListener("statechanged",this.update),this.playerInfo.el.removeEventListener("remote_mute_updated",this.onRemoteMuteUpdated)},updateGainMultiplier(e,t){void 0===t&&(t=!1),APP.gainMultipliers.set(this.audioEl,e);const n=APP.audios.get(this.audioEl);n&&rm(this.audioEl,n),this.updateVolumeLabel(),this.el.emit("gain_multiplier_updated",{gainMultiplier:e});const i=APP.mutedState.has(this.audioEl);t&&Qv(this.playerInfo.displayName,e,i)},updateLocalMuted(e,t){void 0===t&&(t=!1),!0===e?APP.mutedState.add(this.audioEl):APP.mutedState.delete(this.audioEl);const n=APP.audios.get(this.audioEl);n&&rm(this.audioEl,n),this.updateVolumeLabel(),this.el.emit("local_muted_updated",{muted:e});const i=APP.gainMultipliers.get(this.audioEl),r=APP.mutedState.has(this.audioEl);t&&Qv(this.playerInfo.displayName,i,r)},volumeUp(){let e=APP.gainMultipliers.get(this.audioEl);const t=function(e){return e>1-Zv?Gv:Zv}(e);e=Xv.MathUtils.clamp(e+t,0,qv),this.updateGainMultiplier(e,!0)},volumeDown(){let e=APP.gainMultipliers.get(this.audioEl);const t=-function(e){return e>1+Zv?Gv:Zv}(e);e=Xv.MathUtils.clamp(e+t,0,qv),this.updateGainMultiplier(e,!0)},updateVolumeLabel(){const e=APP.gainMultipliers.get(this.audioEl),t=APP.mutedState.has(this.audioEl),n=Yv(e);this.volumeLabel.setAttribute("text","value",0===e||t?"Muted":Rv[n])},onRemoteMuteUpdated(e){let{detail:{muted:t}}=e;this.el.sceneEl.systems.permissions.canOrWillIfCreator("mute_users")&&this.muteButton.object3D.traverse((e=>{e.visible=!t}))}}),AFRAME.registerComponent("pinch-to-move",{schema:{speed:{default:.25}},init(){this.axis=[0,0]},tick(){const e=AFRAME.scenes[0].systems.userinput.get(zm.device.touchscreen.pinchDelta);e&&(this.axis[1]=e*this.data.speed,this.el.emit("move",{axis:this.axis}))}});var Kv=n(99477);const $v=function(){const e=new Kv.Quaternion,t=new Kv.Quaternion,n=new Kv.Quaternion,i=new Kv.Quaternion,r=new Kv.Quaternion,o=new Kv.Quaternion,s=new Kv.Vector3,a=new Kv.Vector3,l=new Kv.Vector3(0,1,0);return function(c,d,u){c.parent.updateMatrices(),c.updateMatrices(),c.parent.getWorldQuaternion(e),c.getWorldQuaternion(t),n.copy(c.quaternion),a.set(0,1,0).applyQuaternion(n);const h=a.dot(l);a.set(0,0,1).applyQuaternion(n);const p=Math.abs(a.dot(l));s.set(1,0,0).applyQuaternion(t),i.setFromAxisAngle(s,d),r.setFromAxisAngle(l,u),o.copy(t).premultiply(i).premultiply(r).premultiply(e.invert()),a.set(0,1,0).applyQuaternion(o);const m=a.dot(l);a.set(0,0,1).applyQuaternion(o);const f=Math.abs(a.dot(l));f>.9&&f>p||m<0&&m<h||(c.quaternion.copy(o),c.matrixNeedsUpdate=!0,c.updateMatrices())}}();let Jv,eb;AFRAME.registerComponent("pitch-yaw-rotator",{init(){this.pendingXRotation=0,this.el.sceneEl.addEventListener("rotateX",(e=>{this.pendingXRotation+=e.detail})),this.on=!0},tick(){if(this.on){const e=AFRAME.scenes[0],t=e.systems.userinput;Jv=Jv||document.getElementById("ui-root"),eb=eb||document.getElementById("scene-preview-node");const n=!e.is("entered"),i=n&&Jv&&Jv.firstChild&&Jv.firstChild.classList.contains("isGhost"),r=t.get(n?zm.actions.lobbyCameraDelta:zm.actions.cameraDelta);r?$v(n&&!i?eb.object3D:this.el.object3D,this.pendingXRotation+r[1],r[0]):this.pendingXRotation&&$v(n&&!i?eb.object3D:this.el.object3D,this.pendingXRotation,0)}this.pendingXRotation=0}});var tb=n(99477);const nb=(new tb.Quaternion).setFromAxisAngle(new tb.Vector3(0,1,0),Math.PI),ib=function(){const e=new tb.Vector3,t=new tb.Vector3;return function(n,i,r,o,s){n.updateMatrices();const a=i.min,l=i.max;r.addVectors(a,l).multiplyScalar(.5).applyMatrix4(n.matrixWorld),t.setFromMatrixScale(n.matrixWorld),o.subVectors(l,a).multiplyScalar(.5).multiply(t),e.setFromMatrixPosition(n.matrixWorld),s.subVectors(r,e)}}(),rb=function(){const e=new tb.Vector3,t=new tb.Vector3,n=new tb.Vector3,i=new tb.Vector3,r=new tb.Matrix4;return function(o,s,a,l,c){a?n.subVectors(o,l).normalize():n.set(0,0,1).applyMatrix4(s).normalize(),t.set(0,1,0),i.copy(n).multiplyScalar(-1),e.crossVectors(i,t).normalize(),t.crossVectors(e,i),r.makeBasis(e,t,n),c.setFromRotationMatrix(r)}}(),ob=[];AFRAME.registerComponent("position-at-border",{multiple:!0,schema:{target:{type:"string"},isFlat:{default:!1},animate:{default:!0},scale:{default:!0}},init(){this.ready=!1,this.didInit=!1,this.tick2=this.tick2.bind(this),this.doInit=this.doInit.bind(this),ob.push(this)},doInit(){if(this.didInit=!0,this.cam=document.getElementById("viewing-camera").object3DMap.camera,!this.data.target)return void console.error("No target for position-at-border on element:",this.el);const e=this.el.querySelector(this.data.target);e?(this.data.animate&&(this.didRegisterWithAnimationSystem=!0,this.el.sceneEl.systems["hubs-systems"].menuAnimationSystem.register(this,e,this.data.scale)),this.target=e.object3D,this.wasVisible=!1,this.previousMesh=null,this.meshLocalBoundingBox=new tb.Box3,this.meshCenter=new tb.Vector3,this.meshHalfExtents=new tb.Vector3,this.meshOffsetToCenter=new tb.Vector3,this.isTargetBoundingBoxDirty=!0,this.targetLocalBoundingBox=new tb.Box3,this.targetCenter=new tb.Vector3,this.targetHalfExtents=new tb.Vector3,this.targetOffsetToCenter=new tb.Vector3,this.ready=!0):console.error(`Could not find ${this.data.target} underneath element:`,this.el)},remove(){this.didRegisterWithAnimationSystem&&this.el.sceneEl.systems["hubs-systems"].menuAnimationSystem.unregister(this),ob.splice(ob.indexOf(this),1)},markDirty(){this.isTargetBoundingBoxDirty=!0},tick2:function(){const e=new tb.Vector3,t=new tb.Matrix4,n=new tb.Vector3,i=new tb.Vector3,r=new tb.Vector3,o=new tb.Vector3,s=new tb.Quaternion,a=new tb.Vector3,l=new tb.Vector3,c=new tb.Matrix4,d=new tb.Vector3,u=new tb.Matrix4,h=new tb.Vector3,p=new tb.Vector3,m=new tb.Vector3;return function(){if(this.didInit||this.doInit(),!this.ready)return;const f=this.el.getObject3D("mesh");if(!f)return;const g=this.target.visible,v=g&&!this.wasVisible;if(this.wasVisible=g,!v)return;if(this.isTargetBoundingBoxDirty){if(Tp(this.target,this.targetLocalBoundingBox,!0),this.targetLocalBoundingBox.min.x===1/0)return;this.isTargetBoundingBoxDirty=!1}ib(this.target,this.targetLocalBoundingBox,this.targetCenter,this.targetHalfExtents,this.targetOffsetToCenter),f!==this.previousMesh&&(Tp(f,this.meshLocalBoundingBox,!0),this.previousMesh=f),ib(f,this.meshLocalBoundingBox,this.meshCenter,this.meshHalfExtents,this.meshOffsetToCenter),u.extractRotation(f.matrixWorld),p.set(0,0,-1).applyMatrix4(u),this.cam.updateMatrices(),e.setFromMatrixPosition(this.cam.matrixWorld),t.extractRotation(this.cam.matrixWorld),n.subVectors(e,this.meshCenter);const b=this.data.isFlat&&p.dot(n)>0,y=this.el.sceneEl.systems.interaction.getActiveIntersection(),w=.5*m.subVectors(this.meshLocalBoundingBox.max,this.meshLocalBoundingBox.min).multiply(h.setFromMatrixScale(f.matrixWorld)).length();if(this.data.isFlat)r.copy(this.meshCenter).add(d.set(0,0,this.meshHalfExtents.z+this.targetHalfExtents.z+.02).multiplyScalar(b?-1:1).applyMatrix4(u));else if(w+2>n.length())r.lerpVectors(e,y?y.point:this.meshCenter,y?.8:.25);else if(y){const t=n.length()-w;i.subVectors(y.point,e),r.copy(e).add(i.normalize().multiplyScalar(t))}else n.normalize().multiplyScalar(w),r.copy(this.meshCenter).add(n);if(this.data.scale){const t=n.subVectors(e,r).length();l.setScalar(tb.MathUtils.clamp(.45*t,.05,4))}else l.setFromMatrixScale(this.target.matrixWorld);this.data.scale?o.copy(r).sub(this.targetOffsetToCenter.divide(a.setFromMatrixScale(this.target.matrixWorld)).multiply(l)):o.copy(this.meshCenter).add(d.set(0,0,this.meshHalfExtents.z+this.targetHalfExtents.z+.02).multiplyScalar(b?-1:1).applyMatrix4(u)),this.data.isFlat?(s.setFromRotationMatrix(u),b&&s.multiply(nb)):rb(e,t,this.el.sceneEl.is("vr-mode"),o,s),c.compose(o,s,l),Oo(this.target,c)}}()});class sb{constructor(){}tick(){for(let e=0;e<ob.length;e++)ob[e].tick2()}}function ab(e,t,n,i,r,o,s){try{var a=e[o](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(i,r)}function lb(e){return function(){var t=this,n=arguments;return new Promise((function(i,r){var o=e.apply(t,n);function s(e){ab(o,i,r,s,a,"next",e)}function a(e){ab(o,i,r,s,a,"throw",e)}s(void 0)}))}}function cb(e,t,n,i,r,o,s){try{var a=e[o](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(i,r)}function db(e){return function(){var t=this,n=arguments;return new Promise((function(i,r){var o=e.apply(t,n);function s(e){cb(o,i,r,s,a,"next",e)}function a(e){cb(o,i,r,s,a,"throw",e)}s(void 0)}))}}AFRAME.registerComponent("pinnable",{schema:{pinned:{default:!1}},init(){this._persist=this._persist.bind(this),this._persistAndAnimate=this._persistAndAnimate.bind(this),this.el.addEventListener("media_refreshed",this._persistAndAnimate),this.el.addEventListener("owned-pager-page-changed",this._persist),this.el.addEventListener("owned-video-state-changed",this._persistAndAnimate),(0,Ot.addComponent)(APP.world,Nn,this.el.object3D.eid)},update(){this._animate(),this.data.pinned?(0,Ot.addComponent)(APP.world,Fn,this.el.object3D.eid):(0,Ot.removeComponent)(APP.world,Fn,this.el.object3D.eid)},_persistAndAnimate(){this._persist(),this._animate()},_persist(){window.APP.pinningHelper.setPinned(this.el,this.data.pinned)},_isMine(){var e;return(null===(e=this.el.components.networked)||void 0===e?void 0:e.data)&&NAF.utils.isMine(this.el)},_animate(){var e,t;const n=(null===(e=this.el.components["animation__pin-start"])||void 0===e?void 0:e.animationIsPlaying)||(null===(t=this.el.components["animation__pin-end"])||void 0===t?void 0:t.animationIsPlaying);if(this._isMine()&&this.data.pinned&&!n){this.el.removeAttribute("animation__pin-start"),this.el.removeAttribute("animation__pin-end");const e=this.el.object3D.scale;this.el.setAttribute("animation__pin-start",{property:"scale",dur:200,from:{x:e.x,y:e.y,z:e.z},to:{x:1.1*e.x,y:1.1*e.y,z:1.1*e.z},easing:"easeOutElastic"}),this.el.setAttribute("animation__pin-end",{property:"scale",delay:200,dur:200,from:{x:1.1*e.x,y:1.1*e.y,z:1.1*e.z},to:{x:e.x,y:e.y,z:e.z},easing:"easeOutElastic"}),this.el.components["body-helper"]&&!this.el.sceneEl.systems.interaction.isHeld(this.el)&&this.el.setAttribute("body-helper",{type:"kinematic"})}},tick(){const e=this.el.sceneEl.systems.interaction.isHeld(this.el),t=this._isMine();let n=!1;!e&&this.wasHeld&&t&&(n=!0,this._persistAndAnimate()),this.wasHeld=e,this.transformObjectSystem=this.transformObjectSystem||AFRAME.scenes[0].systems["transform-selected-object"];const i=this.transformObjectSystem.transforming&&this.transformObjectSystem.target.el===this.el;!n&&!i&&this.wasTransforming&&t&&this._persistAndAnimate(),this.wasTransforming=i}}),AFRAME.registerComponent("pin-networked-object-button",{schema:{tipSelector:{type:"string"},labelSelector:{type:"string"}},init(){this._updateUI=this._updateUI.bind(this),this._updateUIOnStateChange=this._updateUIOnStateChange.bind(this),this.el.sceneEl.addEventListener("stateadded",this._updateUIOnStateChange),this.el.sceneEl.addEventListener("stateremoved",this._updateUIOnStateChange),this.tipEl=this.el.parentNode.querySelector(this.data.tipSelector),this.labelEl=this.el.parentNode.querySelector(this.data.labelSelector),NAF.utils.getNetworkedEntity(this.el).then((e=>{this.targetEl=e,this._updateUI(),this.targetEl.addEventListener("pinned",this._updateUI),this.targetEl.addEventListener("unpinned",this._updateUI)})),this.onHovered=()=>{this.hovering=!0,this._updateUI()},this.onUnhovered=()=>{this.hovering=!1,this._updateUI()},this.onClick=()=>{if(!NAF.utils.isMine(this.targetEl)&&!NAF.utils.takeOwnership(this.targetEl))return;const e=this.targetEl.components.pinnable&&this.targetEl.components.pinnable.data.pinned;window.APP.pinningHelper.setPinned(this.targetEl,!e),e||this.el.sceneEl.systems["hubs-systems"].soundEffectsSystem.playSoundOneShot(Pm)},this.removeThemeChangedListener=bt(this._updateUI)},play(){this.el.object3D.addEventListener("interact",this.onClick),this.el.object3D.addEventListener("hovered",this.onHovered),this.el.object3D.addEventListener("unhovered",this.onUnhovered)},pause(){this.el.object3D.removeEventListener("interact",this.onClick),this.el.object3D.removeEventListener("hovered",this.onHovered),this.el.object3D.removeEventListener("unhovered",this.onUnhovered)},remove(){this.el.sceneEl.removeEventListener("stateadded",this._updateUIOnStateChange),this.el.sceneEl.removeEventListener("stateremoved",this._updateUIOnStateChange),this.targetEl&&(this.targetEl.removeEventListener("pinned",this._updateUI),this.targetEl.removeEventListener("unpinned",this._updateUI)),this.removeThemeChangedListener()},_discordBridges:()=>window.APP.hubChannel.discordBridges(),_updateUIOnStateChange(e){"frozen"===e.detail&&this._updateUI()},_updateUI(){const{fileIsOwned:e,fileId:t}=this.targetEl.components["media-loader"].data,n=window.APP.hubChannel.can("pin_objects")&&!!(e||t&&Vl(t));this.el.object3D.visible=n,this.labelEl.object3D.visible=n;const i=this.targetEl.getAttribute("pinnable")&&this.targetEl.getAttribute("pinnable").pinned,r=this._discordBridges();var o,s;this.tipEl.object3D.visible=!!(n&&!i&&this.hovering&&r.length>0),n&&(this.labelEl.setAttribute("text","value",i?"un-pin":"pin"),s=i,(o=this.el).setAttribute("text-button","backgroundColor",gt(s?"action-color-highlight":"action-color")),o.setAttribute("text-button","backgroundHoverColor",s?"#aaa":gt("action-color-highlight")))}}),AFRAME.registerComponent("mirror-media-button",{init(){var e=this;this.updateSrc=()=>{this.targetEl.parentNode&&(this.src=this.targetEl.components["media-loader"].data.src)},NAF.utils.getNetworkedEntity(this.el).then((e=>{this.targetEl=e,this.targetEl.addEventListener("media_resolved",this.updateSrc,{once:!0}),this.updateSrc()})),this.onClick=lb((function*(){const t=document.querySelector("#media-mirror-target");yield Ql();const{entity:n}=Fl(e.targetEl,"#linked-media",e.src,!1,!0,t);n.object3D.scale.set(.75,.75,.75),n.object3D.matrixNeedsUpdate=!0,t.parentEl.components["follow-in-fov"].reset(),t.parentEl.object3D.visible=!0}))},play(){this.el.object3D.addEventListener("interact",this.onClick)},pause(){this.el.object3D.removeEventListener("interact",this.onClick)}}),AFRAME.registerComponent("close-mirrored-media-button",{init(){var e=this;this.onClick=db((function*(){e.el.object3D.visible=!1,yield Ql(),e.el.object3D.visible=!0}))},play(){this.el.object3D.addEventListener("interact",this.onClick)},pause(){this.el.object3D.removeEventListener("interact",this.onClick)}}),AFRAME.registerComponent("drop-object-button",{init(){this.onClick=()=>{if(!NAF.utils.isMine(this.targetEl)&&!NAF.utils.takeOwnership(this.targetEl))return;this.targetEl.setAttribute("floaty-object",{modifyGravityOnRelease:!1}),this.targetEl.setAttribute("body-helper",{type:"dynamic",gravity:{x:0,y:-9.8,z:0},angularDamping:.01,linearDamping:.01,linearSleepingThreshold:1.6,angularSleepingThreshold:2.5,collisionFilterMask:Ue.DEFAULT_INTERACTABLE});const e=this.el.sceneEl.systems["hubs-systems"].physicsSystem;this.targetEl.components["body-helper"].uuid&&e.activateBody(this.targetEl.components["body-helper"].uuid),this.el.parentNode.removeChild(this.el)},NAF.utils.getNetworkedEntity(this.el).then((e=>{this.targetEl=e}))},play(){this.el.object3D.addEventListener("interact",this.onClick)},pause(){this.el.object3D.removeEventListener("interact",this.onClick)}});const ub=new(n(99477).Vector3);AFRAME.registerComponent("camera-focus-button",{schema:{track:{default:!1},selector:{default:null}},init(){NAF.utils.getNetworkedEntity(this.el).then((e=>{this.data.selector?this.targetEl=e.querySelector(this.data.selector):this.targetEl=e})),this.onClick=()=>{const e=qo(APP.world,qn);if(e)if(this.data.track){const t=Wn.trackTarget[e];Wn.trackTarget[e]=t===this.targetEl.eid?0:this.targetEl.eid}else this.targetEl.object3D.getWorldPosition(ub),APP.world.eid2obj.get(e).lookAt(ub)},this.menuPlacementRoots=function(e,t){const n=[];for(;e;){if(e.components)for(const t in e.components)"position-at-border"===e.components[t].name&&n.push(e.components[t]);if(n.length)return n;e=e.parentNode}return n}(this.el)},tick(){const e=this.el.object3D.visible,t=!!qo(APP.world,qn);if(e!==t){this.el.object3D.visible=t;for(let e=0;e<this.menuPlacementRoots.length;e++)this.menuPlacementRoots[e].markDirty()}},play(){this.el.object3D.addEventListener("interact",this.onClick)},pause(){this.el.object3D.removeEventListener("interact",this.onClick)}}),AFRAME.registerComponent("unmute-video-button",{init(){this.onClick=()=>{const e=lp(this.el,"media-video").components["media-video"];e&&e.video&&e.videoMutedAt&&(performance.now()-e.videoMutedAt<3e3||e.video.muted&&(e.video.muted=!1,this.el.setAttribute("visible",!1)))}},play(){document.addEventListener("touchstart",this.onClick)},pause(){document.removeEventListener("touchstart",this.onClick)}}),n(90785),n(1200),n(37554),n(89795),n(1248),n(71885),AFRAME.registerComponent("clone-media-button",{init(){this.updateSrc=()=>{if(!this.targetEl.parentNode)return;const e=this.src=this.targetEl.components["media-loader"].data.src,t=e&&"video/vnd.hubs-webrtc"!==Gs(e);this.el.object3D.visible=!!t},NAF.utils.getNetworkedEntity(this.el).then((e=>{this.targetEl=e,this.targetEl.addEventListener("media_resolved",this.updateSrc,{once:!0}),this.updateSrc()})),this.onClick=()=>{const{entity:e}=Fl(this.targetEl,"#interactable-media",this.src);e.object3D.scale.copy(this.targetEl.object3D.scale),e.object3D.matrixNeedsUpdate=!0,e.setAttribute("offset-relative-to",{target:"#avatar-pov-node",offset:{x:0,y:0,z:-1.5*this.targetEl.object3D.scale.z}})}},play(){this.el.object3D.addEventListener("interact",this.onClick)},pause(){this.el.object3D.removeEventListener("interact",this.onClick)}});var hb=n(10577),pb=n.n(hb);function mb(e,t,n,i,r,o,s){try{var a=e[o](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(i,r)}function fb(e){return function(){var t=this,n=arguments;return new Promise((function(i,r){var o=e.apply(t,n);function s(e){mb(o,i,r,s,a,"next",e)}function a(e){mb(o,i,r,s,a,"throw",e)}s(void 0)}))}}let gb=!1;function vb(){return(AFRAME.utils.device.isMobile()||AFRAME.utils.device.isMobileVR())&&!Q()&&pb().enabled}function bb(){return yb.apply(this,arguments)}function yb(){return(yb=fb((function*(){vb()&&!pb().isFullscreen&&(gb=!0,yield pb().request())}))).apply(this,arguments)}function wb(){return _b.apply(this,arguments)}function _b(){return(_b=fb((function*(){gb&&!pb().isFullscreen&&(yield pb().request())}))).apply(this,arguments)}function Eb(e,t,n,i,r,o,s){try{var a=e[o](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(i,r)}function Ab(e){return function(){var t=this,n=arguments;return new Promise((function(i,r){var o=e.apply(t,n);function s(e){Eb(o,i,r,s,a,"next",e)}function a(e){Eb(o,i,r,s,a,"throw",e)}s(void 0)}))}}let Sb=!1,xb=null;const Mb=AFRAME.utils.device.isMobileVR(),Pb=()=>new Promise((e=>{const t=document.querySelector("a-scene");t.addEventListener("2d-interstitial-gesture-complete",e,{once:!0}),t.emit("2d-interstitial-gesture-required")}));function Cb(e,t,n){return kb.apply(this,arguments)}function kb(){return(kb=Ab((function*(e,t,n){const i=document.querySelector("a-scene");if(i.is("vr-mode"))if(Sb=!0,xb=t,Mb)yield i.exitVR(),n||(yield Pb(),yield bb());else{const t=document.querySelector(".vr-notice");t.object3D.visible=!0,t.setAttribute("follow-in-fov",{angle:e?39:-15})}else Mb&&!pb().isFullscreen&&vb()&&(yield Pb(),yield bb())}))).apply(this,arguments)}function Ob(e){return Tb.apply(this,arguments)}function Tb(){return(Tb=Ab((function*(e){if(!e&&!Sb)return;Sb=!1,document.querySelector(".vr-notice").object3D.visible=!1;const t=document.querySelector("a-scene");Mb?pb().isFullscreen?(yield pb().exit(),yield Pb(),yield t.enterVR()):yield t.enterVR():t.is("vr-mode")||(yield t.enterVR())}))).apply(this,arguments)}function Rb(){return Sb}function Db(){return(Db=Ab((function*(){Sb&&(xb&&(xb(),xb=null),yield Ob())}))).apply(this,arguments)}function jb(e,t,n,i,r,o,s){try{var a=e[o](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(i,r)}function Lb(e){return function(){var t=this,n=arguments;return new Promise((function(i,r){var o=e.apply(t,n);function s(e){jb(o,i,r,s,a,"next",e)}function a(e){jb(o,i,r,s,a,"throw",e)}s(void 0)}))}}function Ib(e,t,n,i,r,o,s){try{var a=e[o](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(i,r)}function Nb(e){return function(){var t=this,n=arguments;return new Promise((function(i,r){var o=e.apply(t,n);function s(e){Ib(o,i,r,s,a,"next",e)}function a(e){Ib(o,i,r,s,a,"throw",e)}s(void 0)}))}}function Fb(e){var t,n,i,r,o;if(!e.parentNode)return null;const s=null===(t=e.components["media-loader"])||void 0===t||null===(n=t.data)||void 0===n?void 0:n.src;if(s)return s;return(null===(i=e.components["media-loader"])||void 0===i||null===(r=i.data)||void 0===r||null===(o=r.mediaOptions)||void 0===o?void 0:o.href)||null}function Bb(){return(Bb=Nb((function*(e){const t=yield NAF.utils.getNetworkedEntity(e);return Fb(t)||new Promise((e=>{t.addEventListener("media_resolved",(()=>{e(Fb(t))}),{once:!0})}))}))).apply(this,arguments)}function Vb(){return Vb=Nb((function*(e){const t=yield function(e){return Bb.apply(this,arguments)}(e);return t&&(yield oa(t))||null})),Vb.apply(this,arguments)}AFRAME.registerComponent("open-media-button",{schema:{onlyOpenLink:{type:"boolean"}},init(){var e=this;this.label=this.el.querySelector("[text]"),this.updateSrc=Lb((function*(){if(!e.targetEl.parentNode)return;const t=e.targetEl.components["media-loader"].data,n=e.src=t.mediaOptions&&t.mediaOptions.href||t.src,i=n&&"video/vnd.hubs-webrtc"!==Gs(n),r=e.el.sceneEl.systems.permissions.canOrWillIfCreator("update_hub");if(e.el.object3D.visible=!!i,i){let t="open link";if(!e.data.onlyOpenLink){let e;(yield ra(n))?t="use avatar":(yield na(n))&&r?t="use scene":(e=yield oa(n))&&(t=new URL(n).hash&&window.APP.hub.hub_id===e?"go to":"visit room")}e.label.setAttribute("text","value",t)}})),this.onClick=Lb((function*(){const t=e.el.sceneEl.systems.permissions.canOrWillIfCreator("update_hub"),n=function(){var e=Lb((function*(){return yield Cb(!1,(()=>{}),!0)}));return function(){return e.apply(this,arguments)}}();let i;if(e.data.onlyOpenLink)yield n(),window.open(e.src);else if(yield ra(e.src)){const t=new URL(e.src).pathname.split("/").pop();window.APP.store.update({profile:{avatarId:t}}),e.el.sceneEl.emit("avatar_updated")}else if((yield na(e.src))&&t)e.el.sceneEl.emit("scene_media_selected",e.src);else if(i=yield oa(e.src)){const t=new URL(e.src);t.hash&&window.APP.hub.hub_id===i?window.history.replaceState(null,null,window.location.href.split("#")[0]+t.hash):ea(e.src)?ip(i,!0,t.hash&&t.hash.substring(1)):(yield n(),location.href=e.src)}else yield n(),window.open(e.src)})),NAF.utils.getNetworkedEntity(this.el).then((e=>{this.targetEl=e,this.targetEl.addEventListener("media_resolved",this.updateSrc,{once:!0}),this.updateSrc()}))},play(){this.el.object3D.addEventListener("interact",this.onClick)},pause(){this.el.object3D.removeEventListener("interact",this.onClick)}});const Ub=(()=>{const e=new wt.Vector3,t=new wt.Vector3;return function(n,i){return n.updateMatrices(),i.updateMatrices(),e.setFromMatrixPosition(n.matrixWorld),t.setFromMatrixPosition(i.matrixWorld),e.distanceToSquared(t)<2.25}})();var Hb;function zb(e,t,n,i,r,o,s){try{var a=e[o](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(i,r)}function Wb(e){return function(){var t=this,n=arguments;return new Promise((function(i,r){var o=e.apply(t,n);function s(e){zb(o,i,r,s,a,"next",e)}function a(e){zb(o,i,r,s,a,"throw",e)}s(void 0)}))}}function qb(e,t,n,i,r,o,s){try{var a=e[o](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(i,r)}function Zb(e){return function(){var t=this,n=arguments;return new Promise((function(i,r){var o=e.apply(t,n);function s(e){qb(o,i,r,s,a,"next",e)}function a(e){qb(o,i,r,s,a,"throw",e)}s(void 0)}))}}!function(e){e[e.notReady=0]="notReady",e[e.idle=1]="idle",e[e.nearby=2]="nearby",e[e.traveling=3]="traveling"}(Hb||(Hb={})),k.feature("change_hub_near_room_links")&&(console.log("Enabling automatic fast room switching when near room links."),AFRAME.registerComponent("change-hub-when-near",{init(){this.state=Hb.notReady,function(e){return Vb.apply(this,arguments)}(this.el).then((e=>{var t;e?(this.targetHubId=e,this.avatarPov=null===(t=document.getElementById("avatar-pov-node"))||void 0===t?void 0:t.object3D,this.timer=0,this.state=Hb.idle):console.error("Failed to find target hub id for portal.")}))},tick(e){this.state!==Hb.notReady&&this.state!==Hb.traveling&&(this.state===Hb.idle?Ub(this.el.object3D,this.avatarPov)&&(this.state=Hb.nearby,this.timer=e+2e3):this.state===Hb.nearby&&e>this.timer&&(Ub(this.el.object3D,this.avatarPov)?(this.state=Hb.traveling,ip(this.targetHubId).finally((()=>{this.state=Hb.idle}))):this.state=Hb.idle))}})),AFRAME.registerComponent("local-refresh-media-button",{init(){var e=this;this.onClick=Wb((function*(){if(e.targetEl){const t=e.targetEl.components;t["media-video"]&&t["media-video"].videoTexture&&t["media-video"].videoTexture.hls?t["media-video"].videoTexture.hls.recoverMediaError():t["media-loader"]&&t["media-loader"].update(t["media-loader"].data,!0)}})),NAF.utils.getNetworkedEntity(this.el).then((e=>this.targetEl=e)).catch((()=>this.el.parentNode.removeChild(this.el)))},play(){this.el.object3D.addEventListener("interact",this.onClick)},pause(){this.el.object3D.removeEventListener("interact",this.onClick)}}),AFRAME.registerComponent("refresh-media-button",{init(){var e=this;this.updateVisibility=this.updateVisibility.bind(this),this.onClick=Wb((function*(){const t=e.el.sceneEl.systems["hubs-systems"].soundEffectsSystem;if(e.targetEl){e.targetEl.components["media-loader"].refresh(),e.el.object3D.visible=!1;const n=t.playPositionalSoundFollowing(Cm,e.targetEl.object3D,!0);e.targetEl.addEventListener("media_refreshed",(()=>{t.stopPositionalAudio(n),e.el.object3D.visible=!0,e.updateVisibility()}),{once:!0})}})),NAF.utils.getNetworkedEntity(this.el).then((e=>{this.targetEl=e,window.APP.hubChannel.addEventListener("permissions_updated",this.updateVisibility),this.targetEl&&(this.targetEl.addEventListener("pinned",this.updateVisibility),this.targetEl.addEventListener("unpinned",this.updateVisibility)),this.updateVisibility()}))},updateVisibility(){if(!this.targetEl)return;const e=this.targetEl.components.pinnable&&this.targetEl.components.pinnable.data.pinned;this.el.object3D.visible=!e&&window.APP.hubChannel.can("spawn_and_move_media")||window.APP.hubChannel.can("pin_objects")},play(){this.el.object3D.addEventListener("interact",this.onClick)},pause(){this.el.object3D.removeEventListener("interact",this.onClick)},remove(){window.APP.hubChannel.removeEventListener("permissions_updated",this.updateVisibility),this.targetEl&&(this.targetEl.removeEventListener("pinned",this.updateVisibility),this.targetEl.removeEventListener("unpinned",this.updateVisibility))}}),AFRAME.registerComponent("tweet-media-button",{init(){NAF.utils.getNetworkedEntity(this.el).then((e=>{this.targetEl=e})).catch((()=>{this.el.object3D.visible=!1})),this.onClick=()=>{const e=`Taken in ${location.hostname} `,{src:t,contentSubtype:n}=this.targetEl.components["media-loader"].data;this.el.sceneEl.emit("action_media_tweet",{mediaUrl:t,contentSubtype:n,initialTweet:e})}},play(){k.integration("twitter")?this.el.object3D.addEventListener("interact",this.onClick):this.el.object3D.visible=!1},pause(){this.el.object3D.removeEventListener("interact",this.onClick)}});const Gb="save avatar";AFRAME.registerComponent("remix-avatar-button",{init(){var e=this;this.label=this.el.querySelector("[text]"),this.label.setAttribute("text","value",Gb),this.updateSrc=Zb((function*(){e.src=e.targetEl.components["media-loader"].data.src;try{e.avatar=yield Og((e=>{const t=e.match($s);return t?t.groups.id:null})(e.src)),e.el.object3D.visible=e.avatar&&e.avatar.allow_remixing&&"avatar_listing"===e.avatar.type}catch(t){console.error(t),e.el.object3D.visible=!1}})),this.onClick=Zb((function*(){if(!e.copying&&e.avatar){try{e.copying=!0,e.label.setAttribute("text","value","Saving..."),yield Ng(e.avatar.avatar_id,e.avatar.name),e.label.setAttribute("text","value","Saved!")}catch(t){e.label.setAttribute("text","value","Error")}setTimeout((()=>{e.label.setAttribute("text","value",Gb),e.copying=!1}),2e3)}})),NAF.utils.getNetworkedEntity(this.el).then((e=>{this.targetEl=e,this.targetEl.addEventListener("media_resolved",this.updateSrc,{once:!0}),this.updateSrc()}))},play(){this.el.object3D.addEventListener("interact",this.onClick)},pause(){this.el.object3D.removeEventListener("interact",this.onClick)}});var Yb=n(99477);const Qb={type:"kinematic",collisionFilterMask:Ue.HANDS},Xb={AXIS:"axis",PUPPET:"puppet",CURSOR:"cursor",ALIGN:"align",SCALE:"scale"},Kb=Math.PI/10,$b=new Yb.Quaternion,Jb=new Yb.Vector3,ey=new Yb.Quaternion,ty=new Yb.Vector3,ny=new Yb.Vector3,iy=new Yb.Quaternion,ry=new Yb.Quaternion,oy=.001;AFRAME.registerComponent("transform-button",{schema:{mode:{type:"string",oneof:Object.values(Xb),default:Xb.CURSOR},axis:{type:"vec3",default:null}},init(){let e,t;NAF.utils.getNetworkedEntity(this.el).then((e=>{this.targetEl=e})),L().then((()=>{e=document.getElementById("player-left-controller"),t=document.getElementById("player-right-controller")})),this.onGrabStart=n=>{e&&t&&this.targetEl&&(NAF.utils.isMine(this.targetEl)||NAF.utils.takeOwnership(this.targetEl))&&(this.targetEl.body&&this.targetEl.setAttribute("body-helper",Qb),this.transformSystem=this.transformSystem||AFRAME.scenes[0].systems["transform-selected-object"],this.transformSystem.startTransform(this.targetEl.object3D,"right-cursor"===n.object3D.el.id?t.object3D:"left-cursor"===n.object3D.el.id?e.object3D:n.object3D,this.data))},this.onGrabEnd=()=>{this.transformSystem=this.transformSystem||AFRAME.scenes[0].systems["transform-selected-object"],this.transformSystem.stopTransform()}},play(){this.el.object3D.addEventListener("interact",this.onGrabStart),this.el.object3D.addEventListener("holdable-button-down",this.onGrabStart),this.el.object3D.addEventListener("holdable-button-up",this.onGrabEnd)},pause(){this.el.object3D.removeEventListener("interact",this.onGrabStart),this.el.object3D.removeEventListener("holdable-button-down",this.onGrabStart),this.el.object3D.removeEventListener("holdable-button-up",this.onGrabEnd)}}),AFRAME.registerSystem("transform-selected-object",{init(){this.target=null,this.mode=null,this.transforming=!1,this.axis=new Yb.Vector3,this.store=window.APP.store,this.startQ=new Yb.Quaternion,this.dxStore=0,this.dxApplied=0,this.dyAll=0,this.dyStore=0,this.dyApplied=0,this.raycasters={},this.puppet={initialControllerOrientation:new Yb.Quaternion,initialControllerOrientation_inverse:new Yb.Quaternion,initialObjectOrientation:new Yb.Quaternion,currentControllerOrientation:new Yb.Quaternion,controllerOrientationDelta:new Yb.Quaternion},this.planarInfo={plane:new Yb.Mesh(new Yb.PlaneBufferGeometry(1e5,1e5,2,2),new Yb.MeshBasicMaterial({visible:!1,wireframe:!0,side:Yb.DoubleSide,transparent:!0,opacity:.3})),normal:new Yb.Vector3,intersections:[],previousPointOnPlane:new Yb.Vector3,currentPointOnPlane:new Yb.Vector3,deltaOnPlane:new Yb.Vector3,finalProjectedVec:new Yb.Vector3},this.el.object3D.add(this.planarInfo.plane)},stopTransform:function(){const e=new Yb.Quaternion,t=new Yb.Quaternion(0,1,0,0),n=new Yb.Quaternion;return function(){var i,r;this.transforming=!1,this.mode===Xb.CURSOR&&(this.target.getWorldQuaternion(e),i=e,r=this.startQ,Math.abs(i.x-r.x)<oy&&Math.abs(i.y-r.y)<oy&&Math.abs(i.z-r.z)<oy&&Math.abs(i.w-r.w)<oy&&(e.multiply(t),this.target.parent.getWorldQuaternion(n),n.invert(),this.target.quaternion.copy(n).multiply(e),this.target.matrixNeedsUpdate=!0))}}(),startPlaneCasting(){const{plane:e,intersections:t,previousPointOnPlane:n}=this.planarInfo;this.el.camera.getWorldQuaternion($b),e.quaternion.copy($b),this.target.getWorldPosition(e.position),e.matrixNeedsUpdate=!0,e.updateMatrixWorld(!0),t.length=0,this.raycasters.right=this.raycasters.right||document.getElementById("right-cursor-controller").components["cursor-controller"].raycaster,this.raycasters.left=this.raycasters.left||document.getElementById("left-cursor-controller").components["cursor-controller"].raycaster;const i="player-left-controller"===this.hand.el.id?this.raycasters.left:this.raycasters.right,r=i.far;i.far=1e3,e.raycast(i,t),i.far=r,this.transforming=!!t[0],this.transforming&&(n.copy(t[0].point),this.target.getWorldQuaternion(ey),ty.set(0,0,-1).applyQuaternion($b),ny.set(0,0,-1).applyQuaternion(ey),this.sign=ty.dot(ny)>0?1:-1,ty.set(0,1,0),ny.set(0,1,0).applyQuaternion(ey),this.sign2=ty.dot(ny)>0?1:-1,this.dyAll=0,this.dyStore=0,this.dyApplied=0,this.dxAll=0,this.dxStore=0,this.dxApplied=0)},startTransform(e,t,n){if(this.target=e,this.hand=t,this.mode=n.mode,this.transforming=!0,this.mode!==Xb.ALIGN){if(this.store.update({activity:{hasRotated:!0}}),this.mode===Xb.CURSOR&&this.target.getWorldQuaternion(this.startQ),this.mode===Xb.PUPPET)return this.target.getWorldQuaternion(this.puppet.initialObjectOrientation),this.hand.getWorldQuaternion(this.puppet.initialControllerOrientation),void this.puppet.initialControllerOrientation_inverse.copy(this.puppet.initialControllerOrientation).invert();this.mode===Xb.AXIS&&this.axis.copy(n.axis),this.startPlaneCasting()}else this.store.update({activity:{hasRecentered:!0}})},puppetingTick(){const{currentControllerOrientation:e,controllerOrientationDelta:t,initialControllerOrientation_inverse:n,initialObjectOrientation:i}=this.puppet;this.hand.getWorldQuaternion(e),t.copy(n).premultiply(e),this.target.quaternion.copy(i).premultiply(t).premultiply(t),this.target.matrixNeedsUpdate=!0},cursorAxisOrScaleTick(){const{plane:e,normal:t,intersections:n,previousPointOnPlane:i,currentPointOnPlane:r,deltaOnPlane:o,finalProjectedVec:s}=this.planarInfo;this.target.getWorldPosition(e.position),this.el.camera.getWorldPosition(ty),e.matrixNeedsUpdate=!0;const a=ty.sub(e.position).length();n.length=0;const l="player-left-controller"===this.hand.el.id?this.raycasters.left:this.raycasters.right,c=l.far;l.far=1e3,e.raycast(l,n),l.far=c;const d=n[0];if(d){if(t.set(0,0,-1).applyQuaternion(e.quaternion),r.copy(d.point),o.copy(r).sub(i),s.copy(o).projectOnPlane(t).applyQuaternion(iy.copy(e.quaternion).invert()).multiplyScalar(10/a),this.mode===Xb.CURSOR){const e=!AFRAME.scenes[0].systems.userinput.get(zm.actions.transformModifier);this.dyAll=this.dyStore+s.y,this.dyApplied=e?this.dyAll:Math.round(this.dyAll/Kb)*Kb,this.dyStore=this.dyAll-this.dyApplied,this.dxAll=this.dxStore+s.x,this.dxApplied=e?this.dxAll:Math.round(this.dxAll/Kb)*Kb,this.dxStore=this.dxAll-this.dxApplied,this.mode===Xb.CURSOR&&(this.target.getWorldQuaternion(ey),ty.set(1,0,0).applyQuaternion(e?$b:ey),iy.setFromAxisAngle(ty,e?-this.dyApplied:this.sign2*this.sign*-this.dyApplied),e?ty.set(0,1,0).applyQuaternion($b):ty.set(0,1,0),ry.setFromAxisAngle(ty,this.dxApplied),this.target.quaternion.premultiply(iy).premultiply(ry)),this.target.matrixNeedsUpdate=!0}else this.mode===Xb.AXIS&&(this.dxAll=this.dxStore+s.x,this.dxApplied=Math.round(this.dxAll/Kb)*Kb,this.dxStore=this.dxAll-this.dxApplied,this.target.quaternion.multiply(iy.setFromAxisAngle(this.axis,-this.sign*this.dxApplied)),this.target.matrixNeedsUpdate=!0);i.copy(r)}},tick(){if(this.transforming&&this.mode!==Xb.SCALE)return this.mode===Xb.ALIGN?(this.el.camera.getWorldPosition(Jb),this.target.lookAt(Jb),void(this.transforming=!1)):void(this.mode!==Xb.PUPPET?this.cursorAxisOrScaleTick():this.puppetingTick())}}),AFRAME.registerComponent("transform-button-selector",{tick(){this.userinput=this.userinput||this.el.sceneEl.systems.userinput,this.userinput.get(zm.actions.rightHand.pose)||this.userinput.get(zm.actions.leftHand.pose)?this.el.components["transform-button"].data.mode!==Xb.PUPPET&&this.el.setAttribute("transform-button","mode",Xb.PUPPET):this.el.components["transform-button"].data.mode!==Xb.CURSOR&&this.el.setAttribute("transform-button","mode",Xb.CURSOR)}});const sy=new Yb.Vector3(0,0,1),ay=2*Math.PI;AFRAME.registerComponent("visible-if-transforming",{schema:{hand:{type:"string"}},init(){},tick(e){const t=AFRAME.scenes[0].systems["transform-selected-object"].transforming&&-1!==AFRAME.scenes[0].systems["transform-selected-object"].hand.el.id.indexOf(this.data.hand);this.el.getAttribute("visible")!==t&&this.el.setAttribute("visible",AFRAME.scenes[0].systems["transform-selected-object"].transforming),t&&(this.el.object3D.quaternion.setFromAxisAngle(sy,ay*Math.sin(e/1e3)),this.el.object3D.matrixNeedsUpdate=!0)}});var ly=n(99477);const cy=function(){const e=new ly.Matrix4,t=new ly.Vector3,n=new ly.Vector3,i=new ly.Vector3,r=new ly.Vector3,o=new ly.Vector3;return function(s,a){return s.updateMatrices(),o.setFromMatrixPosition(s.matrixWorld),a.updateMatrices(),r.setFromMatrixPosition(a.matrixWorld),n.subVectors(r,o),n.y=0,n.normalize(),t.set(0,1,0),i.crossVectors(n,t),e.makeBasis(i,t,n.multiplyScalar(-1)),e.elements[12]=r.x,e.elements[13]=r.y,e.elements[14]=r.z,e}}(),dy=new ly.Mesh(new ly.PlaneBufferGeometry(1e5,1e5,2,2),new ly.MeshBasicMaterial({visible:!0,wireframe:!1,side:ly.DoubleSide,transparent:!0,opacity:.3})),uy=new ly.Mesh(new ly.PlaneBufferGeometry(1e5,1e5,2,2),new ly.MeshBasicMaterial({visible:!0,wireframe:!1,side:ly.DoubleSide,transparent:!0,opacity:.3}));AFRAME.registerComponent("scale-button",{init(){this.isScaling=!1,this.planeRotation=new ly.Matrix4,this.planeUp=new ly.Vector3,this.planeRight=new ly.Vector3,this.intersections=[],this.initialIntersectionPoint=new ly.Vector3,this.intersectionPoint=new ly.Vector3,this.initialObjectScale=new ly.Vector3,this.desiredObjectScale=new ly.Vector3,this.deltaScale=new ly.Vector3,this.objectMatrix=new ly.Matrix4,this.dragVector=new ly.Vector3,this.currentObjectScale=new ly.Vector3,NAF.utils.getNetworkedEntity(this.el).then((e=>{this.networkedEl=e,this.objectToScale=e.object3D}));const e=new ly.Vector3,t=new ly.Vector3,n=new ly.Vector3;this.startScaling=i=>{if(this.isScaling||!this.objectToScale)return;if(!NAF.utils.isMine(this.networkedEl)&&!NAF.utils.takeOwnership(this.networkedEl))return;this.didGetObjectReferences||(this.didGetObjectReferences=!0,this.leftEventer=document.getElementById("left-cursor").object3D,this.leftCursorController=document.getElementById("left-cursor-controller"),this.leftRaycaster=this.leftCursorController.components["cursor-controller"].raycaster,this.rightCursorController=document.getElementById("right-cursor-controller"),this.rightRaycaster=this.rightCursorController.components["cursor-controller"].raycaster,this.viewingCamera=document.getElementById("viewing-camera").object3DMap.camera),this.plane=i.object3D===this.leftEventer?dy:uy,Oo(this.plane,cy(this.viewingCamera,this.el.object3D)),this.planeRotation.extractRotation(this.plane.matrixWorld),this.planeUp.set(0,1,0).applyMatrix4(this.planeRotation),this.planeRight.set(1,0,0).applyMatrix4(this.planeRotation),this.raycaster=i.object3D===this.leftEventer?this.leftRaycaster:this.rightRaycaster;const r=this.raycastOnPlane();r&&(this.isScaling=!0,this.initialIntersectionPoint.copy(r.point),this.objectToScale.updateMatrices(),this.initialObjectScale.setFromMatrixScale(this.objectToScale.matrixWorld),this.initialDistanceToObject=n.subVectors(e.setFromMatrixPosition(this.viewingCamera.matrixWorld),t.setFromMatrixPosition(this.el.object3D.matrixWorld)).length(),window.APP.store.update({activity:{hasScaled:!0}}),this.transformSelectedObjectSystem=this.transformSelectedObjectSystem||this.el.sceneEl.systems["transform-selected-object"],this.transformSelectedObjectSystem.transforming=!0,this.transformSelectedObjectSystem.mode=Xb.SCALE,this.transformSelectedObjectSystem.target=this.objectToScale,this.transformSelectedObjectSystem.hand=i.object3D===this.leftEventer?this.leftCursorController.object3D:this.rightCursorController.object3D)},this.endScaling=e=>{this.isScaling&&(e.object3D===this.leftEventer&&this.raycaster===this.leftRaycaster||e.object3D!==this.leftEventer&&this.raycaster===this.rightRaycaster)&&(this.isScaling=!1,this.transformSelectedObjectSystem=this.transformSelectedObjectSystem||this.el.sceneEl.systems["transform-selected-object"],this.transformSelectedObjectSystem.transforming=!1)},this.el.object3D.addEventListener("holdable-button-down",this.startScaling),this.el.object3D.addEventListener("holdable-button-up",this.endScaling)},raycastOnPlane(){this.intersections.length=0;const e=this.raycaster.far;return this.raycaster.far=1e3,this.plane.raycast(this.raycaster,this.intersections),this.raycaster.far=e,this.intersections[0]},tick(){if(!this.isScaling)return;const e=this.raycastOnPlane();if(!e)return;this.intersectionPoint.copy(e.point),this.dragVector.subVectors(this.intersectionPoint,this.initialIntersectionPoint);const t=(this.dragVector.dot(this.planeUp)+this.dragVector.dot(this.planeRight))/this.initialDistanceToObject;let n=1;t>0?n=1+t:t<0&&(n=1/(1+Math.abs(t))),this.desiredObjectScale.copy(this.initialObjectScale).multiplyScalar(n),this.objectToScale.updateMatrices(),this.currentObjectScale.setFromMatrixScale(this.objectToScale.matrixWorld),this.deltaScale.set(this.desiredObjectScale.x/this.currentObjectScale.x,this.desiredObjectScale.y/this.currentObjectScale.y,this.desiredObjectScale.z/this.currentObjectScale.z),this.objectMatrix.copy(this.objectToScale.matrixWorld),this.objectMatrix.scale(this.deltaScale),Oo(this.objectToScale,this.objectMatrix)}}),n(83830),n(62399);var hy=n(99477);const py=zl.load("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAAQCAYAAADXnxW3AAAACXBIWXMAAAsTAAALEwEAmpwYAAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAADJJREFUeNpEx7ENgDAAAzArK0JA6f8X9oewlcWStU1wBGdwB08wgjeYm79jc2nbYH0DAC/+CORJxO5fAAAAAElFTkSuQmCC"),my=new hy.Vector3(0,1,0);class fy extends hy.Mesh{constructor(e,t){super(new hy.BufferGeometry,new hy.MeshBasicMaterial({side:hy.DoubleSide,toneMapped:!1,transparent:!0})),this.setPoint=function(){const e=new hy.Vector3,t=new hy.Vector3,n=new hy.Vector3,i=new hy.Vector3;return function(r,o){let s=18*r;e.copy(o).add(this.direction),t.copy(o).sub(this.direction),n.set(0===r?e.x:this.vertices[s-3],0===r?e.y:this.vertices[s-2],0===r?e.z:this.vertices[s-1]),i.set(0===r?t.x:this.vertices[s-6],0===r?t.y:this.vertices[s-5],0===r?t.z:this.vertices[s-4]),this.vertices[s++]=e.x,this.vertices[s++]=e.y,this.vertices[s++]=e.z,this.vertices[s++]=n.x,this.vertices[s++]=n.y,this.vertices[s++]=n.z,this.vertices[s++]=i.x,this.vertices[s++]=i.y,this.vertices[s++]=i.z,this.vertices[s++]=i.x,this.vertices[s++]=i.y,this.vertices[s++]=i.z,this.vertices[s++]=t.x,this.vertices[s++]=t.y,this.vertices[s++]=t.z,this.vertices[s++]=e.x,this.vertices[s++]=e.y,this.vertices[s++]=e.z,this.geometry.attributes.position.needsUpdate=!0}}(),this.vertices=new Float32Array(3*e*6),this.width=t,this.geometry.setAttribute("position",new hy.BufferAttribute(this.vertices,3).setUsage(hy.DynamicDrawUsage)),this.frustumCulled=!1,this.direction=new hy.Vector3,this.numPoints=e}setDirection(e){this.direction.copy(e).cross(my).normalize().multiplyScalar(this.width/2)}setWidth(e){this.width=e}}function gy(e,t,n,i){return i.x=e.x+t.x*n,i.y=e.y+t.y*n-4.9*n*n,i.z=e.z+t.z*n,i}const vy=function(){const e=new hy.Vector3;return function(t,n,i,r,o,s,a){e.copy(n).sub(t);const l=e.length();r.far=l,r.set(t,e.normalize());const c=r.intersectObjects(i,!0);return!!(c.length>0&&function(e,t,n){const i=t.angleTo(e);return hy.MathUtils.RAD2DEG*i<=n}(c[0].face.normal,o,s))&&(a.copy(c[0].point),!0)}}(),by=16711680,yy=new hy.Vector3(0,0,-1),wy=new hy.Vector3(0,1,0),_y=400,Ey=new hy.Quaternion,Ay=new hy.Vector3,Sy=new hy.Vector3;let xy;AFRAME.registerComponent("teleporter",{schema:{start:{type:"string"},confirm:{type:"string"},speed:{default:12},hitCylinderColor:{type:"color",default:"#99ff99"},hitCylinderRadius:{default:.25,min:0},outerRadius:{default:.6,min:0},hitCylinderHeight:{default:.3,min:0}},init(){this.characterController=this.el.sceneEl.systems["hubs-systems"].characterController,this.isTeleporting=!1,this.rayCurve=new fy(20,.025),this.rayCurve.visible=!1,this.el.sceneEl.object3D.add(this.rayCurve),this.p0=new hy.Vector3,this.v0=new hy.Vector3,this.parabola=Array.from(new Array(this.rayCurve.numPoints),(()=>new hy.Vector3)),this.hit=!1,this.hitPoint=new hy.Vector3,this.raycaster=new hy.Raycaster,this.rigWorldPosition=new hy.Vector3,this.newRigWorldPosition=new hy.Vector3,this.teleportOriginWorldPosition=new hy.Vector3,this.teleportEventDetail={oldPosition:this.rigWorldPosition,newPosition:this.newRigWorldPosition,hitPoint:this.hitPoint},this.prevHitHeight=0,this.direction=new hy.Vector3,this.hitEntity=this.createHitEntity(),this.hitEntity.visible=!1,this.el.sceneEl.object3D.add(this.hitEntity)},remove(){this.stopPlayingTeleportSound()},stopPlayingTeleportSound(){this.teleportingSound&&(this.el.sceneEl.systems["hubs-systems"].soundEffectsSystem.stopSoundNode(this.teleportingSound.source),this.teleportingSound=null)},tick(e,t){var n,i,r,o;xy=xy||document.getElementById("ui-root");const s=this.el.sceneEl.is("entered"),a=!s&&xy&&xy.firstChild&&xy.firstChild.classList.contains("isGhost");if(!s&&!a)return;const l=this.el.sceneEl.systems["hubs-systems"].soundEffectsSystem,c=AFRAME.scenes[0].systems.userinput,{start:d,confirm:u,speed:h}=this.data,p=this.el.object3D;if(this.isTeleporting||!c.get(d)||this.characterController.isTeleportingDisabled||window.APP.store.state.preferences.disableTeleporter||(this.isTeleporting=!0,this.timeTeleporting=0,this.hit=!1,this.rayCurve.visible=!0,this.rayCurve.updateMatrixWorld(),this.rayCurve.material.opacity=.1,this.rayCurve.material.color.set(by),this.rayCurve.material.needsUpdate=!0,this.teleportingSound=l.playSoundLoopedWithGain(mm),this.teleportingSound&&(this.teleportingSound.gain.gain.value=.005)),!this.isTeleporting)return;if(this.teleportingSound&&(this.teleportingSound.gain.gain.value=Math.min(.025,this.teleportingSound.gain.gain.value+2e-5*t)),c.get(u)){if(this.hitEntity.visible=!1,this.isTeleporting=!1,this.rayCurve.visible=!1,this.teleportingSound&&this.stopPlayingTeleportSound(),!this.hit||this.timeTeleporting<_y)return;return this.characterController.teleportTo(this.hitPoint),void l.playSoundOneShot(fm)}this.timeTeleporting+=t,p.updateMatrixWorld(),p.matrixWorld.decompose(this.p0,Ey,Ay),this.direction.copy(yy).applyQuaternion(Ey).normalize(),this.rayCurve.setDirection(this.direction),this.el.object3D.updateMatrices();const m=Sy.setFromMatrixColumn(this.characterController.avatarPOV.object3D.matrixWorld,1).length();this.v0.copy(this.direction).multiplyScalar(h*Math.sqrt(m));let f=this.rayCurve.numPoints-1;this.hit=!1,this.parabola[0].copy(this.p0);const g=1/(this.rayCurve.numPoints-1),v=null===(n=AFRAME)||void 0===n||null===(i=n.scenes[0])||void 0===i||null===(r=i.systems)||void 0===r||null===(o=r.nav)||void 0===o?void 0:o.mesh;for(let e=1;e<this.rayCurve.numPoints;e++){const t=e*g;if(gy(this.p0,this.v0,t,Ay),this.parabola[e].copy(Ay),v){const t=v.visible;v.visible=!0;const n=vy(this.parabola[e-1],this.parabola[e],[v],this.raycaster,wy,45,this.hitPoint);if(v.visible=t,n){this.hit=!0,f=e;break}}}this.characterController.isTeleportingDisabled&&(this.hit=!1);const b=this.timeTeleporting>_y?1:this.timeTeleporting/_y,y=b*(f/(this.rayCurve.numPoints-1))/(this.rayCurve.numPoints-1);for(let e=0;e<this.rayCurve.numPoints;e++){const t=e*y;gy(this.p0,this.v0,t,Ay),this.rayCurve.setPoint(e,Ay)}const w=this.hit?10092441:by,_=this.hit&&this.timeTeleporting>=_y?.3:.1;if(this.rayCurve.material.color.set(w),this.rayCurve.material.opacity=_,this.hitEntity.visible=this.hit,this.hit){this.hitEntity.position.copy(this.hitPoint),this.hitEntity.matrixNeedsUpdate=!0;const e=this.data.outerRadius-this.data.hitCylinderRadius,t=(this.data.outerRadius-function(e){return e*e}(b)*e)/this.data.outerRadius;this.outerTorus.scale.set(t,t,1),this.outerTorus.matrixNeedsUpdate=!0;const n=.3*function(e){return e<.5?.5*((e=2*e-1)*e*e+1):.5*(e=2*e-1)*e*e+.5}(b);this.torus.material.opacity=n,this.cylinder.material.opacity=n}},createHitEntity(){const e=this.data,t=new hy.Group;return this.torus=new hy.Mesh(new hy.TorusBufferGeometry(e.hitCylinderRadius,.01,16,18,360*hy.MathUtils.DEG2RAD),new hy.MeshBasicMaterial({color:e.hitCylinderColor,side:hy.DoubleSide,transparent:!0,toneMapped:!1,depthTest:!1})),this.torus.rotation.x=90*hy.MathUtils.DEG2RAD,t.add(this.torus),this.cylinder=new hy.Mesh(new hy.CylinderBufferGeometry(e.hitCylinderRadius,e.hitCylinderRadius,e.hitCylinderHeight,16,1,!0),new hy.MeshBasicMaterial({color:e.hitCylinderColor,side:hy.DoubleSide,map:py,toneMapped:!1,transparent:!0,depthTest:!1})),this.cylinder.position.y=e.hitCylinderHeight/2,py.flipY||(this.cylinder.rotation.z=180*hy.MathUtils.DEG2RAD),t.add(this.cylinder),this.outerTorus=new hy.Mesh(new hy.TorusBufferGeometry(e.outerRadius,.01,16,18,360*hy.MathUtils.DEG2RAD),new hy.MeshBasicMaterial({color:e.hitCylinderColor,side:hy.DoubleSide,opacity:.3,transparent:!0,depthTest:!1})),this.outerTorus.rotation.x=90*hy.MathUtils.DEG2RAD,t.add(this.outerTorus),t}}),n(91016),n(96555),n(30010),n(75743),n(60070),n(53287);var My=n(99477);const Py=(new My.Matrix4).makeRotationY(Math.PI),Cy=(new My.Matrix4).makeTranslation(0,-.25,0),ky=new My.Matrix4;AFRAME.registerComponent("inspect-pivot-offset-from-camera",{tick(){const e=this.el.object3D.parent;e.updateMatrices(),Oo(this.el.object3D,Lo(e.matrixWorld,ky).multiply(Cy).multiply(Py))}}),n(37176);var Oy=n(99477);function Ty(e,t,n,i,r,o,s){try{var a=e[o](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(i,r)}function Ry(e){return function(){var t=this,n=arguments;return new Promise((function(i,r){var o=e.apply(t,n);function s(e){Ty(o,i,r,s,a,"next",e)}function a(e){Ty(o,i,r,s,a,"throw",e)}s(void 0)}))}}const Dy="Failed to initialize avatar-audio-source.",jy="Could not find networked el.",Ly="Networked component has no owner.",Iy=/chrome/i.test(navigator.userAgent);function Ny(e){return Fy.apply(this,arguments)}function Fy(){return(Fy=Ry((function*(e){const t=yield NAF.utils.getNetworkedEntity(e).catch((e=>{console.error(Dy,jy,e)}));return t?t.components.networked.data.owner:null}))).apply(this,arguments)}function By(e){return Vy.apply(this,arguments)}function Vy(){return(Vy=Ry((function*(e){const t=yield Ny(e);if(!t)return console.error(Dy,Ly),null;return(yield APP.dialog.getMediaStream(t).catch((e=>{console.error(Dy,`Error getting media stream for ${t}`,e)})))||null}))).apply(this,arguments)}var Uy;AFRAME.registerComponent("avatar-audio-source",{createAudio:(Uy=Ry((function*(){var e=this;this.removeAudio(),this.isCreatingAudio=!0;const t=yield By(this.el);this.isCreatingAudio=!1;const n=!this.el.parentNode;if(!t||n)return;APP.sourceType.set(this.el,mh.AVATAR_AUDIO_SOURCE);const{audioType:i}=nm(this.el),r=this.el.sceneEl.audioListener;let o=this.el.getObject3D(this.attrName);o=i===fh.PannerNode?new Oy.PositionalAudio(r):new Oy.Audio(r),o.gain.gain.value=0,this.audioSystem.addAudio({sourceType:mh.AVATAR_AUDIO_SOURCE,node:o}),Iy&&function(e){const t=new Audio;t.setAttribute("autoplay","autoplay"),t.setAttribute("playsinline","playsinline"),t.srcObject=e,t.volume=0}(t),this.destination=o.context.createMediaStreamDestination(),this.mediaStreamSource=o.context.createMediaStreamSource(t);const s=o.context.createMediaStreamSource(this.destination.stream);this.mediaStreamSource.connect(this.destination),o.setNodeSource(s),this.el.setObject3D(this.attrName,o),this.el.emit("sound-source-set",{soundSource:s}),Ny(this.el).then(function(){var t=Ry((function*(t){R(t)?APP.moderatorAudioSource.add(e.el):APP.moderatorAudioSource.delete(e.el),APP.audios.set(e.el,o),rm(e.el,o)}));return function(e){return t.apply(this,arguments)}}())})),function(){return Uy.apply(this,arguments)}),removeAudio(){const e=this.el.getObject3D(this.attrName);e&&(this.audioSystem.removeAudio({node:e}),this.el.removeObject3D(this.attrName))},init(){this.createAudio=this.createAudio.bind(this),this.onPermissionsUpdated=this.onPermissionsUpdated.bind(this),this.audioSystem=this.el.sceneEl.systems["hubs-systems"].audioSystem,APP.dialog.on("stream_updated",this._onStreamUpdated,this),this.createAudio();let{disableLeftRightPanning:e,audioPanningQuality:t}=APP.store.state.preferences;this.onPreferenceChanged=()=>{const n=APP.store.state.preferences.disableLeftRightPanning,i=APP.store.state.preferences.audioPanningQuality,r=e!==n&&!this.isCreatingAudio,o=t!==i;if(e=n,t=i,r)this.createAudio();else if(o){const e=this.el.getObject3D(this.attrName);rm(this.el,e)}},APP.store.addEventListener("statechanged",this.onPreferenceChanged),this.el.addEventListener("audio_type_changed",this.createAudio),APP.hubChannel.addEventListener("permissions_updated",this.onPermissionsUpdated)},onPermissionsUpdated(){var e=this;Ny(this.el).then(function(){var t=Ry((function*(t){R(t)?APP.moderatorAudioSource.add(e.el):APP.moderatorAudioSource.delete(e.el);const n=APP.audios.get(e.el);n&&rm(e.el,n)}));return function(e){return t.apply(this,arguments)}}())},_onStreamUpdated(e,t){var n=this;return Ry((function*(){const i=n.el.getObject3D(n.attrName);i&&i.source.mediaStream&&Ny(n.el).then(function(){var r=Ry((function*(r){if(r===e&&"audio"===t){const t=yield APP.dialog.getMediaStream(e,"audio").catch((t=>{console.error(Dy,`Error getting media stream for ${e}`,t)}));t&&(n.mediaStreamSource.disconnect(),n.mediaStreamSource=i.context.createMediaStreamSource(t),n.mediaStreamSource.connect(n.destination))}}));return function(e){return r.apply(this,arguments)}}())}))()},remove:function(){APP.dialog.off("stream_updated",this._onStreamUpdated),APP.hubChannel.removeEventListener("permissions_updated",this.onPermissionsUpdated),window.APP.store.removeEventListener("statechanged",this.onPreferenceChanged),this.el.removeEventListener("audio_type_changed",this.createAudio),APP.audios.delete(this.el),APP.sourceType.delete(this.el),APP.supplementaryAttenuation.delete(this.el),this.removeAudio()}});const Hy=new Oy.Vector3;AFRAME.registerComponent("zone-audio-source",{schema:{onlyMods:{default:!0},muteSelf:{default:!0},debug:{default:!1}},init(){const e=this.el.sceneEl.audioListener.context;this.gainFilter=e.createGain(),this.data.debug&&(this.whiteNoise=function(e,t){const n=2*e.sampleRate,i=e.createBuffer(1,n,e.sampleRate),r=i.getChannelData(0);for(let e=0;e<n;e++)r[e]=.01*(2*Math.random()-1);const o=e.createBufferSource();return o.buffer=i,o.loop=!0,o.start(0),o}(e),this.setInput(this.whiteNoise)),this.el.object3D.updateMatrixWorld();const t=this.el.object3D.matrixWorld.getMaxScaleOnAxis();this.boundingRadiusSquared=t*t,this.data.debug&&this.el.setObject3D("debug",new Oy.LineSegments(new Oy.WireframeGeometry(new Oy.SphereBufferGeometry(1,10,10))))},setInput(e){this.input&&(this.input.disconnect(this.gainFilter),this.input=null),e&&(e.connect(this.gainFilter),this.input=e)},getGainFilter(){return this.gainFilter},tick(){if(this.el.object3D.getWorldPosition(Hy),this.trackingEl)this.trackingEl.object3D.position.distanceToSquared(Hy)>this.boundingRadiusSquared&&(this.trackingEl=null,this.setInput(this.whiteNoise));else{const e=window.APP.componentRegistry["player-info"];for(let t=0;t<e.length;t++){const n=e[t],i=n.el;this.data.onlyMods&&!n.can("amplify_audio")||("avatar-rig"!==i.id||this.el.sceneEl.is("entered"))&&i.object3D.position.distanceToSquared(Hy)<this.boundingRadiusSquared&&(this.trackingEl=i,this.data.muteSelf&&"avatar-rig"===this.trackingEl.id?this.setInput(null):By(this.trackingEl).then((e=>{const t=this.el.sceneEl.audioListener.context.createMediaStreamSource(e);this.setInput(t)})))}}}}),AFRAME.registerComponent("audio-target",{schema:{minDelay:{default:.01},maxDelay:{default:.13},srcEl:{type:"selector"},debug:{default:!1}},init(){this.audioSystem=this.el.sceneEl.systems["hubs-systems"].audioSystem,this.createAudio(),setTimeout((()=>{this.connectAudio()}),0),this.el.setAttribute("audio-zone-source"),this.createAudio=this.createAudio.bind(this),this.el.addEventListener("audio_type_changed",this.createAudio)},remove:function(){APP.supplementaryAttenuation.delete(this.el),APP.audios.delete(this.el),APP.sourceType.delete(this.el),this.removeAudio(),this.el.removeAttribute("audio-zone-source"),this.el.removeEventListener("audio_type_changed",this.createAudio)},createAudio:function(){this.removeAudio(),APP.sourceType.set(this.el,mh.AUDIO_TARGET);const e=this.el.sceneEl.audioListener,{audioType:t}=nm(this.el);let n=this.el.getObject3D(this.attrName);if(n=t===fh.PannerNode?new Oy.PositionalAudio(e):new Oy.Audio(e),this.audioSystem.addAudio({sourceType:mh.AVATAR_AUDIO_SOURCE,node:n}),this.data.maxDelay>0){const e=n.context.createDelay(this.data.maxDelay);e.delayTime.value=Oy.MathUtils.randFloat(this.data.minDelay,this.data.maxDelay),n.setFilters([e])}this.el.setObject3D(this.attrName,n),n.matrixNeedsUpdate=!0,n.updateMatrixWorld(),n.updateMatrixWorld(),APP.audios.set(this.el,n),rm(this.el,n)},connectAudio(){const e=this.data.srcEl,t=e&&e.components["zone-audio-source"],n=t&&t.getGainFilter();if(n){const e=this.el.getObject3D(this.attrName);e&&e.setNodeSource(n)}else console.warn(`Failed to get audio from source for ${this.el.className}`,e)},removeAudio(){this.el.getObject3D(this.attrName)&&(this.audioSystem.removeAudio({node:this.audio}),this.el.removeObject3D(this.attrName))}}),n(860);var zy=n(99477);AFRAME.registerComponent("video-texture-source",{schema:{resolution:{type:"vec2",default:[1280,720]},fps:{default:15}},init(){if(this.camera=Do(this.el.object3D,(e=>e.isCamera)),!this.camera)return void console.warn("video-texture-source added to an entity without a camera");this.camera.layers.enable(_o.CAMERA_LAYER_THIRD_PERSON_ONLY),this.camera.aspect=this.data.resolution[0]/this.data.resolution[1],this.renderTarget=new zy.WebGLRenderTarget(this.data.resolution[0],this.data.resolution[1],{format:zy.RGBAFormat,minFilter:zy.LinearFilter,magFilter:zy.NearestFilter,encoding:zy.sRGBEncoding});const e=this.renderTarget.texture;e.matrixAutoUpdate=!1,e.matrix.scale(1,-1),e.matrix.translate(0,1),this.textureNeedsUpdate=!1},remove(){wo(this.renderTarget.texture),this.renderTarget.dispose()},tock(e){if(!this.renderTarget||!this.textureNeedsUpdate)return;if(e<this.lastRenderTime+1e3/this.data.fps)return;const t=this.el.sceneEl,n=this.renderer||t.renderer,i=n.xr.enabled,r=t.object3D.onAfterRender;delete t.object3D.onAfterRender,n.xr.enabled=!1;const o=t.object3D.autoUpdate;t.object3D.autoUpdate=!1,n.setRenderTarget(this.renderTarget),n.clearDepth(),n.render(t.object3D,this.camera),n.setRenderTarget(null),t.object3D.autoUpdate=o,n.xr.enabled=i,t.object3D.onAfterRender=r,this.lastRenderTime=e,this.textureNeedsUpdate=!1}}),AFRAME.registerComponent("video-texture-target",{schema:{src:{type:"string"},srcEl:{type:"selector"},targetBaseColorMap:{type:"boolean",default:!0},targetEmissiveMap:{type:"boolean",default:!1}},getMaterial(){return this.el.object3DMap.skinnedmesh&&this.el.object3DMap.skinnedmesh.material||this.el.object3DMap.mesh&&this.el.object3DMap.mesh.material||this.el.object3D.material},init(){this.el.object3D.traverse((e=>{e.layers.mask1=e.layers.mask,e.layers.set(_o.CAMERA_LAYER_VIDEO_TEXTURE_TARGET)}));const e=this.getMaterial();e||console.warn("video-texture-target added to an entity without a material"),this.originalMap=e&&e.map,this.originalEmissiveMap=e&&e.emissiveMap},update(e){const t=this.getMaterial();if(!t)return;const n=this.data.src;if("el"===n){if(e.srcEl===this.data.srcEl)return;if(this.data.srcEl){const e=this.data.srcEl.components["video-texture-source"],n=e.renderTarget.texture;this.applyTexture(n),t.onBeforeRender=()=>{e.textureNeedsUpdate=!0}}else t.map=this.originalMap,t.emissiveMap=this.originalEmissiveMap,t.needsUpdate=!0}else if(n&&n.startsWith("hubs://")){if(e.src===n)return;const t=n.substring(7).split("/")[1];APP.dialog.getMediaStream(t,"video").then((e=>{if(n!==this.data.src)return;const t=Gl("video");t.srcObject=e,t.play();const i=new zy.VideoTexture(t);i.flipY=!1,i.minFilter=zy.LinearFilter,i.encoding=zy.sRGBEncoding,this.applyTexture(i)}))}else t.map&&t.map!==this.originalMap&&wo(t.map),t.emissiveMap&&t.emissiveMap!==this.originalEmissiveMap&&wo(t.emissiveMap),t.map=this.originalMap,t.emissiveMap=this.originalEmissiveMap,t.needsUpdate=!0},applyTexture(e){const t=this.getMaterial(),n=this.originalMap||this.originalEmissiveMap;n&&(e.wrapS=n.wrapS,e.wrapT=n.wrapT),this.data.targetBaseColorMap&&(t.map=e),this.data.targetEmissiveMap&&(t.emissiveMap=e),t.needsUpdate=!0},remove(){if(this.el.object3D.traverse((e=>{e.layers.mask1&&(e.layers.mask=e.layers.mask1,delete e.layers.mask1)})),"el"===this.data.src)return;const e=this.getMaterial();e&&e.map&&e.map!==this.originalMap&&wo(e.map),e.emissiveMap&&e.emissiveMap!==this.originalEmissiveMap&&wo(e.emissiveMap)}});const Wy=new(n(99477).PlaneBufferGeometry),qy=window.innerWidth*window.devicePixelRatio,Zy=window.innerHeight*window.devicePixelRatio;AFRAME.registerComponent("mirror",{schema:{color:{type:"color",default:"#7f7f7f"}},init(){var e,t;const n=(null===(e=this.el.object3DMap)||void 0===e||null===(t=e.mesh)||void 0===t?void 0:t.geometry)||Wy,i=new Xu.r(n,{color:this.data.color,textureWidth:qy,textureHeight:Zy});this.el.setObject3D("mesh",i);const r=i.onBeforeRender;i.onBeforeRender=function(e,t,n){const o=e.render;e.render=function(t,n){n.layers.enable(_o.CAMERA_LAYER_THIRD_PERSON_ONLY),n.layers.enable(_o.CAMERA_LAYER_VIDEO_TEXTURE_TARGET),i.onBeforeRender=r,o.call(e,t,n)},r(e,t,n),e.render=o}}});var Gy=n(73935),Yy=n(67294),Qy=n(73931),Xy=n(59731);function Ky(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function $y(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Jy(e,t,n,i,r,o,s){let a={};const l=(e.location.state&&e.location.state.__historyLength||0)+(t?0:1);(n||o||s)&&(a=e.location.state?function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ky(Object(n),!0).forEach((function(t){$y(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ky(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e.location.state):{},delete a.__duplicate,n&&(a[n]=i,a.key=n,a.value=i,a.detail=r));const c=void 0!==o?o:"/"===e.location.pathname?"":e.location.pathname,d=void 0!==s?s:e.location.search,u=e.location.hash,h=e.location.state&&e.location.state.__duplicate,p=t||h?e.replace:e.push;a.__historyLength=l,p({pathname:c,search:d,state:a,hash:u})}function ew(e,t,n,i){Jy(e,!1,t,n,i)}function tw(e,t,n){Jy(e,!1,null,null,null,t,n)}function nw(e,t){if(!e.location.state||void 0===e.location.state.__historyLength)return;const n=e.location.state.__historyLength;return 0!==n?new Promise((i=>{const r=e.listen((()=>{r(),e.push({pathname:e.location.pathname,search:e.location.search,state:{__historyLength:0,__duplicate:!0}}),t&&e.go(-2),i()}));e.go(-n)})):void 0}function iw(e){return`/${e.pathname.split("/").slice(2).join("/")}`}function rw(e,t){return`/${e.pathname.split("/")[1]}${t}`}var ow=n(45697),sw=n.n(ow),aw=n(94184),lw=n.n(aw),cw=n(20640),dw=n.n(cw),uw=n(44012);function hw(e,t,n,i,r,o,s){try{var a=e[o](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(i,r)}const{detect:pw}=n(82701),mw=pw(),fw={yes:"yes",no:"no",maybe:"maybe"},gw=[/cardboard/i];function vw(){return bw.apply(this,arguments)}function bw(){var e;return e=function*(){const e=navigator.userAgent,t="chrome"===mw.name&&/SamsungBrowser/.test(e),n=AFRAME.utils.device.isMobile(),i=AFRAME.utils.device.isMobileVR(),r=window.hasNativeWebVRImplementation,o=window.hasNativeWebXRImplementation,s=!(!r||"chrome"!==mw.name||t),a=Q(),l="firefox"===mw.name,c=void 0===navigator.mediaDevices,d=a?c?fw.maybe:fw.yes:fw.no,u=!(!n||a||"chrome"!==mw.name||t);let h=[];try{("chrome"!==mw.name||n)&&(h=r||u?yield navigator.getVRDisplays():[])}catch(e){console.warn("navigator.getVRDisplays() failed",e)}const p=/Oculus/.test(e),m=i?fw.no:a&&c?fw.maybe:fw.yes;let f=n||!r&&l?fw.no:fw.maybe,g=fw.no,v=fw.no;(function(e){return/\WAndroid\W/.test(e)})(e)&&(v=p?fw.yes:fw.maybe);let b=function(e){return/\WAndroid\W/.test(e)}(e)&&!i?fw.maybe:fw.no;return g=u&&h.find((e=>e.capabilities.canPresent&&/cardboard/i.test(e.displayName)))?fw.yes:fw.no,r&&(f=h.find((e=>e.capabilities.canPresent&&!gw.find((t=>t.test(e.displayName)))))?fw.yes:fw.no,h.find((e=>/daydream/i.test(e.displayName)))?(b=fw.yes,f=fw.no):s&&(b=fw.no)),o&&(f=!0),{screen:m,generic:f,gearvr:v,daydream:b,cardboard:g,safari:d}},bw=function(){var t=this,n=arguments;return new Promise((function(i,r){var o=e.apply(t,n);function s(e){hw(o,i,r,s,a,"next",e)}function a(e){hw(o,i,r,s,a,"throw",e)}s(void 0)}))},bw.apply(this,arguments)}const yw={screen:fw.yes,generic:fw.no,gearvr:fw.no,daydream:fw.no,cardboard:fw.no,safari:fw.no},ww=AFRAME.utils.device.isMobileVR();function _w(){return navigator.share&&!ww}function Ew(e){if(_w())return navigator.share(e);{const{title:t,url:n}=e,i=550,r=420,o=(screen.width-i)/2,s=`scrollbars=no,menubar=no,toolbar=no,status=no,width=${i},height=${r},top=${(screen.height-r)/2},left=${o}`,a=`https://twitter.com/intent/tweet?url=${encodeURIComponent(n)}&text=${encodeURIComponent(t)}`;return window.open(a,"_blank",s),Promise.resolve()}}var Aw={"hide-lg":"style-utils__hide-lg__rXFJz",hideLg:"style-utils__hide-lg__rXFJz","show-lg":"style-utils__show-lg__UpSEb",showLg:"style-utils__show-lg__UpSEb","margin-0":"style-utils__margin-0__KkfJM",margin0:"style-utils__margin-0__KkfJM",textError:"style-utils__textError__ySIF5","2xs-margin-y":"style-utils__2xs-margin-y__dz6I9","2XsMarginY":"style-utils__2xs-margin-y__dz6I9","2xs-margin-r":"style-utils__2xs-margin-r__s05Qm","2XsMarginR":"style-utils__2xs-margin-r__s05Qm","2xs-margin-l":"style-utils__2xs-margin-l__a4wdt","2XsMarginL":"style-utils__2xs-margin-l__a4wdt","2xs-margin-bottom":"style-utils__2xs-margin-bottom__InDYJ","2XsMarginBottom":"style-utils__2xs-margin-bottom__InDYJ","2xs-margin-top":"style-utils__2xs-margin-top__ncUYG","2XsMarginTop":"style-utils__2xs-margin-top__ncUYG","2xs-padding":"style-utils__2xs-padding__Fy_1J","2XsPadding":"style-utils__2xs-padding__Fy_1J","2xs-wrap-margin":"style-utils__2xs-wrap-margin__s10xt","2XsWrapMargin":"style-utils__2xs-wrap-margin__s10xt","xs-margin-y":"style-utils__xs-margin-y__Ko8vB",xsMarginY:"style-utils__xs-margin-y__Ko8vB","xs-margin-r":"style-utils__xs-margin-r__YUwDE",xsMarginR:"style-utils__xs-margin-r__YUwDE","xs-margin-l":"style-utils__xs-margin-l__JFZpu",xsMarginL:"style-utils__xs-margin-l__JFZpu","xs-margin-bottom":"style-utils__xs-margin-bottom__THXKr",xsMarginBottom:"style-utils__xs-margin-bottom__THXKr","xs-margin-top":"style-utils__xs-margin-top__PHtKS",xsMarginTop:"style-utils__xs-margin-top__PHtKS","xs-padding":"style-utils__xs-padding__zn2Bm",xsPadding:"style-utils__xs-padding__zn2Bm","xs-wrap-margin":"style-utils__xs-wrap-margin__ud4Ol",xsWrapMargin:"style-utils__xs-wrap-margin__ud4Ol","sm-margin-y":"style-utils__sm-margin-y__qkaiv",smMarginY:"style-utils__sm-margin-y__qkaiv","sm-margin-r":"style-utils__sm-margin-r__wO0mi",smMarginR:"style-utils__sm-margin-r__wO0mi","sm-margin-l":"style-utils__sm-margin-l__ikRsW",smMarginL:"style-utils__sm-margin-l__ikRsW","sm-margin-bottom":"style-utils__sm-margin-bottom__sL7g3",smMarginBottom:"style-utils__sm-margin-bottom__sL7g3","sm-margin-top":"style-utils__sm-margin-top__sx7cP",smMarginTop:"style-utils__sm-margin-top__sx7cP","sm-padding":"style-utils__sm-padding__NGuEN",smPadding:"style-utils__sm-padding__NGuEN","sm-wrap-margin":"style-utils__sm-wrap-margin__KdMMC",smWrapMargin:"style-utils__sm-wrap-margin__KdMMC","md-margin-y":"style-utils__md-margin-y__HzmWb",mdMarginY:"style-utils__md-margin-y__HzmWb","md-margin-r":"style-utils__md-margin-r__DpiDI",mdMarginR:"style-utils__md-margin-r__DpiDI","md-margin-l":"style-utils__md-margin-l__DcpHY",mdMarginL:"style-utils__md-margin-l__DcpHY","md-margin-bottom":"style-utils__md-margin-bottom__u4Yw9",mdMarginBottom:"style-utils__md-margin-bottom__u4Yw9","md-margin-top":"style-utils__md-margin-top__wJzyR",mdMarginTop:"style-utils__md-margin-top__wJzyR","md-padding":"style-utils__md-padding__yDslX",mdPadding:"style-utils__md-padding__yDslX","md-wrap-margin":"style-utils__md-wrap-margin__Zq10k",mdWrapMargin:"style-utils__md-wrap-margin__Zq10k","lg-margin-y":"style-utils__lg-margin-y__f5CMV",lgMarginY:"style-utils__lg-margin-y__f5CMV","lg-margin-r":"style-utils__lg-margin-r__osZ3t",lgMarginR:"style-utils__lg-margin-r__osZ3t","lg-margin-l":"style-utils__lg-margin-l__UZ8fF",lgMarginL:"style-utils__lg-margin-l__UZ8fF","lg-margin-bottom":"style-utils__lg-margin-bottom__SuMJj",lgMarginBottom:"style-utils__lg-margin-bottom__SuMJj","lg-margin-top":"style-utils__lg-margin-top__TYCaC",lgMarginTop:"style-utils__lg-margin-top__TYCaC","lg-padding":"style-utils__lg-padding__mUNzR",lgPadding:"style-utils__lg-padding__mUNzR","lg-wrap-margin":"style-utils__lg-wrap-margin__cvqUC",lgWrapMargin:"style-utils__lg-wrap-margin__cvqUC","xl-margin-y":"style-utils__xl-margin-y__huAwr",xlMarginY:"style-utils__xl-margin-y__huAwr","xl-margin-r":"style-utils__xl-margin-r__TU7TF",xlMarginR:"style-utils__xl-margin-r__TU7TF","xl-margin-l":"style-utils__xl-margin-l__GOXHe",xlMarginL:"style-utils__xl-margin-l__GOXHe","xl-margin-bottom":"style-utils__xl-margin-bottom__kKLk8",xlMarginBottom:"style-utils__xl-margin-bottom__kKLk8","xl-margin-top":"style-utils__xl-margin-top__l08YH",xlMarginTop:"style-utils__xl-margin-top__l08YH","xl-padding":"style-utils__xl-padding__gDLaP",xlPadding:"style-utils__xl-padding__gDLaP","xl-wrap-margin":"style-utils__xl-wrap-margin__kSktP",xlWrapMargin:"style-utils__xl-wrap-margin__kSktP","flex-basis-10":"style-utils__flex-basis-10__JK7ed",flexBasis10:"style-utils__flex-basis-10__JK7ed","flex-basis-20":"style-utils__flex-basis-20__WYUCu",flexBasis20:"style-utils__flex-basis-20__WYUCu","flex-basis-30":"style-utils__flex-basis-30___o3Vd",flexBasis30:"style-utils__flex-basis-30___o3Vd","flex-basis-40":"style-utils__flex-basis-40__wf3lt",flexBasis40:"style-utils__flex-basis-40__wf3lt","flex-basis-50":"style-utils__flex-basis-50__Or9Ki",flexBasis50:"style-utils__flex-basis-50__Or9Ki","flex-basis-60":"style-utils__flex-basis-60__Vfos3",flexBasis60:"style-utils__flex-basis-60__Vfos3","flex-basis-70":"style-utils__flex-basis-70__R1zxM",flexBasis70:"style-utils__flex-basis-70__R1zxM","flex-basis-80":"style-utils__flex-basis-80__nZyZw",flexBasis80:"style-utils__flex-basis-80__nZyZw"};const Sw=Yy.createContext({});sw().object,sw().string;const xw=["history","stateKey","stateValue"];function Mw(){return Mw=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},Mw.apply(this,arguments)}class Pw extends Yy.Component{render(){const e=this.props,{history:t,stateKey:n,stateValue:i}=e,r=function(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}(e,xw);return!t.location.state&&!i||t.location.state&&(t.location.state[n]===i||!t.location.state[n]&&!i)?Yy.createElement(Qy.AW,Mw({path:"/"},r)):null}}Pw.propTypes={stateKey:sw().string,stateValue:sw().string,history:sw().object};var Cw=Pw;const kw=1e-5,Ow=(()=>{const e=new Map,t=[],n=[];return function(){if(!window.APP||!window.APP.componentRegistry)return null;const i=AFRAME.scenes[0];n.length=0;const r=window.APP.componentRegistry["player-info"];if(r)for(let o=0;o<r.length;o++){const s=r[o],a=s.playerSessionId;let l=!1;if(s.isLocalPlayerInfo&&(l=i.systems["local-audio-analyser"].volume>kw),-1===t.indexOf(a)&&t.push(a),n.push(a),e.has(a)){const t=e.get(a);t.muted=s.data.muted,t.talking=l}else e.set(a,{muted:s.data.muted,talking:l})}const o=window.APP.componentRegistry["networked-audio-analyser"];if(o)for(let t=0;t<o.length;t++){const n=o[t];e.has(n.playerSessionId)&&n.volume>kw&&(e.get(n.playerSessionId).talking=!0)}for(let i=t.length-1;i>=0;i--){const r=t[i];-1===n.indexOf(r)&&(e.delete(r),t.splice(i,1))}return e}})();var Tw={sidebar:"Sidebar__sidebar__KYENJ",header:"Sidebar__header__zbsTL","before-title":"Sidebar__before-title__SDmnu",beforeTitle:"Sidebar__before-title__SDmnu","after-title":"Sidebar__after-title__tQwef",afterTitle:"Sidebar__after-title__tQwef",content:"Sidebar__content__PP6Vz","overflow-y":"Sidebar__overflow-y__iAkyO",overflowY:"Sidebar__overflow-y__iAkyO"};function Rw(e){let{title:t,beforeTitle:n,afterTitle:i,children:r,contentClassName:o,className:s,disableOverflowScroll:a}=e;return Yy.createElement("div",{className:lw()(Tw.sidebar,s)},(t||n||i)&&Yy.createElement("div",{className:Tw.header},Yy.createElement("div",{className:Tw.beforeTitle},n),Yy.createElement("h5",null,t),Yy.createElement("div",{className:Tw.afterTitle},i)),Yy.createElement("div",{className:lw()(Tw.content,a?"":Tw.overflowY,o)},r))}Rw.propTypes={title:sw().node,beforeTitle:sw().node,afterTitle:sw().node,children:sw().node,className:sw().string,contentClassName:sw().string,disableOverflowScroll:sw().bool},Rw.defaultProps={disableOverflowScroll:!1};var Dw={"icon-button":"IconButton__icon-button__yRJAL",iconButton:"IconButton__icon-button__yRJAL","compact-sm":"IconButton__compact-sm__T7cFR",compactSm:"IconButton__compact-sm__T7cFR",lg:"IconButton__lg__CaPV3"};const jw=["className","as","compactSm","lg","children"];function Lw(){return Lw=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},Lw.apply(this,arguments)}const Iw=(0,Yy.memo)((0,Yy.forwardRef)(((e,t)=>{let{className:n,as:i,compactSm:r,lg:o,children:s}=e,a=function(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}(e,jw);const l="button"===i?{type:"button"}:{};return Yy.createElement(i,Lw({className:lw()(Dw.iconButton,"TextInput__icon-button__GFPbS",{[Dw.compactSm]:r,[Dw.lg]:o},n)},l,a,{ref:t}),s)})));var Nw,Fw;function Bw(){return Bw=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},Bw.apply(this,arguments)}Iw.propTypes={as:sw().elementType,compactSm:sw().bool,lg:sw().bool,className:sw().string,children:sw().node},Iw.defaultProps={as:"button"},Iw.displayName="IconButton";const Vw=e=>{let{title:t,titleId:n,...i}=e;return Yy.createElement("svg",Bw({width:20,height:20,viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":n},i),t?Yy.createElement("title",{id:n},t):null,Nw||(Nw=Yy.createElement("path",{d:"M17 17 3 3",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"})),Fw||(Fw=Yy.createElement("path",{d:"M17 3 3 17",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"})))};var Uw={lg:"CloseButton__lg__CMV4C"};const Hw=["lg","className"];function zw(){return zw=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},zw.apply(this,arguments)}function Ww(e){let{lg:t,className:n}=e,i=function(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}(e,Hw);return Yy.createElement(Iw,zw({className:lw()({[Uw.lg]:t},n)},i),Yy.createElement(Vw,{width:16,height:16}))}Ww.propTypes={className:sw().string,lg:sw().bool};var qw,Zw={"back-button":"BackButton__back-button__tGiDz",backButton:"BackButton__back-button__tGiDz"};function Gw(){return Gw=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},Gw.apply(this,arguments)}const Yw=e=>{let{title:t,titleId:n,...i}=e;return Yy.createElement("svg",Gw({width:20,height:20,viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":n},i),t?Yy.createElement("title",{id:n},t):null,qw||(qw=Yy.createElement("path",{d:"m14 3-7 7 7 7",stroke:"currentColor",strokeWidth:2.25,strokeLinecap:"round",strokeLinejoin:"round"})))},Qw=["className"];function Xw(){return Xw=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},Xw.apply(this,arguments)}function Kw(e){let{className:t}=e,n=function(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}(e,Qw);return Yy.createElement(Iw,Xw({className:lw()(Zw.backButton,t)},n),Yy.createElement(Yw,null),Yy.createElement("span",null,Yy.createElement(uw.Z,{id:"back-button",defaultMessage:"Back"})))}Kw.propTypes={className:sw().string,children:sw().node};var $w={button:"Button__button__SO7tb",basic:"Button__basic__dX1eF",transparent:"Button__transparent__Xwl1d",primary:"Button__primary__V_Unf",accept:"Button__accept__Vxz39",cancel:"Button__cancel__fMd88",accent1:"Button__accent1__YxQTQ",accent2:"Button__accent2__csjI4",accent3:"Button__accent3__lDoUQ",accent4:"Button__accent4__rpZEP",accent5:"Button__accent5__CtJzN",accent6:"Button__accent6__f31oh",sm:"Button__sm__SbzRJ",lg:"Button__lg__W7ykj",xl:"Button__xl__ppsaD",thin:"Button__thin__QLHYO",thick:"Button__thick__RwZJD",signin:"Button__signin__dunbY",landing:"Button__landing__zi2zl",text:"Button__text__V4_gH"};const Jw=["as","sm","lg","xl","thin","thick","preset","className","children"];function e_(){return e_=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},e_.apply(this,arguments)}const t_=(0,Yy.memo)((0,Yy.forwardRef)(((e,t)=>{let{as:n,sm:i,lg:r,xl:o,thin:s,thick:a,preset:l,className:c,children:d}=e,u=function(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}(e,Jw);const h=n,p="button"===h?{type:"button"}:{};return Yy.createElement(h,e_({className:lw()($w.button,"TextInput__button__QrvX4",$w[l],{[$w.sm]:i,[$w.lg]:r,[$w.xl]:o,[$w.thin]:s,[$w.thick]:a},c)},p,u,{ref:t}),d)})));function n_(e){return Yy.createElement(t_,e_({preset:"accept"},e),Yy.createElement(uw.Z,{id:"button.next",defaultMessage:"Next"}))}function i_(e){return Yy.createElement(t_,e_({preset:"cancel"},e),Yy.createElement(uw.Z,{id:"button.cancel",defaultMessage:"Cancel"}))}function r_(e){return Yy.createElement(t_,e_({preset:"accept"},e),Yy.createElement(uw.Z,{id:"button.continue",defaultMessage:"Continue"}))}function o_(e){return Yy.createElement(t_,e_({preset:"accept"},e),Yy.createElement(uw.Z,{id:"button.accept",defaultMessage:"Accept"}))}function s_(e){return Yy.createElement(t_,e_({preset:"accept"},e),Yy.createElement(uw.Z,{id:"button.apply",defaultMessage:"Apply"}))}t_.propTypes={as:sw().elementType,preset:sw().oneOf(["transparent","basic","primary","accept","cancel","accent1","accent2","accent3","accent4","accent5","accent6","landing","signin","text"]),className:sw().string,children:sw().node,sm:sw().bool,lg:sw().bool,xl:sw().bool,thin:sw().bool,thick:sw().bool},t_.defaultProps={as:"button",preset:"basic"};var a_={content:"AvatarSettingsContent__content__Os6X7","avatar-preview-container":"AvatarSettingsContent__avatar-preview-container__PmJlf",avatarPreviewContainer:"AvatarSettingsContent__avatar-preview-container__PmJlf"};const l_=["id","htmlFor","label","error","description","className","fullWidth","children"];function c_(){return c_=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},c_.apply(this,arguments)}const d_=(0,Yy.memo)((e=>{let{id:t,htmlFor:n,label:i,error:r,description:o,className:s,fullWidth:a,children:l}=e,c=function(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}(e,l_);return Yy.createElement("div",c_({className:lw()("InputField__input-field__L7dXt",{InputField__fullWidth__BMV9Y:a},s)},c),i&&Yy.createElement("label",{id:t,className:"InputField__label__gaP9K",htmlFor:n},i),l,r?Yy.createElement("small",{className:"InputField__error__xVt9D"},r):o?Yy.createElement("small",{className:"InputField__info__KHxQ_"},o):void 0)}));var u_,h_,p_;function m_(){return m_=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},m_.apply(this,arguments)}d_.propTypes={id:sw().string,htmlFor:sw().string,label:sw().node,className:sw().string,children:sw().node,error:sw().node,description:sw().node,fullWidth:sw().bool};const f_=e=>{let{title:t,titleId:n,...i}=e;return Yy.createElement("svg",m_({width:20,height:20,viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":n},i),t?Yy.createElement("title",{id:n},t):null,u_||(u_=Yy.createElement("path",{d:"M3.343 17.43h13.314a1.25 1.25 0 0 0 1.1-1.842L11.102 3.223a1.25 1.25 0 0 0-2.202 0L2.242 15.588a1.25 1.25 0 0 0 1.1 1.842v0Z",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})),h_||(h_=Yy.createElement("path",{d:"M9.776 7.632 10 12.398l.224-4.764a.225.225 0 0 0-.227-.234v0a.224.224 0 0 0-.221.232v0Z",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})),p_||(p_=Yy.createElement("path",{d:"M10 15.517a.782.782 0 1 1 0-1.563.782.782 0 0 1 0 1.563Z",fill:"currentColor"})))},{detect:g_}=n(82701),v_=g_();let b_=!1;const y_=["id","disabled","invalid","className","beforeInput","afterInput","onFocus","onBlur","textInputStyles","as"];function w_(){return w_=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},w_.apply(this,arguments)}const __=(0,Yy.memo)((0,Yy.forwardRef)(((e,t)=>{let{id:n,disabled:i,invalid:r,className:o,beforeInput:s,afterInput:a,onFocus:l,onBlur:c,textInputStyles:d,as:u}=e,h=function(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}(e,y_);return Yy.createElement("div",{className:lw()("TextInput__outer-wrapper__uRuYD",$w.inputGroup,Dw.inputGroup,{TextInput__invalid__fgYQd:r,TextInput__disabled__tE3wE:i},o)},Yy.createElement("div",{className:"TextInput__before-input__PyF6b"},s),Yy.createElement("div",{className:"TextInput__input-wrapper__uv7jY"},Yy.createElement(u,w_({id:n,className:lw()("TextInput__text-input__HqvuV",d),disabled:i,onFocus:e=>{!function(e){if(!window.AFRAME)return;const t=AFRAME.utils.device.isMobile();pb().isFullscreen&&!AFRAME.utils.device.isMobileVR()&&"firefox"===v_.name&&(b_=!0,pb().exit().then((()=>{e.focus()}))),t||e.select()}(e.target),l&&l(e)},onBlur:e=>{b_?b_=!1:wb(),c&&c(e)}},h,{ref:t}))),Yy.createElement("div",{className:"TextInput__after-input__gJzy3"},r&&Yy.createElement(f_,{className:"TextInput__invalid-icon__CszSQ"}),a))})));__.propTypes={id:sw().string.isRequired,disabled:sw().bool,invalid:sw().bool,className:sw().string,onChange:sw().func,beforeInput:sw().node,afterInput:sw().node,onFocus:sw().func,onBlur:sw().func,textInputStyles:sw().string,as:sw().elementType},__.defaultProps={onChange:()=>{},as:"input"},__.displayName="TextInput";let E_=0;function A_(){const[e]=(0,Yy.useState)((()=>"id_"+E_++));return e}const S_=["className","error","description","inputClassName","label","fullWidth"];function x_(){return x_=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},x_.apply(this,arguments)}const M_=(0,Yy.memo)((0,Yy.forwardRef)(((e,t)=>{let{className:n,error:i,description:r,inputClassName:o,label:s,fullWidth:a}=e,l=function(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}(e,S_);const c=A_(),d=A_();return Yy.createElement(d_,{id:d,htmlFor:c,className:n,label:s,error:i,description:r,fullWidth:a},Yy.createElement(__,x_({id:c,ref:t,className:o},l)))})));M_.propTypes={className:sw().string,label:sw().node,error:sw().node,description:sw().node,labelClassName:sw().string,inputClassName:sw().string,fullWidth:sw().bool};var P_={column:"Column__column__ZuRI0","xs-gap":"Column__xs-gap__PAIcR",xsGap:"Column__xs-gap__PAIcR","sm-gap":"Column__sm-gap__j3Pc1",smGap:"Column__sm-gap__j3Pc1","md-gap":"Column__md-gap__YLriB",mdGap:"Column__md-gap__YLriB","lg-gap":"Column__lg-gap__ferMl",lgGap:"Column__lg-gap__ferMl","xl-gap":"Column__xl-gap__mso6a",xlGap:"Column__xl-gap__mso6a","xs-padding":"Column__xs-padding__vnqZ1",xsPadding:"Column__xs-padding__vnqZ1","sm-padding":"Column__sm-padding__DvAmG",smPadding:"Column__sm-padding__DvAmG","md-padding":"Column__md-padding__k6ZWh",mdPadding:"Column__md-padding__k6ZWh","lg-padding":"Column__lg-padding__SlnQw",lgPadding:"Column__lg-padding__SlnQw","xl-padding":"Column__xl-padding__TOmJS",xlPadding:"Column__xl-padding__TOmJS",center:"Column__center__kI2HA","center-vertical":"Column__center-vertical__Uzq_X",centerVertical:"Column__center-vertical__Uzq_X","center-md":"Column__center-md__fjQvr",centerMd:"Column__center-md__fjQvr","center-vertical-md":"Column__center-vertical-md__cpCgX",centerVerticalMd:"Column__center-vertical-md__cpCgX",grow:"Column__grow__DxOwX",overflow:"Column__overflow__NUMaz","margin-0-last-child":"Column__margin-0-last-child__aJIlP",margin0LastChild:"Column__margin-0-last-child__aJIlP"};const C_=["as","lastChildMargin","className","gap","padding","center","centerMd","grow","overflow","children"];function k_(){return k_=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},k_.apply(this,arguments)}const O_=(0,Yy.forwardRef)(((e,t)=>{let{as:n,lastChildMargin:i,className:r,gap:o,padding:s,center:a,centerMd:l,grow:c,overflow:d,children:u}=e,h=function(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}(e,C_);const p=!0===o?P_.mdGap:P_[`${o}Gap`],m=!0===s?P_.lgPadding:P_[`${s}Padding`];return Yy.createElement(n,k_({},h,{ref:t,className:lw()(P_.column,p,m,{[P_.center]:!0===a||"horizontal"===a||"both"===a,[P_.centerVertical]:"vertical"===a||"both"===a,[P_.centerMd]:!0===l||"horizontal"===l||"both"===l,[P_.centerVerticalMd]:"vertical"===l||"both"===l,[P_.grow]:c,[P_.overflow]:d,[P_.margin0LastChild]:i},r)}),u)}));O_.propTypes={as:sw().elementType,className:sw().string,children:sw().node,gap:sw().oneOfType([sw().string,sw().bool]),padding:sw().oneOfType([sw().string,sw().bool]),centerMd:sw().oneOfType([sw().string,sw().bool]),center:sw().oneOfType([sw().string,sw().bool]),grow:sw().bool,lastChildMargin:sw().bool,overflow:sw().bool},O_.defaultProps={as:"div",gap:"md",center:!1,centerMd:!1,padding:!1,grow:!1,overflow:!1,lastChildMargin:!0};const T_=["displayName","displayNameInputRef","disableDisplayNameInput","onChangeDisplayName","avatarPreview","displayNamePattern","onChangeAvatar"];function R_(){return R_=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},R_.apply(this,arguments)}function D_(e){let{displayName:t,displayNameInputRef:n,disableDisplayNameInput:i,onChangeDisplayName:r,avatarPreview:o,displayNamePattern:s,onChangeAvatar:a}=e,l=function(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}(e,T_);return Yy.createElement(O_,R_({as:"form",className:a_.content},l),Yy.createElement(M_,{disabled:i,label:Yy.createElement(uw.Z,{id:"avatar-settings-content.display-name-label",defaultMessage:"Display Name"}),value:t,pattern:s,spellCheck:"false",required:!0,onChange:r,description:Yy.createElement(uw.Z,{id:"avatar-settings-content.display-name-description",defaultMessage:"Alphanumerics, hyphens, underscores, and tildes. At least 3 characters, no more than 32"}),ref:n}),Yy.createElement("div",{className:a_.avatarPreviewContainer},o||Yy.createElement("div",null),Yy.createElement(t_,{type:"button",preset:"basic",onClick:a},Yy.createElement(uw.Z,{id:"avatar-settings-content.change-avatar-button",defaultMessage:"Change Avatar"}))),Yy.createElement(o_,{preset:"accept",type:"submit"}))}D_.propTypes={className:sw().string,displayName:sw().string,displayNameInputRef:sw().func,disableDisplayNameInput:sw().bool,displayNamePattern:sw().string,onChangeDisplayName:sw().func,avatarPreview:sw().node,onChangeAvatar:sw().func};const j_=["className","showBackButton","onBack","onClose"];function L_(e){let{className:t,showBackButton:n,onBack:i,onClose:r}=e,o=function(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}(e,j_);return Yy.createElement(Rw,{title:Yy.createElement(uw.Z,{id:"avatar-settings-sidebar.title",defaultMessage:"Avatar Settings"}),beforeTitle:n?Yy.createElement(Kw,{onClick:i}):Yy.createElement(Ww,{onClick:r}),className:t},Yy.createElement(D_,o))}L_.propTypes={showBackButton:sw().bool,className:sw().string,onBack:sw().func,onClose:sw().func};var I_={modal:"Modal__modal__kXfrn",header:"Modal__header__Y8MjO","before-title":"Modal__before-title___noRj",beforeTitle:"Modal__before-title___noRj","after-title":"Modal__after-title__i3h06",afterTitle:"Modal__after-title__i3h06",content:"Modal__content__qgHt_","sm-fullscreen":"Modal__sm-fullscreen__XA0fq",smFullscreen:"Modal__sm-fullscreen__XA0fq"};function N_(e){let{title:t,titleNode:n,beforeTitle:i,afterTitle:r,children:o,contentClassName:s,className:a,disableFullscreen:l}=e;return Yy.createElement("div",{className:lw()(I_.modal,{[I_.smFullscreen]:!l},a)},(t||i||r)&&Yy.createElement("div",{className:I_.header},Yy.createElement("div",{className:I_.beforeTitle},i),n||Yy.createElement("h5",null,t),Yy.createElement("div",{className:I_.afterTitle},r)),Yy.createElement("div",{className:lw()(I_.content,s)},o))}N_.propTypes={title:sw().node,titleNode:sw().node,beforeTitle:sw().node,afterTitle:sw().node,children:sw().node,className:sw().string,contentClassName:sw().string,disableFullscreen:sw().bool};const F_=["className","onBack"];function B_(e){let{className:t,onBack:n}=e,i=function(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}(e,F_);return Yy.createElement(N_,{title:Yy.createElement(uw.Z,{id:"avatar-setup-sidebar.title",defaultMessage:"Avatar Setup"}),beforeTitle:Yy.createElement(Kw,{onClick:n}),className:t},Yy.createElement(D_,i))}B_.propTypes={className:sw().string,onBack:sw().func};var V_=n(74806),U_=n(69365),H_=n.p+"assets/images/cubemap/posx-818c43c014ca2a6d78cd..jpg",z_=n.p+"assets/images/cubemap/negx-87722bb4e14aafeae99a..jpg",W_=n.p+"assets/images/cubemap/posy-5d7797ed9fb3992e2ad5..jpg",q_=n.p+"assets/images/cubemap/negy-e7615093c7905a75b2cd..jpg",Z_=n.p+"assets/images/cubemap/posz-5f0c1deffc75ae72e50f..jpg",G_=n.p+"assets/images/cubemap/negz-4cb0b5db71f1aa66a60c..jpg",Y_=n(99477);function Q_(e,t,n,i,r,o,s){try{var a=e[o](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(i,r)}function X_(){var e;return e=function*(){const e=[H_,z_,W_,q_,Z_,G_],t=yield new Promise(((t,n)=>(new Y_.CubeTextureLoader).load(e,t,void 0,n)));return t.format=Y_.RGBAFormat,t},X_=function(){var t=this,n=arguments;return new Promise((function(i,r){var o=e.apply(t,n);function s(e){Q_(o,i,r,s,a,"next",e)}function a(e){Q_(o,i,r,s,a,"throw",e)}s(void 0)}))},X_.apply(this,arguments)}function K_(e,t,n,i,r,o,s){try{var a=e[o](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(i,r)}const $_=window.createImageBitmap||function(){var e,t=(e=function*(e){return new Promise((t=>{let n;if(e instanceof Blob)n=URL.createObjectURL(e);else{const t=document.createElement("canvas"),i=t.getContext("2d");t.width=e.width,t.height=e.height,i.putImageData(e,0,0),n=t.toDataURL()}const i=document.createElement("img");i.addEventListener("load",(()=>t(i))),i.src=n}))},function(){var t=this,n=arguments;return new Promise((function(i,r){var o=e.apply(t,n);function s(e){K_(o,i,r,s,a,"next",e)}function a(e){K_(o,i,r,s,a,"throw",e)}s(void 0)}))});return function(e){return t.apply(this,arguments)}}();function J_(e){e instanceof HTMLImageElement&&e.src.startsWith("blob:")?URL.revokeObjectURL(e.src):e.close&&e.close()}var eE=n.p+"assets/images/warning_icon@2x-440b0d5f8a4953f0b577..png",tE=n(99477);function nE(e,t,n,i,r,o,s){try{var a=e[o](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(i,r)}function iE(e){return function(){var t=this,n=arguments;return new Promise((function(i,r){var o=e.apply(t,n);function s(e){nE(o,i,r,s,a,"next",e)}function a(e){nE(o,i,r,s,a,"throw",e)}s(void 0)}))}}const rE={base_map:["map"],emissive_map:["emissiveMap"],normal_map:["normalMap"],orm_map:["aoMap","roughnessMap","metalnessMap"]},oE=Object.keys(rE);function sE(e,t,n){void 0===t&&(t=!1),void 0===n&&(n=!0);const i=e.getContext("webgl2",{alpha:t,depth:!0,antialias:!0,premultipliedAlpha:!0,preserveDrawingBuffer:!1,powerPreference:"default"}),r=new tE.WebGLRenderer({alpha:t,canvas:e,context:i,forceWebVR:!0});return r.outputEncoding=tE.sRGBEncoding,r.physicallyCorrectLights=!0,n&&r.setPixelRatio(window.devicePixelRatio),r}const aE=new tE.Euler(-30*tE.MathUtils.DEG2RAD,30*tE.MathUtils.DEG2RAD,0);function lE(e,t,n,i){void 0===i&&(i=1);const r=Math.max(t.max.y-n.y,n.y-t.min.y),o=tE.MathUtils.degToRad(e.fov/2);e.position.set(0,0,(r/Math.tan(o)+t.max.z)*i),e.position.applyEuler(aE),e.position.add(n),e.lookAt(n)}function cE(){return new tE.Color(gt("background3-color")||15395562)}class dE extends Yy.Component{constructor(e){var t;super(e),t=this,this.componentDidMount=()=>{this.scene=new tE.Scene,this.camera=new tE.PerspectiveCamera(55,this.canvas.clientWidth/this.canvas.clientHeight,.1,1e3),this.controls=new U_.z(this.camera,this.canvas),this.controls.screenSpacePanning=!0,this.controls.enableKeys=!0;const e=new tE.DirectionalLight(16250607,1);e.position.set(0,10,10),this.scene.add(e),this.scene.add(new tE.HemisphereLight(11658239,11658239,2.5)),this.loadId=0,this.camera.position.set(-.2,.5,.5),this.camera.matrixAutoUpdate=!0,this.controls.target.set(0,.45,0),this.controls.update(),this.props.avatarGltfUrl&&this.loadCurrentAvatarGltfUrl();const t=new tE.Clock;this.snapshotCanvas=document.createElement("canvas"),this.snapshotCanvas.width=720,this.snapshotCanvas.height=1280,this.snapshotCamera=new tE.PerspectiveCamera(55,.5625,.1,1e3),this.snapshotCamera.matrixAutoUpdate=!0,this.snapshotRenderer=sE(this.snapshotCanvas,!0,!1),this.snapshotRenderer.setClearAlpha(0),this.previewRenderer=sE(this.canvas),this.previewRenderer.setClearColor(cE()),this.previewRenderer.setAnimationLoop((()=>{const e=t.getDelta();this.mixer&&this.mixer.update(e),this.previewRenderer.render(this.scene,this.camera)})),this.removeThemeChangedListener=bt((()=>this.previewRenderer.setClearColor(cE()))),window.addEventListener("resize",this.resize),this.resize(),this.mounted=!0},this.resize=()=>{const e=this.canvas.parentElement.offsetWidth,t=this.canvas.parentElement.offsetHeight;this.previewRenderer.setSize(e,t),this.camera.aspect=e/t,this.camera.updateProjectionMatrix()},this.setAvatar=e=>{e&&(this.avatar=e,this.scene.add(e),this.resetCamera(),this.setState({error:null,loading:!1}))},this.resetCamera=(()=>{const e=new tE.Box3,t=new tE.Vector3;return()=>{e.setFromObject(this.avatar),e.getCenter(t),t.y=.6*(e.max.y-e.min.y)+e.min.y,lE(this.camera,e,t),lE(this.snapshotCamera,e,t,.7),this.controls.target.copy(t),this.controls.update()}})(),this.componentWillUnmount=()=>{this.mounted=!1,this.scene&&this.scene.traverse(Mo),this.previewRenderer&&this.previewRenderer.dispose(),this.snapshotRenderer&&this.snapshotRenderer.dispose(),this.controls&&(this.controls.dispose(),this.controls.domElement=null),Object.values(this.imageBitmaps).forEach((e=>J_(e))),window.removeEventListener("resize",this.resize),this.removeThemeChangedListener()},this.componentDidUpdate=function(){var e=iE((function*(e){e.avatarGltfUrl!==t.props.avatarGltfUrl&&(t.avatar&&(t.scene.remove(t.avatar),t.avatar=null),t.props.avatarGltfUrl&&(t.setState({error:null,loading:!0}),yield t.loadCurrentAvatarGltfUrl())),t.applyMaps(e,t.props)}));return function(t){return e.apply(this,arguments)}}(),this.loadPreviewAvatar=function(){var e=iE((function*(e){let n;try{n=yield Ta(e,"model/gltf",null,Ig)}catch(e){return console.error("Failed to load avatar preview",e),void t.setState({loading:!1,error:!0})}if(!t.mounted)return;if(t.previewMesh=Do(n.scene,(e=>e.isMesh&&e.material&&e.material.name===Lg||"Bot_Skinned"===e.name)),!t.previewMesh)return console.error("Failed to find avatar preview mesh"),void t.setState({loading:!1,error:!0});const i=n.animations&&n.animations.find((e=>{let{name:t}=e;return"idle_eyes"===t}));if(i){t.mixer=new tE.AnimationMixer(n.scene);const e=t.mixer.clipAction(i);e.enabled=!0,e.setLoop(tE.LoopRepeat,1/0).play(),t.idleAnimationAction=e}n.scene.traverse((e=>{if(e.isSkinnedMesh&&(e.frustumCulled=!1),e.material){const t=t=>e.material[t]&&delete e.material[t].onUpdate;rE.base_map.forEach(t),rE.emissive_map.forEach(t),rE.normal_map.forEach(t),rE.orm_map.forEach(t)}}));const{material:r}=t.previewMesh;if(r){const e=e=>r[e]&&r[e].image;t.originalMaps={base_map:rE.base_map.map(e),emissive_map:rE.emissive_map.map(e),normal_map:rE.normal_map.map(e),orm_map:rE.orm_map.map(e)};const n=[t.applyMaps({},t.props)];"high"===window.APP.store.state.preferences.materialQualitySetting&&n.push(function(){return X_.apply(this,arguments)}().then((e=>{t.previewMesh.material.envMap=e,t.previewMesh.material.needsUpdate=!0}))),yield Promise.all(n)}else t.originalMaps={};return n}));return function(t){return e.apply(this,arguments)}}(),this.applyMapToPreview=(e,t)=>{this.imageBitmaps[e]&&J_(this.imageBitmaps[e]),this.imageBitmaps[e]=t,rE[e].forEach((e=>{const n=this.previewMesh.material[e];"normalMap"===e&&"low"===window.APP.store.state.preferences.materialQualitySetting||("roughnessMap"!==e&&"metalnessMap"!==e||"high"===window.APP.store.state.preferences.materialQualitySetting)&&(n.image=t,n.needsUpdate=!0)}))},this.revertMap=e=>{this.imageBitmaps[e]&&J_(this.imageBitmaps[e]),delete this.imageBitmaps[e],this.originalMaps[e].forEach(((t,n)=>{const i=this.previewMesh.material[rE[e][n]];i&&(i.image=t,i.needsUpdate=!0)}))},this.snapshot=()=>new Promise((e=>{this.idleAnimationAction&&this.idleAnimationAction.stop(),this.snapshotCamera.position.copy(this.camera.position),this.snapshotCamera.rotation.copy(this.camera.rotation),this.snapshotRenderer.render(this.scene,this.snapshotCamera),this.snapshotCanvas.toBlob((t=>{this.idleAnimationAction&&this.idleAnimationAction.play(),e(t)}))})),this.state={loading:!0,error:null},this.avatar=null,this.imageBitmaps={},this.mounted=!1}loadCurrentAvatarGltfUrl(){var e=this;return iE((function*(){const t=++e.loadId,n=zs(e.props.avatarGltfUrl),i=yield e.loadPreviewAvatar(n);e.mounted&&t===e.loadId&&(i&&e.props.onGltfLoaded&&e.props.onGltfLoaded(i),e.setAvatar(i.scene))}))()}applyMaps(e,t){return Promise.all(oE.map((n=>{const i=this.applyMapToPreview.bind(this,n);if(e[n]!=t[n])return t[n]instanceof File?$_(t[n]).then(i):t[n]?(r=t[n],fetch(r).then((e=>e.blob())).then($_)).then(i):this.revertMap(n);var r})))}render(){return Yy.createElement("div",{className:lw()("avatar-preview__preview__Exp7B",this.props.className)},!this.props.avatarGltfUrl||this.state.loading&&!this.state.error&&Yy.createElement("div",{className:"loader"},Yy.createElement("div",{className:"loader-center"})),this.props.avatarGltfUrl&&this.state.error&&!this.state.loading&&Yy.createElement("div",{className:"error"},Yy.createElement("img",{src:th,srcSet:`${eE} 2x`,className:"error-icon"}),Yy.createElement(uw.Z,{id:"avatar-preview.loading-failed",defaultMessage:"Loading failed{linebreak}Please choose another avatar",values:{linebreak:Yy.createElement("br",null)}})),Yy.createElement("canvas",{ref:e=>this.canvas=e}))}}dE.propTypes={avatarGltfUrl:sw().string,className:sw().string,onGltfLoaded:sw().func};var uE=(0,V_.ZP)(dE,{forwardRef:!0});function hE(){return hE=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},hE.apply(this,arguments)}function pE(e,t,n,i,r,o,s){try{var a=e[o](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(i,r)}function mE(e){return function(){var t=this,n=arguments;return new Promise((function(i,r){var o=e.apply(t,n);function s(e){pE(o,i,r,s,a,"next",e)}function a(e){pE(o,i,r,s,a,"throw",e)}s(void 0)}))}}class fE extends Yy.Component{constructor(e){var t;super(e),t=this,this.state={avatarId:null,displayName:null,avatar:null},this.getStateFromProfile=()=>{const{displayName:e,avatarId:t}=this.props.store.state.profile;return{displayName:e,avatarId:t}},this.storeUpdated=()=>this.setState(this.getStateFromProfile()),this.saveStateAndFinish=e=>{e&&e.preventDefault();const{displayName:t}=this.props.store.state.profile,{hasChangedName:n}=this.props.store.state.activity,i=n||this.state.displayName!==t;this.props.store.update({activity:{hasChangedName:i,hasAcceptedProfile:!0},profile:{displayName:this.state.displayName,avatarId:this.state.avatarId}}),this.props.finished(),this.scene.emit("avatar_updated")},this.stopPropagation=e=>{e.stopPropagation()},this.setAvatarFromMediaResult=e=>{let{detail:{entry:t,selectAction:n}}=e;"avatar"!==t.type&&"avatar_listing"!==t.type||"use"!==n||(this.setState({avatarId:t.id}),function(e,t,n,i){Jy(e,!0,t,"profile",i)}(this.props.history,this.props.history.location.state.key,0,{avatarId:t.id}))},this.refetchAvatar=mE((function*(){const e=yield Og(t.state.avatarId);t.state.avatarId===e.avatar_id&&t.setState({avatar:e})})),this.state=this.getStateFromProfile(),e.avatarId&&(this.state.avatarId=e.avatarId),this.props.store.addEventListener("statechanged",this.storeUpdated),this.scene=document.querySelector("a-scene")}componentDidMount(){this.nameInput&&(this.nameInput.addEventListener("keydown",this.stopPropagation),this.nameInput.addEventListener("keypress",this.stopPropagation),this.nameInput.addEventListener("keyup",this.stopPropagation)),this.scene.addEventListener("action_selected_media_result_entry",this.setAvatarFromMediaResult),this.scene.addEventListener("action_avatar_saved",this.refetchAvatar),this.refetchAvatar()}componentDidUpdate(e,t){t.avatarId!==this.state.avatarId&&this.refetchAvatar()}componentWillUnmount(){this.props.store.removeEventListener("statechanged",this.storeUpdated),this.nameInput&&(this.nameInput.removeEventListener("keydown",this.stopPropagation),this.nameInput.removeEventListener("keypress",this.stopPropagation),this.nameInput.removeEventListener("keyup",this.stopPropagation)),this.scene.removeEventListener("action_selected_media_result_entry",this.setAvatarFromMediaResult),this.scene.removeEventListener("action_avatar_saved",this.refetchAvatar)}render(){const e={displayNameInputRef:e=>this.nameInput=e,disableDisplayNameInput:!!this.props.displayNameOverride,displayName:this.props.displayNameOverride?this.props.displayNameOverride:this.state.displayName,displayNamePattern:this.props.store.schema.definitions.profile.properties.displayName.pattern,onChangeDisplayName:e=>this.setState({displayName:e.target.value}),avatarPreview:Yy.createElement(uE,{avatarGltfUrl:this.state.avatar&&this.state.avatar.gltf_url}),onChangeAvatar:e=>{e.preventDefault(),this.props.mediaSearchStore.sourceNavigateWithNoNav("avatars","use")},onSubmit:this.saveStateAndFinish,onClose:this.props.onClose,onBack:this.props.onBack};return"sidebar"===this.props.containerType?Yy.createElement(L_,hE({},e,{showBackButton:this.props.showBackButton})):Yy.createElement(B_,e)}}fE.propTypes={containerType:sw().oneOf(["sidebar","modal"]),displayNameOverride:sw().string,store:sw().object,mediaSearchStore:sw().object,messages:sw().object,finished:sw().func,history:sw().object,avatarId:sw().string,onClose:sw().func,onBack:sw().func,showBackButton:sw().bool},fE.defaultProps={containerType:"modal"};var gE=n(50049);function vE(e,t,n,i,r,o,s){try{var a=e[o](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(i,r)}function bE(e){return function(){var t=this,n=arguments;return new Promise((function(i,r){var o=e.apply(t,n);function s(e){vE(o,i,r,s,a,"next",e)}function a(e){vE(o,i,r,s,a,"throw",e)}s(void 0)}))}}const yE={entries:[],meta:{}},wE={scenes:"scene_listings",images:"bing_images",videos:"bing_videos",youtube:"youtube_videos",gifs:"tenor",sketchfab:"sketchfab",twitch:"twitch",favorites:"favorites"},_E=["sketchfab","videos","scenes","avatars","gifs","images"].filter((e=>{const t=wE[e];return k.integration(t)})),EE={gifs:"trending",sketchfab:"featured",scenes:"featured",favorites:"my-favorites"},AE=["q","filter","cursor","similar_to"];class SE extends $.EventTarget{constructor(){var e;super(),e=this,this._update=function(){var t=bE((function*(t){e.result=null,e.dispatchEvent(new CustomEvent("statechanged"));const n=e.getUrlMediaSource(t);if(!n)return;e.previousSource&&e.previousSource===n||(e.dispatchEvent(new CustomEvent("sourcechanged")),e.previousSource=n);const i=new URLSearchParams(t.search);e.requestIndex++;const r=e.requestIndex,o=new URLSearchParams,s=new URLSearchParams(t.search),a=s.get("filter")&&s.get("filter").startsWith("my-");for(const e of AE)i.get(e)&&o.set(e,i.get(e));let l;if(o.get("locale",navigator.languages[0]),"avatars"===n||"scenes"===n){const e="avatars"===n?"avatar":"scene";l=a?`${e}s`:`${e}_listings`}else l=wE[n];o.set("source",l);let c=!0;"avatars"!==l&&"scenes"!==l&&"favorites"!==l||a&&(window.APP.store.credentialsAccountId?o.set("user",window.APP.store.credentialsAccountId):c=!1);const d=`/api/v1/media/search?${o.toString()}`,u=ge(d);if(e.lastSavedUrl===u)return;e.isFetching=!0,e.dispatchEvent(new CustomEvent("statechanged"));const h=c?yield Se(d):yE;e.requestIndex==r&&(e.result=h,e.nextCursor=e.result&&e.result.meta&&e.result.meta.next_cursor,e.lastFetchedUrl=u,e.isFetching=!1,e.dispatchEvent(new CustomEvent("statechanged")))}));return function(e){return t.apply(this,arguments)}}(),this.pageNavigate=e=>{if(-1===e)this.history.goBack();else{const e=this.history.location,t=new URLSearchParams(e.search);t.set("cursor",this.nextCursor),tw(this.history,e.pathname,t.toString())}},this.filterQueryNavigate=(e,t)=>{const n=this.history.location,i=new URLSearchParams(n.search);i.delete("similar_to"),i.delete("similar_name"),t?i.set("q",t):i.delete("q"),e?i.set("filter",e):i.delete("filter"),e?i.set("cursor",e):i.delete("cursor"),tw(this.history,n.pathname,i.toString())},this.getSearchClearedSearchParams=(e,t,n,i)=>{const r=new URLSearchParams(e.search);return r.delete("q"),r.delete("filter"),r.delete("cursor"),r.delete("similar_to"),r.delete("similar_name"),n||r.delete("media_nav"),t||r.delete("media_source"),i||r.delete("selectAction"),r},this._stashLastSearchParams=e=>{const t=new URLSearchParams(e.search);this._stashedParams={},this._stashedSource=null;const n=this.getUrlMediaSource(e);if("favorites"!==n){this._stashedSource=n;for(const e of AE){const n=t.get(e);n&&(this._stashedParams[e]=n)}}},this.clearStashedQuery=()=>{this._stashedParams&&delete this._stashedParams.q},this.sourceNavigate=e=>{this._sourceNavigate(e,!1,!0)},this.sourceNavigateToDefaultSource=()=>{this._sourceNavigate(this._stashedSource?this._stashedSource:_E[0],!1,!0)},this.sourceNavigateWithNoNav=(e,t)=>{this._sourceNavigate(e,!0,!1,t)},this._sourceNavigate=function(){var t=bE((function*(t,n,i,r){const o=new URLSearchParams(e.history.location.search).get("q"),s=e.getSearchClearedSearchParams(e.history.location);if(o)s.set("q",o);else if(i&&e._stashedParams)for(const n of AE){const i=e._stashedParams[n],r="q"===n||e._stashedSource===t;i&&r&&s.set(n,i)}else if("avatars"===t){const t=yield e._hasAccountWithAvatars();s.set("filter",t?"my-avatars":"featured")}else EE[t]&&s.set("filter",EE[t]);e._stashedParams=null,e._stashedSource=null,n&&s.set("media_nav","false"),r&&s.set("selectAction",r),ce()&&document.location.host!==k.RETICULUM_SERVER?(s.set("media_source",t),tw(e.history,e.history.location.pathname,s.toString())):tw(e.history,rw(e.history.location,`/media/${t}`),s.toString())}));return function(e,n,i,r){return t.apply(this,arguments)}}(),this._hasAccountWithAvatars=bE((function*(){const{credentialsAccountId:e}=window.APP.store;if(!e)return!1;const t=new URLSearchParams;t.set("source","avatars"),t.set("user",e);const n=yield Se(`/api/v1/media/search?${t.toString()}`);return!(!n||!n.entries)&&n.entries.length>0})),this.getUrlMediaSource=e=>{const{search:t}=e,n=new URLSearchParams(t),i=iw(e);return i.startsWith("/media")||n.get("media_source")?n.get("media_source")||i.substring(7):null},this.pushExitMediaBrowserHistory=function(t,n){void 0===n&&(n=!0),t||(t=e.history),n&&e._stashLastSearchParams(t.location);const{pathname:i}=t.location;tw(t,iw(t.location).startsWith("/media")?rw(t.location,"/"):i,e.getSearchClearedSearchParams(t.location).toString()),e.dispatchEvent(new CustomEvent("media-exit"))},this.requestIndex=0}setHistory(e){this.history=e,this._update(this.history.location),this.history.listen((e=>{this._update(e)}))}}var xE=n(42283);function ME(e){let{onSubmit:t,onClose:n}=e;const{handleSubmit:i,register:r}=(0,xE.cI)();return Yy.createElement(N_,{title:"Custom Avatar URL",beforeTitle:Yy.createElement(Ww,{onClick:n})},Yy.createElement(O_,{as:"form",padding:!0,center:!0,onSubmit:i(t)},Yy.createElement(M_,{name:"url",label:Yy.createElement(uw.Z,{id:"avatar-url-modal.avatar-url-label",defaultMessage:"Avatar GLB URL"}),placeholder:"https://example.com/avatar.glb",type:"url",required:!0,ref:r,description:Yy.createElement("a",{href:"https://hubs.mozilla.com/docs/intro-avatars.html",target:"_blank",rel:"noopener noreferrer"},Yy.createElement(uw.Z,{id:"avatar-url-modal.custom-avatar-docs-link",defaultMessage:"Learn more about custom avatars"}))}),Yy.createElement(s_,{type:"submit"})))}function PE(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function CE(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?PE(Object(n),!0).forEach((function(t){kE(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):PE(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function kE(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function OE(e){let{store:t,scene:n,onClose:i}=e;const r=(0,Yy.useCallback)((e=>{let{url:r}=e;t.update({profile:CE(CE({},t.state.profile),{avatarId:r})}),n.emit("avatar_updated"),i()}),[t,n,i]);return Yy.createElement(ME,{onSubmit:r,onClose:i})}function TE(e){let{enableSpoke:t,editorName:n,onValidateUrl:i,onSubmit:r,onClose:o}=e;const{isSubmitting:s,handleSubmit:a,register:l,errors:c}=(0,xE.cI)();return Yy.createElement(N_,{title:Yy.createElement(uw.Z,{id:"scene-url-modal.title",defaultMessage:"Custom Scene URL"}),beforeTitle:Yy.createElement(Ww,{onClick:o})},Yy.createElement(O_,{as:"form",padding:!0,center:!0,onSubmit:a(r)},Yy.createElement("p",null,t?Yy.createElement(uw.Z,{id:"scene-url-modal.message-with-spoke",defaultMessage:"Paste a URL to a {editorName} scene or a URL to a <glblink>GLB</glblink>.",values:{editorName:Yy.createElement("a",{href:"/spoke",target:"_blank",rel:"noopener noreferrer"},n),glblink:e=>Yy.createElement("a",{href:"https://en.wikipedia.org/wiki/GlTF#GLB",target:"_blank",rel:"noopener noreferrer"},e)}}):Yy.createElement(uw.Z,{id:"scene-url-modal.message",defaultMessage:"Paste a URL to a scene or a URL to a <glblink>GLB</glblink>.",values:{glblink:e=>Yy.createElement("a",{href:"https://en.wikipedia.org/wiki/GlTF#GLB",target:"_blank",rel:"noopener noreferrer"},e)}})),Yy.createElement(M_,{name:"url",label:Yy.createElement(uw.Z,{id:"scene-url-modal.url-input",defaultMessage:"Scene URL"}),placeholder:"https://example.com/scene.glb",type:"url",required:!0,ref:l({validate:i}),error:c.url&&c.url.message}),Yy.createElement(t_,{type:"submit",preset:"accept",disabled:s},Yy.createElement(uw.Z,{id:"scene-url-modal.change-scene-button",defaultMessage:"Change Scene"})),t&&Yy.createElement(Yy.Fragment,null,Yy.createElement("p",null,Yy.createElement(uw.Z,{id:"scene-url-modal.create-in-spoke",defaultMessage:"Or, create a new scene using {editorName}.",values:{editorName:n}})),Yy.createElement(t_,{as:"a",preset:"primary",href:"/spoke/new",target:"_blank",rel:"noopener noreferrer"},Yy.createElement(uw.Z,{id:"scene-url-modal.new-spoke-project-button",defaultMessage:"Launch {editorName}",values:{editorName:n}})))))}function RE(e,t,n,i,r,o,s){try{var a=e[o](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(i,r)}function DE(e){return function(){var t=this,n=arguments;return new Promise((function(i,r){var o=e.apply(t,n);function s(e){RE(o,i,r,s,a,"next",e)}function a(e){RE(o,i,r,s,a,"throw",e)}s(void 0)}))}}function jE(){return jE=DE((function*(e){return fetch(e).then(function(){var e=DE((function*(e){const t=e.body.getReader();let n="";return yield t.read().then((function e(i){let{done:r,value:o}=i;if(n+=String.fromCharCode.apply(null,o.slice(0,4)),!r&&n.length<4)return t.read().then(e);t.cancel()})),n.startsWith("glTF")}));return function(t){return e.apply(this,arguments)}}())})),jE.apply(this,arguments)}function LE(e){return IE.apply(this,arguments)}function IE(){return IE=DE((function*(e){return""!==e.trim()&&!!e.startsWith("http")&&(!!(yield na(e))||function(e){return jE.apply(this,arguments)}(zs(e)))})),IE.apply(this,arguments)}ME.propTypes={onSubmit:sw().func,onClose:sw().func},OE.propTypes={store:sw().object.isRequired,scene:sw().object.isRequired,onClose:sw().func},TE.propTypes={enableSpoke:sw().bool,editorName:sw().string,onSubmit:sw().func,onClose:sw().func,onValidateUrl:sw().isRequired};var NE,FE=n(86896);function BE(e,t,n,i,r,o,s){try{var a=e[o](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(i,r)}function VE(e){let{hubChannel:t,onClose:n}=e;const i=(0,FE.Z)(),r=(0,Yy.useCallback)(function(){var e,t=(e=function*(e){return(yield LE(e.trim()))||i.formatMessage("scene-url-modal.invalid-scene-url")},function(){var t=this,n=arguments;return new Promise((function(i,r){var o=e.apply(t,n);function s(e){BE(o,i,r,s,a,"next",e)}function a(e){BE(o,i,r,s,a,"throw",e)}s(void 0)}))});return function(e){return t.apply(this,arguments)}}(),[i]),o=(0,Yy.useCallback)((e=>{let{url:i}=e;t.updateScene(i),n()}),[t,n]);return Yy.createElement(TE,{enableSpoke:k.feature("enable_spoke"),editorName:k.translation("editor-name"),onValidateUrl:r,onSubmit:o,onClose:n})}function UE(){return UE=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},UE.apply(this,arguments)}VE.propTypes={hubChannel:sw().object.isRequired,onClose:sw().func};const HE=e=>{let{title:t,titleId:n,...i}=e;return Yy.createElement("svg",UE({width:20,height:20,viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":n},i),t?Yy.createElement("title",{id:n},t):null,NE||(NE=Yy.createElement("path",{d:"M8.44 7.5v5.62a1.565 1.565 0 0 0 3.131 0l.005-7.366A2.656 2.656 0 0 0 7.9 3.274a2.654 2.654 0 0 0-1.631 2.48v7.415a3.73 3.73 0 1 0 7.46 0V6.24",stroke:"currentColor",strokeWidth:1.5,strokeMiterlimit:10,strokeLinecap:"round"})))};var zE={hidden:"ObjectUrlModal__hidden__Y3SS9","url-input":"ObjectUrlModal__url-input__uq6pp",urlInput:"ObjectUrlModal__url-input__uq6pp"};function WE(e){let{showModelCollectionLink:t,modelCollectionUrl:n,onSubmit:i,onClose:r}=e;const{handleSubmit:o,register:s,watch:a,setValue:l}=(0,xE.cI)();(0,Yy.useEffect)((()=>{s("url")}),[s]);const c=a("file"),d=c&&c.length>0,u=d?c[0].name:void 0,h=(0,Yy.useCallback)((()=>{d?l("file",void 0):l("url","")}),[d,l]),p=(0,Yy.useCallback)((e=>{d||l("url",e.target.value)}),[d,l]),m=a("url",""),f=d||m.length>0;return Yy.createElement(N_,{title:Yy.createElement(uw.Z,{id:"object-url-modal.title",defaultMessage:"Custom Object"}),beforeTitle:Yy.createElement(Ww,{onClick:r})},Yy.createElement(O_,{as:"form",padding:!0,center:!0,onSubmit:o(i)},Yy.createElement("p",null,t?Yy.createElement(uw.Z,{id:"object-url-modal.message-with-collection",defaultMessage:"Upload or paste a URL to an image, video, model, or scene. Models can be found on <sketchfablink>Sketchfab</sketchfablink> or our <collectionlink>collection</collectionlink>.",values:{sketchfablink:e=>Yy.createElement("a",{href:"https://sketchfab.com/search?features=downloadable&type=models",target:"_blank",rel:"noopener noreferrer"},e),collectionlink:e=>Yy.createElement("a",{href:n,target:"_blank",rel:"noopener noreferrer"},e)}}):Yy.createElement(uw.Z,{id:"object-url-modal.message",defaultMessage:"Upload or paste a URL to an image, video, model, or scene. Models can be found on <sketchfablink>Sketchfab</sketchfablink>.",values:{sketchfablink:e=>Yy.createElement("a",{href:"https://sketchfab.com/search?features=downloadable&type=models",target:"_blank",rel:"noopener noreferrer"},e)}})),Yy.createElement(M_,{name:"url",label:Yy.createElement(uw.Z,{id:"object-url-modal.url-field-label",defaultMessage:"Object URL or File"}),placeholder:"https://example.com/avatar.glb",type:d?"text":"url",value:u||m||"",onChange:p,afterInput:Yy.createElement(Yy.Fragment,null,f&&Yy.createElement(Ww,{onClick:h}),Yy.createElement(Iw,{as:"label",className:lw()({[zE.hidden]:f},zE.urlInput),htmlFor:"file"},Yy.createElement(HE,null),Yy.createElement("input",{id:"file",className:zE.hidden,name:"file",type:"file",ref:s}))),description:Yy.createElement(uw.Z,{id:"object-url-modal.url-field-description",defaultMessage:"Accepts glb, png, jpg, gif, mp4, and mp3 files"})}),Yy.createElement(t_,{type:"submit",preset:"accept"},Yy.createElement(uw.Z,{id:"object-url-modal.create-object-button",defaultMessage:"Create Object"}))))}WE.propTypes={isMobile:sw().bool,showModelCollectionLink:sw().bool,modelCollectionUrl:sw().string,onSubmit:sw().func,onClose:sw().func};var qE=n.p+"assets/models/DuckyMesh-b80f0ece1f58a683839a..glb";const ZE=AFRAME.utils.device.isMobile()||AFRAME.utils.device.isMobileVR();function GE(e){let{scene:t,onClose:n}=e;const i=(0,Yy.useCallback)((e=>{let{file:i,url:r}=e;t.emit("add_media",i&&i.length>0&&i[0]||r||qE),n()}),[t,n]);return Yy.createElement(WE,{isMobile:ZE,showModelCollectionLink:k.feature("show_model_collection_link"),modelCollectionUrl:k.link("model_collection","https://sketchfab.com/mozillareality"),onSubmit:i,onClose:n})}GE.propTypes={scene:sw().object.isRequired,onClose:sw().func};var YE,QE,XE="MediaBrowser__button-nav__CWlpf",KE="MediaBrowser__pager-button__LZzwc";function $E(){return $E=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},$E.apply(this,arguments)}const JE=e=>{let{title:t,titleId:n,...i}=e;return Yy.createElement("svg",$E({width:20,height:20,viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":n},i),t?Yy.createElement("title",{id:n},t):null,YE||(YE=Yy.createElement("path",{d:"M8.636 2.5a6.136 6.136 0 1 0 0 12.273 6.136 6.136 0 0 0 0-12.272Z",stroke:"currentColor",strokeWidth:1.5,strokeMiterlimit:10})),QE||(QE=Yy.createElement("path",{d:"M13.214 13.214 17.5 17.5",stroke:"currentColor",strokeWidth:1.5,strokeMiterlimit:10,strokeLinecap:"round"})))};var eA;function tA(){return tA=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},tA.apply(this,arguments)}const nA=e=>{let{title:t,titleId:n,...i}=e;return Yy.createElement("svg",tA({width:20,height:20,viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":n},i),t?Yy.createElement("title",{id:n},t):null,eA||(eA=Yy.createElement("path",{d:"M15.39 18.75a.625.625 0 0 1-.366-.118L10 14.99l-5.024 3.642a.625.625 0 0 1-.959-.706l1.96-5.803L.899 8.64A.625.625 0 0 1 1.25 7.5h6.265l1.89-5.819a.625.625 0 0 1 1.19 0l1.89 5.82h6.265a.624.624 0 0 1 .354 1.141l-5.08 3.48 1.958 5.802a.624.624 0 0 1-.591.826Z",fill:"currentColor"})))};var iA,rA;function oA(){return oA=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},oA.apply(this,arguments)}const sA=e=>{let{title:t,titleId:n,...i}=e;return Yy.createElement("svg",oA({width:20,height:20,viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":n},i),t?Yy.createElement("title",{id:n},t):null,iA||(iA=Yy.createElement("path",{d:"M10.469 4.375 16.094 10l-5.625 5.625",stroke:"currentColor",strokeWidth:2.25,strokeLinecap:"round",strokeLinejoin:"round"})),rA||(rA=Yy.createElement("path",{d:"M15.313 10H3.905",stroke:"currentColor",strokeWidth:2.25,strokeLinecap:"round",strokeLinejoin:"round"})))};var aA,lA;function cA(){return cA=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},cA.apply(this,arguments)}const dA=e=>{let{title:t,titleId:n,...i}=e;return Yy.createElement("svg",cA({width:20,height:20,viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":n},i),t?Yy.createElement("title",{id:n},t):null,aA||(aA=Yy.createElement("path",{d:"M9.531 15.625 3.906 10l5.625-5.625",stroke:"currentColor",strokeWidth:2.25,strokeLinecap:"round",strokeLinejoin:"round"})),lA||(lA=Yy.createElement("path",{d:"M4.688 10h11.406",stroke:"currentColor",strokeWidth:2.25,strokeLinecap:"round",strokeLinejoin:"round"})))};var uA={"fullscreen-layout":"FullscreenLayout__fullscreen-layout___gfL2",fullscreenLayout:"FullscreenLayout__fullscreen-layout___gfL2",header:"FullscreenLayout__header__Xwco1","header-left":"FullscreenLayout__header-left__plGaP",headerLeft:"FullscreenLayout__header-left__plGaP","header-center":"FullscreenLayout__header-center__LLG8s",headerCenter:"FullscreenLayout__header-center__LLG8s","header-right":"FullscreenLayout__header-right__xewse",headerRight:"FullscreenLayout__header-right__xewse",content:"FullscreenLayout__content__sEnvy"};function hA(e){let{className:t,headerLeft:n,headerCenter:i,headerRight:r,contentClassName:o,children:s}=e;return Yy.createElement("div",{className:lw()(uA.fullscreenLayout,t)},Yy.createElement("div",{className:uA.header},Yy.createElement("div",{className:uA.headerLeft},n),Yy.createElement("div",{className:uA.headerCenter},i),Yy.createElement("div",{className:uA.headerRight},r)),Yy.createElement("div",{className:lw()(uA.content,o)},s))}hA.propTypes={className:sw().string,headerLeft:sw().node,headerCenter:sw().node,headerRight:sw().node,contentClassName:sw().string,children:sw().node};var pA={"media-grid":"MediaGrid__media-grid__CTSyf",mediaGrid:"MediaGrid__media-grid__CTSyf",sm:"MediaGrid__sm__UglLx",center:"MediaGrid__center__sJRuA","variable-width":"MediaGrid__variable-width__IrH79",variableWidth:"MediaGrid__variable-width__IrH79"};const mA=["children","className","center","isVariableWidth","sm"];function fA(){return fA=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},fA.apply(this,arguments)}function gA(e){let{children:t,className:n,center:i,isVariableWidth:r,sm:o}=e,s=function(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}(e,mA);return Yy.createElement("div",fA({className:lw()(pA.mediaGrid,{[pA.center]:i,[pA.variableWidth]:r,[pA.sm]:o},n)},s),t)}gA.propTypes={center:sw().bool,isVariableWidth:sw().bool,sm:sw().bool,className:sw().string,children:sw().node};const vA=(0,gE.vU)({youtube:{id:"media-browser.nav_title.youtube",defaultMessage:"YouTube"},videos:{id:"media-browser.nav_title.videos",defaultMessage:"Videos"},images:{id:"media-browser.nav_title.images",defaultMessage:"Images"},gifs:{id:"media-browser.nav_title.gifs",defaultMessage:"GIFs"},scenes:{id:"media-browser.nav_title.scenes",defaultMessage:"Scenes"},avatars:{id:"media-browser.nav_title.avatars",defaultMessage:"Avatars"},sketchfab:{id:"media-browser.nav_title.sketchfab",defaultMessage:"Sketchfab"},twitch:{id:"media-browser.nav_title.twitch",defaultMessage:"Twitch"}});function bA(e){let{onClose:t,browserRef:n,searchInputRef:i,autoFocusSearch:r,searchPlaceholder:o,searchDescription:s,onSearchKeyDown:a,onClearSearch:l,mediaSources:c,selectedSource:d,onSelectSource:u,activeFilter:h,facets:p,onSelectFacet:m,query:f,onChangeQuery:g,headerRight:v,hasNext:b,hasPrevious:y,onNextPage:w,onPreviousPage:_,noResultsMessage:E,children:A}=e;const S=(0,FE.Z)();return Yy.createElement(hA,{headerLeft:Yy.createElement(Iw,{onClick:t},Yy.createElement(Vw,null)),headerCenter:Yy.createElement(Yy.Fragment,null,"favorites"===d?Yy.createElement(Yy.Fragment,null,Yy.createElement(nA,{className:"MediaBrowser__favorite-icon__eqtGN"}),Yy.createElement("h3",null,Yy.createElement(uw.Z,{id:"media-browser.favorites-header",defaultMessage:"Favorite Rooms"}))):Yy.createElement(M_,{value:f,onChange:g,autoFocus:r,ref:i,placeholder:o,onKeyDown:a,beforeInput:Yy.createElement(JE,{className:"MediaBrowser__search-icon__Gdgj7"}),afterInput:Yy.createElement(Iw,{onClick:l},Yy.createElement(Vw,{height:16,width:16})),description:s})),headerRight:v},c&&Yy.createElement("div",{className:XE},c.map((e=>Yy.createElement(t_,{sm:!0,key:e,preset:d===e?"primary":"transparent",onClick:()=>u(e)},S.formatMessage(vA[e]))))),p&&Yy.createElement("div",{className:lw()(XE,"MediaBrowser__facets-nav__RUwKx")},p.map(((e,t)=>Yy.createElement(t_,{sm:!0,key:t,preset:h===e.params.filter?"primary":"transparent",onClick:()=>m(e)},e.text)))),Yy.createElement("div",{className:"MediaBrowser__content__TrMq2"},Yy.createElement(O_,{grow:!0,ref:n},A?Yy.createElement(gA,{isVariableWidth:"gifs"===d||"images"===d,sm:"avatars"===d},A):Yy.createElement("div",{className:"MediaBrowser__no-results__wzxlX"},E),(b||y)&&Yy.createElement("div",{className:"MediaBrowser__pager__Dknao"},Yy.createElement("button",{type:"button",className:KE,disabled:!y,onClick:_},Yy.createElement(dA,null)),Yy.createElement("button",{type:"button",className:KE,disabled:!b,onClick:w},Yy.createElement(sA,null))))))}var yA,wA;function _A(){return _A=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},_A.apply(this,arguments)}bA.propTypes={onClose:sw().func,browserRef:sw().any,searchInputRef:sw().any,autoFocusSearch:sw().bool,searchPlaceholder:sw().string,searchDescription:sw().node,onSearchKeyDown:sw().func,onClearSearch:sw().func,mediaSources:sw().array,selectedSource:sw().string,onSelectSource:sw().func,activeFilter:sw().string,facets:sw().array,onSelectFacet:sw().func,query:sw().string,onChangeQuery:sw().func,headerRight:sw().node,hasNext:sw().bool,hasPrevious:sw().bool,onNextPage:sw().func,onPreviousPage:sw().func,noResultsMessage:sw().node,children:sw().node},bA.defaultProps={noResultsMessage:"No Results"};const EA=e=>{let{title:t,titleId:n,...i}=e;return Yy.createElement("svg",_A({width:20,height:20,viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":n},i),t?Yy.createElement("title",{id:n},t):null,yA||(yA=Yy.createElement("g",{clipPath:"url(#a)",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"},Yy.createElement("path",{d:"M12.5 14.367h2.969c2.148 0 3.906-1.14 3.906-3.265s-2.07-3.183-3.75-3.266C15.278 4.514 12.852 2.492 10 2.492c-2.695 0-4.431 1.79-5 3.563C2.656 6.278.625 7.769.625 10.21c0 2.442 2.11 4.156 4.688 4.156H7.5"}),Yy.createElement("path",{d:"m12.5 9.992-2.5-2.5-2.5 2.5"}),Yy.createElement("path",{d:"M10 17.509V8.117"}))),wA||(wA=Yy.createElement("defs",null,Yy.createElement("clipPath",{id:"a"},Yy.createElement("rect",{width:20,height:20,fill:"#fff"})))))};var AA;function SA(){return SA=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},SA.apply(this,arguments)}const xA=e=>{let{title:t,titleId:n,...i}=e;return Yy.createElement("svg",SA({width:20,height:20,viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":n},i),t?Yy.createElement("title",{id:n},t):null,AA||(AA=Yy.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M4.851 11.038a2.906 2.906 0 1 0 4.11 4.11l1.768-1.768a.844.844 0 0 1 1.194 1.193l-1.768 1.768a4.594 4.594 0 1 1-6.497-6.496l1.768-1.768A.844.844 0 0 1 6.619 9.27l-1.768 1.768Zm3.227-4.42a.844.844 0 0 1 0-1.193l1.767-1.767a4.594 4.594 0 0 1 6.497 6.496l-1.768 1.768a.844.844 0 1 1-1.193-1.193l1.768-1.768a2.906 2.906 0 0 0-4.11-4.11L9.27 6.619a.844.844 0 0 1-1.193 0Zm-1.236 5.345a.844.844 0 0 0 1.194 1.193l5.176-5.176a.844.844 0 0 0-1.193-1.194l-5.177 5.177Z",fill:"currentColor"})))};var MA,PA,CA,kA,OA=n(48272),TA={"media-tile":"MediaTiles__media-tile__E0HUl",mediaTile:"MediaTiles__media-tile__E0HUl","thumbnail-container":"MediaTiles__thumbnail-container__MKVU6",thumbnailContainer:"MediaTiles__thumbnail-container__MKVU6","create-tile-content":"MediaTiles__create-tile-content__M88Bh",createTileContent:"MediaTiles__create-tile-content__M88Bh",tall:"MediaTiles__tall__yGWZ7",wide:"MediaTiles__wide__dHsYw","thumbnail-link":"MediaTiles__thumbnail-link__gdkAW",thumbnailLink:"MediaTiles__thumbnail-link__gdkAW","tile-actions":"MediaTiles__tile-actions__7omsl",tileActions:"MediaTiles__tile-actions__7omsl","tile-action":"MediaTiles__tile-action__Ja6k2",tileAction:"MediaTiles__tile-action__Ja6k2","member-count":"MediaTiles__member-count__vcGmo",memberCount:"MediaTiles__member-count__vcGmo","favorite-icon":"MediaTiles__favorite-icon__D2eKH",favoriteIcon:"MediaTiles__favorite-icon__D2eKH",info:"MediaTiles__info__A_JN6",description:"MediaTiles__description____teU","create-tile":"MediaTiles__create-tile__wPgMb",createTile:"MediaTiles__create-tile__wPgMb"};function RA(){return RA=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},RA.apply(this,arguments)}const DA=e=>{let{title:t,titleId:n,...i}=e;return Yy.createElement("svg",RA({width:20,height:20,viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":n},i),t?Yy.createElement("title",{id:n},t):null,MA||(MA=Yy.createElement("path",{d:"M15.703 6.563c-.114 1.588-1.293 2.812-2.578 2.812s-2.466-1.223-2.578-2.812c-.117-1.653 1.03-2.813 2.578-2.813 1.548 0 2.695 1.19 2.578 2.813Z",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})),PA||(PA=Yy.createElement("path",{d:"M13.125 11.875c-2.546 0-4.994 1.264-5.607 3.727-.081.326.123.648.458.648h10.299c.335 0 .538-.322.458-.648-.614-2.502-3.062-3.727-5.608-3.727Z",stroke:"currentColor",strokeWidth:1.5,strokeMiterlimit:10})),CA||(CA=Yy.createElement("path",{d:"M7.812 7.264C7.721 8.532 6.77 9.53 5.742 9.53c-1.026 0-1.98-.998-2.07-2.267C3.578 5.944 4.505 5 5.742 5c1.237 0 2.164.968 2.07 2.264Z",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})),kA||(kA=Yy.createElement("path",{d:"M8.047 11.954c-.705-.324-1.482-.448-2.305-.448-2.031 0-3.988 1.01-4.478 2.977-.065.26.098.517.366.517h4.386",stroke:"currentColor",strokeWidth:1.5,strokeMiterlimit:10,strokeLinecap:"round"})))};var jA,LA;function IA(){return IA=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},IA.apply(this,arguments)}const NA=e=>{let{title:t,titleId:n,...i}=e;return Yy.createElement("svg",IA({width:20,height:20,viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":n},i),t?Yy.createElement("title",{id:n},t):null,jA||(jA=Yy.createElement("path",{d:"M10 4.375v11.25",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})),LA||(LA=Yy.createElement("path",{d:"M15.625 10H4.375",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})))};var FA,BA;function VA(){return VA=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},VA.apply(this,arguments)}const UA=e=>{let{title:t,titleId:n,...i}=e;return Yy.createElement("svg",VA({width:20,height:20,viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":n},i),t?Yy.createElement("title",{id:n},t):null,FA||(FA=Yy.createElement("path",{d:"M4.024 18.125H1.875v-2.148L13.99 3.832 16.17 6.01 4.024 18.125Z",fill:"currentColor"})),BA||(BA=Yy.createElement("path",{d:"M16.63 5.547 14.453 3.37l1.237-1.197c.19-.193.484-.298.755-.298a1.011 1.011 0 0 1 .72.298l.664.664a1.01 1.01 0 0 1 .296.718c0 .273-.106.564-.298.756L16.63 5.547Z",fill:"currentColor"})))};var HA,zA,WA,qA;function ZA(){return ZA=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},ZA.apply(this,arguments)}const GA=e=>{let{title:t,titleId:n,...i}=e;return Yy.createElement("svg",ZA({width:20,height:20,viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":n},i),t?Yy.createElement("title",{id:n},t):null,HA||(HA=Yy.createElement("path",{d:"M15.898 5H7.227C5.997 5 5 5.996 5 7.226v8.672c0 1.23.997 2.227 2.227 2.227h8.671c1.23 0 2.227-.997 2.227-2.227V7.226c0-1.23-.997-2.226-2.227-2.226Z",stroke:"currentColor",strokeWidth:1.5,strokeLinejoin:"round"})),zA||(zA=Yy.createElement("path",{d:"m14.98 5 .02-.938a2.194 2.194 0 0 0-2.188-2.188H4.376a2.507 2.507 0 0 0-2.5 2.5v8.438a2.194 2.194 0 0 0 2.188 2.187H5",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})),WA||(WA=Yy.createElement("path",{d:"M11.563 8.437v6.25",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})),qA||(qA=Yy.createElement("path",{d:"M14.688 11.562h-6.25",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})))};var YA,QA,XA;function KA(){return KA=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},KA.apply(this,arguments)}const $A=e=>{let{title:t,titleId:n,...i}=e;return Yy.createElement("svg",KA({width:20,height:20,viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":n},i),t?Yy.createElement("title",{id:n},t):null,YA||(YA=Yy.createElement("path",{d:"M10 2a8 8 0 1 0 0 16 8 8 0 0 0 0-16Z",stroke:"currentColor",strokeMiterlimit:10})),QA||(QA=Yy.createElement("path",{d:"M7.454 7.56s.039-.796.89-1.48c.505-.407 1.11-.525 1.656-.533.497-.007.94.076 1.206.202.454.216 1.34.745 1.34 1.868 0 1.182-.773 1.718-1.654 2.309-.88.59-1.12 1.231-1.12 1.893",stroke:"currentColor",strokeMiterlimit:10,strokeLinecap:"round"})),XA||(XA=Yy.createElement("path",{d:"M9.855 14.844a.786.786 0 1 0 0-1.57.786.786 0 0 0 0 1.57Z",fill:"currentColor"})))};var JA,eS,tS;function nS(){return nS=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},nS.apply(this,arguments)}const iS=e=>{let{title:t,titleId:n,...i}=e;return Yy.createElement("svg",nS({width:20,height:20,viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":n},i),t?Yy.createElement("title",{id:n},t):null,JA||(JA=Yy.createElement("path",{d:"M15 8.749v7.188a1.563 1.563 0 0 1-1.563 1.562H4.063A1.563 1.563 0 0 1 2.5 15.937V6.562a1.562 1.562 0 0 1 1.563-1.563h6.542",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})),eS||(eS=Yy.createElement("path",{d:"M13.125 2.5H17.5v4.375",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})),tS||(tS=Yy.createElement("path",{d:"m8.75 11.248 8.438-8.437",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})))},rS=["as","className","name","description","tall","wide","children"],oS=["className","children"],sS=["label","type"],aS=["entry","processThumbnailUrl","onClick","onEdit","onShowSimilar","onCopy","onInfo"];function lS(){return lS=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},lS.apply(this,arguments)}function cS(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}const dS={sketchfab_model:"Sketchfab",twitch_stream:"Twitch"};function uS(e){let t,{as:n,className:i,name:r,description:o,tall:s,wide:a,children:l}=e,c=cS(e,rS);return"div"===n&&(t={tabIndex:"0",role:"button"}),Yy.createElement(n,lS({className:lw()(TA.mediaTile,{[TA.tall]:s,[TA.wide]:a},i)},t,c),Yy.createElement("div",{className:TA.thumbnailContainer},l),(r||o)&&Yy.createElement("div",{className:TA.info},Yy.createElement("b",null,r),o&&Yy.createElement("small",{className:TA.description},o)))}function hS(e){let{className:t,children:n}=e,i=cS(e,oS);return Yy.createElement("button",lS({type:"button",className:lw()(TA.tileAction,t)},i),n)}function pS(e){let{label:t,type:n}=e,i=cS(e,sS);return Yy.createElement(uS,lS({className:TA.createTile,wide:"scene"===n,tall:"avatar"===n},i),Yy.createElement("div",{className:TA.createTileContent},Yy.createElement(NA,{width:48,height:48}),Yy.createElement("p",null,t)))}function mS(e){let{entry:t,processThumbnailUrl:n,onClick:i,onEdit:r,onShowSimilar:o,onCopy:s,onInfo:a}=e,l=cS(e,aS);const c=(0,FE.Z)(),d=t.attributions&&t.attributions.creator,u=t.attributions&&t.attributions.publisher&&t.attributions.publisher.name||dS[t.type],[h,p,m]=function(e,t){const n=e.type.endsWith("_image"),i="avatar"===e.type||"avatar_listing"===e.type,r=e.images.preview.width/e.images.preview.height,[o,s]=function(e,t,n){return(0,Yy.useMemo)((()=>{let i,r=220;return t&&(r=Math.floor(1.5*r)),i=e?Math.floor(Math.max(n*r,.85*r)):t?Math.floor(9/16*r):Math.floor(Math.max(16/9*r,.85*r)),[i,r]}),[e,t,n])}(n,i,r);return[(0,Yy.useMemo)((()=>t?t(e,o,s):e.images.preview.url),[e,o,s,t]),o,s]}(t,n);return Yy.createElement(uS,lS({wide:"scene"===t.type||"scene_listing"===t.type||"room"===t.type,tall:"avatar"===t.type||"avatar_listing"===t.type,name:t.name,description:Yy.createElement(Yy.Fragment,null,d&&void 0===d.name&&Yy.createElement("span",null,d),d&&d.name&&!d.url&&Yy.createElement("span",null,d.name),d&&d.name&&d.url&&Yy.createElement("a",{href:d.url,target:"_blank",rel:"noopener noreferrer"},d.name),u&&Yy.createElement(Yy.Fragment,null,Yy.createElement("a",{href:t.url,target:"_blank",rel:"noopener noreferrer"},Yy.createElement(iS,null)," ",u)),t.last_activated_at&&Yy.createElement("small",null,Yy.createElement(uw.Z,{id:"media-tile.joined-room",defaultMessage:"Joined {relativeTime}",values:{relativeTime:Yy.createElement(OA.Z,{updateIntervalInSeconds:10,value:(new Date(t.last_activated_at).getTime()-Date.now())/1e3})}})))},l),Yy.createElement("a",{className:TA.thumbnailLink,href:t.url,rel:"noreferrer noopener",onClick:i},"mp4"===t.images.preview.type?Yy.createElement("video",{muted:!0,autoPlay:!0,playsInline:!0,loop:!0,src:h,alt:t.name,width:p,height:m}):Yy.createElement("img",{src:h,alt:t.name,width:p,height:m})),t.favorited&&Yy.createElement(nA,{className:TA.favoriteIcon}),void 0!==t.member_count&&Yy.createElement("div",{className:TA.memberCount},Yy.createElement(DA,null)," ",Yy.createElement("span",null,t.member_count)),Yy.createElement("div",{className:TA.tileActions},"avatar"===t.type&&Yy.createElement(hS,{title:c.formatMessage({id:"media-tile.action.edit-avatar",defaultMessage:"Edit avatar"}),onClick:r},Yy.createElement(UA,null)),"scene"===t.type&&t.project_id&&Yy.createElement(hS,{onClick:r,title:c.formatMessage({id:"media-tile.action.edit-scene",defaultMessage:"Edit scene"})},Yy.createElement(UA,null)),"avatar_listing"===t.type&&Yy.createElement(hS,{title:c.formatMessage({id:"media-tile.action.show-similar-avatars",defaultMessage:"Show similar avatars"}),onClick:o},Yy.createElement(JE,null)),"avatar_listing"===t.type&&t.allow_remixing&&Yy.createElement(hS,{title:c.formatMessage({id:"media-tile.action.copy-avatar",defaultMessage:"Copy to my avatars"}),onClick:s},Yy.createElement(GA,null)),"scene_listing"===t.type&&t.allow_remixing&&Yy.createElement(hS,{title:c.formatMessage({id:"media-tile.action.copy-scene",defaultMessage:"Copy to my scenes"}),onClick:s},Yy.createElement(GA,null)),"room"===t.type&&a&&t.description&&Yy.createElement(hS,{title:c.formatMessage({id:"media-tile.action.room-info",defaultMessage:"Room info"}),onClick:a},Yy.createElement($A,null))))}uS.propTypes={as:sw().elementType,className:sw().string,name:sw().string,description:sw().node,children:sw().node,tall:sw().bool,wide:sw().bool},uS.defaultProps={as:"div"},hS.propTypes={className:sw().string,children:sw().node},pS.propTypes={label:sw().node,type:sw().string},mS.propTypes={entry:sw().object.isRequired,processThumbnailUrl:sw().func,onClick:sw().func,onEdit:sw().func,onShowSimilar:sw().func,onCopy:sw().func,onInfo:sw().func};const fS=["className","children"],gS=["label","description","className","labelClassName"];function vS(){return vS=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},vS.apply(this,arguments)}function bS(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function yS(e){let{className:t,children:n}=e,i=bS(e,fS);return Yy.createElement("div",vS({className:lw()("RadioInput__radio-input__mNUNn",t)},i),n)}yS.propTypes={className:sw().string,children:sw().node};const wS=(0,Yy.forwardRef)(((e,t)=>{let{label:n,description:i,className:r,labelClassName:o}=e,s=bS(e,gS);return Yy.createElement("label",{className:lw()("RadioInput__option__MLMdX",r)},Yy.createElement("input",vS({className:"RadioInput__input__Ehhbt",type:"radio",ref:t},s)),Yy.createElement("div",{className:lw()("RadioInput__content__gNy40",o)},Yy.createElement("span",{className:"RadioInput__label__63PKv"},n),i&&Yy.createElement("span",{className:"RadioInput__description__NxZVE"},i)))}));wS.propTypes={className:sw().string,label:sw().node.isRequired,description:sw().node,labelClassName:sw().string};const _S=["className","error","description","inputClassName","label","children","fullWidth"];function ES(){return ES=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},ES.apply(this,arguments)}const AS=(0,Yy.memo)((e=>{let{className:t,error:n,description:i,inputClassName:r,label:o,children:s,fullWidth:a}=e,l=function(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}(e,_S);return Yy.createElement(d_,{className:t,label:o,error:n,description:i,fullWidth:a},Yy.createElement(yS,ES({className:r},l),s))}));AS.propTypes={className:sw().string,label:sw().node,error:sw().node,description:sw().node,labelClassName:sw().string,inputClassName:sw().string,children:sw().node,fullWidth:sw().bool};const SS=wS;var xS,MS={"select-input":"SelectInputField__select-input__Q9wMN",selectInput:"SelectInputField__select-input__Q9wMN","dropdown-button":"SelectInputField__dropdown-button__E2fNK",dropdownButton:"SelectInputField__dropdown-button__E2fNK",dropdown:"SelectInputField__dropdown__wN7x4",open:"SelectInputField__open__B7Ur0","dropdown-item":"SelectInputField__dropdown-item__lLzp4",dropdownItem:"SelectInputField__dropdown-item__lLzp4","highlighted-item":"SelectInputField__highlighted-item__BhcUo",highlightedItem:"SelectInputField__highlighted-item__BhcUo"};function PS(){return PS=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},PS.apply(this,arguments)}const CS=e=>{let{title:t,titleId:n,...i}=e;return Yy.createElement("svg",PS({width:20,height:20,viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":n},i),t?Yy.createElement("title",{id:n},t):null,xS||(xS=Yy.createElement("path",{d:"m3.828 7.424 5.46 6.372a.938.938 0 0 0 1.424 0l5.46-6.372a.938.938 0 0 0-.712-1.548H4.538c-.8 0-1.233.94-.71 1.548Z",fill:"currentColor"})))};var kS=n(80705);const OS=["className","error","description","inputClassName","buttonClassName","label","onChange","value","options","fullWidth"];function TS(){return TS=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},TS.apply(this,arguments)}function RS(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function DS(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?RS(Object(n),!0).forEach((function(t){jS(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):RS(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function jS(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function LS(e){return"object"==typeof e?e.value:e}function IS(e,t){const n=LS(e);return t.length>0&&"object"==typeof t[0]?t.find((e=>e.value===n)):n}function NS(e){return"object"==typeof e?e.label||e.value:e}function FS(e){let{className:t,error:n,description:i,inputClassName:r,buttonClassName:o,label:s,onChange:a,value:l,options:c,fullWidth:d}=e,u=function(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}(e,OS);const{isOpen:h,selectedItem:p,getToggleButtonProps:m,getMenuProps:f,getLabelProps:g,highlightedIndex:v,getItemProps:b}=(0,kS.L7)(DS(DS({items:c,selectedItem:IS(l,c)},u),{},{onSelectedItemChange:e=>{let{selectedItem:t}=e;a&&a(LS(t))}})),y=NS(p);return Yy.createElement(d_,TS({},g(),{className:t,label:s,error:n,description:i,fullWidth:d}),Yy.createElement("div",{className:lw()(MS.selectInput,{[MS.open]:h},r)},Yy.createElement("button",TS({className:lw()(MS.dropdownButton,o),type:"button"},m()),Yy.createElement("span",null,void 0!==y?y:Yy.createElement(uw.Z,{id:"select-input-field.placeholder",defaultMessage:"Select..."})),Yy.createElement(CS,null)),c.length>0&&Yy.createElement("ul",TS({},f(),{className:MS.dropdown}),h&&c.map(((e,t)=>Yy.createElement("li",TS({className:lw()(MS.dropdownItem,{[MS.highlightedItem]:v===t}),key:LS(e)},b({item:e,index:t})),NS(e)))))))}function BS(e){let{termsUrl:t,privacyUrl:n}=e;const i=(0,Yy.useCallback)((e=>Yy.createElement("a",{rel:"noopener noreferrer",target:"_blank",href:t},e)),[t]),r=(0,Yy.useCallback)((e=>Yy.createElement("a",{rel:"noopener noreferrer",target:"_blank",href:n},e)),[n]);return t&&n?Yy.createElement(uw.Z,{id:"legal-message.tos-and-privacy",defaultMessage:"By proceeding, you agree to the <toslink>terms of use</toslink> and <privacylink>privacy notice</privacylink>.",values:{toslink:i,privacylink:r}}):t&&!n?Yy.createElement(uw.Z,{id:"legal-message.tos",defaultMessage:"By proceeding, you agree to the <toslink>terms of use</toslink>.",values:{toslink:i}}):!t&&n?Yy.createElement(uw.Z,{id:"legal-message.privacy",defaultMessage:"By proceeding, you agree to the <privacylink>privacy notice</privacylink>.",values:{privacylink:r}}):null}FS.propTypes={className:sw().string,label:sw().node,error:sw().node,description:sw().node,labelClassName:sw().string,inputClassName:sw().string,buttonClassName:sw().string,value:sw().any,options:sw().arrayOf(sw().oneOfType([sw().string,sw().number,sw().shape({label:sw().string,value:sw().any.isRequired})])).isRequired,onChange:sw().func,fullWidth:sw().bool},FS.defaultProps={options:[]},BS.propTypes={termsUrl:sw().string,privacyUrl:sw().string};var VS={"button-group":"SignInModal__button-group__nEy7O",buttonGroup:"SignInModal__button-group__nEy7O"};const US=["closeable","onClose","children"];function HS(){return HS=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},HS.apply(this,arguments)}const zS="submit",WS="waitForVerification",qS="complete",ZS=(0,gE.vU)({pin:{id:"sign-in-modal.signin-message.pin",defaultMessage:"You'll need to sign in to pin objects."},unpin:{id:"sign-in-modal.signin-message.unpin",defaultMessage:"You'll need to sign in to un-pin objects."},changeScene:{id:"sign-in-modal.signin-message.change-scene",defaultMessage:"You'll need to sign in to change the scene."},roomSettings:{id:"sign-in-modal.signin-message.room-settings",defaultMessage:"You'll need to sign in to change the room's settings."},closeRoom:{id:"sign-in-modal.signin-message.close-room",defaultMessage:"You'll need to sign in to close the room."},muteUser:{id:"sign-in-modal.signin-message.mute-user",defaultMessage:"You'll need to sign in to mute other users."},kickUser:{id:"sign-in-modal.signin-message.kick-user",defaultMessage:"You'll need to sign in to kick other users."},addOwner:{id:"sign-in-modal.signin-message.add-owner",defaultMessage:"You'll need to sign in to assign moderators."},removeOwner:{id:"sign-in-modal.signin-message.remove-owner",defaultMessage:"You'll need to sign in to assign moderators."},createAvatar:{id:"sign-in-modal.signin-message.create-avatar",defaultMessage:"You'll need to sign in to create avatars."},remixAvatar:{id:"sign-in-modal.signin-message.remix-avatar",defaultMessage:"You'll need to sign in to remix avatars."},remixScene:{id:"sign-in-modal.signin-message.remix-scene",defaultMessage:"You'll need to sign in to remix scenes."},favoriteRoom:{id:"sign-in-modal.signin-message.favorite-room",defaultMessage:"You'll need to sign in to add this room to your favorites."},favoriteRooms:{id:"sign-in-modal.signin-message.favorite-rooms",defaultMessage:"You'll need to sign in to add favorite rooms."},tweet:{id:"sign-in-modal.signin-message.tweet",defaultMessage:"You'll need to sign in to send tweets."}});function GS(e){let{onBindMember:t,onBindSeller:n,onBindStore:i,onBindCancel:r,initialEmail:o,message:s,bindType:a,stores:l,privacyUrl:c,termsUrl:d}=e;(0,FE.Z)();const[u,h]=(0,Yy.useState)(o),[p,m]=(0,Yy.useState)(""),[f,g]=(0,Yy.useState)(a),[v,b]=(0,Yy.useState)([]),[y,w]=(0,Yy.useState)(""),_="1"===a&&l&&l.length>0,E=(0,Yy.useCallback)((e=>{e.preventDefault(),"0"===f?t(u,p):y?i(u,y):n(u,p)}),[t,n,i,u,p,f,y]),A=(0,Yy.useCallback)((e=>{h(e.target.value)}),[h]),S=(0,Yy.useCallback)((e=>{m(e.target.value)}),[m]),x=(0,Yy.useCallback)((e=>{w(e)}),[w]),M=(0,Yy.useCallback)((()=>{r(u,f)}),[r]);return(0,Yy.useEffect)((()=>{if(_){let e=[];l.map((t=>{e.push({value:t.id,label:t.name})})),b([...e])}}),[a,l]),Yy.createElement(O_,{center:!0,padding:!0,as:"form",onSubmit:E},_?v&&v.length>0&&Yy.createElement(FS,{options:v,onChange:x}):Yy.createElement(Yy.Fragment,null,Yy.createElement("p",null,"Please Bind your account As"),Yy.createElement(AS,null,Yy.createElement(wS,{name:"bind_type",value:"0",label:"Student",onChange:()=>g("0"),checked:"0"===f}),Yy.createElement(wS,{name:"bind_type",value:"1",label:"Teacher",onChange:()=>g("1"),checked:"1"===f})),Yy.createElement(M_,{name:"email",type:"email",required:!0,value:u,onChange:A,placeholder:"example@example.com"}),Yy.createElement(M_,{name:"password",type:"password",required:!0,value:p,onChange:S,placeholder:"your password"}),Yy.createElement("p",{style:{color:"red"}},s)),Yy.createElement("p",null,Yy.createElement("small",null,Yy.createElement(BS,{termsUrl:d,privacyUrl:c}))),Yy.createElement("div",{className:VS.buttonGroup},_&&Yy.createElement(i_,{preset:"cancel",onClick:M}),Yy.createElement(n_,{type:"submit"})))}function YS(e){let{onSubmitEmail:t,onCancel:n,initialEmail:i,bindType:r,privacyUrl:o,termsUrl:s,message:a}=e;const l=(0,FE.Z)(),[c,d]=(0,Yy.useState)(i),u=(0,Yy.useCallback)((e=>{e.preventDefault(),t(c)}),[t,c]),h=(0,Yy.useCallback)((e=>{d(e.target.value)}),[d]),p=(0,Yy.useCallback)((()=>{n(c,r)}),[n]);return Yy.createElement(O_,{center:!0,padding:!0,as:"form",onSubmit:u},Yy.createElement("p",null,a?l.formatMessage(a):Yy.createElement(uw.Z,{id:"sign-in-modal.prompt",defaultMessage:"Please Sign In"})),Yy.createElement(M_,{name:"email",type:"email",required:!0,value:c,onChange:h,placeholder:"example@example.com"}),Yy.createElement("p",null,Yy.createElement("small",null,Yy.createElement(BS,{termsUrl:s,privacyUrl:o}))),Yy.createElement("div",{className:VS.buttonGroup},Yy.createElement(i_,{preset:"cancel",onClick:p}),Yy.createElement(n_,{type:"submit"})))}function QS(e){let{email:t,onCancel:n,showNewsletterSignup:i}=e;return Yy.createElement(O_,{center:!0,padding:!0},Yy.createElement(uw.Z,{id:"sign-in-modal.wait-for-verification",defaultMessage:"<p>Email sent to {email}!</p><p>To continue, click on the link in the email using your phone, tablet, or PC.</p><p>No email? You may not be able to create an account.</p>",values:{email:t,p:e=>Yy.createElement("p",null,e)}}),i&&Yy.createElement("p",null,Yy.createElement("small",null,Yy.createElement(uw.Z,{id:"sign-in-modal.newsletter-signup-question",defaultMessage:"Want Hubs news sent to your inbox?"}),Yy.createElement("br",null),Yy.createElement("a",{href:"https://eepurl.com/gX_fH9",target:"_blank",rel:"noopener noreferrer"},Yy.createElement(uw.Z,{id:"sign-in-modal.newsletter-signup-link",defaultMessage:"Subscribe for updates"})))),Yy.createElement(i_,{onClick:n}))}function XS(e){let{message:t,onContinue:n}=e;const i=(0,FE.Z)();return Yy.createElement(O_,{center:!0,padding:!0},Yy.createElement("p",null,Yy.createElement("b",null,t?i.formatMessage(t):Yy.createElement(uw.Z,{id:"sign-in-modal.complete",defaultMessage:"You are now signed in."}))),Yy.createElement(r_,{onClick:n}))}function KS(e){let{closeable:t,onClose:n,children:i}=e,r=function(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}(e,US);return Yy.createElement(N_,HS({title:Yy.createElement(uw.Z,{id:"sign-in-modal.title",defaultMessage:"Sign In"}),beforeTitle:t&&Yy.createElement(Ww,{onClick:n})},r),i)}function $S(e,t,n,i,r,o,s){try{var a=e[o](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(i,r)}function JS(e){return function(){var t=this,n=arguments;return new Promise((function(i,r){var o=e.apply(t,n);function s(e){$S(o,i,r,s,a,"next",e)}function a(e){$S(o,i,r,s,a,"throw",e)}s(void 0)}))}}GS.defaultProps={bindType:"0",initialEmail:"",message:""},GS.propTypes={message:sw().string,bindType:sw().string,stores:sw().array,termsUrl:sw().string,privacyUrl:sw().string,initialEmail:sw().string,onBindMember:sw().func.isRequired,onBindSeller:sw().func.isRequired,onBindStore:sw().func.isRequired,onBindCancel:sw().func.isRequired},YS.defaultProps={initialEmail:""},YS.propTypes={message:sw().object,termsUrl:sw().string,privacyUrl:sw().string,initialEmail:sw().string,onSubmitEmail:sw().func.isRequired,onCancel:sw().func.isRequired},QS.propTypes={showNewsletterSignup:sw().bool,email:sw().string.isRequired,onCancel:sw().func.isRequired},XS.propTypes={message:sw().string,onContinue:sw().func.isRequired},KS.propTypes={closeable:sw().bool,onClose:sw().func,children:sw().node};const ex=AFRAME.utils.device.isMobile(),tx=AFRAME.utils.device.isMobileVR(),nx={videos:"https://privacy.microsoft.com/en-us/privacystatement",images:"https://privacy.microsoft.com/en-us/privacystatement",gifs:"https://tenor.com/legal-privacy",sketchfab:"https://sketchfab.com/privacy",youtube:"https://policies.google.com/privacy",twitch:"https://www.twitch.tv/p/legal/privacy-policy/"},ix={sketchfab:[{text:"Featured",params:{filter:"featured"}},{text:"Animals",params:{filter:"animals-pets"}},{text:"Architecture",params:{filter:"architecture"}},{text:"Art",params:{filter:"art-abstract"}},{text:"Vehicles",params:{filter:"cars-vehicles"}},{text:"Characters",params:{filter:"characters-creatures"}},{text:"Culture",params:{filter:"cultural-heritage-history"}},{text:"Gadgets",params:{filter:"electronics-gadgets"}},{text:"Fashion",params:{filter:"fashion-style"}},{text:"Food",params:{filter:"food-drink"}},{text:"Furniture",params:{filter:"furniture-home"}},{text:"Music",params:{filter:"music"}},{text:"Nature",params:{filter:"nature-plants"}},{text:"News",params:{filter:"news-politics"}},{text:"People",params:{filter:"people"}},{text:"Places",params:{filter:"places-travel"}},{text:"Science",params:{filter:"science-technology"}},{text:"Sports",params:{filter:"sports-fitness"}},{text:"Weapons",params:{filter:"weapons-military"}}],avatars:[{text:"Featured",params:{filter:"featured"}},{text:"My Avatars",params:{filter:"my-avatars"}},{text:"Newest",params:{filter:""}}],favorites:[],scenes:[{text:"Featured",params:{filter:"featured"}},{text:"My Scenes",params:{filter:"my-scenes"}}]},rx=(0,gE.vU)({images:{id:"media-browser.powered_by.images",defaultMessage:"Search by Bing"},videos:{id:"media-browser.powered_by.videos",defaultMessage:"Search by Bing"},youtube:{id:"media-browser.powered_by.youtube",defaultMessage:"Search by Google"},gifs:{id:"media-browser.powered_by.gifs",defaultMessage:"Search by Tenor"},sketchfab:{id:"media-browser.powered_by.sketchfab",defaultMessage:"Search by Sketchfab"},twitch:{id:"media-browser.powered_by.twitch",defaultMessage:"Search by Twitch"},scenes:{id:"media-browser.powered_by.scenes",defaultMessage:"Made with {editorName}"}}),ox=(0,gE.vU)({object:{id:"media-browser.add_custom_object",defaultMessage:"Custom URL or File"},scene:{id:"media-browser.add_custom_scene",defaultMessage:"Custom Scene"},avatar:{id:"media-browser.add_custom_avatar",defaultMessage:"Avatar GLB URL"}}),sx=(0,gE.vU)({scenes:{id:"media-browser.search-placeholder.scenes",defaultMessage:"Search Scenes..."},avatars:{id:"media-browser.search-placeholder.avatars",defaultMessage:"Search Avatars..."},videos:{id:"media-browser.search-placeholder.videos",defaultMessage:"Search for Videos..."},images:{id:"media-browser.search-placeholder.images",defaultMessage:"Search for Images..."},youtube:{id:"media-browser.search-placeholder.youtube",defaultMessage:"Search for Youtube videos..."},gifs:{id:"media-browser.search-placeholder.gifs",defaultMessage:"Search for GIFs..."},twitch:{id:"media-browser.search-placeholder.twitch",defaultMessage:"Search for Twitch streams..."},sketchfab:{id:"media-browser.search-placeholder.sketchfab",defaultMessage:"Search Sketchfab Models..."},default:{id:"media-browser.search-placeholder.default",defaultMessage:"Search..."}}),ax=(0,gE.vU)({favorites:{id:"media-browser.empty.favorites",defaultMessage:"You don't have any favorites. Click a ⭐ to add to your favorites."},default:{id:"media-browser.empty.default",defaultMessage:"No results. Try entering a new search above."}});class lx extends Yy.Component{constructor(e){var t;super(e),t=this,this.state={query:"",facets:[],showNav:!0,selectNextResult:!1,clearStashedQueryOnClose:!1},this.storeUpdated=()=>{const e=this.getStoreAndHistoryState(this.props);this.setState(e),this.state.selectNextResult&&(e.result&&e.result.entries.length>0?this.selectEntry(e.result.entries[0]):this.close())},this.sourceChanged=()=>{!this.inputRef||ex||tx||this.inputRef.focus()},this.getUrlSource=e=>e.get("media_source")||iw(this.props.history.location).substring(7),this.getStoreAndHistoryState=e=>{const t=new URLSearchParams(e.history.location.search),n=e.mediaSearchStore.result,i={result:n,query:this.state.query||t.get("q")||""},r=this.getUrlSource(t);return i.showNav=!("false"===t.get("media_nav")),i.selectAction=t.get("selectAction")||"spawn",n&&n.suggestions&&n.suggestions.length>0?i.facets=n.suggestions.map((e=>({text:e,params:{q:e}}))):i.facets=ix[r]||[],i},this.handleQueryUpdated=(e,t)=>{this.setState({result:null}),this._sendQueryTimeout&&(clearTimeout(this._sendQueryTimeout),this._sendQueryTimeout=null),t?this.props.mediaSearchStore.filterQueryNavigate("",e):this._sendQueryTimeout=setTimeout((()=>{this.props.mediaSearchStore.filterQueryNavigate("",e),this._sendQueryTimeout=null}),500),this.setState({query:e})},this.handleEntryClicked=(e,t)=>{e.preventDefault(),t.lucky_query?(this.setState({clearStashedQueryOnClose:!0}),this.handleQueryUpdated(t.lucky_query,!0)):this.selectEntry(t)},this.onShowSimilar=(e,t)=>{this.handleFacetClicked({params:{similar_to:e,similar_name:t}})},this.selectEntry=e=>{this.props.onMediaSearchResultEntrySelected&&(this.props.onMediaSearchResultEntrySelected(e,this.state.selectAction),this.close())},this.handleSourceClicked=e=>{this.props.mediaSearchStore.sourceNavigate(e)},this.handleFacetClicked=e=>{this.setState({query:""},(()=>{const t=this.getSearchClearedSearchParams(!0,!0,!0);for(const[n,i]of Object.entries(e.params))t.set(n,i);tw(this.props.history,this.props.history.location.pathname,t.toString())}))},this.getSearchClearedSearchParams=(e,t,n)=>this.props.mediaSearchStore.getSearchClearedSearchParams(this.props.history.location,e,t,n),this.pushExitMediaBrowserHistory=function(e){void 0===e&&(e=!0),t.props.mediaSearchStore.pushExitMediaBrowserHistory(t.props.history,e)},this.showCustomMediaDialog=e=>{const{scene:t,store:n,hubChannel:i}=this.props,r="avatars"===e;this.pushExitMediaBrowserHistory(!r),"scenes"===e?this.props.showNonHistoriedDialog(VE,{hubChannel:i}):r?this.props.showNonHistoriedDialog(OE,{scene:t,store:n}):this.props.showNonHistoriedDialog(GE,{scene:t})},this.close=()=>{wb();const e=this.getUrlSource(new URLSearchParams(this.props.history.location.search));this.pushExitMediaBrowserHistory("avatars"!==e&&"favorites"!==e),this.state.clearStashedQueryOnClose&&this.props.mediaSearchStore.clearStashedQuery()},this.handlePager=e=>{this.setState({result:null}),this.props.mediaSearchStore.pageNavigate(e),this.browserDiv.scrollTop=0},this.handleCopyAvatar=(e,n)=>{e.preventDefault(),this.props.performConditionalSignIn((()=>this.props.hubChannel.signedIn),JS((function*(){yield Ng(n.id,n.name),t.handleFacetClicked({params:{filter:"my-avatars"}})})),ZS.remixAvatar)},this.handleCopyScene=function(){var e=JS((function*(e,n){e.preventDefault(),t.props.performConditionalSignIn((()=>t.props.hubChannel.signedIn),JS((function*(){yield Se("/api/v1/scenes","POST",{parent_scene_id:n.id}),t.handleFacetClicked({params:{filter:"my-scenes"}})})),ZS.remixScene)}));return function(t,n){return e.apply(this,arguments)}}(),this.onCreateAvatar=()=>{window.dispatchEvent(new CustomEvent("action_create_avatar"))},this.processThumbnailUrl=(e,t,n)=>"mp4"===e.images.preview.type?zs(e.images.preview.url):((e,t,n)=>{let i="";try{const t=new URL(e).pathname.split(".");if(t.length>1){const e=t.pop();Us[e]&&(i=`.${e}`)}}catch(e){i=".png"}const r=`https://${k.THUMBNAIL_SERVER}/thumbnail/${(e=>{return(t=e,btoa(encodeURIComponent(t).replace(/%([0-9A-F]{2})/g,((e,t)=>String.fromCharCode("0x"+t))))).replace(/=+$/g,"").replace(/\+/g,"-").replace(/\//g,"_");var t})(e)}${i}?w=${t}&h=${n}`;try{const t=new URL(e).hostname;if(ce()&&new URL(`https://${k.RETICULUM_SERVER}`).hostname===t)return e}catch(e){return r}return r})(e.images.preview.url,t,n),this.state=this.getStoreAndHistoryState(e),this.props.mediaSearchStore.addEventListener("statechanged",this.storeUpdated),this.props.mediaSearchStore.addEventListener("sourcechanged",this.sourceChanged)}componentDidMount(){}componentWillUnmount(){this.props.mediaSearchStore.removeEventListener("statechanged",this.storeUpdated),this.props.mediaSearchStore.removeEventListener("sourcechanged",this.sourceChanged)}render(){const e=this.props.intl,t=new URLSearchParams(this.props.history.location.search),n=this.getUrlSource(t),i="scenes"===n,r=!("favorites"===n)&&(!i||this.props.hubChannel.canOrWillIfCreator("update_hub")),o=this.state.result&&this.state.result.entries||[],s="favorites"===n,a="avatars"!==n&&"scenes"!==n,l=this.state.facets&&this.state.facets.length>0?this.state.facets:void 0;if(this.state.selectNextResult)return Yy.createElement("div",null);const c=e=>{"avatars"===e?this.showCustomMediaDialog(e):this.props.performConditionalSignIn((()=>!i||this.props.hubChannel.can("update_hub")),(()=>this.showCustomMediaDialog(e)),ZS.changeScene)},d=t.get("filter")||t.get("similar_to")&&"similar"||!t.get("q")&&"",u=this.state.result&&this.state.result.meta,h=!(!u||!u.next_cursor),p=!!t.get("cursor"),m=this.state.result&&i?"scene":"avatars"===n?"avatar":"object";let f;return s||"scenes"===n||"avatars"===n||"favorites"===n?"scenes"===n&&(f=Yy.createElement(Yy.Fragment,null,k.feature("enable_spoke")&&Yy.createElement(Yy.Fragment,null,e.formatMessage(rx.scenes,{editorName:Yy.createElement("a",{href:"/spoke",target:"_blank",rel:"noreferrer noopener"},k.translation("editor-name"))})),k.feature("enable_spoke")&&k.feature("show_issue_report_link")&&" | ",k.feature("show_issue_report_link")&&Yy.createElement("a",{target:"_blank",rel:"noopener noreferrer",href:k.link("issue_report","https://hubs.mozilla.com/docs/help.html")},Yy.createElement(uw.Z,{id:"media-browser.report-issue",defaultMessage:"Report Issue"})))):f=Yy.createElement(Yy.Fragment,null,rx[n]?e.formatMessage(rx[n]):"",rx[n]&&nx[n]?" | ":"",nx[n]&&Yy.createElement("a",{href:nx[n],target:"_blank",rel:"noreferrer noopener"},Yy.createElement(uw.Z,{id:"media-browser.privacy_policy",defaultMessage:"Privacy Policy"}))),Yy.createElement(bA,{browserRef:e=>this.browserDiv=e,onClose:this.close,searchInputRef:e=>this.inputRef=e,autoFocusSearch:!ex&&!tx,query:this.state.query,onChangeQuery:e=>this.handleQueryUpdated(e.target.value),onSearchKeyDown:e=>{"Enter"===e.key&&e.ctrlKey?o.length>0&&!this._sendQueryTimeout?this.handleEntryClicked(e,o[0]):""!==this.state.query.trim()?(this.handleQueryUpdated(this.state.query,!0),this.setState({selectNextResult:!0})):this.close():("Escape"===e.key||"Enter"===e.key&&ex)&&e.target.blur()},onClearSearch:()=>this.handleQueryUpdated("",!0),mediaSources:"favorites"===n?void 0:_E,selectedSource:n,onSelectSource:this.handleSourceClicked,activeFilter:d,facets:l,onSelectFacet:this.handleFacetClicked,searchPlaceholder:sx[n]?e.formatMessage(sx[n]):e.formatMessage(sx.default),searchDescription:f,headerRight:r&&Yy.createElement(Iw,{lg:!0,onClick:()=>c(n)},["scenes","avatars"].includes(n)?Yy.createElement(xA,null):Yy.createElement(EA,null),Yy.createElement("p",null,e.formatMessage(ox[m]))),hasNext:h,hasPrevious:p,onNextPage:()=>this.handlePager(1),onPreviousPage:()=>this.handlePager(-1),noResultsMessage:ax[n]?e.formatMessage(ax[n]):e.formatMessage(ax.default)},this.props.mediaSearchStore.isFetching||this._sendQueryTimeout||o.length>0||!a?Yy.createElement(Yy.Fragment,null,"avatars"===n&&Yy.createElement(pS,{type:"avatar",onClick:this.onCreateAvatar,label:Yy.createElement(uw.Z,{id:"media-browser.create-avatar",defaultMessage:"Create Avatar"})}),"scenes"===n&&k.feature("enable_spoke")&&Yy.createElement(pS,{as:"a",href:"/spoke/new",rel:"noopener noreferrer",target:"_blank",type:"scene",label:Yy.createElement(uw.Z,{id:"media-browser.create-scene",defaultMessage:"Create Scene with {editorName}",values:{editorName:k.translation("editor-name")}})}),o.map(((e,t)=>{const n="avatar"===e.type||"avatar_listing"===e.type,i="scene"===e.type||"scene_listing"===e.type,r="avatar_listing"===e.type?t=>{t.preventDefault(),this.onShowSimilar(e.id,e.name)}:void 0;let o,s;return"avatar"===e.type?o=t=>{t.preventDefault(),ew(this.props.history,"overlay","avatar-editor",{avatarId:e.id})}:"scene"===e.type&&(o=t=>{t.preventDefault();const n=ge(`/spoke/projects/${e.project_id}`);window.open(n)}),n?s=t=>this.handleCopyAvatar(t,e):i&&(s=t=>this.handleCopyScene(t,e)),Yy.createElement(mS,{key:`${e.id}_${t}`,entry:e,processThumbnailUrl:this.processThumbnailUrl,onClick:t=>this.handleEntryClicked(t,e),onEdit:o,onShowSimilar:r,onCopy:s})}))):null)}}lx.propTypes={mediaSearchStore:sw().object,history:sw().object,intl:sw().object,hubChannel:sw().object,onMediaSearchResultEntrySelected:sw().func,performConditionalSignIn:sw().func,showNonHistoriedDialog:sw().func.isRequired,scene:sw().object.isRequired,store:sw().object.isRequired};var cx=(0,V_.ZP)(lx);class dx extends Yy.Component{componentDidMount(){this.props.entering&&this.props.onEnteringCanceled()}render(){return null}}dx.propTypes={entering:sw().bool,onEnteringCanceled:sw().func};var ux=n(59545),hx=n(34601),px=n(17625);function mx(e){return k.feature(e.name)&&e.children||null}mx.propTypes={name:sw().string,children:sw().node};var fx=n.p+"assets/images/dropdown_arrow-d80c63b6a5b5287e1ce8..png",gx=n.p+"assets/images/dropdown_arrow@2x-84dab5161067e9566608..png";function vx(){return vx=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},vx.apply(this,arguments)}function bx(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function yx(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?bx(Object(n),!0).forEach((function(t){wx(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):bx(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function wx(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _x(e,t,n,i,r,o,s){try{var a=e[o](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(i,r)}function Ex(e){return function(){var t=this,n=arguments;return new Promise((function(i,r){var o=e.apply(t,n);function s(e){_x(o,i,r,s,a,"next",e)}function a(e){_x(o,i,r,s,a,"throw",e)}s(void 0)}))}}const Ax=(0,gE.Em)({id:"avatar-editor.delist-avatar-info",defaultMessage:"Other users already using this avatar will still be able to use it, but it will be removed from 'My Avatars' and search results."}),Sx="/api/v1/avatars",xx=[],Mx=[...xx,{name:"Skindex Editor",url:"https://www.minecraftskins.com/skin-editor"},{name:"MinecraftSkins.net Editor",url:"https://www.minecraftskins.net/skineditor"}],Px=function(){var e=Ex((function*(e){const{avatars:t}=yield Se(`${Sx}/${e}`);return t[0]}));return function(t){return e.apply(this,arguments)}}();class Cx{constructor(e){this.parser=e,this.gltf=null,this.bin=null}beforeRoot(){const e=this.parser,{body:t}=e.extensions.KHR_binary_glTF,n=JSON.stringify(Ig(e.json));this.gltf=new File([n],"file.gltf",{type:"model/gltf"}),this.bin=new File([t],"file.bin",{type:"application/octet-stream"}),e.json={asset:{version:"2.0"}}}afterRoot(e){e.files=e.files||{},e.files.gltf=this.gltf,e.files.bin=this.bin}}class kx extends Yy.Component{constructor(e){var t;super(e),t=this,this.state={baseAvatarResults:[],editorLinks:xx,previewGltfUrl:null},this.componentDidMount=Ex((function*(){if(t.props.avatarId){const e=yield Px(t.props.avatarId);e.creatorAttribution=e.attributions&&e.attributions.creator||"",Object.assign(t.inputFiles,e.files),t.setState({avatar:e,previewGltfUrl:e.base_gltf_url})}else{const{entries:e}=yield Se("/api/v1/media/search?filter=base&source=avatar_listings"),n=e.map((e=>({id:e.id,name:e.name,gltfs:e.gltfs,images:e.images})));if(n.length){const e=n[Math.floor(Math.random()*n.length)];t.setState({baseAvatarResults:n,avatar:{name:"My Avatar",files:{},base_gltf_url:e.gltfs.base,parent_avatar_listing_id:e.id},previewGltfUrl:e.gltfs.avatar})}else t.setState({avatar:{name:"My Avatar",files:{}}})}})),this.createOrUpdateAvatar=e=>Se(e.avatar_id?`${Sx}/${e.avatar_id}`:Sx,e.avatar_id?"PUT":"POST",{avatar:e}).then((e=>{let{avatars:t}=e;return t[0]})),this.uploadAvatar=function(){var e=Ex((function*(e){if(e.preventDefault(),t.inputFiles.glb&&t.inputFiles.glb instanceof File){const e=(new Ms.E).register((e=>new Cx(e))),n=URL.createObjectURL(t.inputFiles.glb),i=console.log;yield new Promise(((r,o)=>{e.load(n,(e=>{t.inputFiles.gltf=e.files.gltf,t.inputFiles.bin=e.files.bin,r(e)}),i,o)})),URL.revokeObjectURL(n)}t.inputFiles.thumbnail=new File([yield t.preview.snapshot()],"thumbnail.png",{type:"image/png"});const n=["gltf","bin","base_map","emissive_map","normal_map","orm_map","thumbnail"].filter((e=>null===t.inputFiles[e]||t.inputFiles[e]instanceof File));t.setState({uploading:!0});const i=yield Promise.all(n.map((e=>t.inputFiles[e]&&Ll(t.inputFiles[e])))),r=yx(yx({},t.state.avatar),{},{attributions:{creator:t.state.avatar.creatorAttribution},files:i.map(((e,t)=>[n[t],e&&[e.file_id,e.meta.access_token,e.meta.promotion_token]])).reduce(((e,t)=>{let[n,i]=t;return yx(yx({},e),{},{[n]:i})}),{})});yield t.createOrUpdateAvatar(r),t.setState({uploading:!1}),t.props.onSave&&t.props.onSave()}));return function(t){return e.apply(this,arguments)}}(),this.deleteAvatar=function(){var e=Ex((function*(e){e.preventDefault(),yield Se(`${Sx}/${t.state.avatar.avatar_id}`,"DELETE"),t.props.onSave&&t.props.onSave()}));return function(t){return e.apply(this,arguments)}}(),this.fileField=function(e,n,i,r,o){return void 0===r&&(r=!1),Yy.createElement("div",{className:lw()("file-input-row",{disabled:r}),key:e,title:o},Yy.createElement("label",{htmlFor:`avatar-file_${e}`},Yy.createElement("div",{className:"img-box"}),Yy.createElement("span",null,n)),Yy.createElement("input",{id:`avatar-file_${e}`,type:"file",accept:i,disabled:r,onChange:n=>{const i=n.target.files[0];n.target.value=null,t.inputFiles[e]=i,URL.revokeObjectURL(t.state.previewGltfUrl);const r=URL.createObjectURL(t.inputFiles.glb);t.setState({previewGltfUrl:r,avatar:yx(yx({},t.state.avatar),{},{files:yx(yx({},t.state.avatar.files),{},{[e]:URL.createObjectURL(i)})})})}}),t.state.avatar.files[e]&&Yy.createElement("a",{onClick:()=>{t.inputFiles[e]=null,URL.revokeObjectURL(t.state.avatar.files[e]),t.setState({avatar:yx(yx({},t.state.avatar),{},{files:yx(yx({},t.state.avatar.files),{},{[e]:null})})},(()=>t.setState({previewGltfUrl:t.getPreviewUrl()})))}},Yy.createElement("i",null,Yy.createElement(px.G,{icon:ux.NB}))))},this.mapField=function(e,n,i,r,o){return void 0===r&&(r=!1),Yy.createElement("div",{className:"file-input-row",key:e,title:o},Yy.createElement("label",{htmlFor:`avatar-file_${e}`},Yy.createElement("div",{className:"img-box"},t.state.avatar.files[e]?Yy.createElement("img",{src:t.state.avatar.files[e]}):Yy.createElement(px.G,{icon:hx.r6})),Yy.createElement("span",null,n)),Yy.createElement("input",{id:`avatar-file_${e}`,type:"file",accept:i,disabled:r,onChange:n=>{const i=n.target.files[0];n.target.value=null,t.inputFiles[e]=i,URL.revokeObjectURL(t.state.avatar.files[e]),t.setState({avatar:yx(yx({},t.state.avatar),{},{files:yx(yx({},t.state.avatar.files),{},{[e]:URL.createObjectURL(i)})})})}}),t.state.avatar.files[e]&&Yy.createElement("a",{onClick:()=>{t.inputFiles[e]=null,URL.revokeObjectURL(t.state.avatar.files[e]),t.setState({avatar:yx(yx({},t.state.avatar),{},{files:yx(yx({},t.state.avatar.files),{},{[e]:null})})})}},Yy.createElement("i",null,Yy.createElement(px.G,{icon:ux.NB}))))},this.textField=(e,t,n,i)=>Yy.createElement("div",{className:"text-field-container"},Yy.createElement("label",{htmlFor:`#avatar-${e}`},t),Yy.createElement("input",{id:`avatar-${e}`,type:"text",disabled:n,required:i,placeholder:t,className:"text-field",value:this.state.avatar[e]||"",onChange:t=>this.setState({avatar:yx(yx({},this.state.avatar),{},{[e]:t.target.value})})})),this.getPreviewUrl=e=>{if(e){const t=this.state.baseAvatarResults.find((t=>t.id===e));if(t)return t.gltfs.avatar}return this.inputFiles.glb?URL.createObjectURL(this.inputFiles.glb):this.state.avatar.base_gltf_url},this.selectListingField=(e,n)=>Yy.createElement("div",{className:"select-container"},Yy.createElement("label",{htmlFor:`#avatar-${e}`},n),Yy.createElement("select",{id:`avatar-${e}`,value:this.state.avatar[e]||"",onChange:function(){var n=Ex((function*(n){const i=n.target.value;t.setState({avatar:yx(yx({},t.state.avatar),{},{[e]:i}),previewGltfUrl:t.getPreviewUrl(i)})}));return function(e){return n.apply(this,arguments)}}(),placeholder:n,className:"select"},this.state.baseAvatarResults.map((e=>Yy.createElement("option",{key:e.id,value:e.id},e.name))),Yy.createElement("option",{value:""},Yy.createElement(uw.Z,{id:"avatar-editor.custom-avatar-option",defaultMessage:"Custom GLB..."}))),Yy.createElement("img",{className:"arrow",src:fx,srcSet:`${gx} 2x`})),this.selectListingGrid=(e,t)=>Yy.createElement("div",{className:"select-grid-container"},Yy.createElement("label",{htmlFor:`#avatar-${e}`},t),Yy.createElement("div",{className:"select-grid"},this.state.baseAvatarResults.map((t=>Yy.createElement("div",{onClick:()=>this.setState({avatar:yx(yx({},this.state.avatar),{},{[e]:t.id}),previewGltfUrl:this.getPreviewUrl(t.id)}),key:t.id,className:lw()("item",{selected:t.id===this.state.avatar[e]}),style:{paddingBottom:t.images.preview.width/t.images.preview.height*100+"%"}},Yy.createElement("img",{src:t.images.preview.url}))))),Yy.createElement("input",{id:"avatar-file_glb",type:"file",accept:"model/gltf+binary,.glb",onChange:t=>{const n=t.target.files[0];t.target.value=null,this.inputFiles.glb=n,URL.revokeObjectURL(this.state.avatar.files.glb),this.setState({avatar:yx(yx({},this.state.avatar),{},{[e]:"",files:yx(yx({},this.state.avatar.files),{},{glb:URL.createObjectURL(n)})}),previewGltfUrl:this.getPreviewUrl("")})}}),Yy.createElement("label",{htmlFor:"avatar-file_glb",className:lw()("item","custom",{selected:""===this.state.avatar[e]})},Yy.createElement(uw.Z,{id:"avatar-editor.upload-custom-avatar-button",defaultMessage:"{icon} Custom GLB",values:{icon:Yy.createElement(px.G,{icon:hx.r6})}}))),this.textarea=(e,t,n)=>Yy.createElement("div",null,Yy.createElement("textarea",{id:`avatar-${e}`,disabled:n,placeholder:t,className:"textarea",value:this.state.avatar[e]||"",onChange:t=>this.setState({avatar:yx(yx({},this.state.avatar),{},{[e]:t.target.value})})})),this.checkbox=(e,t,n,i)=>Yy.createElement("div",{className:"checkbox-container",title:t},Yy.createElement("input",{id:`avatar-${e}`,type:"checkbox",className:"checkbox",disabled:i,checked:!!this.state.avatar[e],onChange:t=>this.setState({avatar:yx(yx({},this.state.avatar),{},{[e]:t.target.checked})})}),Yy.createElement("label",{htmlFor:`#avatar-${e}`},n)),this.handleGltfLoaded=e=>{const t=e.parser.json.extensions&&e.parser.json.extensions.MOZ_hubs_avatar;let n=t&&t.editors||xx;n=n.filter((e=>Mx.some((t=>t.name===e.name&&t.url===e.url)))),this.setState({editorLinks:n})},this.inputFiles={}}render(){const{debug:e,intl:t}=this.props,{avatar:n}=this.state;return Yy.createElement("div",{className:lw()("avatar-editor__avatar-editor___imLb",this.props.className)},this.props.onClose&&Yy.createElement("a",{className:"close-button",onClick:this.props.onClose},Yy.createElement("i",null,Yy.createElement(px.G,{icon:ux.NB}))),this.state.avatar?Yy.createElement("form",{onSubmit:this.uploadAvatar,className:"center"},this.textField("name","Name",!1,!0),Yy.createElement("div",{className:"split"},Yy.createElement("div",{className:"form-body"},e&&this.textField("avatar_id",t.formatMessage({id:"avatar-editor.field.avatar-id",defaultMessage:"Avatar ID"}),!0),e&&this.textField("parent_avatar_id",t.formatMessage({id:"avatar-editor.field.parent-avatar-id",defaultMessage:"Parent Avatar ID"})),e&&this.textField("parent_avatar_listing_id",t.formatMessage({id:"avatar-editor.field.parent-avatar-listing-id",defaultMessage:"Parent Avatar Listing ID"})),e&&this.textarea("description",t.formatMessage({id:"avatar-editor.field.description",defaultMessage:"Description"})),!this.props.avatarId&&this.selectListingGrid("parent_avatar_listing_id",t.formatMessage({id:"avatar-editor.field.model",defaultMessage:"Model"})),Yy.createElement("label",null,Yy.createElement(uw.Z,{id:"avatar-editor.skin-section",defaultMessage:"Skin"})),this.mapField("base_map",t.formatMessage({id:"avatar-editor.field.base-map",defaultMessage:"Base Map"}),"image/*"),Yy.createElement("details",null,Yy.createElement("summary",null,Yy.createElement(uw.Z,{id:"avatar-editor.advanced-section",defaultMessage:"Advanced"})),this.mapField("emissive_map",t.formatMessage({id:"avatar-editor.field.emissive-map",defaultMessage:"Emissive Map"}),"image/*"),this.mapField("normal_map",t.formatMessage({id:"avatar-editor.field.normal-map",defaultMessage:"Normal Map"}),"image/*"),this.mapField("orm_map",t.formatMessage({id:"avatar-editor.field.orm-map",defaultMessage:"ORM Map"}),"image/*",!1,t.formatMessage({id:"avatar-editor.field.orm-map-info",defaultMessage:"Occlussion (r), Roughness (g), Metallic (b)"}))),Yy.createElement("label",null,Yy.createElement(uw.Z,{id:"avatar-editor.share-settings",defaultMessage:"Share Settings"})),this.checkbox("allow_promotion",t.formatMessage({id:"avatar-editor.field.allow-promotion",defaultMessage:"Allow {companyName} to promote your avatar, and show it in search results."},{companyName:k.translation("company-name")}),Yy.createElement("span",null,Yy.createElement(uw.Z,{id:"avatar-editor.field.allow-promotion-checkbox",defaultMessage:"Allow <a>Promotion</a>",values:{a:e=>Yy.createElement("a",{href:k.link("promotion","https://github.com/mozilla/hubs/blob/master/PROMOTION.md"),target:"_blank",rel:"noopener noreferrer"},e)}}))),this.checkbox("allow_remixing",t.formatMessage({id:"avatar-editor.field.allow-remixing",defaultMessage:"Allow others to edit and re-publish your avatar as long as they give you credit."}),Yy.createElement("span",null,Yy.createElement(uw.Z,{id:"avatar-editor.field.allow-remixing-checkbox",defaultMessage:"Allow <a>Remixing</a> <license>(under <licenselink>CC-BY 3.0</licenselink>)</license>",values:{a:e=>Yy.createElement("a",{href:k.link("remixing","https://github.com/mozilla/hubs/blob/master/REMIXING.md"),target:"_blank",rel:"noopener noreferrer"},e),license:e=>Yy.createElement("span",{className:"license"},e),licenselink:e=>Yy.createElement("a",{href:"https://creativecommons.org/licenses/by/3.0/",target:"_blank",rel:"noopener noreferrer"},e)}}))),this.textField("creatorAttribution",t.formatMessage({id:"avatar-editor.field.creator-attribution",defaultMessage:"Attribution (optional)"}),!1,!1)),Yy.createElement(uE,vx({className:"preview",avatarGltfUrl:this.state.previewGltfUrl,onGltfLoaded:this.handleGltfLoaded},this.inputFiles,{ref:e=>this.preview=e}))),Yy.createElement("div",{className:"info"},Yy.createElement(mx,{name:"show_avatar_editor_link"},Yy.createElement("p",null,Yy.createElement(uw.Z,{id:"avatar-editor.external-editor-info",defaultMessage:"Create a custom skin for this avatar:"})," ",this.state.editorLinks.map((e=>{let{name:t,url:n}=e;return Yy.createElement("a",{key:t,target:"_blank",rel:"noopener noreferrer",href:n.replace("$AVATAR_GLTF",encodeURIComponent(this.state.previewGltfUrl))},t)})))),Yy.createElement(mx,{name:"show_avatar_pipelines_link"},Yy.createElement("p",null,Yy.createElement(uw.Z,{id:"avatar-editor.info",defaultMessage:"Find more custom avatar resources <a>here</a>",values:{a:e=>Yy.createElement("a",{target:"_blank",rel:"noopener noreferrer",href:"https://github.com/MozillaReality/hubs-avatar-pipelines"},e)}})))),Yy.createElement("div",null,Yy.createElement("button",{disabled:this.state.uploading,className:"form-submit",type:"submit"},this.state.uploading?Yy.createElement(uw.Z,{id:"avatar-editor.submit-button.uploading",defaultMessage:"Uploading..."}):Yy.createElement(uw.Z,{id:"avatar-editor.submit-button.save",defaultMessage:"Save"}))),!this.props.hideDelete&&Yy.createElement("div",{className:"delete-avatar"},this.state.confirmDelete?Yy.createElement("span",null,Yy.createElement(uw.Z,{id:"avatar-editor.delete-avatar.confirmation-prompt",defaultMessage:"Are you sure?"})," ",Yy.createElement("a",{onClick:this.deleteAvatar},Yy.createElement(uw.Z,{id:"avatar-editor.delete-avatar.confirm",defaultMessage:"yes"}))," ","/"," ",Yy.createElement("a",{onClick:()=>this.setState({confirmDelete:!1})},Yy.createElement(uw.Z,{id:"avatar-editor.delete-avatar.cancel",defaultMessage:"no"}))):Yy.createElement("a",{onClick:()=>this.setState({confirmDelete:!0}),title:n.has_listings?t.formatMessage(Ax):""},n.has_listings?Yy.createElement(uw.Z,{id:"avatar-editor.delist-avatar-button",defaultMessage:"Delist Avatar"}):Yy.createElement(uw.Z,{id:"avatar-editor.delete-avatar-button",defaultMessage:"Delete Avatar"})))):Yy.createElement("div",{className:"loader"},Yy.createElement("div",{className:"loader-center"})))}}kx.propTypes={avatarId:sw().string,onSave:sw().func,onClose:sw().func,hideDelete:sw().bool,debug:sw().bool,className:sw().string,intl:sw().object.isRequired};var Ox=(0,V_.ZP)(kx),Tx=n(40864),Rx=n(76553),Dx="preferences-screen__preference-label__aHcLt",jx="preferences-screen__row__kOhFR",Lx="preferences-screen__row-right__PIhoB",Ix="preferences-screen__disabled__rOFti",Nx="preferences-screen__flex__YLsBQ";function Fx(e,t,n,i,r,o,s){try{var a=e[o](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(i,r)}function Bx(e){return function(){var t=this,n=arguments;return new Promise((function(i,r){var o=e.apply(t,n);function s(e){Fx(o,i,r,s,a,"next",e)}function a(e){Fx(o,i,r,s,a,"throw",e)}s(void 0)}))}}const Vx=AFRAME.utils.device.isMobile(),Ux=Q(),Hx=[/\Wvive\W/i,/\Wrift\W/i],zx="sinkId"in HTMLMediaElement.prototype,Wx=(0,Ct.detectOS)(navigator.userAgent),qx=(0,Ct.detect)(),Zx=!(["iOS","Mac OS"].includes(Wx)&&["safari","ios"].includes(qx.name));class Gx extends ir.EventEmitter{constructor(e,t,n){super(),this.onPermissionsUpdated=()=>{APP.hubChannel.can("voice_chat")||APP.dialog.enableMicrophone(!1)},this.onDeviceChange=()=>{this.fetchMediaDevices().then((()=>{this.changeAudioOutput(this.selectedSpeakersDeviceId),this.emit(Ne.DEVICE_CHANGE,null)}))},this._scene=e,this._store=t,this._micDevices=[],this._videoDevices=[],this._outputDevices=[],this._deviceId=null,this._audioTrack=null,this.audioSystem=n,this._mediaStream=n.outboundStream,this._permissionsStatus={[Be.MICROPHONE]:Fe.PROMPT,[Be.SPEAKERS]:Fe.PROMPT,[Be.CAMERA]:Fe.PROMPT,[Be.SCREEN]:Fe.PROMPT},this.onDeviceChange=this.onDeviceChange.bind(this),navigator.mediaDevices.addEventListener("devicechange",this.onDeviceChange),this.onPermissionsUpdated=this.onPermissionsUpdated.bind(this),APP.hubChannel.addEventListener("permissions_updated",this.onPermissionsUpdated)}static get isAudioOutputSelectEnabled(){return zx}static get isAudioInputSelectEnabled(){return Zx}get deviceId(){return this._deviceId}set deviceId(e){this._deviceId=e}get audioTrack(){return this._audioTrack}set audioTrack(e){this._audioTrack=e}get defaultInputDeviceId(){return this._micDevices.length>0?this._micDevices[0].value:Ve}get defaultOutputDeviceId(){return this._outputDevices.length>0?this._outputDevices[0].value:Ve}get defaultVideoDeviceId(){return this._videoDevices.length>0?this._videoDevices[0].value:Ve}get micDevicesOptions(){return this._micDevices.length>0?this._micDevices:[{value:Ve,label:"None"}]}get videoDevicesOptions(){return this._videoDevices.length>0?this._videoDevices:[{value:Ve,label:"None"}]}get outputDevicesOptions(){return this._outputDevices.length>0?this._outputDevices:[{value:Ve,label:"None"}]}get mediaStream(){return this._mediaStream}set mediaStream(e){this._mediaStream=e}get selectedMicLabel(){return this.micLabelForAudioTrack(this.audioTrack)}get selectedMicDeviceId(){return Gx.isAudioInputSelectEnabled&&this._permissionsStatus[Be.MICROPHONE]!==Fe.GRANTED?Ve:this.deviceIdForMicDeviceLabel(this.selectedMicLabel)}get selectedSpeakersDeviceId(){const{preferredSpeakers:e}=this._store.state.preferences;return this._outputDevices.some((t=>t.value===e))?e:this.defaultOutputDeviceId}get isMicShared(){return null!==this.audioTrack&&this.getPermissionsStatus(Be.MICROPHONE)===Fe.GRANTED}get isVideoShared(){var e;return(null===(e=this._mediaStream)||void 0===e?void 0:e.getVideoTracks().length)>0}get isWebcamShared(){return this._mediaStream.getVideoTracks().some((e=>{e._hubs_contentHint,Be.CAMERA}))}get isScreenShared(){return this._mediaStream.getVideoTracks().some((e=>{e._hubs_contentHint,Be.SCREEN}))}set micEnabled(e){APP.dialog.enableMicrophone(e)}get isMicEnabled(){return APP.dialog.isMicEnabled}toggleMic(){APP.dialog.toggleMicrophone()}getPermissionsStatus(e){return this._permissionsStatus[e]}updatePermissions(){const e=0===this._micDevices.length?Fe.PROMPT:Fe.GRANTED;this._permissionsStatus[Be.MICROPHONE]=e,this.emit(Ne.PERMISSIONS_STATUS_CHANGED,{mediaDevice:Be.MICROPHONE,status:e});const t=0===this._videoDevices.length?Fe.PROMPT:Fe.GRANTED;this._permissionsStatus[Be.CAMERA]=t,this.emit(Ne.PERMISSIONS_STATUS_CHANGED,{mediaDevice:Be.CAMERA,status:t});const n=0===this._micDevices.length?Fe.PROMPT:Fe.GRANTED;this._permissionsStatus[Be.SPEAKERS]=n,this.emit(Ne.PERMISSIONS_STATUS_CHANGED,{mediaDevice:Be.SPEAKERS,status:n})}fetchMediaDevices(){var e=this;return Bx((function*(){return console.log("Fetching media devices"),new Promise((t=>{navigator.mediaDevices.enumerateDevices().then((n=>{n=n.filter((e=>""!==e.label)),e._micDevices=n.filter((e=>"default"!==e.deviceId&&"audioinput"===e.kind)).map((e=>({value:e.deviceId,label:e.label||`Mic Device (${e.deviceId.substring(0,9)})`}))),e._videoDevices=n.filter((e=>"default"!==e.deviceId&&"videoinput"===e.kind)).map((e=>({value:e.deviceId,label:e.label||`Camera Device (${e.deviceId.substring(0,9)})`}))),Gx.isAudioOutputSelectEnabled&&(e._outputDevices=n.filter((e=>"default"!==e.deviceId&&"audiooutput"===e.kind)).map((e=>({value:e.deviceId,label:e.label||`Audio Output (${e.deviceId.substring(0,9)})`})))),e.updatePermissions(),t()}))}))}))()}changeAudioOutput(e){this._store.update({preferences:{preferredSpeakers:e}})}startMicShare(e){var t=this;let{deviceId:n,unmute:i,updatePrefs:r=!0}=e;return Bx((function*(){if(t.isMicShared&&t.selectedMicDeviceId===n)return;if(console.log("Starting microphone sharing"),!n){const{preferredMic:e}=t._store.state.preferences;n=e!==Ve?e:void 0}let e={audio:{}};n&&(e={audio:{deviceId:{ideal:[n]}}});const o=yield t._startMicShare(e);if(yield t.fetchMediaDevices(),t.audioTrack){const e=t.deviceIdForMicDeviceLabel(t.micLabelForAudioTrack(t.audioTrack));e&&(r&&t._store.update({preferences:{preferredMic:e,preferredSpeakers:t.selectedSpeakersDeviceId}}),console.log(`Selected input device: ${t.micLabelForDeviceId(e)}`))}else console.log("No available audio tracks");return yield APP.dialog.setLocalMediaStream(t._mediaStream),i&&APP.dialog.enableMicrophone(!0),o?(t._permissionsStatus[Be.MICROPHONE]=Fe.GRANTED,t._scene.emit(Ne.MIC_SHARE_STARTED),t.emit(Ne.PERMISSIONS_STATUS_CHANGED,{mediaDevice:Be.MICROPHONE,status:Fe.GRANTED})):(t._permissionsStatus[Be.MICROPHONE]=Fe.DENIED,t._scene.emit(Ne.MIC_SHARE_ENDED),t.emit(Ne.PERMISSIONS_STATUS_CHANGED,{mediaDevice:Be.MICROPHONE,status:Fe.DENIED})),o}))()}_startMicShare(e){var t=this;return void 0===e&&(e={audio:{}}),Bx((function*(){t.audioTrack&&t.audioTrack.stop(),e.audio.echoCancellation=!t._store.state.preferences.disableEchoCancellation,e.audio.noiseSuppression=!t._store.state.preferences.disableNoiseSuppression,e.audio.autoGainControl=!t._store.state.preferences.disableAutoGainControl;try{console.log("Adding microphone media stream");const n=yield navigator.mediaDevices.getUserMedia(e);if(t.audioSystem.addStreamToOutboundAudio("microphone",n),t.audioTrack=n.getAudioTracks()[0],t.audioTrack.addEventListener("ended",Bx((function*(){t._scene.emit(Ne.MIC_SHARE_ENDED),t.startMicShare({unmute:t.isMicEnabled})}))),/Oculus/.test(navigator.userAgent)){const n=function(){var i=Bx((function*(){console.warn("Oculus Browser 6 bug hit: Audio stream track ended without calling stop. Recreating audio stream.");const i=yield navigator.mediaDevices.getUserMedia(e);t.audioTrack=i.getAudioTracks()[0],t.audioSystem.addStreamToOutboundAudio("microphone",i),t._scene.emit(Ne.MIC_SHARE_STARTED),t.audioTrack.addEventListener("ended",n,{once:!0})}));return function(){return i.apply(this,arguments)}}();t.audioTrack.addEventListener("ended",n,{once:!0})}return!0}catch(e){return console.error("Error during getUserMedia: ",e),t.audioTrack=null,!1}}))()}stopMicShare(){var e=this;return Bx((function*(){var t;e.audioSystem.removeStreamFromOutboundAudio("microphone"),null===(t=e.audioTrack)||void 0===t||t.stop(),e.audioTrack=null,yield APP.dialog.setLocalMediaStream(e._mediaStream),APP.dialog.enableMicrophone(!1)}))()}startVideoShare(e){var t=this;let{isDisplayMedia:n,target:i,success:r,error:o}=e;return Bx((function*(){let e,s=!1;try{if(e=n?yield navigator.mediaDevices.getDisplayMedia({video:{width:screen.width/screen.height*720,height:720,frameRate:30},audio:{echoCancellation:!0!==window.APP.store.state.preferences.disableEchoCancellation,noiseSuppression:!0!==window.APP.store.state.preferences.disableNoiseSuppression,autoGainControl:!0!==window.APP.store.state.preferences.disableAutoGainControl}}):yield navigator.mediaDevices.getUserMedia({video:{width:Ux?{max:1280}:{max:1280,ideal:720},frameRate:30}}),(e?e.getVideoTracks():[]).length>0){s=!0,e.getVideoTracks().forEach((e=>{e._hubs_contentHint=n?Be.SCREEN:Be.CAMERA,e.addEventListener("ended",Bx((function*(){t._scene.emit(Ne.VIDEO_SHARE_ENDED)}))),t._mediaStream.addTrack(e)})),e&&e.getAudioTracks().length>0&&t.audioSystem.addStreamToOutboundAudio("screenshare",e),yield APP.dialog.setLocalMediaStream(t._mediaStream);const i=n?Be.SCREEN:Be.CAMERA;t._permissionsStatus[i]=Fe.GRANTED,t._scene.emit(Ne.VIDEO_SHARE_STARTED),t.emit(Ne.PERMISSIONS_STATUS_CHANGED,{mediaDevice:i,status:Fe.GRANTED})}}catch(e){o(e);const i=n?Be.SCREEN:Be.CAMERA;return t._permissionsStatus[i]=Fe.DENIED,t._scene.emit(Ne.VIDEO_SHARE_ENDED),void t.emit(Ne.PERMISSIONS_STATUS_CHANGED,{mediaDevice:i,status:Fe.DENIED})}r(n,s,i)}))()}stopVideoShare(){var e=this;return Bx((function*(){if(e._mediaStream){for(const t of e._mediaStream.getVideoTracks())t.stop(),e._mediaStream.removeTrack(t);e.audioSystem.removeStreamFromOutboundAudio("screenshare"),yield APP.dialog.setLocalMediaStream(e._mediaStream)}}))()}shouldShowHmdMicWarning(){var e=this;return Bx((function*(){return!(Vx||AFRAME.utils.device.isMobileVR()||!e.state.enterInVR||!e.hasHmdMicrophone()||Hx.find((t=>e.selectedMicLabel.match(t))))}))()}micLabelForAudioTrack(e){const t=e&&e.label||"";return t.indexOf("Default - ")<0?t:t.substring(10)}deviceIdForMicDeviceLabel(e){return this._micDevices.filter((t=>t.label===e)).map((e=>e.value))[0]||this.defaultInputDeviceId}deviceIdForSpeakersDeviceLabel(e){return this._outputDevices.filter((t=>t.label===e)).map((e=>e.value))[0]||this.defaultOutputDeviceId}micLabelForDeviceId(e){return this._micDevices.filter((t=>t.value===e)).map((e=>e.label))[0]}speakersLabelForDeviceId(e){return this._outputDevices.filter((t=>t.value===e)).map((e=>e.label))[0]}hasHmdMicrophone(){return!!this.state._micDevices.find((e=>Hx.find((t=>e.label.match(t)))))}videoDeviceIdForMicLabel(e){return this._videoDevices.filter((t=>t.label===e)).map((e=>e.value))[0]}videoLabelForDeviceId(e){return this._videoDevices.filter((t=>t.value===e)).map((e=>e.label))[0]}}const Yx=["min","max","step","value","onChange","disabled","className"];function Qx(){return Qx=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},Qx.apply(this,arguments)}function Xx(e,t,n){if(e){const i=((parseFloat(e.value)-t)/(n-t)).toFixed(2);e.style.backgroundImage=function(e,t,n){return["-webkit-gradient(","linear, ","left top, ","right top, ","color-stop("+e+", "+t+"), ","color-stop("+e+", transparent)",")"].join("")}(i,"var(--primary-color)")}}const Kx=(0,Yy.memo)((e=>{let{min:t,max:n,step:i,value:r,onChange:o,disabled:s,className:a}=e,l=function(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}(e,Yx);const c=(0,Yy.useRef)();return(0,Yy.useEffect)((()=>{Xx(c.current,t,n)})),Yy.createElement("div",{className:lw()("Slider__number-with-range__juQDz",a)},Yy.createElement("div",{className:lw()("Slider__range-slider__LYMXh"),disabled:s},Yy.createElement("input",Qx({ref:c,type:"range",step:i,min:t,max:n,value:r,disabled:s,onChange:e=>{void 0===r&&Xx(c.current,t,n),o&&o(parseFloat(e.target.value))}},l))))}));Kx.propTypes={min:sw().number,max:sw().number,step:sw().number,value:sw().number,disabled:sw().bool,onChange:sw().func,className:sw().string},Kx.defaultProps={min:0,max:100,step:1,disabled:!1};const $x=Q(),Jx=function(e,t){void 0===t&&(t=!1),"undefined"!=typeof ScreenOrientation?screen.orientation.addEventListener("change",e,t):window.addEventListener("orientationchange",e,t)},eM=function(e,t){void 0===t&&(t=!1),"undefined"!=typeof ScreenOrientation?screen.orientation.removeEventListener("change",e,t):window.removeEventListener("orientationchange",e,t)},tM=()=>("undefined"!=typeof ScreenOrientation?screen.orientation.angle:window.orientation)%180==0,nM=()=>$x?tM()?screen.width:screen.height:screen.width,iM=()=>$x?tM()?screen.height:screen.width:screen.height,rM=()=>nM()*window.devicePixelRatio,oM=e=>{const t=e.state.preferences,n=tM()?t.maxResolutionWidth:t.maxResolutionHeight;return void 0!==n?n:nM()},sM=e=>{const t=e.state.preferences,n=tM()?t.maxResolutionHeight:t.maxResolutionWidth;return void 0!==n?n:iM()};var aM,lM,cM,dM,uM,hM,pM={"pinned-message":"PermissionNotifications__pinned-message__sSTfu",pinnedMessage:"PermissionNotifications__pinned-message__sSTfu"};function mM(){return mM=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},mM.apply(this,arguments)}const fM=e=>{let{title:t,titleId:n,...i}=e;return Yy.createElement("svg",mM({width:20,height:20,viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":n},i),t?Yy.createElement("title",{id:n},t):null,aM||(aM=Yy.createElement("path",{d:"M7.5 17.5h5",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})),lM||(lM=Yy.createElement("rect",{x:8,y:8.7,width:4,height:0,fill:"#7ED320"})),cM||(cM=Yy.createElement("path",{d:"M15 8.126v1.25c0 2.75-2.25 5-5 5s-5-2.25-5-5v-1.25",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})),dM||(dM=Yy.createElement("path",{d:"M10 14.376v3.125",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})),uM||(uM=Yy.createElement("path",{d:"M10 2.5A2.487 2.487 0 0 0 7.5 5v4.336c0 1.375 1.133 2.54 2.5 2.54s2.5-1.133 2.5-2.54V5c0-1.406-1.094-2.5-2.5-2.5Z",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})),hM||(hM=Yy.createElement("path",{d:"M16.875 15.625 3.75 2.5",stroke:"currentColor",strokeWidth:1.5,strokeMiterlimit:10,strokeLinecap:"round"})))};var gM,vM,bM,yM,wM;function _M(){return _M=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},_M.apply(this,arguments)}const EM=e=>{let{title:t,titleId:n,...i}=e;return Yy.createElement("svg",_M({width:20,height:20,viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":n},i),t?Yy.createElement("title",{id:n},t):null,gM||(gM=Yy.createElement("path",{d:"M7.5 17.5h5",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})),vM||(vM=Yy.createElement("rect",{x:8,y:8.7,width:4,height:0,fill:"#7ED320"})),bM||(bM=Yy.createElement("path",{d:"M15 8.126v1.25c0 2.75-2.25 5-5 5s-5-2.25-5-5v-1.25",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})),yM||(yM=Yy.createElement("path",{d:"M10 14.376v3.125",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})),wM||(wM=Yy.createElement("path",{d:"M10 2.5A2.487 2.487 0 0 0 7.5 5v4.336c0 1.375 1.133 2.54 2.5 2.54s2.5-1.133 2.5-2.54V5c0-1.406-1.094-2.5-2.5-2.5Z",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})))};var AM;function SM(){return SM=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},SM.apply(this,arguments)}const xM=e=>{let{title:t,titleId:n,...i}=e;return Yy.createElement("svg",SM({width:20,height:20,viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":n},i),t?Yy.createElement("title",{id:n},t):null,AM||(AM=Yy.createElement("path",{d:"M3.418 14.844c.046-.171-.057-.409-.155-.58-.03-.052-.063-.101-.099-.149a7.805 7.805 0 0 1-1.289-4.297c-.014-4.385 3.622-7.943 8.118-7.943 3.921 0 7.194 2.717 7.96 6.323.114.534.172 1.08.172 1.626 0 4.391-3.496 8.005-7.992 8.005-.715 0-1.68-.18-2.206-.327a14.835 14.835 0 0 1-1.187-.395 1.215 1.215 0 0 0-.906.014l-2.65.957a.623.623 0 0 1-.182.047.373.373 0 0 1-.374-.38.618.618 0 0 1 .023-.129l.767-2.772Z",stroke:"currentColor",strokeWidth:1.5,strokeMiterlimit:10,strokeLinecap:"round"})))};var MM,PM,CM;function kM(){return kM=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},kM.apply(this,arguments)}const OM=e=>{let{title:t,titleId:n,...i}=e;return Yy.createElement("svg",kM({width:20,height:20,viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":n},i),t?Yy.createElement("title",{id:n},t):null,MM||(MM=Yy.createElement("g",{clipPath:"url(#a)",transform:"scale(.83134)"},Yy.createElement("path",{d:"M5.418 16.844c.046-.171-.057-.409-.155-.58-.03-.052-.063-.101-.099-.149a7.805 7.805 0 0 1-1.289-4.297c-.014-4.385 3.622-7.943 8.118-7.943 3.921 0 7.194 2.717 7.96 6.322.114.535.172 1.08.172 1.627 0 4.391-3.496 8.005-7.992 8.005-.715 0-1.68-.18-2.206-.327a14.835 14.835 0 0 1-1.187-.395 1.215 1.215 0 0 0-.906.014l-2.65.957a.627.627 0 0 1-.182.047.377.377 0 0 1-.374-.38.619.619 0 0 1 .023-.129Z",stroke:"currentColor",strokeWidth:2,strokeMiterlimit:10,strokeLinecap:"round"}))),PM||(PM=Yy.createElement("path",{d:"m.831.831 18.29 18.29",stroke:"currentColor",strokeWidth:1.663,strokeLinecap:"round",strokeLinejoin:"round"})),CM||(CM=Yy.createElement("defs",null,Yy.createElement("clipPath",{id:"a"},Yy.createElement("rect",{width:20,height:20,fill:"#fff",transform:"translate(2 2)"})))))},TM={voiceChatEnabled:Yy.createElement(EM,null),voiceChatDisabled:Yy.createElement(fM,null),voiceChatDisabledMod:Yy.createElement(fM,null),textChatEnabled:Yy.createElement(xM,null),textChatDisabled:Yy.createElement(OM,null),textChatDisabledMod:Yy.createElement(OM,null)},RM=(0,gE.vU)({voiceChatEnabled:{id:"chat-sidebar.moderator-message.voice-chat-enabled",defaultMessage:"Voice chat has been turned on by a moderator"},voiceChatDisabled:{id:"chat-sidebar.moderator-message.voice-chat-disabled",defaultMessage:"Voice chat has been turned off by a moderator"},voiceChatDisabledMod:{id:"chat-sidebar.moderator-message.voice-chat-disabled-mod",defaultMessage:"Guests are unable to use voice chat"},textChatEnabled:{id:"chat-sidebar.moderator-message.text-chat-enabled",defaultMessage:"Text chat has been turned on by a moderator"},textChatDisabled:{id:"chat-sidebar.moderator-message.text-chat-disabled",defaultMessage:"Text chat has been turned off by a moderator"},textChatDisabledMod:{id:"chat-sidebar.moderator-message.text-chat-disabled-mod",defaultMessage:"Guests are unable to send chat messages"}});function DM(e){return(e=e.replace(/[-_\s.]+(.)?/g,((e,t)=>t?t.toUpperCase():""))).substring(0,1).toLowerCase()+e.substring(1)}function jM(e,t){let{permission:n,status:i,isMod:r=!1}=e;const o=`${n}_${i?"enabled":"disabled"}${r?"_Mod":""}`,s=t.formatMessage(RM[DM(o)]),a=TM[DM(o)];return Yy.createElement(Yy.Fragment,null,a,Yy.createElement("p",null,s))}function LM(e){let{permission:t,className:n,isMod:i}=e;const r=(0,FE.Z)();return Yy.createElement("div",{key:t,className:lw()(pM.pinnedMessage,n)},jM({permission:t,status:!1,isMod:i},r))}LM.propTypes={permission:sw().string,className:sw().string,isMod:sw().bool},LM.defaultProps={isMod:!1};const IM=["componentType","children"];function NM(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function FM(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?NM(Object(n),!0).forEach((function(t){BM(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):NM(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function BM(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const VM=200,UM=(0,Yy.memo)((e=>{let{componentType:t,children:n}=e,i=function(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}(e,IM);return Yy.createElement(t,i,n)}));function HM(){return Yy.createElement("i",{className:Nx},Yy.createElement(px.G,{className:"preferences-screen__warn-icon__Xbh58",icon:Rx.eH}))}function zM(e){let{onClick:t}=e;const n=(0,FE.Z)().formatMessage({id:"preferences-screen.reset-to-default",defaultMessage:"Reset preference to default"});return Yy.createElement("button",{className:"preferences-screen__no-default-button-style__LQMg7",title:n,"aria-label":n,onClick:t},Yy.createElement("i",{className:Nx},Yy.createElement(px.G,{className:lw()("preferences-screen__reset-to-default-button__MuW_X"),icon:Tx.X7})))}function WM(){return Yy.createElement("div",{className:"preferences-screen__reset-to-default-button-placeholder__zZzKp"})}function qM(e){const t=(e=e.replace(/[^0-9.]/g,"")).split(".");return t.length>1?`${t.shift()}.${t.join("")}`:e}function ZM(e){const t=e.split(".");return t.length>1&&t[1].length||0}UM.propTypes={componentType:sw().elementType,children:sw().node},UM.displayName="CustomComponentWrapper",zM.propTypes={onClick:sw().func};class GM extends Yy.Component{constructor(e){super(e),this.state={isFocused:!1,displayValue:"",digitsFromUser:0},this.storeUpdated=this.storeUpdated.bind(this)}storeUpdated(){if(!this.state.isFocused){const e=Math.max(this.state.digitsFromUser,this.props.digits);this.setState({displayValue:this.props.store.state.preferences[this.props.storeKey].toFixed(e)})}this.forceUpdate()}componentDidMount(){this.props.store.addEventListener("statechanged",this.storeUpdated),this.setState({displayValue:this.props.store.state.preferences[this.props.storeKey].toFixed(this.props.digits)})}componentWillUnmount(){this.props.store.removeEventListener("statechanged",this.storeUpdated)}render(){return Yy.createElement("div",{className:lw()("preferences-screen__number-with-range__zjW7r",{[Ix]:this.props.disabled})},Yy.createElement("div",{className:lw()("preferences-screen__number-in-number-with-range__j8wRT",{[Ix]:this.props.disabled})},Yy.createElement("input",{type:"text",value:this.state.displayValue,onClick:e=>{e.target.focus(),e.target.select()},onBlur:e=>{const t=qM(e.target.value),n=isNaN(parseFloat(t))?void 0:parseFloat(t);this.setState({displayValue:void 0===n?this.props.store.state.preferences[this.props.storeKey].toFixed(this.props.digits):Math.min(Math.max(this.props.min,n),this.props.max).toFixed(this.props.digits),isFocused:!1})},onFocus:()=>{this.setState({isFocused:!0})},onChange:e=>{const t=qM(e.target.value),n=isNaN(parseFloat(t))?void 0:parseFloat(t),i=Math.min(Math.max(this.props.min,n),this.props.max);this.setState({displayValue:void 0===n?"":i,digitsFromUser:ZM(t)}),this.props.setValue(void 0===n?parseFloat(this.props.store.state.preferences[this.props.storeKey]):i)},disabled:this.props.disabled})),Yy.createElement(Kx,{step:this.props.step,min:this.props.min,max:this.props.max,value:this.props.store.state.preferences[this.props.storeKey],onChange:e=>{const t=e.toFixed(this.props.digits);this.setState({displayValue:t,digitsFromUser:0}),this.props.setValue(parseFloat(t))},disabled:this.props.disabled}))}}function YM(){return Yy.createElement("div",{className:"preferences-screen__checkbox-placeholder__txAun"})}function QM(e){let{store:t,storeKey:n,setValue:i}=e;const r=t.state.preferences[n];return Yy.createElement("input",{tabIndex:"0",type:"checkbox",checked:r,onChange:()=>{i(!r)}})}function XM(e){let{store:t,storeKey:n,defaultValue:i,text:r}=e;const o=t.state.preferences[n],s=o?Object.keys(o).length:i;return Yy.createElement("span",{className:Dx},s," ",r)}GM.propTypes={min:sw().number,max:sw().number,step:sw().number,digits:sw().number,store:sw().object,storeKey:sw().string,setValue:sw().func,disabled:sw().bool},QM.propTypes={store:sw().object,storeKey:sw().string,setValue:sw().func,disabled:sw().bool},XM.propTypes={store:sw().object,storeKey:sw().string,defaultValue:sw().number,text:sw().string};class KM extends Yy.Component{render(){return Yy.createElement("div",{className:"preferences-screen__dropdown__LrsA3"},Yy.createElement("select",{value:this.props.value,tabIndex:"0",onChange:this.props.onChange,disabled:this.props.disabled},this.props.children),Yy.createElement("img",{className:lw()("preferences-screen__dropdown-arrow__ot2ZP",{[Ix]:this.props.disabled}),src:fx,srcSet:`${gx} 2x`}))}}KM.propTypes={children:sw().node.isRequired,value:sw().string,onChange:sw().func,disabled:sw().bool};class $M extends Yy.Component{constructor(){super()}render(){const e=this.props.options.map(((e,t)=>{let{text:n,value:i}=e;return Yy.createElement("option",{key:`option_${this.props.storeKey}_${t}`,value:i},n)}));return Yy.createElement(KM,{value:this.props.store.state.preferences[this.props.storeKey],onChange:e=>{this.props.setValue(e.target.value),this.props.onChanged&&this.props.onChanged(e.target.value)},disabled:this.props.disabled},e)}}$M.propTypes={options:sw().array,store:sw().object,storeKey:sw().string,setValue:sw().func,onChanged:sw().func,disabled:sw().bool};class JM extends Yy.Component{constructor(){super(...arguments),this.onOrientationChange=()=>{this.forceUpdate()}}componentDidMount(){Jx(this.onOrientationChange)}componentWillUnmount(){eM(this.onOrientationChange)}render(){return Yy.createElement("div",{className:lw()("preferences-screen__max-resolution-preference-item__OIo2v")},Yy.createElement("input",{tabIndex:"0",type:"number",step:"1",min:"0",value:oM(this.props.store),readOnly:!0})," ","x"," ",Yy.createElement("input",{tabIndex:"0",type:"number",step:"1",min:"0",value:sM(this.props.store),readOnly:!0})," ",Yy.createElement(Kx,{step:.1,min:.1,max:1,value:oM(this.props.store)/rM(),onChange:e=>{var t,n,i;t=this.props.store,n=Math.floor(rM()*e),i=Math.floor(iM()*window.devicePixelRatio*e),t.update({preferences:{maxResolutionWidth:tM()?n:i,maxResolutionHeight:tM()?i:n}})}}))}}function eP(e){let{children:t,disabled:n,indent:i}=e;return Yy.createElement("div",{className:lw()("preferences-screen__list-item__TotHO",{disabled:n,indent:i})},t)}JM.propTypes={store:sw().object},eP.propTypes={children:sw().node.isRequired,disabled:sw().bool,indent:sw().bool};const tP=(0,gE.vU)({preferredCamera:{id:"preferences-screen.preference.preferred-camera",defaultMessage:"Preferred camera"},preferredMic:{id:"preferences-screen.preference.preferred-mic",defaultMessage:"Preferred mic"},preferredSpeakers:{id:"preferences-screen.preference.preferred-speakers",defaultMessage:"Preferred speakers"},globalVoiceVolume:{id:"preferences-screen.preference.global-voice-volume",defaultMessage:"Incoming Voice Volume"},globalMediaVolume:{id:"preferences-screen.preference.global-media-volume",defaultMessage:"Media Volume"},globalSFXVolume:{id:"preferences-screen.preference.global-sfx-volume",defaultMessage:"SFX Volume"},avatarVoiceLevels:{id:"preferences-screen.preference.avatar-volumes",defaultMessage:"Stored avatar volumes"},disableSoundEffects:{id:"preferences-screen.preference.disable-sound-effects",defaultMessage:"Disable Sound Effects"},disableEchoCancellation:{id:"preferences-screen.preference.disable-echo-cancellation",defaultMessage:"Disable microphone echo cancellation"},disableNoiseSuppression:{id:"preferences-screen.preference.disable-noise-suppression",defaultMessage:"Disable microphone noise supression"},disableAutoGainControl:{id:"preferences-screen.preference.disable-auto-gain-control",defaultMessage:"Disable microphone automatic gain control"},snapRotationDegrees:{id:"preferences-screen.preference.snap-rotation-degrees",defaultMessage:"Rotation per snap (in degrees)"},disableMovement:{id:"preferences-screen.preference.disable-movement",defaultMessage:"Disable movement"},disableBackwardsMovement:{id:"preferences-screen.preference.disable-backwards-movement",defaultMessage:"Disable backwards movement"},disableStrafing:{id:"preferences-screen.preference.disable-strafing",defaultMessage:"Disable strafing"},disableTeleporter:{id:"preferences-screen.preference.disable-teleporter",defaultMessage:"Disable teleporter"},movementSpeedModifier:{id:"preferences-screen.preference.movement-speed-modifier",defaultMessage:"Movement speed modifier"},enableOnScreenJoystickLeft:{id:"preferences-screen.preference.enable-on-screen-joystick-left",defaultMessage:"Enable left on-screen joystick for moving around"},enableOnScreenJoystickRight:{id:"preferences-screen.preference.enable-on-screen-joystick-right",defaultMessage:"Enable right on-screen joystick for looking around"},enableGyro:{id:"preferences-screen.preference.enable-gyro",defaultMessage:"Enable gyroscope (when supported by browser/device)"},invertTouchscreenCameraMove:{id:"preferences-screen.preference.invert-touchscreen-camera-move",defaultMessage:"Invert direction of camera movement for touchscreens"},locale:{id:"preferences-screen.preference.locale",defaultMessage:"Language"},animateWaypointTransitions:{id:"preferences-screen.preference.animate-waypoint-transitions",defaultMessage:"Animate waypoint transitions"},showFPSCounter:{id:"preferences-screen.preference.show-fps-counter",defaultMessage:"Show FPS Counter"},maxResolution:{id:"preferences-screen.preference.max-resolution",defaultMessage:"Max Resolution"},materialQualitySetting:{id:"preferences-screen.preference.material-quality-setting",defaultMessage:"Material quality"},enableDynamicShadows:{id:"preferences-screen.preference.enable-dynamic-shadows",defaultMessage:"Enable Real-time Shadows"},disableAutoPixelRatio:{id:"preferences-screen.preference.disable-auto-pixel-ratio",defaultMessage:"Disable automatic pixel ratio adjustments"},allowMultipleHubsInstances:{id:"preferences-screen.preference.allow-multiple-hubs-instances",defaultMessage:"Disable auto-exit when multiple hubs instances are open"},disableIdleDetection:{id:"preferences-screen.preference.disable-idle-detection",defaultMessage:"Disable auto-exit when idle or backgrounded"},preferMobileObjectInfoPanel:{id:"preferences-screen.preference.prefer-mobile-object-info-panel",defaultMessage:"Prefer Mobile Object Info Panel"},showRtcDebugPanel:{id:"preferences-screen.preference.show-rtc-debug-panel",defaultMessage:"Show RTC Panel"},showAudioDebugPanel:{id:"preferences-screen.preference.show-audio-debug-panel",defaultMessage:"Show Audio Debug Panel"},audioPanningQuality:{id:"preferences-screen.preference.audio-panning-quality",defaultMessage:"Panning quality"},enableAudioClipping:{id:"preferences-screen.preference.enable-audio-clipping",defaultMessage:"Enable Audio Clipping"},audioClippingThreshold:{id:"preferences-screen.preference.audio-clipping-threshold",defaultMessage:"Audio Clipping Threshold"},theme:{id:"preferences-screen.preference.theme",defaultMessage:"Theme"},lazyLoadSceneMedia:{id:"preferences-screen.preference.lazy-load-scene-media",defaultMessage:"Enable Scene Media Lazy Loading"},disableLeftRightPanning:{id:"preferences-screen.preference.disable-panning",defaultMessage:"Disable audio left/right panning"},cursorSize:{id:"preferences-screen.preference.cursor-size",defaultMessage:"Cursor Size"},nametagVisibility:{id:"preferences-screen.preference.nametag-visibility",defaultMessage:"Show Nametag"},nametagVisibilityDistance:{id:"preferences-screen.preference.nametag-visibility-distance",defaultMessage:"Nametag visibility distance"},enablePostEffects:{id:"preferences-screen.preference.enable-fx",defaultMessage:"Enable Post Processing Effects (experimental)"},enablePostEffectsTooltip:{id:"preferences-screen.preference.enable-fx.tooltip",defaultMessage:"This feature is still experimental and may have issues. It is currently unsupported in VR."},enableBloom:{id:"preferences-screen.preference.enable-fx-bloom",defaultMessage:"Enable Bloom Effect"},aaMode:{id:"preferences-screen.preference.fx-aa-mode",defaultMessage:"Anti-Aliasing Mode"}});class nP extends Yy.Component{constructor(){super(...arguments),this.storeUpdated=()=>{this.forceUpdate()}}componentDidMount(){this.props.store.addEventListener("statechanged",this.storeUpdated),window.addEventListener("locale-updated",this.storeUpdated)}componentWillUnmount(){this.props.store.removeEventListener("statechanged",this.storeUpdated),window.removeEventListener("locale-updated",this.storeUpdated)}render(){const e=this.props.intl,t=1===this.props.itemProps.prefType,n=6===this.props.itemProps.prefType,i=window.innerWidth<600,r=tP[this.props.storeKey]&&Yy.createElement("span",{className:lw()(Dx,{[Ix]:this.props.disabled}),title:this.props.itemProps.tooltipKey&&e.formatMessage(tP[this.props.itemProps.tooltipKey])},e.formatMessage(tP[this.props.storeKey])),o=this.props.store.schema.definitions.preferences.properties,s=4===this.props.itemProps.prefType?void 0!==this.props.store.state.preferences.maxResolutionWidth||void 0!==this.props.store.state.preferences.maxResolutionHeight:o[this.props.storeKey]&&this.props.store.state.preferences[this.props.storeKey]!==o[this.props.storeKey].default,a=!this.props.disabled&&s?Yy.createElement(zM,{onClick:()=>{4===this.props.itemProps.prefType?this.props.store.update({preferences:{maxResolutionWidth:void 0,maxResolutionHeight:void 0}}):this.props.setValue(o[this.props.storeKey].default),this.forceUpdate()}}):Yy.createElement(WM,null),l=this.props.itemProps.disableIfTrue&&this.props.store.state.preferences[this.props.itemProps.disableIfTrue]||this.props.itemProps.disableIfFalse&&!this.props.store.state.preferences[this.props.itemProps.disableIfFalse],c=this.props.itemProps.disableIfTrue||this.props.itemProps.disableIfFalse;return n?Yy.createElement(cP,{itemProps:this.props.itemProps,store:this.props.store}):t?Yy.createElement(eP,{disabled:l,indent:c},Yy.createElement("div",{className:jx},Yy.createElement(cP,{itemProps:this.props.itemProps,store:this.props.store,setValue:this.props.setValue,disabled:this.props.disabled}),r,Yy.createElement("div",{className:Lx},a))):i?Yy.createElement(eP,{disabled:l,indent:c},Yy.createElement("div",{className:"preferences-screen__column__FGH5c"},Yy.createElement("div",{className:jx},Yy.createElement(YM,null),r),Yy.createElement("div",{className:jx},Yy.createElement("div",{className:"preferences-screen__row-center__uGrVH"},Yy.createElement(cP,{itemProps:this.props.itemProps,store:this.props.store,setValue:this.props.setValue,disabled:this.props.disabled})),Yy.createElement("div",{className:Lx},a)))):Yy.createElement(eP,{disabled:l,indent:c},Yy.createElement("div",{className:jx},Yy.createElement(YM,null),r,Yy.createElement("div",{className:Lx},Yy.createElement(cP,{itemProps:this.props.itemProps,store:this.props.store,setValue:this.props.setValue,disabled:this.props.disabled})),Yy.createElement("div",{className:Lx},a)))}}nP.propTypes={intl:sw().object,store:sw().object,storeKey:sw().string,setValue:sw().func,itemProps:sw().object,disabled:sw().bool};const iP=(0,V_.ZP)(nP),rP=[0,1,2],oP=(0,gE.vU)({0:{id:"preferences-screen.category.audio",defaultMessage:"Audio"},1:{id:"preferences-screen.category.controls",defaultMessage:"Controls"},2:{id:"preferences-screen.category.misc",defaultMessage:"Misc"},3:{id:"preferences-screen.category.movement",defaultMessage:"Movement"},4:{id:"preferences-screen.category.touchscreen",defaultMessage:"Touchscreen"},5:{id:"preferences-screen.category.accessibility",defaultMessage:"Accessibility"},6:{id:"preferences-screen.category.graphics",defaultMessage:"Graphics"}});function sP(e){let{ariaLabel:t,title:n,onClick:i,selected:r}=e;return Yy.createElement("button",{"aria-label":t,className:lw()("preferences-screen__nav-item__VrLF0",{"preferences-screen__selected__cPwAz":r}),onClick:i},n)}function aP(e){let{onClick:t}=e;const n=(0,FE.Z)();return Yy.createElement("button",{autoFocus:!0,"aria-label":n.formatMessage({id:"preferences-screen.close-button",defaultMessage:"Close Preferences Menu"}),className:lw()("preferences-screen__close-button__WOdhQ"),onClick:t},Yy.createElement("i",{className:Nx},Yy.createElement(px.G,{className:"preferences-screen__icon__IUXoU",icon:ux.NB})))}sP.propTypes={ariaLabel:sw().string,title:sw().string,onClick:sw().func,selected:sw().bool},aP.propTypes={onClick:sw().func};const lP=new Map([[1,QM],[4,JM],[2,$M],[3,GM],[5,XM],[6,UM]]);function cP(e){let{itemProps:t,store:n,setValue:i}=e;const r=lP.get(t.prefType);return Yy.createElement(r,FM({store:n,storeKey:t.key,setValue:i},t))}function dP(e,t){let{name:n,items:i}=e;return Yy.createElement("div",{key:`section-${t}`,className:"preferences-screen__section__EydJA"},n&&Yy.createElement("div",{className:"preferences-screen__section-title__J4cDt"},n),i)}cP.propTypes={itemProps:sw().object,store:sw().object,setValue:sw().func,disabled:sw().bool},dP.propTypes={name:sw().string,items:sw().node.isRequired};class uP extends Yy.Component{render(){const{children:e}=this.props;return Yy.createElement("div",{className:"preferences-screen__nav-container__JV3iZ"},Yy.createElement("div",{className:lw()("preferences-screen__nav__KROCu")},e))}}uP.propTypes={children:sw().node.isRequired,selected:sw().number};class hP extends Yy.Component{constructor(){super(),this.ref=Yy.createRef()}componentDidMount(){this.props.reportHeight(window.getComputedStyle(this.ref.current).height)}render(){return Yy.createElement("div",{ref:this.ref,className:"preferences-screen__toast__l7Z5F"},Yy.createElement("div",{className:jx},Yy.createElement(HM,null),Yy.createElement("div",{className:"preferences-screen__refresh-prompt__pwOTs"},Yy.createElement(uw.Z,{id:"preferences-screen.prompt-for-refresh",defaultMessage:"Your preferences are saved, but some of your changes will not take effect until you refresh the page."})),Yy.createElement("div",{className:"preferences-screen__warn-icon-placeholder__rMpBA"})),Yy.createElement("button",{className:"preferences-screen__refresh-now-button__ZxJGS",onClick:()=>{const e=location.href;location.href=e}},Yy.createElement(uw.Z,{id:"preferences-screen.refresh-now",defaultMessage:"Refresh Now"})))}}hP.propTypes={reportHeight:sw().func};class pP extends Yy.Component{constructor(){super(),this.onMediaDevicesUpdated=()=>{const e=this.mediaDevicesManager.selectedSpeakersDeviceId;this.props.store.state.preferences.preferredSpeakers!==e&&this.props.store.update({preferences:{preferredSpeakers:e}}),this.updateMediaDevices()},this.updateMediaDevices=()=>{const e=this.mediaDevicesManager.micDevicesOptions.map((e=>({value:e.value,text:e.label}))),t=FM({},this.state.preferredMic);t.options=e,t.disabled=!this.state.canVoiceChat;const n=this.mediaDevicesManager.outputDevicesOptions.map((e=>({value:e.value,text:e.label}))),i=FM({},this.state.preferredSpeakers);i.options=(null==n?void 0:n.length)>0?n:[{value:"none",text:"None"}],i.disabled=!this.state.canVoiceChat&&this.mediaDevicesManager.getPermissionsStatus(Be.SPEAKERS)!==Fe.GRANTED;const r=this.mediaDevicesManager.videoDevicesOptions.map((e=>({value:e.value,text:e.label}))),o=FM({},this.state.preferredCamera);o.options=[{value:"user",text:this.props.intl.formatMessage({id:"preferences-screen.preferred-camera.user-facing",defaultMessage:"User-Facing"})},{value:"environment",text:this.props.intl.formatMessage({id:"preferences-screen.preferred-camera.environment",defaultMessage:"Environment"})},{value:"default",text:this.props.intl.formatMessage({id:"preferences-screen.preferred-camera.default",defaultMessage:"Default"})}],o.options.push(...r),this.setState({preferredMic:t,preferredSpeakers:i,preferredCamera:o})},this.storeUpdated=this.storeUpdated.bind(this),this.permissionsUpdated=this.permissionsUpdated.bind(this);const e=APP.hubChannel.can("voice_chat");this.mediaDevicesManager=APP.mediaDevicesManager,this.state=FM(FM({category:0,toastHeight:"150px",preferredMic:{key:"preferredMic",prefType:2,options:[{value:"none",text:"None"}],disabled:!e},preferredCamera:{key:"preferredCamera",prefType:2,options:[{value:"none",text:"None"}]}},Gx.isAudioOutputSelectEnabled&&{preferredSpeakers:{key:"preferredSpeakers",prefType:2,options:[{value:"none",text:"None"}]}}),{},{canVoiceChat:e})}componentDidMount(){this.props.store.addEventListener("statechanged",this.storeUpdated),this.mediaDevicesManager.on(Ne.DEVICE_CHANGE,this.onMediaDevicesUpdated),APP.hubChannel.addEventListener("permissions_updated",this.permissionsUpdated),this.state.canVoiceChat&&!D()?this.mediaDevicesManager.startMicShare({updatePrefs:!1}).then(this.updateMediaDevices):this.updateMediaDevices()}componentWillUnmount(){this.props.store.removeEventListener("statechanged",this.storeUpdated),this.mediaDevicesManager.off(Ne.DEVICE_CHANGE,this.onMediaDevicesUpdated),APP.hubChannel.removeEventListener("permissions_updated",this.permissionsUpdated)}permissionsUpdated(){this.setState({canVoiceChat:APP.hubChannel.can("voice_chat")}),this.updateMediaDevices()}storeUpdated(){const{preferredMic:e}=this.props.store.state.preferences;e!==this.mediaDevicesManager.selectedMicDeviceId&&this.state.canVoiceChat&&this.mediaDevicesManager.startMicShare({updatePrefs:!1}).then(this.updateMediaDevices)}createSections(){const e=this.props.intl,t=e.formatMessage({id:"preferences-screen.browser-default",defaultMessage:"Browser Default"}),n=[{value:"browser",text:t}];for(const e in o)n.push({value:e,text:o[e]});const i=[{value:null,text:t}];for(const{id:e,name:t}of ut)i.push({value:e,text:t});const r=new Map([[4,[{key:"enableOnScreenJoystickLeft",prefType:1},{key:"enableOnScreenJoystickRight",prefType:1},{key:"enableGyro",prefType:1},{key:"invertTouchscreenCameraMove",prefType:1}]],[3,[{key:"snapRotationDegrees",prefType:3,min:0,max:90,step:5,digits:0},{key:"disableMovement",prefType:1},{key:"disableBackwardsMovement",prefType:1},{key:"disableStrafing",prefType:1},{key:"disableTeleporter",prefType:1},{key:"movementSpeedModifier",prefType:3,min:0,max:2,step:.1,digits:1}]],[0,[...this.state.canVoiceChat?[]:[{key:"voiceChatPinnedMessage",prefType:6,componentType:LM,permission:"voice_chat"}],...Gx.isAudioInputSelectEnabled&&!D()?[this.state.preferredMic]:[],...Gx.isAudioOutputSelectEnabled?[this.state.preferredSpeakers]:[],{key:"globalVoiceVolume",prefType:3,min:0,max:VM,step:5,digits:0},{key:"globalMediaVolume",prefType:3,min:0,max:VM,step:5,digits:0},{key:"globalSFXVolume",prefType:3,min:0,max:200,step:5,digits:0},{key:"avatarVoiceLevels",prefType:5,defaultValue:0,text:e.formatMessage({id:"preferences-screen.preference.avatar-volumes.entries",defaultMessage:"Entries"})},{key:"disableSoundEffects",prefType:1},{key:"disableEchoCancellation",prefType:1,promptForRefresh:!0},{key:"disableNoiseSuppression",prefType:1,promptForRefresh:!0},{key:"disableAutoGainControl",prefType:1,promptForRefresh:!0},{key:"enableAudioClipping",prefType:1},{key:"audioClippingThreshold",prefType:3,min:0,max:.1,step:.001,digits:3},{key:"showAudioDebugPanel",prefType:1},{key:"audioPanningQuality",prefType:2,options:[{value:"High",text:e.formatMessage({id:"preferences-screen.audio-panning-quality.high",defaultMessage:"High"})},{value:"Low",text:e.formatMessage({id:"preferences-screen.audio-panning-quality.low",defaultMessage:"Low"})}]}]],[2,[{key:"locale",prefType:2,options:n},{key:"theme",prefType:2,options:i},...D()?[]:[{key:"nametagVisibility",prefType:2,options:[{value:"showAll",text:e.formatMessage({id:"preferences-screen.nametag-visibility.show-all",defaultMessage:"Always"})},{value:"showNone",text:e.formatMessage({id:"preferences-screen.nametag-visibility.show-none",defaultMessage:"Never"})},{value:"showFrozen",text:e.formatMessage({id:"preferences-screen.nametag-visibility.show-frozen",defaultMessage:"Only in Frozen state"})},{value:"showSpeaking",text:e.formatMessage({id:"preferences-screen.nametag-visibility.show-speaking",defaultMessage:"Only speaking"})},{value:"showClose",text:e.formatMessage({id:"preferences-screen.nametag-visibility.show-close",defaultMessage:"Close to me"})}]},{key:"nametagVisibilityDistance",prefType:3,min:1,max:20,step:1,digits:2}],this.state.preferredCamera,{key:"allowMultipleHubsInstances",prefType:1},{key:"disableIdleDetection",prefType:1},{key:"lazyLoadSceneMedia",prefType:1},{key:"preferMobileObjectInfoPanel",prefType:1},{key:"animateWaypointTransitions",prefType:1},{key:"showFPSCounter",prefType:1},{key:"showRtcDebugPanel",prefType:1},{key:"cursorSize",prefType:3,min:1,max:5,step:.5,digits:1}]],[5,[{key:"disableLeftRightPanning",prefType:1}]],[6,[{key:"maxResolution",prefType:4},{key:"materialQualitySetting",prefType:2,options:[{value:"low",text:e.formatMessage({id:"preferences-screen.material-quality-setting.low",defaultMessage:"Low"})},{value:"medium",text:e.formatMessage({id:"preferences-screen.material-quality-setting.medium",defaultMessage:"Medium"})},{value:"high",text:e.formatMessage({id:"preferences-screen.material-quality-setting.high",defaultMessage:"High"})}],promptForRefresh:!0},{key:"enableDynamicShadows",prefType:1},{key:"disableAutoPixelRatio",prefType:1},{key:"enablePostEffects",prefType:1,hidden:AFRAME.utils.device.isMobileVR(),tooltipKey:"enablePostEffectsTooltip",promptForRefresh:!0},{key:"enableBloom",prefType:1,hidden:AFRAME.utils.device.isMobileVR(),disableIfFalse:"enablePostEffects",promptForRefresh:!0},{key:"aaMode",prefType:2,hidden:AFRAME.utils.device.isMobileVR(),disableIfFalse:"enablePostEffects",promptForRefresh:!0,options:[{value:He.NONE,text:e.formatMessage({id:"preferences-screen.aa-mode.none",defaultMessage:"none"})},{value:He.SMAA,text:e.formatMessage({id:"preferences-screen.aa-mode.smaa",defaultMessage:"SMAA"})},{value:He.MSAA_2X,text:e.formatMessage({id:"preferences-screen.aa-mode.msaa_2x",defaultMessage:"2x MSAA"})},{value:He.MSAA_4X,text:e.formatMessage({id:"preferences-screen.aa-mode.msaa_4x",defaultMessage:"4x MSAA"})},{value:He.MSAA_8X,text:e.formatMessage({id:"preferences-screen.aa-mode.msaa_8x",defaultMessage:"8x MSAA"})}]}]]]),s=e=>function(e,t){return e.hidden?null:Yy.createElement(iP,{key:e.key,itemProps:e,store:t,storeKey:e.key,setValue:n=>{e.promptForRefresh?t.update({preferences:{[e.key]:n,shouldPromptForRefresh:!0}}):t.update({preferences:{[e.key]:n}})},onChanged:e.onChanged,disabled:e.disabled})}(e,this.props.store),a=new Map;for(const[e,t]of r)a.set(e,t.map(s).filter((e=>!!e)));return new Map([[0,[{items:a.get(0)},{name:e.formatMessage(oP[5]),items:a.get(5)}]],[1,[{name:e.formatMessage(oP[3]),items:a.get(3)},{name:e.formatMessage(oP[4]),items:a.get(4)}]],[2,[{items:a.get(2)},{name:e.formatMessage(oP[6]),items:a.get(6)}]]])}render(){const e=this.props.intl,t=this.props.store.state.preferences.shouldPromptForRefresh;return Yy.createElement("div",{className:lw()("preferences-screen__preferences-panel__POWVM")},t&&Yy.createElement(hP,{reportHeight:e=>{this.setState({toastHeight:e})}}),Yy.createElement(aP,{onClick:this.props.onClose}),Yy.createElement(uP,{selected:this.state.category},rP.map((t=>Yy.createElement(sP,{key:`category-${t}-header`,title:e.formatMessage(oP[t]),onClick:()=>{this.setState({category:t})},ariaLabel:e.formatMessage({id:"preferences-screen.select-category ",defaultMessage:"Select category {categoryName}"},{categoryName:e.formatMessage(oP[t])}),selected:t===this.state.category})))),Yy.createElement("div",{className:"preferences-screen__content-container__ab7sK"},Yy.createElement("div",{className:"preferences-screen__scrolling-content__QX5E3"},this.createSections().get(this.state.category).map(dP),t&&Yy.createElement("div",{style:{width:"100%",minHeight:`${this.state.toastHeight}`}}))))}}pP.propTypes={intl:sw().object,onClose:sw().func,store:sw().object,scene:sw().object};var mP,fP,gP,vP,bP,yP,wP,_P=(0,V_.ZP)(pP),EP={"presence-log":"presence-log__presence-log__N2qcN",presenceLog:"presence-log__presence-log__N2qcN","presence-log-entry":"presence-log__presence-log-entry__B1Gmn",presenceLogEntry:"presence-log__presence-log-entry__B1Gmn","no-default-button-style":"presence-log__no-default-button-style__SFuhd",noDefaultButtonStyle:"presence-log__no-default-button-style__SFuhd","message-body":"presence-log__message-body__EuHp_",messageBody:"presence-log__message-body__EuHp_","message-source":"presence-log__message-source__wGuLz",messageSource:"presence-log__message-source__wGuLz","message-body-multi":"presence-log__message-body-multi__uaZ1g",messageBodyMulti:"presence-log__message-body-multi__uaZ1g","message-body-mono":"presence-log__message-body-mono__woLab",messageBodyMono:"presence-log__message-body-mono__woLab","message-wrap":"presence-log__message-wrap__u8cOw",messageWrap:"presence-log__message-wrap__u8cOw","message-wrap-multi":"presence-log__message-wrap-multi__RPiQs",messageWrapMulti:"presence-log__message-wrap-multi__RPiQs","message-source-link":"presence-log__message-source-link__Zfm2J",messageSourceLink:"presence-log__message-source-link__Zfm2J","icon-button":"presence-log__icon-button___bvVv",iconButton:"presence-log__icon-button___bvVv","spawn-message":"presence-log__spawn-message__UaMSn",spawnMessage:"presence-log__spawn-message__UaMSn",share:"presence-log__share__gExy1",media:"presence-log__media__aJYo6",mediaBody:"presence-log__mediaBody__qwTs6",permission:"presence-log__permission__JdR6h",permissionBody:"presence-log__permissionBody__joEmt",expired:"presence-log__expired__bAkfz","presence-log-entry-with-button":"presence-log__presence-log-entry-with-button__fVJLP",presenceLogEntryWithButton:"presence-log__presence-log-entry-with-button__fVJLP","presence-log-in-room":"presence-log__presence-log-in-room__PDH5T",presenceLogInRoom:"presence-log__presence-log-in-room__PDH5T","presence-log-spawn":"presence-log__presence-log-spawn__DNGWz",presenceLogSpawn:"presence-log__presence-log-spawn__DNGWz","presence-log-entry-one-line":"presence-log__presence-log-entry-one-line__wy36n",presenceLogEntryOneLine:"presence-log__presence-log-entry-one-line__wy36n","presence-log-emoji":"presence-log__presence-log-emoji__KfOnt",presenceLogEmoji:"presence-log__presence-log-emoji__KfOnt","presence-log-notifications":"presence-log__presence-log-notifications__ZesZf",presenceLogNotifications:"presence-log__presence-log-notifications__ZesZf",emoji:"presence-log__emoji__i7U3Q"};function AP(){return AP=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},AP.apply(this,arguments)}const SP=e=>{let{title:t,titleId:n,...i}=e;return Yy.createElement("svg",AP({width:20,height:20,viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":n},i),t?Yy.createElement("title",{id:n},t):null,mP||(mP=Yy.createElement("path",{d:"M7.838 5.213 5.213 7.838l3.052 3.052 2.625-2.625-3.053-3.052Z",fill:"currentColor"})),fP||(fP=Yy.createElement("path",{d:"m11.774 9.149-2.625 2.625 6.945 6.976 2.656-2.656-6.976-6.945Z",fill:"currentColor"})),gP||(gP=Yy.createElement("path",{d:"M4.375 6.875H1.25v1.25h3.125v-1.25Z",fill:"currentColor"})),vP||(vP=Yy.createElement("path",{d:"m3.525 2.642-.883.884 2.21 2.21.883-.884-2.21-2.21Z",fill:"currentColor"})),bP||(bP=Yy.createElement("path",{d:"M8.125 1.25h-1.25v3.125h1.25V1.25Z",fill:"currentColor"})),yP||(yP=Yy.createElement("path",{d:"m11.48 2.643-2.21 2.21.884.883 2.21-2.21-.884-.883Z",fill:"currentColor"})),wP||(wP=Yy.createElement("path",{d:"m4.851 9.27-2.21 2.21.884.884 2.21-2.21-.884-.883Z",fill:"currentColor"})))};var xP;function MP(){return MP=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},MP.apply(this,arguments)}const PP=e=>{let{title:t,titleId:n,...i}=e;return Yy.createElement("svg",MP({width:20,height:20,viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":n},i),t?Yy.createElement("title",{id:n},t):null,xP||(xP=Yy.createElement("path",{d:"m18.617 8.871-.007-.003-16.682-6.92a.92.92 0 0 0-.868.085.963.963 0 0 0-.435.804v4.426a.937.937 0 0 0 .762.92l9.1 1.683a.157.157 0 0 1 0 .307l-9.1 1.682a.937.937 0 0 0-.762.92v4.426a.921.921 0 0 0 .414.77.936.936 0 0 0 .888.08l16.682-6.88.008-.003a1.25 1.25 0 0 0 0-2.297Z",fill:"currentColor"})))};var CP,kP,OP,TP;function RP(){return RP=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},RP.apply(this,arguments)}const DP=e=>{let{title:t,titleId:n,...i}=e;return Yy.createElement("svg",RP({width:20,height:20,viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":n},i),t?Yy.createElement("title",{id:n},t):null,CP||(CP=Yy.createElement("path",{d:"M7.188 10a.937.937 0 1 0 0-1.875.937.937 0 0 0 0 1.875Z",fill:"currentColor"})),kP||(kP=Yy.createElement("path",{d:"M10.002 15.001c-1.774 0-3.266-1.153-3.739-2.728a.312.312 0 0 1 .306-.397h6.863a.314.314 0 0 1 .311.254.311.311 0 0 1-.006.143c-.468 1.575-1.96 2.728-3.735 2.728Z",fill:"currentColor"})),OP||(OP=Yy.createElement("path",{d:"M12.813 10a.937.937 0 1 0 0-1.875.937.937 0 0 0 0 1.875Z",fill:"currentColor"})),TP||(TP=Yy.createElement("path",{d:"M10 18.125a8.125 8.125 0 1 0 0-16.25 8.125 8.125 0 0 0 0 16.25Z",stroke:"currentColor",strokeWidth:1.5,strokeMiterlimit:10})))};var jP=n(8514);const LP=["className"];function IP(){return IP=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},IP.apply(this,arguments)}const NP=(0,Yy.forwardRef)(((e,t)=>{let{className:n}=e,i=function(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}(e,LP);return Yy.createElement(__,IP({className:lw()("TextAreaInput__textarea__y2MAr",n)},i,{as:jP.Z,ref:t}))}));NP.propTypes={className:sw().string},NP.displayName="TextAreaInput";var FP={"toolbar-button":"ToolbarButton__toolbar-button__KIJB6",toolbarButton:"ToolbarButton__toolbar-button__KIJB6","icon-container":"ToolbarButton__icon-container__ZEf9E",iconContainer:"ToolbarButton__icon-container__ZEf9E",large:"ToolbarButton__large__YDjpA",basic:"ToolbarButton__basic__PsM2Y",transparent:"ToolbarButton__transparent___w9hR",selected:"ToolbarButton__selected__SxJqz",primary:"ToolbarButton__primary__J7WCr",accept:"ToolbarButton__accept__Hfn1R",cancel:"ToolbarButton__cancel__qYLZw",accent1:"ToolbarButton__accent1__dcxpI",accent2:"ToolbarButton__accent2__OuGAI",accent3:"ToolbarButton__accent3__JwDT5",accent4:"ToolbarButton__accent4__BXXtS",accent5:"ToolbarButton__accent5__bvBvH","status-indicator":"ToolbarButton__status-indicator__Zgtiz",statusIndicator:"ToolbarButton__status-indicator__Zgtiz","status-enabled":"ToolbarButton__status-enabled__cSFwX",statusEnabled:"ToolbarButton__status-enabled__cSFwX","status-disabled":"ToolbarButton__status-disabled__djo6Z",statusDisabled:"ToolbarButton__status-disabled__djo6Z","status-unread":"ToolbarButton__status-unread__HdEKL",statusUnread:"ToolbarButton__status-unread__HdEKL","status-recording":"ToolbarButton__status-recording__JMGuh",statusRecording:"ToolbarButton__status-recording__JMGuh",left:"ToolbarButton__left__xOpwY",middle:"ToolbarButton__middle__h7pkJ",right:"ToolbarButton__right__e8lxT"};const BP=["preset","className","iconContainerClassName","children","icon","label","title","selected","large","statusColor","type","disabled"];function VP(){return VP=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},VP.apply(this,arguments)}const UP=(0,Yy.forwardRef)(((e,t)=>{let{preset:n,className:i,iconContainerClassName:r,children:o,icon:s,label:a,title:l,selected:c,large:d,statusColor:u,type:h,disabled:p}=e,m=function(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}(e,BP);return Yy.createElement("button",VP({ref:t,className:lw()(FP.toolbarButton,FP[n],FP[h],{[FP.selected]:c,[FP.large]:d},i),disabled:p,title:l},m),Yy.createElement("div",{className:lw()(FP.iconContainer,r),disabled:p,"aria-hidden":"true"},s,u&&Yy.createElement("div",{className:lw()(FP.statusIndicator,FP["status-"+u])}),o),a&&Yy.createElement("label",{disabled:p},a))}));UP.propTypes={icon:sw().node,label:sw().node,selected:sw().bool,preset:sw().oneOf(["basic","transparent","accept","cancel","accent1","accent2","accent3","accent4","accent5"]),statusColor:sw().oneOf(["recording","unread","enabled","disabled"]),className:sw().string,iconContainerClassName:sw().string,children:sw().node,type:sw().oneOf(["none","left","middle","right"]),large:sw().bool,disabled:sw().bool,title:sw().node},UP.defaultProps={preset:"basic",disabled:!1},UP.displayName="ToolbarButton";var HP=n(86770),zP={popover:"Popover__popover__TDiHP",content:"Popover__content__yKFMS",arrow:"Popover__arrow__adu2d",header:"Popover__header__GLZCv","arrow-bg":"Popover__arrow-bg__J95GS",arrowBg:"Popover__arrow-bg__J95GS","arrow-border":"Popover__arrow-border__CRbKU",arrowBorder:"Popover__arrow-border__CRbKU",fullscreen:"Popover__fullscreen__pXsPm","fullscreen-body":"Popover__fullscreen-body__Lu_fI",fullscreenBody:"Popover__fullscreen-body__Lu_fI"},WP=n(64799);function qP(){return qP=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},qP.apply(this,arguments)}function ZP(e){let{arrowClass:t}=e;return Yy.createElement("svg",{width:"25",height:"11",viewBox:"0 0 25 11",fill:"none",xmlns:"http://www.w3.org/2000/svg"},Yy.createElement("path",{d:"M1 1L11.1176 9.51209C11.8908 10.1626 13.1092 10.1626 13.8824 9.51209L24 1",strokeWidth:"2",className:lw()(zP.arrowBg,t)}),Yy.createElement("path",{d:"M11.1176 9.51209L1 1H24L13.8824 9.51209C13.1092 10.1626 11.8908 10.1626 11.1176 9.51209Z",className:lw()(zP.arrowBorder,t)}),Yy.createElement("path",{d:"M0 1H25",strokeWidth:"2",className:lw()(zP.arrowBg,t)}))}function GP(e){let{content:t,children:n,title:i,showHeader:r,placement:o,offsetSkidding:s,offsetDistance:a,initiallyVisible:l,disableFullscreen:c,isVisible:d,onChangeVisible:u,popoverApiRef:h,popoverClass:p,arrowClass:m}=e;const[f,g]=(0,Yy.useState)(l),v=void 0===d?f:d,b=u||g,[y,w]=(0,Yy.useState)(null),[_,E]=(0,Yy.useState)(null),[A,S]=(0,Yy.useState)(null),{styles:{popper:x,arrow:M},attributes:P}=(0,HP.D)(y,_,{placement:o,modifiers:[{name:"arrow",options:{element:A}},{name:"offset",options:{offset:[s,a]}}]}),C=(0,WP.P)(),k=!c&&("sm"===C||"md"===C),O=(0,Yy.useCallback)((()=>b(!0)),[b]),T=(0,Yy.useCallback)((()=>b(!1)),[b]),R=(0,Yy.useCallback)((()=>b((e=>!e))),[b]);return(0,Yy.useEffect)((()=>{h&&(h.current={openPopover:O,closePopover:T,togglePopover:R})}),[h,O,T,R]),(0,Yy.useEffect)((()=>{const e=e=>{y&&y.contains(e.target)||_&&_.contains(e.target)||b(!1)},t=e=>{"Escape"===e.key&&b(!1)};return v&&(window.addEventListener("mousedown",e),window.addEventListener("keydown",t)),()=>{window.removeEventListener("mousedown",e),window.removeEventListener("keydown",t)}}),[v,_,y,b]),(0,Yy.useEffect)((()=>(v&&k?document.body.classList.add(zP.fullscreenBody):document.body.classList.remove(zP.fullscreenBody),()=>{document.body.classList.remove(zP.fullscreenBody)})),[k,v]),Yy.createElement(Yy.Fragment,null,n({togglePopover:R,openPopover:O,closePopover:T,popoverVisible:v,triggerRef:w}),v&&(0,Gy.createPortal)(Yy.createElement("div",qP({ref:E,className:lw()(zP.popover,{[zP.fullscreen]:k},p),style:k?void 0:x},P.popper),r&&Yy.createElement("div",{className:zP.header},Yy.createElement(Ww,{onClick:T}),Yy.createElement("h5",null,i)),Yy.createElement("div",{className:zP.content},"function"==typeof t?Yy.createElement(t,{fullscreen:k,closePopover:T}):t),!k&&Yy.createElement("div",{ref:S,className:zP.arrow,style:M},Yy.createElement(ZP,{arrowClass:m}))),document.body))}ZP.propTypes={arrowClass:sw().string},GP.propTypes={initiallyVisible:sw().bool,placement:sw().string,title:sw().node.isRequired,children:sw().func.isRequired,content:sw().oneOfType([sw().func,sw().node]),disableFullscreen:sw().bool,popoverApiRef:sw().object,popoverClass:sw().string,showHeader:sw().bool,offsetSkidding:sw().number,offsetDistance:sw().number,isVisible:sw().bool,onChangeVisible:sw().func,arrowClass:sw().string},GP.defaultProps={initiallyVisible:!1,placement:"auto",offsetSkidding:0,offsetDistance:8,showHeader:!0};var YP=n(36829);function QP(){return QP=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},QP.apply(this,arguments)}const XP={16:n.p+"assets/images/emoji-picker-16-c95bdf7f975871bbdaa9..png",20:n.p+"assets/images/emoji-picker-20-b57ba6059cd6dd5c359b..png",32:n.p+"assets/images/emoji-picker-32-0a29b0fe8c7c86dc18e8..png",64:n.p+"assets/images/emoji-picker-64-1f092ae5131a49cf2c29..png"};function KP(e){return Yy.createElement(YP.cW,QP({title:"Pick an emoji!",color:"var(--tab-highlight-color)",backgroundImageFn:(e,t)=>XP[t]},e))}var $P={"chat-input-container":"ChatSidebar__chat-input-container__qF2Zv",chatInputContainer:"ChatSidebar__chat-input-container__qF2Zv","message-list":"ChatSidebar__message-list__Q_K_C",messageList:"ChatSidebar__message-list__Q_K_C","message-group":"ChatSidebar__message-group__wD2L8",messageGroup:"ChatSidebar__message-group__wD2L8","message-group-label":"ChatSidebar__message-group-label__gTBLt",messageGroupLabel:"ChatSidebar__message-group-label__gTBLt","message-group-messages":"ChatSidebar__message-group-messages__MOpe3",messageGroupMessages:"ChatSidebar__message-group-messages__MOpe3","message-bubble":"ChatSidebar__message-bubble__sAPXL",messageBubble:"ChatSidebar__message-bubble__sAPXL",sent:"ChatSidebar__sent__jodlK",emoji:"ChatSidebar__emoji__kotP2",media:"ChatSidebar__media__wLlyB",monospace:"ChatSidebar__monospace__yFz0r","system-message":"ChatSidebar__system-message__ujKWH",systemMessage:"ChatSidebar__system-message__ujKWH",permission:"ChatSidebar__permission__IBr4S","chat-input-icon":"ChatSidebar__chat-input-icon__sTSAw",chatInputIcon:"ChatSidebar__chat-input-icon__sTSAw","chat-input-warning":"ChatSidebar__chat-input-warning__OzrS4",chatInputWarning:"ChatSidebar__chat-input-warning__OzrS4","warning-border":"ChatSidebar__warning-border__KeF28",warningBorder:"ChatSidebar__warning-border__KeF28","warning-text-color":"ChatSidebar__warning-text-color__wNwfr",warningTextColor:"ChatSidebar__warning-text-color__wNwfr","chat-input-text-area-styles":"ChatSidebar__chat-input-text-area-styles__oPn7w",chatInputTextAreaStyles:"ChatSidebar__chat-input-text-area-styles__oPn7w"},JP=n(44778),eC=n(95872);const tC=/(?:[\u2700-\u27bf]|(?:\ud83c[\udde6-\uddff]){2}|[\ud800-\udbff][\udc00-\udfff]|[\u0023-\u0039]\ufe0f?\u20e3|\u3299|\u3297|\u303d|\u3030|\u24c2|\ud83c[\udd70-\udd71]|\ud83c[\udd7e-\udd7f]|\ud83c\udd8e|\ud83c[\udd91-\udd9a]|\ud83c[\udde6-\uddff]|[\ud83c[\ude01-\ude02]|\ud83c\ude1a|\ud83c\ude2f|[\ud83c[\ude32-\ude3a]|[\ud83c[\ude50-\ude51]|\u203c|\u2049|[\u25aa-\u25ab]|\u25b6|\u25c0|[\u25fb-\u25fe]|\u00a9|\u00ae|\u2122|\u2139|\ud83c\udc04|[\u2600-\u26FF]|\u2b05|\u2b06|\u2b07|\u2b1b|\u2b1c|\u2b50|\u2b55|\u231a|\u231b|\u2328|\u23cf|[\u23e9-\u23f3]|[\u23f8-\u23fa]|\ud83c\udccf|\u2934|\u2935|[\u2190-\u21ff])/,nC=750;function iC(e,t){let{emojiClassName:n}=void 0===t?{}:t;const i=e.length>=nC?nC:e.length,r=e.startsWith("`")&&e.endsWith("`"),o=(r?e.substring(1,i-1):e.substring(0,i)).trim(),s=o.split("\n").map(((e,t)=>Yy.createElement("p",{key:t},Yy.createElement(JP.ZP,{properties:{target:"_blank",rel:"noopener referrer"}},(0,eC.qo)(e,{className:n}))))),a=s.length>1;let l=!1;if(1===s.length){const e=(0,eC.qo)(o);l=1===e.length&&e[0].props&&e[0].props.children.match&&e[0].props.children.match(tC)}return{formattedBody:Yy.createElement(Yy.Fragment,null,s),multiline:a,monospace:r,emoji:l}}const rC=["warning","isOverMaxLength"],oC=["children"],sC=["onClose","children"];function aC(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function lC(){return lC=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},lC.apply(this,arguments)}function cC(e){return Yy.createElement(Iw,lC({className:$P.chatInputIcon},e),Yy.createElement(SP,null))}function dC(e){return Yy.createElement(Iw,lC({className:$P.chatInputIcon},e),Yy.createElement(PP,null))}const uC=Yy.memo((e=>{let{onSelectEmoji:t,disabled:n}=e;const i=(0,Yy.useRef)(!1);return(0,Yy.useEffect)((()=>{const e=e=>{"Shift"===e.key&&(i.current=!0)},t=e=>{"Shift"===e.key&&(i.current=!1)};return window.addEventListener("keydown",e),window.addEventListener("keyup",t),()=>{window.removeEventListener("keydown",e),window.removeEventListener("keyup",t)}}),[]),Yy.createElement(GP,{title:"",content:e=>{let{closePopover:n}=e;return Yy.createElement(KP,{onSelect:e=>{const r=i.current;t({emoji:e,pickerRemainedOpen:r}),r||n()}})},placement:"top",offsetDistance:28},(e=>{let{togglePopover:t,popoverVisible:i,triggerRef:r}=e;return Yy.createElement(Iw,{ref:r,className:$P.chatInputIcon,selected:i,onClick:t,disabled:n},Yy.createElement(DP,null))}))}));function hC(e){return Yy.createElement(Yy.Fragment,null,Yy.createElement(Iw,{as:"label",className:$P.chatInputIcon,disabled:e.disabled},Yy.createElement(HE,null),Yy.createElement("input",lC({type:"file"},e,{disabled:e.disabled}))))}function pC(e){let{messageLength:t,maxLength:n}=e;return Yy.createElement("p",{className:lw()($P.chatInputWarning,{[$P.warningTextColor]:t>n})},Yy.createElement(uw.Z,{id:"chat-message-input.warning-max-characters",defaultMessage:"Max characters"}),` (${t}/${n})`)}uC.propTypes={onSelectEmoji:sw().func.isRequired,disabled:sw().bool},uC.displayName="EmojiPickerPopoverButton",hC.propTypes={disabled:sw().bool},pC.propTypes={messageLength:sw().number,maxLength:sw().number};const mC=(0,Yy.forwardRef)(((e,t)=>{let{warning:n,isOverMaxLength:i}=e,r=aC(e,rC);const o=(0,FE.Z)();return Yy.createElement("div",{className:$P.chatInputContainer},Yy.createElement(NP,lC({ref:t,textInputStyles:$P.chatInputTextAreaStyles,className:lw()({[$P.warningBorder]:i}),placeholder:o.formatMessage({id:"chat-sidebar.input.placeholder",defaultMessage:"Message..."})},r)),n)}));mC.propTypes={onSpawn:sw().func,warning:sw().node,isOverMaxLength:sw().bool},mC.displayName="ChatInput";const fC=(0,gE.vU)({room:{id:"chat-sidebar.system-message.entered-room",defaultMessage:"{name} entered the room."},lobby:{id:"chat-sidebar.system-message.entered-lobby",defaultMessage:"{name} entered the lobby."}}),gC=(0,gE.vU)({lobby:{id:"chat-sidebar.system-message.joined-lobby",defaultMessage:"{name} joined the lobby."},room:{id:"chat-sidebar.system-message.joined-room",defaultMessage:"{name} joined the room."}}),vC="roomEntryRequired",bC="flyModeDisabled",yC="flyModeEnabled",wC="unauthorizedSceneChange",_C="invalidSceneUrl",EC="unauthorizedRoomRename",AC="captureUnavailable",SC="captureStopped",xC="captureStarted",MC="captureAlreadyStopped",PC="captureAlreadyRunning",CC="setAudioNormalizationFactor",kC="audioNormalizationDisabled",OC="audioNormalizationNaN",TC="invalidAudioNormalizationRange",RC="audioSuspended",DC="audioResumed",jC="avatarChanged",LC=(0,gE.vU)({[vC]:{id:"chat-sidebar.log-message.room-entry-required",defaultMessage:"You must enter the room to use this command."},[bC]:{id:"chat-sidebar.log-message.fly-mode-disabled",defaultMessage:"Fly mode disabled."},[yC]:{id:"chat-sidebar.log-message.fly-mode-enabled",defaultMessage:"Fly mode enabled."},[wC]:{id:"chat-sidebar.log-message.unauthorized-scene-change",defaultMessage:"You do not have permission to change the scene."},[_C]:{id:"chat-sidebar.log-message.invalid-scene-url",defaultMessage:"This URL does not point to a scene or valid GLB."},[EC]:{id:"chat-sidebar.log-message.unauthorized-room-rename",defaultMessage:"You do not have permission to rename this room."},[AC]:{id:"chat-sidebar.log-message.capture-unavailable",defaultMessage:"Capture unavailable."},[SC]:{id:"chat-sidebar.log-message.capture-stopped",defaultMessage:"Capture stopped."},[xC]:{id:"chat-sidebar.log-message.capture-started",defaultMessage:"Capture started."},[MC]:{id:"chat-sidebar.log-message.capture-already-stopped",defaultMessage:"Capture already stopped."},[PC]:{id:"chat-sidebar.log-message.capture-already-running",defaultMessage:"Capture already running."},positionalAudioEnabled:{id:"chat-sidebar.log-message.positional-audio-enabled",defaultMessage:"Positional audio enabled."},positionalAudioDisabled:{id:"chat-sidebar.log-message.positional-audio-disabled",defaultMessage:"Positional audio disabled."},[CC]:{id:"chat-sidebar.log-message.set-audio-normalization-factor",defaultMessage:"audioNormalization factor is set to {factor}."},[kC]:{id:"chat-sidebar.log-message.audio-normalization-disabled",defaultMessage:"audioNormalization is disabled."},[OC]:{id:"chat-sidebar.log-message.audio-normalization-nan",defaultMessage:"audioNormalization command needs a valid number parameter."},[TC]:{id:"chat-sidebar.log-message.invalid-audio-normalization-range",defaultMessage:"audioNormalization command needs a base volume number between 0 [no normalization] and 255. Default is 0. The recommended value is 4, if you would like to enable normalization."},[RC]:{id:"chat-sidebar.log-message.audio-suspended",defaultMessage:"Audio has been suspended, click somewhere in the room to resume the audio."},[DC]:{id:"chat-sidebar.log-message.audio-resumed",defaultMessage:"Audio has been resumed."},joinFailed:{id:"chat-sidebar.log-message.join-failed",defaultMessage:"Failed to join room: {message}"},[jC]:{id:"chat-sidebar.log-message.avatar-changed",defaultMessage:"Your avatar has been changed."}});function IC(e,t){switch(e.type){case"join":return t.formatMessage(gC[e.presence],{name:Yy.createElement("b",null,e.name)});case"entered":return t.formatMessage(fC[e.presence],{name:Yy.createElement("b",null,e.name)});case"leave":return Yy.createElement(uw.Z,{id:"chat-sidebar.system-message.leave",defaultMessage:"{name} left.",values:{name:Yy.createElement("b",null,e.name)}});case"display_name_changed":return Yy.createElement(uw.Z,{id:"chat-sidebar.system-message.name-change",defaultMessage:"{oldName} is now known as {newName}",values:{oldName:Yy.createElement("b",null,e.oldName),newName:Yy.createElement("b",null,e.newName)}});case"scene_changed":return Yy.createElement(uw.Z,{id:"chat-sidebar.system-message.scene-change",defaultMessage:"{name} changed the scene to {sceneName}",values:{name:Yy.createElement("b",null,e.name),sceneName:Yy.createElement("b",null,e.sceneName)}});case"hub_name_changed":return Yy.createElement(uw.Z,{id:"chat-sidebar.system-message.hub-name-change",defaultMessage:"{name} changed the name of the room to {hubName}",values:{name:Yy.createElement("b",null,e.name),hubName:Yy.createElement("b",null,e.hubName)}});case"hub_changed":return Yy.createElement(uw.Z,{id:"chat-sidebar.system-message.hub-change",defaultMessage:"You are now in {hubName}",values:{hubName:Yy.createElement("b",null,e.hubName)}});case"log":return t.formatMessage(LC[e.messageType],e.props);default:return null}}function NC(e){const t=(0,FE.Z)();return Yy.createElement("li",{className:lw()($P.messageGroup,$P.systemMessage)},e.showLineBreak&&Yy.createElement("hr",null),Yy.createElement("p",{className:$P.messageGroupLabel},Yy.createElement("i",null,IC(e,t)),Yy.createElement("span",null,Yy.createElement(OA.Z,{updateIntervalInSeconds:10,value:(e.timestamp-Date.now())/1e3}))))}function FC(e){let{media:t,monospace:n,emoji:i,children:r,permission:o}=e;return Yy.createElement("div",{className:lw()($P.messageBubble,{[$P.media]:t,[$P.emoji]:i,[$P.monospace]:n,[$P.permission]:o})},r)}function BC(e){let{sent:t,sender:n,timestamp:i,messages:r}=e;return(0,FE.Z)(),Yy.createElement("li",{className:lw()($P.messageGroup,{[$P.sent]:t})},Yy.createElement("p",{className:$P.messageGroupLabel},n," | ",Yy.createElement(OA.Z,{updateIntervalInSeconds:10,value:(i-Date.now())/1e3})),Yy.createElement("ul",{className:$P.messageGroupMessages},r.map((e=>function(e){switch(e.type){case"chat":{const{formattedBody:t,monospace:n,emoji:i}=iC(e.body);return Yy.createElement(FC,{key:e.id,monospace:n,emoji:i},t)}case"video":return Yy.createElement(FC,{key:e.id,media:!0},Yy.createElement("video",{controls:!0,src:e.body.src}));case"image":case"photo":case"permission":return Yy.createElement(FC,{key:e.id,media:!0},Yy.createElement("img",{src:e.body.src}));default:return null}}(e)))))}function VC(e){let{sent:t,timestamp:n,messages:i}=e;const r=(0,FE.Z)();return Yy.createElement("li",{className:lw()($P.messageGroup,{[$P.sent]:t})},Yy.createElement("p",{className:$P.messageGroupLabel},Yy.createElement(OA.Z,{updateIntervalInSeconds:10,value:(n-Date.now())/1e3})),Yy.createElement("ul",{className:$P.messageGroupMessages},i.map((e=>Yy.createElement(FC,{key:e.id,permission:!0},jM({permission:e.body.permission,status:e.body.status},r))))))}NC.propTypes={timestamp:sw().any,showLineBreak:sw().bool},FC.propTypes={media:sw().bool,monospace:sw().bool,emoji:sw().oneOfType([sw().bool,sw().array]),children:sw().node,permission:sw().bool},BC.propTypes={sent:sw().bool,sender:sw().string,timestamp:sw().any,messages:sw().array},VC.propTypes={sent:sw().bool,timestamp:sw().any,messages:sw().array};const UC=(0,Yy.forwardRef)(((e,t)=>{let{children:n}=e,i=aC(e,oC);return Yy.createElement("ul",lC({},i,{className:$P.messageList,ref:t}),n)}));function HC(e){let{onClose:t,children:n}=e,i=aC(e,sC);return Yy.createElement(Rw,lC({title:Yy.createElement(uw.Z,{id:"chat-sidebar.title",defaultMessage:"Chat"}),beforeTitle:Yy.createElement(Ww,{onClick:t}),contentClassName:$P.content,disableOverflowScroll:!0},i),n)}function zC(e){return Yy.createElement(UP,lC({},e,{icon:Yy.createElement(xM,null),preset:"accent4",label:Yy.createElement(uw.Z,{id:"chat-toolbar-button",defaultMessage:"Chat"})}))}UC.propTypes={children:sw().node},UC.displayName="ChatMessageList",HC.propTypes={onClose:sw().func,onScrollList:sw().func,children:sw().node,listRef:sw().func};var WC=n(46020),qC=n.n(WC),ZC=n(99477);function GC(e,t,n,i,r,o,s){try{var a=e[o](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(i,r)}function YC(e){return function(){var t=this,n=arguments;return new Promise((function(i,r){var o=e.apply(t,n);function s(e){GC(o,i,r,s,a,"next",e)}function a(e){GC(o,i,r,s,a,"throw",e)}s(void 0)}))}}const QC=new Ds,XC=1024,KC=(e,t,n,i,r)=>{const{formattedBody:o,multiline:s,monospace:a,emoji:l}=iC(e,{emojiClassName:r}),c=s?EP.messageWrapMulti:EP.messageWrap,d={[EP.messageBody]:!0,[EP.messageBodyMulti]:s,[EP.messageBodyMono]:a},u=i&&n&&history&&NAF.clientId!==n,h=u?()=>i(n):()=>{};return{content:Yy.createElement("div",{className:c},t&&Yy.createElement("div",{onClick:h,className:lw()({[EP.messageSource]:!0,[EP.messageSourceLink]:u})},t,":"),Yy.createElement("div",{className:lw()(d)},o)),multiline:s,emoji:l}};function $C(e,t,n){const{content:i,emoji:r,multiline:o}=KC(e,t,null,null,EP.emoji),s=n&&r,a=document.createElement("div");a.setAttribute("class",`${EP.presenceLog} ${EP.presenceLogSpawn}`),document.body.appendChild(a);const l=Yy.createElement("div",{className:lw()({[EP.presenceLogEntry]:!s,[EP.presenceLogEntryOneLine]:!s&&!o,[EP.presenceLogEmoji]:s})},i);return new Promise(((e,t)=>{Gy.render(l,a,(()=>{const n=a.offsetWidth,i=a.offsetHeight,r=i/n,o=XC*Math.min(1,1/r)/a.offsetWidth;qC()(a,{backgroundColor:null,scale:o,logging:!1}).then((t=>{t.toBlob((t=>e([t,n,i])),"image/png"),a.remove()})).catch(t)}))}))}function JC(){return JC=YC((function*(e){let{name:t,type:n,body:i}=e;if("chat"!==n)return;const[r,o,s]=yield $C(i,t,!1),a=document.createElement("a-entity"),l=document.createElement("a-entity");document.querySelector("a-scene").appendChild(a),a.appendChild(l),a.setAttribute("class","ui"),a.setAttribute("is-remote-hover-target",{}),a.setAttribute("follow-in-fov",{target:"#avatar-pov-node",offset:{x:0,y:0,z:-.8}});const c=URL.createObjectURL(r);l.setAttribute("animation__float",{property:"position",dur:1e4,from:{x:0,y:0,z:0},to:{x:0,y:.05,z:-.05},easing:"easeOutQuad"}),a.setAttribute("animation__spawn",{property:"scale",dur:200,from:{x:.1,y:.1,z:.1},to:{x:1,y:1,z:1},easing:"easeOutElastic"}),l.setAttribute("animation__opacity",{property:"meshMaterial.opacity",isRawProperty:!0,delay:3e3,dur:8e3,from:1,to:0,easing:"easeInQuad"}),l.addEventListener("animationcomplete__opacity",(()=>{a.parentNode.removeChild(a)})),QC.load(c,(e=>{const t=new ZC.MeshBasicMaterial;t.transparent=!0,t.map=e,t.generateMipmaps=!1,t.needsUpdate=!0;const n=Bo(1,1,1,1,e.flipY),i=new ZC.Mesh(n,t);l.setObject3D("mesh",i),l.meshMaterial=t,l.object3DMap.mesh.scale.set(o/400,s/400,1)}))})),JC.apply(this,arguments)}function ek(e,t){return tk.apply(this,arguments)}function tk(){return(tk=YC((function*(e,t){if(0===e.length)return;try{if(new URL(Il(e)).host)return void document.querySelector("a-scene").emit("add_media",e)}catch(e){}const[n]=yield $C(e,t,!0);document.querySelector("a-scene").emit("add_media",new File([n],"message.png",{type:"image/png"}))}))).apply(this,arguments)}function nk(e){const{content:t}=KC(e.body,e.name,e.sessionId,e.onViewProfile);return Yy.createElement("div",{className:e.className},e.maySpawn&&Yy.createElement("button",{className:lw()(EP.iconButton,EP.spawnMessage),onClick:()=>ek(e.body)}),t)}function ik(e){let{name:t,body:{src:n},className:i,maySpawn:r,hubId:o}=e;const s=(0,FE.Z)(),a=function(e){const t=new URL(e);return ge(t.pathname.replace(".png",".html")+t.search,!0)}(n),l=Ew.bind(null,{url:a,title:s.formatMessage({id:"photo-message.default-tweet",defaultMessage:"Taken in {shareHashtag}"},{shareHashtag:k.translation("share-hashtag"),url:`https://${k.SHORTLINK_DOMAIN}/${o}`})});return Yy.createElement("div",{className:i},r&&Yy.createElement("button",{className:lw()(EP.iconButton,EP.share),onClick:l}),Yy.createElement("div",{className:EP.mediaBody},Yy.createElement(uw.Z,{id:"photo-message.body",defaultMessage:"{name} took a <a>photo</a>.",values:{name:Yy.createElement("b",null,t),a:e=>Yy.createElement("b",null,Yy.createElement("a",{href:a,target:"_blank",rel:"noopener noreferrer"},e))}})),Yy.createElement("a",{href:a,target:"_blank",rel:"noopener noreferrer"},Yy.createElement("img",{src:n})))}function rk(e){let{name:t,body:{src:n},className:i,maySpawn:r,hubId:o}=e;const s=(0,FE.Z)(),a=Ew.bind(null,{url:n,title:s.formatMessage({id:"video-message.default-tweet",defaultMessage:"Taken in {shareHashtag}"},{shareHashtag:k.translation("share-hashtag"),url:`https://${k.SHORTLINK_DOMAIN}/${o}`})});return Yy.createElement("div",{className:i},r&&Yy.createElement("button",{className:lw()(EP.iconButton,EP.share),onClick:a}),Yy.createElement("div",{className:EP.mediaBody},Yy.createElement(uw.Z,{id:"video-message.body",defaultMessage:"{name} took a <a>video</a>.",values:{name:Yy.createElement("b",null,t),a:e=>Yy.createElement("b",null,Yy.createElement("a",{href:n,target:"_blank",rel:"noopener noreferrer"},e))}})))}function ok(e){let{name:t,body:{src:n},className:i,maySpawn:r}=e;return Yy.createElement("div",{className:i},r&&Yy.createElement("button",{className:lw()(EP.iconButton,EP.spawnMessage),onClick:()=>function(e){document.querySelector("a-scene").emit("add_media",e)}(n)}),Yy.createElement("div",{className:EP.mediaBody},t&&Yy.createElement("div",{className:EP.messageSource},t,":")),Yy.createElement("a",{href:n,target:"_blank",rel:"noopener noreferrer"},Yy.createElement("img",{src:zs(n)})))}function sk(e){let{body:{status:t,permission:n},className:i,isMod:r}=e;const o=jM({status:t,permission:n,isMod:r},(0,FE.Z)());return Yy.createElement("div",{className:i},Yy.createElement("div",{className:EP.permissionBody},o))}function ak(e,t){var n,i;void 0===t&&(t=NAF.clientId);const r=AFRAME.scenes[0],[o,s]=(0,Yy.useState)(null===(n=APP.hubChannel.presence)||void 0===n||null===(i=n.state[t])||void 0===i?void 0:i.metas[0].roles[e]);return(0,Yy.useEffect)((()=>{const n=n=>{let{detail:i}=n;i.sessionId===t&&s(i.roles[e])};return r.addEventListener("presence_updated",n),()=>{r.removeEventListener("presence_updated",n)}}),[r,e,s,t]),o}nk.propTypes={name:sw().string,maySpawn:sw().bool,body:sw().string,sessionId:sw().string,className:sw().string,onViewProfile:sw().func},ik.propTypes={name:sw().string,maySpawn:sw().bool,body:sw().object,className:sw().string,hubId:sw().string},rk.propTypes={name:sw().string,maySpawn:sw().bool,body:sw().object,className:sw().string,hubId:sw().string},ok.propTypes={name:sw().string,maySpawn:sw().bool,body:sw().object,className:sw().string},sk.propTypes={name:sw().string,body:sw().object,className:sw().string,isMod:sw().bool};const lk=["entries","preset","hubId","history","presences","onViewProfile","include","exclude"];function ck(){return ck=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},ck.apply(this,arguments)}function dk(e){let{entries:t,preset:n,hubId:i,history:r,presences:o,onViewProfile:s,include:a,exclude:l}=e,c=function(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}(e,lk);const d=(0,FE.Z)(),u=ak("owner");return Yy.createElement("div",ck({className:lw()(EP.presenceLog,EP["presenceLog"+n])},c),t.map((e=>{if(a&&!a.includes(e.type))return;if(l&&l.includes(e.type))return;const t={[EP.presenceLogEntry]:!0,[EP.presenceLogEntryWithButton]:("chat"===e.type||"image"===e.type)&&e.maySpawn,[EP.presenceLogChat]:"chat"===e.type,[EP.expired]:!!e.expired},c=e.sessionId?function(e,t){return(xe(e,t)||{}).context||{}}(o,e.sessionId):{},h=!!c.discord;switch(e.type){case"chat":return Yy.createElement(nk,{key:e.key,name:e.name,className:lw()(t),body:e.body,maySpawn:e.maySpawn,sessionId:e.sessionId,includeFromLink:"inRoom"===n&&!h,history:r,onViewProfile:s});case"image":return Yy.createElement(ok,{key:e.key,name:e.name,className:lw()(t,EP.media),body:e.body,maySpawn:e.maySpawn});case"photo":return Yy.createElement(ik,{key:e.key,name:e.name,className:lw()(t,EP.media),body:e.body,maySpawn:e.maySpawn,hubId:i});case"video":return Yy.createElement(rk,{key:e.key,name:e.name,className:lw()(t,EP.media),body:e.body,maySpawn:e.maySpawn,hubId:i});case"permission":return(!u||e.sessionId!==NAF.clientId)&&Yy.createElement(sk,{key:e.key,permission:e.body.permission,className:lw()(t,EP.permission),body:e.body,isMod:u&&e.sessionId===NAF.clientId});default:{const n=IC(e,d);return n&&Yy.createElement("div",{key:e.key,className:lw()(t)},Yy.createElement("div",null,n))}}})))}dk.propTypes={entries:sw().array,preset:sw().oneOf(["InRoom","Notifications"]),hubId:sw().string,history:sw().object,presences:sw().object,onViewProfile:sw().func,className:sw().string,children:sw().node,include:sw().array,exclude:sw().array};var uk="preload-overlay__screenshot__Xr31g";const hk=AFRAME.utils.device.isMobile();class pk extends Yy.Component{render(){const e=Yy.createElement(uw.Z,{id:"preload-overlay.load-button",defaultMessage:"Load Room"});return Yy.createElement("div",{className:"preload-overlay__treatment__RIl_g"},Yy.createElement("div",{className:uk},this.props.hubScene&&Yy.createElement("img",{className:uk,src:this.props.hubScene.screenshot_url})),Yy.createElement("a",{href:"/",target:"_blank",rel:"noopener noreferrer",className:"preload-overlay__logo__PTRso"},Yy.createElement("img",{src:k.image("logo"),alt:Yy.createElement(uw.Z,{id:"preload-overlay.logo-alt",defaultMessage:"Logo"})})),Yy.createElement("div",{className:"preload-overlay__main-panel__OtC9B"},Yy.createElement("div",{className:"preload-overlay__hub-name__Te1Hl"},this.props.hubName),this.props.onLoadClicked&&(hk?Yy.createElement(t_,{preset:"primary",as:"a",href:this.props.baseUrl,target:"_blank",rel:"noreferrer noopener"},e):Yy.createElement(t_,{preset:"primary",onClick:this.props.onLoadClicked},e))))}}pk.propTypes={hubName:sw().string,hubScene:sw().object,baseUrl:sw().string,onLoadClicked:sw().func};const mk=["options","data","color","xAxis","yAxis"];function fk(){return fk=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},fk.apply(this,arguments)}function gk(e,t,n,i){const r=t.reduce(((e,t)=>e+t),0),o=e.canvas.width/r,s=Math.max.apply(Math,n),a=e.canvas.height/s;t=t.map((e=>e*o)),n=n.map((e=>e*a)),e.clearRect(0,0,e.canvas.width,e.canvas.height),e.fillStyle=i,e.strokeStyle=i,e.lineWidth=1;let l=0;for(let i=0;i<t.length;i++){const r=l+t[i],o=e.canvas.height-n[i],s=e.canvas.height-(0===i||i===n.length-1?n[i]:n[i+1]);e.beginPath(),e.moveTo(l,o),e.lineTo(r,s),e.lineTo(r,e.canvas.height),e.lineTo(l,e.canvas.height),e.closePath(),e.fill(),e.stroke(),l=r}}const vk=e=>{const{options:t,data:n,color:i,xAxis:r,yAxis:o}=e,s=function(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}(e,mk),{context:a}=t,l=function(e,t,n,i,r){void 0===r&&(r={});const o=Yy.useRef(null);return(0,Yy.useEffect)((()=>{const s=o.current.getContext(r.context||"2d");let a;const l=()=>{e(s,n,i,t),a=window.requestAnimationFrame(l)};return l(),()=>{window.cancelAnimationFrame(a)}}),[r.context,n,i,t,e]),o}(gk,i,n.map((e=>e[r])),n.map((e=>e[o])),{context:a});return Yy.createElement("canvas",fk({ref:l},s))};vk.propTypes={options:sw().object,data:sw().array,xAxis:sw().string,yAxis:sw().string,color:sw().string};var bk={"rtc-tile-text":"Prop__rtc-tile-text__mbi_m",rtcTileText:"Prop__rtc-tile-text__mbi_m","rtc-value-text":"Prop__rtc-value-text__ZiJ0n",rtcValueText:"Prop__rtc-value-text__ZiJ0n"};function yk(e){const t=[];for(const n in e){let i=e[n];"number"==typeof i&&i%1?(i=i.toFixed(2),t.push(Yy.createElement(wk,{key:n,propKey:n,propValue:i}))):"object"==typeof i?(t.push(Yy.createElement(wk,{key:n,propKey:n,propValue:"-"})),t.push(yk(i))):t.push(Yy.createElement(wk,{key:n,propKey:n,propValue:i}))}return t}function wk(e){let{propKey:t,propValue:n}=e;return void 0!==t&&void 0!==n&&Yy.createElement("p",{className:lw()(bk.rtcTileText)},`${t}: `,Yy.createElement("span",{className:lw()(bk.rtcValueText)},`${n}`))||null}wk.propTypes={propKey:sw().string,propValue:sw().any};var _k={"data-tile":"DataPanel__data-tile__aO6Kk",dataTile:"DataPanel__data-tile__aO6Kk","data-tile-title":"DataPanel__data-tile-title__wcIIC",dataTileTitle:"DataPanel__data-tile-title__wcIIC"};function Ek(e){let{graphData:t,speed:n,width:i,height:r,data:o,xAxis:s,yAxis:a,title:l,children:c,color:d,backgroundColor:u}=e;return Yy.createElement("div",{className:lw()(_k.dataTile),style:{backgroundColor:u}},Yy.createElement("p",{className:lw()(_k.dataTileTitle)},l),t&&Yy.createElement("div",{style:{position:"relative",width:i||"auto",height:r||"auto",alignSelf:"center",flex:"0 0 auto"}},Yy.createElement(vk,{width:i||"auto",height:r||"auto",options:{context:"2d"},data:t,color:d||"rgb(0, 0, 255)",xAxis:s,yAxis:a})),n&&Yy.createElement(wk,{propKey:"speed",propValue:`${n} Kb/sec`}),yk(o),c)}Ek.propTypes={graphData:sw().array,speed:sw().string,data:sw().object,xAxis:sw().string,yAxis:sw().string,title:sw().node,children:sw().node,width:sw().string,height:sw().string,color:sw().string,backgroundColor:sw().string};var Ak={"border-tile":"CollapsiblePanel__border-tile__a8dvp",borderTile:"CollapsiblePanel__border-tile__a8dvp","borderless-tile":"CollapsiblePanel__borderless-tile__bGn8c",borderlessTile:"CollapsiblePanel__borderless-tile__bGn8c","rtc-debug-panel-root":"CollapsiblePanel__rtc-debug-panel-root__sv8yl",rtcDebugPanelRoot:"CollapsiblePanel__rtc-debug-panel-root__sv8yl","rtc-status-container":"CollapsiblePanel__rtc-status-container__PEFgl",rtcStatusContainer:"CollapsiblePanel__rtc-status-container__PEFgl","status-container-middle":"CollapsiblePanel__status-container-middle__sP73q",statusContainerMiddle:"CollapsiblePanel__status-container-middle__sP73q","rtc-status-container-right":"CollapsiblePanel__rtc-status-container-right__bjrWb",rtcStatusContainerRight:"CollapsiblePanel__rtc-status-container-right__bjrWb","rtc-status-container-left":"CollapsiblePanel__rtc-status-container-left__r_pIO",rtcStatusContainerLeft:"CollapsiblePanel__rtc-status-container-left__r_pIO","rtc-log-container":"CollapsiblePanel__rtc-log-container__l_VBn",rtcLogContainer:"CollapsiblePanel__rtc-log-container__l_VBn","rtc-log-time":"CollapsiblePanel__rtc-log-time__znjRS",rtcLogTime:"CollapsiblePanel__rtc-log-time__znjRS","rtc-log-text":"CollapsiblePanel__rtc-log-text__YHbuu",rtcLogText:"CollapsiblePanel__rtc-log-text__YHbuu","rtc-log-msg":"CollapsiblePanel__rtc-log-msg__cMtQV",rtcLogMsg:"CollapsiblePanel__rtc-log-msg__cMtQV","rtc-log-tag":"CollapsiblePanel__rtc-log-tag__54VIM",rtcLogTag:"CollapsiblePanel__rtc-log-tag__54VIM","rtc-log-msg-container":"CollapsiblePanel__rtc-log-msg-container__DH5QR",rtcLogMsgContainer:"CollapsiblePanel__rtc-log-msg-container__DH5QR","collapse-button":"CollapsiblePanel__collapse-button__V1F4E",collapseButton:"CollapsiblePanel__collapse-button__V1F4E","log-button":"CollapsiblePanel__log-button__lrG2X",logButton:"CollapsiblePanel__log-button__lrG2X","collapsible-content":"CollapsiblePanel__collapsible-content__fpjed",collapsibleContent:"CollapsiblePanel__collapsible-content__fpjed","collapsible-content-root":"CollapsiblePanel__collapsible-content-root__RX7yn",collapsibleContentRoot:"CollapsiblePanel__collapsible-content-root__RX7yn","collapsible-header":"CollapsiblePanel__collapsible-header__ushjh",collapsibleHeader:"CollapsiblePanel__collapsible-header__ushjh","collapsible-right-buttons":"CollapsiblePanel__collapsible-right-buttons__HwlGL",collapsibleRightButtons:"CollapsiblePanel__collapsible-right-buttons__HwlGL"};function Sk(e){let{title:t,border:n,row:i,wrap:r,grow:o,url:s,isRoot:a,children:l,data:c,collapsed:d,onCollapse:u,backgroundColor:h,clear:p,download:m}=e;const f=lw()(n?Ak.borderTile:Ak.borderlessTile),g={flexGrow:o?1:0,backgroundColor:h},v=lw()(a?`${Ak.collapsibleContentRoot} ${d?"collapsed":""}`:`${Ak.collapsibleContent} ${d?"collapsed":""}`),b=lw()(`${Ak.collapseButton} ${d?"collapsed":""}`),y={flexFlow:(i?"row ":"column ")+(r?"wrap":"nowrap")};return Yy.createElement("div",{className:f,style:g},Yy.createElement("div",{className:Ak.collapsibleHeader},t&&Yy.createElement("button",{className:lw()(b),onClick:e=>{const n=function(e){var t,n,i,r;return e.target.classList.toggle("collapsed"),null===(t=e.target.parentElement)||void 0===t||null===(n=t.nextSibling)||void 0===n||n.classList.toggle("collapsed"),null===(i=e.target.parentElement)||void 0===i||null===(r=i.nextSibling)||void 0===r?void 0:r.classList.contains("collapsed")}(e);u&&u(t,n)}},t),s&&Yy.createElement("button",{className:lw()(Ak.logButton),onClick:()=>function(e){window.open(e,"_blank").focus()}(s)},"?"),(p||m)&&Yy.createElement("div",{className:Ak.collapsibleRightButtons},m&&Yy.createElement("button",{className:lw()(Ak.logButton),onClick:m},"↓"),p&&Yy.createElement("button",{className:lw()(Ak.logButton),onClick:p},"×"))),Yy.createElement("div",{className:v,style:y},yk(c),l))}Sk.propTypes={children:sw().node,title:sw().node,border:sw().bool,row:sw().bool,grow:sw().bool,wrap:sw().bool,url:sw().string,isRoot:sw().bool,data:sw().object,collapsed:sw().bool,onCollapse:sw().func,backgroundColor:sw().string,clear:sw().func,download:sw().func};var xk="RtcDebugPanel__rtc-log-msg__XJZu8",Mk={"audio-debug-container":"AudioDebugPanel__audio-debug-container__mQfQs",audioDebugContainer:"AudioDebugPanel__audio-debug-container__mQfQs","audio-debug-row":"AudioDebugPanel__audio-debug-row__GxFlz",audioDebugRow:"AudioDebugPanel__audio-debug-row__GxFlz","prop-text":"AudioDebugPanel__prop-text__xSaPY",propText:"AudioDebugPanel__prop-text__xSaPY","value-text":"AudioDebugPanel__value-text__KkK4W",valueText:"AudioDebugPanel__value-text__KkK4W"};const Pk=100,Ck=360;function kk(e){let{defaultValue:t,options:n,onChange:i,children:r}=e;const[o,s]=(0,Yy.useState)(t);return Yy.createElement("div",{className:lw()(Mk.audioDebugRow)},Yy.createElement("span",{style:{flex:"none",padEnd:"10px"}},r),Yy.createElement(FS,{value:o,options:n,onChange:e=>{s(e),i(e)}}))}function Ok(e){let{defaultValue:t,step:n,min:i,max:r,onChange:o,children:s}=e;return Yy.createElement("div",{className:lw()(Mk.audioDebugRow)},Yy.createElement("span",{style:{flex:"none",padEnd:"10px"}},s),Yy.createElement("input",{type:"range",step:n,min:i,max:r,value:t,onChange:e=>{const t=parseFloat(e.target.value);o(t)}}),Yy.createElement("span",{className:lw()(Mk.valueText)},t))}function Tk(){return{enableAudioClipping:APP.store.state.preferences.enableAudioClipping,audioClippingThreshold:APP.store.state.preferences.audioClippingThreshold,globalVoiceVolume:APP.store.state.preferences.globalVoiceVolume,globalMediaVolume:APP.store.state.preferences.globalMediaVolume,globalSFXVolume:APP.store.state.preferences.globalSFXVolume}}function Rk(e){let{isNarrow:t,collapsed:n,onCollapsed:i}=e;const[r,o]=(0,Yy.useState)(im(mh.MEDIA_VIDEO)),[s,a]=(0,Yy.useState)(im(mh.AVATAR_AUDIO_SOURCE)),l=(e,t)=>{const n=Object.assign({},APP.audioDebugPanelOverrides.get(e),t);APP.audioDebugPanelOverrides.set(e,n),e===mh.MEDIA_VIDEO?o(im(mh.MEDIA_VIDEO)):a(im(mh.AVATAR_AUDIO_SOURCE));for(const[e,t]of APP.audios.entries())rm(e,t)},[c,d]=(0,Yy.useState)(Tk()),u=(0,Yy.useCallback)((()=>{d(Tk())}),[d]);return(0,Yy.useEffect)((()=>(u(),APP.store.addEventListener("statechanged",u),()=>{APP.store.removeEventListener("statechanged",u),APP.audioDebugPanelOverrides.delete(mh.MEDIA_VIDEO),APP.audioDebugPanelOverrides.delete(mh.AVATAR_AUDIO_SOURCE);for(const[e,t]of APP.audios.entries())rm(e,t)})),[u]),Yy.createElement("div",{className:lw()(Mk.audioDebugContainer),style:{height:t&&!n&&"80%",maxHeight:t&&!n&&"80%"}},Yy.createElement(Sk,{title:Yy.createElement(uw.Z,{id:"audio-debug-panel.audio-debug-title",defaultMessage:"Audio Debug"}),isRoot:!0,border:!0,collapsed:n,onCollapse:i},Yy.createElement(Sk,{title:Yy.createElement(uw.Z,{id:"audio-debug-panel.audio-debug-global-title",defaultMessage:"Globals"}),border:!0,grow:!0},Yy.createElement("div",{style:{display:"flex",alignItems:"center"}},Yy.createElement("input",{tabIndex:"0",type:"checkbox",checked:c.enableAudioClipping,onChange:()=>{APP.store.update({preferences:{enableAudioClipping:!c.enableAudioClipping}})},style:{marginLeft:"10px"}}),Yy.createElement(Ok,{defaultValue:c.audioClippingThreshold,step:.001,min:0,max:.1,onChange:e=>{APP.store.update({preferences:{audioClippingThreshold:e}})}},Yy.createElement("p",{className:lw()(Mk.propText)},Yy.createElement(uw.Z,{id:"audio-debug-view.global.clippingThreshold",defaultMessage:"Clipping"})))),Yy.createElement(Ok,{defaultValue:c.globalVoiceVolume,step:5,min:0,max:VM,onChange:e=>{APP.store.update({preferences:{globalVoiceVolume:e}})}},Yy.createElement("p",{className:lw()(Mk.propText)},Yy.createElement(uw.Z,{id:"audio-debug-view.global.voiceVolume",defaultMessage:"Voice Volume"}))),Yy.createElement(Ok,{defaultValue:c.globalMediaVolume,step:5,min:0,max:VM,onChange:e=>{APP.store.update({preferences:{globalMediaVolume:e}})}},Yy.createElement("p",{className:lw()(Mk.propText)},Yy.createElement(uw.Z,{id:"audio-debug-view.global.mediaVolume",defaultMessage:"Media Volume"}))),Yy.createElement(Ok,{defaultValue:c.globalSFXVolume,step:5,min:0,max:VM,onChange:e=>{APP.store.update({preferences:{globalSFXVolume:e}})}},Yy.createElement("p",{className:lw()(Mk.propText)},Yy.createElement(uw.Z,{id:"audio-debug-view.global.sfxVolume",defaultMessage:"SFX Volume"})))),Yy.createElement("div",{style:{display:"flex"}},Yy.createElement(Sk,{title:Yy.createElement(uw.Z,{id:"audio-debug-panel.audio-debug-avatar-title",defaultMessage:"Avatar"}),border:!0,grow:!0},Yy.createElement(kk,{defaultValue:s.distanceModel,options:ph,onChange:e=>{const t={distanceModel:e};e===gh.Linear&&s.rolloffFactor>1&&(t.rolloffFactor=1),l(mh.AVATAR_AUDIO_SOURCE,t)}},Yy.createElement("p",{className:lw()(Mk.propText)},Yy.createElement(uw.Z,{id:"audio-debug-view.avatar.distanceModel",defaultMessage:"Distance Model"}))),Yy.createElement(Ok,{defaultValue:s.rolloffFactor,step:s.distanceModel===gh.Linear?.01:.5,min:(s.distanceModel,gh.Linear,0),max:s.distanceModel===gh.Linear?1:20,onChange:e=>{l(mh.AVATAR_AUDIO_SOURCE,{rolloffFactor:e})}},Yy.createElement("p",{className:lw()(Mk.propText)},Yy.createElement(uw.Z,{id:"audio-debug-view.avatar.rolloffFactor",defaultMessage:"Rolloff"}))),Yy.createElement(Ok,{defaultValue:s.refDistance,step:1,min:1,max:Pk,onChange:e=>{l(mh.AVATAR_AUDIO_SOURCE,{refDistance:e})}},Yy.createElement("p",{className:lw()(Mk.propText)},Yy.createElement(uw.Z,{id:"audio-debug-view.avatar.refDistance",defaultMessage:"Ref Distance"}))),Yy.createElement(Ok,{defaultValue:s.maxDistance,step:1,min:1,max:Pk,onChange:e=>{l(mh.AVATAR_AUDIO_SOURCE,{maxDistance:e})}},Yy.createElement("p",{className:lw()(Mk.propText)},Yy.createElement(uw.Z,{id:"audio-debug-view.avatar.maxDistance",defaultMessage:"Max Distance"}))),Yy.createElement(Ok,{defaultValue:s.coneInnerAngle,step:1,min:0,max:Ck,onChange:e=>{l(mh.AVATAR_AUDIO_SOURCE,{coneInnerAngle:e})}},Yy.createElement("p",{className:lw()(Mk.propText)},Yy.createElement(uw.Z,{id:"audio-debug-view.avatar.innerAngle",defaultMessage:"Inner Angle"}))),Yy.createElement(Ok,{defaultValue:s.coneOuterAngle,step:1,min:0,max:Ck,onChange:e=>{l(mh.AVATAR_AUDIO_SOURCE,{coneOuterAngle:e})}},Yy.createElement("p",{className:lw()(Mk.propText)},Yy.createElement(uw.Z,{id:"audio-debug-view.avatar.outerAngle",defaultMessage:"Outer Angle"}))),Yy.createElement(Ok,{defaultValue:s.coneOuterGain,step:.1,min:0,max:1,onChange:e=>{l(mh.AVATAR_AUDIO_SOURCE,{coneOuterGain:e})}},Yy.createElement("p",{className:lw()(Mk.propText)},Yy.createElement(uw.Z,{id:"audio-debug-view.avatar.outerGain",defaultMessage:"Outer Gain"})))),Yy.createElement(Sk,{title:Yy.createElement(uw.Z,{id:"audio-debug-panel.audio-debug-media-title",defaultMessage:"Media"}),border:!0,grow:!0},Yy.createElement(kk,{defaultValue:r.distanceModel,options:ph,onChange:e=>{const t={distanceModel:e};e===gh.Linear&&r.rolloffFactor>1&&(t.rolloffFactor=1),l(mh.MEDIA_VIDEO,t)}},Yy.createElement("p",{className:lw()(Mk.propText)},Yy.createElement(uw.Z,{id:"audio-debug-view.media.distanceModel",defaultMessage:"Distance Model"}))),Yy.createElement(Ok,{defaultValue:r.rolloffFactor,step:r.distanceModel===gh.Linear?.01:.5,min:(r.distanceModel,gh.Linear,0),max:r.distanceModel===gh.Linear?1:20,onChange:e=>{l(mh.MEDIA_VIDEO,{rolloffFactor:e})}},Yy.createElement("p",{className:lw()(Mk.propText)},Yy.createElement(uw.Z,{id:"audio-debug-view.media.rolloffFactor",defaultMessage:"Rolloff"}))),Yy.createElement(Ok,{defaultValue:r.refDistance,step:1,min:1,max:Pk,onChange:e=>{l(mh.MEDIA_VIDEO,{refDistance:e})}},Yy.createElement("p",{className:lw()(Mk.propText)},Yy.createElement(uw.Z,{id:"audio-debug-view.media.refDistance",defaultMessage:"Ref Distance"}))),Yy.createElement(Ok,{defaultValue:r.maxDistance,step:1,min:1,max:Pk,onChange:e=>{l(mh.MEDIA_VIDEO,{maxDistance:e})}},Yy.createElement("p",{className:lw()(Mk.propText)},Yy.createElement(uw.Z,{id:"audio-debug-view.media.maxDistance",defaultMessage:"Max Distance"}))),Yy.createElement(Ok,{defaultValue:r.coneInnerAngle,step:1,min:0,max:Ck,onChange:e=>{l(mh.MEDIA_VIDEO,{coneInnerAngle:e})}},Yy.createElement("p",{className:lw()(Mk.propText)},Yy.createElement(uw.Z,{id:"audio-debug-view.media.innerAngle",defaultMessage:"Inner Angle"}))),Yy.createElement(Ok,{defaultValue:r.coneOuterAngle,step:1,min:0,max:Ck,onChange:e=>{l(mh.MEDIA_VIDEO,{coneOuterAngle:e})}},Yy.createElement("p",{className:lw()(Mk.propText)},Yy.createElement(uw.Z,{id:"audio-debug-view.media.outerAngle",defaultMessage:"Outer Angle"}))),Yy.createElement(Ok,{defaultValue:r.coneOuterGain,step:.1,min:0,max:1,onChange:e=>{l(mh.MEDIA_VIDEO,{coneOuterGain:e})}},Yy.createElement("p",{className:lw()(Mk.propText)},Yy.createElement(uw.Z,{id:"audio-debug-view.media.outerGain",defaultMessage:"Outer Gain"})))))))}kk.propTypes={defaultValue:sw().string,options:sw().array,onChange:sw().func,children:sw().node},Ok.propTypes={defaultValue:sw().number,step:sw().number,min:sw().number,max:sw().number,onChange:sw().func,children:sw().node},Rk.propTypes={isNarrow:sw().bool,collapsed:sw().bool,onCollapsed:sw().func,children:sw().node};const Dk=["children"];function jk(e,t,n,i,r,o,s){try{var a=e[o](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(i,r)}function Lk(e){return function(){var t=this,n=arguments;return new Promise((function(i,r){var o=e.apply(t,n);function s(e){jk(o,i,r,s,a,"next",e)}function a(e){jk(o,i,r,s,a,"throw",e)}s(void 0)}))}}function Ik(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function Nk(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ik(Object(n),!0).forEach((function(t){Fk(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ik(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Fk(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Bk(){return Bk=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},Bk.apply(this,arguments)}const Vk=AFRAME.utils.device.isMobile(),Uk="send_transport",Hk="receive_transport",zk="outbound-rtp",Wk="local-candidate",qk="remote-candidate",Zk="#8b1c00",Gk="producers",Yk="consumers",Qk="https://mediasoup.org/documentation/v3/libmediasoupclient/api/",Xk="https://developer.mozilla.org/en-US/docs/Web/API/",Kk={width:"auto",alignSelf:"center",margin:"5px",padding:"4px 18px",fontSize:"12px",minWidth:"120px"},$k=navigator.userAgent.toLowerCase().indexOf("firefox")>-1;function Jk(e){return e?e.replace(/\b\w/g,(e=>e.toUpperCase())):""}function eO(e){let{children:t}=e,n=function(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}(e,Dk);return Yy.createElement(t_,Bk({},n,{style:Kk}),t)}function tO(e){var t;let{title:n,data:i,xAxis:r,yAxis:o,stats:s}=e;const a={id:i.id,opened:i.opened,paused:i.paused,kind:i.kind,codec:i.codec};var l,c,d;"video"===i.kind&&((void 0!==i.spatialLayer||void 0!==i.temporalLayer)&&(a.currentLayers=`S[${i.spatialLayer}] T[${i.temporalLayer}]`),null!=i.score&&(a.score=`S[${null===(l=i.score)||void 0===l?void 0:l.score}] P[${null===(c=i.score)||void 0===c?void 0:c.producerScore}][${null===(d=i.score)||void 0===d?void 0:d.producerScores}]`),null!=i.frameRate&&(a.frameRate=`${i.frameRate}`),null!=i.width&&(a.width=`${i.width}`),null!=i.height&&(a.height=`${i.height}`));const u=i.opened&&null!=s&&s.speed?null:Zk;return Yy.createElement(Ek,{title:n,data:a,backgroundColor:u},(null==i?void 0:i.track)&&Yy.createElement(Ek,{key:i.id,data:i.track,title:Yy.createElement(uw.Z,{id:"rtc-debug-panel.track-panel-title",defaultMessage:"Track"})}),s&&Yy.createElement(Ek,{key:null===(t=s.rtpStats)||void 0===t?void 0:t.id,graphData:s.graph.slice(),width:"120px",height:"50px",color:"green",speed:s.speed,data:s.rtpStats,xAxis:r,yAxis:o,title:Yy.createElement(uw.Z,{id:"rtc-debug-panel.stats-panel-title",defaultMessage:"Stats"})}))}function nO(e){let{title:t,data:n,candidates:i,producers:r,consumers:o,isButtonEnabled:s,onRestart:a}=e;const l=(null==r?void 0:r.some((e=>{var t,n,i,r;return!(null!==(t=e.props)&&void 0!==t&&null!==(n=t.data)&&void 0!==n&&n.opened&&null!==(i=e.props)&&void 0!==i&&null!==(r=i.stats)&&void 0!==r&&r.speed)})))?Zk:null;return Yy.createElement(Sk,{key:t,title:t,border:!0,url:`${Qk}#Transport`,data:n},Yy.createElement(eO,{onClick:a,disabled:!s,preset:"accept"},Yy.createElement(uw.Z,{id:"rtc-debug-panel.restart-ice-button",defaultMessage:"Restart ICE"})),Yy.createElement(Sk,{key:"Candidates",title:Yy.createElement(uw.Z,{id:"rtc-debug-panel.local-candidates-panel-title",defaultMessage:"Candidates"}),row:!0,url:`${Xk}RTCIceCandidate`,border:!0,backgroundColor:0===(null==i?void 0:i.length)&&"connected"===(null==n?void 0:n.state)&&null!=n&&n.opened?Zk:null},(null==i?void 0:i.length)&&i||Yy.createElement("p",{className:lw()(xk)},Yy.createElement(uw.Z,{id:"rtc-debug-panel.local-no-candidates-message",defaultMessage:"No Candidates"}))),(null==r?void 0:r.length)&&Yy.createElement(Sk,{key:"Local producers",title:Yy.createElement(uw.Z,{id:"rtc-debug-panel.local-producers-panel-title",defaultMessage:"Local Producers"}),row:!0,url:`${Qk}#Producer`,border:!0,collapsed:!0,backgroundColor:l},r)||null,o||null)}function iO(e){let{data:t,onConnect:n,onDisconnect:i}=e;return Yy.createElement(Sk,{title:Yy.createElement(uw.Z,{id:"rtc-debug-panel.signaling-panel-title",defaultMessage:"Signaling"}),border:!0,data:t},Yy.createElement(eO,{onClick:()=>{t.connected?i():n()},disabled:!1,preset:"accept"},t.connected?Yy.createElement(uw.Z,{id:"rtc-debug-panel.disconnect-signaling-button",defaultMessage:"Disconnect"}):Yy.createElement(uw.Z,{id:"rtc-debug-panel.connect-signaling-button",defaultMessage:"Connect"})))}eO.propTypes={children:sw().node},tO.propTypes={title:sw().node,data:sw().object,xAxis:sw().string,yAxis:sw().string,stats:sw().object,backgroundColor:sw().string},nO.propTypes={candidates:sw().array,producers:sw().array,consumers:sw().array,data:sw().object,onRestart:sw().func,title:sw().node,isButtonEnabled:sw().bool},iO.propTypes={data:sw().object,onConnect:sw().func,onDisconnect:sw().func};class rO extends Yy.Component{constructor(){super(),this.logEvent=e=>{const t=this.state.log.slice(-200)||[];t.push(e.detail),this.setState({log:t})},this.storeUpdated=()=>{const e=this.props.store.state.preferences.showRtcDebugPanel;this.setState({showPanel:e})},this.restartSendICE=()=>{APP.dialog.restartSendICE()},this.restartRecvICE=()=>{APP.dialog.restartRecvICE()},this.connectSignaling=()=>{APP.dialog.connect({serverUrl:APP.dialog._serverUrl,roomId:APP.dialog._roomId,serverParams:APP.dialog._serverParams,scene:APP.dialog.scene,clientId:APP.dialog._clientId,forceTcp:APP.dialog._forceTcp,forceTurn:APP.dialog._forceTurn,iceTransportPolicy:APP.dialog._iceTransportPolicy})},this.disconnectSignaling=()=>{APP.dialog.disconnect()},this.colorForLevel=e=>{switch(e){case"error":return"red";case"warn":return"orange";default:return"white"}},this.createLogMsgs=()=>{var e;const t=[];return null===(e=this.state.log)||void 0===e||e.slice().reverse().forEach(((e,n)=>{t.push(Yy.createElement("span",{key:n<<2,className:lw()("RtcDebugPanel__rtc-log-time__JSSve")},`[${e.time}] `)),t.push(Yy.createElement("span",{key:n<<2|1,className:lw()("RtcDebugPanel__rtc-log-tag__Yt0hz")},`[${e.tag}] `)),t.push(Yy.createElement("span",{key:n<<2|2,className:lw()(xk),style:{color:this.colorForLevel(e.level)}},e.msg)),t.push(Yy.createElement("br",{key:n<<2|3}))})),t},this.createLog=()=>{var e;const t=[];return null===(e=this.state.log)||void 0===e||e.slice().reverse().forEach((e=>{t.push(`[${e.time}] [${e.tag}] ${e.msg}`)})),t.join("\r")},this.onCollapse=(e,t)=>{const n=null==e?void 0:e.props.defaultMessage,i=Nk({},this.state.collapsed);if(Vk||window.innerWidth<500)for(const e of Object.keys(i))n===e?i[e]=t:t||(i[e]=!0);else i[n]=t;this.setState({collapsed:i})},this.state={log:[],collapsed:{Local:!1,Log:Vk,Remote:!0,Audio:!0}}}componentDidMount(){this.props.scene.addEventListener("rtc_event",this.logEvent),this.props.store.addEventListener("statechanged",this.storeUpdated),this.runStats(!0)}componentWillUnmount(){this.props.scene.removeEventListener("rtc_event",this.logEvent),this.props.store.removeEventListener("statechanged",this.storeUpdated),this.runStats(!1)}getDeviceData(){let e={};const t=APP.dialog._mediasoupDevice;var n;return t&&(e.loaded=!t._closed,e.codecs=null===(n=t._recvRtpCapabilities)||void 0===n?void 0:n.codecs.map((e=>"["+e.mimeType+"/"+e.clockRate+"]")),e=Nk(Nk({},e),APP.dialog.downlinkBwe)),e}getCandidatesData(e){return Lk((function*(){const t={},n=yield e.getStats();let i=null;if(!$k)for(const e of n.values())"transport"===e.type&&(i=e.selectedCandidatePairId);for(const e of n.values())if("candidate-pair"===e.type){const r=e;let o=!1;if(o=$k?r&&r.selected&&"succeeded"===r.state:r.id===i,o)for(const e of n.values())r.localCandidateId===e.id?t[Wk]=e:r.remoteCandidateId===e.id&&(t[qk]=e)}return t}))()}getTransportData(e){var t=this;return Lk((function*(){const n={};let i;e===Uk?i=APP.dialog._sendTransport:e===Hk&&(i=APP.dialog._recvTransport);const r=!(!i||i._closed);return n.opened=r,i&&(n.state=r?i._connectionState:"closed",n.id=i._id,n[Gk]=[],n[Yk]=[],i._producers.forEach((e=>{n[Gk].push(t.getProducerConsumerData(e))})),i._consumers.forEach((e=>{n[Yk].push(t.getProducerConsumerData(e))})),r&&(n.candidates=yield t.getCandidatesData(i))),n}))()}profileFromPresence(e){let[,t]=e;return t.metas[t.metas.length-1].profile}profileFromConsumer(e){return Object.entries(this.props.presences||{}).filter((t=>{let[n]=t;return n===e._appData.peerId})).map(this.profileFromPresence).shift()}getProducerConsumerData(e){const t={};if(t.opened=!e._closed,e){const n=Object.entries(this.props.presences||{}).filter((t=>{let[n]=t;return n===e._appData.peerId})).map(this.profileFromPresence).shift();t.id=e._id,t.paused=e._paused,t.track=this.getTrackData(e),t.kind=e._kind||t.track.kind,t.codec=e.rtpParameters.codecs[0].mimeType.split("/")[1],t.name=n?n.displayName:"N/A",t.peerId=e._appData.peerId;const i=APP.dialog.consumerStats[e._id];"video"===t.kind&&i&&(t.spatialLayer=i.spatialLayer,t.temporalLayer=i.temporalLayer,t.score=i.score)}return t}getTrackData(e){const t={};return t.id=e._track.id,t.enabled=!(null===e._track||!e._track.enabled),t.kind=e._track.kind,t.muted=e._track.muted,t.state=e._track.readyState,t}getSignalingData(){return{connected:APP.dialog._protoo&&APP.dialog._protoo.connected}}getServerData(){return Lk((function*(){return yield APP.dialog.getServerStats()}))()}getRtpStatsData(e,t){return Lk((function*(){const n=yield e.getStats();for(const e of n.values())if(e.type===t)return e;return{}}))()}getGraphData(e,t){var n,i,r,o,s,a,l,c,d;let u=null===(n=this.state.statsData)||void 0===n||null===(i=n[e])||void 0===i?void 0:i.last;const h=(null==t?void 0:t.bytesSent)||0,p=(null==t?void 0:t.bytesReceived)||0,m=(null==t?void 0:t.packetsSent)||0,f=(null==t?void 0:t.packetsReceived)||0,g=(null==t?void 0:t.timestamp)||0,v=h-(null===(r=u)||void 0===r?void 0:r.bytesSent)||0,b=p-(null===(o=u)||void 0===o?void 0:o.bytesReceived)||0,y=m-(null===(s=u)||void 0===s?void 0:s.packetsSent)||0,w=f-(null===(a=u)||void 0===a?void 0:a.packetsReceived)||0,_=g-(null===(l=u)||void 0===l?void 0:l.timestamp)||0;let E=null===(c=this.state.statsData)||void 0===c||null===(d=c[e])||void 0===d?void 0:d.graph;if(!E){const e=new Array(20);e.fill({bytesSent:0,bytesReceived:0,packetsSent:0,packetsReceived:0,timeDelta:0}),E=e}return E.shift(),E.push({bytesSent:v,bytesReceived:b,packetsSent:y,packetsReceived:w,timeDelta:_}),u={bytesSent:h,bytesReceived:p,packetsSent:m,packetsReceived:f,timestamp:g},{lastStats:u,graphData:E}}getPeerSpeed(e,t){var n,i;let r="0.00";const o=null===(n=this.state.statsData)||void 0===n||null===(i=n[e])||void 0===i?void 0:i.graph;if(o){const e=o[o.length-1];e&&(r=(e[t]/1024*(1/(e.timeDelta/1e3))||0).toFixed(2))}return r}runStats(e){var t=this;return Lk((function*(){if(e&&t.state){const e=setInterval((()=>{Lk((function*(){try{const e=t.getDeviceData(),n=t.state.collapsed.Remote?{}:yield t.getServerData(),i=t.getSignalingData(),r={};r[Uk]=yield t.getTransportData(Uk),r[Hk]=yield t.getTransportData(Hk);const o={};if(APP.dialog._micProducer){const e=APP.dialog._micProducer.id,n=APP.dialog._micProducer,i=t.getPeerSpeed(e,"bytesSent"),r=yield t.getRtpStatsData(n,zk),{lastStats:s,graphData:a}=t.getGraphData(e,r);o[e]={},o[e].speed=i,o[e].graph=a,o[e].last=s,o[e].rtpStats=r}if(APP.dialog._cameraProducer){const e=APP.dialog._cameraProducer.id,n=APP.dialog._cameraProducer,i=t.getPeerSpeed(e,"bytesSent"),r=yield t.getRtpStatsData(n,zk),{lastStats:s,graphData:a}=t.getGraphData(e,r);o[e]={},o[e].speed=i,o[e].graph=a,o[e].last=s,o[e].rtpStats=r}if(APP.dialog._shareProducer){const e=APP.dialog._shareProducer.id,n=APP.dialog._shareProducer,i=t.getPeerSpeed(e,"bytesSent"),r=yield t.getRtpStatsData(n,zk),{lastStats:s,graphData:a}=t.getGraphData(e,r);o[e]={},o[e].speed=i,o[e].graph=a,o[e].last=s,o[e].rtpStats=r}for(const e of APP.dialog._consumers){const n=e[0],i=e[1],r=t.getPeerSpeed(n,"bytesReceived"),s=yield t.getRtpStatsData(i,"inbound-rtp"),{lastStats:a,graphData:l}=t.getGraphData(n,s);o[n]={},o[n].speed=r,o[n].graph=l,o[n].last=a,o[n].rtpStats=s}t.setState({signalingData:i,serverData:n,deviceData:e,statsData:o,transportsData:r})}catch(e){console.log(`Run Stats error: ${e}`)}}))()}),2e3);t.setState({taskId:e})}else clearInterval(t.state.taskId)}))()}createCandidates(e){const t=[];return e&&(e[Wk]&&t.push(Yy.createElement(Ek,{key:Wk,data:e[Wk],title:Yy.createElement(uw.Z,{id:"rtc-debug-panel.local-candidate-panel-title",defaultMessage:"Local Candidate"})})),e[qk]&&t.push(Yy.createElement(Ek,{key:qk,data:e[qk],title:Yy.createElement(uw.Z,{id:"rtc-debug-panel.remote-candidate-panel-title",defaultMessage:"Remote Candidate"})}))),t}createProducers(e,t){return void 0===e&&(e=[]),e.map((e=>Yy.createElement(tO,{key:e.id,title:Yy.createElement(uw.Z,{id:"rtc-debug-panel.producer-panel-title",defaultMessage:"{kind} Producer",values:{kind:Jk(null==e?void 0:e.kind)}}),data:e,xAxis:"timeDelta",yAxis:"bytesSent",stats:t[e.id]})))}createConsumers(e,t){const n=(null==e?void 0:e.reduce(((e,t)=>(e[t.peerId]=e[t.peerId]||{},e[t.peerId].name=t.name,e[t.peerId].peerId=t.peerId,e[t.peerId].consumers=e[t.peerId].consumers||[],e[t.peerId].consumers.push(t),e)),[]))||[],i=[];for(const[,e]of Object.entries(n)){var r;const n=e.consumers.map((e=>Yy.createElement(tO,{key:e.id,title:Yy.createElement(uw.Z,{id:"rtc-debug-panel.consumer-panel-title",defaultMessage:"{kind} Consumer",values:{kind:Jk(null==e?void 0:e.kind)}}),data:e,xAxis:"timeDelta",yAxis:"bytesReceived",stats:t[e.id]}))),o=(null==e||null===(r=e.consumers)||void 0===r?void 0:r.some((e=>{var n;return!e.opened||!(null!==(n=t[e.id])&&void 0!==n&&n.speed)})))?Zk:null;i.push(Yy.createElement(Sk,{key:e.name,title:e.name,url:`${Qk}#Consumer`,data:{peerId:e.peerId},border:!0,collapsed:!0,backgroundColor:o},Yy.createElement(Sk,{row:!0},n)))}return i}createRemoteTransports(e){const t=[];if(e)for(const n in e){const i=e[n],r=[];if(null!=i&&i.producers)for(const e in i.producers)i.producers[e].forEach(((t,n)=>{r.push(Yy.createElement(Ek,{key:`${e}${n}`,data:t,title:Yy.createElement(uw.Z,{id:"rtc-debug-panel.producer-transport-stats-title",defaultMessage:"{kind} Stats",values:{kind:Jk(t.kind)}})}))}));const o=[];if(null!=i&&i.consumers)for(const e in i.consumers)i.consumers[e].forEach(((t,n)=>{o.push(Yy.createElement(Ek,{key:`${e}${n}`,data:t,title:Yy.createElement(uw.Z,{id:"rtc-debug-panel.consumer-transport-stats-title",defaultMessage:"{kind} Stats",values:{kind:Jk(t.kind)}})}))}));t.push(Yy.createElement(Sk,{key:n,title:`${i.name} Transport`,url:`${Xk}RTCStatsReport`,data:{id:n},border:!0},(null==r?void 0:r.length)&&Yy.createElement(Sk,{key:"producers",title:Yy.createElement(uw.Z,{id:"rtc-debug-panel.producer-transport-stats-panel-title",defaultMessage:"Producer Stats"}),row:!0,wrap:!0,url:`${Xk}RTCStatsReport`,border:!0},r)||null,(null==o?void 0:o.length)&&Yy.createElement(Sk,{key:"consumers",title:Yy.createElement(uw.Z,{id:"rtc-debug-panel.consumer-transport-stats-panel-title",defaultMessage:"Consumer Stats"}),row:!0,wrap:!0,url:`${Xk}RTCStatsReport`,border:!0},o)||null))}return t}render(){var e,t,n,i,r,o,s,a,l,c,d,u;const{signalingData:h,serverData:p,statsData:m,deviceData:f,transportsData:g,collapsed:v}=this.state,b=Vk||window.innerWidth<500;return Yy.createElement("div",null,Yy.createElement("div",{className:lw()("RtcDebugPanel__rtc-debug-panel-root__ZBgNt")},Yy.createElement("div",{className:lw()("RtcDebugPanel__rtc-status-container-left__i_75b"),style:{height:b&&!v.Local&&"80%",maxHeight:b&&!v.Local&&"80%"}},this.props.showRtcDebug&&Yy.createElement(Sk,{title:Yy.createElement(uw.Z,{id:"rtc-debug-panel.local-panel-title",defaultMessage:"Local"}),isRoot:!0,border:!0,grow:!0,collapsed:v.Local,onCollapse:this.onCollapse},f&&Yy.createElement(Sk,{title:Yy.createElement(uw.Z,{id:"rtc-debug-panel.device-panel-title",defaultMessage:"Device"}),border:!0,url:`${Qk}#Device`,data:f}),h&&Yy.createElement(iO,{data:h,onConnect:this.connectSignaling,onDisconnect:this.disconnectSignaling}),Yy.createElement("div",{style:{display:"flex",flexFlow:"column"}},Yy.createElement(nO,{title:Yy.createElement(uw.Z,{id:"rtc-debug-panel.send-transport-panel-title",defaultMessage:"Send Transport"}),data:{id:null==g||null===(e=g[Uk])||void 0===e?void 0:e.id,opened:null==g||null===(t=g[Uk])||void 0===t?void 0:t.opened,state:null==g||null===(n=g[Uk])||void 0===n?void 0:n.state},candidates:this.createCandidates(null==g||null===(i=g[Uk])||void 0===i?void 0:i.candidates),producers:this.createProducers(null==g||null===(r=g[Uk])||void 0===r?void 0:r.producers,m),onRestart:this.restartSendICE,isButtonEnabled:null==g||null===(o=g[Uk])||void 0===o?void 0:o.opened})),Yy.createElement("div",{style:{display:"flex",flexFlow:"column"}},Yy.createElement(nO,{title:Yy.createElement(uw.Z,{id:"rtc-debug-panel.receive-transport-panel-title",defaultMessage:"Receive Transport"}),data:{id:null==g||null===(s=g[Hk])||void 0===s?void 0:s.id,opened:null==g||null===(a=g[Hk])||void 0===a?void 0:a.opened,state:null==g||null===(l=g[Hk])||void 0===l?void 0:l.state},candidates:this.createCandidates(null==g||null===(c=g[Hk])||void 0===c?void 0:c.candidates),consumers:this.createConsumers(null==g||null===(d=g[Hk])||void 0===d?void 0:d.consumers,m),onRestart:this.restartRecvICE,isButtonEnabled:null==g||null===(u=g[Hk])||void 0===u?void 0:u.opened})))),Yy.createElement("div",{className:lw()("RtcDebugPanel__status-container-middle__GkH1i")},this.props.showAudioDebug&&Yy.createElement(Rk,{isNarrow:!0,collapsed:v.Audio,onCollapsed:this.onCollapse}),this.props.showRtcDebug&&Yy.createElement("div",{className:lw()("RtcDebugPanel__rtc-log-container__adAUM"),style:{height:b&&!v.Log&&"80%",maxHeight:b&&!v.Log&&"80%"}},Yy.createElement(Sk,{title:Yy.createElement(uw.Z,{id:"rtc-debug-panel.log-panel-title",defaultMessage:"Log"}),isRoot:!0,border:!0,grow:!0,collapsed:v.Log,onCollapse:this.onCollapse,clear:()=>{this.setState({log:[]})},download:()=>{!function(e,t){const n=document.createElement("a");n.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(t)),n.setAttribute("download","rtc_log.txt"),n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n)}(0,this.createLog())}},Yy.createElement("p",{className:lw()("RtcDebugPanel__rtc-log-msg-container___MEx7")},this.createLogMsgs())))),Yy.createElement("div",{className:lw()("RtcDebugPanel__rtc-status-container-right__v2TQx"),style:{height:b&&!v.Remote&&"80%",maxHeight:b&&!v.Remote&&"80%"}},this.props.showRtcDebug&&Yy.createElement(Sk,{title:Yy.createElement(uw.Z,{id:"rtc-debug-panel.remote-panel-title",defaultMessage:"Remote"}),isRoot:!0,border:!0,grow:!0,collapsed:v.Remote,onCollapse:this.onCollapse},this.createRemoteTransports(p)))))}}function oO(e){if(!e)return"";const t=e.split("@"),n=t[0],i=t[1];return`${n.substring(0,Math.min(n.length,3))}...@${i}`}rO.propTypes={avatarId:sw().string,store:sw().object,scene:sw().object,intl:sw().object,presences:sw().object,history:sw().object,sessionId:sw().string,showRtcDebug:sw().bool,showAudioDebug:sw().bool};var sO,aO,lO,cO={"loading-screen-layout":"LoadingScreenLayout__loading-screen-layout__Tybb0",loadingScreenLayout:"LoadingScreenLayout__loading-screen-layout__Tybb0",center:"LoadingScreenLayout__center__HTsFi",logo:"LoadingScreenLayout__logo__r1f8O",bottom:"LoadingScreenLayout__bottom__Ivx3e"};function dO(){return dO=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},dO.apply(this,arguments)}const uO=e=>{let{title:t,titleId:n,...i}=e;return Yy.createElement("svg",dO({width:144,height:100,viewBox:"0 0 144 100",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":n},i),t?Yy.createElement("title",{id:n},t):null,sO||(sO=Yy.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M144 99.74H0V58.115h144v41.627ZM41.88 87.245h-2.32V78.95c0-4.329-2.96-6.311-6.2-6.311-2.84 0-4.88 1.497-5.88 3.924-.88-2.67-3.28-3.924-5.88-3.924-2.52 0-4.4 1.173-5.48 3.115v-2.751H8.56v3.964h2.4v10.316h-2.4v3.964h10.96v-3.964h-3.44v-6.351c0-2.549 1-4.329 3.48-4.329 2.04 0 3.08 1.214 3.08 4.37v10.274h7.56v-3.964h-2.4v-6.351c0-2.549 1-4.329 3.48-4.329 2.04 0 3.08 1.214 3.08 4.37v10.234h7.52v-3.965ZM53.801 72.64c-6.48 0-9.68 4.41-9.68 9.75 0 5.824 3.84 9.263 9.4 9.263 5.76 0 9.92-3.681 9.92-9.507 0-5.097-3.16-9.506-9.64-9.506Zm-4.36 9.382c0 3.155 1.44 5.582 4.24 5.582 2.68 0 4.44-2.143 4.44-5.663 0-3.681-1.961-5.34-4.4-5.34-2.64 0-4.28 1.982-4.28 5.421Zm30.156 2.43 4.08.404-1.12 6.392h-15.72l-.52-2.75 9.92-11.53h-5.64l-.8 2.832-3.72-.405.64-6.392h15.8l.4 2.751-10 11.53h5.84l.84-2.832Zm13.283 6.797h-5.4v-6.553h5.4v6.553Zm-5.4-11.692h5.4v-6.554h-5.4v6.554Zm13.798 11.65 7.8-27.792h-5.08l-7.8 27.792h5.08Zm18.282-27.792-7.801 27.792h-5.08l7.8-27.792h5.081Zm17.2 24.718c.24 0 .479-.04.76-.12l.12 2.79c-.961.527-2.12.85-3.24.85-2.401 0-3.72-1.416-3.96-3.64-1.04 1.86-2.88 3.64-5.801 3.64-2.6 0-5.559-1.416-5.559-5.219 0-4.49 4.279-5.542 8.4-5.542 1 0 2.04.04 2.96.162v-.607c0-1.86-.04-4.085-2.96-4.085-1.08 0-1.92.08-2.76.526l-.6 2.063-4.12-.445.64-4.208c3.16-1.294 4.76-1.658 7.72-1.658 3.88 0 7.16 2.022 7.16 6.19v7.888c0 1.051.4 1.415 1.24 1.415Z",fill:"currentColor"})),aO||(aO=Yy.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M126.48 87.891c-1.56 0-2.12-.93-2.12-2.104 0-1.982 1.6-2.508 3.44-2.508.84 0 1.76.122 2.6.243-.12 3.034-2.08 4.37-3.92 4.37Z",fill:"currentColor"})),lO||(lO=Yy.createElement("path",{d:"M43.81 46.79H30.181V41.35h3.283V32.54c0-2.17-.383-3.721-1.149-4.657-.73-.935-1.788-1.402-3.174-1.402-1.606 0-2.864.505-3.776 1.515-.876 1.01-1.35 2.337-1.424 3.983v9.37h3.284v5.442H13.6v-5.442h3.284v-27.66h-3.284V8.191h10.343v17.168c1.642-2.918 4.288-4.376 7.936-4.376 2.335 0 4.36.71 6.075 2.132 1.715 1.42 2.572 3.628 2.572 6.62v11.614h3.284v5.442Zm31.964 0H65.156v-3.87c-1.642 2.917-4.287 4.376-7.935 4.376-2.335 0-4.36-.711-6.075-2.132-1.715-1.422-2.572-3.629-2.572-6.62V26.93H45.29v-5.442h10.343v14.25c0 2.207.347 3.778 1.04 4.713.73.898 1.788 1.346 3.175 1.346 1.678 0 2.973-.56 3.885-1.683.949-1.122 1.423-2.562 1.423-4.32V26.93h-3.995v-5.442h11.055v19.86h3.558v5.443Zm29.77-13.24c0 3.74-.967 6.976-2.901 9.706-1.897 2.73-4.706 4.096-8.428 4.096-3.758 0-6.403-1.459-7.936-4.377a34.365 34.365 0 0 1-.273 1.908 34.28 34.28 0 0 1-.274 1.908h-7.06c.255-1.31.475-2.619.657-3.928.182-1.309.274-2.6.274-3.87V13.688h-3.284V8.191h10.344v18.122c.656-1.46 1.641-2.712 2.955-3.76 1.35-1.047 3.138-1.57 5.363-1.57 3.102 0 5.637 1.103 7.608 3.31 1.97 2.207 2.955 5.292 2.955 9.257Zm-7.334.617c0-2.431-.51-4.283-1.532-5.554-1.022-1.272-2.372-1.908-4.05-1.908-1.897 0-3.375.71-4.433 2.132-1.022 1.422-1.532 3.067-1.532 4.937v.617c0 2.058.492 3.797 1.477 5.218 1.022 1.384 2.463 2.076 4.324 2.076 1.605 0 2.955-.598 4.05-1.795 1.13-1.234 1.696-3.142 1.696-5.723Zm32.278 4.881c0 2.805-1.095 4.9-3.284 6.284-2.152 1.346-4.962 2.02-8.427 2.02-1.789 0-3.595-.187-5.419-.561a21.349 21.349 0 0 1-5.144-1.908l.985-7.07 5.473.618v3.142c.656.224 1.35.374 2.079.449.73.037 1.278.056 1.643.056 1.349 0 2.517-.225 3.502-.673.985-.45 1.477-1.123 1.477-2.02 0-1.085-.748-1.795-2.243-2.132a102.972 102.972 0 0 0-5.2-1.01c-1.97-.337-3.703-1.029-5.199-2.076-1.496-1.047-2.244-2.824-2.244-5.33 0-3.104 1.168-5.18 3.503-6.227 2.372-1.085 4.816-1.627 7.334-1.627 3.284 0 6.366.766 9.248 2.3l.603 6.452-5.473.617-.438-3.535c-1.204-.41-2.499-.617-3.886-.617-.911 0-1.696.206-2.352.617-.622.375-.931.973-.931 1.796 0 1.085.711 1.814 2.134 2.188 1.459.337 3.137.673 5.035 1.01 1.934.336 3.613 1.028 5.035 2.076 1.46 1.01 2.189 2.73 2.189 5.161Z",fill:"currentColor"})))};function hO(){const[e,t]=(0,Yy.useState)(!1),n=(0,Yy.useCallback)((e=>{t(e.matches)}),[t]);return(0,Yy.useEffect)((()=>{const[e,i]=pt(n);return t(e.matches),i}),[n]),e}function pO(e){let{store:t,children:n}=e;return function(e){var t,n;const[i,r]=(0,Yy.useState)(null==e||null===(t=e.state)||void 0===t||null===(n=t.preferences)||void 0===n?void 0:n.theme);(0,Yy.useEffect)((()=>{function t(){var t,n;const o=null===(t=e.state)||void 0===t||null===(n=t.preferences)||void 0===n?void 0:n.theme;i!==o&&r(o)}return e&&e.addEventListener("statechanged",t),()=>{e&&e.removeEventListener("statechanged",t)}})),function(e){const t=hO();(0,Yy.useEffect)((()=>{const t=mt(e);if(!t)return;const n=[];for(const e in t.variables)Object.prototype.hasOwnProperty.call(t.variables,e)&&n.push(`--${e}: ${t.variables[e]};`);const i=document.createElement("style");return i.innerHTML=`:root {\n        ${n.join("\n")}\n      }`,document.head.appendChild(i),()=>{document.head.removeChild(i)}}),[e,t])}(i)}(t),n}function mO(e){let{className:t,forceConfigurableLogo:n}=e;const i=function(e){const t=ft();return(t?t.darkModeDefault:e)&&k.image("logo_dark")||k.image("logo")}(hO());return k.feature("show_cloud")&&!n?Yy.createElement(uO,{className:"hmc-logo"}):Yy.createElement("img",{className:t,alt:k.translation("app-name"),src:i})}function fO(e){let{center:t,bottom:n}=e;return Yy.createElement("div",{className:cO.loadingScreenLayout},Yy.createElement(O_,{center:!0,padding:!0,gap:"lg",className:cO.center},Yy.createElement(mO,{className:cO.logo}),t),n&&Yy.createElement(O_,{center:!0,className:cO.bottom},n))}var gO;function vO(){return vO=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},vO.apply(this,arguments)}pO.propTypes={store:sw().object,children:sw().node},mO.propTypes={className:sw().string,forceConfigurableLogo:sw().bool},fO.propTypes={center:sw().node,bottom:sw().node};const bO=e=>{let{title:t,titleId:n,...i}=e;return Yy.createElement("svg",vO({width:70,height:70,viewBox:"0 0 70 70",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":n},i),t?Yy.createElement("title",{id:n},t):null,gO||(gO=Yy.createElement("path",{d:"M12.284 57.665A32.14 32.14 0 0 1 3.39 40.032a32.311 32.311 0 0 1 3.065-19.547A31.861 31.861 0 0 1 20.307 6.49a31.414 31.414 0 0 1 19.349-3.096m18.06 8.94a32.14 32.14 0 0 1 8.894 17.634 32.311 32.311 0 0 1-3.065 19.548A31.86 31.86 0 0 1 49.693 63.51a31.413 31.413 0 0 1-19.348 3.096",stroke:"currentColor",strokeWidth:6})))};var yO={spinner:"Spinner__spinner__jvUtq"};function wO(){return Yy.createElement(bO,{className:yO.spinner})}function _O(e){let{message:t,infoMessages:n}=e;const i=function(e,t){void 0===t&&(t=5e3);const n=(0,Yy.useRef)(),[i,r]=(0,Yy.useState)(Math.round(Math.random()*(e.length-1))),o=(0,Yy.useCallback)((()=>{n.current=setTimeout((()=>{r((t=>(t+1)%e.length)),o()}),t)}),[r,e,t]);return(0,Yy.useEffect)((()=>(o(),()=>{clearTimeout(n.current)})),[o]),e[i]}(n);return Yy.createElement(fO,{center:Yy.createElement(Yy.Fragment,null,Yy.createElement(wO,null),Yy.createElement("p",null,t)),bottom:Yy.createElement(Yy.Fragment,null,Yy.createElement("h3",null,i.heading),Yy.createElement("p",null,i.message))})}function EO(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function AO(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?EO(Object(n),!0).forEach((function(t){SO(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):EO(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function SO(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function xO(e,t){switch(t.type){case"done-preloading":return AO(AO({},e),{},{donePreloading:!0});case"object-loading":return AO(AO({},e),{},{objectCount:e.objectCount+1});case"object-loaded":return AO(AO({},e),{},{loadedCount:e.loadedCount+1});case"all-objects-loaded":return AO(AO({},e),{},{allObjectsLoaded:!0});case"environment-loaded":return AO(AO({},e),{},{environmentLoaded:!0});case"network-connected":return AO(AO({},e),{},{networkConnected:!0});case"dialog-connected":return AO(AO({},e),{},{dialogConnected:!0})}}_O.propTypes={message:sw().node,infoMessages:sw().arrayOf(sw().shape({heading:sw().node.isRequired,message:sw().node.isRequired}))},_O.defaultProps={infoMessages:[]};const MO=(0,gE.vU)({default:{id:"loading-screen.default",defaultMessage:"Loading scene..."},loadingObjects:{id:"loading-screen.loading-objects",defaultMessage:"Loading objects {loadedCount}/{objectCount}"},connectingScene:{id:"loading-screen.connecting",defaultMessage:"Connecting to the scene..."},enteringRoom:{id:"loading-screen.entering-room",defaultMessage:"Entering room..."}}),PO=(0,z.Z)("newLoader");function CO(e){let{onLoaded:t,scene:n}=e;const i=(0,FE.Z)(),{loading:r,message:o}=function(e){const t=(0,Yy.useRef)(),n=APP.store.state.preferences.lazyLoadSceneMedia,[{environmentLoaded:i,networkConnected:r,dialogConnected:o,allObjectsLoaded:s,donePreloading:a,objectCount:l,loadedCount:c},d]=(0,Yy.useReducer)(xO,{objectCount:0,loadedCount:0,allObjectsLoaded:!1,environmentLoaded:!1,networkConnected:!1,dialogConnected:!1,donePreloading:!1,lazyLoadMedia:n}),u=n||PO||s,h=e.is("loaded")||i&&r&&o&&u&&a;let p="default";p=i?r&&o?u?"enteringRoom":"loadingObjects":"connectingScene":"default";const m=(0,Yy.useCallback)((()=>{clearTimeout(t.current),d({type:"object-loading"})}),[d]),f=(0,Yy.useCallback)((()=>{clearTimeout(t.current),d({type:"object-loaded"}),t.current=setTimeout((()=>{d({type:"all-objects-loaded"})}),1500)}),[d]),g=(0,Yy.useCallback)((()=>{d({type:"environment-loaded"})}),[d]),v=(0,Yy.useCallback)((()=>{d({type:"network-connected"})}),[d]),b=(0,Yy.useCallback)((()=>{d({type:"dialog-connected"})}),[d]);(0,Yy.useEffect)((()=>($d().then((()=>{d({type:"done-preloading"})})),()=>{})),[]),(0,Yy.useEffect)((()=>(h||(n||(e.addEventListener("model-loading",m),e.addEventListener("image-loading",m),e.addEventListener("pdf-loading",m),e.addEventListener("video-loading",m),e.addEventListener("model-loaded",f),e.addEventListener("image-loaded",f),e.addEventListener("pdf-loaded",f),e.addEventListener("video-loaded",f),e.addEventListener("model-error",f)),e.addEventListener("environment-scene-loaded",g),e.addEventListener("didConnectToNetworkedScene",v),e.addEventListener("didConnectToDialog",b)),()=>{n||(e.removeEventListener("model-loading",m),e.removeEventListener("image-loading",m),e.removeEventListener("pdf-loading",m),e.removeEventListener("video-loading",m),e.removeEventListener("model-loaded",f),e.removeEventListener("image-loaded",f),e.removeEventListener("pdf-loaded",f),e.removeEventListener("video-loaded",f),e.removeEventListener("model-error",f)),e.removeEventListener("environment-scene-loaded",g),e.removeEventListener("didConnectToNetworkedScene",v),e.removeEventListener("didConnectToDialog",b)})),[e,h,f,m,g,v,b,n]);const y=(0,FE.Z)().formatMessage(MO[p],{loadedCount:Math.min(c,l),objectCount:l});return(0,Yy.useEffect)((()=>{h&&e.addState("loaded")}),[e,h]),(0,Yy.useEffect)((()=>{}),[]),{loading:!h,message:y}}(n);(0,Yy.useEffect)((()=>{r||t()}),[r,t]);const s=(0,Yy.useMemo)((()=>[{heading:i.formatMessage({id:"loading-screen.heading.tip",defaultMessage:"Tip:"}),message:i.formatMessage({id:"loading-screen.message.keyboard-controls",defaultMessage:"Press the Q & E keys to turn left and right."})},{heading:i.formatMessage({id:"loading-screen.heading.whats-new",defaultMessage:"What's New?"}),message:i.formatMessage({id:"loading-screen.message.whats-new",defaultMessage:"You can now set the default locale in your preferences. <a>Read More</a>"},{a:e=>Yy.createElement("a",{href:"/whats-new",target:"_blank"},e)})}]),[i]);return Yy.createElement(_O,{message:o,infoMessages:s})}CO.propTypes={scene:sw().object.isRequired,onLoaded:sw().func.isRequired};var kO={"room-layout":"RoomLayout__room-layout__kTC2f",roomLayout:"RoomLayout__room-layout__kTC2f",main:"RoomLayout__main__YsUq9",sidebar:"RoomLayout__sidebar__c3nxk",viewport:"RoomLayout__viewport__UVY6l",toolbar:"RoomLayout__toolbar__HAuuI","modal-container":"RoomLayout__modal-container__Zn2lB",modalContainer:"RoomLayout__modal-container__Zn2lB",scene:"RoomLayout__scene__higS0","object-focused":"RoomLayout__object-focused__w_gE0",objectFocused:"RoomLayout__object-focused__w_gE0",streaming:"RoomLayout__streaming__e4Nkj"},OO={toolbar:"Toolbar__toolbar__YcMAi",content:"Toolbar__content__fDPmA"};const TO=["className","left","center","right"];function RO(){return RO=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},RO.apply(this,arguments)}function DO(e){let{className:t,left:n,center:i,right:r}=e,o=function(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}(e,TO);return Yy.createElement("div",RO({className:lw()(OO.toolbar,t)},o),Yy.createElement("div",{className:lw()(OO.content,OO.leftContent,Aw.showLg)},n),Yy.createElement("div",{className:lw()(OO.content,OO.centerContent)},i),Yy.createElement("div",{className:lw()(OO.content,OO.rightContent,Aw.showLg)},r))}DO.propTypes={className:sw().string,left:sw().node,center:sw().node,right:sw().node,hideLeft:sw().string,hideRight:sw().string};const jO=["className","viewportClassName","sidebar","sidebarClassName","toolbarLeft","toolbarCenter","toolbarRight","toolbarClassName","modal","viewport","objectFocused","streaming","viewportRef"];function LO(){return LO=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},LO.apply(this,arguments)}function IO(e){let{className:t,viewportClassName:n,sidebar:i,sidebarClassName:r,toolbarLeft:o,toolbarCenter:s,toolbarRight:a,toolbarClassName:l,modal:c,viewport:d,objectFocused:u,streaming:h,viewportRef:p}=e,m=function(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}(e,jO);return Yy.createElement("div",LO({className:lw()(kO.roomLayout,{[kO.objectFocused]:u},t)},m),i&&Yy.createElement("div",{className:lw()(kO.sidebar,r)},i),Yy.createElement("div",{className:lw()(kO.modalContainer,kO.viewport)},c),(o||s||a)&&Yy.createElement(DO,{className:lw()(kO.main,kO.toolbar,l),left:o,center:s,right:a}),Yy.createElement("div",{className:lw()(kO.main,kO.viewport,{[kO.streaming]:h},n),ref:p},d))}IO.propTypes={className:sw().string,viewportClassName:sw().string,sidebar:sw().node,sidebarClassName:sw().string,toolbarLeft:sw().node,toolbarCenter:sw().node,toolbarRight:sw().node,toolbarClassName:sw().string,modal:sw().node,viewport:sw().node,objectFocused:sw().bool,streaming:sw().bool,viewportRef:sw().any};var NO=n(91033);const FO=["store","scene"];function BO(){return BO=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},BO.apply(this,arguments)}function VO(e){let{store:t,scene:n}=e,i=function(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}(e,FO);const r=(0,Yy.useRef)();return function(e,t,n){const[i,r]=(0,Yy.useState)({width:oM(t),height:sM(t)});(0,Yy.useEffect)((()=>{function e(){r({width:oM(t),height:sM(t)})}return e(),t.addEventListener("statechanged",e),()=>{t.removeEventListener("statechanged",e)}}),[t]),(0,Yy.useEffect)((()=>{const t=new NO.Z((e=>{const t=n.renderer.xr.isPresenting,r=n.renderer.xr.enabled&&t;if(!n.camera||!n.canvas||n.is("vr-mode")&&(n.isMobile||r))return;const o=e[0].contentRect,s=function(e,t,n){if(n)return e;const i=window.devicePixelRatio,r=t.width/i,o=t.height/i;if(e.width<=r&&e.height<=o)return e;const s=Math.min(r/e.width,o/e.height);return{width:Math.round(e.width*s),height:Math.round(e.height*s)}}(o,i,r),a=n.canvas;a.style.width=o.width+"px",a.style.height=o.height+"px",n.camera.aspect=s.width/s.height,n.camera.updateProjectionMatrix(),n.emit("rendererresize",s,!1)}));return t.observe(e.current),()=>{t.disconnect()}}),[e,n,i]),(0,Yy.useEffect)((()=>{function e(){r({width:oM(t),height:sM(t)})}return Jx(e),()=>{eM(e)}}),[t])}(r,t,n),Yy.createElement(IO,BO({viewportRef:r},i))}var UO,HO,zO;function WO(){return WO=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},WO.apply(this,arguments)}VO.propTypes={store:sw().object.isRequired,scene:sw().object.isRequired};const qO=e=>{let{title:t,titleId:n,...i}=e;return Yy.createElement("svg",WO({width:20,height:20,viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":n},i),t?Yy.createElement("title",{id:n},t):null,UO||(UO=Yy.createElement("path",{d:"M6.875 6.875V5.312A1.563 1.563 0 0 1 8.438 3.75h8.124a1.563 1.563 0 0 1 1.563 1.562v9.375a1.562 1.562 0 0 1-1.563 1.563H8.438a1.562 1.562 0 0 1-1.562-1.563v-1.562",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})),HO||(HO=Yy.createElement("path",{d:"M10.625 13.125 13.75 10l-3.125-3.125",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})),zO||(zO=Yy.createElement("path",{d:"M1.875 10h11.25",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})))};var ZO;function GO(){return GO=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},GO.apply(this,arguments)}const YO=e=>{let{title:t,titleId:n,...i}=e;return Yy.createElement("svg",GO({width:20,height:20,viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":n},i),t?Yy.createElement("title",{id:n},t):null,ZO||(ZO=Yy.createElement("path",{d:"M17.714 4H2.033C1.466 4 1 4.466 1 5.033v9.506c0 .567.466 1.032 1.033 1.032h4.464c.557 0 1.043-.354 1.215-.88l1.063-3.18c.395-1.173 2.045-1.173 2.44 0l1.063 3.18c.172.526.668.88 1.225.88h4.464c.567 0 1.033-.465 1.033-1.032V5.286C19 4.577 18.423 4 17.714 4ZM6.477 11.471c-1.782.891-3.553-.87-2.663-2.662.152-.314.405-.567.72-.719 1.781-.89 3.553.87 2.662 2.662a1.643 1.643 0 0 1-.72.72Zm9 0c-1.782.891-3.553-.87-2.663-2.662.152-.314.405-.567.72-.719 1.781-.89 3.553.87 2.662 2.662a1.643 1.643 0 0 1-.72.72Z",fill:"currentColor"})))};var QO,XO;function KO(){return KO=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},KO.apply(this,arguments)}const $O=e=>{let{title:t,titleId:n,...i}=e;return Yy.createElement("svg",KO({width:20,height:20,viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":n},i),t?Yy.createElement("title",{id:n},t):null,QO||(QO=Yy.createElement("path",{d:"M9.987 4.375c-3.045 0-6.168 1.762-8.626 5.286a.625.625 0 0 0-.011.695c1.89 2.957 4.97 5.27 8.637 5.27 3.626 0 6.77-2.32 8.663-5.284a.63.63 0 0 0 0-.683c-1.896-2.93-5.064-5.284-8.663-5.284Z",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})),XO||(XO=Yy.createElement("path",{d:"M10 13.125a3.125 3.125 0 1 0 0-6.25 3.125 3.125 0 0 0 0 6.25Z",stroke:"currentColor",strokeWidth:1.5,strokeMiterlimit:10})))};var JO;function eT(){return eT=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},eT.apply(this,arguments)}const tT=e=>{let{title:t,titleId:n,...i}=e;return Yy.createElement("svg",eT({width:20,height:20,viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":n},i),t?Yy.createElement("title",{id:n},t):null,JO||(JO=Yy.createElement("path",{d:"M17.84 9.464 16.823 9.3a.313.313 0 0 1-.258-.267c-.02-.125-.039-.25-.066-.371a.315.315 0 0 1 .152-.337l.902-.5a.314.314 0 0 0 .152-.388l-.156-.43a.31.31 0 0 0-.367-.195l-1.012.195a.313.313 0 0 1-.335-.16 7.177 7.177 0 0 0-.188-.329.319.319 0 0 1 .028-.372l.675-.779a.313.313 0 0 0 .012-.415l-.293-.351a.308.308 0 0 0-.41-.06l-.886.533a.312.312 0 0 1-.367-.035 8.649 8.649 0 0 0-.289-.243.312.312 0 0 1-.098-.356l.367-.966a.312.312 0 0 0-.126-.397l-.399-.23a.312.312 0 0 0-.406.086l-.65.814a.28.28 0 0 1-.332.097s-.218-.09-.383-.145a.312.312 0 0 1-.213-.3l.015-1.034a.315.315 0 0 0-.257-.329l-.453-.078a.315.315 0 0 0-.356.22l-.336.978a.312.312 0 0 1-.304.211h-.383a.315.315 0 0 1-.304-.211l-.336-.978a.315.315 0 0 0-.355-.22l-.453.078a.315.315 0 0 0-.258.33l.016 1.033a.312.312 0 0 1-.215.3c-.09.036-.285.11-.379.146-.109.039-.238.007-.343-.114l-.645-.795a.313.313 0 0 0-.406-.084l-.399.23a.31.31 0 0 0-.129.395l.368.967a.315.315 0 0 1-.098.355c-.098.079-.195.16-.29.243a.312.312 0 0 1-.366.035l-.873-.54a.312.312 0 0 0-.41.059l-.293.351a.313.313 0 0 0 .012.415l.675.78a.312.312 0 0 1 .027.371 3.948 3.948 0 0 0-.187.329.317.317 0 0 1-.336.16l-1.011-.195a.312.312 0 0 0-.367.195l-.156.43a.314.314 0 0 0 .152.387l.9.501a.31.31 0 0 1 .153.337c-.023.125-.047.247-.066.372a.316.316 0 0 1-.258.266l-1.019.164a.316.316 0 0 0-.277.31v.457a.307.307 0 0 0 .277.31l1.019.164a.312.312 0 0 1 .258.266c.02.125.039.25.066.372a.315.315 0 0 1-.152.336l-.902.502a.314.314 0 0 0-.153.387l.157.43a.31.31 0 0 0 .367.195l1.011-.195a.313.313 0 0 1 .336.16c.058.11.12.22.187.33a.319.319 0 0 1-.027.371l-.676.78a.313.313 0 0 0-.011.415l.292.351a.308.308 0 0 0 .41.06l.887-.533a.313.313 0 0 1 .367.035c.093.082.191.164.289.243a.313.313 0 0 1 .097.356l-.367.966a.312.312 0 0 0 .13.396l.398.23a.313.313 0 0 0 .405-.086l.656-.806c.082-.101.215-.144.32-.101.133.054.223.085.387.14a.313.313 0 0 1 .215.302l-.016 1.033a.315.315 0 0 0 .258.329l.453.078a.316.316 0 0 0 .355-.22l.336-.976a.313.313 0 0 1 .304-.211h.383a.315.315 0 0 1 .304.211l.336.977a.316.316 0 0 0 .356.219l.453-.078a.315.315 0 0 0 .257-.33l-.015-1.032a.312.312 0 0 1 .214-.302c.164-.055.274-.098.375-.137.102-.039.227-.039.325.082l.663.818a.312.312 0 0 0 .408.086l.398-.231a.31.31 0 0 0 .13-.396l-.368-.966a.315.315 0 0 1 .098-.357c.097-.078.195-.16.289-.242a.312.312 0 0 1 .367-.035l.883.534a.312.312 0 0 0 .41-.06l.293-.35a.312.312 0 0 0-.012-.416l-.676-.779a.312.312 0 0 1-.027-.372c.066-.105.129-.214.188-.328a.318.318 0 0 1 .335-.16l1.012.195a.312.312 0 0 0 .367-.196l.156-.43a.315.315 0 0 0-.152-.387l-.902-.5a.31.31 0 0 1-.153-.337c.024-.125.047-.247.067-.372a.315.315 0 0 1 .257-.266l1.02-.164a.316.316 0 0 0 .277-.31v-.458a.323.323 0 0 0-.284-.302ZM10 4.375A5.618 5.618 0 0 1 15.446 8.6a.626.626 0 0 1-.606.776h-4.111a.625.625 0 0 1-.544-.316L8.15 5.477a.625.625 0 0 1 .385-.914 5.74 5.74 0 0 1 1.467-.188ZM4.377 10A5.625 5.625 0 0 1 6.08 5.96a.625.625 0 0 1 .983.136l2.04 3.592a.625.625 0 0 1 0 .62L7.048 13.89a.625.625 0 0 1-.983.13A5.624 5.624 0 0 1 4.376 10ZM10 15.625a5.744 5.744 0 0 1-1.492-.193.626.626 0 0 1-.381-.916l2.054-3.576a.625.625 0 0 1 .542-.313h4.117a.625.625 0 0 1 .606.777A5.62 5.62 0 0 1 10 15.625Z",fill:"currentColor"})))};var nT={content:"RoomEntryModal__content__w5f0z","logo-container":"RoomEntryModal__logo-container__fYEi5",logoContainer:"RoomEntryModal__logo-container__fYEi5",logo:"RoomEntryModal__logo__qz2Xy","room-name":"RoomEntryModal__room-name__z4FVW",roomName:"RoomEntryModal__room-name__z4FVW",buttons:"RoomEntryModal__buttons__NvzXp"};const iT=["className","roomName","showJoinRoom","onJoinRoom","showEnterOnDevice","onEnterOnDevice","showSpectate","onSpectate","showRoomSettings","onRoomSettings"];function rT(){return rT=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},rT.apply(this,arguments)}function oT(e){let{className:t,roomName:n,showJoinRoom:i,onJoinRoom:r,showEnterOnDevice:o,onEnterOnDevice:s,showSpectate:a,onSpectate:l,showRoomSettings:c,onRoomSettings:d}=e,u=function(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}(e,iT);const h=(0,WP.P)();return Yy.createElement(N_,rT({className:lw()(nT.roomEntryModal,t),disableFullscreen:!0},u),Yy.createElement(O_,{center:!0,className:nT.content},"sm"!==h&&"md"!==h&&Yy.createElement("div",{className:nT.logoContainer},Yy.createElement(mO,{className:nT.logo})),Yy.createElement("div",{className:nT.roomName},Yy.createElement("h5",null,Yy.createElement(uw.Z,{id:"room-entry-modal.room-name-label",defaultMessage:"Room Name"})),Yy.createElement("p",null,n)),Yy.createElement(O_,{center:!0,className:nT.buttons},i&&Yy.createElement(t_,{preset:"accent4",onClick:r},Yy.createElement(qO,null),Yy.createElement("span",null,Yy.createElement(uw.Z,{id:"room-entry-modal.join-room-button",defaultMessage:"Join Room"}))),o&&Yy.createElement(t_,{preset:"accent5",onClick:s},Yy.createElement(YO,null),Yy.createElement("span",null,Yy.createElement(uw.Z,{id:"room-entry-modal.enter-on-device-button",defaultMessage:"Enter On Device"}))),a&&Yy.createElement(t_,{preset:"accent2",onClick:l},Yy.createElement($O,null),Yy.createElement("span",null,Yy.createElement(uw.Z,{id:"room-entry-modal.spectate-button",defaultMessage:"Spectate"}))),c&&"sm"!==h&&Yy.createElement(Yy.Fragment,null,Yy.createElement("hr",{className:Aw.showLg}),Yy.createElement(t_,{preset:"transparent",className:Aw.showLg,onClick:d},Yy.createElement(tT,null),Yy.createElement("span",null,Yy.createElement(uw.Z,{id:"room-entry-modal.room-settings-button",defaultMessage:"Room Settings"})))))))}oT.propTypes={className:sw().string,roomName:sw().string.isRequired,showJoinRoom:sw().bool,onJoinRoom:sw().func,showEnterOnDevice:sw().bool,onEnterOnDevice:sw().func,showSpectate:sw().bool,onSpectate:sw().func,showRoomSettings:sw().bool,onRoomSettings:sw().func},oT.defaultProps={showJoinRoom:!0,showEnterOnDevice:!0,showSpectate:!0,showRoomSettings:!0};const sT=["className","shortUrl","loadingCode","code","headsetConnected","unsupportedBrowser","onEnterOnConnectedHeadset","onBack"];function aT(){return aT=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},aT.apply(this,arguments)}function lT(e){let{className:t,shortUrl:n,loadingCode:i,code:r,headsetConnected:o,unsupportedBrowser:s,onEnterOnConnectedHeadset:a,onBack:l}=e,c=function(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}(e,sT);const d=(0,FE.Z)();return Yy.createElement(N_,aT({title:Yy.createElement(uw.Z,{id:"enter-on-device-modal.title",defaultMessage:"Enter on Device"}),beforeTitle:Yy.createElement(Kw,{onClick:l}),className:t},c),Yy.createElement(O_,{center:!i||"both",padding:!0,grow:!0},i?Yy.createElement("b",null,Yy.createElement(uw.Z,{id:"enter-on-device-modal.generating-code",defaultMessage:"Generating join code..."})):Yy.createElement(Yy.Fragment,null,Yy.createElement("b",null,Yy.createElement(uw.Z,{id:"enter-on-device-modal.heading",defaultMessage:"Enter on Wireless Headset / Phone"})),Yy.createElement("small",null,Yy.createElement(uw.Z,{id:"enter-on-device-modal.short-url-directions",defaultMessage:"In your device's web browser, go to:"})),Yy.createElement("div",{className:"EnterOnDeviceModal__short-url-container__tK_03"},n),Yy.createElement("small",null,Yy.createElement(uw.Z,{id:"enter-on-device-modal.code-directions",defaultMessage:"Then, enter this one-time code:"})),Yy.createElement("div",{className:"EnterOnDeviceModal__code-container__RRgUe"},r.split("").map(((e,t)=>Yy.createElement("div",{key:t,className:"EnterOnDeviceModal__code-letter__nSeNJ"},e)))),Yy.createElement("strong",null,Yy.createElement(uw.Z,{id:"enter-on-device-modal.data-transfer",defaultMessage:"Your account and avatar will be transferred to the device."})),Yy.createElement("strong",null,Yy.createElement(uw.Z,{id:"enter-on-device-modal.keep-page-open",defaultMessage:"Keep this page open to use this code."})),o&&Yy.createElement(Yy.Fragment,null,Yy.createElement("hr",{"data-or-text":d.formatMessage({id:"enter-on-device-modal.divider-label",defaultMessage:"or"})}),Yy.createElement("b",null,Yy.createElement(uw.Z,{id:"enter-on-device-modal.headset-connected-heading",defaultMessage:"Enter on Connected Headset"})),s?Yy.createElement(Yy.Fragment,null,Yy.createElement("small",null,Yy.createElement(uw.Z,{id:"enter-on-device-modal.unsupported-browser",defaultMessage:"WebVR isn't supported in this browser, to enter with Oculus or SteamVR, use Firefox."})),Yy.createElement(t_,{as:"a",preset:"accent2",href:"https://www.mozilla.org/firefox/",target:"_blank",rel:"noreferrer noopener"},Yy.createElement("span",null,Yy.createElement(uw.Z,{id:"enter-on-device-modal.download-firefox-button",defaultMessage:"Download Firefox"})))):Yy.createElement(Yy.Fragment,null,Yy.createElement("small",null,Yy.createElement(uw.Z,{id:"enter-on-device-modal.headset-connected-message",defaultMessage:"You have a VR headset connected to this device."})),Yy.createElement(t_,{preset:"accent5",onClick:a},Yy.createElement(YO,null),Yy.createElement("span",null,Yy.createElement(uw.Z,{id:"enter-on-device-modal.enter-in-vr-button",defaultMessage:"Enter in VR"}))))))))}var cT;function dT(){return dT=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},dT.apply(this,arguments)}lT.propTypes={className:sw().string,shortUrl:sw().string.isRequired,loadingCode:sw().bool,code:sw().string,headsetConnected:sw().bool,unsupportedBrowser:sw().bool,onEnterOnConnectedHeadset:sw().func,onBack:sw().func};const uT=e=>{let{title:t,titleId:n,...i}=e;return Yy.createElement("svg",dT({width:20,height:20,viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":n},i),t?Yy.createElement("title",{id:n},t):null,cT||(cT=Yy.createElement("path",{d:"M9.283 7.498h-2.72a.313.313 0 0 0-.313.313v4.375a.312.312 0 0 0 .312.312h2.721c.144 0 .284.05.396.142l3.573 2.93a.312.312 0 0 0 .498-.253V4.68a.313.313 0 0 0-.498-.252L9.68 7.357a.625.625 0 0 1-.396.141Z",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})))};var hT,pT,mT,fT;function gT(){return gT=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},gT.apply(this,arguments)}const vT=e=>{let{title:t,titleId:n,...i}=e;return Yy.createElement("svg",gT({width:20,height:20,viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":n},i),t?Yy.createElement("title",{id:n},t):null,hT||(hT=Yy.createElement("path",{d:"M9.688 2.502a7.188 7.188 0 1 0 0 14.376 7.188 7.188 0 0 0 0-14.376Z",stroke:"currentColor",strokeWidth:1.5,strokeMiterlimit:10})),pT||(pT=Yy.createElement("path",{d:"M8.594 8.594h1.25v4.532",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})),mT||(mT=Yy.createElement("path",{d:"M8.125 13.281h3.437",stroke:"currentColor",strokeWidth:1.5,strokeMiterlimit:10,strokeLinecap:"round"})),fT||(fT=Yy.createElement("path",{d:"M9.687 5.08a1.016 1.016 0 1 0 0 2.03 1.016 1.016 0 0 0 0-2.03Z",fill:"currentColor"})))};var bT={content:"MicSetupModal__content__HyAJG","audio-check-container":"MicSetupModal__audio-check-container__DqNni",audioCheckContainer:"MicSetupModal__audio-check-container__DqNni","audio-io-container":"MicSetupModal__audio-io-container__p_zLQ",audioIoContainer:"MicSetupModal__audio-io-container__p_zLQ","icon-enabled":"MicSetupModal__icon-enabled__6YNrZ",iconEnabled:"MicSetupModal__icon-enabled__6YNrZ","icon-disabled":"MicSetupModal__icon-disabled__Ye6un",iconDisabled:"MicSetupModal__icon-disabled__Ye6un","icon-container":"MicSetupModal__icon-container__Cgq7i",iconContainer:"MicSetupModal__icon-container__Cgq7i","voice-chat-disabled":"MicSetupModal__voice-chat-disabled__QpjpD",voiceChatDisabled:"MicSetupModal__voice-chat-disabled__QpjpD","text-disabled":"MicSetupModal__text-disabled__iflBg",textDisabled:"MicSetupModal__text-disabled__iflBg","action-container":"MicSetupModal__action-container__h3C_p",actionContainer:"MicSetupModal__action-container__h3C_p","selection-container":"MicSetupModal__selection-container__inBu_",selectionContainer:"MicSetupModal__selection-container__inBu_","selection-input":"MicSetupModal__selection-input__mrlP_",selectionInput:"MicSetupModal__selection-input__mrlP_",popover:"MicSetupModal__popover__bua5Q","popover-arrow":"MicSetupModal__popover-arrow__eaSQH",popoverArrow:"MicSetupModal__popover-arrow__eaSQH","popover-content":"MicSetupModal__popover-content__PsqFV",popoverContent:"MicSetupModal__popover-content__PsqFV","error-title":"MicSetupModal__error-title__ee_La",errorTitle:"MicSetupModal__error-title__ee_La","spinner-container":"MicSetupModal__spinner-container__Adr6x",spinnerContainer:"MicSetupModal__spinner-container__Adr6x","info-icon":"MicSetupModal__info-icon__Uu81j",infoIcon:"MicSetupModal__info-icon__Uu81j","level-bar":"MicSetupModal__level-bar__Qf5Gj",levelBar:"MicSetupModal__level-bar__Qf5Gj"};const yT=["className","label","description","disabled"];function wT(){return wT=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},wT.apply(this,arguments)}const _T=(0,Yy.memo)((0,Yy.forwardRef)(((e,t)=>{let{className:n,label:i,description:r,disabled:o}=e,s=function(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}(e,yT);return Yy.createElement("label",{className:lw()("ToggleInput__toggle-input__ObbBV",{ToggleInput__disabled__sDnmL:o},n)},Yy.createElement("input",wT({type:"checkbox",disabled:o,ref:t},s)),Yy.createElement("div",{className:lw()("ToggleInput__track__EfEPA")},Yy.createElement("div",{className:"ToggleInput__button__CHW2n"})),i&&Yy.createElement("div",{className:"ToggleInput__label-container__uv2am"},Yy.createElement("p",{className:"ToggleInput__label__kDiUc"},i),r&&Yy.createElement("p",{className:"ToggleInput__description__BoziI"},r)))})));_T.propTypes={label:sw().node,description:sw().node,checked:sw().bool,disabled:sw().bool,className:sw().string};const ET=["className","microphoneOptions","onChangeMicrophone","speakerOptions","onChangeSpeaker","isMicrophoneEnabled","onPlaySound","isMicrophoneMuted","onChangeMicrophoneMuted","onEnterRoom","onBack","permissionStatus","isAudioInputSelectAvailable","isAudioOutputSelectAvailable","micLevelBar","speakerLevelBar","canVoiceChat"];function AT(){return AT=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},AT.apply(this,arguments)}const ST=(0,gE.vU)({microphoneSetup:{id:"mic-setup-modal.title",defaultMessage:"Microphone Setup"},audioSetup:{id:"mic-setup-modal.title-audio",defaultMessage:"Audio Setup"}});function xT(e){let{className:t,microphoneOptions:n,onChangeMicrophone:i,speakerOptions:r,onChangeSpeaker:o,isMicrophoneEnabled:s,onPlaySound:a,isMicrophoneMuted:l,onChangeMicrophoneMuted:c,onEnterRoom:d,onBack:u,permissionStatus:h,isAudioInputSelectAvailable:p,isAudioOutputSelectAvailable:m,micLevelBar:f,speakerLevelBar:g,canVoiceChat:v}=e,b=function(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}(e,ET);const y=s?bT.iconEnabled:bT.iconDisabled,w=(0,FE.Z)();return Yy.createElement(N_,AT({title:w.formatMessage(ST[v?"microphoneSetup":"audioSetup"]),beforeTitle:Yy.createElement(Kw,{onClick:u}),className:t},b),Yy.createElement(O_,{center:!0,padding:!0,grow:!0,className:bT.content},Yy.createElement("p",null,Yy.createElement(uw.Z,{id:"mic-setup-modal.check-mic",defaultMessage:"Check your microphone and audio before entering."})),Yy.createElement("div",{className:bT.audioCheckContainer},Yy.createElement("div",{className:bT.audioIoContainer},v&&Yy.createElement(Yy.Fragment,null,Yy.createElement("div",{className:bT.iconContainer},Yy.createElement("div",null,h===Fe.PROMPT&&Yy.createElement("div",{className:bT.spinnerContainer},Yy.createElement(wO,null)),h===Fe.GRANTED&&s&&!l?Yy.createElement(EM,{className:y}):Yy.createElement(fM,{className:y})),h===Fe.GRANTED&&Yy.createElement(Yy.Fragment,null," ",f)),Yy.createElement("div",{className:bT.actionContainer},h===Fe.GRANTED?Yy.createElement(Yy.Fragment,null,Yy.createElement(_T,{label:Yy.createElement(uw.Z,{id:"mic-setup-modal.mute-mic-toggle-v2",defaultMessage:"Mute"}),checked:l,onChange:c}),Yy.createElement(GP,{title:"Info",content:Yy.createElement(O_,{className:bT.popoverContent},Yy.createElement(uw.Z,{id:"mic-setup-modal.mute-mic-info",defaultMessage:"You can mute anytime after you enter the room"})),placement:"top",showHeader:!1,disableFullscreen:!0,popoverClass:bT.popover,arrowClass:bT.popoverArrow},(e=>{let{openPopover:t,closePopover:n,triggerRef:i}=e;return Yy.createElement("div",{ref:i},Yy.createElement(vT,{className:bT.infoIcon,onMouseEnter:t,onMouseLeave:n}))}))):h===Fe.PROMPT&&Yy.createElement("p",null,Yy.createElement(uw.Z,{id:"mic-setup-modal.mic-permission-prompt",defaultMessage:"Requesting access to your microphone..."}))||h===Fe.DENIED&&Yy.createElement("p",null,Yy.createElement("span",{className:bT.errorTitle},Yy.createElement(uw.Z,{id:"mic-setup-modal.error-title",defaultMessage:"Microphone access was blocked.",className:bT.errorTitle}))," ",Yy.createElement(uw.Z,{id:"mic-setup-modal.error-description",defaultMessage:"To talk in Hubs you will need to allow microphone access."}))),h===Fe.GRANTED&&p&&Yy.createElement("div",{className:bT.selectionContainer},Yy.createElement("p",{style:{alignSelf:"start"}},Yy.createElement(uw.Z,{id:"mic-setup-modal.microphone-text",defaultMessage:"Microphone"})),Yy.createElement(FS,AT({className:bT.selectionInput,buttonClassName:bT.selectionInput,onChange:i},n))))||Yy.createElement("div",{className:bT.voiceChatDisabled},Yy.createElement(fM,{className:bT.iconDisabled}),Yy.createElement("p",{className:bT.textDisabled},Yy.createElement(uw.Z,{id:"mic-setup-modal.voice-chat-disabled",defaultMessage:"Voice chat is <bold>turned off</bold> for this room.",values:{bold:e=>Yy.createElement("b",null,e)}})))),Yy.createElement("div",{className:bT.audioIoContainer},Yy.createElement("div",{className:bT.iconContainer},Yy.createElement(uT,{className:bT.iconEnabled,style:{marginRight:"5px"}}),Yy.createElement(Yy.Fragment,null," ",g," ")),Yy.createElement("div",{className:bT.actionContainer},Yy.createElement(t_,{preset:"basic",onClick:a,sm:!0},Yy.createElement(uw.Z,{id:"mic-setup-modal.test-audio-button",defaultMessage:"Test Audio"}))),h===Fe.GRANTED&&m&&Yy.createElement("div",{className:bT.selectionContainer},Yy.createElement("p",{style:{alignSelf:"start"}},Yy.createElement(uw.Z,{id:"mic-setup-modal.speakers-text",defaultMessage:"Speakers"})),Yy.createElement(FS,AT({onChange:o,className:bT.selectionInput,buttonClassName:bT.selectionInput},r))))),Yy.createElement(t_,{preset:"primary",onClick:d},Yy.createElement(uw.Z,{id:"mic-setup-modal.enter-room-button",defaultMessage:"Enter Room"}))))}function MT(e){const t=APP.mediaDevicesManager,[n,i]=(0,Yy.useState)(!t.isMicEnabled),[r,o]=(0,Yy.useState)(APP.mediaDevicesManager.isMicShared),[s,a]=(0,Yy.useState)(t.getPermissionsStatus(Be.MICROPHONE));return(0,Yy.useEffect)((()=>{const n=e=>{let{enabled:t}=e;i(!t)};APP.dialog.on("mic-state-changed",n);const r=()=>{o(!0)},s=()=>{o(!1)};e.addEventListener(Ne.MIC_SHARE_ENDED,s),e.addEventListener(Ne.MIC_SHARE_STARTED,r);const l=e=>{let{mediaDevice:t,status:n}=e;t===Be.MICROPHONE&&a(n)};return t.on(Ne.PERMISSIONS_STATUS_CHANGED,l),()=>{APP.dialog.off("mic-state-changed",n),e.removeEventListener(Ne.MIC_SHARE_ENDED,s),e.removeEventListener(Ne.MIC_SHARE_STARTED,r),t.off(Ne.PERMISSIONS_STATUS_CHANGED,l)}}),[i,o,a,e,t]),{isMicMuted:n,toggleMute:(0,Yy.useCallback)((()=>{t.isMicShared?t.toggleMic():t.startMicShare({unmute:!0})}),[t]),isMicEnabled:r,permissionStatus:s}}function PT(e){const t=APP.mediaDevicesManager,[n,i]=(0,Yy.useState)({value:t.selectedMicDeviceId,options:t.micDevicesOptions});return(0,Yy.useEffect)((()=>{const n=()=>{i({value:t.selectedMicDeviceId,options:t.micDevicesOptions})},r=()=>{i({value:t.selectedMicDeviceId,options:t.micDevicesOptions})};e.addEventListener(Ne.MIC_SHARE_ENDED,r),e.addEventListener(Ne.MIC_SHARE_STARTED,n);const o=e=>{let{mediaDevice:n}=e;n===Be.MICROPHONE&&i({value:t.selectedMicDeviceId,options:t.micDevicesOptions})};t.on(Ne.PERMISSIONS_STATUS_CHANGED,o);const s=()=>{i({value:t.selectedMicDeviceId,options:t.micDevicesOptions})};return t.on(Ne.DEVICE_CHANGE,s),i({value:t.selectedMicDeviceId,options:t.micDevicesOptions}),()=>{e.removeEventListener(Ne.MIC_SHARE_ENDED,r),e.removeEventListener(Ne.MIC_SHARE_STARTED,n),t.off(Ne.PERMISSIONS_STATUS_CHANGED,o),t.off(Ne.DEVICE_CHANGE,s)}}),[i,e,t]),{micDeviceChanged:(0,Yy.useCallback)((e=>{i({value:t.selectedMicDeviceId,options:t.micDevicesOptions}),t.startMicShare({deviceId:e})}),[t]),micDevices:n}}function CT(e){let{scene:t,sound:n}=e;const i=t.systems["hubs-systems"].soundEffectsSystem,r=(0,Yy.useRef)(t.systems["hubs-systems"].audioSystem.mixerAnalyser);return{playSound:(0,Yy.useCallback)((()=>{i.playSoundOneShot(n).connect(r.current)}),[n,i])}}function kT(){const e=APP.mediaDevicesManager,[t,n]=(0,Yy.useState)({value:e.selectedSpeakersDeviceId,options:e.outputDevicesOptions});return(0,Yy.useEffect)((()=>{const t=t=>{let{mediaDevice:i}=t;i===Be.MICROPHONE&&n({value:e.selectedSpeakersDeviceId,options:e.outputDevicesOptions})};e.on(Ne.PERMISSIONS_STATUS_CHANGED,t);const i=()=>{n({value:e.selectedSpeakersDeviceId,options:e.outputDevicesOptions})};return e.on(Ne.DEVICE_CHANGE,i),n({value:e.selectedSpeakersDeviceId,options:e.outputDevicesOptions}),()=>{e.off(Ne.PERMISSIONS_STATUS_CHANGED,t),e.off(Ne.DEVICE_CHANGE,i)}}),[n,e]),{speakerDeviceChanged:(0,Yy.useCallback)((t=>{e.changeAudioOutput(t),n({value:e.selectedSpeakersDeviceId,options:e.outputDevicesOptions})}),[e]),speakerDevices:t}}xT.propTypes={className:sw().string,onPlaySound:sw().func,micLevelBar:sw().node,speakerLevelBar:sw().node,isMicrophoneEnabled:sw().bool,isMicrophoneMuted:sw().bool,onChangeMicrophoneMuted:sw().func,microphoneOptions:sw().object,onChangeMicrophone:sw().func,speakerOptions:sw().object,onChangeSpeaker:sw().func,onEnterRoom:sw().func,onBack:sw().func,permissionStatus:sw().string,isAudioInputSelectAvailable:sw().bool,isAudioOutputSelectAvailable:sw().bool,canVoiceChat:sw().bool},xT.defaultProps={permissionStatus:Fe.PROMPT};var OT={"level-bar-container":"LevelBar__level-bar-container__mZX3P",levelBarContainer:"LevelBar__level-bar-container__mZX3P","level-bar-border":"LevelBar__level-bar-border__iciQ1",levelBarBorder:"LevelBar__level-bar-border__iciQ1","level-bar":"LevelBar__level-bar__AhD98",levelBar:"LevelBar__level-bar__AhD98"};const TT=(0,Yy.forwardRef)(((e,t)=>{let{className:n}=e;return Yy.createElement("div",{className:lw()(OT.levelBarContainer,n)},Yy.createElement("div",{className:OT.levelBarBorder}),Yy.createElement("div",{ref:t,className:OT.levelBar}))}));TT.propTypes={className:sw().string};var RT=n(99477);const DT=.08,jT=(e,t)=>{e.getByteTimeDomainData(t);let n=0;for(let e=0;e<t.length;e++){const i=(t[e]-128)/128;n+=i*i}return Math.sqrt(n/t.length)};function LT(e){let{analyser:t,update:n,updateRate:i=50}=e;const r=(0,Yy.useRef)(),o=(0,Yy.useRef)({levels:[],volume:0,prevVolume:0,max:0});(0,Yy.useEffect)((()=>{if(!n)return;r.current||(r.current=Ug()(2*i)),t.fftSize=32,o.current.levels=new Uint8Array(t.fftSize);let e=0;const s=setInterval((()=>{!function(e,t){const n=jT(e,t.levels),i=Math.log(RT.MathUtils.mapLinear(n,0,1,1,Math.E));t.volume=i<DT?0:i;const r=t.volume>t.prevVolume?.35:.3;t.volume=r*t.volume+(1-r)*t.prevVolume,t.prevVolume=t.volume}(t,o.current),o.current.max=Math.max(o.current.volume,o.current.max),r.current.push(Date.now(),o.current.volume);const i=r.current.movingAverage(),s=0===o.current.max?0:i/o.current.max,a=Math.max(Math.abs(e-s)>.05?s:e,.1);e=a,n(a)}),i);return()=>{clearInterval(s)}}),[t,n,i])}function IT(e){let{scene:t,type:n,className:i}=e;const r=(0,Yy.useRef)(),o=(0,Yy.useCallback)((e=>{const t=r.current;if(t){const n=100*e;t.clientWidth>t.clientHeight?t.style.clipPath=`polygon(0% 100%, ${n}% 100%, ${n}% 0%, 0% 0%)`:t.style.clipPath=`polygon(0% 100%, 100% 100%, 100% ${100-n}%, 0% ${100-n}%)`}}),[]);return LT({analyser:"mic"==n?t.systems["hubs-systems"].audioSystem.outboundAnalyser:t.systems["hubs-systems"].audioSystem.mixerAnalyser,update:o}),Yy.createElement(TT,{ref:r,className:lw()(OT.levelBarContainer,i)})}function NT(e){const[t,n]=(0,Yy.useState)(APP.hubChannel.can(e));return(0,Yy.useEffect)((()=>{const t=()=>n(APP.hubChannel.can(e));return APP.hubChannel.addEventListener("permissions_updated",t),()=>{APP.hubChannel.removeEventListener("permissions_updated",t)}}),[e,n]),t}IT.propTypes={scene:sw().object.isRequired,type:sw().oneOf(["mic","mixer"]),className:sw().string};const FT=["scene"];function BT(){return BT=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},BT.apply(this,arguments)}function VT(e){let{scene:t}=e,n=function(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}(e,FT);const{isMicEnabled:i,permissionStatus:r}=MT(t),{micDeviceChanged:o,micDevices:s}=PT(t),a=NT("voice_chat"),{speakerDeviceChanged:l,speakerDevices:c}=kT(),{playSound:d}=CT({scene:t,sound:Dm}),[u,h]=(0,Yy.useState)(APP.store.state.preferences.muteMicOnEntry),p=(0,Yy.useCallback)((e=>{let{target:{checked:t}}=e;h(t),APP.store.update({preferences:{muteMicOnEntry:t}})}),[]);return Yy.createElement(xT,BT({micLevelBar:Yy.createElement(IT,{scene:t,type:"mic",className:bT.levelBar}),speakerLevelBar:Yy.createElement(IT,{scene:t,type:"mixer",className:bT.levelBar}),onPlaySound:d,isMicrophoneEnabled:i,isMicrophoneMuted:u,permissionStatus:r,microphoneOptions:s,speakerOptions:c,onChangeMicrophone:o,onChangeSpeaker:l,onChangeMicrophoneMuted:p,isAudioInputSelectAvailable:Gx.isAudioInputSelectEnabled,isAudioOutputSelectAvailable:Gx.isAudioOutputSelectEnabled,canVoiceChat:a},n))}VT.propTypes={scene:sw().object.isRequired};var UT={"invite-popover":"InvitePopover__invite-popover__hQEWt",invitePopover:"InvitePopover__invite-popover__hQEWt"},HT=n(16248),zT={"copy-button":"CopyableTextInputField__copy-button__KHz3G",copyButton:"CopyableTextInputField__copy-button__KHz3G"};const WT=["buttonPreset"];function qT(){return qT=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},qT.apply(this,arguments)}const ZT=(0,gE.Em)({id:"copyable-text-input-field.copy-label",defaultMessage:"Copy"}),GT=(0,gE.Em)({id:"copyable-text-input-field.copied-label",defaultMessage:"Copied"});function YT(e){let{buttonPreset:t}=e,n=function(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}(e,WT);const i=(0,HT.useClipboard)({copiedTimeout:600}),r=(0,FE.Z)(),o=r.formatMessage(ZT),s=r.formatMessage(GT),a=Math.max(o.length,s.length);return Yy.createElement(M_,qT({ref:i.target,afterInput:i.isSupported()?Yy.createElement(t_,{preset:t,onClick:i.copy,className:zT.copyButton,style:{width:`${a}ch`}},i.copied?s:o):void 0},n))}var QT,XT;function KT(){return KT=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},KT.apply(this,arguments)}YT.propTypes={buttonPreset:sw().string};const $T=e=>{let{title:t,titleId:n,...i}=e;return Yy.createElement("svg",KT({width:20,height:20,viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":n},i),t?Yy.createElement("title",{id:n},t):null,QT||(QT=Yy.createElement("path",{d:"M16.563 3.751H3.438c-.863 0-1.563.7-1.563 1.562v9.375c0 .863.7 1.563 1.563 1.563h13.124c.863 0 1.563-.7 1.563-1.563V5.313c0-.862-.7-1.562-1.563-1.562Z",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})),XT||(XT=Yy.createElement("path",{d:"M4.375 6.251 10 10.626l5.625-4.375",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})))};var JT={"room-permissions":"RoomSettingsSidebar__room-permissions__AoDPm",roomPermissions:"RoomSettingsSidebar__room-permissions__AoDPm","permissions-group":"RoomSettingsSidebar__permissions-group__u2KNv",permissionsGroup:"RoomSettingsSidebar__permissions-group__u2KNv","confirm-revoke-button":"RoomSettingsSidebar__confirm-revoke-button__i2XAf",confirmRevokeButton:"RoomSettingsSidebar__confirm-revoke-button__i2XAf"};function eR(e){let{fetchingInvite:t,inviteUrl:n,onRevokeInvite:i}=e;const r=(0,FE.Z)(),[o,s]=(0,Yy.useState)(!1),a=(0,Yy.useCallback)((()=>{s(!0)}),[]),l=(0,Yy.useCallback)((()=>{s(!1)}),[]),c=(0,Yy.useCallback)((()=>{i(),s(!1)}),[i]);return Yy.createElement(YT,{label:Yy.createElement(uw.Z,{id:"invite-link-input-field.label",defaultMessage:"Invite link"}),disabled:t,value:t?r.formatMessage({id:"invite-link-input-field.generating-invite",defaultMessage:"Generating invite..."}):n,buttonPreset:"primary",description:!t&&(o?Yy.createElement(Yy.Fragment,null,Yy.createElement(uw.Z,{id:"invite-link-input-field.revoke-confirm",defaultMessage:"are you sure?"})," ",Yy.createElement(Iw,{className:JT.confirmRevokeButton,onClick:c},Yy.createElement(uw.Z,{id:"invite-link-input-field.revoke-confirm-yes",defaultMessage:"yes"}))," ","/"," ",Yy.createElement(Iw,{className:JT.confirmRevokeButton,onClick:l},Yy.createElement(uw.Z,{id:"invite-link-input-field.revoke-confirm-no",defaultMessage:"no"}))):Yy.createElement(Iw,{className:JT.confirmRevokeButton,onClick:a},Yy.createElement(uw.Z,{id:"invite-link-input-field.revoke",defaultMessage:"revoke"}))),fullWidth:!0})}eR.propTypes={fetchingInvite:sw().bool,inviteUrl:sw().string,onRevokeInvite:sw().func.isRequired};const tR=["url","embed","initiallyVisible","popoverApiRef","inviteRequired","fetchingInvite","inviteUrl","revokeInvite"];function nR(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function iR(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function rR(){return rR=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},rR.apply(this,arguments)}function oR(e){let{url:t,embed:n,inviteRequired:i,fetchingInvite:r,inviteUrl:o,revokeInvite:s}=e;return Yy.createElement(O_,{center:!0,padding:!0,grow:!0,gap:"lg",className:UT.invitePopover},i?Yy.createElement(Yy.Fragment,null,Yy.createElement(eR,{fetchingInvite:r,inviteUrl:o,onRevokeInvite:s})):Yy.createElement(Yy.Fragment,null,Yy.createElement(YT,{label:Yy.createElement(uw.Z,{id:"invite-popover.room-link",defaultMessage:"Room Link"}),value:t,buttonPreset:"accent3"})))}oR.propTypes={url:sw().string.isRequired,embed:sw().string,inviteRequired:sw().bool,fetchingInvite:sw().bool,inviteUrl:sw().string,revokeInvite:sw().func};const sR=(0,gE.Em)({id:"invite-popover.title",defaultMessage:"Invite"});function aR(e){let{url:t,embed:n,initiallyVisible:i,popoverApiRef:r,inviteRequired:o,fetchingInvite:s,inviteUrl:a,revokeInvite:l}=e,c=function(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}(e,tR);const d=(0,FE.Z)().formatMessage(sR);return Yy.createElement(GP,{title:d,content:()=>Yy.createElement(oR,{url:t,embed:n,inviteRequired:o,fetchingInvite:s,inviteUrl:a,revokeInvite:l}),placement:"top-start",offsetDistance:28,initiallyVisible:i,popoverApiRef:r},(e=>{let{togglePopover:t,popoverVisible:n,triggerRef:i}=e;return Yy.createElement(UP,rR({ref:i,icon:Yy.createElement($T,null),selected:n,onClick:t,label:d},c))}))}function lR(e,t){void 0===t&&(t=!1);const[n,i]=(0,Yy.useState)();(0,Yy.useEffect)((()=>{i(void 0),t||e.fetchInvite().then((e=>{let{hub_invite_id:n}=e;t||i(n)})).catch((e=>{console.error("Error fetching invite",e)}))}),[e,t]);const r=(0,Yy.useCallback)((()=>{i(void 0),t||e.revokeInvite(n).then((e=>{let{hub_invite_id:n}=e;t||i(n)})).catch((e=>{console.error("Error revoking invite",e)}))}),[n,e,t]),o=(0,Yy.useMemo)((()=>{if(n&&!t){const e=ue();return e.searchParams.set("hub_invite_id",n),e.toString()}}),[n,t]);return{fetchingInvite:!n&&!t,inviteUrl:o,revokeInvite:r}}aR.propTypes=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?nR(Object(n),!0).forEach((function(t){iR(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):nR(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({initiallyVisible:sw().bool,popoverApiRef:sw().object},oR.propTypes);const cR=["hub","hubChannel","scene","store"];function dR(){return dR=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},dR.apply(this,arguments)}function uR(e){let{hub:t,hubChannel:n,scene:i,store:r}=e,o=function(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}(e,cR);const s=`https://${k.SHORTLINK_DOMAIN}/${t.hub_id}`;let a=null;const l=t.embed_token||r.getEmbedTokenForHub(t);l&&(a=`<iframe src="${ue(t.hub_id,{embed_token:l})}" style="width: 1024px; height: 768px;" allow="microphone; camera; vr; speaker;"></iframe>`);const c=(0,Yy.useRef)();(0,Yy.useEffect)((()=>{function e(){Cb(!0,(()=>{})).then((()=>{c.current.openPopover()}))}return i.addEventListener("action_invite",e),()=>{i.removeEventListener("action_invite",e)}}),[i,c]);const d="invite"===t.entry_mode,u=n.can("update_hub"),{fetchingInvite:h,inviteUrl:p,revokeInvite:m}=lR(n,!d||!u);return d&&!u?null:Yy.createElement(aR,dR({inviteRequired:d,fetchingInvite:h,inviteUrl:p,revokeInvite:m,url:s,embed:a,popoverApiRef:c},o))}uR.propTypes={hub:sw().object.isRequired,scene:sw().object.isRequired,hubChannel:sw().object.isRequired,store:sw().object.isRequired};var hR,pR,mR,fR={"more-menu-popover":"MoreMenuPopover__more-menu-popover__isNqe",moreMenuPopover:"MoreMenuPopover__more-menu-popover__isNqe","more-menu-group-label":"MoreMenuPopover__more-menu-group-label__jynY8",moreMenuGroupLabel:"MoreMenuPopover__more-menu-group-label__jynY8","more-menu-item-list":"MoreMenuPopover__more-menu-item-list__Py2Fs",moreMenuItemList:"MoreMenuPopover__more-menu-item-list__Py2Fs","more-menu-item-target":"MoreMenuPopover__more-menu-item-target__AobaZ",moreMenuItemTarget:"MoreMenuPopover__more-menu-item-target__AobaZ","compact-button":"MoreMenuPopover__compact-button__n0DoJ",compactButton:"MoreMenuPopover__compact-button__n0DoJ"};function gR(){return gR=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},gR.apply(this,arguments)}const vR=e=>{let{title:t,titleId:n,...i}=e;return Yy.createElement("svg",gR({width:20,height:20,viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":n},i),t?Yy.createElement("title",{id:n},t):null,hR||(hR=Yy.createElement("path",{d:"M10 12.25a2 2 0 1 0 0-4 2 2 0 0 0 0 4Z",fill:"currentColor"})),pR||(pR=Yy.createElement("path",{d:"M10 18.5a2 2 0 1 0 0-4 2 2 0 0 0 0 4Z",fill:"currentColor"})),mR||(mR=Yy.createElement("path",{d:"M10 6a2 2 0 1 0 0-4 2 2 0 0 0 0 4Z",fill:"currentColor"})))},bR=["className"];function yR(){return yR=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},yR.apply(this,arguments)}function wR(e){let{item:t,closePopover:n}=e;const i=t.icon;return Yy.createElement("li",{onClick:n},t.href?Yy.createElement("a",{className:fR.moreMenuItemTarget,href:t.href,target:t.target||"_blank",rel:"noopener noreferrer"},Yy.createElement(i,null),Yy.createElement("span",null,t.label)):Yy.createElement("button",{className:fR.moreMenuItemTarget,onClick:e=>t.onClick(t,e)},Yy.createElement(i,null),Yy.createElement("span",null,t.label)))}function _R(e){let{group:t,closePopover:n}=e;return Yy.createElement("li",null,Yy.createElement("h1",{className:fR.moreMenuGroupLabel},t.label),Yy.createElement("ul",{className:fR.moreMenuItemList},t.items.map((e=>Yy.createElement(wR,{key:e.id,item:e,closePopover:n})))))}function ER(e){let{menu:t,closePopover:n}=e;return Yy.createElement("div",{className:fR.moreMenuPopover},Yy.createElement("ul",null,t.map((e=>Yy.createElement(_R,{key:e.id,group:e,closePopover:n})))))}wR.propTypes={item:sw().shape({href:sw().string,target:sw().string,icon:sw().elementType.isRequired,label:sw().node.isRequired,onClick:sw().func}).isRequired,closePopover:sw().func.isRequired},_R.propTypes={group:sw().object.isRequired,closePopover:sw().func.isRequired},ER.propTypes={menu:sw().array.isRequired,closePopover:sw().func.isRequired};const AR=(0,Yy.createContext)([!1,()=>{}]);function SR(e){let{initiallyVisible:t,children:n}=e;const i=(0,Yy.useState)(t||!1);return Yy.createElement(AR.Provider,{value:i},n)}SR.propTypes={initiallyVisible:sw().bool,children:sw().node};const xR=(0,gE.Em)({id:"more-menu-popover.title",defaultMessage:"More"});function MR(e){let{menu:t}=e;const n=(0,FE.Z)(),[i,r]=(0,Yy.useContext)(AR),o=n.formatMessage(xR);return Yy.createElement(GP,{title:o,content:e=>Yy.createElement(ER,yR({menu:t},e)),placement:"top-end",offsetDistance:28,isVisible:i,onChangeVisible:r},(e=>{let{togglePopover:t,popoverVisible:n,triggerRef:i}=e;return Yy.createElement(UP,{ref:i,icon:Yy.createElement(vR,null),selected:n,onClick:t,label:o})}))}function PR(e){let{className:t}=e,n=function(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}(e,bR);const i=(0,FE.Z)(),[,r]=(0,Yy.useContext)(AR);return Yy.createElement("button",yR({className:lw()(fR.compactButton,t),"aria-label":i.formatMessage(xR),onClick:e=>{e.stopPropagation(),r(!0)}},n),Yy.createElement(vR,null))}function CR(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function kR(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function OR(){const[e,t]=(0,Yy.useState)(APP.hubChannel._permissions);return(0,Yy.useEffect)((()=>{const e=()=>{t(APP.hubChannel._permissions)};return APP.hubChannel.addEventListener("permissions_updated",e),()=>{APP.hubChannel.removeEventListener("permissions_updated",e)}}),[e,t]),function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?CR(Object(n),!0).forEach((function(t){kR(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):CR(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e)}function TR(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function RR(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function DR(){const[e,t]=(0,Yy.useState)(APP.hub.member_permissions);return(0,Yy.useEffect)((()=>{const e=()=>{t(APP.hub.member_permissions)};return APP.hubChannel.addEventListener("permissions_updated",e),()=>{APP.hubChannel.removeEventListener("permissions_updated",e)}}),[e,t]),function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?TR(Object(n),!0).forEach((function(t){RR(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):TR(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e)}MR.propTypes={menu:sw().array.isRequired},PR.propTypes={className:sw().string};const jR=["name","sent","sessionId"];function LR(){return LR=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},LR.apply(this,arguments)}function IR(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function NR(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?IR(Object(n),!0).forEach((function(t){FR(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):IR(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function FR(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const BR=(0,Yy.createContext)({messageGroups:[],sendMessage:()=>{}});let VR=0;const UR=6e4,HR=(0,gE.vU)({emmptyRoom:{id:"chat-sidebar-container.input-placeholder.empty-room",defaultMessage:"Nobody is here yet..."},emmptyRoomBot:{id:"chat-sidebar-container.input-placeholder.empty-room-bot",defaultMessage:"Send message to {discordChannels}"},occupants:{id:"chat-sidebar-container.input-placeholder.occupants",defaultMessage:"{occupantCount, plural, one {Send message to one other...} other {Send message to {occupantCount} others...} }"},occupantsAndBot:{id:"chat-sidebar-container.input-placeholder.occupants-and-bot",defaultMessage:"{occupantCount, plural, one {Send message to one other and {discordChannels}...} other {Send message to {occupantCount} others and {discordChannels}...} }"},textChatOff:{id:"chat-sidebar-container.input-send-button.disabled",defaultMessage:"Text Chat Off"}});function zR(e,t){const n=Date.now(),{name:i,sent:r,sessionId:o}=t,s=function(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}(t,jR);if(function(e,t,n){if(0===e.length)return!0;const i=e[e.length-1];return i.senderSessionId!==t.sessionId||i.type!==t.type||n-i.messages[i.messages.length-1].timestamp>UR}(e,t,n))return[...e,{id:VR++,timestamp:n,sent:r,sender:i,senderSessionId:o,messages:[NR({id:VR++,timestamp:n},s)],type:t.type}];const a=e.pop();return a.messages=[...a.messages,NR({id:VR++,timestamp:n},s)],[...e,NR({},a)]}function WR(e){let{messageDispatch:t,children:n}=e;const[i,r]=(0,Yy.useState)([]),[o,s]=(0,Yy.useState)(!1),a=ak("owner");(0,Yy.useEffect)((()=>{function e(e){const t=e.detail;a&&t.sessionId===NAF.clientId&&"permission"===t.type||(r((e=>function(e,t){switch(t.type){case"join":case"entered":case"leave":case"display_name_changed":case"scene_changed":case"hub_name_changed":case"hub_changed":case"log":return[...e,NR({id:VR++,systemMessage:!0,timestamp:Date.now()},t)];case"chat":case"image":case"photo":case"video":case"permission":return zR(e,t);default:return e}}(e,t))),"chat"!==t.type&&"image"!==t.type&&"photo"!==t.type&&"video"!==t.type&&"permission"!==t.type||s(!0))}return t&&t.addEventListener("message",e),()=>{t&&t.removeEventListener("message",e)}}),[t,r,s,a]);const l=(0,Yy.useCallback)((e=>{t&&t.dispatch(e)}),[t]),c=(0,Yy.useCallback)((()=>{s(!1)}),[s]);return Yy.createElement(BR.Provider,{value:{messageGroups:i,unreadMessages:o,sendMessage:l,setMessagesRead:c}},n)}function qR(e){let{scene:t,canSpawnMessages:n,presences:i,occupantCount:r,initialValue:o,autoFocus:s,onClose:a}=e;const{messageGroups:l,sendMessage:c,setMessagesRead:d}=(0,Yy.useContext)(BR),[u,h,p]=function(e){const t=(0,Yy.useRef)(),[n,i]=(0,Yy.useState)(!0),r=(0,Yy.useCallback)((e=>{const t=e.target;i(t.scrollHeight-t.scrollTop===t.clientHeight)}),[i]);return(0,Yy.useEffect)((()=>{if(n){const e=t.current;e.scrollTop!==e.scrollHeight&&(e.scrollTop=e.scrollHeight)}}),[e,n]),[r,t,n]}(l),[m,f]=(0,Yy.useState)(o||""),[g,v]=(0,Yy.useState)(!1),{text_chat:b}=OR(),y=ak("owner"),{text_chat:w}=DR(),_=(0,Yy.useRef)(),E=(0,FE.Z)(),A=(0,Yy.useRef)(),S=(0,Yy.useCallback)((e=>{v(e.target.value.startsWith("/")),(b||g)&&("Enter"!==e.key||e.shiftKey?"Escape"===e.key&&a():(e.preventDefault(),e.target.value.length<=nC&&(c(e.target.value),f(""),e.target.value.startsWith("/")&&a())),clearTimeout(_.current),_.current=setTimeout((()=>window.APP.hubChannel.endTyping()),500),window.APP.hubChannel.beginTyping())}),[c,f,a,b,g]),x=(0,Yy.useCallback)((()=>{c(m.substring(0,nC)),f("")}),[m,c,f]),M=(0,Yy.useCallback)((e=>{for(const n of e.target.files)t.emit("add_media",n)}),[t]),P=(0,Yy.useCallback)((e=>{let{emoji:t,pickerRemainedOpen:n}=e;f((e=>e+t.native)),n||A.current.select()}),[f,A]);(0,Yy.useEffect)((()=>{if(s){A.current.focus();const e=A.current.value.length;A.current.setSelectionRange(e,e)}}),[]),(0,Yy.useEffect)((()=>{p&&d()}),[l,p,d]);const C=ke(i),k=C.map((e=>"#"+e)).join(", ");let O;O=r<=1?0===C.length?E.formatMessage(HR.emmptyRoom):E.formatMessage(HR.emmptyRoomBot,{discordChannels:k}):0===C.length?E.formatMessage(HR.occupants,{discordChannels:k,occupantCount:r-1}):E.formatMessage(HR.occupantsAndBot,{discordChannels:k,occupantCount:r-1});const T=AFRAME.utils.device.isMobile(),R=m.length>nC,D=0===m.length||R||!b;return Yy.createElement(HC,{onClose:a},Yy.createElement(UC,{ref:h,onScroll:u},l.map((e=>{const{id:t,systemMessage:n,type:i}=e;return n?Yy.createElement(NC,LR({key:t},e)):"permission"===i?Yy.createElement(VC,LR({key:t},e)):Yy.createElement(BC,LR({key:t},e))}))),!b&&Yy.createElement(LM,{permission:"text_chat"}),!w&&y&&Yy.createElement(LM,{permission:"text_chat",isMod:!0}),Yy.createElement(mC,{id:"chat-input",ref:A,onKeyDown:S,onChange:e=>f(e.target.value),placeholder:O,value:m,isOverMaxLength:R,warning:Yy.createElement(Yy.Fragment,null,m.length+50>nC&&Yy.createElement(pC,{messageLength:m.length,maxLength:nC})),afterInput:Yy.createElement(Yy.Fragment,null,!T&&Yy.createElement(uC,{onSelectEmoji:P}),0===m.length&&n?Yy.createElement(hC,{onChange:M}):Yy.createElement(dC,{onClick:x,as:"button",disabled:D&&!g,title:D&&!g?E.formatMessage(HR.textChatOff):void 0}),n&&Yy.createElement(cC,{disabled:D,onClick:()=>{ek(m),f("")},title:D?E.formatMessage(HR.textChatOff):void 0}))}))}function ZR(e){const{unreadMessages:t}=(0,Yy.useContext)(BR);return Yy.createElement(zC,LR({},e,{statusColor:t?"unread":void 0}))}function GR(e,t){return Yy.Children.toArray(e).reduce(((e,n)=>null===e?n:Yy.createElement(Yy.Fragment,null,e,t(),n)),null)}WR.propTypes={children:sw().node,messageDispatch:sw().object},qR.propTypes={canSpawnMessages:sw().bool,presences:sw().object.isRequired,occupantCount:sw().number.isRequired,scene:sw().object.isRequired,onClose:sw().func.isRequired,autoFocus:sw().bool,initialValue:sw().string};var YR,QR={"content-menu":"ContentMenu__content-menu__ihhYT",contentMenu:"ContentMenu__content-menu__ihhYT","content-menu-button":"ContentMenu__content-menu-button__I7_3d",contentMenuButton:"ContentMenu__content-menu-button__I7_3d",active:"ContentMenu__active__UBWaK",separator:"ContentMenu__separator__x4GLA",disabled:"ContentMenu__disabled__VWzNw"};function XR(){return XR=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},XR.apply(this,arguments)}const KR=e=>{let{title:t,titleId:n,...i}=e;return Yy.createElement("svg",XR({width:20,height:20,viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":n},i),t?Yy.createElement("title",{id:n},t):null,YR||(YR=Yy.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M9.152 1.791a1.466 1.466 0 0 1 1.449 0l3.424 1.948c.163.093.298.226.393.386.094.16.143.341.144.526v3.76c0 .037-.003.075-.007.113.17.028.334.086.485.171l3.423 1.948c.163.093.299.226.393.386.094.16.144.341.144.526v3.76c0 .184-.05.366-.144.526-.094.16-.229.293-.392.386l-3.424 1.948a1.468 1.468 0 0 1-1.449 0l-3.424-1.948A1.086 1.086 0 0 1 10 16.11a1.083 1.083 0 0 1-.166.117L6.41 18.175a1.468 1.468 0 0 1-1.45 0l-3.423-1.948a1.07 1.07 0 0 1-.393-.386A1.038 1.038 0 0 1 1 15.315v-3.76c0-.185.05-.366.144-.526.094-.16.23-.293.393-.386L4.96 8.695c.079-.044.161-.082.246-.111a1.033 1.033 0 0 1-.014-.173V4.65c0-.185.05-.366.144-.526.094-.16.23-.293.393-.386L9.152 1.79Zm.364 8.672L6.41 8.695a1.462 1.462 0 0 0-.477-.17.345.345 0 0 1-.02-.115V4.837l3.604 2.072v3.554Zm4.265-1.859c-.065.026-.13.056-.19.091l-3.354 1.908V6.91l3.604-2.072V8.41a.347.347 0 0 1-.06.194Zm-8.206.613a.73.73 0 0 0-.252.087L2.097 11.14l3.588 2.063 3.414-1.963-3.37-1.917a1.082 1.082 0 0 1-.154-.106Zm5.204 1.953 3.536 2.033 3.589-2.063-3.227-1.836a.732.732 0 0 0-.506-.08c-.045.036-.094.07-.146.099l-3.246 1.847Zm-.903-8.866a.732.732 0 0 0-.362.096L6.288 4.235 9.877 6.3l3.588-2.064L10.238 2.4a.732.732 0 0 0-.362-.096Zm-.246 13.01v-3.562l-3.585 2.061v3.754h.002l3.423-1.948a.356.356 0 0 0 .165-.206 1.034 1.034 0 0 1-.005-.098Zm.769.176a.35.35 0 0 1-.034-.077c.003-.033.005-.066.005-.098v-3.563l3.585 2.061v3.754h-.002l-3.423-1.948a.357.357 0 0 1-.131-.129Zm-5.074-1.677L1.72 11.741v3.574a.346.346 0 0 0 .178.304l3.424 1.947.002.001v-3.754Zm9.35 3.754h.002l3.424-1.948a.356.356 0 0 0 .178-.304V11.74l-3.603 2.072v3.754Z",fill:"currentColor"})))},$R=["active","disabled","children"];function JR(){return JR=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},JR.apply(this,arguments)}function eD(e){let{active:t,disabled:n,children:i}=e,r=function(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}(e,$R);return Yy.createElement("button",JR({className:lw()(QR.contentMenuButton,{[QR.active]:t,[QR.disabled]:n})},r),i)}function tD(e){return Yy.createElement(eD,e,Yy.createElement(KR,null),Yy.createElement("span",null,Yy.createElement(uw.Z,{id:"content-menu.ecs-debug-menu-button",defaultMessage:"ECS Debug"})))}function nD(e){return Yy.createElement(eD,e,Yy.createElement(KR,null),Yy.createElement("span",null,Yy.createElement(uw.Z,{id:"content-menu.objects-menu-button",defaultMessage:"Objects"})))}function iD(e){return Yy.createElement(eD,e,Yy.createElement(DA,null),Yy.createElement("span",null,Yy.createElement(uw.Z,{id:"content-menu.people-menu-button",defaultMessage:"People ({presenceCount})",values:{presenceCount:e.presencecount}})))}function rD(e){let{children:t}=e;return Yy.createElement("div",{className:QR.contentMenu},GR(t,(()=>Yy.createElement("div",{className:QR.separator}))))}var oD,sD,aD;function lD(){return lD=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},lD.apply(this,arguments)}eD.propTypes={children:sw().node,active:sw().bool,disabled:sw().bool},iD.propTypes={presencecount:sw().number},rD.propTypes={children:sw().node};const cD=e=>{let{title:t,titleId:n,...i}=e;return Yy.createElement("svg",lD({width:20,height:20,viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":n},i),t?Yy.createElement("title",{id:n},t):null,oD||(oD=Yy.createElement("path",{d:"m13.693 5.807-1.04-1.643a1.126 1.126 0 0 0-.856-.414H8.203c-.337 0-.637.159-.856.414l-1.04 1.643c-.22.256-.502.443-.838.443H3.125a1.25 1.25 0 0 0-1.25 1.25V15a1.25 1.25 0 0 0 1.25 1.25h13.75a1.25 1.25 0 0 0 1.25-1.25V7.5a1.25 1.25 0 0 0-1.25-1.25H14.57c-.338 0-.658-.187-.877-.443Z",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})),sD||(sD=Yy.createElement("path",{d:"M10 13.75a3.125 3.125 0 1 0 0-6.25 3.125 3.125 0 0 0 0 6.25Z",stroke:"currentColor",strokeWidth:1.5,strokeMiterlimit:10})),aD||(aD=Yy.createElement("path",{d:"M4.844 6.171v-.86h-.938v.86",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})))};var dD,uD;function hD(){return hD=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},hD.apply(this,arguments)}const pD=e=>{let{title:t,titleId:n,...i}=e;return Yy.createElement("svg",hD({width:20,height:20,viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":n},i),t?Yy.createElement("title",{id:n},t):null,dD||(dD=Yy.createElement("g",{clipPath:"url(#a)",stroke:"currentColor",strokeWidth:1.5,strokeMiterlimit:10},Yy.createElement("path",{d:"M9.688 3.75a1.563 1.563 0 1 0 0-3.126 1.563 1.563 0 0 0 0 3.125Z"}),Yy.createElement("path",{d:"m7.785 11.547-1.187 6.727a.937.937 0 0 0 1.46.93.928.928 0 0 0 .38-.606l.82-4.683v.007s.203-1.27.683-1.27h.121c.489 0 .684 1.27.684 1.27v-.004l.82 4.684a.935.935 0 0 0 1.84-.328l-1.187-6.727-.192-1.16c-.113-.707-.164-1.86.02-2.332.156-.406.552-.555.906-.555h3.61a.937.937 0 0 0 0-1.875H3.438a.937.937 0 1 0 0 1.875H7.05c.36 0 .75.149.906.555.184.473.133 1.625.02 2.332l-.192 1.16Z"}))),uD||(uD=Yy.createElement("defs",null,Yy.createElement("clipPath",{id:"a"},Yy.createElement("rect",{width:20,height:20,fill:"#fff"})))))};var mD,fD,gD,vD,bD,yD;function wD(){return wD=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},wD.apply(this,arguments)}const _D=e=>{let{title:t,titleId:n,...i}=e;return Yy.createElement("svg",wD({width:20,height:20,viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":n},i),t?Yy.createElement("title",{id:n},t):null,mD||(mD=Yy.createElement("path",{d:"m4.375 4.375.781 12.5c.037.723.563 1.25 1.25 1.25h7.188c.69 0 1.206-.527 1.25-1.25l.781-12.5",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})),fD||(fD=Yy.createElement("path",{d:"M3.125 4.375h13.75",stroke:"currentColor",strokeWidth:1.5,strokeMiterlimit:10,strokeLinecap:"round"})),gD||(gD=Yy.createElement("path",{d:"M7.5 4.375V2.813a.935.935 0 0 1 .938-.938h3.124a.935.935 0 0 1 .938.938v1.562",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})),vD||(vD=Yy.createElement("path",{d:"M10 6.876v8.75",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})),bD||(bD=Yy.createElement("path",{d:"m7.188 6.876.312 8.75",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})),yD||(yD=Yy.createElement("path",{d:"m12.813 6.876-.313 8.75",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})))};var ED,AD,SD;function xD(){return xD=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},xD.apply(this,arguments)}const MD=e=>{let{title:t,titleId:n,...i}=e;return Yy.createElement("svg",xD({width:20,height:20,viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":n},i),t?Yy.createElement("title",{id:n},t):null,ED||(ED=Yy.createElement("path",{d:"M17.5 10c0-4.14-3.36-7.5-7.5-7.5-4.14 0-7.5 3.36-7.5 7.5 0 4.14 3.36 7.5 7.5 7.5 4.14 0 7.5-3.36 7.5-7.5Z",stroke:"currentColor",strokeWidth:1.5,strokeMiterlimit:10})),AD||(AD=Yy.createElement("path",{d:"M9.776 6.487 10 11.25l.224-4.763a.223.223 0 0 0-.226-.235v0a.224.224 0 0 0-.222.235v0Z",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})),SD||(SD=Yy.createElement("path",{d:"M10 14.371a.782.782 0 1 1 0-1.563.782.782 0 0 1 0 1.563Z",fill:"currentColor"})))};var PD,CD,kD;function OD(){return OD=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},OD.apply(this,arguments)}const TD=e=>{let{title:t,titleId:n,...i}=e;return Yy.createElement("svg",OD({width:20,height:20,viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":n},i),t?Yy.createElement("title",{id:n},t):null,PD||(PD=Yy.createElement("path",{d:"M3.125 8.28v9.22a.625.625 0 0 0 .625.625H7.5v-5.313a.937.937 0 0 1 .938-.937h3.124a.938.938 0 0 1 .938.937v5.313h3.75a.625.625 0 0 0 .625-.625V8.28",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})),CD||(CD=Yy.createElement("path",{d:"m18.75 10-8.325-7.968c-.195-.206-.652-.209-.85 0L1.25 10",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})),kD||(kD=Yy.createElement("path",{d:"M15.625 6.992V2.5H13.75v2.695",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})))};var RD,DD,jD,LD;function ID(){return ID=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},ID.apply(this,arguments)}const ND=e=>{let{title:t,titleId:n,...i}=e;return Yy.createElement("svg",ID({width:20,height:20,viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":n},i),t?Yy.createElement("title",{id:n},t):null,RD||(RD=Yy.createElement("path",{d:"M16.25 8.643v7.608a1.875 1.875 0 0 1-1.875 1.875h-8.75A1.875 1.875 0 0 1 3.75 16.25V3.75a1.875 1.875 0 0 1 1.875-1.875h3.857c.332 0 .65.131.884.366l5.518 5.518c.234.234.366.552.366.883Z",stroke:"currentColor",strokeWidth:1.5,strokeLinejoin:"round"})),DD||(DD=Yy.createElement("path",{d:"M10 2.188v4.688a1.25 1.25 0 0 0 1.25 1.25h4.688",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})),jD||(jD=Yy.createElement("path",{d:"M6.875 11.25h6.25",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})),LD||(LD=Yy.createElement("path",{d:"M6.875 14.376h6.25",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})))};var FD,BD,VD,UD,HD,zD,WD,qD,ZD,GD;function YD(){return YD=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},YD.apply(this,arguments)}const QD=e=>{let{title:t,titleId:n,...i}=e;return Yy.createElement("svg",YD({width:20,height:20,viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":n},i),t?Yy.createElement("title",{id:n},t):null,FD||(FD=Yy.createElement("path",{d:"M10 18.125a8.125 8.125 0 1 0 0-16.25 8.125 8.125 0 0 0 0 16.25Z",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})),BD||(BD=Yy.createElement("path",{d:"M10 13.125a3.125 3.125 0 1 0 0-6.25 3.125 3.125 0 0 0 0 6.25Z",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})),VD||(VD=Yy.createElement("path",{d:"m8.125 2.11.313 5.156",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})),UD||(UD=Yy.createElement("path",{d:"m11.563 7.266.312-5.157",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})),HD||(HD=Yy.createElement("path",{d:"m8.125 17.892.313-5.157",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})),zD||(zD=Yy.createElement("path",{d:"m11.563 12.735.312 5.157",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})),WD||(WD=Yy.createElement("path",{d:"m17.89 8.125-5.156.313",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})),qD||(qD=Yy.createElement("path",{d:"m12.734 11.562 5.157.313",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})),ZD||(ZD=Yy.createElement("path",{d:"m2.11 8.125 5.156.313",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})),GD||(GD=Yy.createElement("path",{d:"m7.266 11.562-5.157.313",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})))};var XD;function KD(){return KD=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},KD.apply(this,arguments)}const $D=e=>{let{title:t,titleId:n,...i}=e;return Yy.createElement("svg",KD({width:20,height:20,viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":n},i),t?Yy.createElement("title",{id:n},t):null,XD||(XD=Yy.createElement("path",{d:"M18.09 4.39C14.597 3.763 13.153 3.3 10 1.875 6.847 3.3 5.403 3.763 1.91 4.39 1.277 14.42 9.398 17.883 10 18.125c.602-.242 8.723-3.706 8.09-13.735Z",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})))};var JD,ej;function tj(){return tj=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},tj.apply(this,arguments)}const nj=e=>{let{title:t,titleId:n,...i}=e;return Yy.createElement("svg",tj({width:20,height:20,viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":n},i),t?Yy.createElement("title",{id:n},t):null,JD||(JD=Yy.createElement("path",{d:"M8.246 8.55c-.513 0-.918.45-.918 1 0 .549.414.999.918.999.513 0 .918-.45.918-1 .01-.548-.405-.998-.918-.998Zm3.285 0c-.513 0-.918.45-.918 1 0 .549.414.999.918.999.513 0 .918-.45.918-1 0-.548-.405-.998-.918-.998Z",fill:"currentColor"})),ej||(ej=Yy.createElement("path",{d:"M15.905 1H3.845A1.85 1.85 0 0 0 2 2.854v12.168a1.85 1.85 0 0 0 1.845 1.854h10.206l-.477-1.665 1.152 1.071 1.089 1.008L17.75 19V2.854A1.85 1.85 0 0 0 15.905 1Zm-3.474 11.754s-.324-.387-.594-.729c1.179-.333 1.629-1.071 1.629-1.071a5.15 5.15 0 0 1-1.035.531c-.45.189-.882.315-1.305.387a6.305 6.305 0 0 1-2.331-.009 7.555 7.555 0 0 1-1.323-.387 5.274 5.274 0 0 1-.657-.306c-.027-.018-.054-.027-.081-.045-.018-.009-.027-.018-.036-.027-.162-.09-.252-.153-.252-.153s.432.72 1.575 1.062c-.27.342-.603.747-.603.747-1.989-.063-2.745-1.368-2.745-1.368 0-2.898 1.296-5.247 1.296-5.247 1.296-.972 2.529-.945 2.529-.945l.09.108c-1.62.468-2.367 1.179-2.367 1.179s.198-.108.531-.261c.963-.423 1.728-.54 2.043-.567.054-.009.099-.018.153-.018a7.336 7.336 0 0 1 4.527.846s-.711-.675-2.241-1.143l.126-.144s1.233-.027 2.529.945c0 0 1.296 2.349 1.296 5.247 0 0-.765 1.305-2.754 1.368Z",fill:"currentColor"})))};var ij,rj,oj;function sj(){return sj=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},sj.apply(this,arguments)}const aj=e=>{let{title:t,titleId:n,...i}=e;return Yy.createElement("svg",sj({width:20,height:20,viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":n},i),t?Yy.createElement("title",{id:n},t):null,ij||(ij=Yy.createElement("path",{d:"M13.5 6.875V5.312a1.563 1.563 0 0 0-1.563-1.562h-7.5a1.562 1.562 0 0 0-1.562 1.562v9.375a1.562 1.562 0 0 0 1.563 1.563h7.5a1.562 1.562 0 0 0 1.562-1.563v-1.562",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})),rj||(rj=Yy.createElement("path",{d:"M16 6.875 19.125 10 16 13.125",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})),oj||(oj=Yy.createElement("path",{d:"M8.46 10h10.665",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})))};var lj,cj,dj,uj,hj={person:"PeopleSidebar__person__hP26x","moderator-icon":"PeopleSidebar__moderator-icon__ssMMu",moderatorIcon:"PeopleSidebar__moderator-icon__ssMMu",presence:"PeopleSidebar__presence__xlecK"};function pj(){return pj=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},pj.apply(this,arguments)}const mj=e=>{let{title:t,titleId:n,...i}=e;return Yy.createElement("svg",pj({width:20,height:20,viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":n},i),t?Yy.createElement("title",{id:n},t):null,lj||(lj=Yy.createElement("path",{d:"M17.122 3H2.979C2.328 3 1.8 3.528 1.8 4.179v9.428c0 .651.528 1.179 1.179 1.179h14.143c.65 0 1.178-.528 1.178-1.179V4.18C18.3 3.528 17.772 3 17.122 3Z",stroke:"currentColor",strokeLinejoin:"round"})),cj||(cj=Yy.createElement("path",{d:"m11.818 17.142-.295-2.357H8.577l-.295 2.357h3.536Z",fill:"currentColor"})),dj||(dj=Yy.createElement("path",{d:"M14.175 17.142h-8.25",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})),uj||(uj=Yy.createElement("path",{d:"M1.8 11.839v1.768a1.182 1.182 0 0 0 1.179 1.178h14.143a1.182 1.182 0 0 0 1.178-1.178v-1.768H1.8Zm8.25 2.357a.59.59 0 1 1 0-1.18.59.59 0 0 1 0 1.18Z",fill:"currentColor"})))};var fj,gj;function vj(){return vj=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},vj.apply(this,arguments)}const bj=e=>{let{title:t,titleId:n,...i}=e;return Yy.createElement("svg",vj({width:20,height:20,viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":n},i),t?Yy.createElement("title",{id:n},t):null,fj||(fj=Yy.createElement("g",{clipPath:"url(#a)",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"},Yy.createElement("path",{d:"M13.125.625h-6.25C5.839.625 5 1.465 5 2.5v15c0 1.035.84 1.875 1.875 1.875h6.25c1.036 0 1.875-.84 1.875-1.875v-15c0-1.036-.84-1.875-1.875-1.875Z"}),Yy.createElement("path",{d:"M6.875.625h.938a.312.312 0 0 1 .312.312.625.625 0 0 0 .625.625h2.5a.625.625 0 0 0 .625-.625.312.312 0 0 1 .313-.312h.937"}))),gj||(gj=Yy.createElement("defs",null,Yy.createElement("clipPath",{id:"a"},Yy.createElement("rect",{width:20,height:20,fill:"#fff"})))))};var yj,wj,_j,Ej;function Aj(){return Aj=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},Aj.apply(this,arguments)}const Sj=e=>{let{title:t,titleId:n,...i}=e;return Yy.createElement("svg",Aj({width:20,height:20,viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":n},i),t?Yy.createElement("title",{id:n},t):null,yj||(yj=Yy.createElement("path",{d:"M4.922 7.501H2.188a.312.312 0 0 0-.313.313v4.375a.313.313 0 0 0 .313.312h2.72a.623.623 0 0 1 .396.138l3.573 2.926a.313.313 0 0 0 .498-.251V4.689a.313.313 0 0 0-.498-.252L5.304 7.363a.586.586 0 0 1-.382.138Z",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})),wj||(wj=Yy.createElement("path",{d:"M12.5 12.5c.38-.758.625-1.596.625-2.5 0-.918-.234-1.736-.625-2.5",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})),_j||(_j=Yy.createElement("path",{d:"M14.375 14.374c.76-1.325 1.25-2.502 1.25-4.375 0-1.872-.469-3.036-1.25-4.375",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})),Ej||(Ej=Yy.createElement("path",{d:"M16.25 16.248c1.172-1.797 1.875-3.571 1.875-6.25 0-2.678-.703-4.414-1.875-6.25",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})))};var xj,Mj,Pj,Cj,kj,Oj;function Tj(){return Tj=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},Tj.apply(this,arguments)}const Rj=e=>{let{title:t,titleId:n,...i}=e;return Yy.createElement("svg",Tj({width:20,height:20,viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":n},i),t?Yy.createElement("title",{id:n},t):null,xj||(xj=Yy.createElement("path",{d:"M16.25 16.876 2.5 3.126",stroke:"currentColor",strokeWidth:1.5,strokeMiterlimit:10,strokeLinecap:"round"})),Mj||(Mj=Yy.createElement("path",{d:"M8.75 5.349v1.32c0 .041.017.08.046.11l.937.938a.156.156 0 0 0 .267-.11V4.71a.958.958 0 0 0-.495-.849.934.934 0 0 0-1.024.092L7.234 4.974a.156.156 0 0 0-.012.232l.666.666a.156.156 0 0 0 .21.01l.652-.533Z",fill:"currentColor"})),Pj||(Pj=Yy.createElement("path",{d:"M8.75 14.652 5.7 12.155a1.25 1.25 0 0 0-.792-.28H2.5v-3.75h1.981a.156.156 0 0 0 .11-.267l-.937-.937a.156.156 0 0 0-.11-.046H2.187a.937.937 0 0 0-.937.938v4.375a.937.937 0 0 0 .938.937h2.724l3.57 2.922a.934.934 0 0 0 1.392-.27.957.957 0 0 0 .126-.486v-1.96a.156.156 0 0 0-.046-.11l-.937-.937a.157.157 0 0 0-.24.023.157.157 0 0 0-.027.087v2.258Z",fill:"currentColor"})),Cj||(Cj=Yy.createElement("path",{d:"M13.75 10c0-.959-.227-1.87-.693-2.783a.625.625 0 0 0-1.114.567c.375.734.557 1.46.557 2.217 0 .104-.004.21-.012.317a.312.312 0 0 0 .09.244l.768.769a.156.156 0 0 0 .264-.079c.093-.41.14-.83.14-1.252Z",fill:"currentColor"})),kj||(kj=Yy.createElement("path",{d:"M16.25 10.001c0-2-.511-3.277-1.335-4.69a.625.625 0 0 0-1.08.63C14.573 7.206 15 8.276 15 10c0 .93-.129 1.675-.366 2.37a.313.313 0 0 0 .074.322l.655.655a.156.156 0 0 0 .255-.05c.4-.958.632-1.972.632-3.297Z",fill:"currentColor"})),Oj||(Oj=Yy.createElement("path",{d:"M18.75 10c0-2.9-.789-4.73-1.973-6.586a.625.625 0 1 0-1.055.673C16.79 5.757 17.5 7.403 17.5 10c0 1.854-.348 3.208-.922 4.414a.156.156 0 0 0 .03.178l.697.697a.157.157 0 0 0 .25-.039c.839-1.647 1.195-3.258 1.195-5.25Z",fill:"currentColor"})))};var Dj,jj;function Lj(){return Lj=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},Lj.apply(this,arguments)}const Ij=e=>{let{title:t,titleId:n,...i}=e;return Yy.createElement("svg",Lj({id:"Layer_1",x:0,y:0,viewBox:"0 0 1.025 0.782",xmlSpace:"preserve",width:20,height:20,xmlns:"http://www.w3.org/2000/svg","aria-labelledby":n},i),t?Yy.createElement("title",{id:n},t):null,Dj||(Dj=Yy.createElement("style",{type:"text/css",id:"style869"},".st0{fill:#ffd3b6}")),jj||(jj=Yy.createElement("path",{className:"st0",d:"M220.8 196.584",id:"path871"})),Yy.createElement("g",{id:"g1059",transform:"matrix(.05125 0 0 .05125 -14.217 -12.843)"},Yy.createElement("path",{className:"st0",d:"M288.372 256.007",id:"path1044",style:{strokeWidth:.0389037}}),Yy.createElement("path",{d:"M294.69 257.645c-.424-.378-1.361-.899-3.287.953-.358.342-.572.467-.844.762v-9.134c0-.591-.467-1.074-1.062-1.074-.596 0-1.078.483-1.078 1.074v5.419c0 .506-.654.549-.767.132v-6.465c0-.592-.466-1.074-1.062-1.074-.595 0-1.077.478-1.077 1.074v6.485c-.082.397-.665.381-.708-.047v-5.664a1.06 1.06 0 0 0-1.062-1.07c-.596 0-1.078.478-1.078 1.07v5.575c-.004.007-.004.02-.004.039 0 .486-.626.529-.74.136v-3.992a1.06 1.06 0 0 0-1.061-1.07c-.595 0-1.078.479-1.078 1.07v9.392a4.768 4.768 0 0 0 2.739 4.314v1.525c0 .591.482 1.074 1.074 1.074h4.295c.591 0 1.073-.483 1.073-1.074v-1.081a2.517 2.517 0 0 0 1.755-1.031.313.313 0 0 0 .031-.047c.035-.039.078-.109.128-.21.028-.047.051-.093.074-.144.494-1 1.623-3.708 3.646-5.458.416-.417.517-1.082.093-1.46z",id:"path1046",style:{strokeWidth:.0389037,fill:"#ffd469"}}),Yy.createElement("path",{d:"M288.726 266.013H285.4l.007-.007h-.871a4.774 4.774 0 0 1-2.027-.451v1.361c.194.102.38.168.54.168h5.373c.156 0 .339-.051.53-.133v-.949l-.226.012z",id:"path1048",style:{strokeWidth:.0389037,fill:"#ffb636"}})))};var Nj={list:"List__list__wrDsj","list-item":"List__list-item__Wa7vr",listItem:"List__list-item__Wa7vr","list-item-content":"List__list-item-content__fiqda",listItemContent:"List__list-item-content__fiqda","button-list-item":"List__button-list-item__psIZ3",buttonListItem:"List__button-list-item__psIZ3",selected:"List__selected__TOa6J"};const Fj=["className","children"],Bj=["className","children"];function Vj(){return Vj=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},Vj.apply(this,arguments)}function Uj(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}const Hj=(0,Yy.forwardRef)(((e,t)=>{let{className:n,children:i}=e,r=Uj(e,Fj);return Yy.createElement("ul",Vj({},r,{className:lw()(Nj.list,n),ref:t}),i)}));function zj(e){let{className:t,children:n}=e,i=Uj(e,Bj);return Yy.createElement("li",{className:Nj.listItem},Yy.createElement("button",Vj({},i,{className:lw()(Nj.listItemContent,Nj.buttonListItem,t)}),n))}function Wj(e,t){if(e){if(e.hmd)return t.formatMessage({id:"people-sidebar.device-label.vr",defaultMessage:"VR"});if(e.discord)return t.formatMessage({id:"people-sidebar.device-label.discord",defaultMessage:"Discord Bot"});if(e.mobile)return t.formatMessage({id:"people-sidebar.device-label.mobile",defaultMessage:"Mobile"})}return t.formatMessage({id:"people-sidebar.device-label.desktop",defaultMessage:"Desktop"})}function qj(e,t){if(e){if(e.talking)return t.formatMessage({id:"people-sidebar.voice-label.talking",defaultMessage:"Talking"});if(e.muted)return t.formatMessage({id:"people-sidebar.voice-label.muted",defaultMessage:"Muted"})}return t.formatMessage({id:"people-sidebar.voice-label.not-talking",defaultMessage:"Not Talking"})}function Zj(e){let{people:t,onSelectPerson:n,onClose:i,showMuteAll:r,onMuteAll:o,canVoiceChat:s,voiceChatEnabled:a,isMod:l}=e;const c=(0,FE.Z)();return Yy.createElement(Rw,{title:Yy.createElement(uw.Z,{id:"people-sidebar.title",defaultMessage:"People ({numPeople})",values:{numPeople:t.length}}),beforeTitle:Yy.createElement(Ww,{onClick:i}),afterTitle:r?Yy.createElement(Iw,{onClick:o},Yy.createElement(uw.Z,{id:"people-sidebar.mute-all-button",defaultMessage:"Mute All"})):void 0},!s&&Yy.createElement(LM,{permission:"voice_chat"}),!a&&l&&Yy.createElement(LM,{permission:"voice_chat",isMod:!0}),Yy.createElement(Hj,null,t.map((e=>{const t=function(e){if(e){if(e.hmd)return YO;if(e.discord)return nj;if(e.mobile)return bj}return mj}(e.context),i=function(e){if(e){if(e.muted)return Rj;if(e.talking)return Sj}return uT}(e.micPresence);return Yy.createElement(zj,{className:hj.person,key:e.id,type:"button",onClick:t=>n(e,t)},e.hand_raised&&Yy.createElement(Ij,null),Yy.createElement(t,{title:Wj(e.context,c)}),!e.context.discord&&i&&Yy.createElement(i,{title:qj(e.micPresence,c)}),Yy.createElement("p",null,function(e,t){const n=t.formatMessage({id:"people-sidebar.person-name.you",defaultMessage:"You"});return e.profile.displayName+(e.isMe?` (${n})`:"")}(e,c)),e.roles.owner&&Yy.createElement(nA,{title:c.formatMessage({id:"people-sidebar.moderator-label",defaultMessage:"Moderator"}),className:hj.moderatorIcon,width:12,height:12}),Yy.createElement("p",{className:hj.presence},function(e,t){switch(e){case"lobby":return t.formatMessage({id:"people-sidebar.presence.in-lobby",defaultMessage:"In Lobby"});case"room":return t.formatMessage({id:"people-sidebar.presence.in-room",defaultMessage:"In Room"});case"entering":return t.formatMessage({id:"people-sidebar.presence.entering",defaultMessage:"Entering Room"});default:return}}(e.presence,c)))}))))}function Gj(e){let{onClose:t,onConfirm:n,displayName:i}=e;return Yy.createElement(N_,{title:"Promote User",beforeTitle:Yy.createElement(Ww,{onClick:t})},Yy.createElement(O_,{center:!0,padding:!0},Yy.createElement("p",null,Yy.createElement(uw.Z,{id:"promote-client-modal.message",defaultMessage:"Promoting a user will grant full access to room settings and moderation tools.{linebreak}Are you sure?",values:{linebreak:Yy.createElement("br",null)}})),Yy.createElement(t_,{preset:"accept",onClick:n},Yy.createElement(uw.Z,{id:"promote-client-modal.confirm-prefix",defaultMessage:"Yes, promote {name}",values:{name:i}})),Yy.createElement(i_,{preset:"cancel",onClick:t})))}Hj.propTypes={className:sw().string,children:sw().node},sw().string,sw().node,zj.propTypes={className:sw().string,children:sw().node},Zj.propTypes={people:sw().array,onSelectPerson:sw().func,showMuteAll:sw().bool,onMuteAll:sw().func,onClose:sw().func,canVoiceChat:sw().bool,voiceChatEnabled:sw().bool,isMod:sw().bool},Zj.defaultProps={people:[],onSelectPerson:()=>{},isMod:!1},Gj.propTypes={displayName:sw().string.isRequired,onConfirm:sw().func,onClose:sw().func};var Yj={"avatar-preview-container":"UserProfileSidebar__avatar-preview-container__K9Anq",avatarPreviewContainer:"UserProfileSidebar__avatar-preview-container__K9Anq","slider-container":"UserProfileSidebar__slider-container__yafCa",sliderContainer:"UserProfileSidebar__slider-container__yafCa","slider-input-container":"UserProfileSidebar__slider-input-container__q8fBZ",sliderInputContainer:"UserProfileSidebar__slider-input-container__q8fBZ"};const Qj=["className","userId","displayName","identityName","avatarPreview","hasMicPresence","isSignedIn","canPromote","onPromote","canDemote","onDemote","isHidden","onToggleHidden","canMute","isNetworkMuted","onMute","canKick","onKick","showBackButton","onBack","onClose"];function Xj(){return Xj=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},Xj.apply(this,arguments)}const Kj=0,$j=Wv-1;function Jj(e){let{className:t,userId:n,displayName:i,identityName:r,avatarPreview:o,hasMicPresence:s,isSignedIn:a,canPromote:l,onPromote:c,canDemote:d,onDemote:u,isHidden:h,onToggleHidden:p,canMute:m,isNetworkMuted:f,onMute:g,canKick:v,onKick:b,showBackButton:y,onBack:w,onClose:_}=e,E=function(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}(e,Qj);const A=(0,FE.Z)(),[S,x,M,P]=function(e,t){const n=function(e){var t;return((null===(t=window.APP)||void 0===t?void 0:t.componentRegistry["player-info"])||[]).find((t=>t.playerSessionId===e))}(e),i=null==n?void 0:n.el.querySelector("[avatar-volume-controls]"),r=null==i?void 0:i.components["avatar-volume-controls"],[o,s]=(0,Yy.useState)(0),[a,l]=(0,Yy.useState)(!1),c=(0,Yy.useCallback)((e=>{let{detail:{gainMultiplier:n}}=e;s(n),t&&t(n)}),[t]),d=(0,Yy.useCallback)((e=>{r&&(s(e),r.updateGainMultiplier(e,!0))}),[r]),u=(0,Yy.useCallback)((e=>{let{detail:{muted:t}}=e;l(t)}),[]),h=(0,Yy.useCallback)((e=>{r&&(l(!!e),r.updateLocalMuted(!!e,!0))}),[r]);return(0,Yy.useEffect)((()=>{if(!i)return;i.addEventListener("gain_multiplier_updated",c),i.addEventListener("local_muted_updated",u);const e=APP.gainMultipliers.get(r.audioEl);c({detail:{gainMultiplier:e}});const t=APP.mutedState.has(r.audioEl);return l(t),()=>{i.removeEventListener("gain_multiplier_updated",c),i.removeEventListener("local_muted_updated",u)}}),[r,i,c,u]),[o,d,a,h]}(n),C=(0,Yy.useCallback)((e=>{x(function(e){return Math.min(qv,e<=Wv/2?e*Zv:1+(e-Wv/2)*Gv)}(e))}),[x]),k=Yv(S);return Yy.createElement(Rw,Xj({title:r?`${i} (${r})`:i,beforeTitle:y?Yy.createElement(Kw,{onClick:w}):Yy.createElement(Ww,{onClick:_}),className:t},E),Yy.createElement(O_,{center:!0,padding:!0},Yy.createElement("div",{className:Yj.avatarPreviewContainer},o||Yy.createElement("div",null)),s&&Yy.createElement("div",{className:Yj.sliderContainer},Yy.createElement(UP,{icon:f||M?Yy.createElement(Rj,null):Yy.createElement(Sj,null),selected:f||M,preset:"accent4",style:{display:"block"},onClick:()=>{P(!M)},disabled:f}),Yy.createElement(Kx,{min:Kj,max:$j,step:1,value:k,onChange:C,className:Yj.sliderInputContainer,disabled:f||M})),l&&Yy.createElement(t_,{preset:"accept",disabled:!a,title:a?A.formatMessage({id:"user-profile-sidebar.promote-button",defaultMessage:"Promote"}):A.formatMessage({id:"user-profile-sidebar.promote-button-disabled-label",defaultMessage:"{displayName} is signed out."},{displayName:i}),onClick:c},Yy.createElement(uw.Z,{id:"user-profile-sidebar.promote-button",defaultMessage:"Promote"})),d&&Yy.createElement(t_,{preset:"cancel",disabled:!a,title:a?A.formatMessage({id:"user-profile-sidebar.demote-button",defaultMessage:"Demote"}):A.formatMessage({id:"user-profile-sidebar.demote-button-disabled-label",defaultMessage:"{displayName} is signed out."},{displayName:i}),onClick:u},Yy.createElement(uw.Z,{id:"user-profile-sidebar.demote-button",defaultMessage:"Demote"})),Yy.createElement(t_,{onClick:p},h?Yy.createElement(uw.Z,{id:"user-profile-sidebar.unhide-button",defaultMessage:"Unhide"}):Yy.createElement(uw.Z,{id:"user-profile-sidebar.hide-button",defaultMessage:"Hide"})),m&&Yy.createElement(t_,{preset:"cancel",onClick:g},Yy.createElement(uw.Z,{id:"user-profile-sidebar.mute-button",defaultMessage:"Mute"})),v&&Yy.createElement(t_,{preset:"cancel",onClick:b},Yy.createElement(uw.Z,{id:"user-profile-sidebar.kick-button",defaultMessage:"Kick"}))))}function eL(e,t,n,i,r,o,s){try{var a=e[o](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(i,r)}function tL(e){return function(){var t=this,n=arguments;return new Promise((function(i,r){var o=e.apply(t,n);function s(e){eL(o,i,r,s,a,"next",e)}function a(e){eL(o,i,r,s,a,"throw",e)}s(void 0)}))}}function nL(e){var t;let{user:n,hubChannel:i,performConditionalSignIn:r,showBackButton:o,onBack:s,onClose:a,onCloseDialog:l,showNonHistoriedDialog:c}=e;const[d,u]=(0,Yy.useState)(),{id:h,profile:{displayName:p,identityName:m,avatarId:f},roles:g}=n,v=i.canOrWillIfCreator("kick_users"),b=!!n.micPresence,y=null===(t=n.micPresence)||void 0===t?void 0:t.muted,w=!y&&i.canOrWillIfCreator("mute_users"),[_,E]=(0,Yy.useState)(!!g.owner),A=!!g.creator,S=!!g.signed_in,x=i.canOrWillIfCreator("update_roles")&&!_&&!A,M=i.canOrWillIfCreator("update_roles")&&_&&!A,[P,C]=(0,Yy.useState)(i.isHidden(n.id));(0,Yy.useEffect)((()=>{f&&function(e){return jg.apply(this,arguments)}(f).then((e=>u(e)))}),[f,u,n]);const k=(0,Yy.useCallback)((()=>{r((()=>i.can("update_roles")),tL((function*(){var e;c(Gj,{displayName:p,onConfirm:(e=tL((function*(){E(!0),yield i.addOwner(h),l()})),function(){return e.apply(this,arguments)})})})),ZS.addOwner)}),[r,i,c,h,l,p]),O=(0,Yy.useCallback)((()=>{r((()=>i.can("update_roles")),tL((function*(){E(!1),yield i.removeOwner(h)})),ZS.removeOwner)}),[r,i,h]),T=(0,Yy.useCallback)((()=>{P?i.unhide(h):i.hide(h),C(!P)}),[P,h,i]),R=(0,Yy.useCallback)((()=>{r((()=>i.can("mute_users")),tL((function*(){return yield i.mute(h)})),ZS.muteUser)}),[r,i,h]),D=(0,Yy.useCallback)((()=>{r((()=>i.can("kick_users")),tL((function*(){return yield i.kick(h)})),ZS.kickUser),a?a():s&&s()}),[r,i,h,a,s]);return Yy.createElement(Jj,{userId:n.id,displayName:p,identityName:m,avatarPreview:Yy.createElement("img",{src:d}),isSignedIn:S,canPromote:x,onPromote:k,canDemote:M,onDemote:O,isHidden:P,onToggleHidden:T,canMute:w,isNetworkMuted:y,onMute:R,canKick:v,onKick:D,showBackButton:o,onClose:a,onBack:s,hasMicPresence:b})}function iL(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function rL(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function oL(e,t,n,i,r){const o=t.metas[t.metas.length-1],s=n.get(e);return!s||r||o.permissions.voice_chat||(s.muted=!0),function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?iL(Object(n),!0).forEach((function(t){rL(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):iL(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({id:e,isMe:i===e,micPresence:s},o)}function sL(e){let{hubChannel:t,people:n,onSelectPerson:i,onClose:r}=e;const o=(0,Yy.useCallback)((()=>{for(const e of n)"room"===e.presence&&e.permissions&&!e.permissions.mute_users&&t.mute(e.id)}),[n,t]),s=NT("voice_chat"),{voice_chat:a}=DR(),l=ak("owner");return Yy.createElement(Zj,{people:n,onSelectPerson:i,onClose:r,onMuteAll:o,showMuteAll:t.can("mute_users"),canVoiceChat:s,voiceChatEnabled:a,isMod:l})}function aL(e){let{hubChannel:t,presences:n,mySessionId:i,displayNameOverride:r,store:o,mediaSearchStore:s,performConditionalSignIn:a,onCloseDialog:l,showNonHistoriedDialog:c,onClose:d}=e;const u=function(e,t,n){void 0===n&&(n=500);const[i,r]=(0,Yy.useState)([]),{voice_chat:o}=DR();return(0,Yy.useEffect)((()=>{let i;return function s(){const a=Ow();r(Object.entries(e).map((e=>{let[n,i]=e;return oL(n,i,a,t,o)}))),i=setTimeout(s,n)}(),()=>{clearTimeout(i)}}),[e,n,r,t,o]),i}(n,i),[h,p]=(0,Yy.useState)(null),m=u.find((e=>e.id===h)),f=(0,Yy.useCallback)((e=>{p(e.id)}),[p]);return m?m.id===i?Yy.createElement(fE,{containerType:"sidebar",displayNameOverride:r,store:o,mediaSearchStore:s,finished:()=>p(null),history:history,showBackButton:!0,onBack:()=>p(null)}):Yy.createElement(nL,{user:m,hubChannel:t,performConditionalSignIn:a,showBackButton:!0,onBack:()=>p(null),onCloseDialog:l,showNonHistoriedDialog:c}):Yy.createElement(sL,{onSelectPerson:f,onClose:d,hubChannel:t,people:u})}Jj.propTypes={className:sw().string,userId:sw().string,displayName:sw().string,identityName:sw().string,avatarPreview:sw().node,hasMicPresence:sw().bool,isSignedIn:sw().bool,canPromote:sw().bool,onPromote:sw().func,canDemote:sw().bool,onDemote:sw().func,isHidden:sw().bool,onToggleHidden:sw().func,canMute:sw().bool,isNetworkMuted:sw().bool,onMute:sw().func,canKick:sw().bool,onKick:sw().func,showBackButton:sw().bool,onBack:sw().func,onClose:sw().func},nL.propTypes={user:sw().object.isRequired,hubChannel:sw().object,performConditionalSignIn:sw().func,showBackButton:sw().bool,onBack:sw().func,onClose:sw().func,onCloseDialog:sw().func.isRequired,showNonHistoriedDialog:sw().func},sL.propTypes={onSelectPerson:sw().func.isRequired,hubChannel:sw().object.isRequired,onClose:sw().func.isRequired,people:sw().array.isRequired},aL.propTypes={displayNameOverride:sw().string,store:sw().object.isRequired,mediaSearchStore:sw().object.isRequired,hubChannel:sw().object.isRequired,history:sw().object.isRequired,onClose:sw().func.isRequired,mySessionId:sw().string.isRequired,presences:sw().object.isRequired,performConditionalSignIn:sw().func.isRequired,onCloseDialog:sw().func.isRequired,showNonHistoriedDialog:sw().func.isRequired};var lL=n(41097),cL=n(98190),dL=n(78076),uL=n(86766),hL=n(16995),pL=n(62925);const mL=0,fL=1,gL=2,vL=3,bL=4,yL=5;function wL(e){return e.components["media-video"]&&e.components["media-video"].data.contentType.startsWith("audio/")?fL:e.components["media-video"]?mL:e.components["media-image"]?gL:e.components["media-pdf"]?vL:e.components["gltf-model-plus"]?bL:yL}function _L(e,t){return wL(e)-wL(t)}new Map([[mL,lL.Iy],[fL,cL.Xi],[gL,dL.Vm],[vL,uL.Xg],[yL,hL.Ps],[bL,pL.hG]]);const EL={[mL]:"video",[fL]:"audio",[gL]:"image",[vL]:"pdf",[bL]:"model"};function AL(e){const t=wL(e);return EL[t]}function SL(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function xL(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ML(e){const t=e.components["media-loader"]&&e.components["media-loader"].data.src||"",n=t.split("/"),i=n[n.length-1].split("?")[0];let r=-1;for(let e=0;e<n.length;e++)-1!==n[e].indexOf("http")&&(r=e);let o="",s="";if(-1!==r&&n.length>r+3){o=n[r+2];const e=o.split(".");e.length>1&&(s=`${e[e.length-2]}.${e[e.length-1]}`)}return`${-1!==t.indexOf("sketchfab.com")?"Sketchfab":-1!==t.indexOf("youtube.com")?"YouTube":s} ... ${i.substr(0,4)}`}const PL=(0,Yy.createContext)({objects:[],focusedObject:null,selectedObject:null,focusObject:()=>{},unfocusObject:()=>{},inspectObject:()=>{},uninspectObject:()=>{}});function CL(e,t,n){const i=e.systems["hubs-systems"].cameraSystem;n(t),t.el.object3D!==i.inspectable&&(i.inspectable&&i.uninspect(!1),i.inspect(t.el,1.5,!1))}function kL(e,t,n){const i=e.systems["hubs-systems"].cameraSystem;n(null),i.uninspect(!1),t&&i.inspect(t.el,1.5,!1)}function OL(e){let{scene:t,children:n}=e;const[i,r]=(0,Yy.useState)([]),[o,s]=(0,Yy.useState)(null),[a,l]=(0,Yy.useState)(null),c=t.systems["hubs-systems"].cameraSystem,[d,u]=(0,Yy.useState)(c.lightsEnabled);(0,Yy.useEffect)((()=>{function e(){const e=t.systems["listed-media"].els.sort(_L).map((e=>({id:e.object3D.id,name:ML(e),type:AL(e),el:e})));r(e)}let n;return t.addEventListener("listed_media_changed",(function(){n=setTimeout((()=>e()),0)})),e(),()=>{t.removeEventListener("listed_media_changed",e),clearTimeout(n)}}),[t,r]),(0,Yy.useEffect)((()=>{function e(){const e=t.systems["hubs-systems"].cameraSystem,n=e.inspectable&&e.inspectable.el;if(n){const e=i.find((e=>e.el===n));l(e||{id:n.object3D.id,name:ML(n),type:AL(n),el:n})}else l(null)}return t.addEventListener("inspect-target-changed",e),()=>{t.removeEventListener("inspect-target-changed",e)}}),[t,l,i]),(0,Yy.useEffect)((()=>{function e(){const e=t.systems["hubs-systems"].cameraSystem;u(e.lightsEnabled)}return t.addEventListener("inspect-lights-changed",e),()=>{t.removeEventListener("inspect-lights-changed",e)}}),[t]);const h=(0,Yy.useCallback)((e=>CL(t,e,l)),[t,l]),p=(0,Yy.useCallback)((()=>kL(t,o,l)),[t,l,o]),m=(0,Yy.useCallback)((e=>CL(t,e,s)),[t,s]),f=(0,Yy.useCallback)((()=>kL(t,a,s)),[t,s,a]),g=(0,Yy.useCallback)((()=>{const e=i.indexOf(a);if(-1!==e){const t=(e+1)%i.length;h(i[t])}}),[h,i,a]),v=(0,Yy.useCallback)((()=>{const e=i.indexOf(a);if(-1!==e){const t=0===e?i.length-1:e-1;h(i[t])}}),[h,i,a]),b=(0,Yy.useCallback)((()=>{t.systems["hubs-systems"].cameraSystem.toggleLights()}),[t]),y={objects:i,activeObject:o||a,focusedObject:o,selectedObject:a,focusObject:m,unfocusObject:f,selectObject:h,deselectObject:p,selectPrevObject:v,selectNextObject:g,toggleLights:b,lightsEnabled:d};return Yy.createElement(PL.Provider,{value:y},Yy.Children.map(n,(e=>(0,Yy.cloneElement)(e,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?SL(Object(n),!0).forEach((function(t){xL(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):SL(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},y)))))}function TL(){return(0,Yy.useContext)(PL)}OL.propTypes={scene:sw().object.isRequired,children:sw().node};var RL,DL,jL,LL={object:"ObjectsSidebar__object__sVTgg","no-objects":"ObjectsSidebar__no-objects__R4i8v",noObjects:"ObjectsSidebar__no-objects__R4i8v"};function IL(){return IL=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},IL.apply(this,arguments)}const NL=e=>{let{title:t,titleId:n,...i}=e;return Yy.createElement("svg",IL({width:20,height:20,viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":n},i),t?Yy.createElement("title",{id:n},t):null,RL||(RL=Yy.createElement("path",{d:"M17.5 13.336v-6.67a1.25 1.25 0 0 0-.62-1.079l-5.938-3.455a1.873 1.873 0 0 0-1.885 0L3.121 5.587A1.25 1.25 0 0 0 2.5 6.666v6.67a1.25 1.25 0 0 0 .62 1.08l5.938 3.455a1.875 1.875 0 0 0 1.885 0l5.937-3.456a1.249 1.249 0 0 0 .62-1.079Z",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})),DL||(DL=Yy.createElement("path",{d:"M2.695 6.016 10 10.313l7.305-4.297",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})),jL||(jL=Yy.createElement("path",{d:"M10 18.125v-7.812",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})))};var FL,BL,VL,UL;function HL(){return HL=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},HL.apply(this,arguments)}const zL=e=>{let{title:t,titleId:n,...i}=e;return Yy.createElement("svg",HL({width:20,height:20,viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":n},i),t?Yy.createElement("title",{id:n},t):null,FL||(FL=Yy.createElement("path",{d:"M16.25 3.125H3.75c-1.035 0-1.875.84-1.875 1.875v10c0 1.036.84 1.875 1.875 1.875h12.5c1.036 0 1.875-.839 1.875-1.874V5c0-1.036-.84-1.876-1.875-1.876Z",stroke:"currentColor",strokeWidth:1.5,strokeLinejoin:"round"})),BL||(BL=Yy.createElement("path",{d:"M13.125 8.125a1.25 1.25 0 1 0 0-2.5 1.25 1.25 0 0 0 0 2.5Z",stroke:"currentColor",strokeWidth:1.5,strokeMiterlimit:10})),VL||(VL=Yy.createElement("path",{d:"M11.875 13.116 8.334 9.581a1.25 1.25 0 0 0-1.714-.05l-4.745 4.218",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})),UL||(UL=Yy.createElement("path",{d:"m8.75 16.875 4.818-4.818a1.25 1.25 0 0 1 1.684-.078l2.873 2.396",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})))};var WL,qL;function ZL(){return ZL=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},ZL.apply(this,arguments)}const GL=e=>{let{title:t,titleId:n,...i}=e;return Yy.createElement("svg",ZL({width:20,height:20,viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":n},i),t?Yy.createElement("title",{id:n},t):null,WL||(WL=Yy.createElement("path",{d:"m14.64 12.061 3.231 2.275a.625.625 0 0 0 .879-.572v-7.53a.625.625 0 0 0-.879-.57l-3.23 2.274a.625.625 0 0 0-.266.51v3.102a.624.624 0 0 0 .265.511Z",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})),qL||(qL=Yy.createElement("path",{d:"M10.469 14.998H3.28a2.037 2.037 0 0 1-2.031-2.03V7.03a2.037 2.037 0 0 1 2.031-2.031h7.207A2.019 2.019 0 0 1 12.5 7.01v5.956a2.037 2.037 0 0 1-2.031 2.031Z",stroke:"currentColor",strokeWidth:1.5,strokeMiterlimit:10})))};var YL,QL;function XL(){return XL=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},XL.apply(this,arguments)}const KL=e=>{let{title:t,titleId:n,...i}=e;return Yy.createElement("svg",XL({width:20,height:20,viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":n},i),t?Yy.createElement("title",{id:n},t):null,YL||(YL=Yy.createElement("path",{d:"M7.5 8.516V8.28c0-.58.39-1.054.947-1.195l6.82-1.823a.782.782 0 0 1 .983.753v.86",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})),QL||(QL=Yy.createElement("path",{d:"M16.25 11.559v3.125c0 .543-.349 1-.86 1.171l-.859.313c-1.011.34-2.031-.407-2.031-1.484a1.304 1.304 0 0 1 .898-1.25l1.993-.71c.51-.171.859-.622.859-1.165Zm0 0V2.264a.392.392 0 0 0-.492-.375l-7.79 2.094a.644.644 0 0 0-.468.625v8.828c0 .543-.349 1-.86 1.172l-2.03.703c-.543.183-.86.672-.86 1.25 0 1.077 1.036 1.818 2.031 1.484l.86-.312c.51-.172.859-.628.859-1.172v-3.125",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})))},$L=["selected","object"];function JL(){return JL=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},JL.apply(this,arguments)}const eI=(0,gE.vU)({video:{id:"objects-sidebar.object-type.video",defaultMessage:"Video"},audio:{id:"objects-sidebar.object-type.audio",defaultMessage:"Audio"},image:{id:"objects-sidebar.object-type.image",defaultMessage:"Image"},pdf:{id:"objects-sidebar.object-type.pdf",defaultMessage:"PDF"},model:{id:"objects-sidebar.object-type.model",defaultMessage:"Model"},default:{id:"objects-sidebar.object-type.default",defaultMessage:"Object"}});function tI(e){let{selected:t,object:n}=e,i=function(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}(e,$L);const r=(0,FE.Z)(),o=function(e){switch(e){case"video":return GL;case"audio":return KL;case"image":return zL;case"pdf":return ND;default:return NL}}(n.type);return Yy.createElement(zj,JL({},i,{className:lw()(LL.object,{[Nj.selected]:t}),type:"button","aria-label":r.formatMessage({id:"objects-sidebar.object-label",defaultMessage:"{objectType}: {objectName}"},{objectType:r.formatMessage(eI[n.type]||eI.default),objectName:n.name})}),Yy.createElement(o,null),Yy.createElement("p",null,n.name))}function nI(e){let{canAddObjects:t}=e;return Yy.createElement("li",{className:LL.noObjects},Yy.createElement("p",null,Yy.createElement(uw.Z,{id:"objects-sidebar.no-objects",defaultMessage:"There are no objects in the room."})),t&&Yy.createElement("p",null,Yy.createElement(uw.Z,{id:"objects-sidebar.place-menu-tip",defaultMessage:"Use the place menu to add objects."})))}function iI(e){let{children:t,objectCount:n,onClose:i}=e;return Yy.createElement(Rw,{title:Yy.createElement(uw.Z,{id:"objects-sidebar.title",defaultMessage:"Objects ({objectCount})",values:{objectCount:n}}),beforeTitle:Yy.createElement(Ww,{onClick:i})},Yy.createElement("ul",null,t))}function rI(e){let{onClose:t,hubChannel:n}=e;const i=(0,Yy.useRef)(),{objects:r,selectedObject:o,selectObject:s,unfocusObject:a,focusObject:l}=TL(),c=(0,Yy.useCallback)((e=>{e.relatedTarget!==i.current&&i.current.contains(e.relatedTarget)||a()}),[a,i]);return Yy.createElement(iI,{objectCount:r.length,onClose:t},r.length>0?Yy.createElement(Hj,{ref:i},r.map((e=>Yy.createElement(tI,{selected:o===e,object:e,key:e.id,onClick:()=>s(e),onMouseOver:()=>l(e),onFocus:()=>l(e),onMouseOut:c,onBlur:c})))):Yy.createElement(nI,{canAddObjects:n.can("spawn_and_move_media")}))}tI.propTypes={selected:sw().bool,object:sw().shape({id:sw().any.isRequired,name:sw().string.isRequired,type:sw().string})},nI.propTypes={canAddObjects:sw().bool},iI.propTypes={objectCount:sw().number.isRequired,children:sw().node,onClose:sw().func},iI.defaultProps={objectCount:0},rI.propTypes={hubChannel:sw().object.isRequired,onClose:sw().func};var oI,sI,aI,lI={"back-button":"ObjectMenu__back-button__ICMWs",backButton:"ObjectMenu__back-button__ICMWs","lights-button":"ObjectMenu__lights-button__fapNn",lightsButton:"ObjectMenu__lights-button__fapNn","object-menu-container":"ObjectMenu__object-menu-container__ot90K",objectMenuContainer:"ObjectMenu__object-menu-container__ot90K","object-menu":"ObjectMenu__object-menu__IKHRK",objectMenu:"ObjectMenu__object-menu__IKHRK",header:"ObjectMenu__header__Rbudi","close-button":"ObjectMenu__close-button__WCIkA",closeButton:"ObjectMenu__close-button__WCIkA","lights-header-button":"ObjectMenu__lights-header-button__Cowoe",lightsHeaderButton:"ObjectMenu__lights-header-button__Cowoe",menu:"ObjectMenu__menu__CAJfI","object-menu-button":"ObjectMenu__object-menu-button__TEFnB",objectMenuButton:"ObjectMenu__object-menu-button__TEFnB",separator:"ObjectMenu__separator__rZsbV",pagination:"ObjectMenu__pagination__tAo_e"};function cI(){return cI=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},cI.apply(this,arguments)}const dI=e=>{let{title:t,titleId:n,...i}=e;return Yy.createElement("svg",cI({width:20,height:20,viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":n},i),t?Yy.createElement("title",{id:n},t):null,oI||(oI=Yy.createElement("path",{d:"M11.25 18.125h-2.5a.625.625 0 1 0 0 1.25h2.5a.625.625 0 0 0 0-1.25Z",fill:"currentColor"})),sI||(sI=Yy.createElement("path",{d:"M11.875 16.25h-3.75a.625.625 0 0 0 0 1.25h3.75a.625.625 0 1 0 0-1.25Z",fill:"currentColor"})),aI||(aI=Yy.createElement("path",{d:"M14.43 2.449A6.214 6.214 0 0 0 10 .625a6.235 6.235 0 0 0-6.25 6.25c0 1.821.698 3.525 1.914 4.674l.17.16c.704.657 1.666 1.558 1.666 2.354V15a.625.625 0 0 0 .625.625h.938a.313.313 0 0 0 .312-.312v-4.578a.313.313 0 0 0-.2-.291 5.104 5.104 0 0 1-1.022-.561.625.625 0 1 1 .726-1.016c.289.205.845.508 1.121.508s.832-.304 1.122-.508a.625.625 0 0 1 .725 1.016 5.102 5.102 0 0 1-1.022.56.313.313 0 0 0-.2.291v4.579a.313.313 0 0 0 .313.312h.937A.625.625 0 0 0 12.5 15v-.937c0-.777.952-1.677 1.646-2.335l.192-.182c1.251-1.194 1.912-2.811 1.912-4.67a6.216 6.216 0 0 0-1.82-4.427Z",fill:"currentColor"})))};var uI,hI,pI,mI,fI;function gI(){return gI=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},gI.apply(this,arguments)}const vI=e=>{let{title:t,titleId:n,...i}=e;return Yy.createElement("svg",gI({width:20,height:20,viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":n},i),t?Yy.createElement("title",{id:n},t):null,uI||(uI=Yy.createElement("path",{d:"M11.875 15v-.937c0-1.133 1.232-2.204 2.031-2.969 1.127-1.077 1.719-2.523 1.719-4.218A5.595 5.595 0 0 0 10 1.25a5.61 5.61 0 0 0-5.625 5.625c0 1.634.618 3.179 1.719 4.218.795.75 2.031 1.825 2.031 2.97V15",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})),hI||(hI=Yy.createElement("path",{d:"M8.75 18.75h2.5",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})),pI||(pI=Yy.createElement("path",{d:"M8.125 16.875h3.75",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})),mI||(mI=Yy.createElement("path",{d:"M10 15v-5",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})),fI||(fI=Yy.createElement("path",{d:"M11.484 9.375S10.644 10 10 10s-1.484-.625-1.484-.625",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})))},bI=["children","className"];function yI(){return yI=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},yI.apply(this,arguments)}function wI(e){let{children:t,className:n}=e,i=function(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}(e,bI);return Yy.createElement(Iw,yI({compactSm:!0,className:lw()(lI.objectMenuButton,n)},i),t)}function _I(e){let{children:t,title:n,onClose:i,onBack:r,onPrevObject:o,onNextObject:s,currentObjectIndex:a,objectCount:l,onToggleLights:c,lightsEnabled:d}=e;return Yy.createElement(Yy.Fragment,null,Yy.createElement(Iw,{className:lI.backButton,onClick:r},Yy.createElement(Yw,{width:24,height:24})),Yy.createElement(Iw,{className:lI.lightsButton,onClick:c},d?Yy.createElement(vI,{title:"Turn Lights Off",width:24,height:24}):Yy.createElement(dI,{title:"Turn Lights On",width:24,height:24})),Yy.createElement("div",{className:lI.objectMenuContainer},Yy.createElement("div",{className:lI.objectMenu},Yy.createElement("div",{className:lI.header},Yy.createElement(Iw,{className:lI.closeButton,onClick:i},Yy.createElement(Vw,{width:16,height:16})),Yy.createElement("h5",null,n),Yy.createElement(Iw,{className:lI.lightsHeaderButton,onClick:c},d?Yy.createElement(vI,{title:"Turn Lights Off",width:16,height:16}):Yy.createElement(dI,{title:"Turn Lights On",width:16,height:16}))),Yy.createElement("div",{className:lI.menu},GR(t,(()=>Yy.createElement("div",{className:lI.separator}))))),Yy.createElement("div",{className:lI.pagination},Yy.createElement(Iw,{onClick:o},Yy.createElement(dA,{width:24,height:24})),Yy.createElement("p",null,a+1,"/",l),Yy.createElement(Iw,{onClick:s},Yy.createElement(sA,{width:24,height:24})))))}function EI(e,t){(NAF.utils.isMine(t)||NAF.utils.takeOwnership(t))&&(t.setAttribute("animation__remove",{property:"scale",dur:200,to:{x:.01,y:.01,z:.01},easing:"easeInQuad"}),t.addEventListener("animationcomplete",(()=>{e.systems["hubs-systems"].cameraSystem.uninspect(),NAF.utils.takeOwnership(t),t.parentNode.removeChild(t)})))}wI.propTypes={className:sw().string,children:sw().node},_I.propTypes={currentObjectIndex:sw().number.isRequired,objectCount:sw().number.isRequired,onPrevObject:sw().func,onNextObject:sw().func,children:sw().node,title:sw().node,onClose:sw().func,onBack:sw().func,onToggleLights:sw().func,lightsEnabled:sw().bool};var AI,SI=n(99477);function xI(e){return!(!(0,Ot.hasComponent)(APP.world,Nn,e.eid)||!(0,Ot.hasComponent)(APP.world,Fn,e.eid))}function MI(e){return!!e.el.components["networked-avatar"]}function PI(){return PI=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},PI.apply(this,arguments)}const CI=e=>{let{title:t,titleId:n,...i}=e;return Yy.createElement("svg",PI({width:22,height:22,viewBox:"0 0 22 22",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":n},i),t?Yy.createElement("title",{id:n},t):null,AI||(AI=Yy.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M10.463 12.668a.751.751 0 0 1-.07.08l-5.08 5.081a.75.75 0 1 1-1.061-1.06l5.08-5.081a.758.758 0 0 1 .081-.07l-.386-.386-2.536-2.537a1.12 1.12 0 0 1-.331-.8c0-.266.092-.542.285-.753a4.598 4.598 0 0 1 3.593-1.516h.193a2.74 2.74 0 0 0 2.739-2.739v-.67c0-.304.119-.589.33-.8a1.143 1.143 0 0 1 1.608 0l5.68 5.68c.211.21.33.495.33.799 0 .625-.514 1.14-1.13 1.14h-.67a2.74 2.74 0 0 0-2.74 2.738V11.986a4.995 4.995 0 0 1-1.47 3.528 1.143 1.143 0 0 1-1.608 0l-2.536-2.546-.3-.3Zm-.486-5.544.03.002h.224a4.24 4.24 0 0 0 4.233-4.032L18.91 7.54a4.24 4.24 0 0 0-4.031 4.234V11.986c0 .798-.28 1.574-.787 2.197l-2.266-2.273-.001-.002-1.737-1.737-2.276-2.275a3.098 3.098 0 0 1 2.165-.772Z",fill:"currentColor"})))};var kI,OI,TI,RI,DI;function jI(){return jI=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},jI.apply(this,arguments)}const LI=e=>{let{title:t,titleId:n,...i}=e;return Yy.createElement("svg",jI({width:20,height:20,viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":n},i),t?Yy.createElement("title",{id:n},t):null,kI||(kI=Yy.createElement("path",{d:"m12.274 18.84-2.218-4.482-1.753-2.242a2.844 2.844 0 0 1-.396-1.447V5.624h.612a1.57 1.57 0 0 1 1.572 1.571v7.163",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})),OI||(OI=Yy.createElement("path",{d:"M4.996 11.446v-2.91s1.456-2.912 2.911-2.912",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})),TI||(TI=Yy.createElement("path",{d:"m14.457 10.719-2.582-1.696",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})),RI||(RI=Yy.createElement("path",{d:"m6.661 18.684 2.09-3.06",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})),DI||(DI=Yy.createElement("path",{d:"M10.09 4.169a1.455 1.455 0 1 0 0-2.911 1.455 1.455 0 0 0 0 2.91Z",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})))};var II,NI,FI,BI,VI;function UI(){return UI=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},UI.apply(this,arguments)}const HI=e=>{let{title:t,titleId:n,...i}=e;return Yy.createElement("svg",UI({width:20,height:20,viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":n},i),t?Yy.createElement("title",{id:n},t):null,II||(II=Yy.createElement("path",{d:"M16.875 17.5a.623.623 0 0 1-.442-.183L2.683 3.567a.625.625 0 0 1 .884-.883l13.75 13.75a.624.624 0 0 1-.442 1.066Z",fill:"currentColor"})),NI||(NI=Yy.createElement("path",{d:"M9.987 15c-1.62 0-3.184-.48-4.646-1.426-1.33-.859-2.528-2.09-3.464-3.554v-.003c.779-1.116 1.632-2.06 2.548-2.821a.078.078 0 0 0 .006-.115l-.779-.777a.078.078 0 0 0-.105-.005C2.573 7.12 1.67 8.126.848 9.304a1.247 1.247 0 0 0-.025 1.388c1.032 1.615 2.36 2.975 3.84 3.932 1.665 1.08 3.458 1.626 5.324 1.626a9.34 9.34 0 0 0 2.96-.491.079.079 0 0 0 .05-.096.079.079 0 0 0-.02-.034l-.842-.842a.156.156 0 0 0-.15-.04A8 8 0 0 1 9.987 15Z",fill:"currentColor"})),FI||(FI=Yy.createElement("path",{d:"M19.173 9.32C18.14 7.722 16.8 6.364 15.296 5.393c-1.663-1.075-3.5-1.643-5.31-1.643a8.88 8.88 0 0 0-2.925.5.078.078 0 0 0-.03.13l.843.842a.156.156 0 0 0 .151.039A7.532 7.532 0 0 1 9.987 5c1.59 0 3.147.485 4.63 1.445 1.356.875 2.569 2.105 3.507 3.555a.005.005 0 0 1 0 .006 12.136 12.136 0 0 1-2.505 2.84.078.078 0 0 0-.023.089c.004.01.01.02.017.027l.777.777a.078.078 0 0 0 .106.005 13.42 13.42 0 0 0 2.681-3.066 1.258 1.258 0 0 0-.004-1.358Z",fill:"currentColor"})),BI||(BI=Yy.createElement("path",{d:"M10 6.25c-.281 0-.561.03-.835.093a.078.078 0 0 0-.039.132l4.398 4.397a.078.078 0 0 0 .132-.039A3.75 3.75 0 0 0 10 6.249Z",fill:"currentColor"})),VI||(VI=Yy.createElement("path",{d:"M6.476 9.128a.078.078 0 0 0-.132.039 3.75 3.75 0 0 0 4.492 4.492.077.077 0 0 0 .059-.054.078.078 0 0 0-.02-.078l-4.4-4.4Z",fill:"currentColor"})))};function zI(e){let{onOpenProfile:t}=e;return Yy.createElement(wI,{onClick:t},Yy.createElement(pD,null),Yy.createElement("span",null,Yy.createElement(uw.Z,{id:"object-menu.edit-avatar-button",defaultMessage:"Edit Avatar"})))}function WI(e){let{hubChannel:t,activeObject:n,deselectObject:i}=e;const r=function(e,t){return(0,Yy.useCallback)((()=>{if(t.components.networked){const n=t.components.networked.data.owner;n&&n!==NAF.clientId&&e.hide(n)}}),[e,t])}(t,n.el);return Yy.createElement(wI,{onClick:()=>{i(),r()}},Yy.createElement(HI,null),Yy.createElement("span",null,Yy.createElement(uw.Z,{id:"object-menu.hide-avatar-button",defaultMessage:"Hide"})))}function qI(e){let{hubChannel:t,scene:n,activeObject:i,deselectObject:r,onGoToObject:o}=e;const{canPin:s,isPinned:a,togglePinned:l}=function(e,t,n){const[i,r]=(0,Yy.useState)(xI(n.el)),o=(0,Yy.useCallback)((()=>{const e=n.el;(NAF.utils.isMine(e)||NAF.utils.takeOwnership(e))&&window.APP.pinningHelper.setPinned(e,!0)}),[n]),s=(0,Yy.useCallback)((()=>{const e=n.el;(NAF.utils.isMine(e)||NAF.utils.takeOwnership(e))&&window.APP.pinningHelper.setPinned(e,!1)}),[n]),a=(0,Yy.useCallback)((()=>{i?s():o()}),[i,o,s]);(0,Yy.useEffect)((()=>{const e=n.el;function t(){r(xI(e))}return e.addEventListener("pinned",t),e.addEventListener("unpinned",t),r(xI(e)),()=>{e.removeEventListener("pinned",t),e.removeEventListener("unpinned",t)}}),[n]);const l=n.el;let c=!1;if(l.components["media-loader"]){const{fileIsOwned:e,fileId:t}=l.components["media-loader"].data;c=e||t&&Vl(t)}return{canPin:!(!t.is("entered")||MI(n)||(0,Ot.hasComponent)(APP.world,Tn,l.eid)||!e.can("pin_objects")||!c),isPinned:i,togglePinned:a,pinObject:o,unpinObject:s}}(t,n,i),{canRemoveObject:c,removeObject:d}=function(e,t,n){const i=(0,Yy.useCallback)((()=>{EI(t,n.el)}),[t,n]),r=n.el;return{removeObject:i,canRemoveObject:!(!t.is("entered")||MI(n)||xI(r)||(0,Ot.hasComponent)(APP.world,Tn,r.eid)||!e.can("spawn_and_move_media"))}}(t,n,i),{canGoTo:u,goToSelectedObject:h}=function(e,t){const n=(0,Yy.useCallback)((()=>{const t=document.getElementById("viewing-camera"),n=new SI.Matrix4,i=new SI.Matrix4;t.object3DMap.camera.updateMatrices(),n.copy(t.object3DMap.camera.matrixWorld),Lo(n,n),i.makeTranslation(0,-1.6,.15),n.multiply(i),No(n,Math.PI,n),e.systems["hubs-systems"].characterController.enqueueWaypointTravelTo(n,!0,{willDisableMotion:!1,willDisableTeleporting:!1,snapToNavMesh:!1,willMaintainInitialOrientation:!1})}),[e]),i=(0,Yy.useMemo)((()=>document.getElementById("ui-root")),[]);return{canGoTo:!(i&&i.firstChild&&i.firstChild.classList.contains("isGhost")||MI(t)),goToSelectedObject:n}}(n,i),p=function(e){const t=e.el.components["media-loader"],n=t&&(t.data.mediaOptions&&t.data.mediaOptions.href||t.data.src);return n&&!n.startsWith("hubs://")?n:null}(i);return Yy.createElement(Yy.Fragment,null,Yy.createElement(wI,{disabled:!s,onClick:l},Yy.createElement(CI,null),Yy.createElement("span",null,a?Yy.createElement(uw.Z,{id:"object-menu.unpin-object-button",defaultMessage:"Unpin"}):Yy.createElement(uw.Z,{id:"object-menu.pin-object-button",defaultMessage:"Pin"}))),p&&Yy.createElement(wI,{as:"a",href:p,target:"_blank",rel:"noopener noreferrer"},Yy.createElement(xA,null),Yy.createElement("span",null,Yy.createElement(uw.Z,{id:"object-menu.object-link-button",defaultMessage:"Link"}))),Yy.createElement(wI,{disabled:!u,onClick:()=>{h(),r(),o()}},Yy.createElement(LI,null),Yy.createElement("span",null,Yy.createElement(uw.Z,{id:"object-menu.view-object-button",defaultMessage:"View"}))),Yy.createElement(wI,{disabled:!c,onClick:()=>{d(),r()}},Yy.createElement(_D,null),Yy.createElement("span",null,Yy.createElement(uw.Z,{id:"object-menu.delete-object-button",defaultMessage:"Delete"}))))}function ZI(e){let{hubChannel:t,scene:n,onOpenProfile:i,onGoToObject:r}=e;const{objects:o,activeObject:s,deselectObject:a,selectNextObject:l,selectPrevObject:c,toggleLights:d,lightsEnabled:u}=TL();let h;return h="avatar-rig"===s.el.id?Yy.createElement(zI,{onOpenProfile:i}):MI(s)?Yy.createElement(WI,{hubChannel:t,activeObject:s,deselectObject:a}):Yy.createElement(qI,{hubChannel:t,scene:n,activeObject:s,deselectObject:a,onGoToObject:r}),Yy.createElement(_I,{title:Yy.createElement(uw.Z,{id:"object-menu.title",defaultMessage:"Object"}),currentObjectIndex:o.indexOf(s),objectCount:o.length,onClose:a,onBack:a,onNextObject:l,onPrevObject:c,onToggleLights:d,lightsEnabled:u},h)}var GI;function YI(){return YI=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},YI.apply(this,arguments)}zI.propTypes={onOpenProfile:sw().func.isRequired},WI.propTypes={hubChannel:sw().object.isRequired,activeObject:sw().object.isRequired,deselectObject:sw().func.isRequired},qI.propTypes={hubChannel:sw().object.isRequired,scene:sw().object.isRequired,activeObject:sw().object.isRequired,deselectObject:sw().func.isRequired,onGoToObject:sw().func.isRequired},ZI.propTypes={hubChannel:sw().object.isRequired,scene:sw().object.isRequired,onOpenProfile:sw().func.isRequired,onGoToObject:sw().func.isRequired};const QI=e=>{let{title:t,titleId:n,...i}=e;return Yy.createElement("svg",YI({width:20,height:20,viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":n},i),t?Yy.createElement("title",{id:n},t):null,GI||(GI=Yy.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M3.25 15.375a1.125 1.125 0 0 1-1.125-1.125v-9c0-.621.504-1.125 1.125-1.125h13.5c.621 0 1.125.504 1.125 1.125v9c0 .621-.504 1.125-1.125 1.125H3.25ZM1 14.25a2.25 2.25 0 0 0 2.25 2.25h13.5A2.25 2.25 0 0 0 19 14.25v-9A2.25 2.25 0 0 0 16.75 3H3.25A2.25 2.25 0 0 0 1 5.25v9Zm7.958-2.558c-.204.244-.492.434-.865.57-.373.133-.786.2-1.239.2-.476 0-.894-.103-1.254-.31a2.105 2.105 0 0 1-.83-.906c-.194-.395-.294-.86-.299-1.393v-.374c0-.55.092-1.024.276-1.424.186-.403.453-.71.8-.922.35-.214.76-.32 1.228-.32.652 0 1.162.156 1.53.468.367.31.585.761.653 1.356H7.855c-.05-.315-.162-.546-.336-.692-.171-.146-.408-.219-.71-.219-.385 0-.679.145-.88.435-.201.29-.303.72-.306 1.291v.352c0 .576.11 1.012.329 1.306.219.295.54.442.963.442.425 0 .729-.09.91-.272v-.948H6.794v-.834h2.164v2.194Zm2.126.695H9.951V6.888h1.133v5.499Zm2.187-2.247h2.175v-.914H13.27v-1.42h2.447v-.918h-3.58v5.499h1.133V10.14Z",fill:"currentColor"})))};var XI,KI,$I,JI,eN,tN;function nN(){return nN=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},nN.apply(this,arguments)}const iN=e=>{let{title:t,titleId:n,...i}=e;return Yy.createElement("svg",nN({width:20,height:20,viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":n},i),t?Yy.createElement("title",{id:n},t):null,XI||(XI=Yy.createElement("path",{d:"M10 1.874a8.125 8.125 0 1 0 0 16.25 8.125 8.125 0 0 0 0-16.25Z",stroke:"currentColor",strokeWidth:1.5,strokeMiterlimit:10})),KI||(KI=Yy.createElement("path",{d:"M10 1.874C7.73 1.874 5.599 5.512 5.599 10s2.132 8.125 4.4 8.125c2.27 0 4.402-3.638 4.402-8.125S12.268 1.874 10 1.874Z",stroke:"currentColor",strokeWidth:1.5,strokeMiterlimit:10})),$I||($I=Yy.createElement("path",{d:"M4.583 4.583C6.077 5.643 7.958 6.276 10 6.276c2.043 0 3.923-.633 5.417-1.693",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})),JI||(JI=Yy.createElement("path",{d:"M15.417 15.417c-1.494-1.06-3.374-1.693-5.417-1.693-2.042 0-3.923.633-5.417 1.693",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})),eN||(eN=Yy.createElement("path",{d:"M10 1.874v16.25",stroke:"currentColor",strokeWidth:1.5,strokeMiterlimit:10})),tN||(tN=Yy.createElement("path",{d:"M18.125 9.999H1.875",stroke:"currentColor",strokeWidth:1.5,strokeMiterlimit:10})))};var rN={"button-grid-popover":"ButtonGridPopover__button-grid-popover__udJ1S",buttonGridPopover:"ButtonGridPopover__button-grid-popover__udJ1S",fullscreen:"ButtonGridPopover__fullscreen__kypKC"};function oN(e){let{fullscreen:t,items:n,closePopover:i}=e;return Yy.createElement("div",{className:lw()(rN.buttonGridPopover,{[rN.fullscreen]:t})},n.map((e=>{const t=e.icon;return Yy.createElement(UP,{key:e.id,icon:Yy.createElement(t,null),preset:e.color,onClick:()=>{e.onSelect&&e.onSelect(e),i()},label:e.label,selected:e.selected})})))}function sN(){return sN=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},sN.apply(this,arguments)}oN.propTypes={fullscreen:sw().bool,items:sw().arrayOf(sw().shape({id:sw().string.isRequired,icon:sw().elementType.isRequired,color:sw().string,label:sw().element.isRequired,onSelect:sw().func})).isRequired,closePopover:sw().func.isRequired};const aN=(0,gE.Em)({id:"place-popover.title",defaultMessage:"Place"});function lN(e){let{items:t}=e;const n=(0,FE.Z)(),i=t.filter((e=>!!e));if(0===i.length)return null;const r=n.formatMessage(aN);return Yy.createElement(GP,{title:r,content:e=>Yy.createElement(oN,sN({items:i},e)),placement:"top",offsetDistance:28},(e=>{let{togglePopover:t,popoverVisible:n,triggerRef:i}=e;return Yy.createElement(UP,{ref:i,icon:Yy.createElement(NL,null),selected:n,onClick:t,label:r,preset:"accent3"})}))}function cN(e){let{scene:t,mediaSearchStore:n,showNonHistoriedDialog:i,hubChannel:r}=e;const[o,s]=(0,Yy.useState)([]);return(0,Yy.useEffect)((()=>{function e(){const e=!!qo(APP.world,qn),o=!!t.systems["pen-tools"].getMyPen();let a=[r.can("spawn_drawing")&&{id:"pen",icon:UA,color:"accent5",label:Yy.createElement(uw.Z,{id:"place-popover.item-type.pen",defaultMessage:"Pen"}),onSelect:()=>t.emit("penButtonPressed"),selected:o},r.can("spawn_camera")&&{id:"camera",icon:cD,color:"accent5",label:Yy.createElement(uw.Z,{id:"place-popover.item-type.camera",defaultMessage:"Camera"}),onSelect:()=>t.emit("action_toggle_camera"),selected:e}];r.can("spawn_and_move_media")&&(a=[...a,k.integration("tenor")&&{id:"gif",icon:QI,color:"accent2",label:Yy.createElement(uw.Z,{id:"place-popover.item-type.gif",defaultMessage:"GIF"}),onSelect:()=>n.sourceNavigate("gifs")},k.integration("sketchfab")&&{id:"model",icon:NL,color:"accent2",label:Yy.createElement(uw.Z,{id:"place-popover.item-type.model",defaultMessage:"3D Model"}),onSelect:()=>n.sourceNavigate("sketchfab")},{id:"avatar",icon:pD,color:"accent1",label:Yy.createElement(uw.Z,{id:"place-popover.item-type.avatar",defaultMessage:"Avatar"}),onSelect:()=>n.sourceNavigate("avatars")},{id:"scene",icon:iN,color:"accent1",label:Yy.createElement(uw.Z,{id:"place-popover.item-type.scene",defaultMessage:"Scene"}),onSelect:()=>n.sourceNavigate("scenes")},{id:"upload",icon:EA,color:"accent3",label:Yy.createElement(uw.Z,{id:"place-popover.item-type.upload",defaultMessage:"Upload"}),onSelect:()=>i(GE,{scene:t})}]),s(a)}function o(t){"camera"!==t.detail&&"pen"!==t.detail||e()}return r.addEventListener("permissions_updated",e),e(),t.addEventListener("stateadded",o),t.addEventListener("stateremoved",o),()=>{r.removeEventListener("permissions_updated",e),t.removeEventListener("stateadded",o),t.removeEventListener("stateremoved",o)}}),[r,n,i,t]),Yy.createElement(lN,{items:o})}var dN,uN,hN,pN;function mN(){return mN=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},mN.apply(this,arguments)}lN.propTypes={items:sw().array.isRequired},cN.propTypes={hubChannel:sw().object.isRequired,scene:sw().object.isRequired,mediaSearchStore:sw().object.isRequired,showNonHistoriedDialog:sw().func.isRequired};const fN=e=>{let{title:t,titleId:n,...i}=e;return Yy.createElement("svg",mN({width:20,height:20,viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":n},i),t?Yy.createElement("title",{id:n},t):null,dN||(dN=Yy.createElement("path",{d:"M17.545 4H2.555C1.863 4 1.3 4.562 1.3 5.255v8.114c0 .694.562 1.256 1.256 1.256h14.989c.693 0 1.255-.562 1.255-1.255V5.255C18.8 4.562 18.238 4 17.545 4Z",stroke:"currentColor",strokeWidth:1.5,strokeLinejoin:"round"})),uN||(uN=Yy.createElement("path",{d:"M5.05 16.502h10",stroke:"currentColor",strokeWidth:1.5,strokeMiterlimit:10,strokeLinecap:"round"})),hN||(hN=Yy.createElement("path",{d:"M12.697 9.325 10.123 6.75 7.55 9.325",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})),pN||(pN=Yy.createElement("path",{d:"M10.123 11.415V6.752",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})))};function gN(){return gN=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},gN.apply(this,arguments)}const vN=(0,gE.Em)({id:"share-popover.title",defaultMessage:"Share"});function bN(e){let{items:t}=e;const n=(0,FE.Z)().formatMessage(vN),i=t.filter((e=>!!e));if(0===i.length)return null;const r=i.find((e=>e.active));if(1===i.length||r){const e=i[0],t=e.icon;return Yy.createElement(UP,{icon:Yy.createElement(t,null),onClick:()=>{e.onSelect&&e.onSelect(e)},label:n,preset:"accent5",statusColor:r&&"recording"})}return Yy.createElement(GP,{title:n,content:e=>Yy.createElement(oN,gN({items:i},e)),placement:"top",offsetDistance:28,disableFullscreen:!0},(e=>{let{togglePopover:t,popoverVisible:i,triggerRef:r}=e;return Yy.createElement(UP,{ref:r,icon:Yy.createElement(fN,null),selected:i,onClick:t,label:n,preset:"accent5"})}))}function yN(e){let{scene:t,hubChannel:n}=e;const{sharingSource:i,canShareCamera:r,toggleShareCamera:o,canShareScreen:s,toggleShareScreen:a,canShareCameraToAvatar:l,toggleShareCameraToAvatar:c}=function(e,t){const n=APP.mediaDevicesManager,[i,r]=(0,Yy.useState)(null),[o,s]=(0,Yy.useState)(!1),[a,l]=(0,Yy.useState)(!1),[c,d]=(0,Yy.useState)(!1),{hasVideoTextureTarget:u}=function(){const[e,t]=(0,Yy.useState)({hasVideoTextureTarget:!1});return(0,Yy.useEffect)((()=>{const e=document.querySelector("#avatar-rig .model");function n(){const n=!!e.querySelector("[video-texture-target]");t({hasVideoTextureTarget:n})}return n(),e.addEventListener("model-loaded",n),()=>{e.removeEventListener("model-loaded",n)}}),[]),e}();(0,Yy.useEffect)((()=>{function i(e){r(e.detail.source)}function o(){r(null)}function a(){t.can("spawn_and_move_media")?(navigator.mediaDevices.enumerateDevices().then((e=>{const t=e.some((e=>"videoinput"===e.kind));s(t),d(t&&u)})).catch((()=>{s(!1),d(!1)})),l(!!navigator.mediaDevices.getDisplayMedia)):(l(!1),s(!1),d(!1))}return e.addEventListener("share_video_enabled",i),e.addEventListener("share_video_disabled",o),e.addEventListener("share_video_failed",o),t.addEventListener("permissions_updated",a),a(),r(n.isVideoShared?n.isWebcamShared?Be.CAMERA:Be.SCREEN:null),()=>{e.removeEventListener("share_video_enabled",i),e.removeEventListener("share_video_disabled",o),e.removeEventListener("share_video_failed",o),t.removeEventListener("permissions_updated",a)}}),[e,t,u,n]);const h=(0,Yy.useCallback)((()=>{i?e.emit(Ne.VIDEO_SHARE_ENDED):e.emit("action_share_camera")}),[e,i]),p=(0,Yy.useCallback)((()=>{i?e.emit(Ne.VIDEO_SHARE_ENDED):e.emit("action_share_screen")}),[e,i]),m=(0,Yy.useCallback)((()=>{i?e.emit(Ne.VIDEO_SHARE_ENDED):e.emit("action_share_camera",{target:"avatar"})}),[e,i]);return{sharingSource:i,canShareCamera:o,canShareCameraToAvatar:c,canShareScreen:a,toggleShareCamera:h,toggleShareCameraToAvatar:m,toggleShareScreen:p}}(t,n),d=[r&&{id:"camera",icon:GL,color:"accent5",label:Yy.createElement(uw.Z,{id:"share-popover.source.camera",defaultMessage:"Camera"}),onSelect:o,active:i===Be.CAMERA},s&&{id:"screen",icon:mj,color:"accent5",label:Yy.createElement(uw.Z,{id:"share-popover.source.screen",defaultMessage:"Screen"}),onSelect:a,active:i===Be.SCREEN},l&&{id:"camera-to-avatar",icon:pD,color:"accent5",label:Yy.createElement(uw.Z,{id:"share-popover.source.avatar-camera",defaultMessage:"Avatar Camera"}),onSelect:c,active:"camera-to-avatar"===i}];return Yy.createElement(bN,{items:d})}bN.propTypes={items:sw().array.isRequired},yN.propTypes={hubChannel:sw().object.isRequired,scene:sw().object.isRequired};var wN="AudioPopover__selection-input__jyQyN",_N="AudioPopover__icon-disabled__dqi0K",EN="AudioPopover__level-bar__WlJAN",AN={"flex-row":"Row__flex-row__kHRrv",flexRow:"Row__flex-row__kHRrv","space-between":"Row__space-between__vh9wm",spaceBetween:"Row__space-between__vh9wm","sm-breakpoint-column":"Row__sm-breakpoint-column__ErhgV",smBreakpointColumn:"Row__sm-breakpoint-column__ErhgV","md-breakpoint-column":"Row__md-breakpoint-column__Tr6kD",mdBreakpointColumn:"Row__md-breakpoint-column__Tr6kD","no-flex-wrap":"Row__no-flex-wrap__kfuaV",noFlexWrap:"Row__no-flex-wrap__kfuaV","2xs-children-margin-r":"Row__2xs-children-margin-r__f7nyn","2XsChildrenMarginR":"Row__2xs-children-margin-r__f7nyn","xs-children-margin-r":"Row__xs-children-margin-r__Sy1dQ",xsChildrenMarginR:"Row__xs-children-margin-r__Sy1dQ","sm-children-margin-r":"Row__sm-children-margin-r__aUOJn",smChildrenMarginR:"Row__sm-children-margin-r__aUOJn","md-children-margin-r":"Row__md-children-margin-r__QLh3b",mdChildrenMarginR:"Row__md-children-margin-r__QLh3b","lg-children-margin-r":"Row__lg-children-margin-r__vJ1JM",lgChildrenMarginR:"Row__lg-children-margin-r__vJ1JM","xl-children-margin-r":"Row__xl-children-margin-r__EW_z3",xlChildrenMarginR:"Row__xl-children-margin-r__EW_z3"};const SN=e=>{let{children:t,padding:n,gap:i,spaceBetween:r,breakpointColumn:o,topMargin:s,flexClassName:a,flexBasis:l,noWrap:c=!1,childrenMarginR:d,className:u}=e;const h=!0===n?Aw.lgPadding:Aw[`${n}Padding`],p=!0===i?Aw.mdGap:Aw[`${i}Gap`],m=!0===o?"":AN[`${o}BreakpointColumn`],f=s?Aw[`${s}WrapMargin`]:"",g=l?Aw[`flexBasis${l}`]:"",v=d?AN[`${d}ChildrenMarginR`]:"";return Yy.createElement("div",{className:lw()(h,p,u)},Yy.createElement("div",{className:lw()(AN.flexRow,m,f,v,{[AN.spaceBetween]:r,[AN.noFlexWrap]:c},a,g)},t))};SN.propTypes={children:sw().node,padding:sw().oneOfType([sw().string,sw().bool]),gap:sw().oneOfType([sw().string,sw().bool]),topMargin:sw().oneOfType([sw().string,sw().bool]),breakpointColumn:sw().oneOfType([sw().string,sw().bool]),childrenMarginR:sw().string,spaceBetween:sw().bool,className:sw().string,flexClassName:sw().string,flexBasis:sw().oneOf([10,20,30,40,50,60,70,80,90]),noWrap:sw().bool};const xN=e=>{let{margin:t=!1}=e;const n=!1===t?"":Aw[`${t}MarginY`];return Yy.createElement("div",{className:lw()("Divider__divider___idW6",n)})};function MN(){return MN=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},MN.apply(this,arguments)}xN.propTypes={margin:sw().oneOf(["xs","sm","md","lg","xl"])};const PN=e=>{let{micLevelBar:t,speakerLevelBar:n,microphoneOptions:i,onChangeMicrophone:r,isMicrophoneEnabled:o,isMicrophoneMuted:s,onChangeMicrophoneMuted:a,speakerOptions:l,onChangeSpeaker:c,onPlaySound:d,isAudioInputSelectAvailable:u,isAudioOutputSelectAvailable:h,canVoiceChat:p,permissionStatus:m}=e;const f=o?"AudioPopover__icon-enabled__LKt6O":_N;return Yy.createElement(O_,{padding:!0,grow:!0,gap:"lg",className:"AudioPopover__audio-toolbar-popover__tZfFp"},p&&Yy.createElement(Yy.Fragment,null,Yy.createElement("p",{style:{alignSelf:"start"}},Yy.createElement(uw.Z,{id:"mic-setup-modal.microphone-text",defaultMessage:"Microphone"})),u&&Yy.createElement(FS,MN({className:wN,buttonClassName:wN,onChange:r},i)),Yy.createElement(SN,{noWrap:!0},o&&!s?Yy.createElement(EM,{className:f,style:{marginRight:"12px"}}):Yy.createElement(fM,{className:f,style:{marginRight:"12px"}}),Yy.createElement(Yy.Fragment,null," ",t)),Yy.createElement(SN,{nowrap:!0},Yy.createElement(_T,{label:Yy.createElement(uw.Z,{id:"mic-setup-modal.mute-mic-toggle-v2",defaultMessage:"Mute"}),checked:s,onChange:a})))||Yy.createElement("div",{className:"AudioPopover__voice-chat-disabled__eO0ZT"},Yy.createElement(fM,{className:_N}),Yy.createElement("p",{className:"AudioPopover__text-disabled__xwvIy"},Yy.createElement(uw.Z,{id:"mic-setup-modal.voice-chat-disabled",defaultMessage:"Voice chat is <bold>turned off</bold> for this room.",values:{bold:e=>Yy.createElement("b",null,e)}}))),Yy.createElement(xN,null),Yy.createElement("p",{style:{alignSelf:"start"}},Yy.createElement(uw.Z,{id:"mic-setup-modal.speakers-text",defaultMessage:"Speakers"})),m===Fe.GRANTED&&h&&Yy.createElement(FS,MN({className:wN,buttonClassName:wN,onChange:c},l)),Yy.createElement(SN,{noWrap:!0},Yy.createElement(uT,{className:f,style:{marginRight:"12px"}}),Yy.createElement(Yy.Fragment,null," ",n," ")),Yy.createElement(t_,{preset:"basic",onClick:d,sm:!0},Yy.createElement(uw.Z,{id:"mic-setup-modal.test-audio-button",defaultMessage:"Test Audio"})))};PN.propTypes={micLevelBar:sw().node,speakerLevelBar:sw().node,isSoundPlaying:sw().bool,onPlaySound:sw().func,isMicrophoneEnabled:sw().bool,isMicrophoneMuted:sw().bool,onChangeMicrophoneMuted:sw().func,microphoneOptions:sw().object,onChangeMicrophone:sw().func,speakerOptions:sw().object,onChangeSpeaker:sw().func,isAudioInputSelectAvailable:sw().bool,isAudioOutputSelectAvailable:sw().bool,canVoiceChat:sw().bool,permissionStatus:sw().string},PN.defaultProps={permissionStatus:Fe.PROMPT};const CN=e=>{let{scene:t}=e;const{isMicMuted:n,toggleMute:i,isMicEnabled:r,permissionStatus:o}=MT(t),{micDeviceChanged:s,micDevices:a}=PT(t),l=NT("voice_chat"),{speakerDeviceChanged:c,speakerDevices:d}=kT(),{playSound:u}=CT({scene:t,sound:Dm});return Yy.createElement(PN,{micLevelBar:Yy.createElement(IT,{scene:t,type:"mic",className:EN}),speakerLevelBar:Yy.createElement(IT,{scene:t,type:"mixer",className:EN}),microphoneOptions:a,onChangeMicrophone:s,isMicrophoneEnabled:r,isMicrophoneMuted:n,onChangeMicrophoneMuted:i,speakerOptions:d,onChangeSpeaker:c,onPlaySound:u,isAudioInputSelectAvailable:Gx.isAudioInputSelectEnabled,isAudioOutputSelectAvailable:Gx.isAudioOutputSelectEnabled,canVoiceChat:l,permissionStatus:o})};var kN;function ON(){return ON=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},ON.apply(this,arguments)}CN.propTypes={scene:sw().object.isRequired};const TN=e=>{let{title:t,titleId:n,...i}=e;return Yy.createElement("svg",ON({width:16,height:10,viewBox:"0 0 16 10",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":n},i),t?Yy.createElement("title",{id:n},t):null,kN||(kN=Yy.createElement("path",{d:"M1.25 8.375 8 1.625l6.75 6.75",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})))},RN=(0,gE.Em)({id:"audio-toolbar-popover.title",defaultMessage:"Audio Settings"}),DN=e=>{let{initiallyVisible:t,content:n,micButton:i,disabled:r}=e;const o=(0,FE.Z)().formatMessage(RN),s=(0,Yy.useRef)();return Yy.createElement(GP,{title:o,content:n,placement:"top-start",offsetDistance:28,initiallyVisible:t,popoverApiRef:s},(e=>{let{togglePopover:t,popoverVisible:n,triggerRef:s}=e;return Yy.createElement("div",{className:"AudioPopover__buttons-container__PFwbt"},Yy.createElement(UP,{ref:s,icon:Yy.createElement(TN,null),preset:"basic",selected:n,onClick:t,type:"left",className:n?"AudioPopover__arrow-button__rlPlJ":"AudioPopover__arrow-button-selected__vHFuE",title:o,disabled:r}),i)}))};DN.propTypes={initiallyVisible:sw().bool,content:sw().element,micButton:sw().element,disabled:sw().bool};const jN=["scene","disabled"];function LN(){return LN=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},LN.apply(this,arguments)}const IN=(0,gE.vU)({label:{id:"voice-button-container.label",defaultMessage:"Voice"},title:{id:"voice-button-container.title",defaultMessage:"Voice Chat Off"}});function NN(e){let{scene:t,disabled:n}=e,i=function(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}(e,jN);const r=(0,Yy.useRef)(),o=(0,Yy.useCallback)((e=>{const t=r.current;t&&(e<=.1?t.setAttribute("height",0):e<.3?(t.setAttribute("y",8),t.setAttribute("height",4)):(t.setAttribute("y",4),t.setAttribute("height",8)))}),[]);LT({analyser:t.systems["hubs-systems"].audioSystem.outboundAnalyser,update:!n&&o});const s=(0,FE.Z)();return Yy.createElement(UP,LN({ref:e=>{e&&(r.current=e.querySelector("rect"))},label:s.formatMessage(IN.label),preset:"basic",type:"right",title:n?s.formatMessage(IN.title):void 0,disabled:n},i))}NN.propTypes={scene:sw().object.isRequired,disabled:sw().bool};const FN=e=>{let{scene:t,initiallyVisible:n,content:i}=e;const{isMicMuted:r,toggleMute:o,permissionStatus:s}=MT(t),a=s===Fe.DENIED,l=NT("voice_chat");return Yy.createElement(DN,{initiallyVisible:n,content:i,micButton:Yy.createElement(NN,{scene:t,icon:r||!l||a?Yy.createElement(fM,null):Yy.createElement(EM,null),label:Yy.createElement(uw.Z,{id:"voice-button-container.label",defaultMessage:"Voice"}),preset:"basic",onClick:o,statusColor:!a&&l?r?"disabled":"enabled":void 0,type:"right",disabled:!l||a}),onChangeMicrophoneMuted:o})};FN.propTypes={scene:sw().object.isRequired,initiallyVisible:sw().bool,content:sw().element};const BN=e=>{let{scene:t}=e;return Yy.createElement(FN,{scene:t,content:Yy.createElement(CN,{scene:t})})};BN.propTypes={scene:sw().object.isRequired};var VN={"image-grid-popover":"ImageGridPopover__image-grid-popover__vLSbg",imageGridPopover:"ImageGridPopover__image-grid-popover__vLSbg",fullscreen:"ImageGridPopover__fullscreen__XUMU4"};function UN(e){let{fullscreen:t,items:n,closePopover:i}=e;return Yy.createElement("div",{className:lw()(VN.imageGridPopover,{[VN.fullscreen]:t})},n.map((e=>Yy.createElement("img",{key:e.id,crossOrigin:"anonymous",src:e.src,alt:e.label,onClick:()=>{e.onSelect&&e.onSelect(e),i()}}))))}UN.propTypes={fullscreen:sw().bool,items:sw().arrayOf(sw().shape({id:sw().string.isRequired,src:sw().string.isRequired,label:sw().string.isRequired,onSelect:sw().func})).isRequired,closePopover:sw().func.isRequired};var HN={"reaction-button":"ReactionButton__reaction-button__vpr7k",reactionButton:"ReactionButton__reaction-button__vpr7k",active:"ReactionButton__active__EANmD"};const zN=["active","children"],WN=["active"];function qN(){return qN=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},qN.apply(this,arguments)}function ZN(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function GN(e){let{active:t,children:n}=e,i=ZN(e,zN);return Yy.createElement("button",qN({className:lw()(HN.reactionButton,{[HN.active]:t})},i),n)}function YN(e){let{active:t}=e,n=ZN(e,WN);return Yy.createElement(GN,qN({active:t},n),Yy.createElement(Ij,{width:"42px",height:"42px"}),Yy.createElement("p",null,t?Yy.createElement(uw.Z,{id:"reaction-popover.lower-hand",defaultMessage:"Lower Hand"}):Yy.createElement(uw.Z,{id:"reaction-popover.raise-hand",defaultMessage:"Raise Hand"})))}GN.propTypes={children:sw().node,active:sw().bool},YN.propTypes={active:sw().bool};var QN={label:"ReactionPopover__label__DVF6P",popover:"ReactionPopover__popover__Bu0zs"};const XN=["items","presence","onToggleHandRaised"];function KN(){return KN=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},KN.apply(this,arguments)}const $N=(0,gE.Em)({id:"reaction-popover.title",defaultMessage:"React"});function JN(e){let{items:t,presence:n,onToggleHandRaised:i}=e,r=function(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}(e,XN);return Yy.createElement(O_,{padding:"sm",grow:!0,gap:"sm"},Yy.createElement(SN,{noWrap:!0},Yy.createElement(UN,KN({items:t},r))),Yy.createElement(SN,null,Yy.createElement("label",{className:QN.label},Yy.createElement(uw.Z,{id:"reaction-popover.action",defaultMessage:"Actions"}))),Yy.createElement(SN,{nowrap:!0},Yy.createElement(YN,{active:n.hand_raised,onClick:i})))}function eF(e){let{onToggleHandRaised:t}=e;return Yy.createElement(SN,{nowrap:!0,className:QN.popover},Yy.createElement(O_,{padding:"xs",grow:!0,gap:"xs"},Yy.createElement(uw.Z,{id:"reaction-popover.hand-raised-warning",defaultMessage:"Your hand is raised"})),Yy.createElement(O_,{padding:"xs",grow:!0,gap:"xs"},Yy.createElement(t_,{sm:!0,thin:!0,preset:"primary",onClick:t},Yy.createElement(uw.Z,{id:"reaction-popover.lower-hand",defaultMessage:"Lower Hand"}))))}function tF(e){let{items:t,presence:n,onToggleHandRaised:i}=e;const[r,o]=(0,Yy.useState)(!1),[s,a]=(0,Yy.useState)(!1),l=(0,FE.Z)().formatMessage($N),c=(0,Yy.useRef)(),d=(0,Yy.useCallback)((()=>{a(!1),i()}),[i]);return Yy.createElement(GP,{title:l,content:e=>s?Yy.createElement(eF,{onToggleHandRaised:d}):Yy.createElement(JN,KN({items:t,presence:n,onToggleHandRaised:i},e)),placement:"top",offsetDistance:28,popoverApiRef:c,showHeader:!s,isVisible:r||s,onChangeVisible:e=>{e||(o(!1),a(n.hand_raised))},disableFullscreen:s},(e=>{let{togglePopover:t,popoverVisible:i,triggerRef:c}=e;return Yy.createElement(UP,{ref:c,icon:n.hand_raised?Yy.createElement(Ij,{width:"32px",height:"32px",style:{marginLeft:"5px"}}):Yy.createElement(DP,null),selected:i,onClick:()=>{o(!r),n.hand_raised?a(!s):(a(!1),t())},label:l,preset:"accent2"})}))}function nF(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function iF(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}JN.propTypes={items:sw().array.isRequired,presence:sw().object,onToggleHandRaised:sw().func},eF.propTypes={onToggleHandRaised:sw().func},tF.propTypes={items:sw().array.isRequired,presence:sw().object,onToggleHandRaised:sw().func};const rF=(0,gE.vU)({smile:{id:"reaction-popover.emoji-label.smile",defaultMessage:"Smile"},laugh:{id:"reaction-popover.emoji-label.laugh",defaultMessage:"Laugh"},clap:{id:"reaction-popover.emoji-label.clap",defaultMessage:"Clap"},heart:{id:"reaction-popover.emoji-label.heart",defaultMessage:"Heart"},wave:{id:"reaction-popover.emoji-label.wave",defaultMessage:"Wave"},angry:{id:"reaction-popover.emoji-label.angry",defaultMessage:"Angry"},cry:{id:"reaction-popover.emoji-label.cry",defaultMessage:"Cry"}});function oF(e){let{scene:t,initialPresence:n}=e;const i=(0,FE.Z)(),r=function(e,t){const[n,i]=(0,Yy.useState)(t),r=e=>{let{detail:t}=e;t.sessionId===NAF.clientId&&i(t)};return(0,Yy.useEffect)((()=>(e.addEventListener("presence_updated",r),()=>e.removeEventListener("presence_updated",r))),[e]),n}(t,n),o=tg.map((e=>function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?nF(Object(n),!0).forEach((function(t){iF(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):nF(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({src:e.particleEmitterConfig.src,onSelect:ng,label:i.formatMessage(rF[e.id])},e))),s=(0,Yy.useCallback)((()=>{r.hand_raised?window.APP.hubChannel.lowerHand():window.APP.hubChannel.raiseHand()}),[r]);return Yy.createElement(tF,{items:o,presence:r,onToggleHandRaised:s})}function sF(){return Yy.createElement(N_,{title:Yy.createElement(uw.Z,{id:"safari-mic-modal.title",defaultMessage:"Microphone Access Required"})},Yy.createElement(O_,{center:!0,padding:!0},Yy.createElement(uw.Z,{id:"safari-mic-modal.message",defaultMessage:"<p>Hubs requires microphone permissions in Safari.</p><p>Please reload and allow microphone access to continue.</p>",values:{p:e=>Yy.createElement("p",null,e)}}),Yy.createElement(t_,{preset:"accept",onClick:()=>location.reload()},Yy.createElement(uw.Z,{id:"safari-mic-modal.reload-button",defaultMessage:"Reload"}))))}function aF(e){let{onClose:t,step:n,onSubmitEmail:i,message:r,onContinue:o}=e;const[s,a]=(0,Yy.useState)();return Yy.createElement(KS,{onClose:t,closeable:!0},n===zS&&Yy.createElement(YS,{onSubmitEmail:e=>{a(e),i(e)},initialEmail:s,termsUrl:k.link("terms_of_use",We),showTerms:k.feature("show_terms"),privacyUrl:k.link("privacy_notice",ze),showPrivacy:k.feature("show_privacy"),message:r}),n===WS&&Yy.createElement(QS,{onCancel:t,email:s,showNewsletterSignup:k.feature("show_newsletter_signup")}),n===qS&&Yy.createElement(XS,{message:r,onContinue:o}))}oF.propTypes={scene:sw().object,initialPresence:sw().object},aF.propTypes={onClose:sw().func,onSubmitEmail:sw().func,step:sw().string,message:sw().object,onContinue:sw().func};const lF="leaveRoom",cF="joinRoom",dF="createRoom",uF=(0,gE.vU)({[lF]:{id:"leave-room-modal.leave-room.message",defaultMessage:"Are you sure you want to leave the room?"},[cF]:{id:"leave-room-modal.join-room.message",defaultMessage:"Joining a new room will leave this one. Are you sure?"},[dF]:{id:"leave-room-modal.create-room.message",defaultMessage:"Creating a new room will leave this one. Are you sure?"}}),hF=(0,gE.vU)({[lF]:{id:"leave-room-modal.leave-room.confirm",defaultMessage:"Leave Room"},[cF]:{id:"leave-room-modal.join-room.confirm",defaultMessage:"Join Room"},[dF]:{id:"leave-room-modal.create-room.confirm",defaultMessage:"Leave and Create Room"}});function pF(e){let{reason:t,destinationUrl:n,onClose:i}=e;const r=(0,FE.Z)();return Yy.createElement(N_,{title:Yy.createElement(uw.Z,{id:"leave-room-modal.title",defaultMessage:"Leave Room"}),beforeTitle:Yy.createElement(Ww,{onClick:i})},Yy.createElement(O_,{padding:!0,center:!0,centerMd:"both",grow:!0},Yy.createElement("p",null,r.formatMessage(uF[t])),Yy.createElement(t_,{as:"a",preset:"cancel",href:n,rel:"noopener noreferrer"},r.formatMessage(hF[t]))))}pF.propTypes={reason:sw().string,destinationUrl:sw().string,onClose:sw().func};var mF={"section-title":"RoomSidebar__section-title__UFzx_",sectionTitle:"RoomSidebar__section-title__UFzx_","scene-screenshot-container":"RoomSidebar__scene-screenshot-container__wKUn4",sceneScreenshotContainer:"RoomSidebar__scene-screenshot-container__wKUn4","scene-screenshot-image":"RoomSidebar__scene-screenshot-image__BRWhJ",sceneScreenshotImage:"RoomSidebar__scene-screenshot-image__BRWhJ","scene-info":"RoomSidebar__scene-info__S3PYs",sceneInfo:"RoomSidebar__scene-info__S3PYs","scene-name":"RoomSidebar__scene-name__cvlSk",sceneName:"RoomSidebar__scene-name__cvlSk","scene-creator":"RoomSidebar__scene-creator__xT9wM",sceneCreator:"RoomSidebar__scene-creator__xT9wM",attribution:"RoomSidebar__attribution__2GZFa","attribution-name":"RoomSidebar__attribution-name__cdndd",attributionName:"RoomSidebar__attribution-name__cdndd","attribution-author":"RoomSidebar__attribution-author__tlmWS",attributionAuthor:"RoomSidebar__attribution-author__tlmWS"};function fF(e){let{attribution:t}=e;const n=(0,FE.Z)().formatMessage({id:"room-sidebar.unknown",defaultMessage:"unknown"}),i=t.name||t.title||n,r=t.author||n;if(t.url){const e=t.url.includes("sketchfab.com")?"Sketchfab":null;return Yy.createElement("li",{className:mF.attribution},Yy.createElement("div",{className:mF.attributionName},Yy.createElement("a",{href:t.url,target:"_blank",rel:"noopener noreferrer"},i)),Yy.createElement("div",{className:mF.attributionAuthor},e?Yy.createElement(uw.Z,{id:"room-sidebar.scene-attribution-with-source",defaultMessage:"by {author} on {source}",values:{author:r,source:e}}):Yy.createElement(uw.Z,{id:"room-sidebar.scene-attribution",defaultMessage:"by {author}",values:{author:r}})))}return t.author?Yy.createElement("li",{className:mF.attribution},Yy.createElement("div",{className:mF.attributionName},i),Yy.createElement("div",{className:mF.attributionAuthor},Yy.createElement(uw.Z,{id:"room-sidebar.scene-attribution",defaultMessage:"by {author}",values:{author:r}}))):null}function gF(e){let{accountId:t,scene:n,showAttributions:i,canChangeScene:r,onChangeScene:o}=e;const s=r&&Yy.createElement(t_,{preset:"primary",onClick:o},Yy.createElement(uw.Z,{id:"room-sidebar.scene-info.change-scene-button",defaultMessage:"Change Scene"}));if(!n)return s;const a=function(e,t){return t&&(e&&t.account_id===e||t.allow_promotion||t.allow_remixing)}(t,n),l=n.attributions&&n.attributions.content||[],c=n.attributions&&n.attributions.creator,d=l.filter((e=>e.url||e.author)).map(((e,t)=>Yy.createElement(fF,{attribution:e,key:t})));return Yy.createElement(Yy.Fragment,null,Yy.createElement("h2",{className:mF.sectionTitle},Yy.createElement(uw.Z,{id:"room-sidebar.scene-info.title",defaultMessage:"Scene"})),Yy.createElement("div",{className:mF.sceneScreenshotContainer},a?Yy.createElement("a",{href:n.url,target:"_blank",rel:"noopener noreferrer"},Yy.createElement("img",{className:mF.sceneScreenshotImage,src:n.screenshot_url})):Yy.createElement("img",{className:mF.sceneScreenshotImage,src:n.screenshot_url})),Yy.createElement("div",{className:mF.sceneInfo},a?Yy.createElement("b",{className:mF.sceneName},Yy.createElement("a",{href:n.url,target:"_blank",rel:"noopener noreferrer"},n.name)):Yy.createElement("b",{className:mF.sceneName},n.name),Yy.createElement("div",{className:mF.sceneCreator},Yy.createElement(uw.Z,{id:"room-sidebar.scene-info.scene-creator",defaultMessage:"by {creator}",values:{creator:c}}))),i&&d.length>0&&Yy.createElement(d_,{label:Yy.createElement(uw.Z,{id:"room-sidebar.scene-info.attributions",defaultMessage:"Attributions"})},Yy.createElement("ul",{className:mF.attributions},d)),s)}function vF(e){let{room:t,accountId:n,onClose:i,canEdit:r,onEdit:o,onChangeScene:s}=e;return Yy.createElement(Rw,{title:Yy.createElement(uw.Z,{id:"room-sidebar.title",defaultMessage:"Room"}),beforeTitle:Yy.createElement(Ww,{onClick:i}),afterTitle:r&&Yy.createElement(Iw,{onClick:o},Yy.createElement(uw.Z,{id:"room-sidebar.edit-button",defaultMessage:"Edit"}))},Yy.createElement(O_,{padding:!0},Yy.createElement(d_,{label:Yy.createElement(uw.Z,{id:"room-sidebar.room-name",defaultMessage:"Name"})},t.name),t.description&&Yy.createElement(d_,{label:Yy.createElement(uw.Z,{id:"room-sidebar.room-description",defaultMessage:"Description"})},t.description),Yy.createElement(gF,{accountId:n,scene:t.scene,showAttributions:!0,canChangeScene:r,onChangeScene:s})))}fF.propTypes={attribution:{name:sw().string,title:sw().string,author:sw().string,url:sw().string}},gF.propTypes={accountId:sw().string,showAttributions:sw().bool,canChangeScene:sw().bool,onChangeScene:sw().func,scene:{attributions:{content:sw().string,creator:sw().string},url:sw().string,screenshot_url:sw().string,name:sw().string}},vF.propTypes={accountId:sw().string,room:sw().object.isRequired,onClose:sw().func,canEdit:sw().bool,onEdit:sw().func,onChangeScene:sw().func};const bF=["className","error","description","inputClassName","label","fullWidth"];function yF(){return yF=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},yF.apply(this,arguments)}const wF=(0,Yy.memo)((0,Yy.forwardRef)(((e,t)=>{let{className:n,error:i,description:r,inputClassName:o,label:s,fullWidth:a}=e,l=function(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}(e,bF);const c=A_(),d=A_();return Yy.createElement(d_,{id:d,htmlFor:c,className:n,label:s,error:i,description:r,fullWidth:a},Yy.createElement(NP,yF({id:c,ref:t,className:o},l)))})));wF.propTypes={className:sw().string,label:sw().node,error:sw().node,description:sw().node,labelClassName:sw().string,inputClassName:sw().string,fullWidth:sw().bool};const _F=["className","afterInput"];function EF(){return EF=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},EF.apply(this,arguments)}const AF=(0,Yy.memo)((0,Yy.forwardRef)(((e,t)=>{let{className:n,afterInput:i}=e,r=function(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}(e,_F);return Yy.createElement(__,EF({inputMode:"numeric"},r,{type:"number",className:lw()("NumericInput__numeric-input__wvn7B",n),ref:t,afterInput:i}))})));AF.propTypes={afterInput:sw().node,className:sw().string};const SF=["className","error","description","inputClassName","label","fullWidth"];function xF(){return xF=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},xF.apply(this,arguments)}const MF=(0,Yy.memo)((0,Yy.forwardRef)(((e,t)=>{let{className:n,error:i,description:r,inputClassName:o,label:s,fullWidth:a}=e,l=function(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}(e,SF);const c=A_(),d=A_();return Yy.createElement(d_,{id:d,htmlFor:c,className:n,label:s,error:i,description:r,fullWidth:a},Yy.createElement(AF,xF({id:c,ref:t,className:o},l)))})));function PF(e){let{showBackButton:t,accountId:n,room:i,fetchingInvite:r,inviteUrl:o,onRevokeInvite:s,maxRoomSize:a,showPublicRoomSetting:l,onSubmit:c,onClose:d,canChangeScene:u,onChangeScene:h}=e;const p=(0,FE.Z)(),{handleSubmit:m,register:f,watch:g,errors:v,setValue:b}=(0,xE.cI)({defaultValues:i}),y=g("entry_mode"),w=g("member_permissions.spawn_and_move_media");return(0,Yy.useEffect)((()=>{w||(b("member_permissions.spawn_camera",!1,{shouldDirty:!0}),b("member_permissions.pin_objects",!1,{shouldDirty:!0}))}),[w,b]),Yy.createElement(Rw,{title:Yy.createElement(uw.Z,{id:"room-settings-sidebar.title",defaultMessage:"Room Settings"}),beforeTitle:t?Yy.createElement(Kw,{onClick:d}):Yy.createElement(Ww,{onClick:d})},Yy.createElement(O_,{padding:!0,as:"form",onSubmit:m(c)},Yy.createElement(gF,{accountId:n,scene:i.scene,canChangeScene:u,onChangeScene:h}),Yy.createElement(M_,{name:"name",type:"text",required:!0,autoComplete:"off",placeholder:p.formatMessage({id:"room-settings-sidebar.name-placeholder",defaultMessage:"Room name"}),minLength:1,maxLength:64,label:Yy.createElement(uw.Z,{id:"room-settings-sidebar.name",defaultMessage:"Room Name"}),ref:f,error:v.name,fullWidth:!0}),Yy.createElement(wF,{name:"description",autoComplete:"off",placeholder:p.formatMessage({id:"room-settings-sidebar.description-placeholder",defaultMessage:"Room Description"}),label:Yy.createElement(uw.Z,{id:"room-settings-sidebar.description",defaultMessage:"Room Description"}),minRows:3,ref:f,error:v.description,fullWidth:!0}),Yy.createElement(MF,{name:"room_size",required:!0,min:0,max:a,placeholder:p.formatMessage({id:"room-settings-sidebar.room-size-placeholder",defaultMessage:"Member Limit"}),label:Yy.createElement(uw.Z,{id:"room-settings-sidebar.room-size",defaultMessage:"Room Size"}),ref:f,error:v.room_size,fullWidth:!0}),Yy.createElement(AS,{label:Yy.createElement(uw.Z,{id:"room-settings-sidebar.room-access",defaultMessage:"Room Access"}),fullWidth:!0},Yy.createElement(SS,{name:"entry_mode",value:"allow",label:Yy.createElement(uw.Z,{id:"room-settings-sidebar.access-shared-link",defaultMessage:"Shared link"}),description:Yy.createElement(uw.Z,{id:"room-settings-sidebar.access-shared-link-description",defaultMessage:"Only those with the link can join"}),ref:f,error:v.entry_mode}),Yy.createElement(SS,{name:"entry_mode",value:"invite",label:Yy.createElement(uw.Z,{id:"room-settings-sidebar.access-invite",defaultMessage:"Invite only"}),description:Yy.createElement(uw.Z,{id:"room-settings-sidebar.access-invite-description",defaultMessage:"Invite people with a link that can be revoked"}),ref:f,error:v.entry_mode})),"invite"===y&&Yy.createElement(eR,{fetchingInvite:r,inviteUrl:o,onRevokeInvite:s}),l&&Yy.createElement(_T,{name:"allow_promotion",label:Yy.createElement(uw.Z,{id:"room-settings-sidebar.access-public",defaultMessage:"Public"}),description:Yy.createElement(uw.Z,{id:"room-settings-sidebar.access-public-description",defaultMessage:"Listed on the homepage"}),ref:f}),Yy.createElement(d_,{label:Yy.createElement(uw.Z,{id:"room-settings-sidebar.permissions",defaultMessage:"Room Member Permissions"}),fullWidth:!0},Yy.createElement("div",{className:JT.roomPermissions},Yy.createElement(_T,{name:"member_permissions.voice_chat",label:Yy.createElement(uw.Z,{id:"room-settings-sidebar.voice-chat",defaultMessage:"Voice chat"}),ref:f}),Yy.createElement(_T,{name:"member_permissions.text_chat",label:Yy.createElement(uw.Z,{id:"room-settings-sidebar.text-chat",defaultMessage:"Text chat"}),ref:f}),Yy.createElement(_T,{name:"member_permissions.spawn_and_move_media",label:Yy.createElement(uw.Z,{id:"room-settings-sidebar.spawn-and-move-media",defaultMessage:"Create and move objects"}),ref:f}),Yy.createElement("div",{className:JT.permissionsGroup},Yy.createElement(_T,{name:"member_permissions.spawn_camera",label:Yy.createElement(uw.Z,{id:"room-settings-sidebar.spawn-camera",defaultMessage:"Create cameras"}),ref:f,disabled:!w}),Yy.createElement(_T,{name:"member_permissions.pin_objects",label:Yy.createElement(uw.Z,{id:"room-settings-sidebar.pin-objects",defaultMessage:"Pin objects"}),ref:f,disabled:!w})),Yy.createElement(_T,{name:"member_permissions.spawn_drawing",label:Yy.createElement(uw.Z,{id:"room-settings-sidebar.spawn-drawing",defaultMessage:"Create drawings"}),ref:f}),Yy.createElement(_T,{name:"member_permissions.spawn_emoji",label:Yy.createElement(uw.Z,{id:"room-settings-sidebar.spawn-emoji",defaultMessage:"Create emoji"}),ref:f}),Yy.createElement(_T,{name:"member_permissions.fly",label:Yy.createElement(uw.Z,{id:"room-settings-sidebar.fly",defaultMessage:"Allow flying"}),ref:f}))),Yy.createElement(s_,{type:"submit"})))}MF.propTypes={className:sw().string,label:sw().node,error:sw().node,description:sw().node,labelClassName:sw().string,inputClassName:sw().string,fullWidth:sw().bool},PF.propTypes={accountId:sw().string,showBackButton:sw().bool,room:sw().object.isRequired,fetchingInvite:sw().bool,inviteUrl:sw().string,onRevokeInvite:sw().func,roomSize:sw().number,maxRoomSize:sw().number,showPublicRoomSetting:sw().bool,onSubmit:sw().func,onClose:sw().func,canChangeScene:sw().bool,onChangeScene:sw().func};const CF=["text_chat","voice_chat"];function kF(e){let{showBackButton:t,room:n,hubChannel:i,onChangeScene:r,onClose:o}=e;const s=k.feature("max_room_size"),{fetchingInvite:a,inviteUrl:l,revokeInvite:c}=lR(i),d=(0,Yy.useCallback)((e=>{i.updateHub(e),o(),CF.forEach((t=>{APP.hub.member_permissions[t]!==e.member_permissions[t]&&i.sendMessage({permission:t,status:e.member_permissions[t]},"permission")}))}),[i,o]);return Yy.createElement(PF,{showBackButton:t,room:n,fetchingInvite:a,inviteUrl:l,onRevokeInvite:c,maxRoomSize:s,showPublicRoomSetting:i.can("update_hub_promotion"),onSubmit:d,canChangeScene:!0,onChangeScene:r,onClose:o})}kF.propTypes={showBackButton:sw().bool,room:sw().object.isRequired,hubChannel:sw().object.isRequired,onClose:sw().func.isRequired,onChangeScene:sw().func};const OF="concurrentSession",TF="idle",RF=(0,gE.vU)({[OF]:{id:"auto-exit-warning-modal.reason.concurrent-session",defaultMessage:"You have started another session."},[TF]:{id:"auto-exit-warning-modal.reason.idle",defaultMessage:"You have been idle for too long."}});function DF(e){let{onCancel:t,reason:n,secondsRemaining:i}=e;const r=(0,FE.Z)();return Yy.createElement(N_,{title:"Warning"},Yy.createElement(O_,{padding:!0,center:!0},Yy.createElement("b",null,Yy.createElement(uw.Z,{id:"auto-exit-warning-modal.message",defaultMessage:"Auto-ending session in {secondsRemaining} seconds",values:{secondsRemaining:i}})),Yy.createElement("p",null,r.formatMessage(RF[n])),Yy.createElement(i_,{onClick:t})))}DF.propTypes={reason:sw().string.isRequired,secondsRemaining:sw().number.isRequired,onCancel:sw().func};const jF={exited:"exited",closed:"closed",denied:"denied",disconnected:"disconnected",left:"left",full:"full",sceneError:"sceneError",connectError:"connectError",versionMismatch:"versionMismatch"},LF=(0,gE.vU)({[jF.exited]:{id:"exited-room-screen.reason.exited",defaultMessage:"Your session has ended. Refresh your browser to start a new one."},[jF.closed]:{id:"exited-room-screen.reason.closed",defaultMessage:"This room is no longer available."},[jF.denied]:{id:"exited-room-screen.reason.denied",defaultMessage:"You are not permitted to join this room. Please request permission from the room creator."},[jF.disconnected]:{id:"exited-room-screen.reason.disconnected",defaultMessage:"You have disconnected from the room. Refresh the page to try to reconnect."},[jF.left]:{id:"exited-room-screen.reason.left",defaultMessage:"You have left the room."},[jF.full]:{id:"exited-room-screen.reason.full",defaultMessage:"This room is full, please try again later."},[jF.sceneError]:{id:"exited-room-screen.reason.scene-error",defaultMessage:"The scene failed to load."},[jF.connectError]:{id:"exited-room-screen.reason.connect-error",defaultMessage:"Unable to connect to this room, please try again later."},[jF.versionMismatch]:{id:"exited-room-screen.reason.version-mismatch",defaultMessage:"The version you deployed is not available yet. Your browser will refresh in 5 seconds."}});function IF(e){let{reason:t,showTerms:n,termsUrl:i,showSourceLink:r}=e;const o=(0,FE.Z)();let s=null;if(t===jF.closed){const e=o.formatMessage({id:"contact-email"});s=Yy.createElement(Yy.Fragment,null,Yy.createElement("b",null,Yy.createElement(uw.Z,{id:"exited-room-screen.no-longer-available",defaultMessage:"Sorry, this room is no longer available."})),n&&Yy.createElement("p",null,Yy.createElement(uw.Z,{id:"exited-room-screen.closed-room-tos",defaultMessage:"A room may be closed by the room owner, or if we receive reports that it violates our <toslink>Terms of Use</toslink>.",values:{toslink:e=>Yy.createElement("a",{target:"_blank",rel:"noreferrer noopener",href:i},e)}})),Yy.createElement("p",null,Yy.createElement(uw.Z,{id:"exited-room-screen.contact-us",defaultMessage:"If you have questions, contact us at {contactEmail}.",values:{contactEmail:Yy.createElement("a",{href:`mailto:${e}`},e)}})),r&&Yy.createElement("p",null,Yy.createElement(uw.Z,{id:"exited-room-screen.source-link",defaultMessage:"If you'd like to run your own server, Hubs's source code is available on <a>GitHub</a>.",values:{a:e=>Yy.createElement("a",{href:"https://github.com/mozilla/hubs"},e)}})),Yy.createElement(t_,{as:"a",preset:"accept",href:"/"},Yy.createElement(uw.Z,{id:"exited-room-screen.home-button",defaultMessage:"Back to Home"})))}else{const e=new URL(document.location.toString()),n=new URLSearchParams(e.search);n.set("force_tcp",!0),e.search=n.toString(),s=Yy.createElement(Yy.Fragment,null,Yy.createElement("b",null,o.formatMessage(LF[t])),t===jF.connectError&&Yy.createElement("p",null,Yy.createElement(uw.Z,{id:"exited-room-screen.connect-tcp",defaultMessage:"You can try <a>connecting via TCP</a>, which may work better on some networks.",values:{a:t=>Yy.createElement("a",{href:e.toString()},t)}})),![jF.left,jF.disconnected,jF.sceneError].includes(t)&&Yy.createElement("p",null,Yy.createElement(uw.Z,{id:"exited-room-screen.create-room",defaultMessage:"You can also <a>create a new room</a>.",values:{a:e=>Yy.createElement("a",{href:"/"},e)}})),Yy.createElement(t_,{as:"a",preset:"accept",href:window.location.href},Yy.createElement(uw.Z,{id:"exited-room-screen.refresh-page-button",defaultMessage:"Refresh Page"})))}return Yy.createElement(fO,{center:s})}IF.propTypes={reason:sw().string.isRequired,showTerms:sw().bool,termsUrl:sw().string,showSourceLink:sw().bool};function NF(e){let{roomName:t,onClose:n,onConfirm:i}=e;const[r,o]=(0,Yy.useState)(""),[s,a]=(0,Yy.useState)(!1),l=(0,Yy.useCallback)((()=>{r.toLowerCase()===t.toLowerCase()?i():a(!0)}),[i,r,t]);return Yy.createElement(N_,{title:Yy.createElement(uw.Z,{id:"close-room-modal.title",defaultMessage:"Close Room"}),beforeTitle:Yy.createElement(Ww,{onClick:n})},Yy.createElement(O_,{padding:!0,center:!0,centerMd:"both",grow:!0},Yy.createElement("p",null,Yy.createElement(uw.Z,{id:"close-room-modal.message",defaultMessage:"Closing this room will remove yourself and others from the room, shutting it down permanently.{linebreak}Are you sure? This action cannot be undone.",values:{linebreak:Yy.createElement("br",null)}})),Yy.createElement("p",null,Yy.createElement(uw.Z,{id:"close-room-modal.type-to-confirm",defaultMessage:"Type room name to confirm: {roomName}",values:{roomName:Yy.createElement("b",null,t)}})),Yy.createElement(M_,{label:Yy.createElement(uw.Z,{id:"close-room-modal.confirm-room-name-field",defaultMessage:"Confirm Room Name"}),onChange:e=>o(e.target.value),value:r,error:s&&Yy.createElement(uw.Z,{id:"close-room-modal.room-name-match-error",defaultMessage:"Room name does not match"})}),Yy.createElement("div",{className:"CloseRoomModal__button-group__NTDLq"},Yy.createElement(i_,{onClick:n}),Yy.createElement(t_,{preset:"accept",onClick:l},Yy.createElement(uw.Z,{id:"close-room-modal.confirm",defaultMessage:"Yes, Close Room"})))))}function FF(e){let{onClose:t}=e;return Yy.createElement(N_,{title:Yy.createElement(uw.Z,{id:"webvr-unsupported-modal.title",defaultMessage:"Enter in VR"}),beforeTitle:Yy.createElement(Ww,{onClick:t})},Yy.createElement(O_,{padding:!0,center:!0},Yy.createElement("p",null,Yy.createElement(uw.Z,{id:"webvr-unsupported-modal.message",defaultMessage:"WebVR isn't supported in this browser, to enter with Oculus or SteamVR, use Firefox."})),Yy.createElement(t_,{as:"a",preset:"accent2",href:"https://www.mozilla.org/firefox/",target:"_blank",rel:"noreferrer noopener"},Yy.createElement("span",null,Yy.createElement(uw.Z,{id:"webvr-unsupported-modal.download-firefox-button",defaultMessage:"Download Firefox"}))),Yy.createElement("p",null,Yy.createElement("small",null,Yy.createElement(uw.Z,{id:"webvr-unsupported-modal.webvr-rocks-link",defaultMessage:"For a list of browsers with experimental VR support, visit <a>WebVR Rocks</a>.",values:{a:e=>Yy.createElement("a",{href:"https://webvr.rocks",target:"_blank",rel:"noopener noreferrer"},e)}})))))}NF.propTypes={roomName:sw().string,onConfirm:sw().func,onClose:sw().func},FF.propTypes={onClose:sw().func};var BF=n(51825),VF=n(96685),UF=n(76953),HF=n(60483),zF=n(72586),WF=(n(65434),n(34106),n(4833),n(13952),{media:"TweetEditorModal__media__LKb3w",editor:"TweetEditorModal__editor__SVwvM","editor-inner":"TweetEditorModal__editor-inner__N0yZn",editorInner:"TweetEditorModal__editor-inner__N0yZn","emoji-button":"TweetEditorModal__emoji-button__sdm3x",emojiButton:"TweetEditorModal__emoji-button__sdm3x",counter:"TweetEditorModal__counter__KuZoI"});const qF=(0,BF.Z)(),ZF=(0,VF.Z)(),GF=(0,UF.Z)(),YF=(0,HF.Z)();function QF(e){let{editorState:t,editorRef:n,sending:i,mediaThumbnailUrl:r,contentSubtype:o,onClickEditor:s,onChange:a,onSend:l,onClose:c}=e;const{EmojiSuggestions:d,EmojiSelect:u}=qF,{CharCounter:h}=YF,p=t.getCurrentContent().getPlainText().length;return Yy.createElement(N_,{title:Yy.createElement(uw.Z,{id:"tweet-editor-modal.title",defaultMessage:"Tweet"}),beforeTitle:Yy.createElement(Ww,{onClick:c})},Yy.createElement(O_,{padding:!0,center:!0},Yy.createElement("div",{className:WF.media},o&&o.startsWith("video")?Yy.createElement("video",{src:r,width:450,height:255,controls:!0}):Yy.createElement("img",{src:r,width:450,height:255})),Yy.createElement("div",{className:WF.editor},Yy.createElement("div",{className:WF.editorInner,onClick:s},Yy.createElement(zF.ZP,{ref:n,editorState:t,onChange:a,plugins:[qF,ZF,GF,YF]})),Yy.createElement("div",{className:WF.emojiButton},Yy.createElement(u,null)),Yy.createElement("div",{className:WF.emojiSuggestions},Yy.createElement(d,null)),p>200&&Yy.createElement("div",{className:WF.counter},Yy.createElement(h,{editorState:t,limit:280})," / 280")),Yy.createElement(t_,{preset:"accent4",disabled:i||p>280,onClick:l},i?Yy.createElement(uw.Z,{id:"tweet-editor-modal.sending-tweet",defaultMessage:"Sending Tweet..."}):Yy.createElement(uw.Z,{id:"tweet-editor-modal.tweet-button",defaultMessage:"Tweet"}))))}QF.propTypes={editorRef:sw().any,editorState:sw().object.isRequired,onChange:sw().func,sending:sw().bool,mediaThumbnailUrl:sw().string,contentSubtype:sw().string,onClickEditor:sw().func,onSend:sw().func,onClose:sw().func};var XF=n(9041);function KF(e,t,n,i,r,o,s){try{var a=e[o](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(i,r)}function $F(e){return function(){var t=this,n=arguments;return new Promise((function(i,r){var o=e.apply(t,n);function s(e){KF(o,i,r,s,a,"next",e)}function a(e){KF(o,i,r,s,a,"throw",e)}s(void 0)}))}}const JF=(e,t)=>{const n=t.getCurrentContent(),i=n.createEntity("emoji","IMMUTABLE",{emojiUnicode:e}).getLastCreatedEntityKey(),r=t.getSelection();let o,s=0,a=0;const l=XF.Modifier.removeRange(n,r,"backward"),c=l.getSelectionAfter();o=XF.Modifier.insertText(l,c,e,null,i),s=c.getAnchorOffset();const d=c.getAnchorKey();a=n.getBlockForKey(d).getLength(),s===a&&(o=XF.Modifier.insertText(o,o.getSelectionAfter()," "));const u=XF.EditorState.push(t,o,"insert-emoji");return XF.EditorState.forceSelection(u,o.getSelectionAfter())};function eB(e){let{initialTweet:t,mediaUrl:n,contentSubtype:i,onClose:r}=e;const[o,s]=(0,Yy.useState)((()=>(0,zF.bf)(t||""))),a=(0,Yy.useRef)();(0,Yy.useEffect)((()=>{s((e=>JF("🐤",e)))}),[]);const[l,c]=(0,Yy.useState)(!1),d=(0,Yy.useCallback)($F((function*(){c(!0);try{const e=o.getCurrentContent().getPlainText();yield Se("/api/v1/twitter/tweets","POST",{media_stored_file_url:n,body:e})}catch(e){c(!1),console.error(e)}r()})),[n,o,r]);return Yy.createElement(QF,{editorState:o,editorRef:a,onClose:r,sending:l,onSend:d,onChange:s,mediaThumbnailUrl:n,contentSubtype:i})}function tB(e){let{appName:t,onConnect:n,onClose:i}=e;return Yy.createElement(N_,{title:Yy.createElement(uw.Z,{id:"twitter-oauth-modal.title",defaultMessage:"Connect to Twitter"}),beforeTitle:Yy.createElement(Ww,{onClick:i})},Yy.createElement(O_,{padding:!0,center:!0,centerMd:"both",grow:!0},Yy.createElement("p",null,Yy.createElement(uw.Z,{id:"twitter-oauth-modal.message",defaultMessage:"Connect to Twitter to send tweets from {appName}.",values:{appName:t}})),Yy.createElement(t_,{preset:"accent4",onClick:n},Yy.createElement(uw.Z,{id:"twitter-oauth-modal.connect-button",defaultMessage:"Connect to Twitter"}))))}function nB(e,t,n,i,r,o,s){try{var a=e[o](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(i,r)}function iB(e){return function(){var t=this,n=arguments;return new Promise((function(i,r){var o=e.apply(t,n);function s(e){nB(o,i,r,s,a,"next",e)}function a(e){nB(o,i,r,s,a,"throw",e)}s(void 0)}))}}function rB(e){let{hubChannel:t,onConnected:n,onClose:i,isAdmin:r}=e;const o=(0,Yy.useRef)(),s=(0,Yy.useCallback)(iB((function*(){try{o.current&&o.current.close();const e=yield t.getTwitterOAuthURL(),n=600,i=760,r=(window.innerWidth-n)/2+window.screenLeft,s=(window.innerHeight-i)/2+window.screenTop;window.doingTwitterOAuth=!0;const a=window.open(e,"_blank",`resizable=yes,width=${n},height=${i},left=${r},top=${s}toolbar=no,titlebar=no,menubar=no,scrollbars=yes`);a.focus(),o.current=a}catch(e){console.error(e),"twitter_api_error"===e.message&&r&&console.warn("Twitter might be misconfigured for Hubs Cloud. Check the docs here: https://hubs.mozilla.com/docs/hubs-cloud-third-party-integrations.html#twitter"),i()}})),[t,r,i]);return(0,Yy.useEffect)((()=>{function e(t){let{data:i}=t;"oauth-successful"===i&&(n(),o.current=null,delete window.doingTwitterOAuth,window.removeEventListener("message",e))}return window.addEventListener("message",e),()=>{o.current&&o.current.close(),delete window.doingTwitterOAuth,window.removeEventListener("message",e)}}),[n]),Yy.createElement(tB,{appName:k.translation("app-name"),onConnect:s,onClose:i})}function oB(e){let{hubChannel:t,initialTweet:n,mediaUrl:i,contentSubtype:r,onClose:o,isAdmin:s}=e;const[a,l]=(0,Yy.useState)(t.can("tweet")),c=(0,Yy.useCallback)((()=>{l(!0)}),[]);return a?Yy.createElement(eB,{initialTweet:n,mediaUrl:i,contentSubtype:r,onClose:o}):Yy.createElement(rB,{appName:k.translation("app-name"),hubChannel:t,onConnected:c,onClose:o,isAdmin:s})}eB.propTypes={mediaUrl:sw().string,contentSubtype:sw().string,initialTweet:sw().object.isRequired,onClose:sw().func},tB.propTypes={appName:sw().string.isRequired,onConnect:sw().func,onClose:sw().func},rB.propTypes={hubChannel:sw().object.isRequired,onConnected:sw().func.isRequired,onClose:sw().func,isAdmin:sw().bool},oB.propTypes={hubChannel:sw().object.isRequired,initialTweet:sw().string,mediaUrl:sw().string,contentSubtype:sw().string,onClose:sw().func,isAdmin:sw().bool};var sB={tip:"Tip__tip__o5Hrk",content:"Tip__content__ywfjP","dismiss-button":"Tip__dismiss-button__kt5sA",dismissButton:"Tip__dismiss-button__kt5sA",toast:"Tip__toast__usqEp"};const aB=["className","children","onDismiss","dismissLabel"];function lB(){return lB=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},lB.apply(this,arguments)}function cB(e){let{className:t,children:n,onDismiss:i,dismissLabel:r}=e,o=function(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}(e,aB);return Yy.createElement("div",lB({className:lw()(sB.tip,t)},o),Yy.createElement("div",{className:sB.content},n),i&&Yy.createElement("button",{className:sB.dismissButton,onClick:i},r))}cB.propTypes={className:sw().string,children:sw().node,onDismiss:sw().func,dismissLabel:sw().node};const dB=["className","children"];function uB(){return uB=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},uB.apply(this,arguments)}function hB(e){let{className:t,children:n}=e,i=function(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}(e,dB);return Yy.createElement("div",uB({className:lw()(sB.tip,sB.toast,t)},i),Yy.createElement("div",{className:sB.content},n))}hB.propTypes={className:sw().string,children:sw().node};var pB={"tooltips-centered":"Tooltip__tooltips-centered__owXqB",tooltipsCentered:"Tooltip__tooltips-centered__owXqB","tooltips-top":"Tooltip__tooltips-top__odGCJ",tooltipsTop:"Tooltip__tooltips-top__odGCJ",tip:"Tooltip__tip__nKLHy","tip-show-bottom":"Tooltip__tip-show-bottom__LOJfb",tipShowBottom:"Tooltip__tip-show-bottom__LOJfb","tip-show-top":"Tooltip__tip-show-top__HzItS",tipShowTop:"Tooltip__tip-show-top__HzItS",step:"Tooltip__step__tVwCM","navigation-container":"Tooltip__navigation-container__GtZ_e",navigationContainer:"Tooltip__navigation-container__GtZ_e",key:"Tooltip__key__DcZ0I","inline-button":"Tooltip__inline-button__Ap1iQ",inlineButton:"Tooltip__inline-button__Ap1iQ","inline-icon":"Tooltip__inline-icon__eAZuZ",inlineIcon:"Tooltip__inline-icon__eAZuZ","keys-container":"Tooltip__keys-container__ekivm",keysContainer:"Tooltip__keys-container__ekivm","desktop-move-container":"Tooltip__desktop-move-container__sxhwI",desktopMoveContainer:"Tooltip__desktop-move-container__sxhwI",dot:"Tooltip__dot___tu87","dot-enabled":"Tooltip__dot-enabled__TDdVo",dotEnabled:"Tooltip__dot-enabled__TDdVo",arrows:"Tooltip__arrows__vTKhk","arrows-hidden":"Tooltip__arrows-hidden__iMYXa",arrowsHidden:"Tooltip__arrows-hidden__iMYXa","end-button":"Tooltip__end-button__YKMs1",endButton:"Tooltip__end-button__YKMs1"};const mB=["className","onPrev","onNext","onDismiss","step"];function fB(){return fB=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},fB.apply(this,arguments)}let gB="W",vB="A",bB="S",yB="D",wB="Q",_B="E";void 0!==window.navigator.keyboard&&window.navigator.keyboard.getLayoutMap&&window.navigator.keyboard.getLayoutMap().then((function(e){var t,n;gB=`${e.get("KeyW")}`.toUpperCase(),vB=`${e.get("KeyA")}`.toUpperCase(),bB=`${e.get("KeyS")}`.toUpperCase(),yB=`${e.get("KeyD")}`.toUpperCase(),wB=null===(t=e.get("KeyQ"))||void 0===t?void 0:t.toUpperCase(),_B=null===(n=e.get("KeyE"))||void 0===n?void 0:n.toUpperCase()})).catch((function(e){console.warn(`Unable to remap keyboard: ${e}`)}));const EB=(0,gE.vU)({"tips.welcome":{id:"tips.welcome",defaultMessage:"<h2>Welcome to {appName}</h2><p>Let's take a quick look to get comfortable</p><p2>with the controls</p2>"},"tips.mobile.locomotion":{id:"tips.mobile.locomotion2",defaultMessage:"<p>Move around by pinching with two fingers</p><p2>or with the on-screen joysticks</p2>"},"tips.mobile.turning":{id:"tips.mobile.turning",defaultMessage:"Tap and drag to look around"},"tips.desktop.locomotion":{id:"tips.desktop.locomotion2",defaultMessage:"<p>Move around with</p> {wasd} or {arrows}"},"tips.desktop.turning":{id:"tips.desktop.turning2",defaultMessage:"Use {left} or {right} or click and drag to look around"},"tips.desktop.invite":{id:"tips.desktop.invite2",defaultMessage:"<p>Use the {invite} button to share</p><p2>this room</p2>"},"tips.end":{id:"tips.end",defaultMessage:"Tutorial completed! Have fun exploring"},"tips.menu":{id:"tips.menu",defaultMessage:"Access the tour from the {menu} menu"},"tips.buttons.get-started":{id:"tips.buttons.get-started",defaultMessage:"Get started"},"tips.buttons.skip-tour":{id:"tips.buttons.skip-tour",defaultMessage:"Skip tour"},"tips.buttons.done":{id:"tips.buttons.done",defaultMessage:"Done"},"tips.text.more":{id:"tips.text.more",defaultMessage:"More"},"tips.text.invite":{id:"tips.text.invite",defaultMessage:"Invite"}});function AB(e,t){return-1!==e.indexOf(t)}function SB(e){return AB(e,"desktop")?3:2}function xB(e){let{children:t}=e;return Yy.createElement("span",{className:pB.key},t)}function MB(e){let{icon:t,text:n}=e;return Yy.createElement("span",{className:pB.inlineButton},t,n)}function PB(e){let{icon:t}=e;return Yy.createElement("span",{className:pB.inlineIcon},t)}function CB(e){let{up:t,left:n,down:i,right:r}=e;return Yy.createElement("div",{className:pB.desktopMoveContainer},Yy.createElement("div",null,Yy.createElement(xB,null,t)),Yy.createElement("div",null,Yy.createElement(xB,null,n),Yy.createElement(xB,null,i),Yy.createElement(xB,null,r)))}function kB(e){let{step:t,params:n}=e;const i=(0,FE.Z)();return Yy.createElement(Yy.Fragment,null,i.formatMessage(EB[t],n))}function OB(e){let{onNext:t,onDismiss:n}=e;const i=(0,FE.Z)();return Yy.createElement("div",{className:pB.navigationContainer},Yy.createElement(t_,{preset:"primary",onClick:t},i.formatMessage(EB["tips.buttons.get-started"])),Yy.createElement(t_,{preset:"basic",onClick:n},i.formatMessage(EB["tips.buttons.skip-tour"])))}function TB(e){let{step:t,onPrev:n,onNext:i,params:r}=e;const o=(0,FE.Z)(),{currentStep:s}=r,a=0!==s,l=s!==SB(t)-1;return Yy.createElement("div",{className:pB.navigationContainer},Yy.createElement(Iw,{as:"span",className:lw()(pB.arrows,!a&&pB.arrowsHidden),onClick:n},"<"),Yy.createElement("div",{style:{display:"flex"}},[...Array(SB(t))].map(((e,t)=>Yy.createElement("span",{key:t,className:lw()(pB.dot,t===s&&pB.dotEnabled)})))),l?Yy.createElement(Iw,{as:"span",className:pB.arrows,onClick:i},">"):Yy.createElement(t_,{className:pB.endButton,preset:"text",onClick:i},o.formatMessage(EB["tips.buttons.done"])))}xB.propTypes={children:sw().node},MB.propTypes={icon:sw().node,text:sw().string},PB.propTypes={icon:sw().node},CB.propTypes={up:sw().node,left:sw().node,down:sw().node,right:sw().node},kB.propTypes={step:sw().string,params:sw().object},OB.propTypes={onNext:sw().func,onDismiss:sw().func},TB.propTypes={step:sw().string,onPrev:sw().func,onNext:sw().func,params:sw().object};const RB=(0,Yy.memo)((e=>{let{className:t,onPrev:n,onNext:i,onDismiss:r,step:o}=e,s=function(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}(e,mB);const a=(0,FE.Z)();let l=null,c=pB.tipShowBottom;AB(o,"welcome")?AB(o,"mobile")&&(l=pB.tooltipsCentered):AB(o,"mobile")&&(l=pB.tooltipsTop,c=pB.tipShowTop);const{control:d,navigationBar:u}=(0,Yy.useMemo)((()=>function(e){let{intl:t,step:n}=e;switch(n){case"tips.desktop.welcome":case"tips.mobile.welcome":return{control:{type:kB,params:{h2:e=>Yy.createElement("h2",null,e),p:e=>Yy.createElement("p",{style:{width:"100%"}},e),p2:e=>Yy.createElement("p",{style:{width:"100%"}},e),appName:k.translation("app-name")},messageId:"tips.welcome"},navigationBar:{type:OB}};case"tips.desktop.locomotion":return{control:{type:kB,params:{p:e=>Yy.createElement("p",{style:{width:"100%"}},e),wasd:Yy.createElement(CB,{up:gB,left:vB,down:bB,right:yB}),arrows:Yy.createElement(CB,{up:"↑",left:"←",down:"↓",right:"→"})}},navigationBar:{type:TB,params:{currentStep:0}}};case"tips.desktop.turning":return{control:{type:kB,params:{left:Yy.createElement(xB,null,wB),right:Yy.createElement(xB,null,_B)}},navigationBar:{type:TB,params:{currentStep:1}}};case"tips.desktop.invite":return{control:{type:kB,params:{invite:Yy.createElement(MB,{icon:Yy.createElement($T,null),text:t.formatMessage(EB["tips.text.invite"])}),p:e=>Yy.createElement("p",{style:{width:"100%"}},e),p2:e=>Yy.createElement("p",{style:{width:"100%"}},e)}},navigationBar:{type:TB,params:{currentStep:2}}};case"tips.desktop.menu":return{control:{type:kB,params:{menu:Yy.createElement(MB,{icon:Yy.createElement(vR,null),text:t.formatMessage(EB["tips.text.more"])})},messageId:"tips.menu"}};case"tips.mobile.locomotion":return{control:{type:kB,params:{p:e=>Yy.createElement("p",{style:{width:"100%"}},e),p2:e=>Yy.createElement("p",{style:{width:"100%"}},e)}},navigationBar:{type:TB,params:{currentStep:0}}};case"tips.mobile.turning":return{control:{type:kB},navigationBar:{type:TB,params:{currentStep:1}}};case"tips.mobile.menu":return{control:{type:kB,params:{menu:Yy.createElement(PB,{icon:Yy.createElement(vR,null)})},messageId:"tips.menu"}};case"tips.desktop.end":case"tips.mobile.end":return{control:{type:kB,messageId:"tips.end"}}}}({intl:a,step:o})),[a,o]);return Yy.createElement("div",{className:l},Yy.createElement("div",fB({className:lw()(pB.tip,c,t)},s),Yy.createElement("div",{className:(null==u?void 0:u.type)&&pB.step},Yy.createElement(d.type,{step:(null==d?void 0:d.messageId)||o,params:null==d?void 0:d.params})),(null==u?void 0:u.type)&&Yy.createElement(u.type,{step:o,onPrev:n,onNext:i,onDismiss:r,params:null==u?void 0:u.params})))}));function DB(){return DB=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},DB.apply(this,arguments)}function jB(){return Yy.createElement(uw.Z,{id:"tips.dismiss.ok",defaultMessage:"Ok"})}function LB(e){return Yy.createElement(cB,DB({},e,{dismissLabel:Yy.createElement(jB,null)}),Yy.createElement(uw.Z,{id:"tips.fullscreen",defaultMessage:"Entered fullscreen mode. Press Escape to show UI."}))}function IB(){return Yy.createElement(hB,null,Yy.createElement(uw.Z,{id:"record-mode-enabled-tip",defaultMessage:"Record mode on, press 'B' to toggle off"}))}function NB(e){let{inLobby:t,inRoom:n,isStreaming:i,isEmbedded:r,scene:o,store:s,hubId:a,presences:l}=e;const[c,d]=(0,Yy.useState)(!1),[u,h]=(0,Yy.useState)((()=>s.state.confirmedBroadcastedRooms.includes(a))),[p,m]=(0,Yy.useState)(!1),[f,g]=(0,Yy.useState)(!1),[v,b]=(0,Yy.useState)(null),y=(0,Yy.useRef)(null),w=(0,Yy.useCallback)((()=>{o.systems.tips.skipTips()}),[o]),_=(0,Yy.useCallback)((()=>{o.systems.tips.nextTip()}),[o]),E=(0,Yy.useCallback)((()=>{o.systems.tips.prevTip()}),[o]);(0,Yy.useEffect)((()=>{["tips.desktop.end","tips.mobile.end","tips.desktop.menu","tips.mobile.menu"].includes(v)&&(y.current=setTimeout((()=>{o.systems.tips.nextTip()}),2500))}),[o,y,v]),(0,Yy.useEffect)((()=>{function e(e){let{detail:t}=e;b(null),b(t)}return o.addEventListener("tip-changed",e),b(o.systems.tips.activeTip),()=>{o.removeEventListener("tip-changed",e),clearTimeout(y.current)}}),[o]);const A=l?ke(l):[],S=A.length>0;return t?c?null:Yy.createElement(cB,{onDismiss:()=>d(!0),dismissLabel:Yy.createElement(jB,null)},Yy.createElement(uw.Z,{id:"tips.lobby",defaultMessage:"You're in the lobby. Others cannot see or hear you."})):n?v?Yy.createElement(RB,{onPrev:E,onNext:_,onDismiss:w,step:v}):i&&!p?Yy.createElement(cB,{onDismiss:()=>m(!0),dismissLabel:Yy.createElement(jB,null)},Yy.createElement(uw.Z,{id:"tips.streaming",defaultMessage:"Now broadcasting to the lobby. Exit streamer mode in the more menu when you're done."})):S&&!u?Yy.createElement(cB,{onDismiss:()=>h(!0),dismissLabel:Yy.createElement(jB,null)},Yy.createElement(uw.Z,{id:"tips.discord",defaultMessage:"Chat in this room is being bridged to {broadcastTarget} on Discord.",values:{broadcastTarget:A.map((e=>"#"+e)).join(", ")}})):!r&&!function(e){for(const t of Object.values(e))for(const e of t.metas)if(e.context&&e.context.embed)return!0;return!1}(l)||f?null:Yy.createElement(cB,{onDismiss:()=>g(!0),dismissLabel:Yy.createElement(jB,null)},Yy.createElement(uw.Z,{id:"tips.embedded",defaultMessage:"This room is embedded, so it may be visible to visitors on other websites."})):null}RB.propTypes={className:sw().string,onPrev:sw().func,onNext:sw().func,onDismiss:sw().func,step:sw().string},RB.displayName="Tooltip",NB.propTypes={inLobby:sw().bool,inRoom:sw().bool,isStreaming:sw().bool,isEmbedded:sw().bool,scene:sw().object.isRequired,store:sw().object.isRequired,hubId:sw().string,presences:sw().object};function FB(e){let{name:t}=e;return Yy.createElement("div",{className:"SpectatingLabel__label__xmRHK"},Yy.createElement("b",null,Yy.createElement(uw.Z,{id:"spectating-label.label",defaultMessage:"Spectating"})),Yy.createElement("p",null,t))}FB.propTypes={name:sw().string};var BB={ecs:"ECSSidebar__ecs__hRWLP"};function VB(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function UB(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?VB(Object(n),!0).forEach((function(t){HB(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):VB(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function HB(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function zB(){return zB=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},zB.apply(this,arguments)}const WB=new Map;for(const[e,t]of Object.entries(i))WB.set(t,e);function qB(e){var t,n,i;const r=e.name||(e.el?(null===(t=e.el)||void 0===t?void 0:t.id)&&`#${e.el.id}`||`.${(null===(n=e.el)||void 0===n||null===(i=n.className)||void 0===i?void 0:i.replaceAll(" ","."))||"a-entity"}`:"");return r?`${r}(${e.constructor.name})`:`${e.constructor.name}`}function ZB(e){const{obj:t,toggleObjExpand:n,setSelectedObj:i,expanded:r,expandedIds:o}=e,s=qB(t);return Yy.createElement("div",{className:"obj-item"},Yy.createElement("div",{className:"obj-label",onClick:()=>n(t.uuid),onContextMenu:e=>{e.preventDefault(),i(t)}},Yy.createElement("span",{className:"toggle"},0===t.children.length?" ":r?"-":"+"),s,t.eid?` [${t.eid}]`:""),r&&Yy.createElement("div",null,t.children.map((t=>Yy.createElement(ZB,zB({},e,{obj:t,expanded:o.has(t.uuid),key:t.uuid}))))))}function GB(e){const{mat:t,setSelectedObj:n}=e,i=qB(t);return Yy.createElement("div",{className:"obj-item"},Yy.createElement("div",{className:"obj-label",onContextMenu:e=>{e.preventDefault(),n(t)}},i,` [${t.eid}]`))}function YB(e,t){const n=Object.keys(t).reduce(((n,i,r,o)=>{const s=t[i][e],a=t[i][Tt];if(n+=`  ${i}: `,ArrayBuffer.isView(s))n+=JSON.stringify(Array.from(s));else if(a){const e=APP.getString(s);e===NAF.clientId?n+=`${s} *You* "${e}"`:n+=`${s} "${e}"`}else n+=s;return r<o.length-1&&(n+="\n"),n}),"");return`{\n${n}\n}`}function QB(e){let{eid:t,component:n}=e;const[i,r]=(0,Yy.useState)(!1),o=Object.keys(n).length,s=i?YB(t,n):o?"{}":"";return Yy.createElement("pre",{onClick:()=>r(!i)},WB.get(n)," ",s)}function XB(e){let{eid:t}=e;return Yy.createElement("div",null,Yy.createElement("div",{className:"components"},(0,Ot.getEntityComponents)(APP.world,t).sort(((e,t)=>Object.keys(e).length-Object.keys(t).length)).map(((e,n)=>Yy.createElement(QB,{eid:t,key:n,component:e})))))}function KB(e){var t;let{obj:n}=e;const i=n.name||(null===(t=n.el)||void 0===t?void 0:t.id)&&`#${n.el.id}`||n.eid&&`Entity ${n.eid}`||n.uuid;return Yy.createElement("div",{className:"obj-properties"},Yy.createElement("div",{className:"title"},Yy.createElement("span",null,i),Yy.createElement("button",{onClick:()=>console.log(n)},Yy.createElement(uw.Z,{id:"ecs-sidebar.log-button",defaultMessage:"log"})),Yy.createElement("button",{onClick:()=>(0,Ot.removeEntity)(APP.world,n.eid)},Yy.createElement(uw.Z,{id:"ecs-sidebar.remove-button",defaultMessage:"remove"}))),Yy.createElement("div",{className:"content"},n.eid&&Yy.createElement(XB,{eid:n.eid})))}function $B(e){let{onClick:t}=e;return Yy.createElement(Iw,{onClick:t},Yy.createElement(uw.Z,{id:"ecs-sidebar.refresh-icon",defaultMessage:"refresh"}))}const JB=(0,Ot.defineQuery)([Ht]),eV=(0,Ot.defineQuery)([Ai]);function tV(e){let{onClose:t,toggleObjExpand:n,refreshScenegraph:i,setSelectedObj:r,expandedIds:o,rootObj:s,selectedObj:a}=e;const l=JB(APP.world).map((e=>APP.world.eid2obj.get(e))).filter((e=>!e.parent)),c=eV(APP.world).map((e=>APP.world.eid2mat.get(e)));return Yy.createElement(Rw,{title:"ECS Debug",className:BB.ecs,beforeTitle:Yy.createElement(Ww,{onClick:t}),afterTitle:Yy.createElement($B,{onClick:i})},Yy.createElement("div",{className:"content"},Yy.createElement("div",{className:"object-list"},Yy.createElement("section",null,Yy.createElement(ZB,{obj:s,toggleObjExpand:n,expanded:o.has(s.uuid),expandedIds:o,setSelectedObj:r})),Yy.createElement("section",null,l.map((e=>Yy.createElement(ZB,{obj:e,key:e.eid,toggleObjExpand:n,expanded:o.has(e.uuid),expandedIds:o,setSelectedObj:r})))),Yy.createElement("section",null,c.map((e=>Yy.createElement(GB,{mat:e,key:e.eid,setSelectedObj:r}))))),Yy.createElement("div",{className:"object-properties"},a&&Yy.createElement(KB,{obj:a}))))}function nV(e){let{onClose:t}=e;const[n,i]=(0,Yy.useState)({expanded:new Set,rootObj:AFRAME.scenes[0].object3D}),[r,o]=(0,Yy.useState)(null),[s,a]=(0,Yy.useState)();return Yy.createElement(tV,{onClose:t,toggleObjExpand:function(e){n.expanded.has(e)?n.expanded.delete(e):n.expanded.add(e),i(UB(UB({},n),{},{expanded:n.expanded}))},refreshScenegraph:function(){a({})},expandedIds:n.expanded,setSelectedObj:o,selectedObj:r,rootObj:n.rootObj})}const iV=["className","children"];function rV(){return rV=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},rV.apply(this,arguments)}const oV=AFRAME.utils.device.isMobile();function sV(e){let{className:t,children:n}=e,i=function(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}(e,iV);return Yy.createElement("div",rV({className:lw()(t,"NotificationsContainer__content__cMwn0",oV&&"NotificationsContainer__mobile__B3TrV")},i),n)}function aV(){return aV=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},aV.apply(this,arguments)}function lV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function cV(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?lV(Object(n),!0).forEach((function(t){dV(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):lV(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function dV(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function uV(e,t,n,i,r,o,s){try{var a=e[o](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(i,r)}function hV(e){return function(){var t=this,n=arguments;return new Promise((function(i,r){var o=e.apply(t,n);function s(e){uV(o,i,r,s,a,"next",e)}function a(e){uV(o,i,r,s,a,"throw",e)}s(void 0)}))}}sV.propTypes={className:sw().string,children:sw().node};const pV=(0,z.Z)("avatarEditorDebug"),mV=["/media"],fV=["media_source"],gV=["/media/scenes","/media/avatars","/media/favorites"],vV=["media_source"],bV=["scenes","avatars","favorites"];function yV(){return(yV=hV((function*(){return(yield navigator.mediaDevices.enumerateDevices()).filter((e=>e.label&&"audioinput"===e.kind)).map((e=>e.label))}))).apply(this,arguments)}const wV=AFRAME.utils.device.isMobile(),_V=AFRAME.utils.device.isMobileVR();class EV extends Yy.Component{constructor(e){var t;super(e),t=this,this.willCompileAndUploadMaterials=!1,this.state={enterInVR:!1,entered:!1,entering:!1,dialog:null,showShareDialog:!1,linkCode:null,linkCodeCancel:null,miniInviteActivated:!1,didConnectToNetworkedScene:!1,noMoreLoadingUpdates:!1,hideLoader:!1,showPrefs:!1,watching:!1,isStreaming:!1,isRecordingMode:!1,waitingOnAudio:!1,audioTrackClone:null,autoExitTimerStartedAt:null,autoExitTimerInterval:null,autoExitReason:null,secondsRemainingBeforeAutoExit:1/0,signedIn:!1,videoShareMediaSource:null,showVideoShareFailed:!1,objectInfo:null,objectSrc:"",sidebarId:null,presenceCount:0,chatPrefix:"",chatAutofocus:!1},this.onConcurrentLoad=()=>{(0,z.Z)("allow_multi")||this.props.store.state.preferences.allowMultipleHubsInstances||this.startAutoExitTimer(OF)},this.onIdleDetected=()=>{this.props.disableAutoExitOnIdle||this.state.isStreaming||this.props.store.state.preferences.disableIdleDetection||this.startAutoExitTimer(TF)},this.onActivityDetected=()=>{this.state.autoExitTimerInterval&&this.endAutoExitTimer()},this.storeUpdated=()=>{this.forceUpdate()},this.showContextualSignInDialog=()=>{const{signInMessage:e,authChannel:n,onContinueAfterSignIn:i}=this.props;this.showNonHistoriedDialog(aF,{step:zS,message:e,onSubmitEmail:function(){var e=hV((function*(e){const{authComplete:r}=yield n.startAuthentication(e,t.props.hubChannel);t.showNonHistoriedDialog(aF,{step:WS,onClose:i||t.closeDialog}),yield r,t.setState({signedIn:!0}),t.showNonHistoriedDialog(aF,{step:qS,onClose:i||t.closeDialog,onContinue:i||t.closeDialog})}));return function(t){return e.apply(this,arguments)}}(),onClose:i||this.closeDialog})},this.updateSubscribedState=()=>{const e=this.props.subscriptions&&this.props.subscriptions.isSubscribed();this.setState({isSubscribed:e})},this.toggleFavorited=()=>{this.props.performConditionalSignIn((()=>this.props.hubChannel.signedIn),(()=>{const e=this.isFavorited();this.props.hubChannel[e?"unfavorite":"favorite"](),this.setState({isFavorited:!e})}),ZS.favoriteRoom)},this.isFavorited=()=>void 0!==this.state.isFavorited?this.state.isFavorited:this.props.initialIsFavorited,this.onLoadingFinished=()=>{console.log("UI root loading has finished"),this.setState({noMoreLoadingUpdates:!0}),this.props.scene.emit("loading_finished"),this.props.onLoaded&&this.props.onLoaded()},this.onSceneLoaded=()=>{console.log("UI root scene has loaded"),this.setState({sceneLoaded:!0})},this.onShareVideoEnabled=e=>{this.setState({videoShareMediaSource:e.detail.source})},this.onShareVideoDisabled=()=>{this.setState({videoShareMediaSource:null})},this.onShareVideoFailed=()=>{this.setState({showVideoShareFailed:!0})},this.shareVideo=e=>{this.props.scene.emit(`action_share_${e}`)},this.endShareVideo=()=>{this.props.scene.emit(Ne.VIDEO_SHARE_ENDED)},this.spawnPen=()=>{this.props.scene.emit("penButtonPressed")},this.onSubscribeChanged=hV((function*(){t.props.subscriptions&&(yield t.props.subscriptions.toggle(),t.updateSubscribedState())})),this.handleForceEntry=()=>{console.log("Forced entry type: "+this.props.forcedVREntryType),this.props.forcedVREntryType&&(this.props.forcedVREntryType.startsWith("daydream")?this.enterDaydream():this.props.forcedVREntryType.startsWith("vr")?this.enterVR():this.props.forcedVREntryType.startsWith("2d")&&this.enter2D())},this.startAutoExitTimer=e=>{if(this.state.autoExitTimerInterval)return;const t=setInterval((()=>{let e=1/0;if(this.state.autoExitTimerStartedAt){const t=(new Date-this.state.autoExitTimerStartedAt)/1e3;e=Math.max(0,Math.floor(10-t))}this.setState({secondsRemainingBeforeAutoExit:e}),this.checkForAutoExit()}),500);this.setState({autoExitTimerStartedAt:new Date,autoExitTimerInterval:t,autoExitReason:e})},this.checkForAutoExit=()=>{0===this.state.secondsRemainingBeforeAutoExit&&(this.endAutoExitTimer(),this.props.exitScene())},this.isWaitingForAutoExit=()=>this.state.secondsRemainingBeforeAutoExit<=10,this.endAutoExitTimer=()=>{clearInterval(this.state.autoExitTimerInterval),this.setState({autoExitTimerStartedAt:null,autoExitTimerInterval:null,autoExitReason:null,secondsRemainingBeforeAutoExit:1/0})},this.performDirectEntryFlow=function(){var e=hV((function*(e){t.setState({enterInVR:e,waitingOnAudio:!0});const n=(yield function(){return yV.apply(this,arguments)}()).length>0;n?(t.mediaDevicesManager.isMicShared||(yield t.mediaDevicesManager.startMicShare({})),t.beginOrSkipAudioSetup()):(t.onRequestMicPermission(),t.pushHistoryState("entry_step","audio")),t.setState({waitingOnAudio:!1})}));return function(t){return e.apply(this,arguments)}}(),this.enter2D=hV((function*(){console.log("Entering in 2D mode"),yield t.performDirectEntryFlow(!1)})),this.enterVR=hV((function*(){console.log("Entering in VR mode"),t.props.forcedVREntryType||t.props.availableVREntryTypes.generic!==fw.maybe?yield t.performDirectEntryFlow(!0):t.showNonHistoriedDialog(FF)})),this.enterDaydream=hV((function*(){console.log("Entering in Daydream mode"),yield t.performDirectEntryFlow(!0)})),this.onRequestMicPermission=hV((function*(){t.props.canVoiceChat&&(yield t.mediaDevicesManager.startMicShare({}))})),this.beginOrSkipAudioSetup=()=>{this.props.forcedVREntryType&&this.props.forcedVREntryType.endsWith("_now")?(console.log(`Skipping audio setup (forcedVREntryType = ${this.props.forcedVREntryType})`),this.onAudioReadyButton()):(console.log("Starting audio setup"),this.pushHistoryState("entry_step","audio"))},this.shouldShowFullScreen=()=>(wV||AFRAME.utils.device.isMobileVR())&&!Q()&&!this.state.enterInVR&&pb().enabled,this.onAudioReadyButton=hV((function*(){t.state.enterInVR||(yield bb()),function(e){Jy(e,!1)}(t.props.history);const e=t.props.store.state.preferences.muteMicOnEntry;yield t.props.enterScene(t.state.enterInVR,e),t.setState({entered:!0,entering:!1,showShareDialog:!1}),t.mediaDevicesManager.isMicShared&&console.log(`Using microphone: ${t.mediaDevicesManager.selectedMicLabel}`),t.mediaDevicesManager.isVideoShared&&console.log("Screen sharing enabled.")})),this.attemptLink=hV((function*(){t.pushHistoryState("entry_step","device");const{code:e,cancel:n,onFinished:i}=yield t.props.linkChannel.generateCode();t.setState({linkCode:e,linkCodeCancel:n}),i.then((()=>{t.setState({log:!1,linkCode:null,linkCodeCancel:null}),t.props.exitScene()}))})),this.toggleShareDialog=hV((function*(){t.props.store.update({activity:{hasOpenedShare:!0}}),t.setState({showShareDialog:!t.state.showShareDialog})})),this.closeDialog=()=>{this.state.dialog&&this.setState({dialog:null}),Rb()?Ob():wb()},this.showNonHistoriedDialog=function(e,n){void 0===n&&(n={}),t.setState({dialog:Yy.createElement(e,cV({onClose:t.closeDialog},n))})},this.toggleStreamerMode=()=>{const e=!this.state.isStreaming;this.props.scene.systems["hubs-systems"].characterController.fly=e,e?this.props.hubChannel.beginStreaming():this.props.hubChannel.endStreaming(),this.setState({isStreaming:e})},this.renderDialog=function(e,n){return void 0===n&&(n={}),Yy.createElement(e,cV({onClose:t.closeDialog},n))},this.signOut=hV((function*(){yield t.props.authChannel.signOut(t.props.hubChannel),t.setState({signedIn:!1})})),this.onMiniInviteClicked=()=>{const e=`https://${k.SHORTLINK_DOMAIN}/${this.props.hub.hub_id}`;this.setState({miniInviteActivated:!0}),setTimeout((()=>{this.setState({miniInviteActivated:!1})}),5e3),_w()?navigator.share({title:document.title,url:e}):dw()(e)},this.sendMessage=e=>{this.props.onSendMessage(e)},this.occupantCount=()=>this.props.presences?Object.entries(this.props.presences).length:0,this.hasEmbedPresence=()=>{if(!this.props.presences)return!1;for(const e of Object.values(this.props.presences))for(const t of e.metas)if(t.context&&t.context.embed)return!0;return!1},this.onTweet=e=>{let{detail:t}=e;Cb(!0,(()=>{})).then((()=>{this.props.performConditionalSignIn((()=>this.props.hubChannel.signedIn),(()=>{this.showNonHistoriedDialog(oB,cV({hubChannel:this.props.hubChannel,isAdmin:k.isAdmin()},t))}),ZS.tweet)}))},this.onChangeScene=()=>{this.props.performConditionalSignIn((()=>this.props.hubChannel.can("update_hub")),(()=>{bb(),this.props.mediaSearchStore.sourceNavigateWithNoNav("scenes","use")}),ZS.changeScene)},this.pushHistoryState=(e,t)=>ew(this.props.history,e,t),this.onFocusChat=e=>{this.setSidebar("chat",{chatPrefix:e.detail.prefix,chatAutofocus:!0})},this.renderInterstitialPrompt=()=>Yy.createElement("div",{className:"ui-root__interstitial__Ic8QU",onClick:()=>this.props.onInterstitialPromptClicked()},Yy.createElement("div",null,Yy.createElement(uw.Z,{id:"ui-root.interstitial-prompt",defaultMessage:"Continue"}))),this.renderBotMode=()=>Yy.createElement("div",{className:"loading-panel"},Yy.createElement("img",{className:"loading-panel__logo",src:k.image("logo")}),Yy.createElement("input",{type:"file",id:"bot-audio-input",accept:"audio/*"}),Yy.createElement("input",{type:"file",id:"bot-data-input",accept:"application/json"})),this.onEnteringCanceled=()=>{this.props.hubChannel.sendEnteringCancelledEvent(),this.setState({entering:!1})},this.renderEntryStartPanel=()=>{const{hasAcceptedProfile:e,hasChangedName:t}=this.props.store.state.activity,n=D(),i=this.props.hubIsBound?!e:!t;return Yy.createElement(Yy.Fragment,null,Yy.createElement(oT,{roomName:this.props.hub.name,showJoinRoom:!this.state.waitingOnAudio&&!this.props.entryDisallowed,onJoinRoom:()=>{var e;if(n)return null!==(e=this.props.forcedVREntryType)&&void 0!==e&&e.startsWith("vr")?void this.setState({enterInVR:!0},this.onAudioReadyButton):this.onAudioReadyButton();i||!this.props.forcedVREntryType?(this.setState({entering:!0}),this.props.hubChannel.sendEnteringEvent(),i?this.pushHistoryState("entry_step","profile"):(this.onRequestMicPermission(),this.pushHistoryState("entry_step","audio"))):this.handleForceEntry()},showEnterOnDevice:!this.state.waitingOnAudio&&!this.props.entryDisallowed&&!_V,onEnterOnDevice:()=>this.attemptLink(),showSpectate:!this.state.waitingOnAudio,onSpectate:()=>this.setState({watching:!0}),showRoomSettings:this.props.hubChannel.canOrWillIfCreator("update_hub"),onRoomSettings:()=>{this.props.performConditionalSignIn((()=>this.props.hubChannel.can("update_hub")),(()=>this.setSidebar("room-settings")),ZS.roomSettings)}}),!this.state.waitingOnAudio&&Yy.createElement(dx,{hubChannel:this.props.hubChannel,entering:this.state.entering,onEnteringCanceled:this.onEnteringCanceled}))},this.renderDevicePanel=()=>Yy.createElement(lT,{shortUrl:k.SHORTLINK_DOMAIN,loadingCode:!this.state.linkCode,code:this.state.linkCode,headsetConnected:this.props.availableVREntryTypes.generic!==fw.no||this.props.availableVREntryTypes.cardboard!==fw.no,unsupportedBrowser:this.props.availableVREntryTypes.generic===fw.maybe,onEnterOnConnectedHeadset:()=>{this.state.linkCodeCancel(),this.setState({linkCode:null,linkCodeCancel:null}),this.enterVR()},onBack:()=>{this.state.linkCodeCancel&&this.state.linkCodeCancel(),this.setState({linkCode:null,linkCodeCancel:null}),this.props.history.goBack()}}),this.renderAudioSetupPanel=()=>Yy.createElement(VT,{scene:this.props.scene,onEnterRoom:this.onAudioReadyButton,onBack:()=>this.props.history.goBack()}),this.isInModalOrOverlay=()=>!((!this.state.entered||!mV.find((e=>iw(this.props.history.location).startsWith(e)))&&!fV.find((e=>new URLSearchParams(this.props.history.location.search).get(e))))&&(this.state.entered||!gV.find((e=>iw(this.props.history.location).startsWith(e)))&&!vV.find(((e,t)=>new URLSearchParams(this.props.history.location.search).get(e)===bV[t])))&&(!this.state.objectInfo||!this.state.objectInfo.object3D)&&null===this.state.sidebarId&&!(this.props.history&&this.props.history.location.state&&(this.props.history.location.state.modal||this.props.history.location.state.overlay)||this.state.dialog)),e.mediaSearchStore.setHistory(e.history),this.exitEventHandler=()=>this.props.exitScene(),this.mediaDevicesManager=APP.mediaDevicesManager}componentDidUpdate(e){const{hubChannel:t,showSignInDialog:n}=this.props;if(t){const{signedIn:e}=t;e!==this.state.signedIn&&this.setState({signedIn:e})}if(e.showSignInDialog!==n&&(n?this.showContextualSignInDialog():this.closeDialog()),!this.willCompileAndUploadMaterials&&this.state.noMoreLoadingUpdates&&(this.willCompileAndUploadMaterials=!0,window.requestAnimationFrame((()=>{window.setTimeout((()=>{if(!this.props.isBotMode)try{this.props.scene.renderer.compile(this.props.scene.object3D,this.props.scene.camera),this.props.scene.object3D.traverse((e=>{if(!e.material)return;const t=Array.isArray(e.material)?e.material:[e.material];for(const e of t)for(const t in e)e[t]&&e[t].isTexture&&this.props.scene.renderer.initTexture(e[t])}))}catch(e){console.error(e),this.props.exitScene(jF.sceneError)}this.state.hideLoader||this.setState({hideLoader:!0})}),0)}))),!this.props.selectedObject||!e.selectedObject){const e=this.props.scene;this.props.selectedObject?e.classList.add(kO.sceneSmFullScreen):e.classList.remove(kO.sceneSmFullScreen)}this.state.presenceCount!=this.occupantCount()&&this.setState({presenceCount:this.occupantCount()})}componentDidMount(){window.addEventListener("concurrentload",this.onConcurrentLoad),window.addEventListener("idle_detected",this.onIdleDetected),window.addEventListener("activity_detected",this.onActivityDetected),window.addEventListener("focus_chat",this.onFocusChat),document.querySelector(".a-canvas").addEventListener("mouseup",(()=>{this.state.showShareDialog&&this.setState({showShareDialog:!1})})),this.props.scene.addEventListener("loaded",this.onSceneLoaded),this.props.scene.addEventListener("share_video_enabled",this.onShareVideoEnabled),this.props.scene.addEventListener("share_video_disabled",this.onShareVideoDisabled),this.props.scene.addEventListener("share_video_failed",this.onShareVideoFailed),this.props.scene.addEventListener("exit",this.exitEventHandler),this.props.scene.addEventListener("action_exit_watch",(()=>{this.state.hide?this.setState({hide:!1,hideUITip:!1}):this.setState({watching:!1})})),this.props.scene.addEventListener("action_toggle_ui",(()=>this.setState({hide:!this.state.hide,hideUITip:!1}))),this.props.scene.addEventListener("action_toggle_record",(()=>{const e=document.querySelector("#right-cursor");this.state.isRecordingMode?(e.object3D.children[1].material.visible=!0,this.setState({hide:!1,hideUITip:!1,isRecordingMode:!1}),document.querySelector(".rs-fps-counter").style.visibility="visible",document.querySelector(".rs-base").style.visibility="visible"):(e.object3D.children[1].material.visible=!1,this.setState({hide:!0,hideUITip:!0,isRecordingMode:!0}),document.querySelector(".rs-fps-counter").style.visibility="hidden",document.querySelector(".rs-base").style.visibility="hidden")})),this.props.scene.addEventListener("devicechange",(()=>{this.forceUpdate()}));const e=this.props.scene,t=this.props.history.listen(((e,n)=>{const i=e.state;if("POP"===n&&i&&i.entry_step&&this.state.entered)return t(),void function(e){nw(e,!0)}(this.props.history)}));this.props.history.location.state&&!iw(this.props.history.location).startsWith("/media")&&nw(this.props.history),this.setState({audioContext:{playSound:t=>{e.emit(t)},onMouseLeave:()=>{}}}),this.props.forcedVREntryType&&this.props.forcedVREntryType.endsWith("_now")&&this.props.scene.addEventListener("loading_finished",(()=>{console.log("Loading has finished. Checking for forced room entry"),setTimeout((()=>this.handleForceEntry()),1e3)}),{once:!0}),this.playerRig=e.querySelector("#avatar-rig"),e.addEventListener("action_media_tweet",this.onTweet)}UNSAFE_componentWillMount(){this.props.store.addEventListener("statechanged",this.storeUpdated)}componentWillUnmount(){this.props.scene.removeEventListener("loaded",this.onSceneLoaded),this.props.scene.removeEventListener("exit",this.exitEventHandler),this.props.scene.removeEventListener("share_video_enabled",this.onShareVideoEnabled),this.props.scene.removeEventListener("share_video_disabled",this.onShareVideoDisabled),this.props.scene.removeEventListener("share_video_failed",this.onShareVideoFailed),this.props.scene.removeEventListener("action_media_tweet",this.onTweet),this.props.store.removeEventListener("statechanged",this.storeUpdated),window.removeEventListener("concurrentload",this.onConcurrentLoad),window.removeEventListener("idle_detected",this.onIdleDetected),window.removeEventListener("activity_detected",this.onActivityDetected),window.removeEventListener("focus_chat",this.onFocusChat)}setSidebar(e,t){this.setState(cV({sidebarId:e,chatPrefix:"",chatAutofoucs:!1,selectedUserId:null},t))}toggleSidebar(e,t){this.setState((n=>{let{sidebarId:i}=n;return cV({sidebarId:i===e?null:e,selectedUserId:null},t)}))}getSelectedUser(){const e=this.state.selectedUserId;return oL(e,this.props.presences[e],Ow(),this.props.sessionId)}render(){var e=this;const t=k.feature("enable_lobby_ghosts")&&(this.state.watching||this.state.hide||this.props.hide),n=this.state.hide||this.props.hide,i={"ui-root__ui__DMhNQ":!0,"ui-root":!0,"in-modal-or-overlay":this.isInModalOrOverlay(),isGhost:t,hide:n};if(this.state.isRecordingMode)return Yy.createElement("div",{className:lw()(i)},Yy.createElement(VO,{scene:this.props.scene,store:this.props.store,viewport:Yy.createElement(IB,null)}));if(this.props.hide||this.state.hide)return Yy.createElement("div",{className:lw()(i)},Yy.createElement(VO,{scene:this.props.scene,store:this.props.store,viewport:!this.state.hideUITip&&Yy.createElement(LB,{onDismiss:()=>this.setState({hideUITip:!0})})}));if(this.props.showSafariMicDialog)return Yy.createElement("div",{className:lw()(i)},Yy.createElement(VO,{scene:this.props.scene,store:this.props.store,modal:Yy.createElement(sF,null)}));const r=this.props.showPreload,o=!r&&!this.state.hideLoader;if(o&&this.state.showPrefs)return Yy.createElement("div",null,Yy.createElement(CO,{scene:this.props.scene,onLoaded:this.onLoadingFinished}),Yy.createElement(_P,{onClose:()=>{this.setState({showPrefs:!1})},store:this.props.store,scene:this.props.scene}));if(this.props.isBotMode)return this.renderBotMode();if(o)return Yy.createElement(CO,{scene:this.props.scene,onLoaded:this.onLoadingFinished});if(this.state.showPrefs)return Yy.createElement(_P,{onClose:()=>{this.setState({showPrefs:!1})},store:this.props.store,scene:this.props.scene});if(this.props.showInterstitialPrompt)return this.renderInterstitialPrompt();const s=this.state.entered,a=this.state.watching,l=s||a,c=this.props.store.state.preferences.showRtcDebugPanel,d=this.props.store.state.preferences.showAudioDebugPanel,u=this.props.hubIsBound?Me(this.props.presences,this.props.sessionId).displayName:null,h=k.feature("enable_lobby_ghosts")&&t&&!n&&this.props.availableVREntryTypes.generic!==fw.no,p=this.props.availableVREntryTypes&&!r&&(this.isWaitingForAutoExit()?Yy.createElement(DF,{reason:this.state.autoExitReason,secondsRemaining:this.state.secondsRemainingBeforeAutoExit,onCancel:this.endAutoExitTimer}):Yy.createElement(Yy.Fragment,null,Yy.createElement(Cw,{stateKey:"entry_step",stateValue:"device",history:this.props.history},this.renderDevicePanel()),Yy.createElement(Cw,{stateKey:"entry_step",stateValue:"audio",history:this.props.history},this.renderAudioSetupPanel()),Yy.createElement(Cw,{stateKey:"entry_step",stateValue:"profile",history:this.props.history,render:e=>Yy.createElement(fE,aV({},e,{containerType:"modal",displayNameOverride:u,finished:()=>{this.props.forcedVREntryType?(this.pushHistoryState(),this.handleForceEntry()):(this.onRequestMicPermission(),this.pushHistoryState("entry_step","audio"))},showBackButton:!0,onBack:()=>this.pushHistoryState(),store:this.props.store,mediaSearchStore:this.props.mediaSearchStore,avatarId:e.location.state.detail&&e.location.state.detail.avatarId}))}),Yy.createElement(Cw,{stateKey:"entry_step",stateValue:"",history:this.props.history},this.renderEntryStartPanel()))),m=this.props.presenceLogEntries||[],f=this.props.mediaSearchStore.getUrlMediaSource(this.props.history.location),g=f&&(["scenes","avatars","favorites"].includes(f)||this.state.entered),v=this.state.isStreaming,b=D(),y=l&&!b,w=(0,z.Z)("ecsDebug"),_=up(),E=_&&_.displayName,A=!l&&this.props.hub||this.isWaitingForAutoExit(),S=!k.feature("disable_room_creation")||k.isAdmin(),x=this.props.hubChannel&&!!this.props.hubChannel.canOrWillIfCreator("close_hub"),M=this.props.hubChannel&&this.props.hubChannel.canOrWillIfCreator("kick_users")&&!_V,P=[{id:"user",label:this.state.signedIn?Yy.createElement(uw.Z,{id:"more-menu.you-signed-in-as",defaultMessage:"Signed in as: {email}",values:{email:oO(this.props.store.state.credentials.email)}}):Yy.createElement(uw.Z,{id:"more-menu.not-signed-in",defaultMessage:"You are not signed in"}),items:[this.state.signedIn?{id:"sign-out",label:Yy.createElement(uw.Z,{id:"more-menu.sign-out",defaultMessage:"Sign Out"}),icon:aj,onClick:(C=hV((function*(){yield e.props.authChannel.signOut(e.props.hubChannel),yield se(),e.props.store.clearUserInfo(),e.setState({signedIn:!1})})),function(){return C.apply(this,arguments)})}:{id:"sign-in",label:Yy.createElement(uw.Z,{id:"more-menu.sign-in",defaultMessage:"Sign In"}),icon:qO,onClick:()=>this.showContextualSignInDialog()},S&&{id:"create-room",label:Yy.createElement(uw.Z,{id:"more-menu.create-room",defaultMessage:"Create Room"}),icon:NA,onClick:()=>this.showNonHistoriedDialog(pF,{destinationUrl:"/",reason:dF})},!b&&{id:"user-profile",label:Yy.createElement(uw.Z,{id:"more-menu.profile",defaultMessage:"Change Name & Avatar"}),icon:pD,onClick:()=>this.setSidebar("profile")},{id:"preferences",label:Yy.createElement(uw.Z,{id:"more-menu.preferences",defaultMessage:"Preferences"}),icon:tT,onClick:()=>this.setState({showPrefs:!0})}].filter((e=>e))},{id:"room",label:Yy.createElement(uw.Z,{id:"more-menu.room",defaultMessage:"Room"}),items:[{id:"room-info",label:Yy.createElement(uw.Z,{id:"more-menu.room-info",defaultMessage:"Room Info and Settings"}),icon:TD,onClick:()=>this.setSidebar("room-info")},("sm"===this.props.breakpoint||"md"===this.props.breakpoint)&&("invite"!==this.props.hub.entry_mode||this.props.hubChannel.can("update_hub"))&&{id:"invite",label:Yy.createElement(uw.Z,{id:"more-menu.invite",defaultMessage:"Invite"}),icon:$T,onClick:()=>this.props.scene.emit("action_invite")},M&&s&&{id:"streamer-mode",label:v?Yy.createElement(uw.Z,{id:"more-menu.exit-streamer-mode",defaultMessage:"Exit Streamer Mode"}):Yy.createElement(uw.Z,{id:"more-menu.enter-streamer-mode",defaultMessage:"Enter Streamer Mode"}),icon:cD,onClick:()=>this.toggleStreamerMode()},("sm"===this.props.breakpoint||"md"===this.props.breakpoint)&&s&&{id:"leave-room",label:Yy.createElement(uw.Z,{id:"more-menu.enter-leave-room",defaultMessage:"Leave Room"}),icon:aj,onClick:()=>{this.showNonHistoriedDialog(pF,{destinationUrl:"/",reason:lF})}},x&&{id:"close-room",label:Yy.createElement(uw.Z,{id:"more-menu.close-room",defaultMessage:"Close Room"}),icon:_D,onClick:()=>this.props.performConditionalSignIn((()=>this.props.hubChannel.can("update_hub")),(()=>{this.showNonHistoriedDialog(NF,{roomName:this.props.hub.name,onConfirm:()=>{this.props.hubChannel.closeHub(),this.props.store.updateClassRoomID(null),se()}})}),ZS.closeRoom)}].filter((e=>e))},{id:"support",label:Yy.createElement(uw.Z,{id:"more-menu.support",defaultMessage:"Support"}),items:[k.feature("show_community_link")&&{id:"community",label:Yy.createElement(uw.Z,{id:"more-menu.community",defaultMessage:"Community"}),icon:nj,href:k.link("community","https://discord.gg/dFJncWwHun")},k.feature("show_issue_report_link")&&{id:"report-issue",label:Yy.createElement(uw.Z,{id:"more-menu.report-issue",defaultMessage:"Report Issue"}),icon:MD,href:k.link("issue_report","https://hubs.mozilla.com/docs/help.html")},s&&{id:"start-tour",label:Yy.createElement(uw.Z,{id:"more-menu.start-tour",defaultMessage:"Start Tour"}),icon:QD,onClick:()=>this.props.scene.systems.tips.resetTips()},k.feature("show_docs_link")&&{id:"help",label:Yy.createElement(uw.Z,{id:"more-menu.help",defaultMessage:"Help"}),icon:QD,href:k.link("docs","https://hubs.mozilla.com/docs")},k.feature("show_controls_link")&&{id:"controls",label:Yy.createElement(uw.Z,{id:"more-menu.controls",defaultMessage:"Controls"}),icon:QD,href:k.link("controls","https://hubs.mozilla.com/docs/hubs-controls.html")},k.feature("show_whats_new_link")&&{id:"whats-new",label:Yy.createElement(uw.Z,{id:"more-menu.whats-new",defaultMessage:"What's New"}),icon:QD,href:"/whats-new"},k.feature("show_terms")&&{id:"tos",label:Yy.createElement(uw.Z,{id:"more-menu.tos",defaultMessage:"Terms of Service"}),icon:ND,href:k.link("terms_of_use",We)},k.feature("show_privacy")&&{id:"privacy",label:Yy.createElement(uw.Z,{id:"more-menu.privacy",defaultMessage:"Privacy Notice"}),icon:$D,href:k.link("privacy_notice",ze)}].filter((e=>e))}];var C;return Yy.createElement(SR,null,Yy.createElement(Sw.Provider,{value:this.state.audioContext},Yy.createElement("div",{className:lw()(i)},r&&this.props.hub&&Yy.createElement(pk,{hubName:this.props.hub.name,hubScene:this.props.hub.scene,baseUrl:ue(this.props.hub.hub_id).href,onLoadClicked:this.props.onPreloadLoadClicked}),!this.state.dialog&&Yy.createElement(Cw,{stateKey:"overlay",stateValue:"avatar-editor",history:this.props.history,render:e=>Yy.createElement(Ox,{className:"ui-root__avatar-editor__VDEEJ",signedIn:this.state.signedIn,onSignIn:this.showContextualSignInDialog,onSave:()=>{e.location.state.detail&&e.location.state.detail.returnToProfile?this.props.history.goBack():(this.props.history.goBack(),this.props.mediaSearchStore.sourceNavigateWithNoNav("avatars","use")),this.props.onAvatarSaved()},onClose:()=>this.props.history.goBack(),store:this.props.store,debug:pV,avatarId:e.location.state.detail&&e.location.state.detail.avatarId,hideDelete:e.location.state.detail&&e.location.state.detail.hideDelete})}),!this.state.dialog&&g&&Yy.createElement(cx,{history:this.props.history,mediaSearchStore:this.props.mediaSearchStore,hubChannel:this.props.hubChannel,onMediaSearchResultEntrySelected:(e,t)=>{"room"===e.type?this.showNonHistoriedDialog(pF,{destinationUrl:e.url,reason:cF}):this.props.onMediaSearchResultEntrySelected(e,t)},performConditionalSignIn:this.props.performConditionalSignIn,showNonHistoriedDialog:this.showNonHistoriedDialog,store:this.props.store,scene:this.props.scene}),this.props.hub&&Yy.createElement(VO,{scene:this.props.scene,store:this.props.store,objectFocused:!!this.props.selectedObject,streaming:v,viewport:Yy.createElement(Yy.Fragment,null,!this.state.dialog&&A?p:void 0,!this.props.selectedObject&&Yy.createElement(PR,null),(!this.props.selectedObject||"sm"!==this.props.breakpoint&&"md"!==this.props.breakpoint)&&Yy.createElement(rD,null,y&&Yy.createElement(nD,{active:"objects"===this.state.sidebarId,onClick:()=>this.toggleSidebar("objects")}),Yy.createElement(iD,{active:"people"===this.state.sidebarId,disabled:b,onClick:b?null:()=>this.toggleSidebar("people"),presencecount:this.state.presenceCount}),w&&Yy.createElement(tD,{active:"ecs-debug"===this.state.sidebarId,onClick:()=>this.toggleSidebar("ecs-debug")})),!s&&!v&&!wV&&E&&Yy.createElement(FB,{name:E}),this.props.activeObject&&Yy.createElement(ZI,{hubChannel:this.props.hubChannel,scene:this.props.scene,onOpenProfile:()=>this.setSidebar("profile"),onGoToObject:()=>{"sm"===this.props.breakpoint&&this.setSidebar(null)}}),"chat"!==this.state.sidebarId&&this.props.hub&&Yy.createElement(dk,{preset:"InRoom",exclude:wV?[]:["permission"],presences:this.props.presences,entries:m,hubId:this.props.hub.hub_id,history:this.props.history,onViewProfile:e=>this.setSidebar("user",{selectedUserId:e})}),Yy.createElement(sV,null,(this.state.hide||this.state.hideUITip||!this.props.activeObject)&&Yy.createElement(NB,{inLobby:a,inRoom:s,isEmbedded:this.props.embed,isStreaming:v,hubId:this.props.hub.hub_id,presences:this.props.presences,scene:this.props.scene,store:this.props.store}),!wV&&!this.state.hide&&Yy.createElement(dk,{preset:"Notifications",include:["permission"],presences:this.props.presences,entries:m,hubId:this.props.hub.hub_id,history:this.props.history,onViewProfile:e=>this.setSidebar("user",{selectedUserId:e})})),(c||d)&&Yy.createElement(rO,{history:this.props.history,store:window.APP.store,scene:this.props.scene,presences:this.props.presences,sessionId:this.props.sessionId,showRtcDebug:c,showAudioDebug:d})),sidebar:this.state.sidebarId?Yy.createElement(Yy.Fragment,null,"chat"===this.state.sidebarId&&Yy.createElement(qR,{presences:this.props.presences,occupantCount:this.occupantCount(),canSpawnMessages:s&&this.props.hubChannel.can("spawn_and_move_media"),scene:this.props.scene,onClose:()=>this.setSidebar(null),autoFocus:this.state.chatAutofocus,initialValue:this.state.chatPrefix}),"objects"===this.state.sidebarId&&Yy.createElement(rI,{hubChannel:this.props.hubChannel,onClose:()=>this.setSidebar(null)}),"people"===this.state.sidebarId&&Yy.createElement(aL,{displayNameOverride:u,store:this.props.store,mediaSearchStore:this.props.mediaSearchStore,hubChannel:this.props.hubChannel,history:this.props.history,mySessionId:this.props.sessionId,presences:this.props.presences,onClose:()=>this.setSidebar(null),onCloseDialog:()=>this.closeDialog(),showNonHistoriedDialog:this.showNonHistoriedDialog,performConditionalSignIn:this.props.performConditionalSignIn}),"profile"===this.state.sidebarId&&Yy.createElement(fE,{history:this.props.history,containerType:"sidebar",displayNameOverride:u,finished:()=>this.setSidebar(null),onClose:()=>this.setSidebar(null),store:this.props.store,mediaSearchStore:this.props.mediaSearchStore}),"user"===this.state.sidebarId&&Yy.createElement(nL,{user:this.getSelectedUser(),hubChannel:this.props.hubChannel,performConditionalSignIn:this.props.performConditionalSignIn,onClose:()=>this.setSidebar(null),onCloseDialog:()=>this.closeDialog(),showNonHistoriedDialog:this.showNonHistoriedDialog}),"room-info"===this.state.sidebarId&&Yy.createElement(vF,{accountId:this.props.sessionId,room:this.props.hub,canEdit:this.props.hubChannel.canOrWillIfCreator("update_hub"),onEdit:()=>{this.props.performConditionalSignIn((()=>this.props.hubChannel.can("update_hub")),(()=>this.setSidebar("room-info-settings")),ZS.roomSettings)},onClose:()=>this.setSidebar(null),onChangeScene:this.onChangeScene}),"room-info-settings"===this.state.sidebarId&&Yy.createElement(kF,{room:this.props.hub,hubChannel:this.props.hubChannel,showBackButton:!0,onClose:()=>this.setSidebar("room-info"),onChangeScene:this.onChangeScene}),"room-settings"===this.state.sidebarId&&Yy.createElement(kF,{room:this.props.hub,accountId:this.props.sessionId,hubChannel:this.props.hubChannel,onClose:()=>this.setSidebar(null),onChangeScene:this.onChangeScene}),"ecs-debug"===this.state.sidebarId&&Yy.createElement(nV,{onClose:()=>this.setSidebar(null)})):void 0,modal:this.state.dialog,toolbarLeft:Yy.createElement(uR,{hub:this.props.hub,hubChannel:this.props.hubChannel,scene:this.props.scene,store:this.props.store}),toolbarCenter:Yy.createElement(Yy.Fragment,null,a&&Yy.createElement(Yy.Fragment,null,Yy.createElement(UP,{icon:Yy.createElement(qO,null),label:Yy.createElement(uw.Z,{id:"toolbar.join-room-button",defaultMessage:"Join Room"}),preset:"accept",onClick:()=>this.setState({watching:!1})}),h&&Yy.createElement(UP,{icon:Yy.createElement(YO,null),preset:"accent5",label:Yy.createElement(uw.Z,{id:"toolbar.spectate-in-vr-button",defaultMessage:"Spectate in VR"}),onClick:()=>this.props.scene.enterVR()})),s&&Yy.createElement(Yy.Fragment,null,!b&&Yy.createElement(Yy.Fragment,null,Yy.createElement(BN,{scene:this.props.scene}),Yy.createElement(yN,{scene:this.props.scene,hubChannel:this.props.hubChannel}),Yy.createElement(cN,{scene:this.props.scene,hubChannel:this.props.hubChannel,mediaSearchStore:this.props.mediaSearchStore,showNonHistoriedDialog:this.showNonHistoriedDialog})),this.props.hubChannel.can("spawn_emoji")&&Yy.createElement(oF,{scene:this.props.scene,initialPresence:Me(this.props.presences,this.props.sessionId)})),!b&&Yy.createElement(ZR,{onClick:()=>this.toggleSidebar("chat",{chatPrefix:"",chatAutofocus:!1})}),s&&_V&&Yy.createElement(UP,{className:Aw.hideLg,icon:Yy.createElement(YO,null),preset:"accept",label:Yy.createElement(uw.Z,{id:"toolbar.enter-vr-button",defaultMessage:"Enter VR"}),onClick:()=>Ob(!0)})),toolbarRight:Yy.createElement(Yy.Fragment,null,s&&_V&&Yy.createElement(UP,{icon:Yy.createElement(YO,null),preset:"accept",label:Yy.createElement(uw.Z,{id:"toolbar.enter-vr-button",defaultMessage:"Enter VR"}),onClick:()=>Ob(!0)}),s&&Yy.createElement(UP,{icon:Yy.createElement(aj,null),label:Yy.createElement(uw.Z,{id:"toolbar.leave-room-button",defaultMessage:"Leave"}),preset:"cancel",onClick:()=>{this.showNonHistoriedDialog(pF,{destinationUrl:"/",reason:lF})}}),Yy.createElement(MR,{menu:P}))}))))}}function AV(e){!function(e){void 0===e&&(e="keyboard-user");const[t,n]=(0,Yy.useState)(!1);(0,Yy.useEffect)((()=>{function i(){t&&(document.body.classList.remove(e),n(!1))}function r(i){"Tab"!==i.key||t||(document.body.classList.add(e),n(!0))}return window.addEventListener("keydown",r),window.addEventListener("mousedown",i),()=>{window.removeEventListener("keydown",r),window.removeEventListener("mousedown",i)}}),[e,t])}();const t=(0,WP.P)(),{voice_chat:n}=OR();return(0,Yy.useEffect)((()=>{const t=document.getElementById("preload-overlay");t.classList.add("loaded");const n=e.scene;n.classList.add(kO.scene);const i=setTimeout((()=>{t.remove()}),500);return()=>{clearTimeout(i),n.classList.remove(kO.scene)}}),[e.scene]),Yy.createElement(WR,{messageDispatch:e.messageDispatch},Yy.createElement(OL,{scene:e.scene},Yy.createElement(EV,aV({breakpoint:t},e,{canVoiceChat:n}))))}EV.propTypes={enterScene:sw().func,exitScene:sw().func,onSendMessage:sw().func,disableAutoExitOnIdle:sw().bool,forcedVREntryType:sw().string,isBotMode:sw().bool,store:sw().object,mediaSearchStore:sw().object,scene:sw().object,authChannel:sw().object,hubChannel:sw().object,linkChannel:sw().object,hub:sw().object,availableVREntryTypes:sw().object,checkingForDeviceAvailability:sw().bool,environmentSceneLoaded:sw().bool,entryDisallowed:sw().bool,roomUnavailableReason:sw().string,hubIsBound:sw().bool,isSupportAvailable:sw().bool,presenceLogEntries:sw().array,presences:sw().object,sessionId:sw().string,subscriptions:sw().object,initialIsFavorited:sw().bool,showSignInDialog:sw().bool,signInMessage:sw().object,onContinueAfterSignIn:sw().func,showSafariMicDialog:sw().bool,onMediaSearchResultEntrySelected:sw().func,onAvatarSaved:sw().func,location:sw().object,history:sw().object,showInterstitialPrompt:sw().bool,onInterstitialPromptClicked:sw().func,performConditionalSignIn:sw().func,hide:sw().bool,showPreload:sw().bool,onPreloadLoadClicked:sw().func,embed:sw().bool,onLoaded:sw().func,activeObject:sw().object,selectedObject:sw().object,breakpoint:sw().string,canVoiceChat:sw().bool},AV.propTypes={scene:sw().object.isRequired,messageDispatch:sw().object,store:sw().object.isRequired};var SV=AV;function xV(e){let{reason:t}=e;return Yy.createElement(IF,{showTerms:k.feature("show_terms"),termsUrl:k.link("terms_of_use",We),showSourceLink:k.feature("show_source_link"),reason:t,contactEmail:k.translation("contact-email")})}xV.propTypes={reason:sw().string.isRequired};var MV=n(71171),PV=n.n(MV);function CV(e,t,n,i,r,o,s){try{var a=e[o](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(i,r)}function kV(e){return function(){var t=this,n=arguments;return new Promise((function(i,r){var o=e.apply(t,n);function s(e){CV(o,i,r,s,a,"next",e)}function a(e){CV(o,i,r,s,a,"throw",e)}s(void 0)}))}}class OV{constructor(e){var t=this;this.setSocket=e=>{this.socket=e},this.signOut=function(){var e=kV((function*(e){e&&(yield e.signOut()),t.store.update({credentials:{token:null,email:null}}),yield t.store.resetToRandomDefaultAvatar(),t._signedIn=!1}));return function(t){return e.apply(this,arguments)}}(),this.store=e,this.socket=null,this._signedIn=!!this.store.state.credentials.token}get email(){return this.store.state.credentials.email}get signedIn(){return this._signedIn}verifyAuthentication(e,t,n){var i=this;const r=this.socket.channel(e);return new Promise(((e,o)=>{r.onError((()=>{r.leave(),o()})),r.join().receive("ok",(()=>{r.on("auth_credentials",function(){var t=kV((function*(t){let{credentials:n,payload:r}=t;yield i.handleAuthCredentials(r.email,n),e()}));return function(e){return t.apply(this,arguments)}}()),r.push("auth_verified",{token:t,payload:n})})).receive("error",o)}))}startAuthentication(e,t){var n=this;return kV((function*(){const i=n.socket.channel(`auth:${PV()()}`);yield new Promise(((e,t)=>i.join().receive("ok",e).receive("error",t)));const r=new Promise((r=>i.on("auth_credentials",function(){var i=kV((function*(i){let{credentials:o}=i;yield n.handleAuthCredentials(e,o,t),r()}));return function(e){return i.apply(this,arguments)}}())));return i.push("auth_request",{email:e,origin:"hubs"}),{authComplete:r}}))()}handleAuthCredentials(e,t,n){var i=this;return kV((function*(){i.store.update({credentials:{email:e,token:t}}),n&&(yield n.signIn(t)),i._signedIn=!0}))()}}function TV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function RV(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?TV(Object(n),!0).forEach((function(t){DV(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):TV(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function DV(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function jV(e,t,n,i,r,o,s){try{var a=e[o](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(i,r)}function LV(e){return function(){var t=this,n=arguments;return new Promise((function(i,r){var o=e.apply(t,n);function s(e){jV(o,i,r,s,a,"next",e)}function a(e){jV(o,i,r,s,a,"throw",e)}s(void 0)}))}}function IV(e,t){return e.getFullYear()==t.getFullYear()&&e.getMonth()==t.getMonth()}const NV=["update_hub","update_hub_promotion","update_roles","close_hub","mute_users","kick_users","amplify_audio"],FV=NV.concat(["tweet","spawn_camera","spawn_drawing","spawn_and_move_media","pin_objects","spawn_emoji","fly","voice_chat","text_chat"]);class BV extends $.EventTarget{constructor(e,t){var n;super(),n=this,this.setPermissionsFromToken=e=>{this.token=e,this._permissions=H()(e),k.setIsAdmin("ret_admin"===this._permissions.postgrest_role),this.dispatchEvent(new CustomEvent("permissions_updated"));const t=new Date(1e3*this._permissions.exp-6e4)-new Date;this.fetchPermissionsTimeout&&clearTimeout(this.fetchPermissionsTimeout),this.fetchPermissionsTimeout=setTimeout(this.fetchPermissions,t)},this.sendEnteringEvent=LV((function*(){n.channel.push("events:entering",{})})),this.sendEnteringCancelledEvent=LV((function*(){n.channel.push("events:entering_cancelled",{})})),this.sendEnteredEvent=LV((function*(){if(!n.channel)return void console.warn("No phoenix channel initialized before room entry.");let e="Screen";if(navigator.getVRDisplays){const t=(yield navigator.getVRDisplays()).find((e=>e.isPresenting));t&&(e=t.displayName)}const t=n.presence.list(((e,t)=>({key:e,entryState:t.metas[t.metas.length-1].presence}))).filter((e=>{let{key:t,entryState:n}=e;return t!==NAF.clientId&&"room"===n})).length,i=RV(RV({},n.getEntryTimingFlags()),{},{initialOccupantCount:t,entryDisplayType:e,userAgent:navigator.userAgent});n.channel.push("events:entered",i)})),this.getEntryTimingFlags=()=>{const e={isNewDaily:!0,isNewMonthly:!0,isNewDayWindow:!0,isNewMonthWindow:!0},t=this.store.state.activity.lastEnteredAt;if(!t)return e;const n=new Date,i=new Date(t),r=n-i;var o,s;return e.isNewDaily=!(IV(o=n,s=i)&&o.getDate()==s.getDate()),e.isNewMonthly=!IV(n,i),e.isNewDayWindow=r>864e5,e.isNewMonthWindow=r>2592e6,e},this.sendObjectSpawnedEvent=e=>{if(!this.channel)return void console.warn("No phoenix channel initialized before object spawn.");const t={object_type:e};this.channel.push("events:object_spawned",t)},this.sendProfileUpdate=()=>{this.channel.push("events:profile_updated",{profile:this.store.state.profile})},this.updateScene=e=>{if(!this._permissions.update_hub)return"unauthorized";this.channel.push("update_scene",{url:e})},this.updateHub=e=>{if(!this._permissions.update_hub)return"unauthorized";this.channel.push("update_hub",e)},this.fetchInvite=()=>new Promise((e=>this.channel.push("fetch_invite",{}).receive("ok",e))),this.revokeInvite=e=>new Promise((t=>this.channel.push("revoke_invite",{hub_invite_id:e}).receive("ok",t))),this.closeHub=()=>{if(!this._permissions.close_hub)return"unauthorized";this.channel.push("close_hub",{})},this.subscribe=e=>{this.channel.push("subscribe",{subscription:e})},this.allowNAFTraffic=e=>{this.channel.push(e?"unblock_naf":"block_naf",{})},this.unsubscribe=e=>new Promise((t=>this.channel.push("unsubscribe",{subscription:e}).receive("ok",t))),this.sendMessage=function(e,t){void 0===t&&(t="chat"),e&&n.channel.push("message",{body:e,type:t})},this._getCreatorAssignmentToken=()=>{const e=this.store.state.creatorAssignmentTokens&&this.store.state.creatorAssignmentTokens.find((e=>e.hubId===this.hubId));return e&&e.creatorAssignmentToken},this.signIn=e=>new Promise(((t,n)=>{const i=this._getCreatorAssignmentToken();this.channel.push("sign_in",{token:e,creator_assignment_token:i}).receive("ok",(e=>{let{perms_token:n}=e;this.setPermissionsFromToken(n),this._signedIn=!0,t()})).receive("error",(e=>{"invalid_token"===e.reason?(console.warn("sign in failed",e),t()):(console.error("sign in failed",e),n())}))})),this.signOut=()=>new Promise(((e,t)=>{this.channel.push("sign_out").receive("ok",LV((function*(){n._signedIn=!1;const t=n.channel.params();delete t.auth_token,delete t.perms_token,yield n.fetchPermissions(),e()}))).receive("error",t)})),this.getHost=()=>new Promise(((e,t)=>{this.channel.push("get_host").receive("ok",(t=>{e(t)})).receive("error",t)})),this.getTwitterOAuthURL=()=>new Promise(((e,t)=>{this.channel.push("oauth",{type:"twitter"}).receive("ok",(t=>{e(t.oauth_url)})).receive("error",(e=>t(new Error(e.reason))))})),this.discordBridges=()=>this.presence&&this.presence.state?ke(this.presence.state):[],this.pin=(e,t,n,i,r)=>{const o={id:e,gltf_node:t};return n&&r&&(o.file_id=n,o.file_access_token=i,o.promotion_token=r),new Promise(((e,t)=>{this.channel.push("pin",o).receive("ok",e).receive("error",t)}))},this.unpin=(e,t)=>{const n={id:e};t&&(n.file_id=t),this.channel.push("unpin",n)},this.fetchPermissions=()=>new Promise(((e,t)=>{this.channel.push("refresh_perms_token").receive("ok",(t=>{this.setPermissionsFromToken(t.perms_token),e({permsToken:t.perms_token,permissions:this._permissions})})).receive("error",t)})),this.mute=e=>this.channel.push("mute",{session_id:e}),this.addOwner=e=>this.channel.push("add_owner",{session_id:e}),this.removeOwner=e=>this.channel.push("remove_owner",{session_id:e}),this.hide=e=>{NAF.connection.adapter.block(e),APP.dialog.block(e),this.channel.push("block",{session_id:e}),this._blockedSessionIds.add(e)},this.unhide=e=>{this._blockedSessionIds.has(e)&&(NAF.connection.adapter.unblock(e),APP.dialog.unblock(e),NAF.connection.entities.completeSync(e),this.channel.push("unblock",{session_id:e}),this._blockedSessionIds.delete(e))},this.isHidden=e=>this._blockedSessionIds.has(e),this.kick=function(){var e=LV((function*(e){APP.dialog.kick(e),n.channel.push("kick",{session_id:e})}));return function(t){return e.apply(this,arguments)}}(),this.requestSupport=()=>this.channel.push("events:request_support",{}),this.favorite=()=>this.channel.push("favorite",{}),this.unfavorite=()=>this.channel.push("unfavorite",{}),this.disconnect=()=>{this.channel&&this.channel.socket.disconnect()},this.store=e,this.hubId=t,this._signedIn=!!this.store.state.credentials.token,this._permissions={},this._blockedSessionIds=new Set,e.addEventListener("profilechanged",this.sendProfileUpdate.bind(this))}get signedIn(){return this._signedIn}can(e){if(!FV.includes(e))throw new Error(`Invalid permission name: ${e}`);return this._permissions&&this._permissions[e]}userCan(e,t){const n=this.presence.state[e];return n?!!n.metas[0].permissions[t]:(console.warn(`userCan: Had no presence state for ${e}`),!1)}canOrWillIfCreator(e){return!(!this._getCreatorAssignmentToken()||!NV.includes(e))||this.can(e)}canEnterRoom(e){return!!e&&(!!this.canOrWillIfCreator("update_hub")||Object.values(this.presence.state).reduce(((e,t)=>{let{metas:n}=t;const i=n[n.length-1];return e+("room"===i.presence||i.context&&i.context.entering?1:0)}),0)<(void 0!==e.room_size?e.room_size:24))}migrateToSocket(e,t){var n=this;return LV((function*(){let i;n.presence&&(i={onJoin:n.presence.caller.onJoin,onLeave:n.presence.caller.onLeave,onSync:n.presence.caller.onSync},n.presence.onJoin((function(){})),n.presence.onLeave((function(){})),n.presence.onSync((function(){}))),n.channel=yield Ce(n.channel,e,t),n.presence=new J.zA(n.channel),i&&(n.presence.onJoin(i.onJoin),n.presence.onLeave(i.onLeave),n.presence.onSync(i.onSync))}))()}migrateToHub(e){var t=this;return LV((function*(){let n;const i=t.channel.socket.channel(`hub:${e}`,APP.hubChannelParamsForPermsToken()),r=yield function(e,t){return Pe(e,t),new Promise(((n,i)=>{t.join().receive("ok",(t=>{e.leave(),e.bindings=[],n(t)})).receive("error",(e=>{t.leave(),i(e)}))}))}(t.channel,i);return t.presence&&(n={onJoin:t.presence.caller.onJoin,onLeave:t.presence.caller.onLeave,onSync:t.presence.caller.onSync},t.presence.onJoin((function(){})),t.presence.onLeave((function(){})),t.presence.onSync((function(){}))),t.channel=i,t.presence=new J.zA(t.channel),t.hubId=r.hubs[0].hub_id,t.setPermissionsFromToken(r.perms_token),n&&(t.presence.onJoin(n.onJoin),t.presence.onLeave(n.onLeave),t.presence.onSync(n.onSync)),r}))()}beginStreaming(){this.channel.push("events:begin_streaming",{})}endStreaming(){this.channel.push("events:end_streaming",{})}beginRecording(){this.channel.push("events:begin_recording",{})}endRecording(){this.channel.push("events:end_recording",{})}raiseHand(){this.channel.push("events:raise_hand",{})}lowerHand(){this.channel.push("events:lower_hand",{})}beginTyping(){this.channel.push("events:begin_typing",{})}endTyping(){this.channel.push("events:end_typing",{})}}function VV(e,t,n,i,r,o,s){try{var a=e[o](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(i,r)}function UV(e){return function(){var t=this,n=arguments;return new Promise((function(i,r){var o=e.apply(t,n);function s(e){VV(o,i,r,s,a,"next",e)}function a(e){VV(o,i,r,s,a,"throw",e)}s(void 0)}))}}function HV(e,t){return zV.apply(this,arguments)}function zV(){return(zV=UV((function*(e,t){return crypto.subtle.deriveKey({name:"ECDH",public:t},e,{name:"AES-CBC",length:256},!0,["encrypt","decrypt"])}))).apply(this,arguments)}function WV(e){return qV.apply(this,arguments)}function qV(){return qV=UV((function*(e){return JSON.stringify(yield crypto.subtle.exportKey("jwk",e))})),qV.apply(this,arguments)}function ZV(e){return GV.apply(this,arguments)}function GV(){return(GV=UV((function*(e){return yield crypto.subtle.importKey("jwk",JSON.parse(e),{name:"ECDH",namedCurve:"P-256"},!0,[])}))).apply(this,arguments)}function YV(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}function QV(e){const t=new Uint8Array(e);let n="";for(let e=0;e<t.byteLength;e++)n+=String.fromCharCode(t[e]);return n}function XV(){return(XV=UV((function*(){const e=yield crypto.subtle.generateKey({name:"ECDH",namedCurve:"P-256"},!0,["deriveKey"]);return{publicKeyString:yield WV(e.publicKey),privateKey:e.privateKey}}))).apply(this,arguments)}function KV(){return(KV=UV((function*(e,t){const n=new Uint8Array(16),i=yield ZV(e),r=yield crypto.subtle.generateKey({name:"ECDH",namedCurve:"P-256"},!0,["deriveKey"]),o=yield WV(r.publicKey),s=yield HV(r.privateKey,i);return{publicKeyString:o,encryptedData:btoa(QV(yield crypto.subtle.encrypt({name:"AES-CBC",iv:n},s,YV(JSON.stringify(t)))))}}))).apply(this,arguments)}function $V(){return($V=UV((function*(e,t,n){const i=new Uint8Array(16),r=yield ZV(e),o=yield HV(t,r),s=YV(atob(n)),a=yield crypto.subtle.decrypt({name:"AES-CBC",iv:i},o,s);return JSON.parse(QV(a))}))).apply(this,arguments)}function JV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function eU(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?JV(Object(n),!0).forEach((function(t){tU(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):JV(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function tU(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const nU=1e4;class iU{constructor(e){this.setSocket=e=>{this.socket=e},this.generateCode=()=>new Promise((e=>{const t=new Promise((n=>{const i=()=>{const r=()=>"ABCDEFGHI"[Math.floor(9*Math.random())],o=`${r()}${r()}${r()}${r()}`;let s=!1,a=!1;const l=this.socket.channel(`link:${o}`,{timeout:nU}),c=()=>{a||l.leave(),a=!0},d=()=>c();l.on("link_expired",(()=>n("expired"))),l.on("presence_state",(n=>{s||(Object.keys(n).length>0?i():(s=!0,e({code:o,cancel:d,onFinished:t})))})),l.on("link_request",(e=>{if(s){const t={path:location.pathname};this.store.state.activity.hasChangedName&&(t.profile=eU({},this.store.state.profile)),t.credentials=eU({},this.store.state.credentials),function(e,t){return KV.apply(this,arguments)}(e.public_key,t).then((t=>{let{publicKeyString:i,encryptedData:r}=t;const o={target_session_id:e.reply_to_session_id,public_key:i,data:r};a||l.push("link_response",o),c(),n("used"),s=!1}))}})),l.join().receive("error",(e=>console.error(e)))};i()}))})),this.attemptLink=e=>new Promise(((t,n)=>{const i=this.socket.channel(`link:${e}`,{timeout:nU});let r=!1;(function(){return XV.apply(this,arguments)})().then((e=>{let{publicKeyString:o,privateKey:s}=e;i.on("presence_state",(e=>{const t=Object.keys(e).length;1===t?(i.push("link_request",{reply_to_session_id:this.socket.params().session_id,public_key:o}),setTimeout((()=>{r||(i.leave(),n(new Error("no_response")))}),nU)):0===t?(i.leave(),n(new Error("failed"))):(console.warn("link code channel already has 2 or more occupants, something fishy is going on."),i.leave(),n(new Error("in_use")))})),i.on("link_response",(e=>{r=!0,i.leave(),function(e,t,n){return $V.apply(this,arguments)}(e.public_key,s,e.data).then(t)})),i.join().receive("ok",(e=>this.socket.params().session_id=e.session_id)).receive("error",(e=>console.error(e)))}))})),this.store=e}}const rU=Q();var oU=n(99477);function sU(e,t){const n=t.boundingData,i=(n[3]-n[0])*(n[4]-n[1])*(n[5]-n[2]);return!(i<.1)&&!(e<100)&&e/i>1e3}function aU(e){if(e.continueGeneration&&e.continueGeneration(),e.count)return!0===sU(e.count,e)||e.count;{const t=aU(e.left);if(!0===t)return!0;const n=aU(e.right);if(!0===n)return!0;const i=t+n;return!0===sU(i,e)||i}}function lU(e){const t=e.boundsTree._roots;for(let e=0;e<t.length;++e)return!0===aU(t[e]);return!1}const cU=function(){const e="shape-helper__",t=[];return function(n){const i=n.object3DMap.mesh;for(;t.length>0;){const{id:e,entity:n}=t.pop();n.removeAttribute(e)}if(console.group("traverseMeshesAndAddShapes"),document.querySelector(["[shape-helper__trimesh]","[shape-helper__heightfield]"]))console.log("heightfield or trimesh found on scene");else{console.log("collision not found in scene");let r=!1;i.traverse((e=>{!e.isMesh||oU.Sky&&e.__proto__==oU.Sky.prototype||e.name.startsWith("Floor_Plan")||e.name.startsWith("Ground_Plane")||!e.geometry.boundsTree||!lU(e.geometry)||(r=!0)}));let o=null;r&&(console.log("mesh contains high triangle density region"),o=document.querySelector("[nav-mesh]")),o?(console.log("mesh density exceeded, using floor plan only"),o.setAttribute(e+"floorPlan",{type:Lm.SHAPE.MESH,margin:.01,fit:Lm.FIT.ALL,includeInvisible:!0}),t.push({id:e+"floorPlan",entity:o})):r?(n.setAttribute(e+"defaultFloor",{type:Lm.SHAPE.BOX,margin:.01,halfExtents:{x:4e3,y:.5,z:4e3},offset:{x:0,y:-.5,z:0},fit:Lm.FIT.MANUAL}),t.push({id:e+"defaultFloor",entity:n}),console.log("adding default floor collision")):(n.setAttribute(e+"environment",{type:Lm.SHAPE.MESH,margin:.01,fit:Lm.FIT.ALL}),t.push({id:e+"environment",entity:n}),console.log("adding mesh shape for all visible meshes"))}console.groupEnd()}}();var dU=n(99477);function uU(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function hU(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?uU(Object(n),!0).forEach((function(t){pU(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):uU(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function pU(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function mU(e,t){return!!e.find((e=>e===t))}function fU(e,t,n,i){let r=[];return r.push(`/${e}`),t&&t.forEach((e=>{r.push(`[${e}]`)})),n&&n.forEach(((e,t)=>{r.push(`[${t}=(${e.join(" | ")})]`)})),i&&i.forEach((e=>r.push(`<${e}>`))),r.join(" ")}const gU="--resize",vU="--recenter",bU="--animate",yU="--no-menu",wU=[gU,vU,bU,yU];function _U(e,t,n){if((n=n.filter((e=>e))).length){const i={src:n[n.length-1],resize:mU(n,gU),recenter:mU(n,vU),animateLoad:mU(n,bU),isObjectMenuTarget:!mU(n,yU)};console.log("Adding media",i);const r=Kh(e,"media",i),o=APP.world.eid2obj.get(r);o.position.copy(t.localToWorld(new dU.Vector3(0,0,-1.5))),o.lookAt(t.getWorldPosition(new dU.Vector3))}else console.log(fU("add",wU,null,["url"]))}const EU="https://raw.githubusercontent.com/mozilla/hubs-sample-assets/main/Hubs%20Components/Exported%20GLB%20Models/",AU=".glb",SU="--scene",xU="--avatar",MU=[SU,xU,...wU];var PU=n(99477);function CU(e,t,n,i,r,o,s){try{var a=e[o](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(i,r)}let kU,OU;class TU extends $.EventTarget{constructor(e,t,n,i,r){var o;super(),o=this,this.log=(e,t)=>{this.receive({type:"log",messageType:e,props:t})},this.dispatch=e=>{if(e.startsWith("/")){const t=e.substring(1).split(/\s+/);this.dispatchCommand(t[0],...t.slice(1)),document.activeElement.blur()}else this.hubChannel.sendMessage(e)},this.dispatchCommand=function(){var e,t=(e=function*(e){const t=o.scene.is("entered");kU=kU||document.getElementById("ui-root");const n=!t&&kU&&kU.firstChild&&kU.firstChild.classList.contains("isGhost");if(!(t||n&&"duck"!==e))return void o.log(vC);const i=document.querySelector("#avatar-rig"),r=[.0625,.125,.25,.5,1,1.5,3,5,7.5,12.5],s=i.object3D.scale;let a,l;const c=o.scene.systems["capture-system"];for(var d=arguments.length,u=new Array(d>1?d-1:0),h=1;h<d;h++)u[h-1]=arguments[h];switch(e){case"fly":o.scene.systems["hubs-systems"].characterController.fly?(o.scene.systems["hubs-systems"].characterController.enableFly(!1),o.log(bC)):o.scene.systems["hubs-systems"].characterController.enableFly(!0)&&o.log(yC);break;case"grow":for(let e=0;e<r.length;e++)if(r[e]>s.x){i.object3D.scale.set(r[e],r[e],r[e]),i.object3D.matrixNeedsUpdate=!0;break}break;case"shrink":for(let e=r.length-1;e>=0;e--)if(s.x>r[e]){i.object3D.scale.set(r[e],r[e],r[e]),i.object3D.matrixNeedsUpdate=!0;break}break;case"leave":o.entryManager.exitScene(),o.remountUI({roomUnavailableReason:jF.left});break;case"oldduck":ek(Ws(location.href,qE)),Math.random()<.01?o.scene.systems["hubs-systems"].soundEffectsSystem.playSoundOneShot(Sm):o.scene.systems["hubs-systems"].soundEffectsSystem.playSoundOneShot(Am);break;case"duck":if((0,z.Z)("newLoader")){const e=document.querySelector("#avatar-pov-node").object3D,t=Kh(APP.world,"media",{src:Ws(location.href,qE),resize:!0,recenter:!0,animateLoad:!0,isObjectMenuTarget:!0}),n=APP.world.eid2obj.get(t);n.position.copy(e.localToWorld(new PU.Vector3(0,0,-1.5))),n.lookAt(e.getWorldPosition(new PU.Vector3))}else ek(Ws(location.href,qE));Math.random()<.01?o.scene.systems["hubs-systems"].soundEffectsSystem.playSoundOneShot(Sm):o.scene.systems["hubs-systems"].soundEffectsSystem.playSoundOneShot(Am);break;case"cube":{const e=document.querySelector("#avatar-pov-node").object3D,t=Kh(APP.world,"cube"),n=APP.world.eid2obj.get(t);n.position.copy(e.localToWorld(new PU.Vector3(0,0,-1.5))),n.lookAt(e.getWorldPosition(new PU.Vector3));break}case"debug":l=document.querySelector("a-scene").systems["hubs-systems"].physicsSystem,l.setDebug(!l.debugEnabled);break;case"vrstats":document.getElementById("stats").components["stats-plus"].toggleVRStats();break;case"scene":u[0]?(yield LE(u[0]))?(a=o.hubChannel.updateScene(u[0]),"unauthorized"===a&&o.log(wC)):o.log(_C):o.hubChannel.canOrWillIfCreator("update_hub")&&o.mediaSearchStore.sourceNavigateWithNoNav("scenes","use");break;case"rename":a=o.hubChannel.rename(u.join(" ")),"unauthorized"===a&&o.log(EC);break;case"capture":if(!c.available()){o.log(AC);break}"stop"===u[0]?c.started()?(c.stop(),o.log(SC)):o.log(MC):c.started()?o.log(PC):(c.start(),o.log(xC));break;case"audioNormalization":if(1===u.length){const e=Number(u[0]);if(isNaN(e))o.log(OC);else{const t=Math.max(0,Math.min(255,e));window.APP.store.update({preferences:{audioNormalization:t}}),e?o.log(CC,{factor:t}):o.log(kC)}}else o.log(TC);break;case"add":{const e=document.querySelector("#avatar-pov-node").object3D;_U(APP.world,e,u)}break;case"respawn":{const e=AFRAME.scenes[0],t=o.scene.systems["hubs-systems"].characterController;!function(e,t,n){t.is("entered")?(0,z.Z)("newLoader")?qd(e,n):console.error("This command only works with the newLoader query string parameter."):console.error("Cannot respawn until you have entered the room.")}(APP.world,e,t)}break;case"test":{const e=document.querySelector("#avatar-pov-node").object3D;!function(e,t,n){var i;(n=n.filter((e=>e))).length?(n[n.length-1]=[EU,n[n.length-1],AU].join(""),mU(n,SU)?function(e){console.log(`Changing scene to ${e}`);const t=APP.hubChannel.updateScene(e);t&&console.error(t)}(n[n.length-1]):mU(n,xU)?(i=n[n.length-1],console.log(`Changing avatar to ${i}`),APP.store.update({profile:hU(hU({},APP.store.state.profile),{avatarId:i})}),AFRAME.scenes[0].emit("avatar_updated")):_U(e,t,n)):console.log(fU("test",MU,null,["AssetName"]))}(APP.world,e,u)}}},function(){var t=this,n=arguments;return new Promise((function(i,r){var o=e.apply(t,n);function s(e){CU(o,i,r,s,a,"next",e)}function a(e){CU(o,i,r,s,a,"throw",e)}s(void 0)}))});return function(e){return t.apply(this,arguments)}}(),this.scene=e,this.entryManager=t,this.hubChannel=n,this.remountUI=i,this.mediaSearchStore=r,this.presenceLogEntries=[]}addToPresenceLog(e){e.key=Date.now().toString();const t=this.presenceLogEntries.length>0&&this.presenceLogEntries[this.presenceLogEntries.length-1];t&&"permission"===e.type&&"permission"===t.type&&t.body.permission===e.body.permission&&parseInt(e.key)-parseInt(t.key)<1e4&&this.presenceLogEntries.pop(),this.presenceLogEntries.push(e),this.remountUI({presenceLogEntries:this.presenceLogEntries}),"chat"===e.type&&this.scene.is("loaded")&&this.scene.systems["hubs-systems"].soundEffectsSystem.playSoundOneShot(xm),setTimeout((()=>{e.expired=!0,this.remountUI({presenceLogEntries:this.presenceLogEntries}),setTimeout((()=>{this.presenceLogEntries.splice(this.presenceLogEntries.indexOf(e),1),this.remountUI({presenceLogEntries:this.presenceLogEntries})}),1e3)}),2e4)}receive(e){D()||(this.addToPresenceLog(e),this.dispatchEvent(new CustomEvent("message",{detail:e})))}}function RU(e,t,n,i,r,o,s){try{var a=e[o](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(i,r)}function DU(e){return function(){var t=this,n=arguments;return new Promise((function(i,r){var o=e.apply(t,n);function s(e){RU(o,i,r,s,a,"next",e)}function a(e){RU(o,i,r,s,a,"throw",e)}s(void 0)}))}}function jU(e){if(!e)return;if(!Kl(e))return void console.warn(`Could not parse URL. Ignoring pasted text:\n${e}`);const t=Kh(APP.world,"media",{src:e,recenter:!0,resize:!(0,z.Z)("noResize"),animateLoad:!0,isObjectMenuTarget:!0}),n=document.querySelector("#avatar-pov-node").object3D,i=APP.world.eid2obj.get(t);i.position.copy(n.localToWorld(new wt.Vector3(0,0,-1.5))),i.lookAt(n.getWorldPosition(new wt.Vector3))}function LU(e){return IU.apply(this,arguments)}function IU(){return(IU=DU((function*(e){for(const t of e){const e=t.type||Gs(t.name),n=yield Ll(t,e).then((function(e){const t=new URL(e.origin);return t.searchParams.set("token",e.meta.access_token),window.APP.store.update({uploadPromotionTokens:[{fileId:e.file_id,promotionToken:e.meta.promotion_token}]}),{src:t.href,recenter:!0,resize:!(0,z.Z)("noResize"),animateLoad:!0,isObjectMenuTarget:!0}})).catch((e=>(console.error("Media upload failed",e),{src:"error",recenter:!0,resize:!(0,z.Z)("noResize"),animateLoad:!0,isObjectMenuTarget:!0}))),i=Kh(APP.world,"media",n),r=document.querySelector("#avatar-pov-node").object3D,o=APP.world.eid2obj.get(i);o.position.copy(r.localToWorld(new wt.Vector3(0,0,-1.5))),o.lookAt(r.getWorldPosition(new wt.Vector3))}}))).apply(this,arguments)}function NU(){return(NU=DU((function*(e){if(AFRAME.scenes[0].is("entered")&&(!e.target.matches("input, textarea")&&"true"!==e.target.contentEditable||document.activeElement!==e.target)&&e.clipboardData)return e.preventDefault(),e.clipboardData&&e.clipboardData.files&&e.clipboardData.files.length?LU(e.clipboardData.files):void jU(e.clipboardData.getData("text"))}))).apply(this,arguments)}(0,z.Z)("newLoader")&&(document.addEventListener("paste",(function(e){return NU.apply(this,arguments)})),document.addEventListener("drop",(function(e){var t,n,i;if(!AFRAME.scenes[0].is("entered"))return;if((0,z.Z)("debugLocalScene")){var r;if(URL.revokeObjectURL(OU),null===(r=e.dataTransfer)||void 0===r||!r.files.length)return;const t=URL.createObjectURL(e.dataTransfer.files[0]);return APP.hubChannel.updateScene(t),void(OU=t)}const o=null===(t=e.dataTransfer)||void 0===t?void 0:t.files;if(o&&o.length)return e.preventDefault(),LU(o);const s=(null===(n=e.dataTransfer)||void 0===n?void 0:n.getData("url"))||(null===(i=e.dataTransfer)||void 0===i?void 0:i.getData("text"));return s?(e.preventDefault(),jU(s)):void 0})));var FU=n(99477);function BU(e,t,n,i,r,o,s){try{var a=e[o](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(i,r)}function VU(e){return function(){var t=this,n=arguments;return new Promise((function(i,r){var o=e.apply(t,n);function s(e){BU(o,i,r,s,a,"next",e)}function a(e){BU(o,i,r,s,a,"throw",e)}s(void 0)}))}}const UU=(0,z.Z)("bot"),HU=AFRAME.utils.device.isMobile(),zU=q(),WU=AFRAME.utils.device.isMobileVR(),qU=(0,z.Z)("debug"),ZU=new URLSearchParams(location.search),GU=(0,z.Z)("newLoader");class YU{constructor(e,t,n){var i=this;this.init=()=>{this.whenSceneLoaded((()=>{console.log("Scene is loaded so setting up controllers"),this.rightCursorController.components["cursor-controller"].enabled=!1,this.leftCursorController.components["cursor-controller"].enabled=!1,this.mediaDevicesManager=APP.mediaDevicesManager,this._setupBlocking()}))},this.hasEntered=()=>this._entered,this.enterScene=function(){var e=VU((function*(e,t){if(console.log("Entering scene..."),document.getElementById("viewing-camera").removeAttribute("scene-preview-camera"),qU&&NAF.connection.adapter.session&&(NAF.connection.adapter.session.options.verbose=!0),e&&(i.scene.addState("vr-entered"),"getVRDisplays"in navigator&&navigator.getVRDisplays(),yield Ob(!0)),GU?qd(APP.world,i.scene.systems["hubs-systems"].characterController):i.scene.systems["hubs-systems"].waypointSystem.moveToSpawnPoint(),(HU||zU||(0,z.Z)("force_enable_touchscreen"))&&i.avatarRig.setAttribute("virtual-gamepad-controls",{}),i._setupPlayerRig(),i._setupKicking(),i._setupMedia(),i._setupCamera(),!(0,z.Z)("offline")){if(i._spawnAvatar(),i.scene.systems["hubs-systems"].soundEffectsSystem.playSoundOneShot(Em),UU)return i._runBot(),i.scene.addState("entered"),void i.hubChannel.sendEnteredEvent();i.scene.classList.remove("hand-cursor"),i.scene.classList.add("no-cursor"),i.rightCursorController.components["cursor-controller"].enabled=!0,i.leftCursorController.components["cursor-controller"].enabled=!0,i._entered=!0,VU((function*(){for(;e&&!i.scene.renderer.xr.isPresenting;)yield Ji();i.hubChannel.sendEnteredEvent().then((()=>{i.store.update({activity:{lastEnteredAt:(new Date).toISOString()}})}))}))(),setTimeout((()=>i.store.bumpEntryCount()),3e4),i.scene.addState("entered"),APP.mediaDevicesManager.micEnabled=!t}}));return function(t,n){return e.apply(this,arguments)}}(),this.whenSceneLoaded=e=>{this.scene.hasLoaded?(console.log("Scene already loaded so callback invoked directly"),e()):(console.log("Scene not yet loaded so callback is deferred"),this.scene.addEventListener("loaded",e))},this.enterSceneWhenLoaded=(e,t)=>{this.whenSceneLoaded((()=>this.enterScene(e,t)))},this.exitScene=()=>{this.scene.exitVR(),APP.dialog&&APP.dialog.localMediaStream&&APP.dialog.localMediaStream.getTracks().forEach((e=>e.stop())),this.hubChannel&&this.hubChannel.disconnect(),this.scene.renderer&&this.scene.renderer.setAnimationLoop(null),this.scene.parentNode.removeChild(this.scene)},this._setupPlayerRig=()=>{this.scene.addEventListener("avatar_updated",(()=>this._setPlayerInfoFromProfile(!0))),D()||(this._setPlayerInfoFromProfile(),this.store.addEventListener("statechanged",(()=>this._setPlayerInfoFromProfile())));const e=parseInt(ZU.get("avatar_scale"),10);e&&this.avatarRig.setAttribute("scale",{x:e,y:e,z:e})},this._setPlayerInfoFromProfile=VU((function*(e){void 0===e&&(e=!1);const t=i.store.state.profile.avatarId;if(!e&&i._lastFetchedAvatarId===t)return;i._lastFetchedAvatarId=t;const n=yield Dg(t);i.avatarRig.setAttribute("player-info",{avatarSrc:n,avatarType:Cg(t)})})),this._setupKicking=()=>{document.body.addEventListener("kicked",(e=>{let{detail:t}=e;const{clientId:n}=t,{entities:i}=NAF.connection.entities;for(const e in i){const t=i[e];NAF.utils.getCreator(t)===n&&(t.components.networked.data.persistent?(NAF.utils.takeOwnership(t),window.APP.pinningHelper.unpinElement(t),t.parentNode.removeChild(t)):NAF.entities.removeEntity(e))}}))},this._setupBlocking=()=>{document.body.addEventListener("blocked",(e=>{NAF.connection.entities.removeEntitiesOfClient(e.detail.clientId)})),document.body.addEventListener("unblocked",(e=>{NAF.connection.entities.completeSync(e.detail.clientId,!0)}))},this._setupMedia=()=>{const e=(e,t)=>{if(!this.hubChannel.can("spawn_and_move_media"))return;const n={x:0,y:0,z:-1.5},{entity:i,orientation:r}=Nl(e,"#interactable-media",t,null,!(e instanceof MediaStream),!0);return r.then((e=>{i.setAttribute("offset-relative-to",{target:"#avatar-pov-node",offset:n,orientation:e})})),i},t=(t,n)=>{GU?(console.warn("Spawning newLoader object using `spawnMediaInFrontOfPlayer`. This codepath should likely be made more direct.",t,n),"string"==typeof t?jU(t):LU([t])):e(t,n).eid};if(this.scene.addEventListener("add_media",(e=>{const n=e.detail instanceof File?rl:il;t(e.detail,n)})),this.scene.addEventListener("object_spawned",(e=>{this.hubChannel.sendObjectSpawnedEvent(e.detail.objectType)})),this.scene.addEventListener("action_spawn",(()=>{Cb(!1,(()=>window.APP.mediaSearchStore.pushExitMediaBrowserHistory())),window.APP.mediaSearchStore.sourceNavigateToDefaultSource()})),this.scene.addEventListener("action_kick_client",(e=>{let{detail:{clientId:t}}=e;this.performConditionalSignIn((()=>this.hubChannel.can("kick_users")),VU((function*(){return yield window.APP.hubChannel.kick(t)})),ZS.kickUser)})),this.scene.addEventListener("action_mute_client",(e=>{let{detail:{clientId:t}}=e;this.performConditionalSignIn((()=>this.hubChannel.can("mute_users")),(()=>window.APP.hubChannel.mute(t)),ZS.muteUser)})),this.scene.addEventListener("action_vr_notice_closed",(()=>function(){return Db.apply(this,arguments)}())),!GU){let e;document.addEventListener("paste",(e=>{if((e.target.matches("input, textarea")||"true"===e.target.contentEditable)&&document.activeElement===e.target)return;const n=document.querySelector(".ui-root");if(n&&n.classList.contains("in-modal-or-overlay"))return;const i=e.clipboardData.getData("text"),r=e.clipboardData.files&&e.clipboardData.files;if(i)t(i,il);else for(const e of r)t(e,ol)})),document.addEventListener("drop",(n=>{if(n.preventDefault(),(0,z.Z)("debugLocalScene")){URL.revokeObjectURL(e);const t=URL.createObjectURL(n.dataTransfer.files[0]);return this.hubChannel.updateScene(t),void(e=t)}let i=n.dataTransfer.getData("url");if(!i)try{i=new URL(n.dataTransfer.getData("text")).href}catch(n){}const r=n.dataTransfer.files;if(i)t(i,il);else for(const e of r)t(e,rl)}))}let n;document.addEventListener("dragover",(e=>e.preventDefault()));let r=!1;const o=(t,i,o)=>{r=!1,i&&("avatar"===o?this.avatarRig.setAttribute("player-info",{isSharingAvatarCamera:!0}):(n=e(this.mediaDevicesManager.mediaStream,void 0),n.setAttribute("emit-scene-event-on-remove",`event:${Ne.VIDEO_SHARE_ENDED}`)),this.scene.emit("share_video_enabled",{source:t?Be.SCREEN:Be.CAMERA}),this.scene.addState("sharing_video"))},s=e=>{console.error(e),r=!1,this.scene.emit("share_video_failed")};this.scene.addEventListener("action_share_camera",(e=>{var t;r||(r=!0,this.mediaDevicesManager.startVideoShare({isDisplayMedia:!1,target:null===(t=e.detail)||void 0===t?void 0:t.target,success:o,error:s}))})),this.scene.addEventListener("action_share_screen",(()=>{r||(r=!0,this.mediaDevicesManager.startVideoShare({isDisplayMedia:!0,target:null,success:o,error:s}))})),this.scene.addEventListener(Ne.VIDEO_SHARE_ENDED,VU((function*(){r||(r=!0,n&&n.parentNode&&(NAF.utils.takeOwnership(n),n.parentNode.removeChild(n)),yield i.mediaDevicesManager.stopVideoShare(),n=null,i.avatarRig.setAttribute("player-info",{isSharingAvatarCamera:!1}),i.scene.emit("share_video_disabled"),i.scene.removeState("sharing_video"),r=!1)}))),this.scene.addEventListener(Ne.MIC_SHARE_ENDED,VU((function*(){yield i.mediaDevicesManager.stopMicShare()}))),this.scene.addEventListener("action_selected_media_result_entry",function(){var e=VU((function*(e){const{entry:n,selectAction:i}=e.detail;if("spawn"!==i)return;const r=Rb()&&!WU;yield Ob(),r?setTimeout((()=>{t(n.url,il)}),3e3):t(n.url,il)}));return function(t){return e.apply(this,arguments)}}()),this.mediaSearchStore.addEventListener("media-exit",(()=>{Ob()}))},this._setupCamera=()=>{this.scene.addEventListener("action_toggle_camera",(()=>{const e=qo(APP.world,qn);if(e)(0,Ot.removeEntity)(APP.world,e),this.scene.removeState("camera");else{const e=document.querySelector("#avatar-pov-node").object3D,t=Kh(APP.world,"camera");(0,Ot.addComponent)(APP.world,qn,t);const n=APP.world.eid2obj.get(t);n.position.copy(e.localToWorld(new FU.Vector3(0,0,-1.5))),n.lookAt(e.getWorldPosition(new FU.Vector3)),this.scene.addState("camera")}}))},this._spawnAvatar=()=>{this.avatarRig.setAttribute("networked","template: #remote-avatar; attachTemplateToLocal: false;"),this.avatarRig.setAttribute("networked-avatar",""),this.avatarRig.emit("entered")},this._runBot=VU((function*(){const e=document.createElement("audio");let t,n;do{t=document.querySelector("#bot-audio-input"),n=document.querySelector("#bot-data-input"),yield Ji()}while(!t||!n);const r=()=>{e.loop=!0,e.muted=!1,e.crossorigin="anonymous",e.src=URL.createObjectURL(t.files[0]),document.body.appendChild(e)};t.files&&t.files.length>0?r():t.onchange=r;const o=document.querySelector("#avatar-pov-node"),s=document.querySelector("#player-left-controller"),a=document.querySelector("#player-right-controller"),l=()=>{fetch(URL.createObjectURL(n.files[0])).then((e=>e.json())).then((e=>{o.setAttribute("replay",""),o.components.replay.poses=e.camera.poses,s.setAttribute("replay",""),s.components.replay.poses=e.left.poses,s.removeAttribute("visibility-by-path"),s.removeAttribute("track-pose"),s.setAttribute("visible",!0),a.setAttribute("replay",""),a.components.replay.poses=e.right.poses,a.removeAttribute("visibility-by-path"),a.removeAttribute("track-pose"),a.setAttribute("visible",!0)}))};n.files&&n.files.length>0?l():n.onchange=l,yield new Promise((t=>e.addEventListener("canplay",t)));const c=e.captureStream?e.captureStream():e.mozCaptureStream?e.mozCaptureStream():null;if(c){let e=Number(ZU.get("audio_volume")||"1.0");isNaN(e)&&(e=1);const t=FU.AudioContext.getContext(),n=t.createMediaStreamSource(c),i=t.createMediaStreamDestination(),r=t.createGain();n.connect(r),r.connect(i),r.gain.value=e,AFRAME.scenes[0].systems["hubs-systems"].audioSystem.addStreamToOutboundAudio("microphone",i.stream)}const d=function(){var t=VU((function*(){yield APP.dialog.setLocalMediaStream(i.mediaDevicesManager.mediaStream),e.play()}));return function(){return t.apply(this,arguments)}}();APP.dialog._sendTransport?d():i.scene.addEventListener("didConnectToDialog",d)})),this.hubChannel=e,this.authChannel=t,this.store=window.APP.store,this.mediaSearchStore=window.APP.mediaSearchStore,this.scene=document.querySelector("a-scene"),this.rightCursorController=document.getElementById("right-cursor-controller"),this.leftCursorController=document.getElementById("left-cursor-controller"),this.avatarRig=document.getElementById("avatar-rig"),this._entered=!1,this.performConditionalSignIn=()=>{},this.history=n}}function QU(e,t,n,i,r,o,s){try{var a=e[o](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(i,r)}function XU(e){return function(){var t=this,n=arguments;return new Promise((function(i,r){var o=e.apply(t,n);function s(e){QU(o,i,r,s,a,"next",e)}function a(e){QU(o,i,r,s,a,"throw",e)}s(void 0)}))}}function KU(e){const t=(e+"=".repeat((4-e.length%4)%4)).replace(/-/g,"+").replace(/_/g,"/"),n=window.atob(t),i=new Uint8Array(n.length);for(let e=0;e<n.length;++e)i[e]=n.charCodeAt(e);return i}class $U{constructor(e){var t=this;this.setHubChannel=e=>{this.hubChannel=e},this.setRegistration=e=>{console.log("Service worker registered"),this.registration=e},this.setRegistrationFailed=e=>{console.error("Service worker registration failed",e),this.registration=null},this.setVapidPublicKey=e=>{this.vapidPublicKey=e},this.setSubscribed=e=>{this._isSubscribed=e},this.isSubscribed=()=>this._isSubscribed,this.getCurrentEndpoint=XU((function*(){if(!navigator.serviceWorker)return null;const e=performance.now();for(;void 0===t.registration&&performance.now()-e<5e3;)yield Ji();if(performance.now()-e>=5e3&&console.warn("Service worker registration timed out."),!t.registration||!t.registration.pushManager)return null;for(;void 0===t.vapidPublicKey;)yield Ji();if(null===t.vapidPublicKey)return null;try{const e=KU(t.vapidPublicKey);if("granted"!==(yield t.registration.pushManager.permissionState({userVisibleOnly:!0,applicationServerKey:e})))return null}catch(e){return null}const n=yield t.registration.pushManager.getSubscription();return n?n.endpoint:null})),this.toggle=XU((function*(){if(t.registration){if(t._isSubscribed){const e=yield t.registration.pushManager.getSubscription(),n=yield t.hubChannel.unsubscribe(e);n&&!1===n.has_remaining_subscriptions&&e.unsubscribe()}else{let e=yield t.registration.pushManager.getSubscription();if(!e){const n=KU(t.vapidPublicKey);e=yield t.registration.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:n})}t.hubChannel.subscribe(e)}t._isSubscribed=!t._isSubscribed}})),this.hubId=e}register(){if(navigator.serviceWorker)try{navigator.serviceWorker.register("/hub.service.js").then((()=>{navigator.serviceWorker.ready.then((e=>this.setRegistration(e))).catch((e=>this.setRegistrationFailed(e)))})).catch((e=>this.setRegistrationFailed(e)))}catch(e){this.setRegistrationFailed(e)}else this.setRegistrationFailed("Not supported")}}var JU=n(99477);const{Pathfinding:eH}=n(56594);function tH(e,t){if(!1===t(e))return;const n=e.children;for(let e=0;e<n.length;e++)tH(n[e],t)}AFRAME.registerSystem("nav",{init:function(){this.pathfinder=new eH,this.mesh=null,this.el.addEventListener("reset_scene",this.removeNavMeshData.bind(this)),this.el.addEventListener("leaving_loading_environment",this.removeNavMeshData.bind(this))},loadMesh:function(e,t){this.mesh&&(console.error("tried to load multiple nav meshes"),this.removeNavMeshData());const n=e.geometry.clone();e.updateMatrices(),n.applyMatrix4(e.matrixWorld),this.pathfinder.setZoneData(t,eH.createZone(n)),this.mesh=e,this.el.sceneEl.emit("nav-mesh-loaded"),(0,z.Z)("debugNavmesh")&&(this.helperMesh=new JU.Mesh(n,new JU.MeshBasicMaterial({wireframe:!0})),this.el.sceneEl.object3D.add(this.helperMesh))},removeNavMeshData(){var e,t;this.mesh&&this.mesh.geometry&&this.mesh.geometry.dispose&&this.mesh._hubs_audio_debug_prev_material&&(this.mesh.material=this.mesh._hubs_audio_debug_prev_material,this.mesh._hubs_audio_debug_prev_material=null),this.helperMesh&&(null===(e=this.helperMesh.material)||void 0===e||e.dispose(),null===(t=this.helperMesh.geometry)||void 0===t||t.dispose(),this.helperMesh.removeFromParent(),this.helperMesh=null),this.mesh=null,this.pathfinder.zones={}}}),n(34462);var nH=n(99477);const iH=new nH.Vector3,rH=new nH.Vector3,oH=(0,z.Z)("debug"),sH=AFRAME.utils.device.isMobileVR();function aH(e){const t=new nH.SphereBufferGeometry(e,10,10),n=new nH.WireframeGeometry(t),i=new nH.LineSegments(n);return i.material.opacity=.5,i.material.transparent=!0,i}AFRAME.registerSystem("personal-space-bubble",{schema:{debug:{default:!1},enabled:{default:!0}},init(){this.invaders=[],this.bubbles=[],this.tickCount=0,this._updateInvaders=this._updateInvaders.bind(this)},registerBubble(e){this.bubbles.push(e)},unregisterBubble(e){const t=this.bubbles.indexOf(e);-1!==t&&this.bubbles.splice(t,1)},registerInvader(e){NAF.utils.getNetworkedEntity(e.el).then((t=>{NAF.utils.getNetworkOwner(t)!==NAF.clientId&&this.invaders.push(e)}))},unregisterInvader(e){const t=this.invaders.indexOf(e);-1!==t&&this.invaders.splice(t,1)},update(){for(let e=0;e<this.bubbles.length;e++)this.bubbles[e].updateDebug();for(let e=0;e<this.invaders.length;e++)this.invaders[e].updateDebug(),this.data.enabled||this.invaders[e].setInvading(!1);this.data.enabled?this.el.addState("spacebubble"):this.el.removeState("spacebubble")},tick(){this._updateInvaders(),this.tickCount++},_updateInvaders:function(){const e=[],t=(t,n,i)=>{const r=n[t];iH.setFromMatrixPosition(r.el.object3D.matrixWorld);const o=rH.distanceToSquared(iH),s=i.data.radius+r.data.radius;o<s*s&&(e[t]=!0)},n=(t,n)=>{n[t].invading!==e[t]&&n[t].setInvading(e[t])};return function(){if(this.data.enabled&&0!==this.invaders.length){e.length=0;for(let t=0;t<this.invaders.length;t++)this.invaders[t].el.object3D.updateMatrices(),e[t]=!1;for(let e=0;e<this.bubbles.length;e++){const n=this.bubbles[e];if(n.el.object3D.updateMatrices(),rH.setFromMatrixPosition(n.el.object3D.matrixWorld),sH)t(this.tickCount%this.invaders.length,this.invaders,n);else for(let e=0;e<this.invaders.length;e++)t(e,this.invaders,n)}if(sH)n(this.tickCount%this.invaders.length,this.invaders);else for(let e=0;e<this.invaders.length;e++)n(e,this.invaders)}}}()});const lH="psb-debug";AFRAME.registerComponent("personal-space-invader",{schema:{radius:{type:"number",default:.1},useMaterial:{default:!1},debug:{default:!1},invadingOpacity:{default:.3}},init(){this.el.sceneEl.systems["personal-space-bubble"].registerInvader(this),this.data.useMaterial&&(this.gltfRootEl=function(e){for(;e&&(!e.components||!e.components["gltf-model-plus"]);)e=e.parentNode;return e}(this.el)),this.invading=!1,this.alwaysHidden=!1},update(){this.radiusSquared=this.data.radius*this.data.radius,this.updateDebug()},setAlwaysHidden(e){this.alwaysHidden=e,this.applyInvasionToMesh(this.invading)},updateDebug(){this.el.sceneEl.systems["personal-space-bubble"].data.debug||this.data.debug?!this.el.object3DMap[lH]&&this.el.setObject3D(lH,aH(this.data.radius)):this.el.object3DMap[lH]&&this.el.removeObject3D(lH)},remove(){this.el.sceneEl.systems["personal-space-bubble"].unregisterInvader(this)},setInvading(e){this.invading!==e&&(this.applyInvasionToMesh(e),this.invading=e)},disable(){this.invading&&this.applyInvasionToMesh(!1),this.disabled=!0},enable(){this.disabled=!1,this.applyInvasionToMesh(this.invading)},applyInvasionToMesh(e){this.disabled||(this.gltfRootEl&&this.gltfRootEl.object3DMap.mesh&&!this.alwaysHidden?tH(this.gltfRootEl.object3DMap.mesh,(t=>{if(t.el&&(0,Ot.hasComponent)(APP.world,jn,t.el.eid))return!1;t.material&&mo(t,(t=>{let n=t.userData.originalProps;t.userData.originalProps||(n=t.userData.originalProps={opacity:t.opacity,transparent:t.transparent,format:t.format,blending:t.blending,side:t.side}),t.opacity=e?this.data.invadingOpacity:n.opacity,t.transparent=e||n.transparent,t.format=e?nH.RGBAFormat:n.format,t.blending=e?nH.NormalBlending:n.blending,t.side=e?nH.DoubleSide:n.side}))})):this.el.object3D.visible=!e&&!this.alwaysHidden)}}),AFRAME.registerComponent("personal-space-bubble",{schema:{radius:{type:"number",default:.8},debug:{default:!1}},init(){this.system.registerBubble(this)},update(){this.radiusSquared=this.data.radius*this.data.radius,this.updateDebug()},updateDebug(){oH&&(this.system.data.debug||this.data.debug?!this.el.object3DMap[lH]&&this.el.setObject3D(lH,aH(this.data.radius)):this.el.object3DMap[lH]&&this.el.removeObject3D(lH))},remove(){this.system.unregisterBubble(this)}}),n(48711),n(86767),n(8550),n(10713);const cH=new URLSearchParams(location.search),dH=1e3*(parseInt(cH.get("idle_timeout"),10)||7200),uH=zm.actions.characterAcceleration,hH=[zm.actions.startGazeTeleport,zm.actions.rightHand.startTeleport,zm.actions.leftHand.startTeleport,zm.actions.snapRotateRight,zm.actions.snapRotateLeft,zm.actions.cursor.right.grab,zm.actions.cursor.left.grab,zm.actions.rightHand.grab,zm.actions.leftHand.grab,zm.actions.angularVelocity];AFRAME.registerSystem("idle-detector",{init(){this.resetTimeout=this.resetTimeout.bind(this),this.idleTimeout=null,this.lastInputCheck=0;const e=["click","pointerdown","touchstart","keyup"];for(const t of e)window.addEventListener(t,this.resetTimeout);this.resetTimeout()},resetTimeout(){this.idleTimeout&&clearTimeout(this.idleTimeout),this.idleTimeout=setTimeout(this.onIdleTimeout,dH),window.dispatchEvent(new CustomEvent("activity_detected"))},onIdleTimeout(){window.dispatchEvent(new CustomEvent("idle_detected"))},tick(e){if(e-this.lastInputCheck<1e3)return;const t=this.el.systems.userinput;let n=!1;for(const e of hH)n=n||!!t.get(e);const i=t.get(uH);(n||i&&i[0]||i&&i[1])&&this.resetTimeout()},remove(){}}),AFRAME.registerSystem("pen-tools",{init(){this.penEls=[],this.updateMyPen=this.updateMyPen.bind(this),L().then((()=>{this.updateMyPen()}))},register(e){this.penEls.push(e),e.addEventListener("ownership-changed",this.updateMyPen),this.updateMyPen()},deregister(e){this.penEls.splice(this.penEls.indexOf(e),1),e.removeEventListener("ownership-changed",this.updateMyPen),this.updateMyPen()},getMyPen(){return this.myPen},updateMyPen(){this.myPen=this.penEls.find(NAF.utils.isMine),this.myPen?this.sceneEl.addState("pen"):this.sceneEl.removeState("pen")}});const pH="global",mH="inputFocused",fH="rightCursorHoveringOnPen",gH="rightCursorHoveringOnCamera",vH="rightCursorHoveringOnInteractable",bH="rightCursorHoveringOnUI",yH="rightCursorHoveringOnVideo",wH="rightCursorHoveringOnNothing",_H="rightCursorHoldingPen",EH="rightCursorHoldingCamera",AH="rightCursorHoldingInteractable",SH="rightCursorHoldingUI",xH="rightCursorHoldingNothing",MH="leftCursorHoveringOnPen",PH="leftCursorHoveringOnCamera",CH="leftCursorHoveringOnInteractable",kH="leftCursorHoveringOnUI",OH="leftCursorHoveringOnVideo",TH="leftCursorHoveringOnNothing",RH="leftCursorHoldingPen",DH="leftCursorHoldingCamera",jH="leftCursorHoldingInteractable",LH="leftCursorHoldingUI",IH="leftCursorHoldingNothing",NH="rightHandTeleporting",FH="rightHandHoveringOnPen",BH="rightHandHoveringOnCamera",VH="rightHandHoveringOnInteractable",UH="rightHandHoveringOnNothing",HH="rightHandHoldingPen",zH="rightHandHoldingCamera",WH="rightHandHoldingInteractable",qH="leftHandTeleporting",ZH="leftHandHoveringOnPen",GH="leftHandHoveringOnCamera",YH="leftHandHoveringOnInteractable",QH="leftHandHoldingPen",XH="leftHandHoldingCamera",KH="leftHandHoldingInteractable",$H="leftHandHoveringOnNothing",JH="debugUserInput",ez="inspecting",tz={[WheelEvent.DOM_DELTA_PIXEL]:500,[WheelEvent.DOM_DELTA_LINE]:10,[WheelEvent.DOM_DELTA_PAGE]:2},nz=function(){let e;return function(){return e=e||document.getElementById("ui-root"),e&&e.children[0]&&e.children[0].classList.contains("in-modal-or-overlay")||window.APP.preferenceScreenIsVisible}}();class iz{constructor(){this.events=[],this.coords=[0,0],this.movementXY=[0,0],this.buttonLeft=!1,this.buttonRight=!1,this.buttonMiddle=!1,this.wheel=0;const e=this.events.push.bind(this.events);this.canvas=document.querySelector("canvas"),this.canvas.addEventListener("contextmenu",(e=>{if(2===e.button)return e.preventDefault(),e.stopPropagation(),!1})),["mousedown","wheel"].map((t=>this.canvas.addEventListener(t,e,{passive:!1}))),["mousemove","mouseup"].map((t=>window.addEventListener(t,e,{passive:!1}))),document.addEventListener("wheel",(e=>{document.activeElement.classList.contains("a-canvas")&&e.preventDefault()}),{passive:!1})}process(e){if("wheel"===e.type)return this.wheel+=(e.deltaX+e.deltaY)/tz[e.deltaMode],!0;const t=0===e.button,n=1===e.button,i=2===e.button;if(this.coords[0]=e.clientX/this.canvas.clientWidth*2-1,this.coords[1]=-e.clientY/this.canvas.clientHeight*2+1,this.movementXY[0]+=e.movementX,this.movementXY[1]+=e.movementY,"mousedown"===e.type&&t)this.mouseDownLeftThisFrame=!0,this.buttonLeft=!0;else if("mousedown"===e.type&&i)this.mouseDownRightThisFrame=!0,this.buttonRight=!0;else if("mousedown"===e.type&&n)this.mouseDownMiddleThisFrame=!0,this.buttonMiddle=!0;else if("mouseup"===e.type&&t){if(this.mouseDownLeftThisFrame)return!1;this.buttonLeft=!1}else if("mouseup"===e.type&&i){if(this.mouseDownRightThisFrame)return!1;this.buttonRight=!1}else if("mouseup"===e.type&&n){if(this.mouseDownMiddleThisFrame)return!1;this.buttonMiddle=!1}return!0}write(e){this.movementXY[0]=0,this.movementXY[1]=0,this.wheel=0,this.didStopProcessingEarly=!1,this.mouseDownLeftThisFrame=!1,this.mouseDownRightThisFrame=!1,this.mouseDownMiddleThisFrame=!1;for(let e=0;e<this.events.length;e++){const t=this.events[e];if(!this.process(t)){this.didStopProcessingEarly=!0,this.events.splice(0,e);break}}this.didStopProcessingEarly||(this.events.length=0),e.setVector2(zm.device.mouse.coords,this.coords[0],this.coords[1]),e.setVector2(zm.device.mouse.movementXY,this.movementXY[0],this.movementXY[1]),e.setValueType(zm.device.mouse.buttonLeft,this.buttonLeft),e.setValueType(zm.device.mouse.buttonRight,this.buttonRight),e.setValueType(zm.device.mouse.buttonMiddle,this.buttonMiddle),e.setValueType(zm.device.mouse.wheel,this.wheel)}}function rz(e){return{items:e||[],has(e){return-1!==this.items.indexOf(e)},add(e){this.has(e)||this.items.push(e)},delete(e){const t=this.items.indexOf(e);-1!==t&&(this.items[t]=this.items[this.items.length-1],this.items.pop())},clear(){this.items.length=0}}}window.oncontextmenu=e=>{nz()||e.preventDefault()};const oz={KeyW:"w",KeyA:"a",KeyS:"s",KeyD:"d",KeyQ:"q",KeyE:"e"};class sz{constructor(){this.seenKeys=new rz,this.keys={},this.events=[],["keydown","keyup"].map((e=>document.addEventListener(e,(e=>{if(e.key)return this.events.push(e),"keydown"===e.type&&"/"===e.key&&!["TEXTAREA","INPUT"].includes(document.activeElement&&document.activeElement.nodeName)&&(!document.activeElement||"true"!==document.activeElement.contentEditable)||e.ctrlKey&&("1"===e.key||"2"===e.key||"3"===e.key||"4"===e.key||"5"===e.key||"6"===e.key||"7"===e.key||"8"===e.key||"9"===e.key||"0"===e.key)||"Tab"===e.key&&document.activeElement.classList.contains("a-canvas")?(e.preventDefault(),!1):void 0})))),["blur"].map((e=>window.addEventListener(e,this.events.push.bind(this.events))))}write(e){for(let e=0;e<this.events.length;e++){const t=this.events[e];if("blur"===t.type)this.keys={},this.seenKeys.clear();else{let e=t.key.toLowerCase();e=t.code&&oz[t.code]||e,this.keys[e]="keydown"===t.type,this.seenKeys.add(e)}}this.events.length=0;for(let t=0;t<this.seenKeys.items.length;t++){const n=this.seenKeys.items[t],i=zm.device.keyboard.key(n);e.setValueType(i,this.keys[n])}}}class az{constructor(){this.events=[],document.querySelector("a-scene").addEventListener("penButtonPressed",this.events.push.bind(this.events))}write(e){for(e.setValueType(zm.device.hud.penButton,0!==this.events.length);this.events.length;)this.events.pop()}}class lz{constructor(e){this.gamepad=e,this.buttonMap=[{name:"a",buttonId:0},{name:"b",buttonId:1},{name:"x",buttonId:2},{name:"y",buttonId:3},{name:"leftBumper",buttonId:4},{name:"rightBumper",buttonId:5},{name:"leftTrigger",buttonId:6},{name:"rightTrigger",buttonId:7},{name:"back",buttonId:8},{name:"start",buttonId:9},{name:"leftJoystick",buttonId:10},{name:"rightJoystick",buttonId:11},{name:"dpadUp",buttonId:12},{name:"dpadDown",buttonId:13},{name:"dpadLeft",buttonId:14},{name:"dpadRight",buttonId:15}],this.axisMap=[{name:"leftJoystickHorizontal",axisId:0},{name:"leftJoystickVertical",axisId:1},{name:"rightJoystickHorizontal",axisId:2},{name:"rightJoystickVertical",axisId:3}]}write(e){if(this.gamepad=navigator.getGamepads()[this.gamepad.index],this.gamepad.connected){const t=zm.device.xbox;this.buttonMap.forEach((n=>{const i=t.button(n.name),r=this.gamepad.buttons[n.buttonId];e.setValueType(i.pressed,!!r.pressed),e.setValueType(i.touched,!!r.touched),e.setValueType(i.value,r.value)})),e.setValueType(t.axesSum,0),this.axisMap.forEach((n=>{e.setValueType(t.axis(n.name),this.gamepad.axes[n.axisId]),e.setValueType(t.axesSum,e.get(t.axesSum)+Math.abs(this.gamepad.axes[n.axisId]))})),this.gamepad.hapticActuators&&this.gamepad.hapticActuators[0]&&e.setValueType(zm.haptics.actuators[this.gamepad.hand],this.gamepad.hapticActuators[0])}}}const cz=new wt.Vector3(0,0,-1);function dz(){return{position:new wt.Vector3,direction:new wt.Vector3,orientation:new wt.Quaternion,fromOriginAndDirection:function(e,t){return this.position=e,this.direction=t,this.orientation=this.orientation.setFromUnitVectors(cz,t),this},fromCameraProjection:function(e,t,n){return this.position.setFromMatrixPosition(e.matrixWorld),this.direction.set(t,n,.5).unproject(e).sub(this.position).normalize(),this.fromOriginAndDirection(this.position,this.direction),this},copy:function(e){this.position.copy(e.position),this.direction.copy(e.direction),this.orientation.copy(e.orientation)}}}var uz=n(99477);const hz=function(){const e=new uz.Euler,t=new uz.Vector3,n=new uz.Quaternion,i=new uz.Vector3;return function(r,o,s,a){return s.updateMatrices(),i.copy(s.position),i.y=i.y-a,t.set(.175*("left"===o?-1:"right"===o?1:0),-.3,-.03),t.multiplyScalar(a),t.applyAxisAngle(s.up,s.rotation.y),i.add(t),t.set(0,0,-.175),t.multiplyScalar(a),n.fromArray(r.orientation),e.setFromQuaternion(n),e.set(e.x,e.y,0),t.applyEuler(e),i.add(t),i}}(),pz=function e(t){navigator.getVRDisplays&&navigator.getVRDisplays().then((n=>{n[0]&&n[0].stageParameters&&n[0].stageParameters.sittingToStandingTransform?t.fromArray(n[0].stageParameters.sittingToStandingTransform):setTimeout((()=>{e(t)}),1e3)}))};var mz=n(99477);const fz=new mz.Vector3(1,1,1),gz=new mz.Matrix4,vz=zm.device.oculusgo.touchpad,bz=zm.device.oculusgo.trigger;class yz{constructor(e){this.gamepad=e,this.rayObjectRotation=new mz.Quaternion,this.pose=new dz,this.q=new mz.Quaternion,this.sittingToStandingMatrix=(new mz.Matrix4).makeTranslation(0,1.6,0),pz(this.sittingToStandingMatrix),this.matrix=new mz.Matrix4,this.orientation=new mz.Quaternion,L().then((()=>{this.rayObject=document.querySelector("#player-right-controller").object3D,this.headObject3D=document.querySelector("#avatar-pov-node").object3D})),navigator.getGamepads()}write(e){if(this.rayObject&&this.headObject3D&&(navigator.getGamepads(),this.gamepad.connected)){e.setValueType(vz.axisX,this.gamepad.axes[0]),e.setValueType(vz.axisY,this.gamepad.axes[1]),e.setValueType(vz.pressed,this.gamepad.buttons[0].pressed),e.setValueType(vz.touched,this.gamepad.buttons[0].touched),e.setValueType(vz.value,this.gamepad.buttons[0].value),e.setValueType(bz.pressed,this.gamepad.buttons[1].pressed),e.setValueType(bz.touched,this.gamepad.buttons[1].touched),e.setValueType(bz.value,this.gamepad.buttons[1].value),this.rayObject.updateMatrices(),this.rayObject.getWorldQuaternion(this.q),e.setValueType(zm.actions.rayObjectRotation,this.q);const t=this.rayObject.matrixWorld;this.rayObjectRotation.setFromRotationMatrix(gz.extractRotation(this.rayObject.matrixWorld)),this.pose.position.setFromMatrixPosition(t),this.pose.direction.set(0,0,-1).applyQuaternion(this.rayObjectRotation),this.pose.fromOriginAndDirection(this.pose.position,this.pose.direction),e.setPose(zm.device.oculusgo.pose,this.pose),this.gamepad.pose.orientation&&e.setMatrix4(zm.device.oculusgo.matrix,this.matrix.compose(hz(this.gamepad.pose,this.gamepad.hand,this.headObject3D,1.6),this.orientation.fromArray(this.gamepad.pose.orientation),fz).premultiply(this.sittingToStandingMatrix))}}}var wz=n(99477);const _z=new wz.Vector3(1,1,1),Ez=zm.device.gearVRController.button("touchpad"),Az=zm.device.gearVRController.button("trigger"),Sz=zm.device.gearVRController.axis("touchpadX"),xz=zm.device.gearVRController.axis("touchpadY"),Mz=new wz.Matrix4;class Pz{constructor(e){this.gamepad=e,this.buttonMap=[{name:"touchpad",buttonId:0},{name:"trigger",buttonId:1}],this.axisMap=[{name:"touchpadX",axisId:0},{name:"touchpadY",axisId:1}],this.rayObjectRotation=new wz.Quaternion,this.selector=`#player-${e.hand}-controller`,this.pose=new dz,this.sittingToStandingMatrix=(new wz.Matrix4).makeTranslation(0,1.6,0),pz(this.sittingToStandingMatrix),this.matrix=new wz.Matrix4,this.orientation=new wz.Quaternion}write(e){if(navigator.getGamepads(),this.gamepad.connected){const t=this.gamepad.buttons[0];e.setValueType(Ez.pressed,!!t.pressed),e.setValueType(Ez.touched,!!t.touched),e.setValueType(Ez.value,!!t.value);const n=this.gamepad.buttons[1];e.setValueType(Az.pressed,!!n.pressed),e.setValueType(Az.touched,!!n.touched),e.setValueType(Az.value,!!n.value),e.setValueType(Sz,this.gamepad.axes[0]),e.setValueType(xz,this.gamepad.axes[1]),this.rayObject||(this.rayObject=document.querySelector(this.selector).object3D),this.rayObject.updateMatrixWorld(),this.rayObjectRotation.setFromRotationMatrix(Mz.extractRotation(this.rayObject.matrixWorld)),this.pose.position.setFromMatrixPosition(this.rayObject.matrixWorld),this.pose.direction.set(0,0,-1).applyQuaternion(this.rayObjectRotation),this.pose.fromOriginAndDirection(this.pose.position,this.pose.direction),e.setPose(zm.device.gearVRController.pose,this.pose),this.headObject3D=this.headObject3D||document.querySelector("#avatar-pov-node").object3D,this.gamepad.pose.orientation&&e.setMatrix4(zm.device.gearVRController.matrix,this.matrix.compose(hz(this.gamepad.pose,this.gamepad.hand,this.headObject3D,1.6),this.orientation.fromArray(this.gamepad.pose.orientation),_z).premultiply(this.sittingToStandingMatrix))}}}var Cz=n(99477);const kz=new Cz.Vector3(1,1,1),Oz=[{name:"thumbStick",buttonId:0},{name:"trigger",buttonId:1},{name:"grip",buttonId:2},{name:"x",buttonId:3},{name:"y",buttonId:4}],Tz=[{name:"thumbStick",buttonId:0},{name:"trigger",buttonId:1},{name:"grip",buttonId:2},{name:"a",buttonId:3},{name:"b",buttonId:4}],Rz=(new Cz.Matrix4).makeTranslation(-.025,-.03,.1),Dz=(new Cz.Matrix4).makeTranslation(.025,-.03,.1),jz=new Cz.Matrix4;class Lz{constructor(e){this.rayObjectRotation=new Cz.Quaternion,navigator.getVRDisplays();const t={left:Oz,right:Tz},n={left:zm.device.leftOculusTouch,right:zm.device.rightOculusTouch};this.gamepad=e,this.pose=new dz,this.buttonMap=t[e.hand],this.axisMap=[{name:"joyX",axisId:0},{name:"joyY",axisId:1}],this.sittingToStandingMatrix=(new Cz.Matrix4).makeTranslation(0,1.6,0),pz(this.sittingToStandingMatrix),this.matrix=new Cz.Matrix4,this.path=n[e.hand],this.selector=`#player-${e.hand}-controller`,this.position=new Cz.Vector3,this.orientation=new Cz.Quaternion,this.handOffset="left"===this.gamepad.hand?Rz:Dz}write(e){this.gamepad&&(this.gamepad=navigator.getGamepads()[this.gamepad.index],this.gamepad&&this.gamepad.connected&&(this.buttonMap.forEach((t=>{const n=this.path.button(t.name),i=this.gamepad.buttons[t.buttonId];e.setValueType(n.pressed,!!i.pressed),e.setValueType(n.touched,!!i.touched),e.setValueType(n.value,i.value)})),e.setValueType(this.path.axesSum,0),this.axisMap.forEach((t=>{e.setValueType(this.path.axis(t.name),this.gamepad.axes[t.axisId]),e.setValueType(this.path.axesSum,e.get(this.path.axesSum)+Math.abs(this.gamepad.axes[t.axisId]))})),this.rayObject=this.rayObject||document.querySelector(this.selector).object3D,this.rayObject.updateMatrixWorld(),this.rayObjectRotation.setFromRotationMatrix(jz.extractRotation(this.rayObject.matrixWorld)),this.pose.position.setFromMatrixPosition(this.rayObject.matrixWorld),this.pose.direction.set(0,0,-1).applyQuaternion(this.rayObjectRotation),this.pose.orientation.copy(this.rayObjectRotation),e.setPose(this.path.pose,this.pose),this.gamepad.pose.position&&this.gamepad.pose.orientation&&e.setMatrix4(this.path.matrix,this.matrix.compose(this.position.fromArray(this.gamepad.pose.position),this.orientation.fromArray(this.gamepad.pose.orientation),kz).premultiply(this.sittingToStandingMatrix).multiply(this.handOffset)),this.gamepad.hapticActuators&&this.gamepad.hapticActuators[0]&&e.setValueType(zm.haptics.actuators[this.gamepad.hand],this.gamepad.hapticActuators[0])))}}var Iz=n(99477);const Nz=new Iz.Vector3(1,1,1),Fz=(new Iz.Matrix4).makeTranslation(0,0,-.04),Bz=new Iz.Matrix4,Vz=zm.device.daydream.button("touchpad"),Uz=zm.device.daydream.axis("touchpadX"),Hz=zm.device.daydream.axis("touchpadY"),zz=zm.device.daydream.pose,Wz=zm.device.daydream.matrix;class qz{constructor(e){this.gamepad=e,this.rayObjectRotation=new Iz.Quaternion,this.selector=`#player-${e.hand||"right"}-controller`,this.pose=new dz,this.sittingToStandingMatrix=(new Iz.Matrix4).makeTranslation(0,1.6,0),pz(this.sittingToStandingMatrix),this.matrix=new Iz.Matrix4,this.orientation=new Iz.Quaternion}write(e){if(this.gamepad=navigator.getGamepads()[0],this.gamepad&&this.gamepad.connected){const t=this.gamepad.buttons[0];e.setValueType(Vz.pressed,!!t.pressed),e.setValueType(Vz.touched,!!t.touched),e.setValueType(Vz.value,!!t.value),e.setValueType(Uz,this.gamepad.axes[0]),e.setValueType(Hz,this.gamepad.axes[1]),this.rayObject||(this.rayObject=document.querySelector(this.selector).object3D),this.rayObject.updateMatrixWorld(),this.rayObjectRotation.setFromRotationMatrix(Bz.extractRotation(this.rayObject.matrixWorld)),this.pose.position.setFromMatrixPosition(this.rayObject.matrixWorld),this.pose.direction.set(0,0,-1).applyQuaternion(this.rayObjectRotation),this.pose.fromOriginAndDirection(this.pose.position,this.pose.direction),e.setPose(zz,this.pose),this.headObject3D=this.headObject3D||document.querySelector("#avatar-pov-node").object3D,this.gamepad.pose.orientation&&e.setMatrix4(Wz,this.matrix.compose(hz(this.gamepad.pose,this.gamepad.hand,this.headObject3D,1.6),this.orientation.fromArray(this.gamepad.pose.orientation),Nz).premultiply(this.sittingToStandingMatrix).multiply(Fz))}}}var Zz=n(99477);const Gz=new Zz.Vector3(1,1,1),Yz=(new Zz.Matrix4).compose(new Zz.Vector3(0,0,.13),(new Zz.Quaternion).setFromEuler(new Zz.Euler(-40*Zz.MathUtils.DEG2RAD,0,0)),new Zz.Vector3(1,1,1)),Qz=new Zz.Quaternion,Xz=new Zz.Matrix4;class Kz{constructor(e){navigator.getVRDisplays(),this.gamepad=e,"OpenVR Cosmos"===this.gamepad.id?(Qz.setFromAxisAngle(new Zz.Vector3(1,0,0),-Math.PI/12),this.buttonMap=[{name:"trigger",buttonId:0},{name:"grip",buttonId:1},{name:"primary",buttonId:2},{name:"secondary",buttonId:3},{name:"joystick",buttonId:4},{name:"bumper",buttonId:5}],this.axisMap=[{name:"joyX",axisId:0},{name:"joyY",axisId:1}]):"HTC Vive Focus Plus Controller"===this.gamepad.id?(Qz.setFromAxisAngle(new Zz.Vector3(1,0,0),Math.PI/15),this.buttonMap=[{name:"touchpad",buttonId:0},{name:"trigger",buttonId:1},{name:"grip",buttonId:2}],this.axisMap=[{name:"touchX",axisId:0},{name:"touchY",axisId:1}]):4===this.gamepad.axes.length?(Qz.setFromAxisAngle(new Zz.Vector3(1,0,0),-Math.PI/12),this.buttonMap=[{name:"touchpad",buttonId:0},{name:"trigger",buttonId:1},{name:"grip",buttonId:2},{name:"primary",buttonId:3},{name:"secondary",buttonId:4},{name:"joystick",buttonId:5},{name:"index",buttonId:6},{name:"middle",buttonId:7},{name:"ring",buttonId:8},{name:"pinky",buttonId:9}],this.axisMap=[{name:"touchX",axisId:0},{name:"touchY",axisId:1},{name:"joyX",axisId:2},{name:"joyY",axisId:3}]):(Qz.setFromAxisAngle(new Zz.Vector3(1,0,0),-Math.PI/12),this.buttonMap=[{name:"touchpad",buttonId:0},{name:"trigger",buttonId:1},{name:"grip",buttonId:2},{name:"primary",buttonId:3}],this.axisMap=[{name:"touchX",axisId:0},{name:"touchY",axisId:1}]),this.pose=new dz,this.rayObjectRotation=new Zz.Quaternion,this.path=zm.device.vive[e.hand||"right"],this.sittingToStandingMatrix=(new Zz.Matrix4).makeTranslation(0,1.6,0),pz(this.sittingToStandingMatrix),this.matrix=new Zz.Matrix4,this.position=new Zz.Vector3,this.orientation=new Zz.Quaternion}write(e){const t=navigator.getGamepads();if(t.length<this.gamepad.index+1)return;if(this.gamepad=t[this.gamepad.index],!this.gamepad.connected)return;if(this.buttonMap.forEach((t=>{const n=this.path.button(t.name),i=this.gamepad.buttons[t.buttonId];e.setValueType(n.pressed,!!i.pressed),e.setValueType(n.touched,!!i.touched),e.setValueType(n.value,i.value)})),e.setValueType(this.path.axesSum,0),this.axisMap.forEach((t=>{e.setValueType(this.path.axis(t.name),this.gamepad.axes[t.axisId]),e.setValueType(this.path.axesSum,e.get(this.path.axesSum)+Math.abs(this.gamepad.axes[t.axisId]))})),!this.selector){if(!this.gamepad.hand)return;this.path=zm.device.vive[this.gamepad.hand],this.selector=`#player-${this.gamepad.hand}-controller`,console.warn("gamepad hand eventually specified")}const n=document.querySelector(this.selector).object3D;n.updateMatrixWorld(),this.rayObjectRotation.setFromRotationMatrix(Xz.extractRotation(n.matrixWorld)),this.pose.position.setFromMatrixPosition(n.matrixWorld),this.pose.direction.set(0,0,-1).applyQuaternion(Qz).applyQuaternion(this.rayObjectRotation),this.pose.fromOriginAndDirection(this.pose.position,this.pose.direction),e.setPose(this.path.pose,this.pose),this.gamepad.pose.position&&this.gamepad.pose.orientation&&e.setMatrix4(this.path.matrix,this.matrix.compose(this.position.fromArray(this.gamepad.pose.position),this.orientation.fromArray(this.gamepad.pose.orientation),Gz).premultiply(this.sittingToStandingMatrix).multiply(Yz)),this.gamepad.hapticActuators&&this.gamepad.hapticActuators[0]&&e.setValueType(zm.haptics.actuators[this.gamepad.hand],this.gamepad.hapticActuators[0])}}var $z=n(99477);const Jz=new $z.Vector3(1,1,1),eW=(new $z.Matrix4).compose(new $z.Vector3(0,-.017,.13),(new $z.Quaternion).setFromEuler(new $z.Euler(-40*$z.MathUtils.DEG2RAD,0,0)),new $z.Vector3(1,1,1)),tW=new $z.Matrix4;class nW{constructor(e){this.rayObject=null,this.rayObjectRotation=new $z.Quaternion,navigator.getVRDisplays(),this.gamepad=e,this.pose=new dz,e.hand&&(this.selector=`#player-${e.hand}-controller`),this.sittingToStandingMatrix=(new $z.Matrix4).makeTranslation(0,1.6,0),pz(this.sittingToStandingMatrix),this.matrix=new $z.Matrix4,this.position=new $z.Vector3,this.orientation=new $z.Quaternion}write(e){if(!this.gamepad)return;if(this.gamepad=navigator.getGamepads()[this.gamepad.index],!this.gamepad||!this.gamepad.connected)return;const t=zm.device.wmr[this.gamepad.hand||"right"];if(e.setValueType(t.touchpad.pressed,this.gamepad.buttons[0].pressed),e.setValueType(t.touchpad.touched,this.gamepad.buttons[0].touched),e.setValueType(t.touchpad.value,this.gamepad.buttons[0].value),e.setValueType(t.trigger.pressed,this.gamepad.buttons[1].pressed),e.setValueType(t.trigger.touched,this.gamepad.buttons[1].touched),e.setValueType(t.trigger.value,this.gamepad.buttons[1].value),e.setValueType(t.grip.pressed,this.gamepad.buttons[2].pressed),e.setValueType(t.grip.touched,this.gamepad.buttons[2].touched),e.setValueType(t.grip.value,this.gamepad.buttons[2].value),e.setValueType(t.menu.pressed,this.gamepad.buttons[3].pressed),e.setValueType(t.menu.touched,this.gamepad.buttons[3].touched),e.setValueType(t.menu.value,this.gamepad.buttons[3].value),e.setValueType(t.touchpad.axisX,this.gamepad.axes[0]),e.setValueType(t.touchpad.axisY,this.gamepad.axes[1]),e.setValueType(t.joystick.axisX,this.gamepad.axes[2]),e.setValueType(t.joystick.axisY,this.gamepad.axes[3]),!this.selector){if(!this.gamepad.hand)return;this.selector=`#player-${this.gamepad.hand}-controller`}this.rayObject=this.rayObject||document.querySelector(this.selector).object3D,this.rayObject.updateMatrixWorld(),this.rayObjectRotation.setFromRotationMatrix(tW.extractRotation(this.rayObject.matrixWorld)),this.pose.position.setFromMatrixPosition(this.rayObject.matrixWorld),this.pose.direction.set(0,0,-1).applyQuaternion(this.rayObjectRotation),this.pose.fromOriginAndDirection(this.pose.position,this.pose.direction),e.setPose(t.pose,this.pose),this.gamepad.pose.position&&this.gamepad.pose.orientation&&e.setMatrix4(t.matrix,this.matrix.compose(this.position.fromArray(this.gamepad.pose.position),this.orientation.fromArray(this.gamepad.pose.orientation),Jz).premultiply(this.sittingToStandingMatrix).multiply(eW)),this.gamepad.hapticActuators&&this.gamepad.hapticActuators[0]&&e.setValueType(zm.haptics.actuators[this.gamepad.hand],this.gamepad.hapticActuators[0])}}var iW=n(99477);const rW=new iW.Vector3(1,1,1),oW=(new iW.Matrix4).makeTranslation(-.025,-.03,.12),sW=(new iW.Matrix4).makeTranslation(.025,-.03,.12),aW=new iW.Matrix4;class lW{constructor(e){this.gamepad=e,this.selector=`#player-${e.hand}-controller`,this.rayObject=null,this.rayObjectRotation=new iW.Quaternion,this.pose=new dz,this.matrix=new iW.Matrix4,this.position=new iW.Vector3,this.orientation=new iW.Quaternion}write(e,t,n){if(!n||!t||!this.gamepad)return;const i=this.gamepad.hand||"right",r=zm.device.webxr[i];this.gamepad.buttons[0]&&(e.setValueType(r.button.trigger.pressed,this.gamepad.buttons[0].pressed),e.setValueType(r.button.trigger.touched,this.gamepad.buttons[0].touched),e.setValueType(r.button.trigger.value,this.gamepad.buttons[0].value)),this.gamepad.buttons[1]&&(e.setValueType(r.button.grip.pressed,this.gamepad.buttons[1].pressed),e.setValueType(r.button.grip.touched,this.gamepad.buttons[1].touched),e.setValueType(r.button.grip.value,this.gamepad.buttons[1].value)),this.gamepad.buttons[2]&&(e.setValueType(r.button.touchpad.pressed,this.gamepad.buttons[2].pressed),e.setValueType(r.button.touchpad.touched,this.gamepad.buttons[2].touched),e.setValueType(r.button.touchpad.value,this.gamepad.buttons[2].value)),this.gamepad.buttons[3]&&(e.setValueType(r.button.thumbStick.pressed,this.gamepad.buttons[3].pressed),e.setValueType(r.button.thumbStick.touched,this.gamepad.buttons[3].touched),e.setValueType(r.button.thumbStick.value,this.gamepad.buttons[3].value)),this.gamepad.buttons[4]&&(e.setValueType(r.button.a.pressed,this.gamepad.buttons[4].pressed),e.setValueType(r.button.a.touched,this.gamepad.buttons[4].touched),e.setValueType(r.button.a.value,this.gamepad.buttons[4].value)),this.gamepad.buttons[5]&&(e.setValueType(r.button.b.pressed,this.gamepad.buttons[5].pressed),e.setValueType(r.button.b.touched,this.gamepad.buttons[5].touched),e.setValueType(r.button.b.value,this.gamepad.buttons[5].value)),this.gamepad.axes.length>=4&&(e.setValueType(r.axis.touchpadX,this.gamepad.axes[0]),e.setValueType(r.axis.touchpadY,this.gamepad.axes[1]),e.setValueType(r.axis.joyX,this.gamepad.axes[2]),e.setValueType(r.axis.joyY,this.gamepad.axes[3])),this.rayObject=this.rayObject||document.querySelector(this.selector).object3D,this.rayObject.updateMatrixWorld(),this.rayObjectRotation.setFromRotationMatrix(aW.extractRotation(this.rayObject.matrixWorld)),this.pose.position.setFromMatrixPosition(this.rayObject.matrixWorld),this.pose.direction.set(0,0,-1).applyQuaternion(this.rayObjectRotation),this.pose.orientation.copy(this.rayObjectRotation),e.setPose(r.pose,this.pose);const o=t.getPose(this.gamepad.targetRaySpace,n);o&&o.transform.position&&o.transform.orientation&&(this.position.copy(o.transform.position),this.orientation.copy(o.transform.orientation),this.matrix.compose(this.position,this.orientation,rW),this.matrix.multiply("left"===i?oW:sW),e.setMatrix4(r.matrix,this.matrix))}}var cW=n(99477);const dW=2*Math.PI;class uW{constructor(e){this.items=new Array(e).fill(0),this.writePtr=0}push(e){this.items[this.writePtr]=e,this.writePtr=(this.writePtr+1)%this.items.length}}const hW=Math.abs,pW=(e,t)=>{const n=e-t,i=e+dW-t,r=e-(t+dW);return hW(n)<hW(i)&&hW(n)<hW(r)?n:hW(i)<hW(r)?i:r},mW=e=>{let t=0;for(let n=0;n<e.length;n++)t+=e[n];return t/e.length};class fW{constructor(){this.hmdEuler=new cW.Euler,this.hmdQuaternion=new cW.Quaternion,this.prevX=this.hmdEuler.x,this.prevY=this.hmdEuler.y,this.dXBuffer=new uW(6),this.dYBuffer=new uW(6),this.hasPolyfill=window.webvrpolyfill,this.hasPolyfill&&(this.vrDisplay=window.webvrpolyfill.getPolyfillDisplays()[0],this.frameData=new window.webvrpolyfill.constructor.VRFrameData),this.enableGyro=window.APP.store.state.preferences.enableGyro,window.APP.store.addEventListener("statechanged",(()=>{this.enableGyro=window.APP.store.state.preferences.enableGyro}))}write(e){if(!(this.enableGyro&&this.hasPolyfill&&this.vrDisplay&&this.frameData))return;const t=this.hmdEuler;if(this.vrDisplay.getFrameData(this.frameData),null!==this.frameData.pose.orientation&&(this.hmdQuaternion.fromArray(this.frameData.pose.orientation),t.setFromQuaternion(this.hmdQuaternion,"YXZ")),t.x<.475*-Math.PI)return;const n=pW(t.x,this.prevX),i=pW(t.y,this.prevY);this.dXBuffer.push(Math.abs(n)<.001?0:n),this.dYBuffer.push(Math.abs(i)<.001?0:i),this.averageDeltaX=mW(this.dXBuffer.items),this.averageDeltaY=mW(this.dYBuffer.items),this.prevX=t.x,this.prevY=t.y,e.setValueType(zm.device.gyro.averageDeltaX,this.averageDeltaX),e.setValueType(zm.device.gyro.averageDeltaY,this.averageDeltaY)}}var gW=n(99477);const vW=function(){const e=new gW.Vector3,t=new gW.Vector3;return function(n,i,r){return e.setFromMatrixPosition(i.matrixWorld),t.set(r[0],r[1],.5).unproject(i).sub(e).normalize(),n.fromOriginAndDirection(e,t),n}}();class bW{constructor(){this.cursorPose=new dz}write(e){const t=AFRAME.scenes[0].systems["transform-selected-object"],n=e.get(zm.device.mouse.buttonLeft);if(e.get(zm.device.mouse.buttonRight)&&!t.transforming||n&&!qo(APP.world,pn)){const t=e.get(zm.device.mouse.movementXY);t&&e.setVector2(zm.device.smartMouse.cameraDelta,t[0],t[1]),e.setValueType(zm.device.smartMouse.shouldMoveCamera,!0)}this.camera||(this.camera=AFRAME.scenes[0].systems["hubs-systems"].cameraSystem.viewingCamera),this.camera&&e.setPose(zm.device.smartMouse.cursorPose,vW(this.cursorPose,this.camera,e.get(zm.device.mouse.coords)))}}function yW(e,t){return void 0!==t.find((t=>t.touch.identifier===e.identifier))}function wW(e,t){return void 0!==t.find((t=>t.job===e))}function _W(e,t,n){if(yW(e,n)||wW(t,n))return void console.error("cannot reassign touches or jobs. unassign first");const i={job:t,touch:e};return n.push(i),i}function EW(e,t,n){n.splice(n.findIndex((function(n){return n.touch.identifier===e.identifier&&n.job===t})),1)}function AW(e,t){return t.find((t=>t.job===e))}function SW(e,t){return t.find((t=>t.touch.identifier===e.identifier))}var xW=n(99477);function MW(e,t){return t?t.eid?(0,Ot.hasComponent)(e,$t,t.eid)?null:(0,Ot.hasComponent)(e,Kt,t.eid)?t.eid:MW(e,t.parent):MW(e,t.parent):null}const PW=(0,Ot.defineQuery)([cn]),CW=(0,Ot.defineQuery)([dn]),kW=new xW.Color(23/255,64/255,118/255),OW=new xW.Color(190/255,190/255,190/255),TW=new xW.Color(150/255,80/255,150/255),RW=new xW.Color(23/255,64/255,118/255);AFRAME.registerComponent("cursor-controller",{schema:{cursor:{type:"selector"},camera:{type:"selector"},far:{default:100},near:{default:.01},defaultDistance:{default:4},minDistance:{default:.18}},init:function(){this.enabled=!1,this.cursorVisual=new xW.Mesh(new xW.PlaneBufferGeometry,new xW.ShaderMaterial({depthTest:!1,uniforms:{color:{value:new xW.Color(3113197)}},vertexShader:"\n          varying vec2 vPos;\n          void main() {\n            vPos = position.xy;\n\n            vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\n            vec2 scale = vec2(\n              length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) ),\n              length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) )\n            );\n\n            float distance = -mvPosition.z;\n            scale *= distance; // negates projection scale\n            scale += min(1.0/distance, 0.3); // scale in screen space\n\n            float radius = 0.02;\n            mvPosition.xy += position.xy * radius * scale;\n            gl_Position = projectionMatrix * mvPosition;\n          }",fragmentShader:"\n          uniform vec3 color;\n          varying vec2 vPos;\n\n          void main() {\n            float distance = length(vPos);\n            if (distance > 0.5) {\n                discard;\n            }\n\n            gl_FragColor = vec4(\n              mix(color, vec3(0.0), step(0.35, distance)),\n              0.8\n            );\n\n            // #include <tonemapping_fragment>\n            #include <encodings_fragment>\n          }"}));const e=()=>{this.cursorVisual.scale.setScalar(APP.store.state.preferences.cursorSize||1),this.cursorVisual.matrixNeedsUpdate=!0};APP.store.addEventListener("statechanged",e),e(),this.cursorVisual.renderOrder=window.APP.RENDER_ORDER.CURSOR,this.cursorVisual.material.transparent=!0,this.cursorVisual.layers.set(_o.CAMERA_LAYER_UI),this.cursorVisual.layers.enable(_o.CAMERA_LAYER_FX_MASK),this.data.cursor.object3D.add(this.cursorVisual),this.intersection=null,this.raycaster=new xW.Raycaster,this.raycaster.firstHitOnly=!0,this.distance=this.data.far,this.color=this.cursorVisual.material.uniforms.color.value;const t=new xW.BufferGeometry;t.setAttribute("position",new xW.BufferAttribute(new Float32Array(6),3)),this.line=new xW.Line(t,new xW.LineBasicMaterial({color:"white",opacity:.2,transparent:!0,visible:!1})),this.el.setObject3D("line",this.line)},update:function(){this.raycaster.far=this.data.far,this.raycaster.near=this.data.near},tick2:(()=>{const e=[],t=new xW.Vector3,n=new xW.Vector3;return function(i,r){const o=AFRAME.scenes[0].systems.userinput,s=o.get(r?zm.actions.cursor.left.pose:zm.actions.cursor.right.pose),a=o.get(r?zm.actions.cursor.left.hideLine:zm.actions.cursor.right.hideLine);if(this.data.cursor.object3D.visible=this.enabled&&!!s,this.line.material.visible=!(!this.enabled||a),this.intersection=null,!this.enabled||!s)return;this.el.sceneEl.systems["hubs-systems"].characterController.avatarPOV.object3D.updateMatrices();const l=n.setFromMatrixColumn(this.el.sceneEl.systems["hubs-systems"].characterController.avatarPOV.object3D.matrixWorld,1).length();this.raycaster.far=this.data.far*l,this.raycaster.near=this.data.near*l;const c=qo(APP.world,r?mn:pn);let d=!1;if(!c){e.length=0,this.raycaster.ray.origin=s.position,this.raycaster.ray.direction=s.direction,this.raycaster.intersectObjects(AFRAME.scenes[0].systems["hubs-systems"].cursorTargettingSystem.targets,!0,e),this.intersection=e[0];const t=this.intersection&&MW(APP.world,this.intersection.object);d=!!t,t&&(0,Ot.addComponent)(APP.world,r?dn:cn,t);const n=r?CW(APP.world):PW(APP.world);for(let e=0;e<n.length;e++)t!==n[e]&&(0,Ot.removeComponent)(APP.world,r?dn:cn,n[e]);this.distance=t?this.intersection.distance:this.data.defaultDistance*l}const{cursor:u,minDistance:h,far:p,camera:m}=this.data,f=o.get(r?zm.actions.cursor.left.modDelta:zm.actions.cursor.right.modDelta)||0;c&&!o.activeSets.includes(r?LH:SH)&&(this.distance=xW.MathUtils.clamp(this.distance-f,h,p*l)),u.object3D.position.copy(s.position).addScaledVector(s.direction,this.distance),So(m.object3D,t),t.y=u.object3D.position.y,u.object3D.lookAt(t),u.object3D.matrixNeedsUpdate=!0;const g=AFRAME.scenes[0].systems["transform-selected-object"];if(g.transforming&&(r&&"player-left-controller"===g.hand.el.id||!r&&"player-right-controller"===g.hand.el.id)?this.color.copy(TW).lerpHSL(RW,.5+.5*Math.sin(i/1e3)):c||d?this.color.copy(kW):this.color.copy(OW),this.line.material.visible){const e=s.position,t=u.object3D.position,n=this.line.geometry.attributes.position.array;n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=t.x,n[4]=t.y,n[5]=t.z,this.line.geometry.attributes.position.needsUpdate=!0,this.line.geometry.computeBoundingSphere()}}})()});var DW=n(99477);const jW="MOVE CURSOR",LW="MOVE CAMERA",IW="FIRST PINCHER",NW="SECOND PINCHER",FW=[zm.device.touchscreen.tap1,zm.device.touchscreen.tap2,zm.device.touchscreen.tap3,zm.device.touchscreen.tap4,zm.device.touchscreen.tap5];function BW(e,t,n,i){const r=e-n,o=t-i;return Math.sqrt(r*r+o*o)}const VW=function(){return AFRAME.scenes[0].systems["hubs-systems"].cameraSystem.viewingCamera};class UW{constructor(){this.raycaster=new DW.Raycaster(new DW.Vector3,new DW.Vector3,0,100),this.assignments=[],this.pinch={initialDistance:0,currentDistance:0,delta:0},this.pendingTap={maxTouchCount:0,startedAt:0},this.tapIndexToWriteNextFrame=0,this.canvas=document.querySelector("canvas"),this.events=[],["touchstart","touchend","touchmove","touchcancel"].map((e=>this.canvas.addEventListener(e,this.events.push.bind(this.events)))),this.canvasRect=this.canvas.getBoundingClientRect(),new NO.Z((()=>this.canvasRect=this.canvas.getBoundingClientRect())).observe(this.canvas)}end(e){if(yW(e,this.assignments)){const t=SW(e,this.assignments);switch(t.job){case jW:case LW:t.framesUntilGrab>0?t.framesUntilUnassign=t.framesUntilGrab+2:EW(t.touch,t.job,this.assignments);break;case IW:if(EW(t.touch,t.job,this.assignments),this.pinch={initialDistance:0,currentDistance:0,delta:0},wW(NW,this.assignments)){const e=AW(NW,this.assignments);if(EW(e.touch,e.job,this.assignments),wW(LW,this.assignments)){const t=_W(e.touch,IW,this.assignments);t.clientX=e.clientX,t.clientY=e.clientY}else{const t=_W(e.touch,LW,this.assignments);t.clientX=e.clientX,t.clientY=e.clientY,t.delta=[0,0]}}break;case NW:if(EW(t.touch,t.job,this.assignments),this.pinch={initialDistance:0,currentDistance:0,delta:0},wW(IW,this.assignments)&&!wW(LW,this.assignments)){const e=AW(IW,this.assignments);EW(e.touch,e.job,this.assignments);const t=_W(e.touch,LW,this.assignments);t.clientX=e.clientX,t.clientY=e.clientY,t.delta=[0,0]}}}else console.warn("touch does not have a job",e);0===this.assignments.length&&(this.pendingTap.maxTouchCount>0&&performance.now()-this.pendingTap.startedAt<=125&&(this.tapIndexToWriteNextFrame=this.pendingTap.maxTouchCount),this.pendingTap={maxTouchCount:0})}move(e){if(!yW(e,this.assignments))return void(e.target.classList[0]&&e.target.classList[0].startsWith("virtual-gamepad-controls")||console.warn("touch does not have job",e));const t=SW(e,this.assignments);switch(t.job){case jW:t.framesUntilGrab<0&&t.cursorPose.fromCameraProjection(VW(),(e.clientX-this.canvasRect.left)/this.canvasRect.width*2-1,-(e.clientY-this.canvasRect.top)/this.canvasRect.height*2+1);break;case LW:t.delta[0]+=e.clientX-t.clientX,t.delta[1]+=e.clientY-t.clientY,t.clientX=e.clientX,t.clientY=e.clientY;break;case IW:case NW:if(t.clientX=e.clientX,t.clientY=e.clientY,wW(IW,this.assignments)&&wW(NW,this.assignments)){const e=AW(IW,this.assignments),t=AW(NW,this.assignments),n=BW(e.clientX,e.clientY,t.clientX,t.clientY);this.pinch.delta+=n-this.pinch.currentDistance,this.pinch.currentDistance=n}}}start(e){if(yW(e,this.assignments))return void console.error("touch already has a job");const t=0===this.assignments.length,n=1===this.assignments.length,i=2===this.assignments.length,r=!!AW(NW,this.assignments);if(t||i&&r){let t;!function(e,t,n){if(qo(APP.world,pn))return!0;const i=[];n.setFromCamera({x:(e.clientX-t.left)/t.width*2-1,y:-(e.clientY-t.top)/t.height*2+1},VW()),n.intersectObjects(AFRAME.scenes[0].systems["hubs-systems"].cursorTargettingSystem.targets,!0,i);const r=i[0],o=r&&MW(APP.world,r.object);if(!o)return!1;const s=(0,Ot.hasComponent)(APP.world,Cn,o),a=(0,Ot.hasComponent)(APP.world,_n,o)||(0,Ot.hasComponent)(APP.world,Ut,o)&&APP.world.eid2obj.get(o).el.matches(".interactable, .interactable *, .occupiable-waypoint-icon, .teleport-waypoint-icon"),l=(0,Ot.hasComponent)(APP.world,Nn,o)&&(0,Ot.hasComponent)(APP.world,Fn,o),c=AFRAME.scenes[0].is("frozen"),d=(0,Ot.hasComponent)(APP.world,Tn,o);return s||a&&(c||!l)&&!d}(e,this.canvasRect,this.raycaster)?(t=_W(e,LW,this.assignments),t.delta=[0,0]):(t=_W(e,jW,this.assignments),t.framesUntilGrab=8),t.clientX=e.clientX,t.clientY=e.clientY,t.cursorPose=(new dz).fromCameraProjection(VW(),(e.clientX-this.canvasRect.left)/this.canvasRect.width*2-1,-(e.clientY-this.canvasRect.top)/this.canvasRect.height*2+1)}else if(n||i){const t=AW(jW,this.assignments);if(n&&t&&t.framesUntilGrab<0){const t=_W(e,IW,this.assignments);t.clientX=e.clientX,t.clientY=e.clientY}else{if(n){const e=this.assignments[0];EW(e.touch,e.job,this.assignments);const t=_W(e.touch,IW,this.assignments);t.clientX=e.clientX,t.clientY=e.clientY}const t=AW(IW,this.assignments);if(!t){const t=_W(e,IW,this.assignments);return t.clientX=e.clientX,void(t.clientY=e.clientY)}{const n=_W(e,NW,this.assignments);n.clientX=e.clientX,n.clientY=e.clientY;const i=BW(t.clientX,t.clientY,n.clientX,n.clientY);this.pinch={initialDistance:i,currentDistance:i,delta:0}}}}0===this.pendingTap.maxTouchCount&&this.assignments.length>0&&(this.pendingTap.startedAt=performance.now()),this.pendingTap.maxTouchCount=Math.max(this.pendingTap.maxTouchCount,this.assignments.length)}process(e){switch(e.type){case"touchstart":for(const t of e.changedTouches)this.start(t);break;case"touchmove":for(const t of e.touches)this.move(t);break;case"touchend":case"touchcancel":for(const t of e.changedTouches)this.end(t)}}write(e){this.pinch&&(this.pinch.delta=0);const t=wW(LW,this.assignments)&&AW(LW,this.assignments);for(t&&(t.delta[0]=0,t.delta[1]=0),this.events.forEach((e=>{this.process(e)}));this.events.length;)this.events.pop();const n=zm.device.touchscreen,i=wW(jW,this.assignments),r=wW(LW,this.assignments);if(i||r){e.setValueType(n.isTouching,!0);const t=AW(jW,this.assignments)||AW(LW,this.assignments);e.setPose(n.cursorPose,t.cursorPose),this.lastPose=t.cursorPose}else this.lastPose&&e.setPose(n.cursorPose,this.lastPose);if(e.setValueType(n.isTouchingGrabbable,!1),i){const t=AW(jW,this.assignments);e.setValueType(n.isTouchingGrabbable,t.framesUntilGrab<=0),t.framesUntilGrab--,t.framesUntilUnassign>=0&&(0===t.framesUntilUnassign&&EW(t.touch,t.job,this.assignments),t.framesUntilUnassign--)}if(r){const t=AW(LW,this.assignments).delta;e.setVector2(n.touchCameraDelta,t[0]/this.canvas.clientWidth,t[1]/this.canvas.clientHeight)}e.setValueType(n.pinch.delta,this.pinch.delta),e.setValueType(n.pinch.initialDistance,this.pinch.initialDistance),e.setValueType(n.pinch.currentDistance,this.pinch.currentDistance),this.tapIndexToWriteNextFrame&&this.tapIndexToWriteNextFrame<FW.length&&e.setValueType(FW[this.tapIndexToWriteNextFrame-1],!0),this.tapIndexToWriteNextFrame=0,e.setValueType(n.anything,0!==this.assignments.length)}}var HW=n(99477);const zW={noop:function(){},copy:function(e,t,n){e.setValueType(n.value,e.get(t.value))},scale:function(e){return function(t,n,i){void 0!==t.get(n.value)&&t.setValueType(i.value,t.get(n.value)*e)}},scaleExp:function(e,t){return void 0===t&&(t=1),function(n,i,r){void 0!==n.get(i.value)&&(1===t?n.setValueType(r.value,n.get(i.value)*e):n.setValueType(r.value,Math.pow(n.get(i.value),t)*e))}},deadzone:function(e){return function(t,n,i){t.setValueType(i.value,Math.abs(t.get(n.value))<e?0:t.get(n.value))}},split_vec2:function(e,t,n){const i=e.get(t.value);void 0!==i&&(e.setValueType(n.x,i[0]),e.setValueType(n.y,i[1]))},compose_vec2:function(e,t,n){const i=e.get(t.x),r=e.get(t.y);void 0!==i&&void 0!==r&&e.setVector2(n.value,i,r)},negate:function(e,t,n){e.setValueType(n.value,-e.get(t.value))},copyIfFalse:function(e,t,n){e.setValueType(n.value,e.get(t.bool)?void 0:e.get(t.value))},copyIfTrue:function(e,t,n){e.setValueType(n.value,e.get(t.bool)?e.get(t.value):void 0)},copyVec2IfTrue:function(e,t,n){if(e.get(t.bool)){const i=e.get(t.value);e.setVector2(n.value,i[0],i[1])}},zeroIfDefined:function(e,t,n){e.setValueType(n.value,void 0!==e.get(t.bool)?0:e.get(t.value))},true:function(e,t,n){e.setValueType(n.value,!0)},rising:function(e,t,n,i){return e.setValueType(n.value,e.get(t.value)&&!1===i),!!e.get(t.value)},clickAndHold:function(e){return void 0===e&&(e=160),function(t,n,i,r){void 0===r&&(r={});let o=!1,s=!1,a=!1;return t.get(n.rising)?r.buttonDownTime=performance.now():r.buttonDownTime&&t.get(n.falling)?(r.buttonDownTime=0,r.grabbed?(r.grabbed=!1,a=!0):o=!0):r.buttonDownTime&&!r.grabbed&&performance.now()-r.buttonDownTime>e&&(r.grabbed=!0,s=!0),t.setValueType(i.click,o),t.setValueType(i.grab,s),t.setValueType(i.drop,a),r}},risingWithFrameDelay:function(e){return function(t,n,i,r){return void 0===r&&(r={values:new Array(e)}),t.setValueType(i.value,r.values.shift()),r.values.push(t.get(n.value)&&!r.prev),r.prev=t.get(n.value),r}},falling:function(e,t,n,i){return e.setValueType(n.value,!e.get(t.value)&&i),!!e.get(t.value)},vec2Zero:function(e,t,n){e.setVector2(n.value,0,0)},poseFromCameraProjection:function(){const e=new dz;return function(t,n,i){const r=AFRAME.scenes[0].systems["hubs-systems"].cameraSystem.viewingCamera,o=t.get(n.value);t.setPose(i.value,e.fromCameraProjection(r,o[0],o[1]))}},vec2dpad:function(e,t,n){void 0===t&&(t=!1),void 0===n&&(n=!1);const i=e*e;return function(e,r,o){if(!e.get(r.value))return;const[s,a]=e.get(r.value),l=s*s+a*a<i?"center":(c=((c=Math.atan2(t?-s:s,n?-a:a))*HW.MathUtils.RAD2DEG+180+45)%360)>0&&c<90?"north":c>=90&&c<180?"west":c>=180&&c<270?"south":"east";var c;o[l]&&e.setValueType(o[l],!0)}},always:function(e){return function(t,n,i){t.setValueType(i.value,e)}},wasd_to_vec2:function(e,t,n){let{w:i,a:r,s:o,d:s}=t,{vec2:a}=n,l=0,c=0;e.get(r)&&(l-=1),e.get(s)&&(l+=1),e.get(i)&&(c+=1),e.get(o)&&(c-=1),e.setVector2(a,l,c)},add_vec2:function(e,t,n){const i=e.get(t.first),r=e.get(t.second);i&&r?e.setVector2(n.value,i[0]+r[0],i[1]+r[1]):r?e.setVector2(n.value,r[0],r[1]):i&&e.setVector2(n.value,i[0],i[1])},max_vec2:function(e,t,n){const i=e.get(t.first),r=e.get(t.second);if(i&&r){const t=i[0]*i[0]+i[1]*i[1]>r[0]*r[0]+r[1]*r[1]?i:r;e.setVector2(n.value,t[0],t[1])}else r?e.setVector2(n.value,r[0],r[1]):i&&e.setVector2(n.value,i[0],i[1])},normalize_vec2:function(e,t,n){const i=e.get(t.value);if(i)if(0===i[0]&&0===i[0])e.setVector2(n.value,i[0],i[1]);else{const t=Math.sqrt(i[0]*i[0]+i[1]*i[1]);e.setVector2(n.value,i[0]/t,i[1]/t)}},all:function(e,t,n){for(let i=0,r=t.length;i<r;i++){const r=t[i];if(!e.get(r))return void e.setValueType(n.value,!1)}e.setValueType(n.value,!0)},any:function(e,t,n){for(let i=0,r=t.length;i<r;i++){const r=t[i];if(e.get(r))return void e.setValueType(n.value,!0)}e.setValueType(n.value,!1)},touch_axis_scroll:(e,t)=>(void 0===e&&(e=1),function(n,i,r,o){return void 0===o&&(o={value:0,touching:!1}),(void 0===t||Math.abs(n.get(i.value)-o.value)>=t)&&n.setValueType(r.value,o.touching&&n.get(i.touching)?e*(n.get(i.value)-o.value):0),o.value=n.get(i.value),o.touching=n.get(i.touching),o}),diff_vec2:function(e,t,n,i){void 0===i&&(i=[0,0]);const r=e.get(t.value);return r&&(e.setVector2(n.value,r[0]-i[0],r[1]-i[1]),i[0]=r[0],i[1]=r[1]),i},invert_vec2_if_preference:e=>function(t,n,i){const r=t.get(n.value);if(r){const n=window.APP&&window.APP.store&&window.APP.store.state&&window.APP.store.state.preferences&&(window.APP.store.state.preferences[e]||void 0===window.APP.store.state.preferences[e])?-1:1;t.setVector2(i.value,r[0]*n,r[1]*n)}}},WW=e=>{for(const t in e)for(const n of e[t])n.sets||(n.sets=[]),n.sets.push(t);return e},qW="/var/mouse-and-keyboard/wasd_vec2",ZW="/var/mouse-and-keyboard/keyboardCharacterAcceleration",GW="/var/mouse-and-keyboard/arrows_vec2",YW="/vars/mouse-and-keyboard/drop_pen_with_RMB",QW="/vars/mouse-and-keyboard/drop_pen_with_esc",XW="/vars/mouse-and-keyboard/drop_pen_with_p",KW="/vars/mouse-and-keyboard/drop_pen_with_hud",$W="/vars/mouse-and-keyboard/togglePen",JW="/vars/mouse-and-keyboard/startInspectingViaMouse",eq="/vars/mouse-and-keyboard/startInspectingViaKeyboard",tq="/vars/mouse-and-keyboard/stopInspectingViaKeyboard",nq="/vars/mouse-and-keyboard/stopInspectingViaKeyboardFocus",iq="/vars/mouse-and-keyboard/stopInspectingSelf",rq=new URLSearchParams(location.search),oq=parseFloat(rq.get("izs"))||-10,sq=e=>`/keyboard-mouse-user/keyboard-var/${e}`,aq=[{src:{value:zm.device.mouse.wheel},dest:{value:zm.actions.cursor.right.mediaVolumeMod},xform:zW.scale(-.3),priority:1}];if((0,z.Z)("newLoader")){const e=3;aq.push({src:{value:zm.device.mouse.buttonLeft},dest:{value:sq("mousedown")},xform:zW.rising,priority:e}),aq.push({src:{value:zm.device.mouse.buttonLeft},dest:{value:sq("mouseup")},xform:zW.falling,priority:e}),aq.push({src:{rising:sq("mousedown"),falling:sq("mouseup")},dest:{click:zm.actions.cursor.right.togglePlayVideo,grab:zm.actions.cursor.right.grab,drop:zm.actions.cursor.right.drop},xform:zW.clickAndHold(),priority:e})}const lq=WW({[pH]:[{src:{},dest:{value:zm.actions.cursor.right.hideLine},xform:zW.always(!0)},{src:{},dest:{value:zm.actions.cursor.right.wake},xform:zW.always(!0)},{src:{},dest:{value:zm.actions.cursor.left.wake},xform:zW.always(!1)},{src:{w:zm.device.keyboard.key("arrowup"),a:zm.device.keyboard.key("arrowleft"),s:zm.device.keyboard.key("arrowdown"),d:zm.device.keyboard.key("arrowright")},dest:{vec2:GW},xform:zW.wasd_to_vec2},{src:{w:zm.device.keyboard.key("w"),a:zm.device.keyboard.key("a"),s:zm.device.keyboard.key("s"),d:zm.device.keyboard.key("d")},dest:{vec2:qW},xform:zW.wasd_to_vec2},{src:{first:qW,second:GW},dest:{value:ZW},xform:zW.max_vec2},{src:{value:ZW},dest:{value:zm.actions.characterAcceleration},xform:zW.normalize_vec2},{src:{value:zm.device.mouse.wheel},dest:{value:zm.actions.dCharSpeed},xform:zW.scale(-.3)},{src:{value:zm.device.keyboard.key("shift")},dest:{value:zm.actions.boost},xform:zW.copy,priority:1},{src:{value:zm.device.keyboard.key("Escape")},dest:{value:zm.actions.camera.exitMirror},xform:zW.falling},{src:{value:zm.device.keyboard.key("q")},dest:{value:zm.actions.snapRotateLeft},xform:zW.rising},{src:{value:zm.device.keyboard.key("g")},dest:{value:zm.actions.toggleFly},xform:zW.rising},{src:{value:zm.device.keyboard.key("`")},dest:{value:zm.actions.toggleUI},xform:zW.rising},{src:{value:zm.device.keyboard.key("e")},dest:{value:zm.actions.snapRotateRight},xform:zW.rising},{src:{value:zm.device.keyboard.key("b")},dest:{value:zm.actions.toggleRecord},xform:zW.rising},{src:{value:zm.device.keyboard.key("Tab")},dest:{value:zm.actions.toggleFreeze},xform:zW.rising},{src:{value:zm.device.keyboard.key(" ")},dest:{value:zm.actions.ensureFrozen},xform:zW.copy},{src:{value:zm.device.keyboard.key(" ")},dest:{value:zm.actions.thaw},xform:zW.falling},{src:{value:zm.device.keyboard.key("p")},dest:{value:XW},xform:zW.rising},{src:{value:zm.device.hud.penButton},dest:{value:KW},xform:zW.rising},{src:[KW,XW],dest:{value:$W},xform:zW.any},{src:{value:$W},dest:{value:zm.actions.spawnPen},xform:zW.rising,priority:100},{src:{value:zm.device.keyboard.key("c")},dest:{value:zm.actions.toggleCamera},xform:zW.rising},{src:{value:zm.device.smartMouse.cursorPose},dest:{value:zm.actions.cursor.right.pose},xform:zW.copy},{src:{value:zm.device.mouse.coords},dest:{value:"/var/mouseCoordsDelta"},xform:zW.diff_vec2},{src:{value:"/var/mouseCoordsDelta"},dest:{x:"/var/mouseCoordsX",y:"/var/mouseCoordsY"},xform:zW.split_vec2},{src:{value:"/var/mouseCoordsX"},dest:{value:"/var/mouseCoordsXScaled"},xform:zW.scale(-Math.PI)},{src:{value:"/var/mouseCoordsY"},dest:{value:"/var/mouseCoordsYScaled"},xform:zW.scale(2*Math.PI/3)},{src:{x:"/var/mouseCoordsXScaled",y:"/var/mouseCoordsYScaled"},dest:{value:"/var/actions/cameraDelta"},xform:zW.compose_vec2},{src:{value:"/var/actions/cameraDelta",bool:zm.device.smartMouse.shouldMoveCamera},dest:{value:zm.actions.cameraDelta},xform:zW.copyVec2IfTrue},{src:{value:zm.actions.cameraDelta},dest:{value:zm.actions.lobbyCameraDelta},xform:zW.copy},{src:{value:zm.device.keyboard.key("m")},dest:{value:zm.actions.muteMic},xform:zW.rising},{src:{value:zm.device.keyboard.key("t")},dest:{value:zm.actions.focusChat},xform:zW.rising},{src:{value:zm.device.keyboard.key("/")},dest:{value:zm.actions.focusChatCommand},xform:zW.rising},{src:{value:zm.device.keyboard.key("Escape")},dest:{value:zm.actions.mediaExit},xform:zW.rising},{src:{bool:zm.device.keyboard.key("control"),value:zm.device.keyboard.key("1")},dest:{value:"/var/control+1"},xform:zW.copyIfTrue},{src:{value:"/var/control+1"},dest:{value:zm.actions.mediaSearch1},xform:zW.rising},{src:{bool:zm.device.keyboard.key("control"),value:zm.device.keyboard.key("2")},dest:{value:"/var/control+2"},xform:zW.copyIfTrue},{src:{value:"/var/control+2"},dest:{value:zm.actions.mediaSearch2},xform:zW.rising},{src:{bool:zm.device.keyboard.key("control"),value:zm.device.keyboard.key("3")},dest:{value:"/var/control+3"},xform:zW.copyIfTrue},{src:{value:"/var/control+3"},dest:{value:zm.actions.mediaSearch3},xform:zW.rising},{src:{bool:zm.device.keyboard.key("control"),value:zm.device.keyboard.key("4")},dest:{value:"/var/control+4"},xform:zW.copyIfTrue},{src:{value:"/var/control+4"},dest:{value:zm.actions.mediaSearch4},xform:zW.rising},{src:{bool:zm.device.keyboard.key("control"),value:zm.device.keyboard.key("5")},dest:{value:"/var/control+5"},xform:zW.copyIfTrue},{src:{value:"/var/control+5"},dest:{value:zm.actions.mediaSearch5},xform:zW.rising},{src:{bool:zm.device.keyboard.key("control"),value:zm.device.keyboard.key("6")},dest:{value:"/var/control+6"},xform:zW.copyIfTrue},{src:{value:"/var/control+6"},dest:{value:zm.actions.mediaSearch6},xform:zW.rising},{src:{bool:zm.device.keyboard.key("control"),value:zm.device.keyboard.key("7")},dest:{value:"/var/control+7"},xform:zW.copyIfTrue},{src:{value:"/var/control+7"},dest:{value:zm.actions.mediaSearch7},xform:zW.rising},{src:{bool:zm.device.keyboard.key("control"),value:zm.device.keyboard.key("8")},dest:{value:"/var/control+8"},xform:zW.copyIfTrue},{src:{value:"/var/control+8"},dest:{value:zm.actions.mediaSearch8},xform:zW.rising},{src:{value:zm.device.keyboard.key("l")},dest:{value:zm.actions.logDebugFrame},xform:zW.rising},{src:{value:zm.device.keyboard.key("k")},dest:{value:zm.actions.logInteractionState},xform:zW.rising},{src:{value:zm.device.mouse.buttonRight},dest:{value:zm.actions.startGazeTeleport},xform:zW.rising,priority:100},{src:{value:zm.device.mouse.buttonRight},dest:{value:zm.actions.stopGazeTeleport},xform:zW.falling,priority:100},{src:{value:zm.device.keyboard.key("o")},dest:{value:zm.actions.nextCameraMode},xform:zW.rising},{src:{bool:zm.device.keyboard.key("control"),value:zm.device.keyboard.key("1")},dest:{value:"/var/notcontrol+1"},xform:zW.copyIfFalse},{src:{value:"/var/notcontrol+1"},dest:{value:zm.actions.spawnEmoji0},xform:zW.rising},{src:{bool:zm.device.keyboard.key("control"),value:zm.device.keyboard.key("2")},dest:{value:"/var/notcontrol+2"},xform:zW.copyIfFalse},{src:{value:"/var/notcontrol+2"},dest:{value:zm.actions.spawnEmoji1},xform:zW.rising},{src:{bool:zm.device.keyboard.key("control"),value:zm.device.keyboard.key("3")},dest:{value:"/var/notcontrol+3"},xform:zW.copyIfFalse},{src:{value:"/var/notcontrol+3"},dest:{value:zm.actions.spawnEmoji2},xform:zW.rising},{src:{bool:zm.device.keyboard.key("control"),value:zm.device.keyboard.key("4")},dest:{value:"/var/notcontrol+4"},xform:zW.copyIfFalse},{src:{value:"/var/notcontrol+4"},dest:{value:zm.actions.spawnEmoji3},xform:zW.rising},{src:{bool:zm.device.keyboard.key("control"),value:zm.device.keyboard.key("5")},dest:{value:"/var/notcontrol+5"},xform:zW.copyIfFalse},{src:{value:"/var/notcontrol+5"},dest:{value:zm.actions.spawnEmoji4},xform:zW.rising},{src:{bool:zm.device.keyboard.key("control"),value:zm.device.keyboard.key("6")},dest:{value:"/var/notcontrol+6"},xform:zW.copyIfFalse},{src:{value:"/var/notcontrol+6"},dest:{value:zm.actions.spawnEmoji5},xform:zW.rising},{src:{bool:zm.device.keyboard.key("control"),value:zm.device.keyboard.key("7")},dest:{value:"/var/notcontrol+7"},xform:zW.copyIfFalse},{src:{value:"/var/notcontrol+7"},dest:{value:zm.actions.spawnEmoji6},xform:zW.rising},{src:{value:zm.device.keyboard.key("i")},dest:{value:zm.actions.startInspectingSelf},xform:zW.rising}],[_H]:[{src:{bool:zm.device.keyboard.key("shift"),value:zm.device.keyboard.key("q")},dest:{value:"/var/shift+q"},xform:zW.copyIfTrue,priority:1},{src:{value:"/var/shift+q"},dest:{value:zm.actions.cursor.right.penPrevColor},xform:zW.rising},{src:{bool:zm.device.keyboard.key("shift"),value:zm.device.keyboard.key("e")},dest:{value:"/var/shift+e"},xform:zW.copyIfTrue,priority:1},{src:{value:"/var/shift+e"},dest:{value:zm.actions.cursor.right.penNextColor},xform:zW.rising},{src:{bool:zm.device.keyboard.key("shift"),value:zm.device.keyboard.key("q")},dest:{value:"/var/notshift+q"},xform:zW.copyIfFalse,priority:1},{src:{value:"/var/notshift+q"},dest:{value:zm.actions.snapRotateLeft},xform:zW.rising,priority:200},{src:{bool:zm.device.keyboard.key("shift"),value:zm.device.keyboard.key("e")},dest:{value:"/var/notshift+e"},xform:zW.copyIfFalse,priority:1},{src:{value:"/var/notshift+e"},dest:{value:zm.actions.snapRotateRight},xform:zW.rising,priority:200},{src:{value:zm.device.mouse.buttonLeft},dest:{value:zm.actions.cursor.right.startDrawing},xform:zW.rising,priority:3},{src:{value:zm.device.mouse.buttonLeft},dest:{value:zm.actions.cursor.right.stopDrawing},xform:zW.falling,priority:3},{src:{value:sq("wheelWithShift")},dest:{value:"/var/cursorScalePenTipWheel"},xform:zW.copy,priority:200},{src:{value:"/var/cursorScalePenTipWheel"},dest:{value:zm.actions.cursor.right.scalePenTip},xform:zW.scale(.03)},{src:{value:zm.device.mouse.buttonRight},dest:{value:YW},xform:zW.falling,priority:200},{src:{value:zm.device.keyboard.key("Escape")},dest:{value:QW},xform:zW.rising},{src:[YW,QW,XW,KW],dest:{value:$W},xform:zW.any},{src:{bool:zm.device.keyboard.key("control"),value:zm.device.keyboard.key("z")},dest:{value:zm.actions.cursor.right.undoDrawing},priority:1001,xform:zW.rising},{src:{value:$W},dest:{value:zm.actions.cursor.right.drop},xform:zW.rising,priority:200},{src:{value:$W},dest:{value:zm.actions.pen.remove},xform:zW.rising,priority:200}],[EH]:[{src:{value:zm.device.mouse.buttonLeft},dest:{value:zm.actions.cursor.right.drop},xform:zW.falling,priority:2},{src:{value:sq("wheelWithShift")},dest:{value:zm.actions.cursor.right.scaleGrabbedGrabbable},xform:zW.noop,priority:2}],[AH]:[{src:{bool:zm.device.keyboard.key("shift"),value:zm.device.mouse.wheel},dest:{value:sq("wheelWithShift")},xform:zW.copyIfTrue,priority:1},{src:{bool:zm.device.keyboard.key("shift"),value:zm.device.mouse.wheel},dest:{value:sq("wheelWithoutShift")},xform:zW.copyIfFalse,priority:1},{src:{value:sq("wheelWithoutShift")},dest:{value:zm.actions.cursor.right.modDelta},xform:zW.copy},{src:{value:sq("wheelWithShift")},dest:{value:zm.actions.cursor.right.scaleGrabbedGrabbable},xform:zW.copy},{src:{value:zm.device.mouse.buttonLeft},dest:{value:zm.actions.cursor.right.drop},xform:zW.falling,priority:2}],[SH]:[{src:{value:zm.device.mouse.buttonLeft},dest:{value:zm.actions.cursor.right.drop},xform:zW.falling,priority:3},{src:{value:zm.device.keyboard.key("shift")},dest:{value:zm.actions.transformModifier},xform:zW.copy,priority:1}],[vH]:[{src:{value:zm.device.mouse.buttonLeft},dest:{value:zm.actions.cursor.right.grab},xform:zW.rising,priority:1},{src:{value:zm.device.mouse.buttonRight},dest:{value:JW},xform:zW.rising,priority:200},{src:{value:zm.device.keyboard.key("f")},dest:{value:eq},xform:zW.rising,priority:200},{src:[JW,eq],dest:{value:zm.actions.startInspecting},xform:zW.any,priority:201},{src:{value:zm.device.keyboard.key("x")},dest:{value:zm.actions.cursor.right.deleteEntity},xform:zW.rising}],[yH]:aq,[mH]:[{src:{value:"/device/keyboard"},dest:{value:zm.noop},xform:zW.noop,priority:1e3},{src:{bool:zm.device.keyboard.key("control"),value:zm.device.keyboard.key("1")},dest:{value:"/var/control+1"},xform:zW.copyIfTrue,priority:1001},{src:{value:"/var/control+1"},dest:{value:zm.actions.mediaSearch1},xform:zW.rising},{src:{bool:zm.device.keyboard.key("control"),value:zm.device.keyboard.key("2")},dest:{value:"/var/control+2"},priority:1001,xform:zW.copyIfTrue},{src:{value:"/var/control+2"},dest:{value:zm.actions.mediaSearch2},xform:zW.rising},{src:{bool:zm.device.keyboard.key("control"),value:zm.device.keyboard.key("3")},dest:{value:"/var/control+3"},priority:1001,xform:zW.copyIfTrue},{src:{value:"/var/control+3"},dest:{value:zm.actions.mediaSearch3},xform:zW.rising},{src:{bool:zm.device.keyboard.key("control"),value:zm.device.keyboard.key("4")},dest:{value:"/var/control+4"},priority:1001,xform:zW.copyIfTrue},{src:{value:"/var/control+4"},dest:{value:zm.actions.mediaSearch4},xform:zW.rising},{src:{bool:zm.device.keyboard.key("control"),value:zm.device.keyboard.key("5")},dest:{value:"/var/control+5"},priority:1001,xform:zW.copyIfTrue},{src:{value:"/var/control+5"},dest:{value:zm.actions.mediaSearch5},xform:zW.rising},{src:{bool:zm.device.keyboard.key("control"),value:zm.device.keyboard.key("6")},dest:{value:"/var/control+6"},priority:1001,xform:zW.copyIfTrue},{src:{value:"/var/control+6"},dest:{value:zm.actions.mediaSearch6},xform:zW.rising},{src:{bool:zm.device.keyboard.key("control"),value:zm.device.keyboard.key("7")},dest:{value:"/var/control+7"},priority:1001,xform:zW.copyIfTrue},{src:{value:"/var/control+7"},dest:{value:zm.actions.mediaSearch7},xform:zW.rising},{src:{bool:zm.device.keyboard.key("control"),value:zm.device.keyboard.key("8")},dest:{value:"/var/control+8"},priority:1001,xform:zW.copyIfTrue},{src:{value:"/var/control+8"},dest:{value:zm.actions.mediaSearch8},xform:zW.rising}],[bH]:[{src:{value:zm.device.mouse.buttonLeft},dest:{value:zm.actions.cursor.right.grab},xform:zW.rising}],[ez]:[{src:{value:zm.device.keyboard.key("space")},dest:{value:sq("space-rising")},xform:zW.rising},{src:[zm.device.keyboard.key("Escape"),zm.device.keyboard.key("w"),zm.device.keyboard.key("a"),zm.device.keyboard.key("s"),zm.device.keyboard.key("d"),zm.device.keyboard.key("q"),zm.device.keyboard.key("e"),sq("space-rising")],dest:{value:tq},xform:zW.any},{src:{value:zm.device.mouse.wheel},dest:{value:zm.actions.inspectZoom},xform:zW.scale(oq),priority:1},{src:{value:zm.device.mouse.movementXY},dest:{x:"/var/movementX",y:"/var/movementY"},xform:zW.split_vec2},{src:{bool:zm.device.mouse.buttonMiddle,value:"/var/movementY"},dest:{value:"/var/middle-mouse-move-y"},xform:zW.copyIfTrue},{src:{value:"/var/middle-mouse-move-y"},dest:{value:zm.actions.inspectPanY},xform:zW.scale(.001)},{src:{value:zm.device.keyboard.key("f")},dest:{value:nq},xform:zW.rising},{src:{value:zm.device.keyboard.key("i")},dest:{value:iq},xform:zW.rising},{src:[tq,nq,iq],dest:{value:zm.actions.stopInspecting},xform:zW.any}],[JH]:[{src:{value:zm.device.keyboard.key("m")},dest:{value:zm.actions.debugUserInput.describeCurrentMasks},xform:zW.rising,priority:10}]}),cq="/vars/touchscreen/zero",dq="/vars/touchscreen/pinchDeltaForward",uq="vars/touchscreen/touchCameraDeltaMaybeInverted",hq="vars/touchscreen/touchCameraDelta",pq="vars/touchscreen/touchCameraDelta/x",mq="vars/touchscreen/touchCameraDelta/y",fq="vars/touchscreen/touchCameraDelta/x/scaled",gq="vars/touchscreen/touchCameraDelta/y/scaled",vq="vars/gyro/gyroCameraDelta",bq="vars/gyro/gyroCameraDelta/x/scaled",yq="vars/gyro/gyroCameraDelta/y/scaled",wq="/vars/touchscreen/togglePen",_q=WW({[pH]:[{src:{},dest:{value:zm.actions.cursor.right.hideLine},xform:zW.always(!0)},{src:{value:zm.device.touchscreen.pinch.delta},dest:{value:dq},xform:zW.scale(.25)},{src:{value:zm.device.touchscreen.tap2},dest:{value:zm.actions.toggleFreeze},xform:zW.copy},{src:{},dest:{value:cq},xform:zW.always(0)},{src:{x:cq,y:dq},dest:{value:zm.actions.characterAcceleration},xform:zW.compose_vec2},{src:{value:zm.device.touchscreen.cursorPose},dest:{value:zm.actions.cursor.right.pose},xform:zW.copy},{src:{value:zm.device.touchscreen.touchCameraDelta},dest:{x:pq,y:mq},xform:zW.split_vec2},{src:{value:pq},dest:{value:fq},xform:zW.scale(-Math.PI)},{src:{value:mq},dest:{value:gq},xform:zW.scale(-Math.PI/2)},{src:{x:fq,y:gq},dest:{value:hq},xform:zW.compose_vec2},{src:{value:hq},dest:{value:uq},xform:zW.invert_vec2_if_preference("invertTouchscreenCameraMove")},{src:{value:zm.device.gyro.averageDeltaX},dest:{value:bq},xform:zW.scale(1)},{src:{value:zm.device.gyro.averageDeltaY},dest:{value:yq},xform:zW.scale(1)},{src:{x:yq,y:bq},dest:{value:vq},xform:zW.compose_vec2},{src:{first:uq,second:vq},dest:{value:zm.actions.cameraDelta},xform:zW.add_vec2},{src:{value:uq},dest:{value:zm.actions.lobbyCameraDelta},xform:zW.copy},{src:{value:zm.device.touchscreen.isTouchingGrabbable},dest:{value:zm.actions.cursor.right.grab},xform:zW.rising},{src:{value:zm.device.hud.penButton},dest:{value:wq},xform:zW.rising},{src:{value:wq},dest:{value:zm.actions.spawnPen},xform:zW.rising,priority:2}],[AH]:[{src:{value:zm.device.touchscreen.isTouchingGrabbable},dest:{value:zm.actions.cursor.right.drop},xform:zW.falling,priority:1}],[fH]:[],[_H]:[{src:{value:zm.device.touchscreen.isTouchingGrabbable},dest:{value:zm.actions.cursor.right.startDrawing},xform:zW.risingWithFrameDelay(5),priority:2},{src:{value:zm.device.touchscreen.isTouchingGrabbable},dest:{value:zm.actions.cursor.right.stopDrawing},xform:zW.falling,priority:2},{src:{value:wq},dest:{value:zm.actions.cursor.right.drop},xform:zW.rising,priority:3},{src:{value:wq},dest:{value:zm.actions.pen.remove},xform:zW.rising,priority:3}],[ez]:[{src:{value:zm.device.touchscreen.pinch.delta},dest:{value:zm.actions.inspectZoom},xform:zW.scale(.025),priority:1}]}),Eq=WW({[pH]:[{src:{value:zm.device.keyboard.key("l")},dest:{value:zm.actions.logDebugFrame},xform:zW.rising}]}),Aq="/touch/var/",Sq=zm.device.leftOculusTouch.button,xq=zm.device.leftOculusTouch.axis,Mq=zm.device.leftOculusTouch.pose,Pq=zm.device.rightOculusTouch.button,Cq=zm.device.rightOculusTouch.axis,kq=zm.device.rightOculusTouch.pose,Oq=`${Aq}left/wake`,Tq=`${Aq}right/wake`,Rq=`${Aq}left/joy/x/deadzoned`,Dq=`${Aq}left/joy/y/deadzoned`,jq=`${Aq}left/scaledJoyX`,Lq=`${Aq}left/scaledJoyY`,Iq=`${Aq}right/cursorDrop2`,Nq=`${Aq}right/cursorDrop1`,Fq=`${Aq}left/cursorDrop2`,Bq=`${Aq}left/cursorDrop1`,Vq=`${Aq}right/rightHandDrop2`,Uq=`${Aq}right/grip/RisingGrab`,Hq=`${Aq}right/trigger/RisingGrab`,zq=`${Aq}left/grip/RisingGrab`,Wq=`${Aq}left/trigger/RisingGrab`,qq=`${Aq}rightDpad/north`,Zq=`${Aq}rightDpad/south`,Gq=`${Aq}rightDpad/east`,Yq=`${Aq}rightDpad/west`,Qq=`${Aq}rightDpad/center`,Xq=`${Aq}right/joy`,Kq=`${Aq}right/joyY1`,$q=`${Aq}right/joyY2`,Jq=`${Aq}right/joy/y/deadzoned`,eZ=`${Aq}leftDpad/north`,tZ=`${Aq}leftDpad/south`,nZ=`${Aq}leftDpad/east`,iZ=`${Aq}leftDpad/west`,rZ=`${Aq}leftDpad/center`,oZ=`${Aq}left/joy`,sZ=`${Aq}characterAcceleration`,aZ="/var/keyboard/characterAcceleration",lZ="/var/oculus-touch/nonNormalizedCharacterAcceleration",cZ="/var/keyboard/wasd_vec2",dZ="/var/keyboard/arrows_vec2",uZ="/var/keyboard-oculus/boost",hZ="/var/right-oculus/boost",pZ="/var/left-oculus/boost",mZ=`${Aq}/right/snap-right`,fZ=`${Aq}/right/snap-left`,gZ=`${Aq}/keyboard/snap-right`,vZ=`${Aq}/keyboard/snap-left`,bZ=`${Aq}buttons/lower`,yZ=`${Aq}buttons/upper`,wZ=`${Aq}buttons/ensureFrozen`,_Z=`${Aq}keyboard/ensureFrozen`,EZ=`${Aq}buttons/thaw`,AZ=`${Aq}keyboard/thaw`,SZ=e=>"/oculus-touch-user-vars/"+e,xZ=SZ("leftGripPressed1"),MZ=SZ("leftGripPressed2"),PZ=SZ("rightGripPressed1"),CZ=SZ("rightGripPressed2"),kZ=SZ("leftTriggerPressed1"),OZ=SZ("leftTriggerPressed2"),TZ=SZ("rightTriggerPressed1"),RZ=SZ("rightTriggerPressed2"),DZ=WW({[pH]:[{src:{value:zm.device.leftOculusTouch.matrix},dest:{value:zm.actions.leftHand.matrix},xform:zW.copy},{src:{value:zm.device.rightOculusTouch.matrix},dest:{value:zm.actions.rightHand.matrix},xform:zW.copy},{src:[wZ,_Z],dest:{value:zm.actions.ensureFrozen},xform:zW.any},{src:[EZ,AZ],dest:{value:zm.actions.thaw},xform:zW.any},{src:{value:Sq("grip").pressed},dest:{value:xZ},xform:zW.copy},{src:{value:Sq("grip").pressed},dest:{value:MZ},xform:zW.copy},{src:{value:xZ},dest:{value:zm.actions.leftHand.middleRingPinky},xform:zW.copy},{src:[Sq("x").touched,Sq("y").touched,Sq("thumbStick").touched],dest:{value:zm.actions.leftHand.thumb},xform:zW.any},{src:{value:Sq("trigger").pressed},dest:{value:kZ},xform:zW.copy},{src:{value:Sq("trigger").pressed},dest:{value:OZ},xform:zW.copy},{src:{value:kZ},dest:{value:zm.actions.leftHand.index},xform:zW.copy},{src:{value:Pq("grip").pressed},dest:{value:PZ},xform:zW.copy},{src:{value:Pq("grip").pressed},dest:{value:CZ},xform:zW.copy},{src:{value:PZ},dest:{value:zm.actions.rightHand.middleRingPinky},xform:zW.copy},{src:[Pq("a").touched,Pq("b").touched,Pq("thumbStick").touched],dest:{value:zm.actions.rightHand.thumb},xform:zW.any},{src:{value:Pq("trigger").pressed},dest:{value:TZ},xform:zW.copy},{src:{value:Pq("trigger").pressed},dest:{value:RZ},xform:zW.copy},{src:{value:TZ},dest:{value:zm.actions.rightHand.index},xform:zW.copy},{src:{x:xq("joyX"),y:xq("joyY")},dest:{value:oZ},xform:zW.compose_vec2},{src:{value:oZ},dest:{north:eZ,south:tZ,east:nZ,west:iZ,center:rZ},xform:zW.vec2dpad(.2,!1,!0)},{src:{value:Cq("joyY")},dest:{value:Kq},xform:zW.copy},{src:{value:Cq("joyY")},dest:{value:$q},xform:zW.copy},{src:{x:Cq("joyX"),y:Kq},dest:{value:Xq},xform:zW.compose_vec2},{src:{value:Xq},dest:{north:qq,south:Zq,east:Gq,west:Yq,center:Qq},xform:zW.vec2dpad(.2,!1,!0)},{src:{value:Gq},dest:{value:mZ},xform:zW.rising,priority:1},{src:{value:zm.device.keyboard.key("e")},dest:{value:gZ},xform:zW.rising},{src:[mZ,gZ],dest:{value:zm.actions.snapRotateRight},xform:zW.any},{src:{value:zm.device.keyboard.key("Tab")},dest:{value:zm.actions.toggleFreeze},xform:zW.rising},{src:{value:zm.device.keyboard.key(" ")},dest:{value:_Z},xform:zW.copy},{src:[Sq("x").pressed,Pq("a").pressed],dest:{value:bZ},xform:zW.any},{src:[Sq("y").pressed,Pq("b").pressed],dest:{value:yZ},xform:zW.any},{src:{value:bZ},dest:{value:wZ},xform:zW.copy},{src:{value:bZ},dest:{value:EZ},xform:zW.falling},{src:{value:zm.device.keyboard.key(" ")},dest:{value:AZ},xform:zW.falling},{src:{value:Yq},dest:{value:fZ},xform:zW.rising,priority:1},{src:{value:zm.device.keyboard.key("q")},dest:{value:vZ},xform:zW.rising},{src:[fZ,vZ],dest:{value:zm.actions.snapRotateLeft},xform:zW.any},{src:{value:xq("joyY")},dest:{value:Dq},xform:zW.deadzone(.1)},{src:{value:Dq},dest:{value:Lq},xform:zW.scale(-1.5)},{src:{value:xq("joyX")},dest:{value:Rq},xform:zW.deadzone(.1)},{src:{value:Rq},dest:{value:jq},xform:zW.scale(1.5)},{src:{x:jq,y:Lq},dest:{value:sZ},xform:zW.compose_vec2},{src:{w:zm.device.keyboard.key("arrowup"),a:zm.device.keyboard.key("arrowleft"),s:zm.device.keyboard.key("arrowdown"),d:zm.device.keyboard.key("arrowright")},dest:{vec2:dZ},xform:zW.wasd_to_vec2},{src:{w:zm.device.keyboard.key("w"),a:zm.device.keyboard.key("a"),s:zm.device.keyboard.key("s"),d:zm.device.keyboard.key("d")},dest:{vec2:cZ},xform:zW.wasd_to_vec2},{src:{first:cZ,second:dZ},dest:{value:aZ},xform:zW.max_vec2},{src:{first:sZ,second:aZ},dest:{value:lZ},xform:zW.max_vec2},{src:{value:lZ,override:"/device/overrides/foo"},dest:{value:zm.actions.characterAcceleration},xform:zW.copy},{src:{value:zm.device.keyboard.key("shift")},dest:{value:uZ},xform:zW.copy},{src:{value:Sq("y").pressed},dest:{value:pZ},xform:zW.copy},{src:{value:Pq("b").pressed},dest:{value:hZ},xform:zW.copy},{src:{value:Sq("thumbStick").pressed},dest:{value:zm.actions.nextCameraMode},xform:zW.rising},{src:{value:Pq("thumbStick").pressed},dest:{value:zm.actions.toggleFly},xform:zW.rising},{src:[uZ,pZ,hZ],dest:{value:zm.actions.boost},xform:zW.any},{src:{value:zm.device.keyboard.key("t")},dest:{value:zm.actions.focusChat},xform:zW.rising},{src:{value:zm.device.keyboard.key("/")},dest:{value:zm.actions.focusChatCommand},xform:zW.rising},{src:{value:zm.device.keyboard.key("Escape")},dest:{value:zm.actions.mediaExit},xform:zW.rising},{src:{value:zm.device.keyboard.key("p")},dest:{value:zm.actions.spawnPen},xform:zW.rising},{src:{value:zm.device.keyboard.key("c")},dest:{value:zm.actions.toggleCamera},xform:zW.rising},{src:{value:zm.device.keyboard.key("x")},dest:{value:zm.actions.takeSnapshot},xform:zW.copy},{src:{bool:zm.device.keyboard.key("control"),value:zm.device.keyboard.key("1")},dest:{value:"/var/shift+1"},priority:1001,xform:zW.copyIfTrue},{src:{value:"/var/shift+1"},dest:{value:zm.actions.mediaSearch1},xform:zW.rising},{src:{bool:zm.device.keyboard.key("control"),value:zm.device.keyboard.key("2")},dest:{value:"/var/shift+2"},priority:1001,xform:zW.copyIfTrue},{src:{value:"/var/shift+2"},dest:{value:zm.actions.mediaSearch2},xform:zW.rising},{src:{bool:zm.device.keyboard.key("control"),value:zm.device.keyboard.key("3")},dest:{value:"/var/shift+3"},priority:1001,xform:zW.copyIfTrue},{src:{value:"/var/shift+3"},dest:{value:zm.actions.mediaSearch3},xform:zW.rising},{src:{bool:zm.device.keyboard.key("control"),value:zm.device.keyboard.key("4")},dest:{value:"/var/shift+4"},priority:1001,xform:zW.copyIfTrue},{src:{value:"/var/shift+4"},dest:{value:zm.actions.mediaSearch4},xform:zW.rising},{src:{bool:zm.device.keyboard.key("control"),value:zm.device.keyboard.key("5")},dest:{value:"/var/shift+5"},priority:1001,xform:zW.copyIfTrue},{src:{value:"/var/shift+5"},dest:{value:zm.actions.mediaSearch5},xform:zW.rising},{src:{bool:zm.device.keyboard.key("control"),value:zm.device.keyboard.key("6")},dest:{value:"/var/shift+6"},priority:1001,xform:zW.copyIfTrue},{src:{value:"/var/shift+6"},dest:{value:zm.actions.mediaSearch6},xform:zW.rising},{src:{bool:zm.device.keyboard.key("control"),value:zm.device.keyboard.key("7")},dest:{value:"/var/shift+7"},priority:1001,xform:zW.copyIfTrue},{src:{value:"/var/shift+7"},dest:{value:zm.actions.mediaSearch7},xform:zW.rising},{src:{bool:zm.device.keyboard.key("control"),value:zm.device.keyboard.key("8")},dest:{value:"/var/shift+8"},priority:1001,xform:zW.copyIfTrue},{src:{value:"/var/shift+8"},dest:{value:zm.actions.mediaSearch8},xform:zW.rising},{src:{value:zm.device.keyboard.key("l")},dest:{value:zm.actions.logDebugFrame},xform:zW.rising},{src:{value:zm.device.keyboard.key("k")},dest:{value:zm.actions.logInteractionState},xform:zW.rising},{src:{value:zm.device.keyboard.key("m")},dest:{value:zm.actions.muteMic},xform:zW.rising},{src:{value:Mq},dest:{value:zm.actions.cursor.left.pose},xform:zW.copy},{src:{value:kq},dest:{value:zm.actions.cursor.right.pose},xform:zW.copy},{src:{value:kq},dest:{value:zm.actions.rightHand.pose},xform:zW.copy},{src:{value:Mq},dest:{value:zm.actions.leftHand.pose},xform:zW.copy},{src:{value:RZ},dest:{value:zm.actions.rightHand.stopTeleport},xform:zW.falling,priority:1},{src:{value:OZ},dest:{value:zm.actions.leftHand.stopTeleport},xform:zW.falling,priority:1},{src:[Sq("y").pressed,Sq("x").pressed,Sq("trigger").pressed,Sq("grip").pressed],dest:{value:Oq},xform:zW.any},{src:{value:Oq},dest:{value:zm.actions.cursor.left.wake},xform:zW.rising},{src:[Pq("b").pressed,Pq("a").pressed,Pq("trigger").pressed,Pq("grip").pressed],dest:{value:Tq},xform:zW.any},{src:{value:Tq},dest:{value:zm.actions.cursor.right.wake},xform:zW.rising}],[$H]:[{src:{value:OZ},dest:{value:zm.actions.leftHand.startTeleport},xform:zW.rising,priority:1}],[bH]:[{src:{value:RZ},dest:{value:zm.actions.cursor.right.grab},xform:zW.rising,priority:2}],[kH]:[{src:{value:OZ},dest:{value:zm.actions.cursor.left.grab},xform:zW.rising,priority:2}],[yH]:[{src:{value:Cq("joyY")},dest:{value:zm.actions.cursor.right.mediaVolumeMod},xform:zW.scale(-.01)}],[OH]:[{src:{value:xq("joyY")},dest:{value:zm.actions.cursor.left.mediaVolumeMod},xform:zW.scale(-.01)}],[wH]:[{src:{value:RZ},dest:{value:zm.actions.rightHand.startTeleport},xform:zW.rising,priority:1}],[TH]:[{src:{value:OZ},dest:{value:zm.actions.leftHand.startTeleport},xform:zW.rising,priority:1}],[YH]:[{src:{value:MZ},dest:{value:zq},xform:zW.rising,priority:2},{src:[zq],dest:{value:zm.actions.leftHand.grab},xform:zW.any,priority:2},{src:{value:OZ},dest:{value:zm.actions.leftHand.stopTeleport},xform:zW.falling,priority:2}],[ez]:[{src:{value:yZ},dest:{value:zm.actions.stopInspecting},xform:zW.falling}],[KH]:[{src:{value:MZ},dest:{value:zm.actions.leftHand.drop},xform:zW.falling}],[ZH]:[],[QH]:[{src:{value:OZ},dest:{value:zm.actions.leftHand.startDrawing},xform:zW.rising,priority:3},{src:{value:OZ},dest:{value:zm.actions.leftHand.stopDrawing},xform:zW.falling,priority:3},{src:{value:nZ,override:"/device/overrides/foo"},dest:{value:zm.actions.leftHand.penNextColor},xform:zW.rising,priority:2},{src:{value:iZ,override:"/device/overrides/foo"},dest:{value:zm.actions.leftHand.penPrevColor},xform:zW.rising,priority:2},{src:{value:Dq},dest:{value:zm.actions.leftHand.scalePenTip},xform:zW.scaleExp(-.005,5),priority:1},{src:{value:Sq("y").pressed},dest:{value:zm.actions.leftHand.switchDrawMode},xform:zW.rising,priority:1},{src:{value:Sq("x").pressed},dest:{value:zm.actions.leftHand.undoDrawing},xform:zW.rising,priority:1}],[vH]:[{src:{value:CZ},dest:{value:Uq},xform:zW.rising,priority:2},{src:{value:RZ},dest:{value:Hq},xform:zW.rising,priority:2},{src:[Uq],dest:{value:zm.actions.cursor.right.grab},xform:zW.any,priority:2},{src:{value:yZ},dest:{value:zm.actions.startInspecting},xform:zW.rising}],[CH]:[{src:{value:MZ},dest:{value:zq},xform:zW.rising,priority:2},{src:{value:OZ},dest:{value:Wq},xform:zW.rising,priority:2},{src:[zq],dest:{value:zm.actions.cursor.left.grab},xform:zW.any,priority:2},{src:{value:yZ},dest:{value:zm.actions.startInspecting},xform:zW.rising}],[SH]:[{src:{value:RZ},dest:{value:Iq},xform:zW.falling,priority:5}],[LH]:[{src:{value:OZ},dest:{value:Fq},xform:zW.falling,priority:5}],[AH]:[{src:{value:Cq("joyY")},dest:{value:zm.actions.cursor.right.modDelta},xform:zW.scale(.1)},{src:{value:CZ},dest:{value:Nq},xform:zW.falling,priority:3},{src:[Nq,Iq],dest:{value:zm.actions.cursor.right.drop},xform:zW.any,priority:2}],[jH]:[{src:{value:xq("joyY")},dest:{value:zm.actions.cursor.left.modDelta},xform:zW.scale(.1)},{src:{value:MZ},dest:{value:Bq},xform:zW.falling,priority:3},{src:[Bq,Fq],dest:{value:zm.actions.cursor.left.drop},xform:zW.any,priority:2}],[fH]:[],[_H]:[{src:{value:RZ},dest:{value:zm.actions.cursor.right.startDrawing},xform:zW.rising,priority:3},{src:{value:RZ},dest:{value:zm.actions.cursor.right.stopDrawing},xform:zW.falling,priority:3},{src:{value:Pq("b").pressed},dest:{value:zm.actions.cursor.right.undoDrawing},xform:zW.rising,priority:1}],[RH]:[{src:{value:OZ},dest:{value:zm.actions.cursor.left.startDrawing},xform:zW.rising,priority:3},{src:{value:OZ},dest:{value:zm.actions.cursor.left.stopDrawing},xform:zW.falling,priority:3},{src:{value:Sq("y").pressed},dest:{value:zm.actions.cursor.left.undoDrawing},xform:zW.rising,priority:1}],[VH]:[{src:{value:CZ},dest:{value:Uq},xform:zW.rising,priority:2},{src:[Uq],dest:{value:zm.actions.rightHand.grab},xform:zW.any,priority:2},{src:{value:RZ},dest:{value:zm.actions.rightHand.stopTeleport},xform:zW.falling,priority:2}],[WH]:[{src:{value:CZ},dest:{value:Vq},xform:zW.falling,priority:3},{src:[Vq],dest:{value:zm.actions.rightHand.drop},xform:zW.any,priority:2}],[FH]:[],[HH]:[{src:{value:RZ},dest:{value:zm.actions.rightHand.startDrawing},xform:zW.rising,priority:3},{src:{value:RZ},dest:{value:zm.actions.rightHand.stopDrawing},xform:zW.falling,priority:3},{src:{value:Gq},dest:{value:zm.actions.rightHand.penNextColor},xform:zW.rising,priority:2},{src:{value:Yq},dest:{value:zm.actions.rightHand.penPrevColor},xform:zW.rising,priority:2},{src:{value:Cq("joyY")},dest:{value:Jq},xform:zW.deadzone(.1)},{src:{value:Jq},dest:{value:zm.actions.rightHand.scalePenTip},xform:zW.scaleExp(-.005,5),priority:2},{src:{value:CZ},dest:{value:zm.actions.rightHand.drop},xform:zW.falling,priority:3},{src:{value:Pq("b").pressed},dest:{value:zm.actions.rightHand.switchDrawMode},xform:zW.rising,priority:1},{src:{value:Pq("a").pressed},dest:{value:zm.actions.rightHand.undoDrawing},xform:zW.rising,priority:1}],[gH]:[],[BH]:[],[GH]:[],[zH]:[{src:{value:RZ},dest:{value:zm.actions.rightHand.takeSnapshot},xform:zW.copy,priority:4}],[XH]:[{src:{value:OZ},dest:{value:zm.actions.leftHand.takeSnapshot},xform:zW.copy,priority:4}],[EH]:[{src:{value:RZ},dest:{value:zm.actions.cursor.right.takeSnapshot},xform:zW.copy,priority:4}],[DH]:[{src:{value:OZ},dest:{value:zm.actions.cursor.left.takeSnapshot},xform:zW.copy,priority:4}],[UH]:[],[mH]:[{src:{value:"/device/keyboard"},dest:{value:zm.noop},xform:zW.noop,priority:1e3}]}),jZ=zm.device.webxr.left.button,LZ=zm.device.webxr.left.axis,IZ=zm.device.webxr.left.pose,NZ=zm.device.webxr.right.button,FZ=zm.device.webxr.right.axis,BZ=zm.device.webxr.right.pose,VZ=e=>"/webxr/var/"+e,UZ=VZ("left/wake"),HZ=VZ("right/wake"),zZ=VZ("left/joy/x/deadzoned"),WZ=VZ("left/joy/y/deadzoned"),qZ=VZ("left/scaledJoyX"),ZZ=VZ("left/scaledJoyY"),GZ=VZ("right/cursorDrop1"),YZ=VZ("right/cursorDrop2"),QZ=VZ("right/cursorDrop3"),XZ=VZ("left/cursorDrop2"),KZ=VZ("left/cursorDrop1"),$Z=VZ("right/rightHandDrop2"),JZ=VZ("right/grip/RisingGrab"),eG=VZ("left/grip/RisingGrab"),tG=VZ("rightDpad/north"),nG=VZ("rightDpad/south"),iG=VZ("rightDpad/east"),rG=VZ("rightDpad/west"),oG=VZ("rightDpad/center"),sG=VZ("right/joy"),aG=VZ("right/joyY1"),lG=VZ("right/joy/y/deadzoned"),cG=VZ("leftDpad/north"),dG=VZ("leftDpad/south"),uG=VZ("leftDpad/east"),hG=VZ("leftDpad/west"),pG=VZ("leftDpad/center"),mG=VZ("left/joy"),fG=VZ("nonNormalizedCharacterAcceleration"),gG=VZ("right/boost"),vG=VZ("left/boost"),bG=VZ("buttons/lower"),yG=VZ("buttons/upper"),wG=VZ("leftGripPressed1"),_G=VZ("leftGripPressed2"),EG=VZ("rightGripPressed1"),AG=VZ("rightGripPressed2"),SG=VZ("leftTriggerPressed1"),xG=VZ("leftTriggerPressed2"),MG=VZ("rightTriggerPressed1"),PG=VZ("rightTriggerPressed2"),CG=VZ("touchpad"),kG=VZ("touchpad/rising"),OG=VZ("dpadNorth"),TG=VZ("dpadSouth"),RG=VZ("dpadEast"),DG=VZ("dpadWest"),jG=VZ("dpadCenter"),LG=VZ("dpadCenterStrip"),IG=VZ("snapRotateRight1"),NG=VZ("snapRotateRight2"),FG=VZ("snapRotateLeft1"),BG=VZ("snapRotateLeft2"),VG=VZ("centerStripPressed"),UG=VZ("touchpadReleased"),HG=VZ("lowerButtonsReleased"),zG=WW({[pH]:[{src:{value:zm.device.webxr.left.matrix},dest:{value:zm.actions.leftHand.matrix},xform:zW.copy},{src:{value:zm.device.webxr.right.matrix},dest:{value:zm.actions.rightHand.matrix},xform:zW.copy},{src:{value:jZ.grip.pressed},dest:{value:wG},xform:zW.copy},{src:{value:jZ.grip.pressed},dest:{value:_G},xform:zW.copy},{src:{value:wG},dest:{value:zm.actions.leftHand.middleRingPinky},xform:zW.copy},{src:[jZ.a.touched,jZ.b.touched,jZ.thumbStick.touched],dest:{value:zm.actions.leftHand.thumb},xform:zW.any},{src:{value:jZ.trigger.pressed},dest:{value:SG},xform:zW.copy},{src:{value:jZ.trigger.pressed},dest:{value:xG},xform:zW.copy},{src:{value:SG},dest:{value:zm.actions.leftHand.index},xform:zW.copy},{src:{value:NZ.grip.pressed},dest:{value:EG},xform:zW.copy},{src:{value:NZ.grip.pressed},dest:{value:AG},xform:zW.copy},{src:{value:EG},dest:{value:zm.actions.rightHand.middleRingPinky},xform:zW.copy},{src:[NZ.a.touched,NZ.b.touched,NZ.thumbStick.touched],dest:{value:zm.actions.rightHand.thumb},xform:zW.any},{src:{value:NZ.trigger.pressed},dest:{value:MG},xform:zW.copy},{src:{value:NZ.trigger.pressed},dest:{value:PG},xform:zW.copy},{src:{value:MG},dest:{value:zm.actions.rightHand.index},xform:zW.copy},{src:{x:LZ.joyX,y:LZ.joyY},dest:{value:mG},xform:zW.compose_vec2},{src:{value:mG},dest:{north:cG,south:dG,east:uG,west:hG,center:pG},xform:zW.vec2dpad(.2,!1,!0)},{src:{value:FZ.joyY},dest:{value:aG},xform:zW.copy},{src:{x:FZ.joyX,y:aG},dest:{value:sG},xform:zW.compose_vec2},{src:{value:sG},dest:{north:tG,south:nG,east:iG,west:rG,center:oG},xform:zW.vec2dpad(.2,!1,!0)},{src:{value:iG},dest:{value:zm.actions.snapRotateRight},xform:zW.rising,priority:1},{src:[jZ.a.pressed,NZ.a.pressed],dest:{value:bG},xform:zW.any},{src:[jZ.b.pressed,NZ.b.pressed],dest:{value:yG},xform:zW.any},{src:{value:rG},dest:{value:zm.actions.snapRotateLeft},xform:zW.rising,priority:1},{src:{value:LZ.joyY},dest:{value:WZ},xform:zW.deadzone(.1)},{src:{value:WZ},dest:{value:ZZ},xform:zW.scale(-1.5)},{src:{value:LZ.joyX},dest:{value:zZ},xform:zW.deadzone(.1)},{src:{value:zZ},dest:{value:qZ},xform:zW.scale(1.5)},{src:{x:qZ,y:ZZ},dest:{value:fG},xform:zW.compose_vec2},{src:{value:fG},dest:{value:zm.actions.characterAcceleration},xform:zW.copy},{src:{value:jZ.b.pressed},dest:{value:vG},xform:zW.copy},{src:{value:NZ.b.pressed},dest:{value:gG},xform:zW.copy},{src:{value:jZ.thumbStick.pressed},dest:{value:zm.actions.nextCameraMode},xform:zW.rising},{src:{value:NZ.thumbStick.pressed},dest:{value:zm.actions.toggleFly},xform:zW.rising},{src:[vG,gG],dest:{value:zm.actions.boost},xform:zW.any},{src:{value:IZ},dest:{value:zm.actions.cursor.left.pose},xform:zW.copy},{src:{value:BZ},dest:{value:zm.actions.cursor.right.pose},xform:zW.copy},{src:{value:BZ},dest:{value:zm.actions.rightHand.pose},xform:zW.copy},{src:{value:IZ},dest:{value:zm.actions.leftHand.pose},xform:zW.copy},{src:{value:PG},dest:{value:zm.actions.rightHand.stopTeleport},xform:zW.falling,priority:1},{src:{value:xG},dest:{value:zm.actions.leftHand.stopTeleport},xform:zW.falling,priority:1},{src:[jZ.b.pressed,jZ.a.pressed,jZ.trigger.pressed,jZ.grip.pressed],dest:{value:UZ},xform:zW.any},{src:{value:UZ},dest:{value:zm.actions.cursor.left.wake},xform:zW.rising},{src:[NZ.b.pressed,NZ.a.pressed,NZ.trigger.pressed,NZ.grip.pressed],dest:{value:HZ},xform:zW.any},{src:{value:HZ},dest:{value:zm.actions.cursor.right.wake},xform:zW.rising},{src:{x:FZ.touchpadX,y:FZ.touchpadY},dest:{value:CG},xform:zW.compose_vec2},{src:{value:CG},dest:{north:OG,south:TG,east:RG,west:DG,center:jG},xform:zW.vec2dpad(.3)},{src:[OG,jG,TG],dest:{value:LG},xform:zW.any},{src:{value:LG,bool:NZ.touchpad.pressed},dest:{value:VG},xform:zW.copyIfTrue},{src:[VG,bG],dest:{value:zm.actions.ensureFrozen},xform:zW.any},{src:{value:NZ.touchpad.pressed},dest:{value:UG},xform:zW.falling},{src:{value:bG},dest:{value:HG},xform:zW.falling},{src:[UG,HG],dest:{value:zm.actions.thaw},xform:zW.any},{src:{value:NZ.touchpad.pressed},dest:{value:kG},xform:zW.rising},{src:{value:RG,bool:kG},dest:{value:IG},xform:zW.copyIfTrue},{src:{value:DG,bool:kG},dest:{value:FG},xform:zW.copyIfTrue},{src:{value:iG},dest:{value:NG},xform:zW.rising,priority:1},{src:{value:rG},dest:{value:BG},xform:zW.rising,priority:1},{src:[IG,NG],dest:{value:zm.actions.snapRotateRight},xform:zW.any},{src:[FG,BG],dest:{value:zm.actions.snapRotateLeft},xform:zW.any}],[$H]:[{src:{value:xG},dest:{value:zm.actions.leftHand.startTeleport},xform:zW.rising,priority:1}],[bH]:[{src:{value:PG},dest:{value:zm.actions.cursor.right.grab},xform:zW.rising,priority:2}],[kH]:[{src:{value:xG},dest:{value:zm.actions.cursor.left.grab},xform:zW.rising,priority:2}],[yH]:[{src:{value:FZ.joyY},dest:{value:zm.actions.cursor.right.mediaVolumeMod},xform:zW.scale(-.01)}],[OH]:[{src:{value:LZ.joyY},dest:{value:zm.actions.cursor.left.mediaVolumeMod},xform:zW.scale(-.01)}],[wH]:[{src:{value:PG},dest:{value:zm.actions.rightHand.startTeleport},xform:zW.rising,priority:1}],[TH]:[{src:{value:xG},dest:{value:zm.actions.leftHand.startTeleport},xform:zW.rising,priority:1}],[YH]:[{src:{value:_G},dest:{value:eG},xform:zW.rising,priority:2},{src:[eG],dest:{value:zm.actions.leftHand.grab},xform:zW.any,priority:2},{src:{value:xG},dest:{value:zm.actions.leftHand.stopTeleport},xform:zW.falling,priority:2}],[ez]:[{src:{value:yG},dest:{value:zm.actions.stopInspecting},xform:zW.falling}],[KH]:[{src:{value:_G},dest:{value:zm.actions.leftHand.drop},xform:zW.falling}],[ZH]:[],[QH]:[{src:{value:xG},dest:{value:zm.actions.leftHand.startDrawing},xform:zW.rising,priority:3},{src:{value:xG},dest:{value:zm.actions.leftHand.stopDrawing},xform:zW.falling,priority:3},{src:{value:uG},dest:{value:zm.actions.leftHand.penNextColor},xform:zW.rising,priority:2},{src:{value:hG},dest:{value:zm.actions.leftHand.penPrevColor},xform:zW.rising,priority:2},{src:{value:WZ},dest:{value:zm.actions.leftHand.scalePenTip},xform:zW.scaleExp(-.005,5),priority:1},{src:{value:jZ.b.pressed},dest:{value:zm.actions.leftHand.switchDrawMode},xform:zW.rising,priority:1},{src:{value:jZ.a.pressed},dest:{value:zm.actions.leftHand.undoDrawing},xform:zW.rising,priority:1}],[vH]:[{src:{value:AG},dest:{value:JZ},xform:zW.rising,priority:2},{src:[JZ,PG],dest:{value:zm.actions.cursor.right.grab},xform:zW.any,priority:2},{src:{value:yG},dest:{value:zm.actions.startInspecting},xform:zW.rising}],[CH]:[{src:{value:_G},dest:{value:eG},xform:zW.rising,priority:2},{src:[eG],dest:{value:zm.actions.cursor.left.grab},xform:zW.any,priority:2},{src:{value:yG},dest:{value:zm.actions.startInspecting},xform:zW.rising}],[SH]:[{src:{value:PG},dest:{value:YZ},xform:zW.falling,priority:5}],[LH]:[{src:{value:xG},dest:{value:XZ},xform:zW.falling,priority:5}],[AH]:[{src:{value:FZ.joyY},dest:{value:zm.actions.cursor.right.modDelta},xform:zW.scale(.1)},{src:{value:AG},dest:{value:GZ},xform:zW.falling,priority:3},{src:{value:PG},dest:{value:QZ},xform:zW.falling,priority:4},{src:[GZ,YZ,QZ],dest:{value:zm.actions.cursor.right.drop},xform:zW.any,priority:2}],[jH]:[{src:{value:LZ.joyY},dest:{value:zm.actions.cursor.left.modDelta},xform:zW.scale(.1)},{src:{value:_G},dest:{value:KZ},xform:zW.falling,priority:3},{src:[KZ,XZ],dest:{value:zm.actions.cursor.left.drop},xform:zW.any,priority:2}],[fH]:[],[_H]:[{src:{value:PG},dest:{value:zm.actions.cursor.right.startDrawing},xform:zW.rising,priority:3},{src:{value:PG},dest:{value:zm.actions.cursor.right.stopDrawing},xform:zW.falling,priority:3},{src:{value:NZ.b.pressed},dest:{value:zm.actions.cursor.right.undoDrawing},xform:zW.rising,priority:1}],[RH]:[{src:{value:xG},dest:{value:zm.actions.cursor.left.startDrawing},xform:zW.rising,priority:3},{src:{value:xG},dest:{value:zm.actions.cursor.left.stopDrawing},xform:zW.falling,priority:3},{src:{value:jZ.b.pressed},dest:{value:zm.actions.cursor.left.undoDrawing},xform:zW.rising,priority:1}],[VH]:[{src:{value:AG},dest:{value:JZ},xform:zW.rising,priority:2},{src:[JZ],dest:{value:zm.actions.rightHand.grab},xform:zW.any,priority:2},{src:{value:PG},dest:{value:zm.actions.rightHand.stopTeleport},xform:zW.falling,priority:2}],[WH]:[{src:{value:AG},dest:{value:$Z},xform:zW.falling,priority:3},{src:[$Z],dest:{value:zm.actions.rightHand.drop},xform:zW.any,priority:2}],[FH]:[],[HH]:[{src:{value:PG},dest:{value:zm.actions.rightHand.startDrawing},xform:zW.rising,priority:3},{src:{value:PG},dest:{value:zm.actions.rightHand.stopDrawing},xform:zW.falling,priority:3},{src:{value:iG},dest:{value:zm.actions.rightHand.penNextColor},xform:zW.rising,priority:2},{src:{value:rG},dest:{value:zm.actions.rightHand.penPrevColor},xform:zW.rising,priority:2},{src:{value:FZ.joyY},dest:{value:lG},xform:zW.deadzone(.1)},{src:{value:lG},dest:{value:zm.actions.rightHand.scalePenTip},xform:zW.scaleExp(-.005,5),priority:2},{src:{value:AG},dest:{value:zm.actions.rightHand.drop},xform:zW.falling,priority:3},{src:{value:NZ.b.pressed},dest:{value:zm.actions.rightHand.switchDrawMode},xform:zW.rising,priority:1},{src:{value:NZ.a.pressed},dest:{value:zm.actions.rightHand.undoDrawing},xform:zW.rising,priority:1}],[gH]:[],[BH]:[],[GH]:[],[zH]:[{src:{value:PG},dest:{value:zm.actions.rightHand.takeSnapshot},xform:zW.copy,priority:4}],[XH]:[{src:{value:xG},dest:{value:zm.actions.leftHand.takeSnapshot},xform:zW.copy,priority:4}],[EH]:[{src:{value:PG},dest:{value:QZ},xform:zW.falling,priority:4}],[DH]:[{src:{value:xG},dest:{value:zm.actions.cursor.left.takeSnapshot},xform:zW.copy,priority:4}],[UH]:[],[mH]:[]}),WG=e=>`/vive-user/vive-var/${e}`,qG=`${name}left/wake`,ZG=`${name}right/wake`,GG=zm.device.vive.left.button,YG=zm.device.vive.left.axis,QG=zm.device.vive.left.pose,XG=WG("left/joy"),KG=WG("left/joy/scaled"),$G=WG("left/joyX/scaled"),JG=WG("left/joyY/scaled"),eY=WG("left/joyY/deadzoned"),tY=WG("left/touch"),nY=WG("left/touch/scaled"),iY=WG("left/touchX/scaled"),rY=WG("left/touchY"),oY=WG("left/touchY/scaled"),sY=WG("left/dpad/north1"),aY=WG("left/dpad/south1"),lY=WG("left/dpad/east1"),cY=WG("left/dpad/west1"),dY=WG("left/dpad/center1"),uY=WG("left/dpad/north2"),hY=WG("left/dpad/south2"),pY=WG("left/dpad/east2"),mY=WG("left/dpad/west2"),fY=WG("left/dpad/center2"),gY=WG("left/trigger/falling/stopDrawing"),vY=WG("left/grip/falling/stopDrawing"),bY=WG("left/trigger/rising/grab"),yY=WG("left/grab/rising/grab"),wY=WG("left/touchpad/rising2"),_Y=WG("left/touchpad/rising1"),EY=WG("left/touch/characterAcceleration"),AY=WG("left/characterAcceleration"),SY=WG("nonNormalizedCharacterAcceleration"),xY=WG("left/boost"),MY=WG("left/drawing/undo"),PY=zm.device.vive.right.button,CY=zm.device.vive.right.axis,kY=zm.device.vive.right.pose,OY=WG("right/touch"),TY=WG("right/joy"),RY=WG("right/joyY/deadzoned"),DY=WG("right/dpad/north1"),jY=WG("right/dpad/south1"),LY=WG("right/dpad/east1"),IY=WG("right/dpad/west1"),NY=WG("right/dpad/center"),FY=WG("right/dpad/north2"),BY=WG("right/dpad/south2"),VY=WG("right/dpad/east2"),UY=WG("right/dpad/west2"),HY=WG("right/dpad/center2"),zY=WG("right/dpad/centerStrip"),WY=WG("right/touchpad/rising"),qY=WG("right/touchpad/falling"),ZY=WG("right/boost"),GY=WG("right/trigger/rising/grab"),YY=WG("right/grab/rising/grab"),QY=WG("right/cursorDrop1"),XY=WG("right/cursorDrop2"),KY=WG("left/cursorDrop1"),$Y=WG("left/cursorDrop2"),JY=WG("right/trigger/stopTeleport"),eQ=WG("right/touchpad/stopTeleport"),tQ="rootForFrozenOverrideWhenHolding",nQ=WG("right/drawing/undo"),iQ=WG("dpad/ensureFrozen"),rQ=WG("keyboard/ensureFrozen"),oQ=WG("buttons/ensureFrozen"),sQ=WG("dpad/thaw"),aQ=WG("keyboard/thaw"),lQ=WG("buttons/thaw"),cQ=WG("buttons/freeze"),dQ=WG("buttons/inspect"),uQ=WG("right/snap-right"),hQ=WG("right/snap-left"),pQ=WG("right/snap-right2"),mQ=WG("right/snap-left2"),fQ=e=>`/vive-user/keyboard-var/${e}`,gQ=fQ("snap-right"),vQ=fQ("snap-left"),bQ=fQ("characterAcceleration"),yQ=fQ("wasd_vec2"),wQ=fQ("arrows_vec2"),_Q=fQ("boost"),EQ=WG("leftGripPressed1"),AQ=WG("leftGripPressed2"),SQ=WG("rightGripPressed1"),xQ=WG("rightGripPressed2"),MQ=WG("leftTriggerPressed1"),PQ=WG("leftTriggerPressed2"),CQ=WG("leftTouchpadPressed1"),kQ=WG("leftTouchpadPressed2"),OQ=WG("rightTriggerPressed1"),TQ=WG("rightTriggerPressed2"),RQ=WG("leftTouchpadFallingStopTeleport"),DQ=WG("leftTriggerFallingStopTeleport"),jQ=WG("leftGripFallingWhileHoldingPen"),LQ=WW({[pH]:[{src:{value:zm.device.vive.left.matrix},dest:{value:zm.actions.leftHand.matrix},xform:zW.copy},{src:{value:zm.device.vive.right.matrix},dest:{value:zm.actions.rightHand.matrix},xform:zW.copy},{src:[iQ,rQ,oQ],dest:{value:zm.actions.ensureFrozen},xform:zW.any},{src:[sQ,aQ,lQ],dest:{value:zm.actions.thaw},xform:zW.any},{src:{value:GG("grip").pressed},dest:{value:EQ},xform:zW.copy},{src:{value:EQ},dest:{value:zm.actions.leftHand.middleRingPinky},xform:zW.copy},{src:{value:GG("grip").pressed},dest:{value:AQ},xform:zW.copy},{src:[GG("touchpad").touched,GG("primary").touched],dest:{value:zm.actions.leftHand.thumb},xform:zW.any},{src:{value:MQ},dest:{value:zm.actions.leftHand.index},xform:zW.copy},{src:{value:GG("trigger").pressed},dest:{value:MQ},xform:zW.copy},{src:{value:GG("trigger").pressed},dest:{value:PQ},xform:zW.copy},{src:{value:PY("grip").pressed},dest:{value:SQ},xform:zW.copy},{src:{value:PY("grip").pressed},dest:{value:xQ},xform:zW.copy},{src:{value:SQ},dest:{value:zm.actions.rightHand.middleRingPinky},xform:zW.copy},{src:[PY("touchpad").touched,PY("primary").touched],dest:{value:zm.actions.rightHand.thumb},xform:zW.any},{src:{value:PY("trigger").pressed},dest:{value:OQ},xform:zW.copy},{src:{value:PY("trigger").pressed},dest:{value:TQ},xform:zW.copy},{src:{value:OQ},dest:{value:zm.actions.rightHand.index},xform:zW.copy},{src:{x:YG("touchX"),y:YG("touchY")},dest:{value:tY},xform:zW.compose_vec2},{src:{value:tY},dest:{north:sY,south:aY,east:lY,west:cY,center:dY},xform:zW.vec2dpad(.35)},{src:{value:GG("touchpad").pressed},dest:{value:CQ},xform:zW.copy},{src:{value:GG("touchpad").pressed},dest:{value:kQ},xform:zW.copy},{src:{x:CY("touchX"),y:CY("touchY")},dest:{value:OY},xform:zW.compose_vec2},{src:{value:OY},dest:{north:DY,south:jY,east:LY,west:IY,center:NY},xform:zW.vec2dpad(.35,!1,!0)},{src:{x:CY("joyX"),y:CY("joyY")},dest:{value:TY},xform:zW.compose_vec2},{src:{value:TY},dest:{north:FY,south:BY,east:VY,west:UY,center:HY},xform:zW.vec2dpad(.35,!1,!0)},{src:[DY,jY,NY],dest:{value:zY},xform:zW.any},{src:{value:PY("touchpad").pressed},dest:{value:WY},xform:zW.rising},{src:{value:PY("touchpad").pressed},dest:{value:qY},xform:zW.falling},{src:{bool:WY,value:LY},dest:{value:uQ},xform:zW.copyIfTrue,priority:1},{src:{value:VY},dest:{value:pQ},xform:zW.rising,priority:1},{src:{value:zm.device.keyboard.key("e")},dest:{value:gQ},xform:zW.rising},{src:[uQ,pQ,gQ],dest:{value:zm.actions.snapRotateRight},xform:zW.any},{src:{value:zm.device.keyboard.key("Tab")},dest:{value:zm.actions.toggleFreeze},xform:zW.rising},{src:{value:zm.device.keyboard.key(" ")},dest:{value:rQ},xform:zW.copy},{src:{value:zm.device.keyboard.key(" ")},dest:{value:aQ},xform:zW.falling},{src:{value:zm.device.keyboard.key("p")},dest:{value:zm.actions.spawnPen},xform:zW.rising},{src:{value:zm.device.keyboard.key("c")},dest:{value:zm.actions.toggleCamera},xform:zW.rising},{src:{value:zm.device.keyboard.key("x")},dest:{value:zm.actions.takeSnapshot},xform:zW.copy},{src:{value:PY("touchpad").pressed,bool:zY},dest:{value:iQ},root:tQ,xform:zW.copyIfTrue},{src:{value:qY},dest:{value:sQ},xform:zW.copy},{src:{bool:WY,value:IY},dest:{value:hQ},xform:zW.copyIfTrue,priority:1},{src:{value:UY},dest:{value:mQ},xform:zW.rising,priority:1},{src:{value:zm.device.keyboard.key("q")},dest:{value:vQ},xform:zW.rising},{src:[hQ,mQ,vQ],dest:{value:zm.actions.snapRotateLeft},xform:zW.any},{src:{value:YG("touchX")},dest:{value:iY},xform:zW.scale(1.5)},{src:{value:rY},dest:{value:oY},xform:zW.scale(1.5)},{src:{x:iY,y:oY},dest:{value:nY},xform:zW.compose_vec2},{src:{bool:kQ,value:nY},dest:{value:EY},xform:zW.copyIfTrue},{src:{value:YG("joyX")},dest:{value:$G},xform:zW.scale(1.5)},{src:{value:YG("joyY")},dest:{value:JG},xform:zW.scale(1.5)},{src:{x:$G,y:JG},dest:{value:KG},xform:zW.compose_vec2},{src:{first:KG,second:EY},dest:{value:AY},xform:zW.max_vec2},{src:{w:zm.device.keyboard.key("arrowup"),a:zm.device.keyboard.key("arrowleft"),s:zm.device.keyboard.key("arrowdown"),d:zm.device.keyboard.key("arrowright")},dest:{vec2:wQ},xform:zW.wasd_to_vec2},{src:{w:zm.device.keyboard.key("w"),a:zm.device.keyboard.key("a"),s:zm.device.keyboard.key("s"),d:zm.device.keyboard.key("d")},dest:{vec2:yQ},xform:zW.wasd_to_vec2},{src:{value:zm.device.keyboard.key("t")},dest:{value:zm.actions.focusChat},xform:zW.rising},{src:{value:zm.device.keyboard.key("/")},dest:{value:zm.actions.focusChatCommand},xform:zW.rising},{src:{value:zm.device.keyboard.key("Escape")},dest:{value:zm.actions.mediaExit},xform:zW.rising},{src:{bool:zm.device.keyboard.key("control"),value:zm.device.keyboard.key("1")},dest:{value:"/var/shift+1"},priority:1001,xform:zW.copyIfTrue},{src:{value:"/var/shift+1"},dest:{value:zm.actions.mediaSearch1},xform:zW.rising},{src:{bool:zm.device.keyboard.key("control"),value:zm.device.keyboard.key("2")},dest:{value:"/var/shift+2"},priority:1001,xform:zW.copyIfTrue},{src:{value:"/var/shift+2"},dest:{value:zm.actions.mediaSearch2},xform:zW.rising},{src:{bool:zm.device.keyboard.key("control"),value:zm.device.keyboard.key("3")},dest:{value:"/var/shift+3"},priority:1001,xform:zW.copyIfTrue},{src:{value:"/var/shift+3"},dest:{value:zm.actions.mediaSearch3},xform:zW.rising},{src:{bool:zm.device.keyboard.key("control"),value:zm.device.keyboard.key("4")},dest:{value:"/var/shift+4"},priority:1001,xform:zW.copyIfTrue},{src:{value:"/var/shift+4"},dest:{value:zm.actions.mediaSearch4},xform:zW.rising},{src:{bool:zm.device.keyboard.key("control"),value:zm.device.keyboard.key("5")},dest:{value:"/var/shift+5"},priority:1001,xform:zW.copyIfTrue},{src:{value:"/var/shift+5"},dest:{value:zm.actions.mediaSearch5},xform:zW.rising},{src:{bool:zm.device.keyboard.key("control"),value:zm.device.keyboard.key("6")},dest:{value:"/var/shift+6"},priority:1001,xform:zW.copyIfTrue},{src:{value:"/var/shift+6"},dest:{value:zm.actions.mediaSearch6},xform:zW.rising},{src:{bool:zm.device.keyboard.key("control"),value:zm.device.keyboard.key("7")},dest:{value:"/var/shift+7"},priority:1001,xform:zW.copyIfTrue},{src:{value:"/var/shift+7"},dest:{value:zm.actions.mediaSearch7},xform:zW.rising},{src:{bool:zm.device.keyboard.key("control"),value:zm.device.keyboard.key("8")},dest:{value:"/var/shift+8"},priority:1001,xform:zW.copyIfTrue},{src:{value:"/var/shift+8"},dest:{value:zm.actions.mediaSearch8},xform:zW.rising},{src:{value:zm.device.keyboard.key("l")},dest:{value:zm.actions.logDebugFrame},xform:zW.rising},{src:{value:zm.device.keyboard.key("k")},dest:{value:zm.actions.logInteractionState},xform:zW.rising},{src:{value:zm.device.keyboard.key("m")},dest:{value:zm.actions.muteMic},xform:zW.rising},{src:{first:yQ,second:wQ},dest:{value:bQ},xform:zW.max_vec2},{src:{first:AY,second:bQ},dest:{value:SY},xform:zW.max_vec2},{src:{value:SY},dest:{value:zm.actions.characterAcceleration},xform:zW.normalize_vec2},{src:{value:zm.device.keyboard.key("shift")},dest:{value:_Q},xform:zW.copy},{src:{value:GG("primary").pressed},dest:{value:xY},xform:zW.copy},{src:{value:PY("primary").pressed},dest:{value:ZY},xform:zW.copy},{src:[_Q,xY,ZY],dest:{value:zm.actions.boost},xform:zW.any},{src:{value:QG},dest:{value:zm.actions.cursor.left.pose},xform:zW.copy},{src:{value:kY},dest:{value:zm.actions.cursor.right.pose},xform:zW.copy},{src:{value:kY},dest:{value:zm.actions.rightHand.pose},xform:zW.copy},{src:{value:QG},dest:{value:zm.actions.leftHand.pose},xform:zW.copy},{src:[GG("primary").pressed,GG("trigger").pressed,GG("grip").pressed,GG("touchpad").pressed],dest:{value:qG},xform:zW.any},{src:{value:qG},dest:{value:zm.actions.cursor.left.wake},xform:zW.rising},{src:[PY("primary").pressed,PY("trigger").pressed,PY("grip").pressed,PY("touchpad").pressed],dest:{value:ZG},xform:zW.any},{src:{value:ZG},dest:{value:zm.actions.cursor.right.wake},xform:zW.rising},{src:[PY("secondary").pressed,GG("secondary").pressed,PY("bumper").pressed,GG("bumper").pressed],dest:{value:cQ},xform:zW.any},{src:[PY("primary").pressed,GG("primary").pressed],dest:{value:dQ},xform:zW.any},{src:{value:cQ},dest:{value:oQ},xform:zW.copy},{src:{value:cQ},dest:{value:lQ},xform:zW.falling}],[NH]:[{src:{value:TQ},dest:{value:JY},xform:zW.falling,priority:1},{src:{value:PY("touchpad").pressed},dest:{value:eQ},xform:zW.falling},{src:[JY,eQ],dest:{value:zm.actions.rightHand.stopTeleport},xform:zW.any}],[$H]:[{src:{value:PQ},dest:{value:zm.actions.leftHand.startTeleport},xform:zW.rising}],[qH]:[{src:{value:PQ},dest:{value:DQ},xform:zW.falling,priority:1},{src:[DQ,RQ,jQ],dest:{value:zm.actions.leftHand.stopTeleport},xform:zW.any}],[UH]:[{src:{value:TQ},dest:{value:zm.actions.rightHand.startTeleport},xform:zW.rising,priority:1}],[wH]:[],[TH]:[],[bH]:[{src:{value:TQ},dest:{value:zm.actions.cursor.right.grab},xform:zW.rising,priority:1}],[kH]:[{src:{value:PQ},dest:{value:zm.actions.cursor.left.grab},xform:zW.rising,priority:1}],[yH]:[{src:{value:CY("touchY"),touching:PY("touchpad").touched},dest:{value:zm.actions.cursor.right.mediaVolumeMod},xform:zW.touch_axis_scroll(.1)},{src:{value:CY("joyY")},dest:{value:zm.actions.cursor.right.mediaVolumeMod},xform:zW.scale(.02)}],[OH]:[{src:{value:YG("touchY"),touching:GG("touchpad").touched},dest:{value:zm.actions.cursor.left.mediaVolumeMod},xform:zW.touch_axis_scroll(.1)},{src:{value:YG("joyY")},dest:{value:zm.actions.cursor.left.mediaVolumeMod},xform:zW.scale(.02)}],[YH]:[{src:{value:AQ},dest:{value:yY},xform:zW.rising},{src:{value:PQ},dest:{value:zm.actions.leftHand.stopTeleport},xform:zW.falling,priority:2},{src:[yY],dest:{value:zm.actions.leftHand.grab},xform:zW.any}],[KH]:[{src:{value:AQ},dest:{value:zm.actions.leftHand.drop},xform:zW.falling,priority:1}],[ZH]:[],[QH]:[{src:{value:kQ},dest:{value:RQ},xform:zW.falling,priority:1},{src:{value:kQ},dest:{value:_Y},xform:zW.rising,priority:1},{src:{bool:_Y,value:dY},dest:{value:zm.actions.leftHand.startTeleport},xform:zW.copyIfTrue,priority:1},{src:{value:PQ},dest:{value:zm.actions.leftHand.startDrawing},xform:zW.rising,priority:2},{src:{value:PQ},dest:{value:gY},xform:zW.falling,priority:2},{src:{value:AQ},dest:{value:vY},xform:zW.falling,priority:1},{src:{value:AQ},dest:{value:jQ},xform:zW.falling,priority:1},{src:[gY,vY],dest:{value:zm.actions.leftHand.stopDrawing},xform:zW.any},{src:{value:kQ},dest:{value:wY},xform:zW.rising,priority:1},{src:{bool:wY,value:sY},dest:{value:zm.actions.leftHand.penNextColor},xform:zW.copyIfTrue,priority:2},{src:{bool:wY,value:aY},dest:{value:zm.actions.leftHand.penPrevColor},xform:zW.copyIfTrue,priority:2},{src:{value:YG("touchX"),touching:GG("touchpad").touched},dest:{value:zm.actions.leftHand.scalePenTip},xform:zW.touch_axis_scroll(.05)},{src:[PY("primary").pressed,GG("secondary").pressed],dest:{value:MY},xform:zW.any,priority:1},{src:{value:MY},dest:{value:zm.actions.leftHand.undoDrawing},xform:zW.rising},{src:{value:GG("primary").pressed},dest:{value:zm.actions.leftHand.switchDrawMode},xform:zW.rising,priority:2}],[vH]:[{src:{value:xQ},dest:{value:YY},xform:zW.rising},{src:{value:TQ},dest:{value:GY},xform:zW.rising,priority:1},{src:[YY],dest:{value:zm.actions.cursor.right.grab},xform:zW.any},{src:{value:dQ},dest:{value:zm.actions.startInspecting},xform:zW.rising}],[CH]:[{src:{value:AQ},dest:{value:yY},xform:zW.rising},{src:{value:PQ},dest:{value:bY},xform:zW.rising,priority:1},{src:[yY],dest:{value:zm.actions.cursor.left.grab},xform:zW.any},{src:{value:dQ},dest:{value:zm.actions.startInspecting},xform:zW.rising}],[SH]:[{src:{value:TQ},dest:{value:XY},xform:zW.falling,priority:4}],[LH]:[{src:{value:PQ},dest:{value:$Y},xform:zW.falling,priority:4}],[AH]:[{src:{value:CY("touchY"),touching:PY("touchpad").touched},dest:{value:zm.actions.cursor.right.modDelta},xform:zW.touch_axis_scroll(-1)},{src:{value:CY("joyY")},dest:{value:zm.actions.cursor.right.modDelta},xform:zW.scale(-.02)},{src:{value:xQ},dest:{value:QY},xform:zW.falling,priority:1},{src:[QY,XY],dest:{value:zm.actions.cursor.right.drop},xform:zW.any},{src:{},dest:{value:iQ},root:tQ,xform:zW.always(!1)}],[jH]:[{src:{value:YG("touchY"),touching:GG("touchpad").touched},dest:{value:zm.actions.cursor.left.modDelta},xform:zW.touch_axis_scroll(-1)},{src:{value:YG("joyY")},dest:{value:zm.actions.cursor.left.modDelta},xform:zW.scale(-.02),priority:1},{src:{value:AQ},dest:{value:KY},xform:zW.falling,priority:1},{src:[KY,$Y],dest:{value:zm.actions.cursor.left.drop},xform:zW.any},{src:{},dest:{value:iQ},root:tQ,xform:zW.always(!1)}],[fH]:[],[MH]:[],[_H]:[{src:[QY],dest:{value:zm.actions.cursor.right.drop},xform:zW.noop,priority:1},{src:[XY],dest:{value:zm.actions.cursor.right.drop},xform:zW.noop,priority:1},{src:{value:xQ},dest:{value:zm.actions.cursor.right.drop},xform:zW.rising,priority:1},{src:{bool:WY,value:NY},dest:{value:zm.actions.rightHand.startTeleport},xform:zW.copyIfTrue,priority:2},{src:{value:TQ},dest:{value:zm.actions.cursor.right.startDrawing},xform:zW.rising,priority:3},{src:{value:TQ},dest:{value:zm.actions.cursor.right.stopDrawing},xform:zW.falling,priority:3},{src:{value:CY("touchX"),touching:PY("touchpad").touched},dest:{value:zm.actions.cursor.right.scalePenTip},xform:zW.touch_axis_scroll(.1)},{src:{bool:WY,value:DY},dest:{value:zm.actions.cursor.right.penNextColor},xform:zW.copyIfTrue,priority:2},{src:{bool:WY,value:jY},dest:{value:zm.actions.cursor.right.penPrevColor},xform:zW.copyIfTrue,priority:2},{src:{value:PY("primary").pressed},dest:{value:zm.actions.cursor.right.undoDrawing},xform:zW.rising,priority:2}],[RH]:[{src:[KY],dest:{value:zm.actions.cursor.left.drop},xform:zW.noop,priority:1},{src:[$Y],dest:{value:zm.actions.cursor.left.drop},xform:zW.noop,priority:1},{src:{value:AQ},dest:{value:zm.actions.cursor.left.drop},xform:zW.rising,priority:1},{src:{value:PQ},dest:{value:zm.actions.cursor.left.startDrawing},xform:zW.rising,priority:3},{src:{value:PQ},dest:{value:zm.actions.cursor.left.stopDrawing},xform:zW.falling,priority:3},{src:{value:YG("touchX"),touching:GG("touchpad").touched},dest:{value:zm.actions.cursor.left.scalePenTip},xform:zW.touch_axis_scroll(.1)},{src:{value:kQ},dest:{value:_Y},xform:zW.rising,priority:1},{src:{bool:_Y,value:sY},dest:{value:zm.actions.cursor.left.penNextColor},xform:zW.copyIfTrue,priority:2},{src:{bool:_Y,value:aY},dest:{value:zm.actions.cursor.left.penPrevColor},xform:zW.copyIfTrue,priority:2},{src:{value:GG("primary").pressed},dest:{value:zm.actions.cursor.left.undoDrawing},xform:zW.rising,priority:2}],[VH]:[{src:{value:xQ},dest:{value:YY},xform:zW.rising},{src:{value:TQ},dest:{value:zm.actions.rightHand.stopTeleport},xform:zW.falling,priority:2},{src:[YY],dest:{value:zm.actions.rightHand.grab},xform:zW.any}],[WH]:[{src:{value:xQ},dest:{value:zm.actions.rightHand.drop},xform:zW.falling,priority:1},{src:{},dest:{value:iQ},root:tQ,xform:zW.always(!1)}],[FH]:[],[HH]:[{src:{bool:WY,value:NY},dest:{value:zm.actions.rightHand.startTeleport},xform:zW.copyIfTrue},{src:{value:TQ},dest:{value:zm.actions.rightHand.startDrawing},xform:zW.rising,priority:3},{src:{value:TQ},dest:{value:zm.actions.rightHand.stopDrawing},xform:zW.falling,priority:3},{src:{bool:WY,value:DY},dest:{value:zm.actions.rightHand.penNextColor},xform:zW.copyIfTrue,priority:2},{src:{bool:WY,value:jY},dest:{value:zm.actions.rightHand.penPrevColor},xform:zW.copyIfTrue,priority:2},{src:{value:CY("touchX"),touching:PY("touchpad").touched},dest:{value:zm.actions.rightHand.scalePenTip},xform:zW.touch_axis_scroll(.05)},{src:[GG("primary").pressed,PY("secondary").pressed],dest:{value:nQ},xform:zW.any,priority:1},{src:{value:nQ},dest:{value:zm.actions.rightHand.undoDrawing},xform:zW.rising},{src:{value:PY("primary").pressed},dest:{value:zm.actions.rightHand.switchDrawMode},xform:zW.rising,priority:2}],[gH]:[],[PH]:[],[BH]:[],[GH]:[],[zH]:[{src:{value:TQ},dest:{value:zm.actions.rightHand.takeSnapshot},xform:zW.copy,priority:3},{src:{value:TQ},dest:{value:zm.noop},xform:zW.falling,priority:3}],[XH]:[{src:{value:GG("trigger").pressed},dest:{value:zm.actions.leftHand.takeSnapshot},xform:zW.copy}],[EH]:[{src:{value:TQ},dest:{value:zm.actions.cursor.right.takeSnapshot},xform:zW.copy,priority:3},{src:{value:TQ},dest:{value:zm.noop},xform:zW.falling,priority:3}],[DH]:[{src:{value:PQ},dest:{value:zm.actions.cursor.left.takeSnapshot},xform:zW.copy,priority:3},{src:{value:PQ},dest:{value:zm.noop},xform:zW.falling,priority:3}],[mH]:[{src:{value:"/device/keyboard"},dest:{value:zm.noop},xform:zW.noop,priority:1e3}],[ez]:[{src:{value:dQ},dest:{value:zm.actions.stopInspecting},xform:zW.falling}]}),IQ=WW({[pH]:[{src:{value:YG("touchY")},dest:{value:rY},xform:zW.copy}],[QH]:[{src:{value:AQ},dest:{value:zm.actions.leftHand.drop},xform:zW.rising,priority:2}],[HH]:[{src:{value:xQ},dest:{value:zm.actions.rightHand.drop},xform:zW.rising,priority:2}]}),NQ=WW({[pH]:[{src:{value:YG("touchY")},dest:{value:rY},xform:zW.copy}]}),FQ=WW({[pH]:[{src:{value:YG("touchY")},dest:{value:rY},xform:zW.negate}],[QH]:[{src:{value:AQ},dest:{value:zm.actions.leftHand.drop},xform:zW.rising,priority:2}],[HH]:[{src:{value:xQ},dest:{value:zm.actions.rightHand.drop},xform:zW.rising,priority:2}]}),BQ=WW({[pH]:[{src:{value:YG("touchY")},dest:{value:rY},xform:zW.copy}],[QH]:[{src:{x:YG("joyX"),y:YG("joyY")},dest:{value:XG},xform:zW.compose_vec2,priority:1},{src:{value:XG},dest:{north:uY,south:hY,east:pY,west:mY,center:fY},xform:zW.vec2dpad(.35,!1,!0)},{src:{value:AQ},dest:{value:zm.actions.leftHand.drop},xform:zW.rising,priority:2},{src:{value:pY,override:"/device/overrides/foo"},dest:{value:zm.actions.leftHand.penNextColor},xform:zW.rising,priority:2},{src:{value:mY,override:"/device/overrides/foo"},dest:{value:zm.actions.leftHand.penPrevColor},xform:zW.rising,priority:2},{src:{value:YG("joyY")},dest:{value:eY},xform:zW.deadzone(.1),priority:1},{src:{value:eY},dest:{value:zm.actions.leftHand.scalePenTip},xform:zW.scaleExp(-.005,5),priority:1}],[HH]:[{src:{value:xQ},dest:{value:zm.actions.rightHand.drop},xform:zW.rising,priority:2},{src:{value:VY},dest:{value:zm.actions.rightHand.penNextColor},xform:zW.rising,priority:2},{src:{value:UY},dest:{value:zm.actions.rightHand.penPrevColor},xform:zW.rising,priority:2},{src:{value:CY("joyY")},dest:{value:RY},xform:zW.deadzone(.1)},{src:{value:RY},dest:{value:zm.actions.rightHand.scalePenTip},xform:zW.scaleExp(-.005,5),priority:1}]}),VQ=zm.device.wmr.left.grip.pressed,UQ=zm.device.wmr.right.grip.pressed,HQ=zm.device.wmr.right.trigger.pressed,zQ=zm.device.wmr.v("right/joy/north"),WQ=zm.device.wmr.v("right/grip/rising"),qQ=zm.device.wmr.v("right/trigger/rising"),ZQ=zm.device.wmr.v("right/grip/falling"),GQ=zm.device.wmr.v("right/trigger/falling");function YQ(e){return{padWest:zm.device.wmr.v(e+"/pad/west"),padEast:zm.device.wmr.v(e+"/pad/east"),padNorth:zm.device.wmr.v(e+"/pad/north"),padSouth:zm.device.wmr.v(e+"/pad/south"),padCenter:zm.device.wmr.v(e+"/pad/center"),padCenterStrip:zm.device.wmr.v(e+"/pad/centerStrip")}}function QQ(e){const{padWest:t,padEast:n,padNorth:i,padSouth:r,padCenter:o,padCenterStrip:s}=YQ(e),a=zm.device.wmr.v(e+"/pad");return[{src:{x:zm.device.wmr[e].touchpad.axisX,y:zm.device.wmr[e].touchpad.axisY},dest:{value:a},xform:zW.compose_vec2},{src:{value:a},dest:{west:t,east:n,north:i,south:r,center:o},xform:zW.vec2dpad(.5,!1,!1)},{src:[i,o,r],dest:{value:s},xform:zW.any}]}const XQ={src:{},dest:{value:zm.actions.ensureFrozen},xform:zW.always(!1)};function KQ(e,t){const n=zm.device.wmr[e].touchpad.axisY,i=zm.device.wmr[e].trigger.pressed,r=zm.device.wmr[e].touchpad.pressed,o=zm.device.wmr[e].touchpad.touched,s=zm.device.wmr.v(e+"/pad/rising"),a=zm.device.wmr.v(e+"/pad/centerStrip/touched"),{padWest:l,padEast:c,padCenter:d,padCenterStrip:u}=YQ(e),h=t?zm.actions.cursor[e]:zm.actions[e+"Hand"];return[XQ,...QQ(e),{src:{value:i},dest:{value:h.startDrawing},xform:zW.rising},{src:{value:i},dest:{value:h.stopDrawing},xform:zW.falling},{src:{value:r},dest:{value:s},xform:zW.rising},{src:{bool:s,value:l},dest:{value:h.penPrevColor},xform:zW.copyIfTrue},{src:{bool:s,value:c},dest:{value:h.penNextColor},xform:zW.copyIfTrue},{src:[u,o],dest:{value:a},xform:zW.all},{src:{value:n,touching:a},dest:{value:h.scalePenTip},xform:zW.touch_axis_scroll(-.05)},{src:[s,d],dest:{value:h.undoDrawing},xform:zW.all}]}function $Q(e){const t=zm.device.wmr[e].touchpad.touched,n=zm.device.wmr[e].trigger.pressed,i=zm.device.wmr[e].grip.pressed,r=zm.actions[e+"Hand"];return[{src:{value:t},dest:{value:r.thumb},xform:zW.copy},{src:{value:n},dest:{value:r.index},xform:zW.copy},{src:{value:i},dest:{value:r.middleRingPinky},xform:zW.copy}]}function JQ(e,t){const n=t?zm.actions.cursor[e]:zm.actions[e+"Hand"];return[XQ,{src:{value:zm.device.wmr[e].trigger.pressed},dest:{value:n.takeSnapshot},xform:zW.copy}]}const eX=WW({[pH]:[{src:{value:zm.device.wmr.left.matrix},dest:{value:zm.actions.leftHand.matrix},xform:zW.copy},{src:{value:zm.device.wmr.right.matrix},dest:{value:zm.actions.rightHand.matrix},xform:zW.copy},{src:{value:zm.device.wmr.left.pose},dest:{value:zm.actions.leftHand.pose},xform:zW.copy},{src:{value:zm.device.wmr.right.pose},dest:{value:zm.actions.cursor.right.pose},xform:zW.copy},{src:{value:zm.device.wmr.right.pose},dest:{value:zm.actions.rightHand.pose},xform:zW.copy},...$Q("left"),...$Q("right"),...function(){const e=zm.device.wmr.left.touchpad.pressed,t=zm.device.wmr.right.touchpad.pressed,n=zm.device.wmr.v("left/touchpad/falling"),i=zm.device.wmr.v("right/touchpad/falling"),r=zm.device.wmr.k("space/falling");return[{src:[zm.device.keyboard.key(" "),e,t],dest:{value:zm.actions.ensureFrozen},xform:zW.any},{src:{value:zm.device.keyboard.key(" ")},dest:{value:r},xform:zW.falling},{src:{value:zm.device.keyboard.key("Tab")},dest:{value:zm.actions.toggleFreeze},xform:zW.rising},{src:{value:e},dest:{value:n},xform:zW.falling},{src:{value:t},dest:{value:i},xform:zW.falling},{src:[r,n,i],dest:{value:zm.actions.thaw},xform:zW.any}]}(),...function(){const e=zm.device.wmr.v("right/joy"),t=zm.device.wmr.v("right/joy/west"),n=zm.device.wmr.v("right/joy/East"),i=zm.device.wmr.v("right/joy/west/rising"),r=zm.device.wmr.v("right/joy/east/rising"),o=zm.device.wmr.k("q/rising"),s=zm.device.wmr.k("e/rising");return[{src:{x:zm.device.wmr.right.joystick.axisX,y:zm.device.wmr.right.joystick.axisY},dest:{value:e},xform:zW.compose_vec2},{src:{value:e},dest:{north:zQ,west:t,east:n},xform:zW.vec2dpad(.2,!1,!1)},{src:{value:zQ},dest:{value:zm.actions.rightHand.startTeleport},xform:zW.rising},{src:{value:t},dest:{value:i},xform:zW.rising},{src:{value:n},dest:{value:r},xform:zW.rising},{src:{value:zm.device.keyboard.key("q")},dest:{value:o},xform:zW.rising},{src:{value:zm.device.keyboard.key("e")},dest:{value:s},xform:zW.rising},{src:[i,o],dest:{value:zm.actions.snapRotateLeft},xform:zW.any},{src:[r,s],dest:{value:zm.actions.snapRotateRight},xform:zW.any}]}(),...function(){const e=zm.device.wmr.k("wasd_vec2"),t=zm.device.wmr.k("arrows_vec2"),n=zm.device.wmr.k("characterAcceleration"),i=zm.device.wmr.v("left/joy/x/deadzoned"),r=zm.device.wmr.v("left/joy/y/deadzoned"),o=zm.device.wmr.v("left/joy/x/scaled"),s=zm.device.wmr.v("left/joy/y/scaled"),a=zm.device.wmr.v("left/characterAcceleration");return[{src:{w:zm.device.keyboard.key("arrowup"),a:zm.device.keyboard.key("arrowleft"),s:zm.device.keyboard.key("arrowdown"),d:zm.device.keyboard.key("arrowright")},dest:{vec2:t},xform:zW.wasd_to_vec2},{src:{w:zm.device.keyboard.key("w"),a:zm.device.keyboard.key("a"),s:zm.device.keyboard.key("s"),d:zm.device.keyboard.key("d")},dest:{vec2:e},xform:zW.wasd_to_vec2},{src:{first:e,second:t},dest:{value:n},xform:zW.max_vec2},{src:{value:zm.device.wmr.left.joystick.axisX},dest:{value:i},xform:zW.deadzone(.2)},{src:{value:i},dest:{value:o},xform:zW.scale(1.5)},{src:{value:zm.device.wmr.left.joystick.axisY},dest:{value:r},xform:zW.deadzone(.2)},{src:{value:r},dest:{value:s},xform:zW.scale(-1.5)},{src:{x:o,y:s},dest:{value:a},xform:zW.compose_vec2},{src:{first:a,second:n},dest:{value:zm.actions.characterAcceleration},xform:zW.max_vec2},{src:[zm.device.wmr.left.trigger.pressed,zm.device.wmr.right.trigger.pressed,zm.device.keyboard.key("shift")],dest:{value:zm.actions.boost},xform:zW.any}]}(),{src:{value:zm.device.keyboard.key("m")},dest:{value:zm.actions.muteMic},xform:zW.rising},{src:{value:zm.device.keyboard.key("t")},dest:{value:zm.actions.focusChat},xform:zW.rising},{src:{value:zm.device.keyboard.key("/")},dest:{value:zm.actions.focusChatCommand},xform:zW.rising},{src:{value:zm.device.keyboard.key("Escape")},dest:{value:zm.actions.mediaExit},xform:zW.rising},{src:{bool:zm.device.keyboard.key("control"),value:zm.device.keyboard.key("1")},dest:{value:"/var/shift+1"},priority:1001,xform:zW.copyIfTrue},{src:{value:"/var/shift+1"},dest:{value:zm.actions.mediaSearch1},xform:zW.rising},{src:{bool:zm.device.keyboard.key("control"),value:zm.device.keyboard.key("2")},dest:{value:"/var/shift+2"},priority:1001,xform:zW.copyIfTrue},{src:{value:"/var/shift+2"},dest:{value:zm.actions.mediaSearch2},xform:zW.rising},{src:{bool:zm.device.keyboard.key("control"),value:zm.device.keyboard.key("3")},dest:{value:"/var/shift+3"},priority:1001,xform:zW.copyIfTrue},{src:{value:"/var/shift+3"},dest:{value:zm.actions.mediaSearch3},xform:zW.rising},{src:{bool:zm.device.keyboard.key("control"),value:zm.device.keyboard.key("4")},dest:{value:"/var/shift+4"},priority:1001,xform:zW.copyIfTrue},{src:{value:"/var/shift+4"},dest:{value:zm.actions.mediaSearch4},xform:zW.rising},{src:{bool:zm.device.keyboard.key("control"),value:zm.device.keyboard.key("5")},dest:{value:"/var/shift+5"},priority:1001,xform:zW.copyIfTrue},{src:{value:"/var/shift+5"},dest:{value:zm.actions.mediaSearch5},xform:zW.rising},{src:{bool:zm.device.keyboard.key("control"),value:zm.device.keyboard.key("6")},dest:{value:"/var/shift+6"},priority:1001,xform:zW.copyIfTrue},{src:{value:"/var/shift+6"},dest:{value:zm.actions.mediaSearch6},xform:zW.rising},{src:{bool:zm.device.keyboard.key("control"),value:zm.device.keyboard.key("7")},dest:{value:"/var/shift+7"},priority:1001,xform:zW.copyIfTrue},{src:{value:"/var/shift+7"},dest:{value:zm.actions.mediaSearch7},xform:zW.rising},{src:{bool:zm.device.keyboard.key("control"),value:zm.device.keyboard.key("8")},dest:{value:"/var/shift+8"},priority:1001,xform:zW.copyIfTrue},{src:{value:"/var/shift+8"},dest:{value:zm.actions.mediaSearch8},xform:zW.rising}],[$H]:[],[wH]:[],[UH]:[],[NH]:[{src:{value:zQ},dest:{value:zm.actions.rightHand.stopTeleport},xform:zW.falling}],[bH]:[{src:{value:HQ},dest:{value:zm.actions.cursor.right.grab},xform:zW.rising}],[yH]:[...function(){const e="right",t=zm.device.wmr[e].touchpad.axisY,n=zm.device.wmr[e].touchpad.touched,i=zm.device.wmr.v(e+"/pad/centerStrip/touched"),{padCenterStrip:r}=YQ(e);return[...QQ(e),{src:[r,n],dest:{value:i},xform:zW.all},{src:{value:t,touching:i},dest:{value:zm.actions.cursor[e].mediaVolumeMod},xform:zW.touch_axis_scroll(-.1)}]}()],[YH]:[{src:{value:VQ},dest:{value:zm.actions.leftHand.grab},xform:zW.rising}],[vH]:[{src:{value:UQ},dest:{value:WQ},xform:zW.rising},{src:{value:HQ},dest:{value:qQ},xform:zW.rising},{src:[WQ,qQ],dest:{value:zm.actions.cursor.right.grab},xform:zW.any}],[VH]:[{src:{value:UQ},dest:{value:zm.actions.rightHand.grab},xform:zW.rising}],[KH]:[XQ,{src:{value:VQ},dest:{value:zm.actions.leftHand.drop},xform:zW.falling}],[AH]:[XQ,...function(){const{padNorth:e,padSouth:t}=YQ("right"),n=zm.device.wmr.v("right/pad/northOrSouth"),i=zm.device.wmr.v("right/pad/northOrSouth/pressed"),r=zm.device.wmr.v("right/pad/northOrSouthpressed/y");return[...QQ("right"),{src:[e,t],dest:{value:n},xform:zW.any},{src:[n,zm.device.wmr.right.touchpad.pressed],dest:{value:i},xform:zW.all},{src:{bool:i,value:zm.device.wmr.right.touchpad.axisY},dest:{value:r},xform:zW.copyIfTrue},{src:{value:r},dest:{value:zm.actions.cursor.right.modDelta},xform:zW.scale(.1)}]}(),{src:{value:UQ},dest:{value:ZQ},xform:zW.falling},{src:{value:HQ},dest:{value:GQ},xform:zW.falling},{src:[ZQ,GQ],dest:{value:zm.actions.cursor.right.drop},xform:zW.any}],[WH]:[XQ,{src:{value:UQ},dest:{value:zm.actions.rightHand.drop},xform:zW.falling}],[ZH]:[],[fH]:[],[FH]:[],[QH]:KQ("left"),[_H]:KQ("right",!0),[HH]:KQ("right"),[GH]:[],[gH]:[],[BH]:[],[XH]:JQ("left"),[EH]:JQ("right",!0),[zH]:JQ("right"),[mH]:[{src:{value:"/device/keyboard"},dest:{value:zm.noop},xform:zW.noop,priority:1e3}]}),tX=zm.device.xbox.button,nX=zm.device.xbox.axis,iX=zm.device.xbox.v("scaledRightJoystickVertical"),rX=zm.device.xbox.v("scaledLeftJoystickCursorDelta"),oX=zm.device.xbox.v("scaledRightJoystickHorizontal"),sX=zm.device.xbox.v("deadzonedRightJoystickHorizontal"),aX=zm.device.xbox.v("deadzonedRightJoystickVertical"),lX=zm.device.xbox.v("deadzonedLeftJoystickHorizontal"),cX=zm.device.xbox.v("deadzonedLeftJoystickVertical"),dX=zm.device.xbox.v("vec2Zero"),uX=zm.device.xbox.v("zero");function hX(e){const t=zm.device.xbox.v("scaledLeftJoystickHorizontal"),n=zm.device.xbox.v("scaledLeftJoystickVertical"),i=zm.device.xbox.v("scaledLeftJoystickForwardAcceleration");return[{src:{value:lX},dest:{value:t},xform:zW.scale(1.5)},{src:{value:cX},dest:{value:n},xform:zW.scale(-1.25)},{src:{bool:tX("leftTrigger").pressed,value:n},dest:{value:i},xform:e?zW.copyIfFalse:zW.copy},{src:{x:t,y:i},dest:{value:zm.actions.characterAcceleration},xform:zW.compose_vec2}]}const pX=WW({[_H]:[{src:{value:tX("rightTrigger").pressed},dest:{value:zm.actions.cursor.right.startDrawing},xform:zW.rising,priority:200},{src:{value:tX("rightTrigger").pressed},dest:{value:zm.actions.cursor.right.stopDrawing},xform:zW.falling,priority:200},{src:{value:tX("b").pressed},dest:{value:zm.actions.cursor.right.drop},xform:zW.rising},{src:{value:tX("y").pressed},dest:{value:zm.actions.cursor.right.undoDrawing},xform:zW.rising,priority:200},{src:{value:tX("a").pressed},dest:{value:zm.actions.cursor.right.penNextColor},xform:zW.rising},{src:{value:tX("x").pressed},dest:{value:zm.actions.cursor.right.penPrevColor},xform:zW.rising}],[pH]:[{src:{},dest:{value:zm.actions.cursor.right.hideLine},xform:zW.always(!0)},{src:{value:nX("rightJoystickHorizontal")},dest:{value:sX},xform:zW.deadzone(.1)},{src:{value:sX},dest:{value:oX},xform:zW.scale(-.125)},{src:{value:nX("rightJoystickVertical")},dest:{value:aX},xform:zW.deadzone(.1)},{src:{value:aX},dest:{value:iX},xform:zW.scale(-.125)},{src:{},dest:{value:uX},xform:zW.always(0)},{src:{x:oX,y:iX},dest:{value:zm.actions.cameraDelta},xform:zW.compose_vec2},{src:{value:zm.actions.cameraDelta},dest:{value:zm.actions.lobbyCameraDelta},xform:zW.copy},{src:{value:nX("leftJoystickHorizontal")},dest:{value:lX},xform:zW.deadzone(.1)},{src:{value:nX("leftJoystickVertical")},dest:{value:cX},xform:zW.deadzone(.1)},{src:{value:tX("leftTrigger").pressed},dest:{value:zm.actions.boost},xform:zW.copy},{src:{value:tX("leftBumper").pressed},dest:{value:zm.actions.snapRotateLeft},xform:zW.rising},{src:{value:tX("rightBumper").pressed},dest:{value:zm.actions.snapRotateRight},xform:zW.rising},{src:{},dest:{value:dX},xform:zW.vec2Zero},{src:{value:dX},dest:{value:zm.actions.cursor.right.pose},xform:zW.poseFromCameraProjection()},{src:{value:tX("y").pressed},dest:{value:zm.actions.spawnPen},xform:zW.rising,priority:100},{src:{value:tX("dpadUp").pressed},dest:{value:zm.actions.ensureFrozen},xform:zW.copy},{src:{value:tX("dpadUp").pressed},dest:{value:zm.actions.thaw},xform:zW.falling},{src:{value:tX("start").pressed},dest:{value:zm.actions.toggleFreeze},xform:zW.rising},{src:{value:tX("a").pressed},dest:{value:zm.actions.startGazeTeleport},xform:zW.rising},{src:{value:tX("a").pressed},dest:{value:zm.actions.stopGazeTeleport},xform:zW.falling}],[xH]:[...hX()],[AH]:[...hX(!0),{src:{value:tX("rightTrigger").pressed},dest:{value:zm.actions.cursor.right.drop},xform:zW.falling,priority:100},{src:{value:cX},dest:{value:rX},xform:zW.scale(.25)},{src:{bool:tX("leftTrigger").pressed,value:rX},dest:{value:zm.actions.cursor.right.modDelta},xform:zW.copyIfTrue}],[bH]:[{src:{value:tX("rightTrigger").pressed},dest:{value:zm.actions.cursor.right.grab},xform:zW.rising}],[vH]:[...hX(),{src:{value:tX("rightTrigger").pressed},dest:{value:zm.actions.cursor.right.grab},xform:zW.rising,priority:100}]}),mX=e=>`/vars/daydream/${e}`,fX=mX("touchpad/axis"),gX=mX("touchpad/rising"),vX=mX("touchpad/falling"),bX=mX("touchpad/pressed"),yX=mX("dpad/north"),wX=mX("dpad/south"),_X=mX("dpad/east"),EX=mX("dpad/west"),AX=mX("dpad/center"),SX=mX("brushSizeDelta"),xX=mX("cursorModDelta"),MX=mX("dropSouth"),PX=mX("dropCenter"),CX=[{src:{value:AX,bool:gX},dest:{value:zm.actions.cursor.right.grab},xform:zW.copyIfTrue,priority:100}],kX=[{src:{value:AX,bool:gX},dest:{value:PX},xform:zW.copyIfTrue,priority:100},{src:{value:wX,bool:gX},dest:{value:MX},xform:zW.copyIfTrue,priority:100},{src:[PX,MX],dest:{value:zm.actions.cursor.right.drop},xform:zW.any}],OX=WW({[pH]:[{src:{value:zm.device.daydream.matrix},dest:{value:zm.actions.rightHand.matrix},xform:zW.copy},{src:{x:zm.device.daydream.axis("touchpadX"),y:zm.device.daydream.axis("touchpadY")},dest:{value:fX},xform:zW.compose_vec2},{src:{value:zm.device.daydream.button("touchpad").pressed},dest:{value:gX},xform:zW.rising},{src:{value:zm.device.daydream.button("touchpad").pressed},dest:{value:vX},xform:zW.falling},{src:{value:zm.device.daydream.button("touchpad").pressed},dest:{value:bX},xform:zW.copy},{src:{value:fX},dest:{north:yX,south:wX,east:_X,west:EX,center:AX},xform:zW.vec2dpad(.5)},{src:{value:_X,bool:gX},dest:{value:zm.actions.snapRotateRight},xform:zW.copyIfTrue},{src:{value:EX,bool:gX},dest:{value:zm.actions.snapRotateLeft},xform:zW.copyIfTrue},{src:{value:AX,bool:gX},dest:{value:zm.actions.rightHand.startTeleport},xform:zW.copyIfTrue},{src:{value:zm.device.daydream.pose},dest:{value:zm.actions.cursor.right.pose},xform:zW.copy},{src:{value:zm.device.daydream.pose},dest:{value:zm.actions.rightHand.pose},xform:zW.copy}],[vH]:CX,[bH]:CX,[yH]:[{src:{value:zm.device.daydream.axis("touchpadY"),touching:zm.device.daydream.button("touchpad").touched},dest:{value:zm.actions.cursor.right.mediaVolumeMod},xform:zW.touch_axis_scroll(-.1)}],[AH]:[{src:{value:vX},dest:{value:zm.actions.cursor.right.drop},xform:zW.copy},{src:{value:zm.device.daydream.axis("touchpadY"),touching:zm.device.daydream.button("touchpad").touched},dest:{value:xX},xform:zW.touch_axis_scroll()},{src:{value:xX},dest:{value:zm.actions.cursor.right.modDelta},xform:zW.copy}],[NH]:[{src:{value:vX},dest:{value:zm.actions.rightHand.stopTeleport},xform:zW.copy}],[_H]:[{src:{value:yX,bool:gX},dest:{value:zm.actions.cursor.right.startDrawing},xform:zW.copyIfTrue,priority:100},{src:{value:vX},dest:{value:zm.actions.cursor.right.stopDrawing},xform:zW.copy,priority:100},{src:{value:zm.device.daydream.axis("touchpadX"),touching:zm.device.daydream.button("touchpad").touched},dest:{value:SX},xform:zW.touch_axis_scroll(-.1)},{src:{value:SX,bool:bX},dest:{value:zm.actions.cursor.right.scalePenTip},xform:zW.copyIfFalse,priority:100},{src:{value:_X,bool:gX},dest:{value:zm.actions.cursor.right.penPrevColor},xform:zW.copyIfTrue,priority:100},{src:{value:EX,bool:gX},dest:{value:zm.actions.cursor.right.penNextColor},xform:zW.copyIfTrue,priority:100},{src:{value:xX,bool:bX},dest:{value:zm.actions.cursor.right.modDelta},xform:zW.copyIfFalse,priority:100},...kX],[EH]:[{src:{value:vX},xform:zW.noop,priority:100},{src:{value:yX,bool:gX},dest:{value:zm.actions.cursor.right.takeSnapshot},xform:zW.copy,priority:100},...kX]}),TX=WW({[pH]:[{src:{value:zm.device.touchscreen.isTouching},dest:{value:zm.actions.startGazeTeleport},xform:zW.rising},{src:{value:zm.device.touchscreen.isTouching},dest:{value:zm.actions.stopGazeTeleport},xform:zW.falling}]});function RX(e){const t=e.v("touchpad"),n=e.button("touchpad"),i=e.button("trigger"),r=e.axis("touchpadX"),o=e.axis("touchpadXForPen"),s=e.axis("touchpadY"),a=e.axis("touchpadYForPen"),l=e.v("touchpad/rising"),c=e.v("touchpad/falling"),d=e.v("trigger/rising"),u=e.v("trigger/falling"),h=e.v("dpad/north"),p=e.v("dpad/south"),m=e.v("dpad/east"),f=e.v("dpad/west"),g=e.v("dpad/center"),v=e.v("dpad/centerStrip"),b=e.v("dpad/bottomCenterStrip"),y="/vars/oculus-go/togglePen",w={src:{value:d},dest:{value:zm.actions.cursor.right.grab},xform:zW.copy,priority:200},_={src:{value:u},dest:{value:zm.actions.cursor.right.drop},xform:zW.copy,priority:200};return WW({[pH]:[{src:{value:e.matrix},dest:{value:zm.actions.rightHand.matrix},xform:zW.copy},{src:{value:i.pressed},dest:{value:d},xform:zW.rising},{src:{value:i.pressed},dest:{value:u},xform:zW.falling},{src:{value:n.pressed},dest:{value:l},xform:zW.rising,priority:100},{src:{value:n.pressed},dest:{value:c},xform:zW.falling,priority:100},{src:{x:r,y:s},dest:{value:t},xform:zW.compose_vec2},{src:{value:r},dest:{value:o},xform:zW.copy},{src:{value:s},dest:{value:a},xform:zW.copy},{src:{value:t},dest:{north:h,south:p,east:m,west:f,center:g},xform:zW.vec2dpad(.3)},{src:[g,p],dest:{value:b},xform:zW.any},{src:[h,b],dest:{value:v},xform:zW.any},{src:{value:v,bool:n.pressed},dest:{value:zm.actions.ensureFrozen},priority:100,xform:zW.copyIfTrue},{src:{value:c},dest:{value:zm.actions.thaw},xform:zW.copy},{src:{value:m,bool:l},dest:{value:zm.actions.snapRotateRight},xform:zW.copyIfTrue,priority:100},{src:{value:f,bool:l},dest:{value:zm.actions.snapRotateLeft},xform:zW.copyIfTrue,priority:100},{src:{value:d},dest:{value:zm.actions.rightHand.startTeleport},xform:zW.copy,priority:100},{src:{value:e.pose},dest:{value:zm.actions.cursor.right.pose},xform:zW.copy},{src:{value:e.pose},dest:{value:zm.actions.rightHand.pose},xform:zW.copy},{src:{value:n.touched},dest:{value:zm.actions.rightHand.thumb},xform:zW.copy},{src:{value:i.pressed},dest:{value:zm.actions.rightHand.index},xform:zW.copy},{src:{value:i.pressed},dest:{value:zm.actions.rightHand.middleRingPinky},xform:zW.copy}],[vH]:[w],[bH]:[w],[SH]:[_],[yH]:[{src:{value:s,touching:n.touched},dest:{value:zm.actions.cursor.right.mediaVolumeMod},xform:zW.touch_axis_scroll(-.1)}],[AH]:[{src:{value:u},dest:{value:zm.actions.cursor.right.drop},xform:zW.copy,priority:200},{src:{value:s,touching:n.touched},dest:{value:zm.actions.cursor.right.modDelta},xform:zW.touch_axis_scroll()},{src:{value:v},priority:200,xform:zW.noop}],[NH]:[{src:{value:u},dest:{value:zm.actions.rightHand.stopTeleport},xform:zW.copy,priority:100}],[_H]:[{src:{value:d},dest:{value:zm.actions.cursor.right.startDrawing},xform:zW.copy,priority:300},{src:{value:u},dest:{value:zm.actions.cursor.right.stopDrawing},xform:zW.copy,priority:300},{src:{value:o,touching:n.touched},dest:{value:zm.actions.cursor.right.scalePenTip},xform:zW.touch_axis_scroll(.1,.1),priority:200},{src:{value:a,touching:n.touched},dest:{value:zm.actions.cursor.right.modDelta},xform:zW.touch_axis_scroll(1,.1),priority:200},{src:{value:b,bool:c},dest:{value:y},xform:zW.copyIfTrue,priority:300},{src:{value:y},dest:{value:zm.actions.cursor.right.drop},xform:zW.rising,priority:200},{src:{value:y},dest:{value:zm.actions.pen.remove},xform:zW.rising,priority:200},{src:{value:m,bool:l},dest:{value:zm.actions.cursor.right.penPrevColor},xform:zW.copyIfTrue,priority:200},{src:{value:f,bool:l},dest:{value:zm.actions.cursor.right.penNextColor},xform:zW.copyIfTrue,priority:200},{src:{value:h,bool:l},dest:{value:zm.actions.cursor.right.undoDrawing},xform:zW.copyIfTrue,priority:200}],[EH]:[{src:{value:d},dest:{value:zm.actions.cursor.right.takeSnapshot},xform:zW.copy,priority:300}]})}const DX=(0,z.Z)("dui");let jX,LX;function IX(e,t,n){return n&&(0,Ot.hasComponent)(e,t,n)}function NX(e,t,n){return n&&(0,Ot.hasComponent)(e,Ut,n)&&!!e.eid2obj.get(n).el.components[t]}class FX{constructor(e){this.gamepad=e}write(e){this.gamepad.connected&&(this.gamepad.buttons.forEach(((t,n)=>{const i=zm.device.gamepad(this.gamepad.index).button(n);e.setValueType(i.pressed,!!t.pressed),e.setValueType(i.touched,!!t.touched),e.setValueType(i.value,t.value)})),this.gamepad.axes.forEach(((t,n)=>{e.setValueType(zm.device.gamepad(this.gamepad.index).axis(n),t)})))}}const BX={};var VX=n(99477);const UX=RX(zm.device.oculusgo),HX=RX(zm.device.gearVRController),zX=(e,t)=>{for(const n in e.dest)if(-1!==e.dest[n].indexOf(t))return!0;return!1},WX=(e,t)=>{for(const n of e)if(zX(n,t))return!0;return!1},qX=(e,t)=>{for(const n of Object.values(e.src))if(!n.startsWith("/device/")&&!WX(t,n))return!1;return!0};function ZX(e){return""!==e}function GX(e,t){const n=e.split("/").filter(ZX),i=t.split("/").filter(ZX);if(n.length>i.length)return!1;for(let e=0;e<n.length;e++)if(n[e]!==i[e])return!1;return!0}function YX(e,t){if(void 0===e.priority&&(e.priority=0),void 0===t.priority&&(t.priority=0),t.priority>=e.priority)return!1;for(const n in e.src){const i=e.src[n];for(const e in t.src){const n=t.src[e];if(-1!==n.indexOf(i)&&GX(i,n))return!0}}return!1}function QX(e,t){for(let n=0;n<e.sets.length;n++)if(t.includes(e.sets[n]))return!0;return!1}AFRAME.registerSystem("userinput",{get(e){if(this.frame)return this.frame.get(e)},toggleSet(e,t){this.pendingSetChanges.push(e),this.pendingSetChanges.push(!!t)},init(){this.frame={generation:0,values:{},generations:{},get:function(e){if(this.generations[e]===this.generation)return this.values[e]},setValueType:function(e,t){this.values[e]=t,this.generations[e]=this.generation},setVector2:function(e,t,n){const i=this.values[e]||[];i[0]=t,i[1]=n,this.values[e]=i,this.generations[e]=this.generation},setPose:function(e,t){this.setValueType(e,t)},setMatrix4:function(e,t){const n=this.values[e]||new VX.Matrix4;n.copy(t),this.values[e]=n,this.generations[e]=this.generation}},this.prevActiveSets=[],this.activeSets=[pH],this.pendingSetChanges=[],this.xformStates=new Map,this.activeDevices=new rz([new az]);const e=AFRAME.utils.device.isMobile(),t=AFRAME.utils.device.isMobileVR(),n=q();e||t||n?t&&!n||(this.activeDevices.add(new UW),this.activeDevices.add(new sz),this.activeDevices.add(new fW)):(this.activeDevices.add(new iz),this.activeDevices.add(new bW),this.activeDevices.add(new sz)),this.isMobile=e,this.isMobileVR=t,this.registeredMappings=new Set([Eq]),this.registeredMappingsChanged=!0;const i=new Map;i.set(nW,eX),i.set(Kz,LQ),i.set(Lz,DZ),i.set(yz,UX),i.set(Pz,HX),i.set(qz,OX),i.set(lW,zG);const r=new Map;r.set(lz,pX),r.set(FX,BX);const o=e=>{e instanceof Kz&&e.gamepad&&("OpenVR Cosmos"===e.gamepad.id?this.registeredMappings.add(BQ):"HTC Vive Focus Plus Controller"===e.gamepad.id?this.registeredMappings.add(FQ):4===e.gamepad.axes.length?this.registeredMappings.add(NQ):this.registeredMappings.add(IQ))},s=e=>{e instanceof Kz&&e.gamepad&&(this.registeredMappings.delete(BQ),this.registeredMappings.delete(FQ),this.registeredMappings.delete(NQ),this.registeredMappings.delete(IQ))},a=()=>{const e=this.el.sceneEl.is("vr-mode"),t=AFRAME.utils.device.isMobile(),n=q();if(e){console.log("Using VR bindings."),this.registeredMappings.delete(t||n?_q:lq);for(let e=0;e<this.activeDevices.items.length;e++){const t=this.activeDevices.items[e],n=i.get(t.constructor);n&&this.registeredMappings.add(n),o(t)}t&&vw().then((e=>{e.cardboard===fw.yes&&(this.registeredMappings.add(TX),this.registeredMappingsChanged=!0)}))}else{console.log("Using Non-VR bindings.");for(let e=0;e<this.activeDevices.items.length;e++){const t=this.activeDevices.items[e];s(t),this.registeredMappings.delete(i.get(t.constructor))}this.registeredMappings.add(t||n?_q:lq)}for(let e=0;e<this.activeDevices.items.length;e++){const t=this.activeDevices.items[e],n=r.get(t.constructor);n&&this.registeredMappings.add(n)}this.registeredMappingsChanged=!0},l=e=>{let t;for(let t=0;t<this.activeDevices.items.length;t++){const n=this.activeDevices.items[t];if(!e.gamepad.isWebXRGamepad&&n.gamepad&&n.gamepad.index===e.gamepad.index)return void console.warn("connected already fired for gamepad",e.gamepad)}t=e.gamepad.isWebXRGamepad?new lW(e.gamepad):e.gamepad.id.startsWith("OpenVR Gamepad")||e.gamepad.id.startsWith("OpenVR Knuckles")||"HTC Vive Focus Plus Controller"===e.gamepad.id||"OpenVR Cosmos"===e.gamepad.id?new Kz(e.gamepad):e.gamepad.id.startsWith("Oculus Touch")||e.gamepad.id.startsWith("Pico Neo 2")?new Lz(e.gamepad):e.gamepad.id.startsWith("Spatial Controller")?new nW(e.gamepad):"Oculus Go Controller"===e.gamepad.id||"Pico G2 Controller"===e.gamepad.id?new yz(e.gamepad):"Gear VR Controller"===e.gamepad.id||"HTC Vive Focus Controller"===e.gamepad.id?new Pz(e.gamepad):"Daydream Controller"===e.gamepad.id?new qz(e.gamepad):"standard"===e.gamepad.mapping?new lz(e.gamepad):new FX(e.gamepad),this.activeDevices.add(t),a()},c=e=>{for(let t=0;t<this.activeDevices.items.length;t++){const n=this.activeDevices.items[t];if(n.gamepad&&n.gamepad.index===e.gamepad.index)return this.registeredMappings.delete(i.get(n.constructor)||r.get(n.constructor)),void this.activeDevices.delete(n)}a()};window.addEventListener("gamepadconnected",l,!1),window.addEventListener("gamepaddisconnected",c,!1);for(const e of navigator.getGamepads())e&&l({gamepad:e});const d=e=>{let{added:t,removed:n}=e;for(const e of n)c(e);for(const e of t)e.gamepad.isWebXRGamepad=!0,e.gamepad.targetRaySpace=e.targetRaySpace,e.gamepad.primaryProfile=e.profiles[0],void 0===e.gamepad.hand&&(e.gamepad.hand=e.handedness),l(e)};this.el.sceneEl.addEventListener("enter-vr",(()=>{const{xrSession:e}=this.el.sceneEl;e&&(e.addEventListener("inputsourceschange",d),e.requestReferenceSpace("local-floor").then((e=>{this.xrReferenceSpace=e})),e.addEventListener("end",(()=>{this.activeDevices.items.filter((e=>e.gamepad&&e.gamepad.isWebXRGamepad)).forEach(c)}))),a()})),this.el.sceneEl.addEventListener("exit-vr",a),a()},maybeToggleXboxMapping(){if(q()||this.isMobile||this.isMobileVR)return;const e=(this.get(zm.device.vive.left.axesSum)||0)+(this.get(zm.device.vive.right.axesSum)||0)+(this.get(zm.device.leftOculusTouch.axesSum)||0)+(this.get(zm.device.rightOculusTouch.axesSum)||0),t=this.get(zm.device.mouse.movementXY),n=(t&&(t[0]||t[1]))>2||e>.5,i=this.registeredMappings.has(pX);n&&i?(this.registeredMappings.delete(pX),this.registeredMappingsChanged=!0):this.get(zm.device.xbox.axesSum)>.5&&!i&&(this.registeredMappings.add(pX),this.registeredMappingsChanged=!0)},tick2(e){this.frame.generation+=1;const t=this.registeredMappingsChanged;t&&(this.registeredMappingsChanged=!1,this.prevSortedBindings=this.sortedBindings,this.sortedBindings=function(e){const t=[];for(const n of e)for(const e in n)for(const i of n[e])t.push(i);const n=[];for(;t.length>0;){const e=t.shift();qX(e,n)?n.push(e):t.push(e)}return n}(this.registeredMappings),this.prevSortedBindings||(this.prevSortedBindings=this.sortedBindings),this.masks=function(e){const t=new Array(e.length);for(let n=0;n<e.length;n++){const i=t[n]=[],r=e[n];for(let t=0;t<e.length;t++)YX(e[t],r)&&i.push(t)}return t}(this.sortedBindings)),this.prevActiveSets.length=0;for(let e=0;e<this.activeSets.length;e++){const t=this.activeSets[e];this.prevActiveSets.push(t)}!function(){if(jX=jX||document.getElementById("player-left-controller")&&document.getElementById("player-left-controller").components.teleporter,LX=LX||document.getElementById("player-right-controller")&&document.getElementById("player-right-controller").components.teleporter,!jX||!LX)return;const e=AFRAME.scenes[0].systems.userinput,t=APP.world,n=qo(t,ln),i=qo(t,hn),r=qo(t,dn),o=qo(t,mn),s=qo(t,an),a=qo(t,un),l=qo(t,cn),c=qo(t,pn);e.toggleSet(KH,i),e.toggleSet(WH,a),e.toggleSet(jH,o),e.toggleSet(AH,c),e.toggleSet($H,!n),e.toggleSet(UH,!s),e.toggleSet(TH,!r),e.toggleSet(wH,!l),e.toggleSet(ZH,IX(t,kn,n)),e.toggleSet(FH,IX(t,kn,s)),e.toggleSet(MH,IX(t,kn,r)),e.toggleSet(fH,IX(t,kn,l)),e.toggleSet(GH,IX(t,Wn,n)),e.toggleSet(BH,IX(t,Wn,s)),e.toggleSet(PH,IX(t,Wn,r)),e.toggleSet(gH,IX(t,Wn,l)),e.toggleSet(YH,IX(t,An,n)||NX(t,"super-spawner",n)),e.toggleSet(VH,IX(t,An,s)||NX(t,"super-spawner",s)),e.toggleSet(CH,IX(t,_n,r)||IX(t,Sn,r)||NX(t,"super-spawner",r)),e.toggleSet(vH,IX(t,_n,l)||IX(t,Sn,l)||NX(t,"super-spawner",l)),e.toggleSet(OH,NX(t,"media-video",r)||IX(t,ei,r)),e.toggleSet(yH,NX(t,"media-video",l)||IX(t,ei,l)),e.toggleSet(QH,IX(t,kn,i)),e.toggleSet(HH,IX(t,kn,a)),e.toggleSet(RH,IX(t,kn,o)),e.toggleSet(_H,IX(t,kn,c)),e.toggleSet(XH,IX(t,Wn,i)),e.toggleSet(zH,IX(t,Wn,a)),e.toggleSet(DH,IX(t,Wn,o)),e.toggleSet(EH,IX(t,Wn,c)),e.toggleSet(kH,IX(t,Cn,r)||IX(t,Pn,r)),e.toggleSet(bH,IX(t,Cn,l)||IX(t,Pn,l)),e.toggleSet(IH,!o),e.toggleSet(xH,!c),e.toggleSet(LH,IX(t,Pn,o)),e.toggleSet(SH,IX(t,Pn,c)),e.toggleSet(qH,jX.isTeleporting),e.toggleSet(NH,LX.isTeleporting),e.toggleSet(mH,"INPUT"===document.activeElement.nodeName||"TEXTAREA"===document.activeElement.nodeName||"true"===document.activeElement.contentEditable),e.toggleSet(JH,DX),AFRAME.scenes[0]&&AFRAME.scenes[0].systems["hubs-systems"]&&e.toggleSet(ez,3===AFRAME.scenes[0].systems["hubs-systems"].cameraSystem.mode)}();for(let e=0,t=this.pendingSetChanges.length;e<t;e+=2){const t=this.pendingSetChanges[e];if(this.pendingSetChanges[e+1])this.activeSets.includes(t)||this.activeSets.push(t);else{const e=this.activeSets.indexOf(t);e>-1&&this.activeSets.splice(e,1)}}const n=function(e,t){if(e.length!==t.length)return!0;for(let n=0,i=e.length;n<i;n++){const i=e[n];let r=!1;for(let e=0,n=t.length;e<n;e++)if(i===t[e]){r=!0;break}if(!r)return!0}return!1}(this.prevActiveSets,this.activeSets);if(this.pendingSetChanges.length=0,t||n||!this.actives&&!this.masked){this.prevActives=this.actives,this.prevMasked=this.masked;const{actives:e,masked:t}=function(e,t,n){const i=new Array(e.length);for(let t=0;t<e.length;t++)i[t]=QX(e[t],n);const r=new Array(e.length);for(let n=0;n<e.length;n++){const o=r[n]=[],s=t[n];for(let t=0;t<e.length;t++)i[t]&&-1!==s.indexOf(t)&&o.push(t)}return{actives:i,masked:r}}(this.sortedBindings,this.masks,this.activeSets);this.actives=e,this.masked=t}for(let t=0;t<this.activeDevices.items.length;t++)this.activeDevices.items[t].write(this.frame,e,this.xrReferenceSpace);for(let e=0;e<this.sortedBindings.length;e++){if(!this.actives[e]||this.masked[e].length>0)continue;const i=this.sortedBindings[e];let r=!0;if(!t&&n&&this.prevSortedBindings){const e=this.prevSortedBindings.indexOf(i);r=e>-1&&this.prevActives[e]&&0===this.prevMasked[e].length}r||this.xformStates.delete(i);const{src:o,dest:s,xform:a,debug:l}=i;let c;l&&(c=this.frame.get(s.value));const d=a(this.frame,o,s,this.xformStates.get(i));l&&console.log(`${JSON.stringify(o.value)} (${o.value&&JSON.stringify(this.frame.get(o.value))}) to ${JSON.stringify(s)}: ${c} -> ${this.frame.get(s.value)}`),void 0!==d&&this.xformStates.set(i,d)}this.prevSortedBindings=this.sortedBindings,this.maybeToggleXboxMapping()}});const XX=["/actions/","/device/","/var/"],KX=(e,t)=>"number"==typeof t?`${t>=0?"+":""}${t.toFixed(3)}`:t;AFRAME.registerSystem("userinput-debug",{active:!0,tick(){if(!this.active)return;const e=AFRAME.scenes[0].systems.userinput;if(this.userinputFrameStatus){const t=[],{frame:n}=e;for(const e in n.values){if(!n.get(e))continue;if(!XX.some((t=>e.startsWith(t))))continue;let i=JSON.stringify(n.get(e),KX);i&&(i=i.replace(/{"(\w{3,})":/g,'{\n  "$1":').replace(/,"(\w{3,})":/g,',\n  "$1":')),t.push(`${e} -> ${i}`)}this.userinputFrameStatus.textContent=t.join("\n")}if(e.get(zm.actions.debugUserInput.describeCurrentMasks)&&console.log(function(e){const t=[];return e.masked.forEach(((n,i)=>{let r;e.actives[i]&&(n.length&&(r=JSON.stringify(e.sortedBindings[i],KX),t.push("-----------------------------------"),t.push(`Binding #${i}:`),r&&(r=r.replace(/{"(\w{3,})":/g,'{\n  "$1":').replace(/,"(\w{3,})":/g,',\n  "$1":')),t.push(`${r}\n`)),n.forEach((n=>{r=JSON.stringify(e.sortedBindings[n],KX),r&&(r=r.replace(/{"(\w{3,})":/g,'{\n  "$1":').replace(/,"(\w{3,})":/g,',\n  "$1":')),t.push(`- Masked by #${n}:\n${r}`)})),n.length&&t.push("\n"))})),t.join("\n")}(e)),e.get(zm.actions.logDebugFrame)){(0,z.Z)("userinput_debug")&&!this.userinputFrameStatus&&(this.userinputFrameStatus=document.createElement("div"),this.userinputFrameStatus.id="userinput-frame-status",this.userinputFrameStatus.style="\n          position: absolute;\n          z-index: 2;\n          left: 0; bottom: 0;\n          background: white;\n          white-space: pre;\n          font-family: monospace;\n          font-size: 8pt;\n        ",document.body.append(this.userinputFrameStatus)),console.log(e),console.log("sorted",JSON.parse(JSON.stringify(e.sortedBindings))),console.log("actives",JSON.parse(JSON.stringify(e.actives))),console.log("masks",JSON.parse(JSON.stringify(e.masks))),console.log("masked",JSON.parse(JSON.stringify(e.masked))),console.log("devices",e.activeDevices),console.log("activeSets",JSON.parse(JSON.stringify(e.activeSets))),console.log("frame",JSON.parse(JSON.stringify(e.frame))),console.log("xformStates",e.xformStates);const{sortedBindings:t,actives:n,masked:i}=e;for(const e in t){const r=[];if(i[e].length>0)for(const n of i[e])r.push(JSON.stringify(t[n]));this.logBindings&&console.log("binding: ",e,"\n",JSON.parse(JSON.stringify(t[e])),"\n","dest: ",JSON.parse(JSON.stringify(t[e].dest&&Object.values(t[e].dest))),"\n","active: ",JSON.parse(JSON.stringify(n[e])),"\n","maskedBy: ",JSON.parse(JSON.stringify(i[e])),"\n",r.join("\n"),"\n")}}}});const $X=[zm.actions.mediaSearch1,zm.actions.mediaSearch2,zm.actions.mediaSearch3,zm.actions.mediaSearch4,zm.actions.mediaSearch5,zm.actions.mediaSearch6,zm.actions.mediaSearch7,zm.actions.mediaSearch8];AFRAME.registerSystem("ui-hotkeys",{init(){this.mediaSearchStore=window.APP.mediaSearchStore},tick:function(){if(this.userinput||(this.userinput=this.el.systems.userinput),D()||(this.userinput.get(zm.actions.focusChat)&&window.dispatchEvent(new CustomEvent("focus_chat",{detail:{prefix:""}})),this.userinput.get(zm.actions.focusChatCommand)&&window.dispatchEvent(new CustomEvent("focus_chat",{detail:{prefix:"/"}}))),this.userinput.get(zm.actions.mediaExit)){const e=window.APP.history.location.state&&window.APP.history.location.state.value,t=new Set(["avatar-editor","link","profile","device","audio"]);(!e||!t.has(e))&&this.mediaSearchStore.pushExitMediaBrowserHistory(),this.el.emit("action_exit_watch")}for(let e=0;e<$X.length;e++)this.userinput.get($X[e])&&window.APP.hubChannel.can("spawn_and_move_media")&&this.mediaSearchStore.sourceNavigate(_E[e]);this.userinput.get(zm.actions.toggleCamera)&&this.el.emit("action_toggle_camera"),this.userinput.get(zm.actions.toggleUI)&&this.el.emit("action_toggle_ui"),this.userinput.get(zm.actions.toggleRecord)&&this.el.emit("action_toggle_record")}});const JX="__hubs_finished_tips";let eK=null,tK=!1;const nK=AFRAME.utils.device.isMobile(),iK=AFRAME.utils.device.isMobileVR(),rK=()=>iK?"standalone":nK?"mobile":"desktop",oK={desktop:["welcome","locomotion","turning","invite","end","menu"],mobile:["welcome","locomotion","turning","end","menu"],standalone:[]}[rK()];function sK(e){const t=JSON.parse(localStorage.getItem(JX));t[e]={finished:!0},localStorage.setItem(JX,JSON.stringify(t)),eK=null}function aK(e){const t=JSON.parse(localStorage.getItem(JX));return t[e]&&!0===t[e][tK]?2:1}const lK={welcome:function(){return aK("welcome")},locomotion:function(e){const t=e.get(zm.actions.characterAcceleration);return!t||0===t[0]&&0===t[1]?1:2},turning:function(e){const t=e.get(zm.actions.snapRotateLeft)||e.get(zm.actions.snapRotateRight),n=e.get(nK?zm.device.touchscreen.touchCameraDelta:zm.device.smartMouse.cameraDelta);return t||n?2:1},invite:function(e,t,n){return n&&"invite"===n.entry_mode?0:t.is("copresent")?2:1},end:function(){return aK("end")},menu:function(){return aK("menu")}};function cK(e,t){const n=qo(e,t);return n&&(0,Ot.hasComponent)(e,Ut,n)&&e.eid2obj.get(n).el}function dK(e){return ef(e,"singleActionButton")||ef(e,"holdableButton")}function uK(e){return e}AFRAME.registerSystem("tips",{init:function(){this.activeTip=null,this._performStep=this._performStep.bind(this);const e=JSON.parse(localStorage.getItem(JX));null===e?localStorage.setItem(JX,JSON.stringify({})):!Object.keys(e).every((e=>oK.includes(e)))&&(localStorage.setItem(JX,JSON.stringify({})),this.skipTips())},resetTips:function(){localStorage.setItem(JX,JSON.stringify({})),eK=null,window.APP.store.resetTipActivityFlags(),window.APP.store.resetConfirmedBroadcastedRooms(),this.activeTip=null,tK=!1},skipTips:function(){for(let e=0;e<oK.length;e++)sK(oK[e])},prevTip:function(){const e=this.activeTip.split(".")[2];let t=oK.indexOf(e);!function(e){const t=JSON.parse(localStorage.getItem(JX));delete t[e],localStorage.setItem(JX,JSON.stringify(t)),eK=null}(oK[t>0?--t:0])},nextTip:function(){sK(this.activeTip.split(".")[2])},tick:function(){if(iK)return;if(!this._userinput&&(this._userinput=this.el.systems.userinput,!this._userinput))return;const e=oK,t=this.activeTip;this._performStep(e),t!==this.activeTip&&this.el.emit("tip-changed",this.activeTip)},_performStep:function(e){if(tK)return;let t=null,n=0;for(let i=0;i<e.length;i++){const r=e[i];if(null===eK&&(eK=JSON.parse(localStorage.getItem(JX))),eK[r]&&eK[r].finished)n++;else{switch(lK[r](this._userinput,this.el,window.APP.hub)){case 2:sK(r);break;case 1:t=`tips.${rK()}.${r}`}if(t)break}}this.activeTip=t,n===e.length&&(tK=!0)}}),AFRAME.registerSystem("interaction",{getActiveIntersection(){return this.state.rightRemote.hovered&&this.rightCursorControllerEl.components["cursor-controller"].intersection||this.state.leftRemote.hovered&&this.leftCursorControllerEl.components["cursor-controller"].intersection},isHoldingAnything(e){return void 0===e&&(e=uK),!!(e(this.state.leftHand.held)||e(this.state.rightHand.held)||e(this.state.rightRemote.held)||e(this.state.leftRemote.held))},isHeld(e){return this.state.leftHand.held===e||this.state.rightHand.held===e||this.state.rightRemote.held===e||this.state.leftRemote.held===e},init:function(){this.options={leftHand:{entity:null,grabPath:zm.actions.leftHand.grab,dropPath:zm.actions.leftHand.drop},rightHand:{entity:null,grabPath:zm.actions.rightHand.grab,dropPath:zm.actions.rightHand.drop},rightRemote:{entity:null,grabPath:zm.actions.cursor.right.grab,dropPath:zm.actions.cursor.right.drop},leftRemote:{entity:null,grabPath:zm.actions.cursor.left.grab,dropPath:zm.actions.cursor.left.drop}},this.state={leftHand:{hovered:null,held:null},rightHand:{hovered:null,held:null},rightRemote:{hovered:null,held:null},leftRemote:{hovered:null,held:null}},this.previousState={leftHand:{hovered:null,held:null},rightHand:{hovered:null,held:null},rightRemote:{hovered:null,held:null},leftRemote:{hovered:null,held:null}},L().then((()=>{this.options.leftHand.entity=document.getElementById("player-left-controller"),this.options.rightHand.entity=document.getElementById("player-right-controller"),this.options.rightRemote.entity=document.getElementById("right-cursor"),this.options.leftRemote.entity=document.getElementById("left-cursor"),this.rightCursorControllerEl=document.getElementById("right-cursor-controller"),this.leftCursorControllerEl=document.getElementById("left-cursor-controller"),this.ready=!0}))},updateLegacyState(){this.previousState.rightRemote.hovered=this.state.rightRemote.hovered,this.previousState.rightRemote.held=this.state.rightRemote.held,this.previousState.leftRemote.hovered=this.state.leftRemote.hovered,this.previousState.leftRemote.held=this.state.leftRemote.held,this.previousState.leftHand.hovered=this.state.leftHand.hovered,this.previousState.leftHand.held=this.state.leftHand.held,this.previousState.rightHand.hovered=this.state.rightHand.hovered,this.previousState.rightHand.held=this.state.rightHand.held;const e=APP.world;this.state.rightRemote.hovered=cK(e,cn),this.state.leftRemote.hovered=cK(e,dn),this.state.rightHand.hovered=cK(e,an),this.state.leftHand.hovered=cK(e,ln),this.state.rightRemote.held=cK(e,pn),this.state.leftRemote.held=cK(e,mn),this.state.rightHand.held=cK(e,un),this.state.leftHand.held=cK(e,hn)}});const hK=function(){};AFRAME.registerComponent("overwrite-raycast-as-noop",{init(){this.el.object3D.raycast=hK,this.mesh=this.el.getObject3D("mesh"),this.mesh?this.mesh.raycast=hK:this.el.addEventListener("model-loaded",(()=>{this.mesh=this.el.getObject3D("mesh"),this.mesh&&(this.mesh.raycast=hK)}))}});const pK=(0,Ot.defineQuery)([Xt]),mK=(0,Ot.enterQuery)(pK),fK=(0,Ot.exitQuery)(pK);class gK{constructor(){this.aframeTargets=[],this.targets=[],this.dirty=!0,this.onMutation=this.onMutation.bind(this),this.onObject3DSet=this.onObject3DSet.bind(this),this.onObject3DRemove=this.onObject3DRemove.bind(this),this.observer=new MutationObserver(this.onMutation),L().then((()=>{const e=document.querySelector("a-scene");this.rightRemote=document.getElementById("right-cursor-controller"),this.leftRemote=document.getElementById("left-cursor-controller"),this.observer.observe(e,{childList:!0,attributes:!0,subtree:!0}),e.addEventListener("object3dset",this.onObject3DSet),e.addEventListener("object3dremove",this.onObject3DRemove)}))}tick(e){let t=!1;if(this.dirty){this.aframeTargets.length=0;const e=AFRAME.scenes[0].querySelectorAll(".collidable, .interactable, .ui, .drawing, .occupiable-waypoint-icon, .teleport-waypoint-icon, .avatar-inspect-collider");for(let t=0;t<e.length;t++)e[t].object3D&&this.aframeTargets.push(e[t].object3D);this.dirty=!1,t=!0}if((mK(APP.world).length||fK(APP.world).length)&&(t=!0),t){this.targets.length=0,this.aframeTargets.forEach((e=>{this.targets.push(e)}));const e=pK(APP.world);for(let t=0;t<e.length;t++)this.targets.push(APP.world.eid2obj.get(e[t]))}this.rightRemote&&this.rightRemote.components["cursor-controller"].tick2(e),this.leftRemote&&this.leftRemote.components["cursor-controller"].tick2(e,!0)}onObject3DSet(){this.dirty=!0}onObject3DRemove(){this.dirty=!0}onMutation(e){e.some((e=>"childList"===e.type||"attributes"===e.type&&"class"===e.attributeName))&&(this.dirty=!0)}remove(){this.observer.disconnect(),AFRAME.scenes[0].removeEventListener("object3dset",this.onObject3DSet),AFRAME.scenes[0].removeEventListener("object3dremove",this.onObject3DRemove)}}function vK(e,t,n,i,r,o,s){const a=t.is("vr-mode")&&r&&(0,Ot.hasComponent)(e,kn,r)&&e.eid2obj.get(r).el.children[0].components.pen.intersection;return t.is("entered")&&s&&!n&&!i&&!o&&!a}class bK{constructor(){this.wakeLeft=!1,this.wakeRight=!1,L().then((()=>{this.domContentLoadedButComponentsMayNotHave=!0}))}tick(e,t,n){if(!this.domContentLoadedButComponentsMayNotHave)return;this.gotComponentReferences||(this.gotComponentReferences=!0,this.rightCursorController=document.getElementById("right-cursor-controller").components["cursor-controller"],this.leftCursorController=document.getElementById("left-cursor-controller").components["cursor-controller"],this.rightHandTeleporter=document.getElementById("player-right-controller").components.teleporter,this.leftHandTeleporter=document.getElementById("player-left-controller").components.teleporter,this.gazeTeleporter=document.getElementById("gaze-teleport").components.teleporter);const i=APP.world,r=qo(i,ln),o=qo(i,hn),s=qo(i,mn),a=qo(i,an),l=qo(i,un),c=qo(i,pn);t.get(zm.actions.cursor.right.wake)&&(this.wakeRight=!0,s||(this.wakeLeft=!1)),t.get(zm.actions.cursor.left.wake)&&(this.wakeLeft=!0,c||(this.wakeRight=!1));const d=3===e.el.systems["hubs-systems"].cameraSystem.mode,u=!d&&vK(i,n,r,o,s,this.leftHandTeleporter.isTeleporting||this.gazeTeleporter.isTeleporting,this.wakeLeft),h=AFRAME.utils.device.isMobile()||q()||!d&&vK(i,n,a,l,c,this.rightHandTeleporter.isTeleporting||this.gazeTeleporter.isTeleporting,this.wakeRight);this.leftCursorController.enabled=u,this.rightCursorController.enabled=h}}var yK=n(12694),wK=n(77040),_K=n(99477);function EK(e,t,n,i,r,o,s){try{var a=e[o](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(i,r)}const AK=Na.tl.MESSAGE_TYPES,SK=Na.tl.TYPE,xK=Na.tl.BUFFER_CONFIG,MK={debugDrawMode:yK.AU.DrawWireframe,gravity:{x:0,y:-9.8,z:0}};class PK{constructor(e){var t=this;this.tick=(()=>{const e=new _K.Matrix4,t=new _K.Matrix4,n=new _K.Matrix4,i=new _K.Vector3;return function(){if(this.ready){if(this.debugRequested!==this.debugEnabled&&(this.debugRequested?this.enableDebug():this.disableDebug()),0!==this.objectMatricesFloatArray.buffer.byteLength){for(let r=0;r<this.bodyUuids.length;r++){const o=this.bodyUuids[r],s=this.bodyUuidToData.get(o),a=s.index,l=s.options.type?s.options.type:SK.DYNAMIC,c=s.object3D;if(c.parent){l===SK.DYNAMIC&&(n.fromArray(this.objectMatricesFloatArray,a*xK.BODY_DATA_SIZE+xK.MATRIX_OFFSET),c.parent.updateMatrices(),t.copy(c.parent.matrixWorld).invert(),e.multiplyMatrices(t,n),e.decompose(c.position,c.quaternion,i),c.matrixNeedsUpdate=!0),c.updateMatrices(),this.objectMatricesFloatArray.set(c.matrixWorld.elements,a*xK.BODY_DATA_SIZE+xK.MATRIX_OFFSET),s.linearVelocity=this.objectMatricesFloatArray[a*xK.BODY_DATA_SIZE+xK.LINEAR_VELOCITY_OFFSET],s.angularVelocity=this.objectMatricesFloatArray[a*xK.BODY_DATA_SIZE+xK.ANGULAR_VELOCITY_OFFSET],s.collisions.length=0;for(let e=xK.COLLISIONS_OFFSET;e<xK.BODY_DATA_SIZE;e++){const t=this.objectMatricesIntArray[a*xK.BODY_DATA_SIZE+e];-1!==t&&void 0!==this.indexToUuid[t]&&s.collisions.push(this.indexToUuid[t])}}else console.error("Physics body exists but object3D has no parent.")}this.ammoWorker.postMessage({type:AK.TRANSFER_DATA,objectMatricesFloatArray:this.objectMatricesFloatArray},[this.objectMatricesFloatArray.buffer])}if(this.debugEnabled){const e=window.Atomics.load(this.debugIndex,0);0!==e&&(this.debugGeometry.attributes.position.needsUpdate=!0,this.debugGeometry.attributes.color.needsUpdate=!0),this.debugGeometry.setDrawRange(0,e),window.Atomics.store(this.debugIndex,0,0)}}}})(),this.ammoWorker=new Na.p4,this.workerHelpers=new Na.Zn(this.ammoWorker),this.bodyUuids=[],this.indexToUuid={},this.bodyUuidToData=new Map,this.debug=!1,this.debugRequested=!1,this.debugEnabled=!1,this.scene=e,this.stepDuration=0,this.ready=!1,this.nextBodyUuid=1,this.nextShapeUuid=1;const n=new ArrayBuffer(4*xK.BODY_DATA_SIZE*512);this.objectMatricesFloatArray=new Float32Array(n),this.objectMatricesIntArray=new Int32Array(n),this.ammoWorker.postMessage({type:AK.INIT,worldConfig:MK,arrayBuffer:n,maxBodies:512,wasmUrl:new URL(wK.Z,k.BASE_ASSETS_PATH||window.location).href},[n]),this.ammoWorker.onmessage=function(){var e,n=(e=function*(e){if(e.data.type===AK.READY)t.ready=!0;else if(e.data.type===AK.BODY_READY){const{uuid:n,index:i}=e.data,r=t.bodyUuidToData.get(n);r.index=i,r.isInitialized=!0,r.removeBodyMessageSent?t.bodyUuidToData.delete(n):(t.bodyUuids.push(n),t.indexToUuid[i]=n)}else if(e.data.type===AK.SHAPES_READY){const n=e.data.bodyUuid,i=e.data.shapesUuid;t.bodyUuidToData.has(n)?t.bodyUuidToData.get(n).shapes.push(i):console.warn("Shape initialized on worker but body is missing.")}else e.data.type===AK.TRANSFER_DATA&&(t.objectMatricesFloatArray=e.data.objectMatricesFloatArray,t.objectMatricesIntArray=new Int32Array(t.objectMatricesFloatArray.buffer),t.stepDuration=e.data.stepDuration)},function(){var t=this,n=arguments;return new Promise((function(i,r){var o=e.apply(t,n);function s(e){EK(o,i,r,s,a,"next",e)}function a(e){EK(o,i,r,s,a,"throw",e)}s(void 0)}))});return function(e){return n.apply(this,arguments)}}()}setDebug(e){this.debugRequested=e}enableDebug(){if(!window.SharedArrayBuffer)return console.warn("Physics debug rendering only available in browsers that support SharedArrayBuffers."),void(this.debugRequested=!1);if(this.debugEnabled=!0,!this.debugMesh){this.debugSharedArrayBuffer=new window.SharedArrayBuffer(4+2*yK.Ed*4),this.debugIndex=new Uint32Array(this.debugSharedArrayBuffer,0,4);const e=new Float32Array(this.debugSharedArrayBuffer,4,yK.Ed),t=new Float32Array(this.debugSharedArrayBuffer,4+yK.Ed,yK.Ed);this.debugGeometry=new _K.BufferGeometry,this.debugGeometry.setAttribute("position",new _K.BufferAttribute(e,3)),this.debugGeometry.setAttribute("color",new _K.BufferAttribute(t,3));const n=new _K.LineBasicMaterial({vertexColors:!0,depthTest:!0});this.debugMesh=new _K.LineSegments(this.debugGeometry,n),this.debugMesh.frustumCulled=!1,this.debugMesh.renderOrder=999}this.debugMesh.parent||(this.scene.add(this.debugMesh),this.workerHelpers.enableDebug(!0,this.debugSharedArrayBuffer))}disableDebug(){this.debugEnabled=!1,this.debugMesh&&(this.scene.remove(this.debugMesh),this.workerHelpers.enableDebug(!1))}addBody(e,t){const n=this.nextBodyUuid;return this.nextBodyUuid+=1,this.workerHelpers.addBody(n,e,t),this.bodyUuidToData.set(n,{object3D:e,options:t,collisions:[],linearVelocity:0,angularVelocity:0,index:-1,shapes:[],isInitialized:!1,removeBodyMessageSent:!1}),n}updateBody(e,t){this.bodyUuidToData.has(e)?(this.bodyUuidToData.get(e).options=t,this.workerHelpers.updateBody(e,t)):console.warn(`updateBody called for uuid: ${e} but body missing.`)}updateBodyOptions(e,t){this.bodyUuidToData.get(e)?this.workerHelpers.updateBody(e,Object.assign(this.bodyUuidToData.get(e).options,t)):console.warn("updateBodyOptions called for invalid bodyId")}removeBody(e){const t=this.bodyUuidToData.get(e);t?(this.workerHelpers.removeBody(e),t.removeBodyMessageSent=!0,t.isInitialized&&(delete this.indexToUuid[t.index],t.collisions.forEach((t=>{const n=this.bodyUuidToData.get(t).collisions;n.splice(n.indexOf(e),1)})),this.bodyUuids.splice(this.bodyUuids.indexOf(e),1),this.bodyUuidToData.delete(e))):console.error("removeBody called for unknown body id")}addShapes(e,t,n){if(t){const e=new _K.Vector3;t.updateMatrices(),e.setFromMatrixScale(t.matrixWorld)}return this.workerHelpers.addShapes(e,this.nextShapeUuid,t,n),this.bodyUuidToData.get(e).shapes.push(this.nextShapeUuid),this.nextShapeUuid++}removeShapes(e,t){if(this.bodyUuidToData.has(e)){this.workerHelpers.removeShapes(e,t);const n=this.bodyUuidToData.get(e).shapes.indexOf(t);-1!==n?this.bodyUuidToData.get(e).shapes.splice(n,1):console.warn(`removeShapes called for shapesUuid: ${t} on bodyUuid: ${e} but shapes missing.`)}else console.error(`Tried to remove shape for unknown body ${e}`)}addConstraint(e,t,n,i){this.workerHelpers.addConstraint(e,t,n,i)}removeConstraint(e){this.workerHelpers.removeConstraint(e)}bodyInitialized(e){return this.bodyUuidToData.has(e)&&-1!==this.bodyUuidToData.get(e).index}getLinearVelocity(e){return this.bodyUuidToData.get(e).linearVelocity}getAngularVelocity(e){return this.bodyUuidToData.get(e).angularVelocity}getCollisions(e){return this.bodyUuidToData.get(e).collisions}resetDynamicBody(e){this.workerHelpers.resetDynamicBody(e)}activateBody(e){this.workerHelpers.activateBody(e)}}var CK=n(99477);const kK={collisionFilterMask:Ue.HANDS},OK=(()=>{const e=new CK.Vector3,t=new CK.Vector3;return function(n,i){return n.getWorldPosition(e),i.getWorldPosition(t),e.distanceTo(t)}})();function TK(e,t,n){return e&&(e===t.held||e===n.held)}class RK{constructor(){this.initialScale=new CK.Vector3}tick(){const e=AFRAME.scenes[0].systems.interaction;if(!e.ready)return;const{leftHand:t,rightHand:n,rightRemote:i,leftRemote:r}=e.state,o=TK(t.held,n,i)||TK(r.held,n,i),s=t.held||r.held;let a,l;o&&(a=t.held?e.options.leftHand.entity.object3D:e.options.leftRemote.entity.object3D,l=n.held?e.options.rightHand.entity.object3D:e.options.rightRemote.entity.object3D,a===this.previousLeftStretcher&&l===this.previousRightStretcher&&s===this.stretched||(this.initialStretchDistance=OK(a,l),this.stretched=s,this.initialScale.copy(this.stretched.object3D.scale),this.stretched.components["ammo-body"]&&this.stretched.setAttribute("ammo-body",kK)),this.stretched.object3D.scale.copy(this.initialScale).multiplyScalar(OK(a,l)/this.initialStretchDistance),this.stretched.object3D.matrixNeedsUpdate=!0),this.previousLeftStretcher=a,this.previousRightStretcher=l}}class DK{tick(){const e=AFRAME.scenes[0].systems.interaction,t=e.state.rightRemote.held;this.prevHeld&&this.prevHeld!==t&&this.prevHeld.object3D.dispatchEvent({type:"holdable-button-up",object3D:e.options.rightRemote.entity.object3D}),t&&this.prevHeld!==t&&t.object3D.dispatchEvent({type:"holdable-button-down",object3D:e.options.rightRemote.entity.object3D}),this.prevHeld=t;const n=e.state.leftRemote.held;this.prevHeldLeft&&this.prevHeldLeft!==n&&ef(this.prevHeldLeft,"holdableButton")&&this.prevHeldLeft.object3D.dispatchEvent({type:"holdable-button-up",object3D:e.options.leftRemote.entity.object3D}),n&&this.prevHeldLeft!==n&&ef(this.heldLeft,"holdableButton")&&n.object3D.dispatchEvent({type:"holdable-button-down",object3D:e.options.leftRemote.entity.object3D}),this.prevHeldLeft=n}}const jK=function(){const e=["icon-button","text-button","pin-networked-object-button","mic-button","inspect-button"];return function(t){for(let n=0;n<e.length;n++)if(t[e[n]])return!0;return!1}}();function LK(e){if(!e)return null;if(jK(e.components)||e.classList.contains("teleport-waypoint-icon")||e.classList.contains("occupiable-waypoint-icon"))return e;if(e.children)for(let t=0;t<e.children.length;t++)if(jK(e.children[t].components)||e.children[t].classList.contains("teleport-waypoint-icon")||e.children[t].classList.contains("occupiable-waypoint-icon"))return e.children[t];return null}function IK(e,t){if(e.object3D.dispatchEvent(t),e.children)for(let n=0;n<e.children.length;n++)(jK(e.children[n].components)||e.children[n].classList.contains("teleport-waypoint-icon")||e.children[n].classList.contains("occupiable-waypoint-icon"))&&e.children[n].object3D.dispatchEvent(t)}const NK={type:"hovered"},FK={type:"unhovered"};class BK{tick(){const e=AFRAME.scenes[0].systems.interaction,t=LK(e.state.rightRemote.hovered),n=LK(e.state.leftRemote.hovered);this.prevButton&&this.prevButton!==t&&IK(this.prevButton,FK),t&&this.prevButton!==t&&IK(t,NK),this.prevButton=t,this.prevButtonLeft&&this.prevButtonLeft!==n&&IK(this.prevButtonLeft,FK),n&&this.prevButtonLeft!==n&&IK(n,NK),this.prevButtonLeft=n}}var VK=n(99477);class UK{constructor(e){this.scaleMenus=(()=>{const e=new VK.Vector3;return function(){if(this.drawingMenus&&0!==this.drawingMenus.length){this.camera.object3D.getWorldPosition(e);for(let t=0;t<this.drawingMenus.length;t++){const n=this.drawingMenus[t];if(n.object3D.visible&&!n.getAttribute("animation__show")){const t=e.distanceTo(n.object3D.position);n.object3D.scale.setScalar(this.getMenuScale(t)),n.object3D.matrixNeedsUpdate=!0}}}}})(),this.handleButtons=(()=>{const e=["rightRemote","leftRemote"];return function(){const t=AFRAME.scenes[0].systems.interaction,n=AFRAME.scenes[0].systems.userinput;for(let i=0;i<e.length;i++){const r=e[i];if(t.state[r]){const e=t.state[r].hovered;if(e&&n.get(t.options[r].grabPath)&&(0,Ot.hasComponent)(APP.world,Cn,e.eid)&&this.buttonMap[e.object3D.uuid]){const t=this.buttonMap[e.object3D.uuid];e.classList.contains("undo-drawing")?(t.components["networked-drawing"].undoDraw(),this.sceneEl.systems["hubs-systems"].soundEffectsSystem.playSoundOneShot(um)):e.classList.contains("delete-drawing")?(NAF.utils.takeOwnership(t),this.sceneEl.removeChild(t)):e.classList.contains("serialize-drawing")&&t.components["networked-drawing"].serializeDrawing().then((()=>{const t=this.buttonMap[e.object3D.uuid];NAF.utils.takeOwnership(t),this.sceneEl.removeChild(t)}))}}}}})(),this.showMenu=(()=>{const e=new VK.Vector3,t=new VK.Vector3;return function(n,i){const r=n.children[0];if(!r.object3D.visible||!function(e,t,n){return Math.abs(t.x-n.x)<e&&Math.abs(t.y-n.y)<e&&Math.abs(t.z-n.z)<e}(.25,i,this.lastIntersection)){this.camera.object3D.getWorldPosition(t),e.subVectors(t,i).normalize().multiplyScalar(.1),r.object3D.position.copy(i).add(e),r.object3D.lookAt(t),r.object3D.matrixNeedsUpdate=!0,r.object3D.visible=!0,this.lastIntersection.copy(i);const o=n.components.networked.isMine();r.querySelector(".undo-drawing").object3D.visible=o,r.querySelector(".serialize-drawing").object3D.visible=o&&window.APP.hubChannel.can("spawn_and_move_media");const s=t.distanceTo(r.object3D.position),a=this.getMenuScale(s);r.removeAttribute("animation__show"),r.setAttribute("animation__show",{property:"scale",dur:300,from:{x:.8*a,y:.8*a,z:.8*a},to:{x:a,y:a,z:a},easing:"easeOutElastic"}),r.addEventListener("animationcomplete",(()=>{r.removeAttribute("animation__show")}),{once:!0})}}})(),this.sceneEl=e,this.sceneEl.addEventListener("stateremoved",this.hideMenus.bind(this)),this.lastIntersection=new VK.Vector3,this.drawingMenus=[],this.buttonMap={},L().then((()=>{this.cursorControllers=document.querySelectorAll("[cursor-controller]"),this.camera=this.sceneEl.querySelector("#avatar-pov-node")}))}tick(){if(this.cursorControllers&&0!==this.cursorControllers.length&&this.camera&&this.sceneEl.is("frozen")&&window.APP.hubChannel.can("spawn_drawing")){const e=this.getHovered();if(e)for(let t=0;t<this.cursorControllers.length;t++)if(this.cursorControllers[t].components["cursor-controller"].intersection){const n=this.cursorControllers[t].components["cursor-controller"].intersection.point;this.showMenu(e,n)}this.handleButtons(),this.scaleMenus()}}getMenuScale(e){return e<=1.5?.5:Math.min(3,e-1)}getHovered(){const e=AFRAME.scenes[0].systems.interaction;let t=null;return e.state.leftRemote&&e.state.leftRemote.hovered&&e.state.leftRemote.hovered.classList.contains("drawing")?t=e.state.leftRemote.hovered:e.state.rightRemote&&e.state.rightRemote.hovered&&e.state.rightRemote.hovered.classList.contains("drawing")&&(t=e.state.rightRemote.hovered),t}hideMenus(){if(this.drawingMenus)for(let e=0;e<this.drawingMenus.length;e++)this.drawingMenus[e].object3D.visible=!1}registerDrawingMenu(e){const t=e.querySelector(".drawing-menu");this.drawingMenus.push(t);const n=t.querySelector(".undo-drawing");this.buttonMap[n.object3D.uuid]=e;const i=t.querySelector(".delete-drawing");this.buttonMap[i.object3D.uuid]=e;const r=t.querySelector(".serialize-drawing");this.buttonMap[r.object3D.uuid]=e}unregisterDrawingMenu(e){const t=e.querySelector(".drawing-menu"),n=this.drawingMenus.indexOf(t);-1!==n&&this.drawingMenus.splice(n,1);const i=t.querySelector(".undo-drawing");delete this.buttonMap[i.object3D.uuid];const r=t.querySelector(".delete-drawing");delete this.buttonMap[r.object3D.uuid];const o=t.querySelector(".serialize-drawing");delete this.buttonMap[o.object3D.uuid]}}function HK(e){return e&&e.components&&(e.components["hover-menu"]||e.components["hover-menu__video"]||e.components["hover-menu__pager"]||e.components["hover-menu__hubs-item"]||e.components["hover-menu__link"]||e.components["hover-menu__photo"])}function zK(e){if(!e)return null;const t=HK(e);if(t)return t;if(!ef(e,"isHoverMenuChild"))return null;let n=e.parentNode;for(;n&&!HK(n);)n=n.parentNode;return HK(n)}class WK{tick(){const e=AFRAME.scenes[0].systems.interaction,t=zK(e.state.rightRemote.hovered);this.prevHoverMenu&&this.prevHoverMenu!==t&&(this.prevHoverMenu.hovering=!1,this.prevHoverMenu.applyHoverState()),t&&this.prevHoverMenu!==t&&(t.hovering=!0,t.applyHoverState()),this.prevHoverMenu=t;const n=zK(e.state.leftRemote.hovered);this.prevHoverMenu2&&this.prevHoverMenu2!==n&&(this.prevHoverMenu2.hovering=!1,this.prevHoverMenu2.applyHoverState()),n&&this.prevHoverMenu2!==n&&(n.hovering=!0,n.applyHoverState()),this.prevHoverMenu2=n}}class qK{maybeSpawn(e,t,n){const i=AFRAME.scenes[0].systems.userinput,r=e.hovered&&e.hovered.components["super-spawner"],o=window.APP.hubChannel&&(r&&"#interactable-emoji"===r.data.template?window.APP.hubChannel.can("spawn_emoji"):window.APP.hubChannel.can("spawn_and_move_media"));r&&r.spawnedMediaScale&&!r.cooldownTimeout&&i.get(t)&&o&&this.performSpawn(e,r,n)}performSpawn(e,t,n){const i=t.data,r=Nl(i.src,i.template,sl,null,i.resolve,!0,!1,i.mediaOptions).entity;r.components.networked&&!r.components.networked.data&&(r.components.networked.data={}),t.el.object3D.getWorldPosition(r.object3D.position),t.el.object3D.getWorldQuaternion(r.object3D.quaternion),r.object3D.matrixNeedsUpdate=!0,t.el.emit("spawned-entity-created",{target:r}),t.activateCooldown(),r.addEventListener("media-loaded",(()=>{r.object3D.scale.copy(t.spawnedMediaScale),r.object3D.matrixNeedsUpdate=!0,t.el.emit("spawned-entity-loaded",{target:r}),(0,Ot.addComponent)(APP.world,n,r.eid),(0,Ot.addComponent)(APP.world,fn,r.eid)}),{once:!0})}tick(){const e=AFRAME.scenes[0].systems.interaction;e.ready&&(this.maybeSpawn(e.state.leftHand,e.options.leftHand.grabPath,hn),this.maybeSpawn(e.state.rightHand,e.options.rightHand.grabPath,un),this.maybeSpawn(e.state.rightRemote,e.options.rightRemote.grabPath,pn),this.maybeSpawn(e.state.leftRemote,e.options.leftRemote.grabPath,mn))}}var ZK=n(99477);function GK(e,t,n){e.held=t.held,e.hovered=t.hovered,e.isTeleporting=n}function YK(e,t,n){return e.held&&!t.held?.1:!e.held&&t.held?.2:!e.hovered&&t.hovered||n?.08:e.isTeleporting&&!n?.2:0}class QK{constructor(){this.state={rightHand:{held:null,hovered:null,isTeleporting:!1},rightRemote:{held:null,hovered:null,isTeleporting:!1},leftHand:{held:null,hovered:null,isTeleporting:!1},leftRemote:{held:null,hovered:null,isTeleporting:!1}}}tick(e,t,n){const i=AFRAME.scenes[0].systems.userinput,r=i.get(zm.haptics.actuators.left),o=i.get(zm.haptics.actuators.right);if(!r&&!o)return;const s=AFRAME.scenes[0].systems.interaction,{leftHand:a,rightHand:l,rightRemote:c,leftRemote:d}=s.state;this.leftTeleporter=this.leftTeleporter||document.querySelector("#player-left-controller").components.teleporter,this.rightTeleporter=this.rightTeleporter||document.querySelector("#player-right-controller").components.teleporter;const u=YK(this.state.leftHand,a,this.leftTeleporter.isTeleporting),h=YK(this.state.rightHand,l,this.rightTeleporter.isTeleporting),p=YK(this.state.rightRemote,c,!1),m=YK(this.state.leftRemote,d,!1),f=t?.2:0,g=n?.2:0,v=(b=e).stretcherLeft&&b.stretcherRight?ZK.MathUtils.clamp(.05+.2*Math.abs(OK(b.stretcherLeft,b.stretcherRight)-b.initialStretchDistance),0,.5):0;var b;const y=Math.max(u,m,v,f),w=Math.max(h,p,v,g);y&&r&&r.pulse(y,15),w&&o&&o.pulse(w,15),GK(this.state.rightHand,l,this.rightTeleporter.isTeleporting),GK(this.state.leftHand,a,this.leftTeleporter.isTeleporting),GK(this.state.rightRemote,c,!1),GK(this.state.leftRemote,d,!1)}}let XK,KK;class $K{constructor(){this.entities=[]}register(e){this.entities.push(e)}unregister(e){this.entities.splice(this.entities.indexOf(e),1)}tick(){XK=XK||document.getElementById("viewing-camera"),KK=KK||document.getElementById("ui-root");const e=XK&&XK.sceneEl.is("entered"),t=!e&&KK&&KK.firstChild&&KK.firstChild.classList.contains("isGhost");for(let n=0;n<this.entities.length;n++){const i=this.entities[n],r=AFRAME.scenes[0].systems["hubs-systems"];!i||r&&(3===r.cameraSystem.mode||t||e)||(i.components["scene-preview-camera"].tick2(),r&&XK&&(i.object3D.updateMatrices(),Oo(XK.object3DMap.camera,i.object3D.matrixWorld)))}}}class JK{constructor(){}tick(e,t,n){const i=e.state,r=e.previousState;(i.leftHand.held!==r.leftHand.held||i.rightHand.held!==r.rightHand.held||i.rightRemote.held!==r.rightRemote.held||dK(i.rightRemote.hovered)&&i.rightRemote.hovered!==r.rightRemote.hovered||i.leftRemote.held!==r.leftRemote.held||dK(i.leftRemote.hovered)&&i.leftRemote.hovered!==r.leftRemote.hovered)&&n.playSoundOneShot(lm),t.get(zm.actions.logInteractionState)&&(console.log("Interaction System State\nleftHand held",i.leftHand.held,"\nleftHand hovered",i.leftHand.hovered,"\nrightHand held",i.rightHand.held,"\nrightHand hovered",i.rightHand.hovered,"\nrightRemote held",i.rightRemote.held,"\nrightRemote hovered",i.rightRemote.hovered,"\nleftRemote held",i.leftRemote.held,"\nleftRemote hovered",i.leftRemote.hovered),console.log("Interaction System State\nleftHand held",qo(APP.world,hn),"\nleftHand hovered",qo(APP.world,ln),"\nrightHand held",qo(APP.world,un),"\nrightHand hovered",qo(APP.world,an),"\nrightRemote held",qo(APP.world,pn),"\nrightRemote hovered",qo(APP.world,cn),"\nleftRemote held",qo(APP.world,mn),"\nleftRemote hovered",qo(APP.world,dn)))}}var e$=JSON.parse('{"meta":{"image":"sprite-system-action-spritesheet.png","size":{"w":1024,"h":1024},"scale":"1"},"frames":{"angry-off.png":{"frame":{"x":8,"y":8,"w":130,"h":130},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":130,"h":130},"sourceSize":{"w":130,"h":130}},"angry-on-hover.png":{"frame":{"x":154,"y":8,"w":130,"h":130},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":130,"h":130},"sourceSize":{"w":130,"h":130}},"angry-on.png":{"frame":{"x":8,"y":154,"w":130,"h":130},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":130,"h":130},"sourceSize":{"w":130,"h":130}},"disgust-off.png":{"frame":{"x":154,"y":154,"w":130,"h":130},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":130,"h":130},"sourceSize":{"w":130,"h":130}},"disgust-on-hover.png":{"frame":{"x":300,"y":8,"w":130,"h":130},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":130,"h":130},"sourceSize":{"w":130,"h":130}},"disgust-on.png":{"frame":{"x":300,"y":154,"w":130,"h":130},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":130,"h":130},"sourceSize":{"w":130,"h":130}},"eww-off.png":{"frame":{"x":8,"y":300,"w":130,"h":130},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":130,"h":130},"sourceSize":{"w":130,"h":130}},"eww-on-hover.png":{"frame":{"x":154,"y":300,"w":130,"h":130},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":130,"h":130},"sourceSize":{"w":130,"h":130}},"eww-on.png":{"frame":{"x":300,"y":300,"w":130,"h":130},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":130,"h":130},"sourceSize":{"w":130,"h":130}},"happy-off.png":{"frame":{"x":446,"y":8,"w":130,"h":130},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":130,"h":130},"sourceSize":{"w":130,"h":130}},"happy-on-hover.png":{"frame":{"x":446,"y":154,"w":130,"h":130},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":130,"h":130},"sourceSize":{"w":130,"h":130}},"happy-on.png":{"frame":{"x":446,"y":300,"w":130,"h":130},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":130,"h":130},"sourceSize":{"w":130,"h":130}},"hearts-off.png":{"frame":{"x":8,"y":446,"w":130,"h":130},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":130,"h":130},"sourceSize":{"w":130,"h":130}},"hearts-on-hover.png":{"frame":{"x":154,"y":446,"w":130,"h":130},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":130,"h":130},"sourceSize":{"w":130,"h":130}},"hearts-on.png":{"frame":{"x":300,"y":446,"w":130,"h":130},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":130,"h":130},"sourceSize":{"w":130,"h":130}},"sad-off.png":{"frame":{"x":446,"y":446,"w":130,"h":130},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":130,"h":130},"sourceSize":{"w":130,"h":130}},"sad-on-hover.png":{"frame":{"x":592,"y":8,"w":130,"h":130},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":130,"h":130},"sourceSize":{"w":130,"h":130}},"sad-on.png":{"frame":{"x":592,"y":154,"w":130,"h":130},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":130,"h":130},"sourceSize":{"w":130,"h":130}},"smile-off.png":{"frame":{"x":592,"y":300,"w":130,"h":130},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":130,"h":130},"sourceSize":{"w":130,"h":130}},"smile-on-hover.png":{"frame":{"x":592,"y":446,"w":130,"h":130},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":130,"h":130},"sourceSize":{"w":130,"h":130}},"smile-on.png":{"frame":{"x":8,"y":592,"w":130,"h":130},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":130,"h":130},"sourceSize":{"w":130,"h":130}},"surprise-off.png":{"frame":{"x":154,"y":592,"w":130,"h":130},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":130,"h":130},"sourceSize":{"w":130,"h":130}},"surprise-on-hover.png":{"frame":{"x":300,"y":592,"w":130,"h":130},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":130,"h":130},"sourceSize":{"w":130,"h":130}},"surprise-on.png":{"frame":{"x":446,"y":592,"w":130,"h":130},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":130,"h":130},"sourceSize":{"w":130,"h":130}},"mod-badge.png":{"frame":{"x":592,"y":592,"w":128,"h":128},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":128,"h":128},"sourceSize":{"w":128,"h":128}},"recording-badge.png":{"frame":{"x":738,"y":8,"w":128,"h":128},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":128,"h":128},"sourceSize":{"w":128,"h":128}},"spawn-disabled.png":{"frame":{"x":738,"y":152,"w":128,"h":128},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":128,"h":128},"sourceSize":{"w":128,"h":128}},"spawn-hover.png":{"frame":{"x":738,"y":296,"w":128,"h":128},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":128,"h":128},"sourceSize":{"w":128,"h":128}},"spawn.png":{"frame":{"x":738,"y":440,"w":128,"h":128},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":128,"h":128},"sourceSize":{"w":128,"h":128}},"Background.png":{"frame":{"x":738,"y":584,"w":128,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":128,"h":48},"sourceSize":{"w":128,"h":48}},"camera-action.png":{"frame":{"x":738,"y":648,"w":64,"h":64},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":64,"h":64},"sourceSize":{"w":64,"h":64}},"close-action.png":{"frame":{"x":8,"y":738,"w":64,"h":64},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":64,"h":64},"sourceSize":{"w":64,"h":64}},"deserialize-action.png":{"frame":{"x":88,"y":738,"w":64,"h":64},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":64,"h":64},"sourceSize":{"w":64,"h":64}},"drop-action.png":{"frame":{"x":168,"y":738,"w":64,"h":64},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":64,"h":64},"sourceSize":{"w":64,"h":64}},"focus-action.png":{"frame":{"x":248,"y":738,"w":64,"h":64},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":64,"h":64},"sourceSize":{"w":64,"h":64}},"inspect-action.png":{"frame":{"x":328,"y":738,"w":64,"h":64},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":64,"h":64},"sourceSize":{"w":64,"h":64}},"mute-action.png":{"frame":{"x":408,"y":738,"w":64,"h":64},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":64,"h":64},"sourceSize":{"w":64,"h":64}},"next.png":{"frame":{"x":488,"y":738,"w":64,"h":64},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":64,"h":64},"sourceSize":{"w":64,"h":64}},"pin-action.png":{"frame":{"x":568,"y":738,"w":64,"h":64},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":64,"h":64},"sourceSize":{"w":64,"h":64}},"prev.png":{"frame":{"x":648,"y":738,"w":64,"h":64},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":64,"h":64},"sourceSize":{"w":64,"h":64}},"recenter-action.png":{"frame":{"x":728,"y":738,"w":64,"h":64},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":64,"h":64},"sourceSize":{"w":64,"h":64}},"record-action-alpha.png":{"frame":{"x":882,"y":8,"w":64,"h":64},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":64,"h":64},"sourceSize":{"w":64,"h":64}},"record-action.png":{"frame":{"x":882,"y":88,"w":64,"h":64},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":64,"h":64},"sourceSize":{"w":64,"h":64}},"remove-action.png":{"frame":{"x":882,"y":168,"w":64,"h":64},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":64,"h":64},"sourceSize":{"w":64,"h":64}},"rotate-action.png":{"frame":{"x":882,"y":248,"w":64,"h":64},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":64,"h":64},"sourceSize":{"w":64,"h":64}},"scale-action.png":{"frame":{"x":882,"y":328,"w":64,"h":64},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":64,"h":64},"sourceSize":{"w":64,"h":64}},"serialize-action.png":{"frame":{"x":882,"y":408,"w":64,"h":64},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":64,"h":64},"sourceSize":{"w":64,"h":64}},"snap-page.png":{"frame":{"x":882,"y":488,"w":64,"h":64},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":64,"h":64},"sourceSize":{"w":64,"h":64}},"spawn_message.png":{"frame":{"x":882,"y":568,"w":64,"h":64},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":64,"h":64},"sourceSize":{"w":64,"h":64}},"spawn_message_dark-hover.png":{"frame":{"x":882,"y":648,"w":64,"h":64},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":64,"h":64},"sourceSize":{"w":64,"h":64}},"spawn_message_dark.png":{"frame":{"x":882,"y":728,"w":64,"h":64},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":64,"h":64},"sourceSize":{"w":64,"h":64}},"stop-action.png":{"frame":{"x":8,"y":818,"w":64,"h":64},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":64,"h":64},"sourceSize":{"w":64,"h":64}},"undo-action.png":{"frame":{"x":88,"y":818,"w":64,"h":64},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":64,"h":64},"sourceSize":{"w":64,"h":64}},"unmute-action.png":{"frame":{"x":168,"y":818,"w":64,"h":64},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":64,"h":64},"sourceSize":{"w":64,"h":64}}}}'),t$=JSON.parse('{"meta":{"image":"sprite-system-notice-spritesheet.png","size":{"w":2048,"h":2048},"scale":"1"},"frames":{"spawn-point.png":{"frame":{"x":8,"y":8,"w":512,"h":512},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":512,"h":512},"sourceSize":{"w":512,"h":512}},"volume_up-hover.png":{"frame":{"x":536,"y":8,"w":256,"h":256},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":256,"h":256},"sourceSize":{"w":256,"h":256}},"pause-hover.png":{"frame":{"x":536,"y":280,"w":192,"h":192},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":192,"h":192},"sourceSize":{"w":192,"h":192}},"pause.png":{"frame":{"x":8,"y":536,"w":192,"h":192},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":192,"h":192},"sourceSize":{"w":192,"h":192}},"play-hover.png":{"frame":{"x":216,"y":536,"w":192,"h":192},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":192,"h":192},"sourceSize":{"w":192,"h":192}},"play.png":{"frame":{"x":424,"y":536,"w":192,"h":192},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":192,"h":192},"sourceSize":{"w":192,"h":192}},"create_object-hover.png":{"frame":{"x":632,"y":536,"w":132,"h":132},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":132,"h":132},"sourceSize":{"w":132,"h":132}},"create_object.png":{"frame":{"x":808,"y":8,"w":132,"h":132},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":132,"h":132},"sourceSize":{"w":132,"h":132}},"freeze_off-hover.png":{"frame":{"x":808,"y":156,"w":132,"h":132},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":132,"h":132},"sourceSize":{"w":132,"h":132}},"freeze_off.png":{"frame":{"x":808,"y":304,"w":132,"h":132},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":132,"h":132},"sourceSize":{"w":132,"h":132}},"freeze_on-hover.png":{"frame":{"x":808,"y":452,"w":132,"h":132},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":132,"h":132},"sourceSize":{"w":132,"h":132}},"freeze_on.png":{"frame":{"x":8,"y":744,"w":132,"h":132},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":132,"h":132},"sourceSize":{"w":132,"h":132}},"mic-0.png":{"frame":{"x":808,"y":600,"w":128,"h":128},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":128,"h":128},"sourceSize":{"w":128,"h":128}},"mic-1.png":{"frame":{"x":300,"y":744,"w":128,"h":128},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":128,"h":128},"sourceSize":{"w":128,"h":128}},"mic-2.png":{"frame":{"x":588,"y":744,"w":128,"h":128},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":128,"h":128},"sourceSize":{"w":128,"h":128}},"mic-3.png":{"frame":{"x":956,"y":8,"w":128,"h":128},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":128,"h":128},"sourceSize":{"w":128,"h":128}},"mic-4.png":{"frame":{"x":956,"y":296,"w":128,"h":128},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":128,"h":128},"sourceSize":{"w":128,"h":128}},"mic-5.png":{"frame":{"x":956,"y":584,"w":128,"h":128},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":128,"h":128},"sourceSize":{"w":128,"h":128}},"mic-6.png":{"frame":{"x":8,"y":892,"w":128,"h":128},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":128,"h":128},"sourceSize":{"w":128,"h":128}},"mic-7.png":{"frame":{"x":296,"y":892,"w":128,"h":128},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":128,"h":128},"sourceSize":{"w":128,"h":128}},"mic-off-0.png":{"frame":{"x":584,"y":892,"w":128,"h":128},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":128,"h":128},"sourceSize":{"w":128,"h":128}},"mic-off-1.png":{"frame":{"x":872,"y":892,"w":128,"h":128},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":128,"h":128},"sourceSize":{"w":128,"h":128}},"mic-off-2.png":{"frame":{"x":1100,"y":152,"w":128,"h":128},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":128,"h":128},"sourceSize":{"w":128,"h":128}},"mic-off-3.png":{"frame":{"x":1100,"y":440,"w":128,"h":128},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":128,"h":128},"sourceSize":{"w":128,"h":128}},"mic-off-4.png":{"frame":{"x":1100,"y":728,"w":128,"h":128},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":128,"h":128},"sourceSize":{"w":128,"h":128}},"mic-off-5.png":{"frame":{"x":8,"y":1036,"w":128,"h":128},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":128,"h":128},"sourceSize":{"w":128,"h":128}},"mic-off-6.png":{"frame":{"x":296,"y":1036,"w":128,"h":128},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":128,"h":128},"sourceSize":{"w":128,"h":128}},"mic-off-7.png":{"frame":{"x":584,"y":1036,"w":128,"h":128},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":128,"h":128},"sourceSize":{"w":128,"h":128}},"Background.png":{"frame":{"x":872,"y":1036,"w":128,"h":48},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":128,"h":48},"sourceSize":{"w":128,"h":48}},"seek_back-hover.png":{"frame":{"x":1244,"y":8,"w":96,"h":96},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":96,"h":96},"sourceSize":{"w":96,"h":96}},"seek_back.png":{"frame":{"x":1244,"y":120,"w":96,"h":96},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":96,"h":96},"sourceSize":{"w":96,"h":96}},"seek_fwd-hover.png":{"frame":{"x":1244,"y":232,"w":96,"h":96},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":96,"h":96},"sourceSize":{"w":96,"h":96}},"seek_fwd.png":{"frame":{"x":1244,"y":344,"w":96,"h":96},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":96,"h":96},"sourceSize":{"w":96,"h":96}},"snap-hover.png":{"frame":{"x":1244,"y":456,"w":96,"h":96},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":96,"h":96},"sourceSize":{"w":96,"h":96}},"snap.png":{"frame":{"x":1244,"y":568,"w":96,"h":96},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":96,"h":96},"sourceSize":{"w":96,"h":96}},"volume_down-hover.png":{"frame":{"x":1244,"y":680,"w":96,"h":96},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":96,"h":96},"sourceSize":{"w":96,"h":96}},"volume_down.png":{"frame":{"x":1244,"y":792,"w":96,"h":96},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":96,"h":96},"sourceSize":{"w":96,"h":96}},"volume_up.png":{"frame":{"x":1244,"y":904,"w":96,"h":96},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":96,"h":96},"sourceSize":{"w":96,"h":96}},"camera_off-disabled.png":{"frame":{"x":1244,"y":1016,"w":68,"h":68},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":68,"h":68},"sourceSize":{"w":68,"h":68}},"camera_off-hover.png":{"frame":{"x":1016,"y":892,"w":68,"h":68},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":68,"h":68},"sourceSize":{"w":68,"h":68}},"camera_off.png":{"frame":{"x":8,"y":1180,"w":68,"h":68},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":68,"h":68},"sourceSize":{"w":68,"h":68}},"camera_on-hover.png":{"frame":{"x":92,"y":1180,"w":68,"h":68},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":68,"h":68},"sourceSize":{"w":68,"h":68}},"camera_on.png":{"frame":{"x":176,"y":1180,"w":68,"h":68},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":68,"h":68},"sourceSize":{"w":68,"h":68}},"mute_off-hover.png":{"frame":{"x":260,"y":1180,"w":68,"h":68},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":68,"h":68},"sourceSize":{"w":68,"h":68}},"mute_off.png":{"frame":{"x":344,"y":1180,"w":68,"h":68},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":68,"h":68},"sourceSize":{"w":68,"h":68}},"pen_off-disabled.png":{"frame":{"x":428,"y":1180,"w":68,"h":68},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":68,"h":68},"sourceSize":{"w":68,"h":68}},"pen_off-hover.png":{"frame":{"x":512,"y":1180,"w":68,"h":68},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":68,"h":68},"sourceSize":{"w":68,"h":68}},"pen_off.png":{"frame":{"x":596,"y":1180,"w":68,"h":68},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":68,"h":68},"sourceSize":{"w":68,"h":68}},"pen_on-hover.png":{"frame":{"x":680,"y":1180,"w":68,"h":68},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":68,"h":68},"sourceSize":{"w":68,"h":68}},"pen_on.png":{"frame":{"x":764,"y":1180,"w":68,"h":68},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":68,"h":68},"sourceSize":{"w":68,"h":68}},"share_camera_off-hover.png":{"frame":{"x":848,"y":1180,"w":68,"h":68},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":68,"h":68},"sourceSize":{"w":68,"h":68}},"share_camera_off.png":{"frame":{"x":932,"y":1180,"w":68,"h":68},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":68,"h":68},"sourceSize":{"w":68,"h":68}},"share_camera_on-hover.png":{"frame":{"x":1016,"y":1180,"w":68,"h":68},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":68,"h":68},"sourceSize":{"w":68,"h":68}},"share_camera_on.png":{"frame":{"x":1100,"y":1180,"w":68,"h":68},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":68,"h":68},"sourceSize":{"w":68,"h":68}},"share_screen_off.png":{"frame":{"x":1184,"y":1180,"w":68,"h":68},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":68,"h":68},"sourceSize":{"w":68,"h":68}},"share_screen_on-hover.png":{"frame":{"x":1268,"y":1180,"w":68,"h":68},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":68,"h":68},"sourceSize":{"w":68,"h":68}},"share_screen_on.png":{"frame":{"x":8,"y":1264,"w":68,"h":68},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":68,"h":68},"sourceSize":{"w":68,"h":68}},"share_window_off-hover.png":{"frame":{"x":92,"y":1264,"w":68,"h":68},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":68,"h":68},"sourceSize":{"w":68,"h":68}},"share_window_off.png":{"frame":{"x":176,"y":1264,"w":68,"h":68},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":68,"h":68},"sourceSize":{"w":68,"h":68}},"share_window_on-hover.png":{"frame":{"x":260,"y":1264,"w":68,"h":68},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":68,"h":68},"sourceSize":{"w":68,"h":68}},"share_window_on.png":{"frame":{"x":344,"y":1264,"w":68,"h":68},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":68,"h":68},"sourceSize":{"w":68,"h":68}},"mute_on-hover.png":{"frame":{"x":1244,"y":1100,"w":66,"h":64},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":66,"h":64},"sourceSize":{"w":66,"h":64}},"close-white.png":{"frame":{"x":876,"y":744,"w":64,"h":64},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":64,"h":64},"sourceSize":{"w":64,"h":64}},"mute_on.png":{"frame":{"x":872,"y":1100,"w":64,"h":64},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":64,"h":64},"sourceSize":{"w":64,"h":64}},"rotate-cursor.png":{"frame":{"x":952,"y":1100,"w":64,"h":64},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":64,"h":64},"sourceSize":{"w":64,"h":64}},"snap_camera.png":{"frame":{"x":1032,"y":1100,"w":64,"h":64},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":64,"h":64},"sourceSize":{"w":64,"h":64}},"mic-0_hover.png":{"frame":{"x":156,"y":744,"w":128,"h":128},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":128,"h":128},"sourceSize":{"w":128,"h":128}},"mic-1_hover.png":{"frame":{"x":444,"y":744,"w":128,"h":128},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":128,"h":128},"sourceSize":{"w":128,"h":128}},"mic-2_hover.png":{"frame":{"x":732,"y":744,"w":128,"h":128},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":128,"h":128},"sourceSize":{"w":128,"h":128}},"mic-3_hover.png":{"frame":{"x":956,"y":152,"w":128,"h":128},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":128,"h":128},"sourceSize":{"w":128,"h":128}},"mic-4_hover.png":{"frame":{"x":956,"y":440,"w":128,"h":128},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":128,"h":128},"sourceSize":{"w":128,"h":128}},"mic-5_hover.png":{"frame":{"x":956,"y":728,"w":128,"h":128},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":128,"h":128},"sourceSize":{"w":128,"h":128}},"mic-6_hover.png":{"frame":{"x":152,"y":892,"w":128,"h":128},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":128,"h":128},"sourceSize":{"w":128,"h":128}},"mic-7_hover.png":{"frame":{"x":440,"y":892,"w":128,"h":128},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":128,"h":128},"sourceSize":{"w":128,"h":128}},"mic-off-0_hover.png":{"frame":{"x":728,"y":892,"w":128,"h":128},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":128,"h":128},"sourceSize":{"w":128,"h":128}},"mic-off-1_hover.png":{"frame":{"x":1100,"y":8,"w":128,"h":128},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":128,"h":128},"sourceSize":{"w":128,"h":128}},"mic-off-2_hover.png":{"frame":{"x":1100,"y":296,"w":128,"h":128},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":128,"h":128},"sourceSize":{"w":128,"h":128}},"mic-off-3_hover.png":{"frame":{"x":1100,"y":584,"w":128,"h":128},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":128,"h":128},"sourceSize":{"w":128,"h":128}},"mic-off-4_hover.png":{"frame":{"x":1100,"y":872,"w":128,"h":128},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":128,"h":128},"sourceSize":{"w":128,"h":128}},"mic-off-5_hover.png":{"frame":{"x":152,"y":1036,"w":128,"h":128},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":128,"h":128},"sourceSize":{"w":128,"h":128}},"mic-off-6_hover.png":{"frame":{"x":440,"y":1036,"w":128,"h":128},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":128,"h":128},"sourceSize":{"w":128,"h":128}},"mic-off-7_hover.png":{"frame":{"x":728,"y":1036,"w":128,"h":128},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":128,"h":128},"sourceSize":{"w":128,"h":128}}}}'),n$=n.p+"assets/images/spritesheets/sprite-system-action-spritesheet-28e4f44a36e036ae429b..png",i$=n.p+"assets/images/spritesheets/sprite-system-notice-spritesheet-c8d9fe08c2fd732b9c2c..png";function r$(e,t,n,i,r,o,s){try{var a=e[o](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(i,r)}const o$=sa(new function(){return la()('!function(){var r={168:function(r,n,t){var e=t(874),a={};for(var o in e)e.hasOwnProperty(o)&&(a[e[o]]=o);var l=r.exports={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};for(var i in l)if(l.hasOwnProperty(i)){if(!("channels"in l[i]))throw new Error("missing channels property: "+i);if(!("labels"in l[i]))throw new Error("missing channel labels property: "+i);if(l[i].labels.length!==l[i].channels)throw new Error("channel and label counts mismatch: "+i);var s=l[i].channels,h=l[i].labels;delete l[i].channels,delete l[i].labels,Object.defineProperty(l[i],"channels",{value:s}),Object.defineProperty(l[i],"labels",{value:h})}l.rgb.hsl=function(r){var n,t,e=r[0]/255,a=r[1]/255,o=r[2]/255,l=Math.min(e,a,o),i=Math.max(e,a,o),s=i-l;return i===l?n=0:e===i?n=(a-o)/s:a===i?n=2+(o-e)/s:o===i&&(n=4+(e-a)/s),(n=Math.min(60*n,360))<0&&(n+=360),t=(l+i)/2,[n,100*(i===l?0:t<=.5?s/(i+l):s/(2-i-l)),100*t]},l.rgb.hsv=function(r){var n,t,e,a,o,l=r[0]/255,i=r[1]/255,s=r[2]/255,h=Math.max(l,i,s),u=h-Math.min(l,i,s),c=function(r){return(h-r)/6/u+.5};return 0===u?a=o=0:(o=u/h,n=c(l),t=c(i),e=c(s),l===h?a=e-t:i===h?a=1/3+n-e:s===h&&(a=2/3+t-n),a<0?a+=1:a>1&&(a-=1)),[360*a,100*o,100*h]},l.rgb.hwb=function(r){var n=r[0],t=r[1],e=r[2];return[l.rgb.hsl(r)[0],1/255*Math.min(n,Math.min(t,e))*100,100*(e=1-1/255*Math.max(n,Math.max(t,e)))]},l.rgb.cmyk=function(r){var n,t=r[0]/255,e=r[1]/255,a=r[2]/255;return[100*((1-t-(n=Math.min(1-t,1-e,1-a)))/(1-n)||0),100*((1-e-n)/(1-n)||0),100*((1-a-n)/(1-n)||0),100*n]},l.rgb.keyword=function(r){var n=a[r];if(n)return n;var t,o,l,i=1/0;for(var s in e)if(e.hasOwnProperty(s)){var h=(o=r,l=e[s],Math.pow(o[0]-l[0],2)+Math.pow(o[1]-l[1],2)+Math.pow(o[2]-l[2],2));h<i&&(i=h,t=s)}return t},l.keyword.rgb=function(r){return e[r]},l.rgb.xyz=function(r){var n=r[0]/255,t=r[1]/255,e=r[2]/255;return[100*(.4124*(n=n>.04045?Math.pow((n+.055)/1.055,2.4):n/12.92)+.3576*(t=t>.04045?Math.pow((t+.055)/1.055,2.4):t/12.92)+.1805*(e=e>.04045?Math.pow((e+.055)/1.055,2.4):e/12.92)),100*(.2126*n+.7152*t+.0722*e),100*(.0193*n+.1192*t+.9505*e)]},l.rgb.lab=function(r){var n=l.rgb.xyz(r),t=n[0],e=n[1],a=n[2];return e/=100,a/=108.883,t=(t/=95.047)>.008856?Math.pow(t,1/3):7.787*t+16/116,[116*(e=e>.008856?Math.pow(e,1/3):7.787*e+16/116)-16,500*(t-e),200*(e-(a=a>.008856?Math.pow(a,1/3):7.787*a+16/116))]},l.hsl.rgb=function(r){var n,t,e,a,o,l=r[0]/360,i=r[1]/100,s=r[2]/100;if(0===i)return[o=255*s,o,o];n=2*s-(t=s<.5?s*(1+i):s+i-s*i),a=[0,0,0];for(var h=0;h<3;h++)(e=l+1/3*-(h-1))<0&&e++,e>1&&e--,o=6*e<1?n+6*(t-n)*e:2*e<1?t:3*e<2?n+(t-n)*(2/3-e)*6:n,a[h]=255*o;return a},l.hsl.hsv=function(r){var n=r[0],t=r[1]/100,e=r[2]/100,a=t,o=Math.max(e,.01);return t*=(e*=2)<=1?e:2-e,a*=o<=1?o:2-o,[n,100*(0===e?2*a/(o+a):2*t/(e+t)),(e+t)/2*100]},l.hsv.rgb=function(r){var n=r[0]/60,t=r[1]/100,e=r[2]/100,a=Math.floor(n)%6,o=n-Math.floor(n),l=255*e*(1-t),i=255*e*(1-t*o),s=255*e*(1-t*(1-o));switch(e*=255,a){case 0:return[e,s,l];case 1:return[i,e,l];case 2:return[l,e,s];case 3:return[l,i,e];case 4:return[s,l,e];case 5:return[e,l,i]}},l.hsv.hsl=function(r){var n,t,e,a=r[0],o=r[1]/100,l=r[2]/100,i=Math.max(l,.01);return e=(2-o)*l,t=o*i,[a,100*(t=(t/=(n=(2-o)*i)<=1?n:2-n)||0),100*(e/=2)]},l.hwb.rgb=function(r){var n,t,e,a,o,l,i,s=r[0]/360,h=r[1]/100,u=r[2]/100,c=h+u;switch(c>1&&(h/=c,u/=c),e=6*s-(n=Math.floor(6*s)),0!=(1&n)&&(e=1-e),a=h+e*((t=1-u)-h),n){default:case 6:case 0:o=t,l=a,i=h;break;case 1:o=a,l=t,i=h;break;case 2:o=h,l=t,i=a;break;case 3:o=h,l=a,i=t;break;case 4:o=a,l=h,i=t;break;case 5:o=t,l=h,i=a}return[255*o,255*l,255*i]},l.cmyk.rgb=function(r){var n=r[0]/100,t=r[1]/100,e=r[2]/100,a=r[3]/100;return[255*(1-Math.min(1,n*(1-a)+a)),255*(1-Math.min(1,t*(1-a)+a)),255*(1-Math.min(1,e*(1-a)+a))]},l.xyz.rgb=function(r){var n,t,e,a=r[0]/100,o=r[1]/100,l=r[2]/100;return t=-.9689*a+1.8758*o+.0415*l,e=.0557*a+-.204*o+1.057*l,n=(n=3.2406*a+-1.5372*o+-.4986*l)>.0031308?1.055*Math.pow(n,1/2.4)-.055:12.92*n,t=t>.0031308?1.055*Math.pow(t,1/2.4)-.055:12.92*t,e=e>.0031308?1.055*Math.pow(e,1/2.4)-.055:12.92*e,[255*(n=Math.min(Math.max(0,n),1)),255*(t=Math.min(Math.max(0,t),1)),255*(e=Math.min(Math.max(0,e),1))]},l.xyz.lab=function(r){var n=r[0],t=r[1],e=r[2];return t/=100,e/=108.883,n=(n/=95.047)>.008856?Math.pow(n,1/3):7.787*n+16/116,[116*(t=t>.008856?Math.pow(t,1/3):7.787*t+16/116)-16,500*(n-t),200*(t-(e=e>.008856?Math.pow(e,1/3):7.787*e+16/116))]},l.lab.xyz=function(r){var n,t,e,a=r[0];n=r[1]/500+(t=(a+16)/116),e=t-r[2]/200;var o=Math.pow(t,3),l=Math.pow(n,3),i=Math.pow(e,3);return t=o>.008856?o:(t-16/116)/7.787,n=l>.008856?l:(n-16/116)/7.787,e=i>.008856?i:(e-16/116)/7.787,[n*=95.047,t*=100,e*=108.883]},l.lab.lch=function(r){var n,t=r[0],e=r[1],a=r[2];return(n=360*Math.atan2(a,e)/2/Math.PI)<0&&(n+=360),[t,Math.sqrt(e*e+a*a),n]},l.lch.lab=function(r){var n,t=r[0],e=r[1];return n=r[2]/360*2*Math.PI,[t,e*Math.cos(n),e*Math.sin(n)]},l.rgb.ansi16=function(r){var n=r[0],t=r[1],e=r[2],a=1 in arguments?arguments[1]:l.rgb.hsv(r)[2];if(0===(a=Math.round(a/50)))return 30;var o=30+(Math.round(e/255)<<2|Math.round(t/255)<<1|Math.round(n/255));return 2===a&&(o+=60),o},l.hsv.ansi16=function(r){return l.rgb.ansi16(l.hsv.rgb(r),r[2])},l.rgb.ansi256=function(r){var n=r[0],t=r[1],e=r[2];return n===t&&t===e?n<8?16:n>248?231:Math.round((n-8)/247*24)+232:16+36*Math.round(n/255*5)+6*Math.round(t/255*5)+Math.round(e/255*5)},l.ansi16.rgb=function(r){var n=r%10;if(0===n||7===n)return r>50&&(n+=3.5),[n=n/10.5*255,n,n];var t=.5*(1+~~(r>50));return[(1&n)*t*255,(n>>1&1)*t*255,(n>>2&1)*t*255]},l.ansi256.rgb=function(r){if(r>=232){var n=10*(r-232)+8;return[n,n,n]}var t;return r-=16,[Math.floor(r/36)/5*255,Math.floor((t=r%36)/6)/5*255,t%6/5*255]},l.rgb.hex=function(r){var n=(((255&Math.round(r[0]))<<16)+((255&Math.round(r[1]))<<8)+(255&Math.round(r[2]))).toString(16).toUpperCase();return"000000".substring(n.length)+n},l.hex.rgb=function(r){var n=r.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!n)return[0,0,0];var t=n[0];3===n[0].length&&(t=t.split("").map((function(r){return r+r})).join(""));var e=parseInt(t,16);return[e>>16&255,e>>8&255,255&e]},l.rgb.hcg=function(r){var n,t=r[0]/255,e=r[1]/255,a=r[2]/255,o=Math.max(Math.max(t,e),a),l=Math.min(Math.min(t,e),a),i=o-l;return n=i<=0?0:o===t?(e-a)/i%6:o===e?2+(a-t)/i:4+(t-e)/i+4,n/=6,[360*(n%=1),100*i,100*(i<1?l/(1-i):0)]},l.hsl.hcg=function(r){var n,t=r[1]/100,e=r[2]/100,a=0;return(n=e<.5?2*t*e:2*t*(1-e))<1&&(a=(e-.5*n)/(1-n)),[r[0],100*n,100*a]},l.hsv.hcg=function(r){var n=r[1]/100,t=r[2]/100,e=n*t,a=0;return e<1&&(a=(t-e)/(1-e)),[r[0],100*e,100*a]},l.hcg.rgb=function(r){var n=r[0]/360,t=r[1]/100,e=r[2]/100;if(0===t)return[255*e,255*e,255*e];var a,o=[0,0,0],l=n%1*6,i=l%1,s=1-i;switch(Math.floor(l)){case 0:o[0]=1,o[1]=i,o[2]=0;break;case 1:o[0]=s,o[1]=1,o[2]=0;break;case 2:o[0]=0,o[1]=1,o[2]=i;break;case 3:o[0]=0,o[1]=s,o[2]=1;break;case 4:o[0]=i,o[1]=0,o[2]=1;break;default:o[0]=1,o[1]=0,o[2]=s}return a=(1-t)*e,[255*(t*o[0]+a),255*(t*o[1]+a),255*(t*o[2]+a)]},l.hcg.hsv=function(r){var n=r[1]/100,t=n+r[2]/100*(1-n),e=0;return t>0&&(e=n/t),[r[0],100*e,100*t]},l.hcg.hsl=function(r){var n=r[1]/100,t=r[2]/100*(1-n)+.5*n,e=0;return t>0&&t<.5?e=n/(2*t):t>=.5&&t<1&&(e=n/(2*(1-t))),[r[0],100*e,100*t]},l.hcg.hwb=function(r){var n=r[1]/100,t=n+r[2]/100*(1-n);return[r[0],100*(t-n),100*(1-t)]},l.hwb.hcg=function(r){var n=r[1]/100,t=1-r[2]/100,e=t-n,a=0;return e<1&&(a=(t-e)/(1-e)),[r[0],100*e,100*a]},l.apple.rgb=function(r){return[r[0]/65535*255,r[1]/65535*255,r[2]/65535*255]},l.rgb.apple=function(r){return[r[0]/255*65535,r[1]/255*65535,r[2]/255*65535]},l.gray.rgb=function(r){return[r[0]/100*255,r[0]/100*255,r[0]/100*255]},l.gray.hsl=l.gray.hsv=function(r){return[0,0,r[0]]},l.gray.hwb=function(r){return[0,100,r[0]]},l.gray.cmyk=function(r){return[0,0,0,r[0]]},l.gray.lab=function(r){return[r[0],0,0]},l.gray.hex=function(r){var n=255&Math.round(r[0]/100*255),t=((n<<16)+(n<<8)+n).toString(16).toUpperCase();return"000000".substring(t.length)+t},l.rgb.gray=function(r){return[(r[0]+r[1]+r[2])/3/255*100]}},85:function(r,n,t){var e=t(168),a=t(111),o={};Object.keys(e).forEach((function(r){o[r]={},Object.defineProperty(o[r],"channels",{value:e[r].channels}),Object.defineProperty(o[r],"labels",{value:e[r].labels});var n=a(r);Object.keys(n).forEach((function(t){var e=n[t];o[r][t]=function(r){var n=function(n){if(null==n)return n;arguments.length>1&&(n=Array.prototype.slice.call(arguments));var t=r(n);if("object"==typeof t)for(var e=t.length,a=0;a<e;a++)t[a]=Math.round(t[a]);return t};return"conversion"in r&&(n.conversion=r.conversion),n}(e),o[r][t].raw=function(r){var n=function(n){return null==n?n:(arguments.length>1&&(n=Array.prototype.slice.call(arguments)),r(n))};return"conversion"in r&&(n.conversion=r.conversion),n}(e)}))})),r.exports=o},111:function(r,n,t){var e=t(168);function a(r,n){return function(t){return n(r(t))}}function o(r,n){for(var t=[n[r].parent,r],o=e[n[r].parent][r],l=n[r].parent;n[l].parent;)t.unshift(n[l].parent),o=a(e[n[l].parent][l],o),l=n[l].parent;return o.conversion=t,o}r.exports=function(r){for(var n=function(r){var n=function(){for(var r={},n=Object.keys(e),t=n.length,a=0;a<t;a++)r[n[a]]={distance:-1,parent:null};return r}(),t=[r];for(n[r].distance=0;t.length;)for(var a=t.pop(),o=Object.keys(e[a]),l=o.length,i=0;i<l;i++){var s=o[i],h=n[s];-1===h.distance&&(h.distance=n[a].distance+1,h.parent=a,t.unshift(s))}return n}(r),t={},a=Object.keys(n),l=a.length,i=0;i<l;i++){var s=a[i];null!==n[s].parent&&(t[s]=o(s,n))}return t}},874:function(r){"use strict";r.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},818:function(r,n,t){var e=t(874),a=t(851),o=Object.hasOwnProperty,l=Object.create(null);for(var i in e)o.call(e,i)&&(l[e[i]]=i);var s=r.exports={to:{},get:{}};function h(r,n,t){return Math.min(Math.max(n,r),t)}function u(r){var n=Math.round(r).toString(16).toUpperCase();return n.length<2?"0"+n:n}s.get=function(r){var n,t;switch(r.substring(0,3).toLowerCase()){case"hsl":n=s.get.hsl(r),t="hsl";break;case"hwb":n=s.get.hwb(r),t="hwb";break;default:n=s.get.rgb(r),t="rgb"}return n?{model:t,value:n}:null},s.get.rgb=function(r){if(!r)return null;var n,t,a,l=[0,0,0,1];if(n=r.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(a=n[2],n=n[1],t=0;t<3;t++){var i=2*t;l[t]=parseInt(n.slice(i,i+2),16)}a&&(l[3]=parseInt(a,16)/255)}else if(n=r.match(/^#([a-f0-9]{3,4})$/i)){for(a=(n=n[1])[3],t=0;t<3;t++)l[t]=parseInt(n[t]+n[t],16);a&&(l[3]=parseInt(a+a,16)/255)}else if(n=r.match(/^rgba?\\(\\s*([+-]?\\d+)(?=[\\s,])\\s*(?:,\\s*)?([+-]?\\d+)(?=[\\s,])\\s*(?:,\\s*)?([+-]?\\d+)\\s*(?:[,|\\/]\\s*([+-]?[\\d\\.]+)(%?)\\s*)?\\)$/)){for(t=0;t<3;t++)l[t]=parseInt(n[t+1],0);n[4]&&(n[5]?l[3]=.01*parseFloat(n[4]):l[3]=parseFloat(n[4]))}else{if(!(n=r.match(/^rgba?\\(\\s*([+-]?[\\d\\.]+)\\%\\s*,?\\s*([+-]?[\\d\\.]+)\\%\\s*,?\\s*([+-]?[\\d\\.]+)\\%\\s*(?:[,|\\/]\\s*([+-]?[\\d\\.]+)(%?)\\s*)?\\)$/)))return(n=r.match(/^(\\w+)$/))?"transparent"===n[1]?[0,0,0,0]:o.call(e,n[1])?((l=e[n[1]])[3]=1,l):null:null;for(t=0;t<3;t++)l[t]=Math.round(2.55*parseFloat(n[t+1]));n[4]&&(n[5]?l[3]=.01*parseFloat(n[4]):l[3]=parseFloat(n[4]))}for(t=0;t<3;t++)l[t]=h(l[t],0,255);return l[3]=h(l[3],0,1),l},s.get.hsl=function(r){if(!r)return null;var n=r.match(/^hsla?\\(\\s*([+-]?(?:\\d{0,3}\\.)?\\d+)(?:deg)?\\s*,?\\s*([+-]?[\\d\\.]+)%\\s*,?\\s*([+-]?[\\d\\.]+)%\\s*(?:[,|\\/]\\s*([+-]?(?=\\.\\d|\\d)(?:0|[1-9]\\d*)?(?:\\.\\d*)?(?:[eE][+-]?\\d+)?)\\s*)?\\)$/);if(n){var t=parseFloat(n[4]);return[(parseFloat(n[1])%360+360)%360,h(parseFloat(n[2]),0,100),h(parseFloat(n[3]),0,100),h(isNaN(t)?1:t,0,1)]}return null},s.get.hwb=function(r){if(!r)return null;var n=r.match(/^hwb\\(\\s*([+-]?\\d{0,3}(?:\\.\\d+)?)(?:deg)?\\s*,\\s*([+-]?[\\d\\.]+)%\\s*,\\s*([+-]?[\\d\\.]+)%\\s*(?:,\\s*([+-]?(?=\\.\\d|\\d)(?:0|[1-9]\\d*)?(?:\\.\\d*)?(?:[eE][+-]?\\d+)?)\\s*)?\\)$/);if(n){var t=parseFloat(n[4]);return[(parseFloat(n[1])%360+360)%360,h(parseFloat(n[2]),0,100),h(parseFloat(n[3]),0,100),h(isNaN(t)?1:t,0,1)]}return null},s.to.hex=function(){var r=a(arguments);return"#"+u(r[0])+u(r[1])+u(r[2])+(r[3]<1?u(Math.round(255*r[3])):"")},s.to.rgb=function(){var r=a(arguments);return r.length<4||1===r[3]?"rgb("+Math.round(r[0])+", "+Math.round(r[1])+", "+Math.round(r[2])+")":"rgba("+Math.round(r[0])+", "+Math.round(r[1])+", "+Math.round(r[2])+", "+r[3]+")"},s.to.rgb.percent=function(){var r=a(arguments),n=Math.round(r[0]/255*100),t=Math.round(r[1]/255*100),e=Math.round(r[2]/255*100);return r.length<4||1===r[3]?"rgb("+n+"%, "+t+"%, "+e+"%)":"rgba("+n+"%, "+t+"%, "+e+"%, "+r[3]+")"},s.to.hsl=function(){var r=a(arguments);return r.length<4||1===r[3]?"hsl("+r[0]+", "+r[1]+"%, "+r[2]+"%)":"hsla("+r[0]+", "+r[1]+"%, "+r[2]+"%, "+r[3]+")"},s.to.hwb=function(){var r=a(arguments),n="";return r.length>=4&&1!==r[3]&&(n=", "+r[3]),"hwb("+r[0]+", "+r[1]+"%, "+r[2]+"%"+n+")"},s.to.keyword=function(r){return l[r.slice(0,3)]}},767:function(r,n,t){"use strict";var e=t(818),a=t(85),o=[].slice,l=["keyword","gray","hex"],i={};Object.keys(a).forEach((function(r){i[o.call(a[r].labels).sort().join("")]=r}));var s={};function h(r,n){if(!(this instanceof h))return new h(r,n);if(n&&n in l&&(n=null),n&&!(n in a))throw new Error("Unknown model: "+n);var t,u;if(null==r)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(r instanceof h)this.model=r.model,this.color=r.color.slice(),this.valpha=r.valpha;else if("string"==typeof r){var c=e.get(r);if(null===c)throw new Error("Unable to parse color from string: "+r);this.model=c.model,u=a[this.model].channels,this.color=c.value.slice(0,u),this.valpha="number"==typeof c.value[u]?c.value[u]:1}else if(r.length){this.model=n||"rgb",u=a[this.model].channels;var g=o.call(r,0,u);this.color=f(g,u),this.valpha="number"==typeof r[u]?r[u]:1}else if("number"==typeof r)r&=16777215,this.model="rgb",this.color=[r>>16&255,r>>8&255,255&r],this.valpha=1;else{this.valpha=1;var b=Object.keys(r);"alpha"in r&&(b.splice(b.indexOf("alpha"),1),this.valpha="number"==typeof r.alpha?r.alpha:0);var p=b.sort().join("");if(!(p in i))throw new Error("Unable to parse color from object: "+JSON.stringify(r));this.model=i[p];var v=a[this.model].labels,d=[];for(t=0;t<v.length;t++)d.push(r[v[t]]);this.color=f(d)}if(s[this.model])for(u=a[this.model].channels,t=0;t<u;t++){var m=s[this.model][t];m&&(this.color[t]=m(this.color[t]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}function u(r,n,t){return(r=Array.isArray(r)?r:[r]).forEach((function(r){(s[r]||(s[r]=[]))[n]=t})),r=r[0],function(e){var a;return arguments.length?(t&&(e=t(e)),(a=this[r]()).color[n]=e,a):(a=this[r]().color[n],t&&(a=t(a)),a)}}function c(r){return function(n){return Math.max(0,Math.min(r,n))}}function f(r,n){for(var t=0;t<n;t++)"number"!=typeof r[t]&&(r[t]=0);return r}h.prototype={toString:function(){return this.string()},toJSON:function(){return this[this.model]()},string:function(r){var n=this.model in e.to?this:this.rgb(),t=1===(n=n.round("number"==typeof r?r:1)).valpha?n.color:n.color.concat(this.valpha);return e.to[n.model](t)},percentString:function(r){var n=this.rgb().round("number"==typeof r?r:1),t=1===n.valpha?n.color:n.color.concat(this.valpha);return e.to.rgb.percent(t)},array:function(){return 1===this.valpha?this.color.slice():this.color.concat(this.valpha)},object:function(){for(var r={},n=a[this.model].channels,t=a[this.model].labels,e=0;e<n;e++)r[t[e]]=this.color[e];return 1!==this.valpha&&(r.alpha=this.valpha),r},unitArray:function(){var r=this.rgb().color;return r[0]/=255,r[1]/=255,r[2]/=255,1!==this.valpha&&r.push(this.valpha),r},unitObject:function(){var r=this.rgb().object();return r.r/=255,r.g/=255,r.b/=255,1!==this.valpha&&(r.alpha=this.valpha),r},round:function(r){return r=Math.max(r||0,0),new h(this.color.map(function(r){return function(n){return function(r,n){return Number(r.toFixed(n))}(n,r)}}(r)).concat(this.valpha),this.model)},alpha:function(r){return arguments.length?new h(this.color.concat(Math.max(0,Math.min(1,r))),this.model):this.valpha},red:u("rgb",0,c(255)),green:u("rgb",1,c(255)),blue:u("rgb",2,c(255)),hue:u(["hsl","hsv","hsl","hwb","hcg"],0,(function(r){return(r%360+360)%360})),saturationl:u("hsl",1,c(100)),lightness:u("hsl",2,c(100)),saturationv:u("hsv",1,c(100)),value:u("hsv",2,c(100)),chroma:u("hcg",1,c(100)),gray:u("hcg",2,c(100)),white:u("hwb",1,c(100)),wblack:u("hwb",2,c(100)),cyan:u("cmyk",0,c(100)),magenta:u("cmyk",1,c(100)),yellow:u("cmyk",2,c(100)),black:u("cmyk",3,c(100)),x:u("xyz",0,c(100)),y:u("xyz",1,c(100)),z:u("xyz",2,c(100)),l:u("lab",0,c(100)),a:u("lab",1),b:u("lab",2),keyword:function(r){return arguments.length?new h(r):a[this.model].keyword(this.color)},hex:function(r){return arguments.length?new h(r):e.to.hex(this.rgb().round().color)},rgbNumber:function(){var r=this.rgb().color;return(255&r[0])<<16|(255&r[1])<<8|255&r[2]},luminosity:function(){for(var r=this.rgb().color,n=[],t=0;t<r.length;t++){var e=r[t]/255;n[t]=e<=.03928?e/12.92:Math.pow((e+.055)/1.055,2.4)}return.2126*n[0]+.7152*n[1]+.0722*n[2]},contrast:function(r){var n=this.luminosity(),t=r.luminosity();return n>t?(n+.05)/(t+.05):(t+.05)/(n+.05)},level:function(r){var n=this.contrast(r);return n>=7.1?"AAA":n>=4.5?"AA":""},isDark:function(){var r=this.rgb().color;return(299*r[0]+587*r[1]+114*r[2])/1e3<128},isLight:function(){return!this.isDark()},negate:function(){for(var r=this.rgb(),n=0;n<3;n++)r.color[n]=255-r.color[n];return r},lighten:function(r){var n=this.hsl();return n.color[2]+=n.color[2]*r,n},darken:function(r){var n=this.hsl();return n.color[2]-=n.color[2]*r,n},saturate:function(r){var n=this.hsl();return n.color[1]+=n.color[1]*r,n},desaturate:function(r){var n=this.hsl();return n.color[1]-=n.color[1]*r,n},whiten:function(r){var n=this.hwb();return n.color[1]+=n.color[1]*r,n},blacken:function(r){var n=this.hwb();return n.color[2]+=n.color[2]*r,n},grayscale:function(){var r=this.rgb().color,n=.3*r[0]+.59*r[1]+.11*r[2];return h.rgb(n,n,n)},fade:function(r){return this.alpha(this.valpha-this.valpha*r)},opaquer:function(r){return this.alpha(this.valpha+this.valpha*r)},rotate:function(r){var n=this.hsl(),t=n.color[0];return t=(t=(t+r)%360)<0?360+t:t,n.color[0]=t,n},mix:function(r,n){if(!r||!r.rgb)throw new Error(\'Argument to "mix" was not a Color instance, but rather an instance of \'+typeof r);var t=r.rgb(),e=this.rgb(),a=void 0===n?.5:n,o=2*a-1,l=t.alpha()-e.alpha(),i=((o*l==-1?o:(o+l)/(1+o*l))+1)/2,s=1-i;return h.rgb(i*t.red()+s*e.red(),i*t.green()+s*e.green(),i*t.blue()+s*e.blue(),t.alpha()*a+e.alpha()*(1-a))}},Object.keys(a).forEach((function(r){if(-1===l.indexOf(r)){var n=a[r].channels;h.prototype[r]=function(){if(this.model===r)return new h(this);if(arguments.length)return new h(arguments,r);var t,e="number"==typeof arguments[n]?n:this.valpha;return new h((t=a[this.model][r].raw(this.color),Array.isArray(t)?t:[t]).concat(e),r)},h[r]=function(t){return"number"==typeof t&&(t=f(o.call(arguments),n)),new h(t,r)}}})),r.exports=h},851:function(r,n,t){"use strict";var e=t(594),a=Array.prototype.concat,o=Array.prototype.slice,l=r.exports=function(r){for(var n=[],t=0,l=r.length;t<l;t++){var i=r[t];e(i)?n=a.call(n,o.call(i)):n.push(i)}return n};l.wrap=function(r){return function(){return r(l(arguments))}}},594:function(r){r.exports=function(r){return!(!r||"string"==typeof r)&&(r instanceof Array||Array.isArray(r)||r.length>=0&&(r.splice instanceof Function||Object.getOwnPropertyDescriptor(r,r.length-1)&&"String"!==r.constructor.name))}}},n={};function t(e){var a=n[e];if(void 0!==a)return a.exports;var o=n[e]={exports:{}};return r[e](o,o.exports,t),o.exports}t.n=function(r){var n=r&&r.__esModule?function(){return r.default}:function(){return r};return t.d(n,{a:n}),n},t.d=function(r,n){for(var e in n)t.o(n,e)&&!t.o(r,e)&&Object.defineProperty(r,e,{enumerable:!0,get:n[e]})},t.o=function(r,n){return Object.prototype.hasOwnProperty.call(r,n)},function(){"use strict";var r=t(767),n=t.n(r);self.onmessage=r=>{const t=function(r,t){const e="action"===r?n()("#ff3464"):n()("#2F80ED"),a=n()(t).hsl(),o=e.hsl(),l=a.hue()-o.hue(),i=a.saturationl()/o.saturationl(),s=a.lightness()/o.lightness();return r=>{const t=(()=>{const r=(r,n)=>Math.abs(r-n)<5;return(n,t,e)=>r(n,t)&&r(t,e)&&r(n,e)})(),e={};for(let a=0,o=r.length;a<o;a+=4){const o=r[a],h=r[a+1],u=r[a+2];if(!t(o,h,u)){const t=o+1e3*h+1e6*u;if(!e[t]){let r=n()({r:o,g:h,b:u}).hsl();r=r.rotate(l),r.color[1]*=i,r.color[2]*=s;const[a,c,f]=r.rgb().array();e[t]=[a,c,f]}const[c,f,g]=e[t];r[a]=c,r[a+1]=f,r[a+2]=g}}return r}}(r.data.type,r.data.color)(new Uint8ClampedArray(r.data.payload));self.postMessage({id:r.data.id,result:t})}}()}();\n',"Worker",void 0,void 0)});function s$(e){return function(){var t,n=(t=function*(t,n,i){const r=t.getImageData(0,0,n,i),o=gt("action"===e?"action-color":"notice-background-color"),s=yield o$(r.data.buffer,[r.data.buffer],{type:e,color:o});t.putImageData(new ImageData(s,n,i),0,0)},function(){var e=this,n=arguments;return new Promise((function(i,r){var o=t.apply(e,n);function s(e){r$(o,i,r,s,a,"next",e)}function a(e){r$(o,i,r,s,a,"throw",e)}s(void 0)}))});return function(e,t,i){return n.apply(this,arguments)}}()}var a$=n(99477);const l$=["action","notice"],c$={action:n$,notice:i$},d$=new Array(64).fill(0),u$=e=>e$.frames[e.data.name]?"action":"notice",h$=e=>!!e.visible&&(!e.parent||h$(e.parent));AFRAME.registerComponent("sprite",{schema:{name:{type:"string"}},tick(){if(!this.didRegisterWithSystem&&!this.didFailToRegister&&this.el.sceneEl.systems["hubs-systems"]){const e=this.el.sceneEl.systems["hubs-systems"].spriteSystem.add(this);this.didRegisterWithSystem=e>0,this.didFailToRegister=e<0}},update(){this.didRegisterWithSystem&&this.el.sceneEl.systems["hubs-systems"].spriteSystem.updateUVs(this)},remove(){this.didRegisterWithSystem&&this.el.sceneEl.systems["hubs-systems"].spriteSystem.remove(this)}});const p$=function(){const e=new Map;return function(t,n){let i=e.get(t);if(i)return i;{if(!n.frames[t])return i={x:0,y:0,w:0,h:0},e.set(t,i),i;const r=n.meta.size,o=n.frames[t].frame;return i={x:o.x/r.w,y:o.y/r.h,w:o.w/r.w,h:o.h/r.h},e.set(t,i),i}}}(),m$=function(){const e=new a$.Vector3,t=new a$.Vector3,n=new a$.Vector3,i=new a$.Vector3,r=new a$.Vector3,o={distance:0,point:r,object:null};return function(s,a){this.updateMatrices(),e.set(-.5,.5,0).applyMatrix4(this.matrixWorld),t.set(.5,.5,0).applyMatrix4(this.matrixWorld),n.set(-.5,-.5,0).applyMatrix4(this.matrixWorld);let l=s.ray.intersectTriangle(e,n,t,!1,r);if(null===l&&(i.set(.5,-.5,0).applyMatrix4(this.matrixWorld),l=s.ray.intersectTriangle(t,n,i,!1,r),null===l))return;const c=s.ray.origin.distanceTo(r);c<s.near||c>s.far||(o.distance=c,o.point=r,o.object=this,a.push(o))}}(),f$=e=>e&&e.components?e.components["hoverable-visuals"]?e.components["hoverable-visuals"]:f$(e.parentEl):null,g$=e=>{const t=f$(e.el);if(!t)return!1;const n=t.el.components.pinnable&&t.el.components.pinnable.data.pinned,i=!!t.el.components["super-spawner"],r=t.el.sceneEl.is("frozen"),o=!i&&n&&!r;return t.data.enableSweepingEffect&&!o},v$=e=>{const t=new a$.BufferGeometry,n=new Float32Array(3*e*4);for(let t=0;t<e;t++)n[3*t*4+0]=-.5,n[3*t*4+1]=.5,n[3*t*4+2]=0,n[3*t*4+3]=.5,n[3*t*4+4]=.5,n[3*t*4+5]=0,n[3*t*4+6]=-.5,n[3*t*4+7]=-.5,n[3*t*4+8]=0,n[3*t*4+9]=.5,n[3*t*4+10]=-.5,n[3*t*4+11]=0;t.setAttribute("position",new a$.BufferAttribute(n,3,!1)),t.setAttribute("a_hubs_EnableSweepingEffect",new a$.BufferAttribute(new Float32Array(4*e),1,!1)),t.setAttribute("a_hubs_SweepParams",new a$.BufferAttribute(new Float32Array(4*e*2),2,!1)),t.setAttribute("a_uvs",new a$.BufferAttribute(new Float32Array(2*e*4),2,!1)),t.setAttribute("a_mv",new a$.BufferAttribute(new Float32Array(16*e*4),16,!1));const i=new Uint16Array(3*e*2);for(let t=0;t<e;t++)i[3*t*2+0]=4*t+0,i[3*t*2+1]=4*t+2,i[3*t*2+2]=4*t+1,i[3*t*2+3]=4*t+1,i[3*t*2+4]=4*t+2,i[3*t*2+5]=4*t+3;return t.setIndex(new a$.BufferAttribute(i,1)),t.drawRange.count=0,t},b$=e=>new a$.RawShaderMaterial({uniforms:{u_spritesheet:{value:e},hubs_Time:{value:0}},vertexShader:"uniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\n\nattribute mat4 a_mv;\nattribute vec3 position;\nattribute vec2 a_uvs;\nvarying vec2 v_uvs;\nattribute float a_hubs_EnableSweepingEffect;\nvarying float v_hubs_EnableSweepingEffect;\nattribute vec2 a_hubs_SweepParams;\nvarying vec2 v_hubs_SweepParams;\nvarying vec3 hubs_WorldPosition;\n\nvoid main() {\n  gl_Position = projectionMatrix * modelViewMatrix * a_mv * vec4(position, 1.0);\n  v_uvs = a_uvs;\n  v_hubs_EnableSweepingEffect = a_hubs_EnableSweepingEffect;\n  v_hubs_SweepParams = a_hubs_SweepParams;\n\n  vec4 wt = vec4(position, 1.0);\n  hubs_WorldPosition = (a_mv * wt).xyz;\n}\n",fragmentShader:"precision mediump float;\n\nuniform sampler2D u_spritesheet;\n\nvarying vec2 v_uvs;\n\nvarying float v_hubs_EnableSweepingEffect;\nvarying vec2 v_hubs_SweepParams;\nvarying vec3 hubs_WorldPosition;\nuniform bool hubs_HighlightInteractorOne;\nuniform vec3 hubs_InteractorOnePos;\nuniform bool hubs_HighlightInteractorTwo;\nuniform vec3 hubs_InteractorTwoPos;\nuniform float hubs_Time;\n\nvec4 LinearTosRGB( in vec4 value ) {\n    return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\n\nvec4 linearToOutputTexel( vec4 value ) {\n  return LinearTosRGB( value );\n}\n\nvoid main() {\n    vec4 texColor = texture2D(u_spritesheet, v_uvs);\n\n    float ratio = 0.0;\n    if (v_hubs_EnableSweepingEffect > 0.9 ) {\n        float size = v_hubs_SweepParams.t - v_hubs_SweepParams.s * 1.0;\n        float line = mod(hubs_Time / 500.0 * size, size * 3.0) + v_hubs_SweepParams.s - size / 3.0;\n        if (hubs_WorldPosition.y < line) {\n            ratio = max(0.0, 1.0 - (line - hubs_WorldPosition.y) / (size * 1.5));\n        }\n\n    }\n    ratio = min(1.0, ratio);\n\n    vec4 highlightColor = vec4(0.184, 0.499, 0.933, 1.0);\n    gl_FragColor = linearToOutputTexel(vec4((texColor.rgb * (1.0 - ratio)) + (highlightColor.rgb * ratio), texColor.a));\n}\n",side:a$.DoubleSide,transparent:!0});class y${raycast(e,t){for(const n of l$){const i=this.sprites[n];for(const n of i){const i=n.el.object3D;h$(i)&&m$.call(i,e,t)}}return t}constructor(e){this.sprites={action:[],notice:[]},this.indicesFromSprites={action:new WeakMap,notice:new WeakMap},this.meshes={action:null,notice:null},L().then((()=>{for(const t in c$)Wl(c$[t],s$(t)).then((n=>{const i=v$(1024),r=b$(n),o=this.meshes[t]=new a$.Mesh(i,r),s=document.createElement("a-entity");s.classList.add("ui"),e.appendChild(s),s.setObject3D("mesh",o),o.frustumCulled=!1,o.layers.set(_o.CAMERA_LAYER_UI),o.layers.enable(_o.CAMERA_LAYER_FX_MASK),o.renderOrder=window.APP.RENDER_ORDER.HUD_ICONS,o.raycast=this.raycast.bind(this)}))})),bt((()=>{for(const e in c$){const t=c$[e];this.meshes[e]&&Wl(t,s$(e)).then((t=>{const n=this.meshes[e].material.uniforms.u_spritesheet.value;this.meshes[e].material.uniforms.u_spritesheet.value=t,this.meshes[e].material.uniformsNeedUpdate=!0,wo(n)}))}}))}tick(e){for(let t=0,n=l$.length;t<n;t++){const n=l$[t],i=this.meshes[n];if(!i)continue;i.material.uniforms.hubs_Time.value=e,i.material.uniformsNeedUpdate=!0;const r=i.geometry,o=r.getAttribute("a_mv"),s=r.getAttribute("a_hubs_EnableSweepingEffect"),a=r.getAttribute("a_hubs_SweepParams"),l=this.sprites[n];let c=!1,d=!1;for(let e=0,t=l.length;e<t;e++){const t=l[e];if(h$(t.el.object3D)){const n=g$(t)?1:0;if(s.array[4*e+0]=n,s.array[4*e+1]=n,s.array[4*e+2]=n,s.array[4*e+3]=n,c=!0,n){const n=f$(t.el),i=n.sweepParams[0],r=n.sweepParams[1];a.setXY(4*e+0,i,r),a.setXY(4*e+1,i,r),a.setXY(4*e+2,i,r),a.setXY(4*e+3,i,r),d=!0}t.el.object3D.updateMatrices();const i=t.el.object3D.matrixWorld;o.array.set(i.elements,4*e*16),o.array.set(i.elements,16*(4*e+1)),o.array.set(i.elements,16*(4*e+2)),o.array.set(i.elements,16*(4*e+3))}else o.array.set(d$,4*e*16)}o.needsUpdate=!0,o.updateRange.count=4*l.length*16,c&&(s.needsUpdate=!0,s.updateRange.count=4*l.length),d&&(a.needsUpdate=!0,a.updateRange.count=4*l.length*2)}}updateUVs(e){const t=u$(e),n=this.meshes[t];if(!n)return;const i=this.indicesFromSprites[t];if(!i.has(e))return;const r=i.get(e),o=n.material.uniforms.u_spritesheet.value.flipY,s=p$(e.data.name,"action"===t?e$:t$),a=n.geometry.getAttribute("a_uvs");a.setXY(4*r+0,s.x,o?1-s.y:s.y),a.setXY(4*r+1,s.x+s.w,o?1-s.y:s.y),a.setXY(4*r+2,s.x,o?1-s.y-s.h:s.y+s.h),a.setXY(4*r+3,s.x+s.w,o?1-s.y-s.h:s.y+s.h),a.needsUpdate=!0,a.updateRange.count=4*this.sprites[t].length*2}add(e){const t=u$(e),n=this.meshes[t];if(!n)return 0;const i=this.sprites[t],r=this.indicesFromSprites[t];if(r.has(e))return console.error("This sprite is already added"),-1;if(i.length>=1024)return console.error("Too many sprites"),-1;const o=i.push(e)-1;return r.set(e,o),this.updateUVs(e),n.geometry.drawRange.count=3*i.length*2,1}remove(e){const t=u$(e),n=this.meshes[t];if(!n)return;const i=this.sprites[t],r=this.indicesFromSprites[t];if(!r.has(e))return void console.error("This sprite is not found");const o=r.get(e);r.delete(e);const s=i.pop();e!==s&&(i[o]=s,r.set(s,o),this.updateUVs(s)),n.geometry.drawRange.count=3*i.length*2}}var w$=n(99477);const _$=function(){const e=new w$.Vector3,t=new w$.Vector3,n=new w$.Vector3,i=new w$.Vector3,r=new w$.Vector3,o=new w$.Matrix4,s=new w$.Vector3;let a=1;return function(l,c,d){l.updateMatrices(),c.updateMatrices(),Lo(o.copy(l.matrixWorld),o).extractBasis(r,e,t),s.setFromMatrixPosition(l.matrixWorld).add(r.addVectors(e.multiplyScalar(1.6),t.multiplyScalar(.15))),i.subVectors(s,r.setFromMatrixPosition(c.matrixWorld));const u=i.length();return u<(u<.2*r.setFromMatrixColumn(c.matrixWorld,0).length())?(a=1e-5,i.set(0,0,-1)):a=.1+.05*u,n.copy(i).projectOnPlane(e.set(0,1,0)).normalize(),d.makeBasis(r.crossVectors(n,e).multiplyScalar(a),e.multiplyScalar(a),n.multiplyScalar(-1*a)).setPosition(s)}}();function E$(e){return e.canBeOccupied&&e.canBeSpawnPoint}function A$(e){return!e.canBeOccupied&&e.canBeSpawnPoint}function S$(e,t){return new Promise((n=>{const i=document.importNode(document.getElementById(t).content.children[0]);e.appendChild(i,!0),setTimeout((()=>{n(i)}),0)}))}function x$(e){return e.data.canBeOccupied&&e.data.isOccupied&&e.el.components.networked&&NAF.utils.isMine(e.el)}function M$(e){e.el.setAttribute("waypoint",{isOccupied:!1})}function P$(e){e.filter(x$).forEach(M$)}function C$(e){return e.object3D.uuid}class k${constructor(e,t){this.helperMat4=new w$.Matrix4,this.scene=e,this.loading=[],this.ready=[],this.previousWaypointHash=null,this.initialSpawnHappened=!1,this.waypointForTemplateEl={},this.elementsFromTemplatesFor={},this.eventHandlers=[],this.lostOwnershipOfWaypoint=this.lostOwnershipOfWaypoint.bind(this),L().then((()=>{S$(e,"waypoint-preview-avatar-template").then((e=>{this.waypointPreviewAvatar=e,this.waypointPreviewAvatar.object3D.visible=!1}))})),this.characterController=t}releaseAnyOccupiedWaypoints(){P$(this.ready),this.currentWaypoint&&this.currentWaypoint.el.removeEventListener("ownership-lost",this.lostOwnershipOfWaypoint)}teleportToWaypoint(e,t){return function(){this.moveToWaypoint(t,!1)}.bind(this)}tryTeleportToOccupiableWaypoint(e,t){return function(){const e=this.ready.filter(x$);this.tryToOccupy(t).then((n=>{n&&(t.el.object3D.updateMatrices(),this.characterController.shouldLandWhenPossible=!0,this.characterController.enqueueWaypointTravelTo(t.el.object3D.matrixWorld,!1,t.data),P$(e.filter((e=>e!==t))))}))}.bind(this)}setupEventHandlersFor(e){return function(t){const n=C$(t);if(this.eventHandlers[n]=this.eventHandlers[n]||{},e.data.canBeClicked&&(t.classList.contains("teleport-waypoint-icon")||t.classList.contains("occupiable-waypoint-icon"))){const i=()=>{e.el.object3D.updateMatrices(),this.waypointPreviewAvatar&&!this.waypointForTemplateEl[n].data.willMaintainInitialOrientation&&(this.waypointPreviewAvatar.object3D.visible=!0,e.el.object3D.updateMatrices(),Oo(this.waypointPreviewAvatar.object3D,e.el.object3D.matrixWorld))},r=()=>{this.waypointPreviewAvatar&&(this.waypointPreviewAvatar.object3D.visible=!1)};t.object3D.addEventListener("hovered",i),t.object3D.addEventListener("unhovered",r),this.eventHandlers[n].hovered=i,this.eventHandlers[n].unhovered=r}if(ef(t,"singleActionButton")&&e.data.canBeClicked){let i=()=>{console.log("interacted with",t,"associated with waypoint",e)};t.classList.contains("teleport-waypoint-icon")?i=this.teleportToWaypoint(t,e):t.classList.contains("occupiable-waypoint-icon")&&(i=this.tryTeleportToOccupiableWaypoint(t,e)),t.object3D.addEventListener("interact",i),this.eventHandlers[n].interact=i}}.bind(this)}registerComponent(e){this.loading.push(e);const t=this.setupEventHandlersFor(e),n=C$(e.el);var i,r;this.elementsFromTemplatesFor[n]=this.elementsFromTemplatesFor[n]||[],Promise.all((i=this.scene,r=e.data,function(e){const t=[];return e.canBeClicked&&e.canBeOccupied?t.push("occupiable-waypoint-icon"):e.canBeClicked&&!e.canBeOccupied?t.push("teleport-waypoint-icon"):A$(e)||E$(e),t}(r).map((e=>S$(i,e))))).then((i=>{const r=this.loading.indexOf(e);if(-1===r)return null;this.loading.splice(r,1),this.ready.push(e),this.elementsFromTemplatesFor[n].push(...i),i.forEach((t=>{this.waypointForTemplateEl[C$(t)]=e})),i.forEach(t)}))}unregisterComponent(e){const t=this.loading.indexOf(e);-1!==t&&this.loading.splice(t,1);const n=this.ready.indexOf(e);if(-1!==n){this.ready.splice(n,1);const t=C$(e.el),i=this.elementsFromTemplatesFor[t];for(let e=0;e<i.length;e++){const t=i[e],n=C$(t);this.eventHandlers[n]&&["interact","hovered","unhovered"].map((e=>{this.eventHandlers[n][e]&&(t.object3D.removeEventListener(e,this.eventHandlers[n][e]),delete this.eventHandlers[n][e])})),t.parentNode.removeChild(t)}this.elementsFromTemplatesFor[t].length=0}}getUnoccupiableSpawnPoint(){const e=this.ready.filter((e=>A$(e.data)));return e.length&&e.splice(Math.floor(Math.random()*e.length),1)[0]}lostOwnershipOfWaypoint(e){this.currentWaypoint&&this.currentWaypoint.el===e.detail.el&&(this.mightNeedRespawn=!0,this.ownershipLostTime=performance.now())}tryToOccupy(e){return new Promise((t=>{var n;(function(e){return e.data.canBeOccupied&&(NAF.utils.isMine(e.el)||!(e.data.isOccupied&&NAF.utils.getNetworkOwner(e.el)&&NAF.connection.connectedClients[NAF.utils.getNetworkOwner(e.el)]))})(e)&&(n=e.el,NAF.utils.isMine(n)||NAF.utils.takeOwnership(n))?(function(e){e.el.setAttribute("waypoint",{isOccupied:!0})}(e),this.currentWaypoint&&this.currentWaypoint.el.removeEventListener("ownership-lost",this.lostOwnershipOfWaypoint),this.currentWaypoint=e,e.el.addEventListener("ownership-lost",this.lostOwnershipOfWaypoint),t(!0)):t(!1)}))}tryToOccupyAnyOf(e){if(!e.length)return Promise.resolve(null);const t=e.splice(Math.floor(Math.random()*e.length),1)[0];return this.tryToOccupy(t).then((n=>n?Promise.resolve(t):this.tryToOccupyAnyOf(e)))}moveToSpawnPoint(){return this.currentMoveToSpawn?this.currentMoveToSpawn:(this.nextMoveToSpawn||(this.waitOneTick=!0,this.nextMoveToSpawn=new Promise((e=>{this.nextMoveToSpawnResolve=e}))),this.previousWaypointHash=null,this.initialSpawnHappened=!1,this.nextMoveToSpawn)}moveToWaypoint(e,t){this.releaseAnyOccupiedWaypoints(),e.el.object3D.updateMatrices(),this.characterController.shouldLandWhenPossible=!0,this.characterController.enqueueWaypointTravelTo(e.el.object3D.matrixWorld,!window.APP.store.state.preferences.animateWaypointTransitions||t,e.data)}moveToUnoccupiableSpawnPoint(){const e=this.getUnoccupiableSpawnPoint();return e&&this.moveToWaypoint(e,!0),e}tick(){if(this.waitOneTick)return void(this.waitOneTick=!1);if(""!==window.location.hash&&this.previousWaypointHash!==window.location.hash&&this.initialSpawnHappened){const e=window.location.hash.replace("#",""),t=this.ready.find((t=>t.el.object3D.name===e));t&&(this.moveToWaypoint(t,null===this.previousWaypointHash),window.history.replaceState(null,null,window.location.href.split("#")[0])),this.previousWaypointHash=window.location.hash}if(!this.currentMoveToSpawn&&this.nextMoveToSpawn){let e;this.mightNeedRespawn=!1,this.currentMoveToSpawn=this.nextMoveToSpawn,this.currentMoveToSpawnResolve=this.nextMoveToSpawnResolve,this.nextMoveToSpawn=null,this.nextMoveToSpawnResolve=null;const t=this.ready.filter(x$);this.tryToOccupyAnyOf(this.ready.filter((e=>E$(e.data)))).then((n=>{if(n){const i=n;P$(t.filter((e=>e!==i))),i.el.object3D.updateMatrices(),this.characterController.shouldLandWhenPossible=!0,this.characterController.enqueueWaypointTravelTo(i.el.object3D.matrixWorld,!0,i.data),e=i}else null===n&&(e=this.moveToUnoccupiableSpawnPoint());this.initialSpawnHappened=!0,this.currentMoveToSpawnResolve(e),this.currentMoveToSpawn=null,this.currentMoveToSpawnResolve=null}))}else this.mightNeedRespawn&&performance.now()-this.ownershipLostTime<8e3&&(this.mightNeedRespawn=!1,this.moveToSpawnPoint());const e=(e,t)=>{(e.classList.contains("teleport-waypoint-icon")||e.classList.contains("occupiable-waypoint-icon"))&&(e.object3D.visible=this.scene.is("frozen"),e.object3D.visible&&(this.viewingCamera=this.viewingCamera||document.getElementById("viewing-camera").object3DMap.camera,Oo(e.object3D,_$(t.el.object3D,this.viewingCamera,this.helperMat4))))};this.ready.forEach(function(t){this.elementsFromTemplatesFor[C$(t.el)].forEach((n=>e(n,t)))}.bind(this))}}AFRAME.registerComponent("waypoint",{schema:{canBeSpawnPoint:{default:!1},canBeOccupied:{default:!1},canBeClicked:{default:!1},willDisableMotion:{default:!1},willDisableTeleporting:{default:!1},snapToNavMesh:{default:!1},willMaintainInitialOrientation:{default:!1},willMaintainWorldUp:{default:!0},isOccupied:{default:!1}},init(){this.system=this.el.sceneEl.systems["hubs-systems"].waypointSystem,this.didRegisterWithSystem=!1},play(){this.didRegisterWithSystem||(this.el.components.networked&&Gi(this.el.components.networked.data.networkId),this.system.registerComponent(this,this.el.sceneEl),this.didRegisterWithSystem=!0)},remove(){this.didRegisterWithSystem?this.system.unregisterComponent(this):console.warn("Waypoint removed without ever having registered with the system.")}});var O$=n(99477);const T$=[],R$=function(){let e,t;return function(n){return e=e||document.getElementById("avatar-pov-node"),t=t||document.getElementById("avatar-rig"),t.object3D.updateMatrices(),e.object3D.updateMatrices(),n?e.object3D.matrixWorld.elements[13]-t.object3D.matrixWorld.elements[13]:e.object3D.matrix.elements[13]}}();var D$=n(99477);const j$="character",L$=(0,z.Z)("waypointLerp"),I$=AFRAME.utils.device.isMobile(),N$=function(){const e=new D$.Matrix4,t=new D$.Matrix4,n=new D$.Matrix4;return function(i,r,o,s){return n.makeTranslation(o.x,o.y,o.z),e.extractRotation(i),r||Lo(e,e),t.copy(e).multiply(n),s.setFromMatrixPosition(t)}}();class F${constructor(e){this.teleportTo=function(){const e=new D$.Vector3,t=new D$.Vector3,n=new D$.Vector3,i=new D$.Vector3,r=new D$.Vector3;return function(o){this.didTeleportSinceLastWaypointTravel=!0,this.isMotionDisabled=!1,this.avatarRig.object3D.getWorldPosition(e),this.avatarPOV.object3D.getWorldPosition(t),i.copy(o),i.y+=this.avatarPOV.object3D.position.y,n.copy(i).sub(t),r.copy(e).add(n);const s=j$ in this.scene.systems.nav.pathfinder.zones;this.findPositionOnNavMesh(r,r,this.avatarRig.object3D.position,s),this.avatarRig.object3D.matrixNeedsUpdate=!0}}(),this.travelByWaypoint=function(){const e=new D$.Matrix4,t=new D$.Vector3,n=new D$.Vector3,i=new D$.Matrix4,r=new D$.Matrix4,o=new D$.Vector3,s=new D$.Vector3,a=new D$.Matrix4;return function(l,c,d){this.avatarPOV.object3D.updateMatrices(),this.fly||c||(this.fly=!0,this.shouldLandWhenPossible=!0),this.shouldUnoccupyWaypointsOnceMoving=!0,this.didTeleportSinceLastWaypointTravel=!1,e.copy(l),No(e,Math.PI,a);const u=j$ in this.scene.systems.nav.pathfinder.zones;!u&&c&&console.warn("Tried to travel to a waypoint that wants to snap to the nav mesh, but there is no nav mesh"),u&&c?(t.setFromMatrixPosition(e),this.findPositionOnNavMesh(t,t,n,!0),a.setPosition(n),i.makeTranslation(0,R$(),-.15)):i.makeTranslation(0,1.6,-.15),a.multiply(i),d&&(r.extractRotation(this.avatarPOV.object3D.matrixWorld),o.setFromMatrixScale(a),s.setFromMatrixPosition(a),a.copy(r).scale(o).setPosition(s)),Io(this.avatarPOV.object3D.matrixWorld,a,a),Fo(this.avatarRig.object3D,this.avatarPOV.object3D,a)}}(),this.tick=function(){const e=new D$.Matrix4,t=new D$.Matrix4,n=new D$.Vector3,i=new D$.Vector3,r=new D$.Vector3,o=new D$.Vector3,s=new D$.Matrix4,a=new D$.Matrix4,l=new D$.Matrix4,c=new D$.Vector3,d=new D$.Vector3;let u;return function(h,p){const m=this.scene.is("entered");if(u=u||document.getElementById("ui-root"),(m||!u||!u.firstChild||!u.firstChild.classList.contains("isGhost"))&&!m)return;const f=this.scene.is("vr-mode");this.sfx=this.sfx||this.scene.systems["hubs-systems"].soundEffectsSystem,this.waypointSystem=this.waypointSystem||this.scene.systems["hubs-systems"].waypointSystem,!this.activeWaypoint&&this.waypoints.length&&(this.activeWaypoint=this.waypoints.splice(0,1)[0],this.isMotionDisabled=this.activeWaypoint.waypointComponentData.willDisableMotion&&(!I$||this.activeWaypoint.waypointComponentData.willDisableTeleporting),this.isTeleportingDisabled=this.activeWaypoint.waypointComponentData.willDisableTeleporting,this.avatarPOV.object3D.updateMatrices(),this.waypointTravelTime=f&&!L$||this.activeWaypoint.isInstant?0:(new D$.Vector3).setFromMatrixPosition(this.avatarPOV.object3D.matrixWorld).distanceTo(c.setFromMatrixPosition(this.activeWaypoint.transform))/50*1e3,No(this.avatarPOV.object3D.matrixWorld,Math.PI,s),s.multiply(l.makeTranslation(0,-1*R$(),-.15)),this.waypointTravelStartTime=h,!f&&this.waypointTravelTime>100&&this.sfx.playSoundOneShot(gm));const g=0===this.waypointTravelTime||h>=this.waypointTravelStartTime+this.waypointTravelTime;if(this.activeWaypoint&&!g){const e=D$.MathUtils.clamp((h-this.waypointTravelStartTime)/this.waypointTravelTime,0,1);jo(s,this.activeWaypoint.transform,Fc(e),a),this.travelByWaypoint(a,!1,this.activeWaypoint.waypointComponentData.willMaintainInitialOrientation)}var v;this.activeWaypoint&&(this.waypoints.length||g)&&(this.travelByWaypoint(this.activeWaypoint.transform,this.activeWaypoint.waypointComponentData.snapToNavMesh,this.activeWaypoint.waypointComponentData.willMaintainInitialOrientation),v=this.activeWaypoint.transform,T$.push(v),this.activeWaypoint=null,(f||this.waypointTravelTime>0)&&this.sfx.playSoundOneShot(vm));const b=AFRAME.scenes[0].systems.userinput,y=this.fly;b.get(zm.actions.toggleFly)&&(this.shouldLandWhenPossible=!1,this.avatarRig.messageDispatch.dispatch("/fly"));const w=y&&!this.fly;!this.fly&&this.shouldLandWhenPossible&&(this.shouldLandWhenPossible=!1),this.fly&&(this.navNode=null);const _=window.APP.store.state.preferences,E=b.get(zm.actions.snapRotateLeft),A=b.get(zm.actions.snapRotateRight);E&&(this.dXZ+=_.snapRotationDegrees*Math.PI/180),A&&(this.dXZ-=_.snapRotationDegrees*Math.PI/180),(E||A)&&this.scene.systems["hubs-systems"].soundEffectsSystem.playSoundOneShot(bm);const S=b.get(zm.actions.characterAcceleration),x=S&&(S[0]||S[1]);if(S){const e=-1*S[1];this.relativeMotion.set(this.relativeMotion.x+(_.disableMovement||_.disableStrafing?0:S[0]),this.relativeMotion.y,this.relativeMotion.z+(_.disableMovement?0:_.disableBackwardsMovement?Math.min(0,e):e))}const M=f?0:.85;this.nextRelativeMotion.copy(this.relativeMotion).multiplyScalar(M),this.relativeMotion.multiplyScalar(1-M),this.avatarPOV.object3D.updateMatrices(),No(this.avatarPOV.object3D.matrixWorld,this.dXZ,e),t.copy(e);const P=j$ in this.scene.systems.nav.pathfinder.zones;if(!this.isMotionDisabled){const s=d.setFromMatrixColumn(this.avatarPOV.object3D.matrixWorld,1).length(),a=this.relativeMotion.lengthSq()>1e-6;if(a){const i=_.movementSpeedModifier;N$(e,this.fly||!P,this.relativeMotion.multiplyScalar((b.get(zm.actions.boost)?2:1)*i*3.2*Math.sqrt(s)*p/1e3),n),t.makeTranslation(n.x,n.y,n.z).multiply(e)}const l=w||this.shouldLandWhenPossible,c=P&&(l||a);let u=0;c&&(this.findPOVPositionAboveNavMesh(i.setFromMatrixPosition(this.avatarPOV.object3D.matrixWorld),r.setFromMatrixPosition(t),o,l),u=r.distanceToSquared(o),this.fly&&this.shouldLandWhenPossible&&u<.5&&!this.activeWaypoint?(this.shouldLandWhenPossible=!1,this.fly=!1,t.setPosition(o)):this.fly||t.setPosition(o)),!this.activeWaypoint&&this.shouldUnoccupyWaypointsOnceMoving&&(x||this.didTeleportSinceLastWaypointTravel)&&(this.didTeleportSinceLastWaypointTravel=!1,this.shouldUnoccupyWaypointsOnceMoving=!1,(0,z.Z)("newLoader")?Vd&&(bi.occupied[Vd]=0,Vd=0):this.waypointSystem.releaseAnyOccupiedWaypoints(),this.fly&&this.shouldLandWhenPossible&&c&&u<3&&(t.setPosition(o),this.shouldLandWhenPossible=!1,this.fly=!1))}Fo(this.avatarRig.object3D,this.avatarPOV.object3D,t),this.relativeMotion.copy(this.nextRelativeMotion),this.dXZ=0}}(),this.findPOVPositionAboveNavMesh=function(){const e=new D$.Vector3,t=new D$.Vector3;return function(n,i,r,o){const s=R$(!0);return e.copy(n),e.y-=s,t.copy(i),t.y-=s,this.findPositionOnNavMesh(e,t,r,o),r.y+=s,r}}(),this.scene=e,this.fly=!1,this.shouldLandWhenPossible=!1,this.waypoints=[],this.waypointTravelStartTime=0,this.waypointTravelTime=0,this.navGroup=null,this.navNode=null,this.relativeMotion=new D$.Vector3(0,0,0),this.nextRelativeMotion=new D$.Vector3(0,0,0),this.dXZ=0,this.scene.addEventListener("nav-mesh-loaded",(()=>{this.navGroup=null,this.navNode=null})),L().then((()=>{this.avatarPOV=document.getElementById("avatar-pov-node"),this.avatarRig=document.getElementById("avatar-rig")}))}enqueueWaypointTravelTo(e,t,n){this.waypoints.push({transform:(T$.shift()||new O$.Matrix4).copy(e),isInstant:t,waypointComponentData:n})}enqueueRelativeMotion(e){this.relativeMotion.add(e)}enqueueInPlaceRotationAroundWorldUp(e){this.dXZ+=e}getClosestNode(e){const t=this.scene.systems.nav.pathfinder;return t.zones[j$].groups[this.navGroup]?t.getClosestNode(e,j$,this.navGroup,!0)||t.getClosestNode(e,j$,this.navGroup):null}findPositionOnNavMesh(e,t,n,i){const r=this.scene.systems.nav.pathfinder;if(j$ in r.zones)return this.navGroup=i||null===this.navGroup?r.getGroup(j$,t,!0,!0):this.navGroup,this.navNode=i||null===this.navNode||void 0===this.navNode?this.getClosestNode(t):this.navNode,null===this.navNode||void 0===this.navNode?n.copy(t):this.navNode=r.clampStep(e,t,this.navNode,j$,this.navGroup,n),n}enableFly(e){return e&&window.APP.hubChannel&&window.APP.hubChannel.can("fly")?this.fly=!0:this.fly=!1,this.fly}}const B$=(new(n(99477).Matrix4)).identity();class V${constructor(){this.pairs=[]}register(e,t){e.applyMatrix4(B$),this.pairs.push({object3D:e,path:t})}unregister(e){this.pairs=this.pairs.filter((t=>t.object3D!==e))}tick(){for(let e=0;e<this.pairs.length;e++){const t=AFRAME.scenes[0].systems.userinput.get(this.pairs[e].path);if(t){const n=this.pairs[e].object3D;n.matrix.copy(t),n.matrix.decompose(n.position,n.quaternion,n.scale),n.matrixWorldNeedsUpdate=!0}}}}var U$=n(99477);class H${constructor(){this.tick=function(){const e=new U$.Vector3,t=new U$.Vector3,n=new U$.Vector3,i=new U$.Vector3,r=new U$.Vector3;return function(o){if(!this.viewingCameraEl)return;const s=this.viewingCameraEl.object3DMap.camera;s.updateMatrices(),r.setFromMatrixPosition(s.matrixWorld);for(let s=0;s<this.components.length;s++){const a=this.data.get(this.components[s]),l=a.menuEl.object3D.visible,c=l&&!a.wasMenuVisible,d=e.subVectors(r,i.setFromMatrixPosition(a.menuEl.object3D.matrixWorld)).length();if(a.menuEl.object3D.parent.updateMatrices(),n.setFromMatrixScale(a.menuEl.object3D.parent.matrixWorld),c){const e=a.chooseScale?U$.MathUtils.clamp(.45*d,.05,4):t.setFromMatrixScale(a.menuEl.object3D.matrixWorld).x;a.endingScale=e/n.x,a.menuOpenTime=o,a.startScaleAtMenuOpenTime=.8*a.endingScale}if(l){const e=U$.MathUtils.lerp(a.startScaleAtMenuOpenTime,a.endingScale,Bc(U$.MathUtils.clamp((o-a.menuOpenTime)/750,0,1)));a.menuEl.object3D.scale.x!==e&&(a.menuEl.object3D.scale.setScalar(e),a.menuEl.object3D.matrixNeedsUpdate=!0)}a.wasMenuVisible=l}}}(),this.components=[],this.data=new Map,this.tick=this.tick.bind(this),L().then((()=>{this.viewingCameraEl=document.getElementById("viewing-camera")}))}register(e,t,n){this.components.push(e),this.data.set(e,{menuEl:t,chooseScale:n,menuOpenTime:-1,startScaleAtMenuOpenTime:0,wasMenuVisible:!1,endingScale:0})}unregister(e){this.components.splice(this.components.indexOf(e),1),this.data.delete(e)}}class z${constructor(e){this.onSceneReset=()=>{APP.sceneAudioDefaults.delete(mh.AVATAR_AUDIO_SOURCE),APP.sceneAudioDefaults.delete(mh.MEDIA_VIDEO);for(const[e,t]of APP.audios.entries())rm(e,t)},e.addEventListener("reset_scene",this.onSceneReset),0!==window.APP.store.state.preferences.audioNormalization&&window.APP.store.update({preferences:{audioNormalization:0}})}}var W$=n(70766),q$=n(99477);function Z$(e,t,n,i,r,o,s){try{var a=e[o](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(i,r)}let G$=null;function Y$(e){G$&&clearTimeout(G$),G$=setTimeout((()=>{G$=null,console.warn("enableChromeAEC: recreate RTCPeerConnection loopback because the local connection was disconnected for 10s"),X$(e)}),1e4)}function Q$(e){return e instanceof q$.Audio||e instanceof q$.PositionalAudio}function X$(e){return K$.apply(this,arguments)}function K$(){var e;return e=function*(e){const t=new Audio;t.setAttribute("autoplay","autoplay"),t.setAttribute("playsinline","playsinline");const n=q$.AudioContext.getContext().createMediaStreamDestination(),i=new RTCPeerConnection,r=new RTCPeerConnection,o=e=>{console.error("enableChromeAEC: RTCPeerConnection loopback initialization error",e)};i.addEventListener("icecandidate",(e=>{r.addIceCandidate(e.candidate).catch(o)})),i.addEventListener("iceconnectionstatechange",(()=>{console.warn("enableChromeAEC: outboundPeerConnection state changed to "+i.iceConnectionState),"disconnected"===i.iceConnectionState&&Y$(e),"connected"===i.iceConnectionState&&G$&&clearTimeout(G$)})),r.addEventListener("icecandidate",(e=>{i.addIceCandidate(e.candidate).catch(o)})),r.addEventListener("iceconnectionstatechange",(()=>{console.warn("enableChromeAEC: inboundPeerConnection state changed to "+r.iceConnectionState),"disconnected"===r.iceConnectionState&&Y$(e),"connected"===r.iceConnectionState&&G$&&clearTimeout(G$)})),r.addEventListener("track",(e=>{t.srcObject=e.streams[0]}));try{n.stream.getTracks().forEach((e=>{i.addTrack(e,n.stream)}));const t=yield i.createOffer();i.setLocalDescription(t),yield r.setRemoteDescription(t);const o=yield r.createAnswer(),s=W$.parse(o.sdp);for(let e=0;e<s.media.length;e++)for(let t=0;t<s.media[e].fmtp.length;t++)s.media[e].fmtp[t].config+=";stereo=1;cbr=0;maxaveragebitrate=510000;";o.sdp=W$.write(s),r.setLocalDescription(o),i.setRemoteDescription(o),e.disconnect(),e.connect(n)}catch(e){o(e)}},K$=function(){var t=this,n=arguments;return new Promise((function(i,r){var o=e.apply(t,n);function s(e){Z$(o,i,r,s,a,"next",e)}function a(e){Z$(o,i,r,s,a,"throw",e)}s(void 0)}))},K$.apply(this,arguments)}class $${constructor(e){this._resumeAudioContext=()=>{this.audioContext.resume(),setTimeout((()=>{if("running"===this.audioContext.state){const e=window.APP.store.state.preferences.disableEchoCancellation;AFRAME.utils.device.isMobile()||!/chrome/i.test(navigator.userAgent)||e||X$(this._sceneEl.audioListener.gain),document.body.removeEventListener("touchend",this._resumeAudioContext,!1),document.body.removeEventListener("mouseup",this._resumeAudioContext,!1)}}),0)},this._sceneEl=e,this.audioContext=q$.AudioContext.getContext(),this.audioNodes=new Map,this.mediaStreamDestinationNode=this.audioContext.createMediaStreamDestination(),this.audioDestination=this.audioContext.createMediaStreamDestination(),this.outboundStream=this.mediaStreamDestinationNode.stream,this.outboundGainNode=this.audioContext.createGain(),this.outboundAnalyser=this.audioContext.createAnalyser(),this.outboundAnalyser.fftSize=32,this.analyserLevels=new Uint8Array(this.outboundAnalyser.fftSize),this.outboundGainNode.connect(this.outboundAnalyser),this.outboundAnalyser.connect(this.mediaStreamDestinationNode),this.audioContextNeedsToBeResumed=!1,this.mediaGain=this.audioContext.createGain(),this.mixer={[mh.AVATAR_AUDIO_SOURCE]:this.audioContext.createGain(),[mh.MEDIA_VIDEO]:this.mediaGain,[mh.AUDIO_TARGET]:this.mediaGain,[mh.SFX]:this.audioContext.createGain()},this.mixer[mh.AVATAR_AUDIO_SOURCE].connect(this._sceneEl.audioListener.getInput()),this.mixer[mh.MEDIA_VIDEO].connect(this._sceneEl.audioListener.getInput()),this.mixer[mh.SFX].connect(this._sceneEl.audioListener.getInput()),this.mixerAnalyser=this.audioContext.createAnalyser(),this.mixerAnalyser.fftSize=32,this.mixer[mh.AVATAR_AUDIO_SOURCE].connect(this.mixerAnalyser),this.mixer[mh.MEDIA_VIDEO].connect(this.mixerAnalyser),this.mixer[mh.SFX].connect(this.mixerAnalyser),this._safariMobileAudioInterruptionFix(),document.body.addEventListener("touchend",this._resumeAudioContext,!1),document.body.addEventListener("mouseup",this._resumeAudioContext,!1),this.onPrefsUpdated=this.updatePrefs.bind(this),window.APP.store.addEventListener("statechanged",this.onPrefsUpdated)}addStreamToOutboundAudio(e,t){this.audioNodes.has(e)&&this.removeStreamFromOutboundAudio(e);const n=this.audioContext.createMediaStreamSource(t),i=this.audioContext.createGain();n.connect(i),i.connect(this.outboundGainNode),this.audioNodes.set(e,{sourceNode:n,gainNode:i})}removeStreamFromOutboundAudio(e){if(this.audioNodes.has(e)){const t=this.audioNodes.get(e);t.sourceNode.disconnect(),t.gainNode.disconnect(),this.audioNodes.delete(e)}}addAudio(e){let{sourceType:t,node:n}=e,i=n;Q$(n)&&(n.gain.disconnect(),i=n.gain),i.connect(this.mixer[t])}removeAudio(e){let{node:t}=e,n=t;Q$(t)&&(n=t.gain),n.disconnect()}updatePrefs(){const{globalVoiceVolume:e,globalMediaVolume:t,globalSFXVolume:n}=window.APP.store.state.preferences;let i=t/100;if(this.mixer[mh.MEDIA_VIDEO].gain.setTargetAtTime(i,this.audioContext.currentTime,.2),i=n/100,this.mixer[mh.SFX].gain.setTargetAtTime(i,this.audioContext.currentTime,.2),i=e/100,this.mixer[mh.AVATAR_AUDIO_SOURCE].gain.setTargetAtTime(i,this.audioContext.currentTime,.2),Gx.isAudioOutputSelectEnabled&&APP.mediaDevicesManager){var r;const e=APP.mediaDevicesManager.selectedSpeakersDeviceId,t=e===APP.mediaDevicesManager.defaultOutputDeviceId;if(!this.outputMediaAudio&&t||e===(null===(r=this.outputMediaAudio)||void 0===r?void 0:r.sinkId))return;const n=t?this._sceneEl.audioListener.getInput():this.audioDestination;this.mixer[mh.AVATAR_AUDIO_SOURCE].disconnect(),this.mixer[mh.AVATAR_AUDIO_SOURCE].connect(n),this.mixer[mh.AVATAR_AUDIO_SOURCE].connect(this.mixerAnalyser),this.mixer[mh.MEDIA_VIDEO].disconnect(),this.mixer[mh.MEDIA_VIDEO].connect(n),this.mixer[mh.MEDIA_VIDEO].connect(this.mixerAnalyser),this.mixer[mh.SFX].disconnect(),this.mixer[mh.SFX].connect(n),this.mixer[mh.SFX].connect(this.mixerAnalyser),t?this.outputMediaAudio&&(this.outputMediaAudio.pause(),this.outputMediaAudio.srcObject=null,this.outputMediaAudio=null):(this.outputMediaAudio||(this.outputMediaAudio=new Audio,this.outputMediaAudio.srcObject=this.audioDestination.stream),this.outputMediaAudio.sinkId!==e&&this.outputMediaAudio.setSinkId(e).then((()=>{this.outputMediaAudio.play()})))}}_safariMobileAudioInterruptionFix(){this.audioContext.onstatechange=()=>{console.log(`AudioContext state changed to ${this.audioContext.state}`),"suspended"===this.audioContext.state?(document.getElementById("avatar-rig").messageDispatch.log(RC),document.body.addEventListener("touchend",this._resumeAudioContext,!1),document.body.addEventListener("mouseup",this._resumeAudioContext,!1),this.audioContextNeedsToBeResumed=!0):"running"===this.audioContext.state&&this.audioContextNeedsToBeResumed&&(this.audioContextNeedsToBeResumed=!1,document.getElementById("avatar-rig").messageDispatch.log(DC))}}}var J$=n(99477);const eJ=new J$.Box3,tJ=new J$.Matrix4,nJ=new J$.Box3,iJ=[new J$.Vector3,new J$.Vector3,new J$.Vector3,new J$.Vector3,new J$.Vector3,new J$.Vector3,new J$.Vector3,new J$.Vector3];class rJ{constructor(e){this.sceneEl=e,this.shadowCameraBoundingBox=new J$.Box3,this.previousShadowsEnabled=this.realtimeShadowsEnabled=null,e.renderer.shadowMap.enabled=!1,e.renderer.shadowMap.type=J$.PCFSoftShadowMap,e.renderer.shadowMap.autoUpdate=!0,window.APP.store.addEventListener("statechanged",this.updatePrefs.bind(this)),this.updatePrefs()}updatePrefs(){this.realtimeShadowsEnabled=!0===window.APP.store.state.preferences.enableDynamicShadows&&"low"!==window.APP.store.materialQualitySetting,this.previousShadowsEnabled!==this.realtimeShadowsEnabled&&(this.sceneEl.renderer.shadowMap.enabled=this.realtimeShadowsEnabled,this.sceneEl.hasLoaded&&this.sceneEl.object3D.traverse((e=>{e.receiveShadow&&e.material&&fo(e,(e=>(e.needsUpdate=!0,e)))}))),this.previousShadowsEnabled=this.realtimeShadowsEnabled}tick(){var e,t;this.realtimeShadowsEnabled&&(e=this.sceneEl.object3D,void 0===(t=this.shadowCameraBoundingBox)&&(t=new J$.Box3),t.makeEmpty(),e.updateMatrixWorld(),e.traverse((e=>{const n=e.geometry;n&&e.castShadow&&(n.boundingBox||n.computeBoundingBox(),nJ.copy(n.boundingBox),nJ.applyMatrix4(e.matrixWorld),t.union(nJ))})),nJ.makeEmpty(),this.sceneEl.object3D.traverse((e=>{e.isDirectionalLight&&function(e,t){eJ.makeEmpty();const n=t.min,i=t.max;iJ[0].set(n.x,n.y,n.z),iJ[1].set(n.x,n.y,i.z),iJ[2].set(n.x,i.y,n.z),iJ[3].set(n.x,i.y,i.z),iJ[4].set(i.x,n.y,n.z),iJ[5].set(i.x,n.y,i.z),iJ[6].set(i.x,i.y,n.z),iJ[7].set(i.x,i.y,i.z),e.updateMatrices(),e.target.updateMatrices(),e.shadow.updateMatrices(e),tJ.copy(e.shadow.camera.matrixWorld).invert();for(let e=0;e<iJ.length;e++)iJ[e].applyMatrix4(tJ),eJ.expandByPoint(iJ[e]);const r=e.shadow.camera;r.left=eJ.min.x-1,r.right=eJ.max.x+1,r.bottom=eJ.min.y-1,r.top=eJ.max.y+1,r.near=eJ.min.z+-500,r.far=eJ.max.z+500,r.updateProjectionMatrix()}(e,this.shadowCameraBoundingBox)})))}}class oJ{tick(e,t,n){if(e.is("entered")&&t.get(zm.actions.startInspectingSelf)){const e=document.getElementById("avatar-rig");n.inspect(e,1.5)}}}const sJ=[zm.actions.spawnEmoji0,zm.actions.spawnEmoji1,zm.actions.spawnEmoji2,zm.actions.spawnEmoji3,zm.actions.spawnEmoji4,zm.actions.spawnEmoji5,zm.actions.spawnEmoji6];class aJ{constructor(e){this.scene=e,this.scene.addEventListener("enter-vr",(()=>{if(!document.getElementById("emoji-hud")){const t=document.createElement("a-entity");t.id="emoji-hud",t.setAttribute("emoji-hud",""),e.appendChild(t)}})),this.scene.addEventListener("exit-vr",(()=>{const e=document.getElementById("emoji-hud");e&&e.remove()})),this.lastSpawnedEmoji=0}tick(e,t){if(this.scene.is("entered"))for(let n=0;n<sJ.length;n++)t.get(sJ[n])&&n<tg.length&&window.APP.hubChannel.can("spawn_emoji")&&e-this.lastSpawnedEmoji>1e3&&(this.lastSpawnedEmoji=e,ng(tg[n]))}}var lJ=n(99477);function cJ(e,t){return t||e?t&&!e?t:!t&&e?e:["gain","maxDistance","refDistance","rolloffFactor","coneInnerAngle","coneOuterAngle","coneOuterGain"].reduce(((n,i)=>(void 0!==t[i]&&void 0!==e[i]?n[i]=Math.min(e[i],t[i]):void 0!==t[i]&&void 0===e[i]?n[i]=t[i]:void 0===t[i]&&void 0!==e[i]&&(n[i]=e[i]),n)),{}):{}}function dJ(e,t,n){const i=t.isEnabled()&&t.contains(n),r=e.has(t);i&&!r?e.add(t):!i&&r&&e.delete(t)}function uJ(e,t){return e.size!==t.size||function(e,n){for(const n of e)if(i=n,!t.has(i))return!0;var i;return!1}(e)}const hJ=function(){const e=new lJ.Vector3;return function(t,n,i){t.set(n,e.subVectors(i,n).normalize())}}();function pJ(e){return t=>!e.has(t)}function mJ(e){const t=new lJ.Vector3;return n=>(e.intersectBox(n.getBoundingBox(),t),null!==t)}const fJ=function(){const e=new lJ.Ray;return function(t,n,i,r,o){hJ(e,r,n);const s=Array.from(i).filter((e=>e.data.inOut)).filter(pJ(o)).filter(mJ(e)).map((e=>e.getAudioParams())).reduce(cJ,null),a=Array.from(o).filter((e=>e.data.outIn)).filter(pJ(i)).filter(mJ(e)).map((e=>e.getAudioParams())).reduce(cJ,null);a||s?a&&!s?t.apply(a):!a&&s?t.apply(s):t.apply(Object.assign({},s,a,cJ({gain:a.gain},{gain:s.gain}))):t.restore()}}();class gJ{constructor(){this.tick=function(){const e=new lJ.Vector3;return function(t){if(!t.is("entered"))return;this.didRegisterAudioListener||(this.didRegisterAudioListener=!0,this.registerEntity(t.audioListener));const n=this.currZones.get(t.audioListener);t.audioListener.getWorldPosition(e),this.zones.forEach((t=>{dJ(n,t,e),this.sources.forEach((e=>{dJ(this.currZones.get(e),t,e.getPosition())}))}));const i=uJ(n,this.prevZones.get(t.audioListener));this.sources.filter((e=>i||uJ(this.currZones.get(e),this.prevZones.get(e)))).forEach((t=>{fJ(t,t.getPosition(),this.currZones.get(t),e,n)})),this.entities.forEach((e=>{const t=this.prevZones.get(e);t.clear(),this.currZones.get(e).forEach((e=>t.add(e)))}))}}(),this.zones=[],this.sources=[],this.entities=[],this.currZones=new Map,this.prevZones=new Map,this.didRegisterAudioListener=!1}registerZone(e){this.zones.push(e)}unregisterZone(e){this.zones.splice(this.zones.indexOf(e),1),this.entities.forEach((t=>{this.currZones.get(t).delete(e)}))}registerSource(e){this.sources.push(e),this.registerEntity(e)}unregisterSource(e){this.sources.splice(this.sources.indexOf(e),1),this.unregisterEntity(e)}registerEntity(e){this.entities.push(e),this.currZones.set(e,new Set),this.prevZones.set(e,new Set)}unregisterEntity(e){this.entities.splice(this.entities.indexOf(e),1),this.currZones.delete(e),this.prevZones.delete(e)}}var vJ=n(99477);const bJ={linear:function(e,t,n,i){return 1-t*((e-n)/(i-n))},inverse:function(e,t,n){return n/(n+t*(Math.max(e,n)-n))},exponential:function(e,t,n){return Math.pow(Math.max(e,n)/n,-t)}},yJ=(()=>{const e=new vJ.Vector3,t=new vJ.Vector3;return(n,i)=>{APP.audioListener.getWorldPosition(e),i.getWorldPosition(t);const r=t.distanceTo(e);if(i.panner)return bJ[i.panner.distanceModel](r,i.panner.rolloffFactor,i.panner.refDistance,i.panner.maxDistance);{const{distanceModel:e,rolloffFactor:t,refDistance:i,maxDistance:o}=nm(n);return e?bJ[e]?bJ[e](r,t,i,o):(console.error("Unrecognized distance model."),1):1}}})();class wJ{tick(){const{enableAudioClipping:e,audioClippingThreshold:t}=window.APP.store.state.preferences;for(const[n,i]of APP.audios.entries()){const r=yJ(n,i);om(n,i)?(APP.supplementaryAttenuation.set(n,r),rm(n,i)):APP.supplementaryAttenuation.has(n)&&(APP.supplementaryAttenuation.delete(n),rm(n,i));const o=e&&r<t;APP.clippingState.has(n)!==o&&(o?APP.clippingState.add(n):APP.clippingState.delete(n),rm(n,i))}}}var _J=n(13659),EJ=n(25424),AJ=n.p+"assets/blender-lut-e6acb8ca8505336d09c6..cube",SJ=n(99477);function xJ(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function MJ(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?xJ(Object(n),!0).forEach((function(t){PJ(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):xJ(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function PJ(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const CJ={None:"NoToneMapping",Linear:"LinearToneMapping",Reinhard:"ReinhardToneMapping",Cineon:"CineonToneMapping",ACESFilmic:"ACESFilmicToneMapping",CustomToneMapping:"CustomToneMapping",LUTToneMapping:"LUTToneMapping"},kJ={LinearEncoding:"LinearEncoding",sRGBEncoding:"sRGBEncoding",GBEEncoding:"GBEEncoding",GBM7Encoding:"GBM7Encoding",GBDEncoding:"GBDEncoding",BasicDepthPacking:"BasicDepthPacking",GBADepthPacking:"GBADepthPackig"},OJ={toneMapping:CJ.Linear,outputEncoding:kJ.sRGBEncoding,toneMappingExposure:1,physicallyCorrectLights:!0,envMapTexture:null,skybox:null,backgroundTexture:null,backgroundColor:new SJ.Color("#000000"),fogType:null,fogColor:new SJ.Color("#ffffff"),fogDensity:25e-5,fogFar:1e3,fogNear:1,enableHDRPipeline:!1,enableBloom:!1,bloom:{threshold:1,intensity:1,radius:.6,smoothing:.025}};let TJ;class RJ{constructor(e){this.scene=e.object3D,this.renderer=e.renderer,this.pmremGenerator=new SJ.PMREMGenerator(this.renderer),this.applyEnvSettings(OJ),(0,z.Z)("envSettingsDebug")&&this.setupDebugView()}setupDebugView(){const e=MJ({},OJ),t=()=>{this.applyEnvSettings(e),this.debugUpdateUI()},n=new _J.XS({title:"Environment Settings"}),i=n.add(e,"toneMapping",Object.values(CJ)).onChange(t).listen();i.enable(!e.enableHDRPipeline),n.add(e,"toneMappingExposure",0,4,.01).onChange(t).listen(),n.add(e,"outputEncoding",Object.values(kJ)).onChange(t).listen(),n.add(e,"physicallyCorrectLights").onChange(t).listen(),n.add(e,"enableHDRPipeline").onChange(t).listen();const r=n.add(e,"enableBloom").onChange(t).listen();r.enable(e.enableHDRPipeline);const o=n.addFolder("bloom");o.show(e.enableHDRPipeline&&e.enableBloom),o.add(e.bloom,"intensity",0,10,.01).onChange(t).listen(),o.add(e.bloom,"threshold",0,10,.001).onChange(t).listen(),o.add(e.bloom,"radius",0,1,.001).onChange(t).listen(),o.add(e.bloom,"smoothing",0,1,.001).onChange(t).listen(),n.open(),this.debugGui=n,this.debugSettings=e,this.debugMode=!0,this.debugUpdateUI=function(){r.enable(e.enableHDRPipeline),i.enable(!e.enableHDRPipeline),o.show(e.enableHDRPipeline&&e.enableBloom)},window.$E=this}updateEnvironmentSettings(e){const t=MJ(MJ({},OJ),e);this.applyEnvSettings(t)}updateEnvironment(e){var t;const n=e.querySelector("[environment-settings]"),i=e.querySelector("[skybox]"),r=e.querySelector("[nav-mesh]"),o=MJ(MJ({},OJ),{},{skybox:null==i||null===(t=i.components.skybox)||void 0===t?void 0:t.sky});n&&Object.assign(o,n.components["environment-settings"].data);const s=null==r?void 0:r.object3D.getObjectByProperty("isMesh",!0);s&&AFRAME.scenes[0].systems.nav.loadMesh(s,r.components["nav-mesh"].data.zone),e.object3D.traverse((e=>{e.isMesh&&(e.reflectionProbeMode="static")})),this.applyEnvSettings(o)}applyEnvSettings(e){var t;if(this.debugSettings){const t=this.debugSettings.bloom;Object.assign(this.debugSettings,e),e.bloom&&(Object.assign(t,e.bloom),this.debugSettings.bloom=t),this.debugUpdateUI()}let n=!1;this.debugMode&&console.log("Applying environment settings",e),this.renderer.physicallyCorrectLights!==e.physicallyCorrectLights&&(this.renderer.physicallyCorrectLights=e.physicallyCorrectLights,n=!0);let i=SJ[e.toneMapping];if(APP.fx.composer)if(e.enableHDRPipeline){var r;if(i=wt.NoToneMapping,APP.fx.bloomAndTonemapPass&&(APP.fx.bloomAndTonemapPass.enabled=e.enableBloom,e.enableBloom)){const t=APP.fx.bloomAndTonemapPass.effects[0];t.intensity=e.bloom.intensity,t.luminanceMaterial.threshold=e.bloom.threshold,t.mipmapBlurPass.radius=e.bloom.radius,t.luminanceMaterial.smoothing=e.bloom.smoothing}APP.fx.tonemapOnlyPass.enabled=!(null!==(r=APP.fx.bloomAndTonemapPass)&&void 0!==r&&r.enabled)}else APP.fx.tonemapOnlyPass.enabled=!1,APP.fx.bloomAndTonemapPass&&(APP.fx.bloomAndTonemapPass.enabled=!1);this.renderer.toneMapping!==i&&(this.renderer.toneMapping=i,n=!0,i===SJ.LUTToneMapping?(TJ||(TJ=new Promise((function(e,t){(new EJ.X).load(AJ,(t=>{let{texture3D:n}=t;return e(n)}),null,t)}))),TJ.then((e=>{this.renderer.tonemappingLUT=e})).catch((function(e){console.error("Error loading Blender LUT",e),TJ=null}))):this.renderer.tonemappingLUT=null),this.renderer.toneMappingExposure=e.toneMappingExposure;const o=SJ[e.outputEncoding];this.renderer.outputEncoding!==o&&(this.renderer.outputEncoding=o,n=!0),this.scene.remove(window.lp),e.backgroundTexture?(e.backgroundTexture.mapping=SJ.EquirectangularReflectionMapping,this.scene.background=e.backgroundTexture):this.scene.background=e.backgroundColor,e.envMapTexture?this.prevEnvMapTextureUUID!==e.envMapTexture.uuid&&(this.prevEnvMapTextureUUID=e.envMapTexture.uuid,e.envMapTexture.flipY=!0,e.envMapTexture.mapping=SJ.EquirectangularReflectionMapping,this.scene.environment=e.envMapTexture):e.skybox?this.prevEnvMapTextureUUID!==e.skybox.uuid&&(this.prevEnvMapTextureUUID=e.skybox.uuid,this.scene.environment=e.skybox.generateEnvironmentMap(this.renderer)):(this.scene.environment=null,this.prevEnvMapTextureUUID=null),(null===(t=this.scene.fog)||void 0===t?void 0:t.name)!==e.fogType?("linear"===e.fogType?this.scene.fog=new SJ.Fog(e.fogColor,e.fogNear,e.fogFar):"exponential"===e.fogType?this.scene.fog=new SJ.FogExp2(e.fogColor,e.fogDensity):this.scene.fog=null,n=!0):e.fogType&&(this.scene.fog.color.copy(e.fogColor),"linear"===e.fogType?(this.scene.fog.near=e.fogNear,this.scene.fog.far=e.fogFar):"exponential"===e.fogType&&(this.scene.fog.density=e.fogDensity)),n&&(this.debugMode&&console.log("materials need updating"),this.scene.traverse((e=>{e.material&&(e.material.needsUpdate=!0)})))}}AFRAME.registerComponent("nav-mesh",{schema:{zone:{default:"character"}}}),AFRAME.registerComponent("environment-settings",{schema:{toneMapping:{default:OJ.toneMapping,oneOf:Object.values(CJ)},toneMappingExposure:{default:OJ.toneMappingExposure},backgroundColor:{type:"color",default:OJ.background},fogType:{type:"string",default:OJ.fogType},fogColor:{type:"color",default:OJ.fogColor},fogDensity:{type:"number",default:OJ.fogDensity},fogNear:{type:"number",default:OJ.fogNear},fogFar:{type:"number",default:OJ.fogFar}}}),AFRAME.registerComponent("reflection-probe",{schema:{size:{default:1},envMapTexture:{type:"map"}},init:function(){this.el.object3D.updateMatrices();const e=(new SJ.Box3).setFromCenterAndSize(new SJ.Vector3,(new SJ.Vector3).setScalar(2*this.data.size)).applyMatrix4(this.el.object3D.matrixWorld);if(this.el.setObject3D("probe",new SJ.ReflectionProbe(e,this.data.envMapTexture)),this.el.sceneEl.systems["hubs-systems"].environmentSystem.debugMode){const e=(new SJ.Box3).setFromCenterAndSize(new SJ.Vector3,(new SJ.Vector3).setScalar(2*this.data.size));this.el.setObject3D("helper",new SJ.Box3Helper(e,new SJ.Color(Math.random(),Math.random(),Math.random())))}}});var DJ=n(99477);class jJ{constructor(e){this.tick=function(){const e=new DJ.Vector3,t=new DJ.Vector3;return function(){this.avatarRig.getWorldPosition(t),this.components.forEach((n=>{if("showSpeaking"===this.nametagVisibility){const e=Date.now();!n.isTalking&&n.wasTalking?e-n.lastUpdateTime>3e3&&(n.shouldBeVisible=!1):n.isTalking&&!n.wasTalking?(n.lastUpdateTime=Date.now(),n.shouldBeVisible=!0):n.isTalking||n.wasTalking||e-n.lastUpdateTime>3e3&&(n.shouldBeVisible=!1)}else"showFrozen"===this.nametagVisibility?n.shouldBeVisible=this.sceneEl.is("frozen"):"showNone"===this.nametagVisibility?n.shouldBeVisible=!1:"showClose"===this.nametagVisibility?n.ikRoot&&(n.ikRoot.getWorldPosition(e),n.shouldBeVisible=e.sub(t).lengthSq()<this.nametagVisibilityDistance):n.shouldBeVisible=!0}))}}(),this.sceneEl=e,this.store=window.APP.store,this.components=[],this.lastUpdateTime=Date.now(),this.tick=this.tick.bind(this),this.onStateChanged=this.onStateChanged.bind(this),this.nametagVisibility=D()?"showNone":this.store.state.preferences.nametagVisibility,this.nametagVisibilityDistance=Math.pow(this.store.state.preferences.nametagVisibilityDistance,2),L().then((()=>{this.avatarRig=document.getElementById("avatar-rig").object3D})),window.APP.store.addEventListener("statechanged",this.onStateChanged)}register(e){this.components.push(e)}unregister(e){this.components.splice(this.components.indexOf(e),1)}onStateChanged(){this.nametagVisibilityDistance=Math.pow(this.store.state.preferences.nametagVisibilityDistance,2),this.nametagVisibility=D()?"showNone":this.store.state.preferences.nametagVisibility}}let LJ=0;const IJ=(0,Ot.defineQuery)([Dt,Rt]),NJ=(0,Ot.enterQuery)(_r),FJ=(0,Ot.enterQuery)(IJ),BJ=(0,Ot.exitQuery)(_r),VJ=new Map;const UJ=new Map,HJ=(0,Ot.exitQuery)((0,Ot.defineQuery)([gn,Dt])),zJ=(0,Ot.exitQuery)((0,Ot.defineQuery)([Dt])),WJ=(0,Ot.defineQuery)([jt]),qJ=(0,Ot.exitQuery)((0,Ot.defineQuery)([Dt])),ZJ=[fn,un,hn,pn,mn],GJ={type:"kinematic",collisionFilterMask:Ue.UNOWNED_INTERACTABLE};function YJ(e,t,n,i){n(e).forEach((t=>(0,Ot.removeComponent)(e,i,t)));const r=function(e,t){const n=AFRAME.scenes[0].systems["hubs-systems"].physicsSystem;if(!(0,Ot.hasComponent)(e,Ln,t))return;const i=n.getCollisions(Ln.bodyId[t]);if(i)for(let t=0;t<i.length;t++){const r=n.bodyUuidToData.get(i[t]),o=r&&r.object3D;if(o&&(0,Ot.hasComponent)(e,En,o.eid))return o.eid}return null}(e,t);r&&(0,Ot.addComponent)(e,i,r)}const QJ=(0,Ot.defineQuery)([ln]),XJ=(0,Ot.defineQuery)([an]),KJ=zm.actions.cursor.right.grab,$J=zm.actions.cursor.right.drop,JJ=zm.actions.cursor.left.grab,e0=zm.actions.cursor.left.drop,t0=zm.actions.rightHand.grab,n0=zm.actions.rightHand.drop,i0=zm.actions.leftHand.grab,r0=zm.actions.leftHand.drop;function o0(e,t,n,i,r){const o=n(e)[0];o&&t.get(r)&&(!(0,Ot.hasComponent)(e,Fn,o)||AFRAME.scenes[0].is("frozen"))&&function(e,t){return!(0,Ot.hasComponent)(e,Ut,t)||function(e){const t=e.components.pinnable&&e.components.pinnable.data.pinned,n="#interactable-pen"===(e&&e.components.networked&&e.components.networked.data.template),i="#interactable-emoji"===(e&&e.components["super-spawner"]&&e.components["super-spawner"].data.template),r=!!e.components.emoji;return(0,Ot.hasComponent)(APP.world,Pn,e.eid)||(r||i?window.APP.hubChannel.can("spawn_emoji"):window.APP.hubChannel.can("spawn_and_move_media"))&&(!t||window.APP.hubChannel.can("pin_objects"))&&(!n||window.APP.hubChannel.can("spawn_drawing"))}(e.eid2obj.get(t).el)}(e,o)&&((0,Ot.addComponent)(e,i,o),(0,Ot.addComponent)(e,fn,o))}function s0(e,t,n,i,r){const o=n(e)[0];o&&t.get(r)&&((0,Ot.removeComponent)(e,i,o),(0,Ot.hasComponent)(e,pn,o)||(0,Ot.hasComponent)(e,mn,o)||(0,Ot.hasComponent)(e,un,o)||(0,Ot.hasComponent)(e,hn,o)||(0,Ot.removeComponent)(e,fn,o))}const a0=(0,Ot.defineQuery)([Jt,pn]),l0=(0,Ot.defineQuery)([Jt,cn]),c0=(0,Ot.defineQuery)([Jt,mn]),d0=(0,Ot.defineQuery)([Jt,dn]),u0=(0,Ot.defineQuery)([Jt,un]),h0=(0,Ot.defineQuery)([Jt,an]),p0=(0,Ot.defineQuery)([Jt,hn]),m0=(0,Ot.defineQuery)([Jt,ln]);function f0(e,t,n){for(let i=0;i<t.length;i++){const r=t[i];(0,Ot.removeComponent)(e,n,r)}}const g0=(0,Ot.defineQuery)([cn,pn]),v0=(0,Ot.defineQuery)([dn,mn]),b0=(0,Ot.defineQuery)([an,un]),y0=(0,Ot.defineQuery)([ln,hn]),w0=(0,Ot.defineQuery)([un,pn]),_0=(0,Ot.defineQuery)([hn,mn]),E0=(0,Ot.defineQuery)([an,cn]),A0=(0,Ot.defineQuery)([ln,dn]);const S0=(0,Ot.defineQuery)([en,tn]),x0=oi.audios,M0=oi.params;function P0(e){return void 0!==e.panner}function C0(e,t,n,i){const r=e.eid2obj.get(n);r.disconnect(),APP.sourceType.set(n,mh.MEDIA_VIDEO),APP.supplementaryAttenuation.delete(n),APP.audios.delete(n),t.removeAudio({node:r});const o=new i(APP.audioListener);o.setNodeSource(r.source),t.addAudio({sourceType:mh.MEDIA_VIDEO,node:o}),APP.audios.set(n,o),r.parent.add(o),r.removeFromParent(),function(e,t,n){if(!(0,Ot.hasComponent)(e,Ht,t))throw new Error("Tried to swap Object3D aon an entity that does not have the object3D tag");e.eid2obj.get(t).eid=0,e.eid2obj.set(t,n),n.eid=t}(e,n,o)}function k0(e,t,n,i){const r=(0,Ot.addEntity)(e);let o;APP.sourceType.set(r,n);const{audioType:s}=nm(r),a=APP.audioListener;if(o=s===fh.PannerNode?new wt.PositionalAudio(a):new wt.Audio(a),n===mh.MEDIA_VIDEO){const n=e.eid2obj.get(t).material.map.image;n.paused?APP.isAudioPaused.add(r):APP.isAudioPaused.delete(r);const i=n;o.setMediaElementSource(i),i.volume=1,o.gain.gain.value=0}return(0,Ot.addComponent)(e,oi,r),Oh(e,r,o),i.addAudio({sourceType:n,node:o}),APP.audios.set(r,o),rm(r,o),r}const O0=(0,Ot.defineQuery)([oi,si]);var T0="precision highp float;\nprecision highp int;\n\nvarying vec2 vUv;\nvarying vec3 vNormal;\nvoid main()\n{\n  vNormal=normalize(normal);\n  gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.);\n  vUv=(modelMatrix*vec4(position,1.)).xz;\n}",R0="// Based on: https://www.shadertoy.com/view/Mll3D4#\n\nprecision highp float;\nprecision highp int;\n\nvarying vec2 vUv;\nvarying vec3 vNormal;\nuniform float time;\n\nconst int LINEAR = 0;\nconst int INVERSE = 1;\nconst int EXPONENTIAL = 2;\n        \nuniform vec3 colorInner;\nuniform vec3 colorOuter;\nuniform vec3 colorGain;\nuniform int count;\nuniform vec3 sourcePosition[MAX_DEBUG_SOURCES];\nuniform vec3 sourceOrientation[MAX_DEBUG_SOURCES];\nuniform float maxDistance[MAX_DEBUG_SOURCES];\nuniform float refDistance[MAX_DEBUG_SOURCES];\nuniform float rolloffFactor[MAX_DEBUG_SOURCES];\nuniform int distanceModel[MAX_DEBUG_SOURCES];\nuniform float coneInnerAngle[MAX_DEBUG_SOURCES];\nuniform float coneOuterAngle[MAX_DEBUG_SOURCES];\nuniform float gain[MAX_DEBUG_SOURCES];\nuniform bool clipped[MAX_DEBUG_SOURCES];\n\nconst float kPi = 3.141592;\nconst float kDegToRad = kPi / 180.0;\nconst float kInvPi = 1.0 / 3.141592;\nconst float kRefDistWidth = 0.05;\n\nfloat distance[MAX_DEBUG_SOURCES];\nvec2 center[MAX_DEBUG_SOURCES];\nfloat startOffset[MAX_DEBUG_SOURCES];\nfloat clampedGain[MAX_DEBUG_SOURCES];\n\nfloat att_linear(float x, float rolloff, float dref, float dmax) {\n  return 1.0-(rolloff*((x-dref)/(dmax-dref)));\n}\n\nfloat att_inverse(float x, float rolloff, float dref) {\n  return dref/(dref+(rolloff*(max(x, dref)-dref)));\n}\n\nfloat att_exponential(float x, float rolloff, float dref) {\n  return pow((max(x, dref)/dref),-rolloff);\n}\n\nvec4 circle(vec2 center, float d, float len, float radius, float holeRadius, vec3 color, float offset) {  \n  // Define how blurry the circle should be. \n  // A value of 1.0 means 'sharp', larger values\n  // will increase the bluriness.\n  float bluriness = 1.0;\n  \n  // Calculate angle, so we can draw segments, too.\n  float angle = atan( center.x, center.y ) * kInvPi * 0.5;\n  angle = fract( angle + offset);\n  \n  // Create an anti-aliased circle.\n  float wd = bluriness * fwidth( d );\n  float circle = smoothstep( radius + wd, radius - wd, d );\n  \n  // Optionally, you could create a hole in it:\n  float inner = holeRadius;\n  circle -= smoothstep( inner + wd, inner - wd, d );\n  \n  // Or only draw a portion (segment) of the circle.\n  float wa = bluriness * fwidth( angle );\n  float segment = smoothstep( len + wa, len - wa, angle );\n  segment *= smoothstep( 0.0, 2.0 * wa, angle );\n  circle *= mix( segment, 1.0, step( 1.0, len ) );\n      \n  // Let's define the circle's color now.\n  vec3 rgb = color * circle;\n  \n  // Output final color.\n  return vec4( rgb, circle);\n}\n\nfloat att(float d, float maxDistance, float refDistance, float rolloffFactor, int distanceModel) {\n  // Calculate attenuation\n  float attenuation = 1.0;\n  if (distanceModel == LINEAR) {\n    attenuation = att_linear(d, rolloffFactor, refDistance, maxDistance);\n  } else if (distanceModel == INVERSE) {\n    attenuation = att_inverse(d, rolloffFactor, refDistance);\n  } else if (distanceModel == EXPONENTIAL) {\n    attenuation = att_exponential(d, rolloffFactor, refDistance);\n  }\n  return clamp(attenuation, 0.0, 1.0);\n}\n\nvec4 draw_att(float d, float attenuation, vec4 circle) {\n  // Waves\n  float v = sin((d * 2.0 * kPi) - (time * 0.005)) + 1.0;\n  float waves = circle.a * attenuation * v;\n  \n  // Output final color.\n  return vec4( circle.rgb, waves );\n}\n\nvoid main() {\n  // Draw background\n  vec4 background = vec4(1.0, 1.0, 1.0, 0.0);\n\n  for (int i=0; i<count; i++) {\n    center[i] = sourcePosition[i].xz - vUv;\n\n    // Calculate distance to (0,0).\n    distance[i] = length( center[i] );\n\n    // Optional start Offset.\n    vec2 orientation = normalize(sourceOrientation[i].xz);\n    float ang = atan(-orientation.x, orientation.y) * kInvPi * 0.5;\n    // Rotate to start drawing facing front\n    ang -= 0.5;\n    startOffset[i] = mod(ang, 1.0);\n\n    // Gain\n    clampedGain[i] = clamp(gain[i], 0.0, 1.0);\n  }\n\n  for (int i=0; i<count; i++) {\n    float attenuation = att(distance[i], maxDistance[i], refDistance[i], rolloffFactor[i], distanceModel[i]);\n\n    // Draw inner cone\n    float innerAngle = coneInnerAngle[i] * kDegToRad * kInvPi * 0.5;\n    float innerStartAngle = startOffset[i] + innerAngle * 0.5;\n    vec4 innerLayer = circle(center[i], distance[i], innerAngle, 10000.0, 1.0, colorInner, innerStartAngle);\n    innerLayer = draw_att(distance[i], attenuation, innerLayer);\n    background = mix(background, innerLayer, innerLayer.a * clampedGain[i]);\n\n    // Draw outer cone\n    float outerAngle = coneOuterAngle[i] * kDegToRad * kInvPi * 0.5;\n    float outerAngleDiffHalf = (outerAngle - innerAngle) * 0.5;\n    vec4 outerLayer1 = circle(center[i], distance[i], outerAngleDiffHalf, 10000.0, 1.0, colorOuter, innerStartAngle + outerAngleDiffHalf);\n    outerLayer1 = draw_att(distance[i], attenuation, outerLayer1);\n    background = mix(background, outerLayer1, outerLayer1.a * clampedGain[i]);\n    vec4 outerLayer2 = circle(center[i], distance[i], outerAngleDiffHalf, 10000.0, 1.0, colorOuter, innerStartAngle - innerAngle);\n    outerLayer2 = draw_att(distance[i], attenuation, outerLayer2);\n    background = mix(background, outerLayer2, outerLayer2.a * (clipped[i] ? 0.0 : 1.0) * clampedGain[i]);\n  }\n\n  for (int i=0; i<count; i++) {\n    // Draw base\n    vec4 baseLayer = circle(center[i], distance[i], 1.0, 1.0, 0.1, vec3(0.5, 0.5, 0.5), 0.0);\n    background = mix(background, baseLayer, baseLayer.a);\n\n    // Draw gain\n    vec4 gainLayer = circle(center[i], distance[i], clampedGain[i], 1.0, 0.5, colorGain, startOffset[i]);\n    background = mix(background, gainLayer, gainLayer.a);\n    if (gain[i] > 1.0) {\n      vec4 overGainLayer = circle(center[i], distance[i], gain[i] -  clampedGain[i], 1.0, 0.5, vec3(1.0, 0.0, 0.0), startOffset[i]);\n      background = mix(background, overGainLayer, overGainLayer.a);\n    }\n  } \n  \n  // Blend\n  gl_FragColor = vec4(background.rgb, background.a * vNormal.y);\n}";[["remote-right",on],["remote-left",sn],["hand-right",nn],["hand-left",rn],["is-remote-hover-target",Kt],["is-not-remote-hover-target",$t],["remove-networked-object-button",en],["destroy-at-extreme-distances",Bn],["billboard",Ei]].forEach((e=>{let[t,n]=e;AFRAME.registerComponent(t,{init:function(){(0,Ot.addComponent)(APP.world,n,this.el.object3D.eid)},remove:function(){(0,Ot.removeComponent)(APP.world,n,this.el.object3D.eid)}})}));var D0=n(32248);let j0;const L0=new Promise((e=>{j0=e}));function I0(){return L0}var N0=n(99477);const F0={distanceModel:gh.Inverse,maxDistance:0,refDistance:0,rolloffFactor:0,coneInnerAngle:0,coneOuterAngle:0};let B0,V0,U0=!1,H0=!1,z0=64;const W0=new Map,q0=()=>{U0&&(B0||(B0={sourcePositions:new Array(z0).fill(new wt.Vector3),sourceOrientations:new Array(z0).fill(new wt.Vector3),distanceModels:new Array(z0).fill(0),maxDistances:new Array(z0).fill(0),refDistances:new Array(z0).fill(0),rolloffFactors:new Array(z0).fill(0),coneInnerAngles:new Array(z0).fill(0),coneOuterAngles:new Array(z0).fill(0),gains:new Array(z0).fill(0),clipped:new Array(z0).fill(0)}),V0||(V0=new N0.ShaderMaterial({uniforms:{time:{value:0},colorInner:{value:new N0.Color("#7AFF59")},colorOuter:{value:new N0.Color("#FF6340")},colorGain:{value:new N0.Color("#70DBFF")},count:{value:0},maxDistance:{value:[]},refDistance:{value:[]},rolloffFactor:{value:[]},distanceModel:{value:[]},sourcePosition:{value:[]},sourceOrientation:{value:[]},coneInnerAngle:{value:[]},coneOuterAngle:{value:[]},gain:{value:[]},clipped:{value:[]}},vertexShader:T0,fragmentShader:R0}),V0.side=N0.DoubleSide,V0.transparent=!0,V0.uniforms.count.value=0,V0.defines.MAX_DEBUG_SOURCES=z0))};I0().then((()=>{if(Pt(APP.scene.renderer)<"2.0")H0=!0;else{const e=APP.scene.renderer.getContext(),t=e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS);z0=Math.min(Math.floor(t/10),z0)}H0||(APP.store.addEventListener("statechanged",(()=>{U0=APP.store.state.preferences.showAudioDebugPanel,U0&&q0(),(0,Ot.defineQuery)([Qn])(APP.world).forEach((e=>{H0||(U0?Z0(APP.world,e):G0(APP.world,e))})),!U0&&V0&&(xo(V0),V0=null)})),U0=APP.store.state.preferences.showAudioDebugPanel,U0&&q0())}));const Z0=(e,t)=>{if(W0.has(t))return;const n=e.eid2obj.get(t);if(n){const e=n;e.visible=U0,W0.set(t,e.material),e.material=V0,e.material.needsUpdate=!0,e.geometry.computeVertexNormals()}},G0=(e,t)=>{if(!W0.has(t))return;const n=e.eid2obj.get(t);if(n){const e=n;e.visible=!1,e.material=W0.get(t),W0.delete(t),e.material.needsUpdate=!0,e.geometry.computeVertexNormals()}},Y0=new N0.Vector3,Q0=new N0.Vector3,X0=(0,Ot.defineQuery)([Qn]),K0=(0,Ot.enterQuery)(X0),$0=(0,Ot.exitQuery)(X0);function J0(e,t){const n=(0,Ot.exitQuery)((0,Ot.defineQuery)([e]));return function(e){n(e).forEach((n=>t(e.eid2obj.get(n))))}}function e1(e,t){const n=(0,Ot.exitQuery)((0,Ot.defineQuery)([e]));return function(e){n(e).forEach((e=>t(e)))}}const t1=J0(Bt,(e=>e.geometry.dispose())),n1=J0(zt,(e=>{e.userData.gltfCacheKey?ha.release(e.userData.gltfCacheKey):e.dispose()})),i1=J0(Wt,(e=>e.dispose())),r1=J0(Nt,(e=>e.dispose())),o1=J0(It,(e=>e.geometry.dispose())),s1=J0(oi,(e=>function(e){var t;const n=e.eid;e.disconnect();const i=null===(t=APP.scene)||void 0===t?void 0:t.systems["hubs-systems"].audioSystem;APP.audios.delete(n),APP.supplementaryAttenuation.delete(n),APP.audioOverrides.delete(n),i.removeAudio({node:e})}(e))),a1=J0(Kn,(e=>{Oc(APP.getString(Kn.cacheKey[e.eid])),e.geometry.dispose()})),l1=J0(ei,(e=>{xo(e.material),e.geometry.dispose()})),c1=e1(li,(e=>{li.map.delete(e)})),d1=J0(wi,(e=>{xo(e.sky.material),e.sky.geometry.dispose()})),u1=J0(Pi,(e=>{e.geometry.dispose(),mo(e.material,(e=>e.dispose()))})),h1=J0(Ci,(e=>e.dispose())),p1=J0(ki,(e=>Mo(e))),m1=e1(Qn,(e=>{return t=e,G0(APP.world,t);var t})),f1=(0,Ot.exitQuery)((0,Ot.defineQuery)([Ht])),g1=(0,Ot.exitQuery)((0,Ot.defineQuery)([Ai]));var v1=n(99477);const b1=(0,Ot.defineQuery)([Vt]),y1=new v1.Vector3,w1=new v1.Quaternion;var _1=n(99477);function E1(e,t,n,i){if(AFRAME.scenes[0].systems.userinput.get(n))for(let n=0;n<t.length;n++){const r=t[n];(0,Ot.addComponent)(e,tn,r),e.eid2obj.get(r).dispatchEvent({type:"interact",object3D:i})}}const A1=(0,Ot.defineQuery)([tn]),S1=(0,Ot.defineQuery)([Cn,cn]),x1=(0,Ot.defineQuery)([Cn,dn]),M1={};function P1(){M1[Vh.DEFAULT]={color:new _1.Color(16777215),hoverColor:new _1.Color(11184810),textColor:new _1.Color(gt("action-color")),textHoverColor:new _1.Color(gt("action-color-highlight"))},M1[Vh.ACTION]={color:new _1.Color(gt("action-color")),hoverColor:new _1.Color(gt("action-color-highlight")),textColor:new _1.Color(16777215),textHoverColor:new _1.Color(16777215)}}bt(P1),P1();const C1=[cn,dn,an,ln],k1=(0,Ot.defineQuery)([xn]),{DISABLE_DEACTIVATION:O1,ACTIVE_TAG:T1}=Na.tl.ACTIVATION_STATE,R1=(0,Ot.defineQuery)([pn,_n]),D1=(0,Ot.enterQuery)(R1),j1=(0,Ot.exitQuery)(R1),L1=(0,Ot.defineQuery)([mn,_n]),I1=(0,Ot.enterQuery)(L1),N1=(0,Ot.exitQuery)(L1),F1=(0,Ot.defineQuery)([un,An]),B1=(0,Ot.enterQuery)(F1),V1=(0,Ot.exitQuery)(F1),U1=(0,Ot.defineQuery)([hn,An]),H1=(0,Ot.enterQuery)(U1),z1=(0,Ot.exitQuery)(U1),W1={type:"dynamic",activationState:O1},q1={activationState:T1};function Z1(e,t,n,i,r){for(let o=0;o<r.length;o++){const s=Go(e,r[o],(t=>(0,Ot.hasComponent)(e,Ln,t)));Id(e,s),t.updateBodyOptions(Ln.bodyId[s],W1),t.addConstraint(n,Ln.bodyId[s],Ln.bodyId[n],{}),(0,Ot.addComponent)(e,gn,s),(0,Ot.addComponent)(e,i,s)}}function G1(e,t,n,i,r,o){for(let s=0;s<o.length;s++){const a=Go(e,o[s],(t=>(0,Ot.hasComponent)(e,Ln,t)));(0,Ot.entityExists)(e,a)&&(0,Ot.hasComponent)(e,t,o[s])&&(0,Ot.hasComponent)(e,Ln,a)&&(i.updateBodyOptions(Ln.bodyId[a],q1),i.removeConstraint(r),(0,Ot.removeComponent)(e,n,a),(0,Ot.hasComponent)(e,bn,a)||(0,Ot.hasComponent)(e,vn,a)||(0,Ot.hasComponent)(e,wn,a)||(0,Ot.hasComponent)(e,yn,a)||(0,Ot.removeComponent)(e,gn,a))}}var Y1=n(99477);const Q1=(0,Ot.defineQuery)([It]),X1=(0,Ot.enterQuery)(Q1),K1=(0,Ot.exitQuery)(Q1);function $1(e,t){if(!(0,Ot.hasComponent)(e,Ut,t))return 0;const n=e.eid2obj.get(t).el;let i=0;return i|=n.components["gltf-model-plus"]&&Ml.MODEL,i|=n.components["media-video"]&&Ml.VIDEO,i|=n.components["media-image"]&&Ml.IMAGE,i|=n.components["media-pdf"]&&Ml.PDF,i}function J1(e,t){let n=t.parent;for(;n;){if(n===e)return!0;n=n.parent}return!1}function e2(e,t){if((0,Ot.hasComponent)(e,Ut,t)){const n=e.eid2obj.get(t).el;return"scene"===NAF.utils.getNetworkOwner(n)}return Rt.owner[t]===APP.getSid("reticulum")}function t2(e,t,n){const i=Q1(e);for(const e of i)if(e!==t&&(It.capturedNid[e]===Rt.id[n]||It.previewingNid[e]===Rt.id[n]))return!0;return!1}function n2(e,t){const n=AFRAME.scenes[0].systems["hubs-systems"].physicsSystem,i=n.getCollisions(Ln.bodyId[t]),r=e.eid2obj.get(t);for(let o=0;o<i.length;o++){const s=n.bodyUuidToData.get(i[o]),a=s.object3D.eid;if(It.mediaType[t]&$1(e,a)&&!(0,Ot.hasComponent)(e,Vn,a)&&!t2(e,t,a)&&!J1(s.object3D,r))return a}return null}function i2(e,t,n){const i=AFRAME.scenes[0].systems["hubs-systems"].physicsSystem,r=i.getCollisions(Ln.bodyId[t]);for(let e=0;e<r.length;e++){const t=i.bodyUuidToData.get(r[e]);if((t&&t.object3D&&t.object3D.eid)===n)return!0}return!1}const r2=(()=>{const e=new Y1.Vector3,t=new Y1.Quaternion,n=new Y1.Vector3,i=new Y1.Matrix4;return function(r,o,s){const a=r.eid2obj.get(o),l=r.eid2obj.get(s);a.updateMatrices(),a.matrixWorld.decompose(e,t,n);const c=l.el.components["media-loader"].contentBounds;var d,u;Oo(l,i.compose(e,t,n.multiplyScalar((d=It.bounds[o],u=c,Math.min(d[0]/u.x,d[1]/u.y,d[2]/u.z)))))}})();function o2(e,t){const n=new Y1.Vector3,i=new Y1.Quaternion,r=new Y1.Vector3,o=new Y1.Matrix4;e.updateMatrices(),e.matrixWorld.decompose(n,i,r),Oo(e,o.compose(n,i,r.fromArray(t)))}const s2=[0,0,0],a2=new Y1.Vector3;function l2(e,t,n){const i=!It.capturedNid[t]&&n2(e,t),r=i&&(0,Ot.hasComponent)(e,fn,i);r&&!It.preview[t]?function(e,t,n){const i=function(e,t){const n=e.eid2obj.get(t).el,i=Ro(n.getObject3D("mesh"),!1);i.traverse((e=>{fo(e,(function(t){const n=t.clone();return n.transparent=!0,n.opacity=.5,n.format=Y1.RGBAFormat,n.blending=Y1.NormalBlending,e.material=n,n}))})),i.position.setScalar(0),i.quaternion.identity(),i.matrixNeedsUpdate=!0,(new Y1.Box3).setFromObject(i).getCenter(i.position).multiplyScalar(-1),i.matrixNeedsUpdate=!0;const r=new Y1.Group;return r.el=n,r.add(i),AFRAME.scenes[0].object3D.add(r),Oh(e,(0,Ot.addEntity)(e),r)}(e,n);It.preview[t]=i,It.previewingNid[t]=Rt.id[n],r2(e,t,i)}(e,t,i):!r&&It.preview[t]&&function(e,t){(0,Ot.removeEntity)(e,It.preview[t]),It.preview[t]=0,It.previewingNid[t]=0}(e,t);const o=e.eid2obj.get(t);if(o.visible=!!(It.mediaType[t]&n),o.visible){const n=e.nid2eid.get(It.capturedNid[t])||0,r=n&&(0,Ot.hasComponent)(e,fn,n)||i&&(0,Ot.hasComponent)(e,fn,i);o.material.uniforms.color.value.set(r?3113197:It.capturedNid[t]?8421504:7323901)}}const c2=new Map,d2=(0,Ot.defineQuery)([fn]);var u2;!function(e){e[e.PAUSED=1]="PAUSED"}(u2||(u2={}));const h2=(0,Ot.defineQuery)([Rt,ni]),p2=(0,Ot.enterQuery)(h2),m2=(0,Ot.defineQuery)([ei]),f2=(0,Ot.enterQuery)(m2),g2=(0,Ot.exitQuery)(m2),v2=(0,Ot.defineQuery)([ei,Gn]),b2=(0,Ot.enterQuery)(v2);var y2=n(99477);function w2(e,t,n,i,r,o,s){try{var a=e[o](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(i,r)}const{detect:_2}=n(82701),E2="firefox"===_2().name,A2=void 0!==window.CanvasCaptureMediaStreamTrack;class S2{constructor(e,t,n,i,r,o){this.renderer=e,this.videoRenderTarget=new y2.WebGLRenderTarget(n,i,{format:y2.RGBAFormat,minFilter:y2.LinearFilter,magFilter:y2.NearestFilter,encoding:y2.sRGBEncoding,depth:!1,stencil:!1});const s=e.getRenderTarget();e.setRenderTarget(this.videoRenderTarget),e.setRenderTarget(s);const a=document.createElement("canvas");a.width=this.videoRenderTarget.width,a.height=this.videoRenderTarget.height,this.videoContext=a.getContext("2d"),this.videoImageData=this.videoContext.createImageData(this.videoRenderTarget.width,this.videoRenderTarget.height);const l=a.captureStream(A2?0:r);this.videoTrack=l.getVideoTracks()[0],o?l.addTrack(o):E2&&l.addTrack((()=>{const e=y2.AudioContext.getContext(),t=e.createOscillator(),n=e.createGain(),i=e.createMediaStreamDestination();return n.gain.setValueAtTime(1e-4,e.currentTime),t.connect(i),n.connect(i),i.stream.getAudioTracks()[0]})()),this.mediaRecorder=new MediaRecorder(l,{mimeType:t})}start(){this.chunks=[],this.mediaRecorder.ondataavailable=e=>this.chunks.push(e.data),this.mediaRecorder.start()}captureFrame(e){!function(e,t,n,i,r,o,s,a,l,c,d){const u=e.getContext(),h=e.properties.get(t).__webglFramebuffer,p=e.properties.get(s).__webglFramebuffer;h&&p&&(u.bindFramebuffer(u.READ_FRAMEBUFFER,h),u.bindFramebuffer(u.DRAW_FRAMEBUFFER,p),u.checkFramebufferStatus(u.READ_FRAMEBUFFER)===u.FRAMEBUFFER_COMPLETE&&u.blitFramebuffer(0,0,r,o,0,l,c,0,u.COLOR_BUFFER_BIT,u.LINEAR))}(this.renderer,e,0,0,e.width,e.height,this.videoRenderTarget,0,this.videoRenderTarget.height,this.videoRenderTarget.width),this.renderer.readRenderTargetPixels(this.videoRenderTarget,0,0,this.videoRenderTarget.width,this.videoRenderTarget.height,this.videoImageData.data),this.videoContext.putImageData(this.videoImageData,0,0),A2&&this.videoTrack.requestFrame()}save(){return new Promise((e=>{this.mediaRecorder.onstop=()=>{const t=this.chunks;0===t.length&&e(null);const n=t[0].type,i=new Blob(t,{type:n}),r=new File([i],"capture",{type:n.split(";")[0]});t.length=0,e(r)},this.mediaRecorder.stop()}))}cancel(){this.mediaRecorder.ondataavailable=null,this.mediaRecorder.stop(),this.chunks.length=0}}function x2(){var e;return e=function*(e,t,n){const i=document.createElement("canvas");i.width=t,i.height=n;const r=i.getContext("2d"),o=r.createImageData(t,n);o.data.set(e);const s=yield createImageBitmap(o);r.scale(1,-1),r.drawImage(s,0,-n);const a=yield new Promise((e=>i.toBlob(e)));return new File([a],"snap.png",{type:"image/png"})},x2=function(){var t=this,n=arguments;return new Promise((function(i,r){var o=e.apply(t,n);function s(e){w2(o,i,r,s,a,"next",e)}function a(e){w2(o,i,r,s,a,"throw",e)}s(void 0)}))},x2.apply(this,arguments)}function M2(){}function P2(e,t,n){const i=AFRAME.scenes[0],r=AFRAME.scenes[0].renderer,o=r.xr.enabled;r.xr.enabled=!1;const s=i.object3D.onAfterRender;i.object3D.onAfterRender=M2;const a=AFRAME.scenes[0].systems["personal-space-bubble"],l=AFRAME.scenes[0].systems["hubs-systems"].boneVisibilitySystem;if(a){for(let e=0,t=a.invaders.length;e<t;e++)a.invaders[e].disable();l.tick(),l.updateMatrices()}const c=r.getRenderTarget();if(r.setRenderTarget(t),r.clearDepth(),r.render(i.object3D,e.eid2obj.get(n)),r.setRenderTarget(c),r.xr.enabled=o,i.object3D.onAfterRender=s,a){for(let e=0,t=a.invaders.length;e<t;e++)a.invaders[e].enable();l.tick(),l.updateMatrices()}}function C2(e,t){const n=O2.get(Mi.source[t]);if(!n)return console.error("video-texture-target unable to find source"),void(Mi.source[t]=0);const i=e.eid2mat.get(t),r={originalMap:i.map,originalEmissiveMap:i.emissiveMap,originalBeforeRender:i.onBeforeRender,boundTo:Mi.source[t]};i.onBeforeRender=function(){O2.get(Mi.source[t]).needsUpdate=!0},Mi.flags[t]&Hu&&(i.map=n.renderTarget.texture),Mi.flags[t]&zu&&(i.emissiveMap=n.renderTarget.texture),T2.set(t,r)}function k2(e,t){const n=T2.get(t),i=e.eid2mat.get(t);Mi.flags[t]&Hu&&(i.map=n.originalMap),Mi.flags[t]&zu&&(i.emissiveMap=n.originalMap),i.onBeforeRender=n.originalBeforeRender,T2.delete(t)}const O2=new Map,T2=new Map,R2=(0,Ot.defineQuery)([xi]),D2=(0,Ot.enterQuery)(R2),j2=(0,Ot.exitQuery)(R2),L2=(0,Ot.defineQuery)([Mi,Ai]),I2=(0,Ot.exitQuery)(L2);var N2=n(99477);const F2=["h264","vp9,opus","vp8,opus","vp9","vp8"].find((e=>window.MediaRecorder&&MediaRecorder.isTypeSupported(`video/webm; codecs=${e}`))),B2=F2?`video/webm; codecs=${F2}`:null,V2=!!document.createElement("canvas").getContext("webgl2"),U2=!!B2&&V2,H2=1280,z2=720,W2=AFRAME.utils.device.isMobileVR(),q2=navigator.userAgent.match(/Oculus/),Z2=W2&&!q2?640:1280,G2=W2&&!q2?360:720,Y2=0,Q2=1,X2=2,K2=3,$2=4,J2=[3,7,15,30,60],e3=new Map,t3=new Map;let n3=!1;const i3=new N2.Vector3;function r3(e){return(0,Ot.hasComponent)(APP.world,tn,e)}function o3(e,t,n){const i="video"===n?{videoPaused:!0}:{},{entity:r}=Nl(t,"#interactable-media",void 0,`${n}-camera`,!1,!1,!0,i);r.addEventListener("media_resolved",(()=>{AFRAME.scenes[0].systems["hubs-systems"].soundEffectsSystem.playSoundOneShot(_m),r.object3D.position.copy(e.localToWorld(new N2.Vector3(0,-.5,0))),r.object3D.quaternion.copy(e.quaternion),r.object3D.matrixNeedsUpdate=!0,APP.hubChannel.sendMessage({src:r.components["media-loader"].data.src},n),APP.hubChannel.sendObjectSpawnedEvent(al.CAMERA)}),{once:!0})}function s3(e,t,n){const i=t3.get(t);n?i.cancel():i.save().then((n=>{o3(e.eid2obj.get(t),n,"video")})),t3.delete(t),APP.hubChannel.endRecording()}let a3;const l3=(0,Ot.defineQuery)([Wn]),c3=(0,Ot.enterQuery)(l3),d3=(0,Ot.exitQuery)(l3),u3=(0,Ot.defineQuery)([Ln,Ht,(0,Ot.Not)(Ut)]),h3=(0,Ot.enterQuery)(u3),p3=(0,Ot.exitQuery)(u3),m3=(0,Ot.defineQuery)([In]),f3=(0,Ot.enterQuery)(m3),g3=(0,Ot.exitQuery)(m3);const v3=(e,t)=>{h3(e).forEach((n=>{const i=e.eid2obj.get(n),r=(e=>({mass:Ln.mass[e],gravity:{x:Ln.gravity[e][0],y:Ln.gravity[e][1],z:Ln.gravity[e][2]},linearDamping:Ln.linearDamping[e],angularDamping:Ln.angularDamping[e],linearSleepingThreshold:Ln.linearSleepingThreshold[e],angularSleepingThreshold:Ln.angularSleepingThreshold[e],angularFactor:{x:Ln.angularFactor[e][0],y:Ln.angularFactor[e][1],z:Ln.angularFactor[e][2]},activationState:Ad(e),emitCollisionEvents:Ln.flags[e]&yd,scaleAutoUpdate:Ln.flags[e]&_d,type:Ed(e),disableCollision:Ln.flags[e]&wd,collisionFilterGroup:Ln.collisionFilterGroup[e],collisionFilterMask:Ln.collisionFilterMask[e]}))(n),o=t.addBody(i,r);Ln.bodyId[n]=o})),f3(e).forEach((n=>{const i=Yo(e,Ln,n);i?(In.bodyId[n]=Ln.bodyId[i],function(e,t,n){const i=In.bodyId[n],r=e.eid2obj.get(n),o=(e=>({type:za(e),fit:Wa(e),halfExtents:{x:In.halfExtents[e][0],y:In.halfExtents[e][1],z:In.halfExtents[e][2]},minHalfExtent:In.minHalfExtent[e],maxHalfExtent:In.maxHalfExtent[e],sphereRadius:In.sphereRadius[e],cylinderAxis:qa(e),margin:In.margin[e],offset:{x:In.offset[e][0],y:In.offset[e][1],z:In.offset[e][2]},orientation:{x:In.orientation[e][0],y:In.orientation[e][1],z:In.orientation[e][2],w:In.orientation[e][3]},heightfieldData:In.heightfieldData[e],heightfieldDistance:In.heightfieldDistance[e],includeInvisible:In.flags[e]&Ha.INCLUDE_INVISIBLE}))(n),s=t.addShapes(i,r,o);In.shapeId[n]=s}(e,t,n)):console.warn(`Could find a body for shape in entity ${n}`)})),g3(e).forEach((e=>t.removeShapes(In.bodyId[e],In.shapeId[e]))),p3(e).forEach((n=>{(0,Ot.entityExists)(e,n)&&(0,Ot.hasComponent)(e,In,n)&&t.removeShapes(In.bodyId[n],In.shapeId[n]),t.removeBody(Ln.bodyId[n])}))};var b3=n(99477);const y3=1e3,w3=new b3.Vector3,_3=(0,Ot.defineQuery)([Bn]);var E3=n(69542);const A3=(0,Ot.defineQuery)([ri]),S3=(0,Ot.defineQuery)([cn,ei]),x3=(0,Ot.enterQuery)(S3),M3=(0,Ot.defineQuery)([cn,ii]),P3=.475;function C3(e,t,n){let i=n?Ot.addComponent:Ot.removeComponent;i(e,Xt,t),i(e,Xt,ri.trackRef[t])}const k3=(()=>{const e=new wt.Plane,t=new wt.Ray;return function(n,i,r){let{position:o,direction:s}=i;t.set(o,s),e.normal.set(0,0,1),e.constant=0,n.updateMatrices(),e.applyMatrix4(n.matrixWorld),t.intersectPlane(e,r)}})();let O3=null,T3=new wt.Vector3;const R3=(new wt.Vector3).setScalar(.05),D3=(new wt.Vector3).setScalar(.25);function*j3(e,t){const n=e.eid2obj.get(t);yield*Lc({properties:[[R3,D3],[.75,0]],durationMS:700,easing:Fc,fn:e=>{let[t,i]=e;n.scale.copy(t),n.matrixNeedsUpdate=!0,n.material.opacity=i}})}const L3=(new wt.Vector3).setScalar(.001),I3=(0,Ot.defineQuery)([ai]),N3=(0,Ot.exitQuery)(I3),F3=(0,Ot.defineQuery)([cn]),B3=(0,Ot.defineQuery)([dn]),V3=new Map;function U3(e,t){const n=Go(e,t,(t=>(0,Ot.hasComponent)(e,ai,t)));n&&!V3.has(n)&&V3.set(n,bc(function*(e,t){ss(e,t)&&cs(APP.hubChannel,e,t);const n=e.eid2obj.get(t);yield*Lc({properties:[[n.scale.clone(),L3]],durationMS:400,easing:Fc,fn:e=>{let[t]=e;n.scale.copy(t),n.matrixNeedsUpdate=!0}}),(0,Ot.removeEntity)(e,t)}(e,n)))}const H3=new wt.Vector3,z3=new wt.Vector3,W3=new wt.Matrix4;function q3(e,t){return(0,Ot.hasComponent)(e,tn,t)}const Z3=(0,Ot.defineQuery)([cn]);function G3(e,t){return(0,Ot.hasComponent)(e,tn,t)}function Y3(e,t,n){var i,r;Id(e,t),(0,Ot.addComponent)(e,jt,t),$n.pageNumber[t]=(i=n,1,r=zc.get(t).pdf.numPages,i<1?r:i>r?1:i)}const Q3=(0,Ot.defineQuery)([cn]),X3=(0,Ot.defineQuery)([cn,hi]),K3=(0,Ot.enterQuery)(X3),$3=(0,Ot.defineQuery)([cn,ui]),J3=(0,Ot.defineQuery)([tn,ui]);const e5=new yc,t5=(0,Ot.defineQuery)([Xn]),n5=(0,Ot.enterQuery)(t5),i5=(0,Ot.exitQuery)(t5),r5=(0,Ot.defineQuery)([Rt]),o5=(0,Ot.enterQuery)(r5),s5=(0,Ot.exitQuery)(r5),a5=new wt.Vector3,l5=(0,Ot.defineQuery)([Ei]),c5=AFRAME.utils.device.isMobileVR(),d5=new wt.Vector3,u5=new wt.Vector3,h5=new wt.Frustum,p5=new wt.Matrix4,m5=new wt.Box3,f5=new wt.Box3,g5=e=>{e.geometry&&(e.updateMatrices(),e.geometry.computeBoundingBox(),f5.copy(e.geometry.boundingBox).applyMatrix4(e.matrixWorld),m5.expandByPoint(f5.min),m5.expandByPoint(f5.max))},v5=(e,t,n)=>{const i=e.eid2obj.get(t);d5.setFromMatrixPosition(n.matrixWorld),Ei.onlyY[t]&&(i.getWorldPosition(u5),d5.y=u5.y),i.lookAt(d5),i.matrixNeedsUpdate=!0};let b5=0;const y5=(0,Ot.defineQuery)([Si,Ht]),w5=(0,Ot.defineQuery)([Si,Ai]),_5=(0,Ot.defineQuery)([Pi]),E5=(0,Ot.defineQuery)([ki]),A5=(0,Ot.enterQuery)(E5),S5=(0,Ot.exitQuery)(E5),x5=new yc,M5=new Map,P5=302836;let C5;const k5=()=>{C5||(C5=new wt.MeshBasicMaterial({color:P5,transparent:!0,opacity:.25,side:wt.DoubleSide}))};I0().then((()=>{APP.store.addEventListener("statechanged",(()=>{const e=APP.store.state.preferences.showAudioDebugPanel;e&&k5(),(0,Ot.defineQuery)([Oi])(APP.world).forEach((t=>{e?!M5.has(t)&&O5(APP.world,t):M5.has(t)&&T5(APP.world,t)})),!e&&C5&&(xo(C5),C5=null)})),APP.store.state.preferences.showAudioDebugPanel&&k5()}));const O5=(e,t)=>{const n=new wt.BoxGeometry,i=new wt.Mesh(n,C5),r=new wt.BoxHelper(i,P5),o=e.eid2obj.get(t);o.add(r),o.updateMatrixWorld(!0),M5.set(t,r)},T5=(e,t)=>{const n=M5.get(t);null==n||n.removeFromParent(),Mo(n),M5.delete(t)},R5=e=>{if(16&Oi.flags[e]){const t=APP.world.eid2obj.get(e);return t.getWorldPosition(Q5),t.getWorldScale(X5),G5.get(e).setFromCenterAndSize(Q5,X5)}return G5.get(e)},D5=e=>APP.audioOverrides.get(e),j5=(e,t)=>e&&t&&(e.size!==t.size||((e,n)=>{for(const n of e)if(i=n,!t.has(i))return!0;var i;return!1})(e)),L5=(()=>{const e=new wt.Vector3;return t=>{const n=APP.audios.get(t);return n?n.getWorldPosition(e):e.set(0,0,0),e}})(),I5=e=>{APP.zoneOverrides.delete(e),rm(e,APP.audios.get(e))},N5=(()=>{const e=new wt.Vector3;return(t,n,i)=>{t.set(n,e.subVectors(i,n).normalize())}})(),F5=e=>t=>!e.has(t),B5=e=>{const t=new wt.Vector3;return n=>(e.intersectBox(R5(n),t),null!==t)},V5=(()=>{const e=new wt.Ray;return(t,n,i,r,o)=>{N5(e,r,n);const s=Array.from(i).filter((e=>2&Oi.flags[e])).filter(F5(o)).filter(B5(e)).map((e=>D5(e))).reduce(H5,null),a=Array.from(o).filter((e=>4&Oi.flags[e])).filter(F5(i)).filter(B5(e)).map((e=>D5(e))).reduce(H5,null);a||s?((e,t)=>{APP.zoneOverrides.set(e,t),rm(e,APP.audios.get(e))})(t,a&&!s?a:!a&&s?s:Object.assign({},s,a,H5({gain:null==a?void 0:a.gain},{gain:null==s?void 0:s.gain}))):I5(t)}})(),U5=["gain","maxDistance","refDistance","rolloffFactor","coneInnerAngle","coneOuterAngle","coneOuterGain"],H5=(e,t)=>t||e?t&&!e?t:!t&&e?e:U5.reduce(((n,i)=>(void 0!==t[i]&&void 0!==e[i]?n[i]=Math.min(e[i],t[i]):void 0!==t[i]&&void 0===e[i]?n[i]=t[i]:void 0===t[i]&&void 0!==e[i]&&(n[i]=e[i]),n)),{}):{},z5=(e,t,n)=>{if(!e)return;const i=(e=>Boolean(1&Oi.flags[e]))(t)&&((e,t)=>R5(e).containsPoint(t))(t,n),r=e.has(t);i&&!r?e.add(t):!i&&r&&e.delete(t)},W5=e=>{const t=Z5.get(e);var n;t&&(t.clear(),null===(n=q5.get(e))||void 0===n||n.forEach((e=>t.add(e))))},q5=new Map,Z5=new Map,G5=new Map,Y5=new wt.Vector3,Q5=new wt.Vector3,X5=new wt.Vector3,K5=(0,Ot.defineQuery)([Oi]),$5=(0,Ot.enterQuery)(K5),J5=(0,Ot.exitQuery)(K5),e4=(0,Ot.defineQuery)([Nt]);var t4=n(99477);const n4=(e,t)=>{const n=s4.get(e);null==n||n.forEach((e=>{const n=x0.get(e),i=APP.audios.get(n);try{i.disconnect()}catch(e){}i instanceof wt.PositionalAudio&&i.panner.connect(i.gain),i.setNodeSource(t),i.connect()}))},i4=e=>{const t=s4.get(e);null==t||t.forEach((e=>{const t=x0.get(e),n=APP.audios.get(t);try{n.disconnect()}catch(e){}n instanceof wt.PositionalAudio&&n.panner.connect(n.gain)}))},r4=(e,t)=>{var n;let i=s4.get(e);if((null===(n=i)||void 0===n||!n.includes(t))&&(!i&&(i=new Array),i.push(t),s4.set(e,i),Ri.flags[e]&lh)){const t=((e,t)=>{const n=2*e.sampleRate,i=e.createBuffer(1,n,e.sampleRate),r=i.getChannelData(0);for(let e=0;e<n;e++)r[e]=.01*(2*Math.random()-1);const o=e.createBufferSource();return o.buffer=i,o.loop=!0,o.start(0),o})(APP.audioListener.context);o4.set(e,t),n4(e,t)}},o4=new Map,s4=new Map,a4=new Map,l4=new Map,c4=new Map,d4=new wt.Vector3,u4=(0,Ot.defineQuery)([Ti]),h4=(0,Ot.enterQuery)(u4),p4=(0,Ot.exitQuery)(u4),m4=(0,Ot.defineQuery)([Ri]),f4=(0,Ot.enterQuery)(m4),g4=(0,Ot.exitQuery)(m4),v4=new Map,b4=new Map,y4=new Map,w4=new Map,_4=new Map,E4=new Map,A4=new Map,S4=new wt.Quaternion,x4=(0,Ot.defineQuery)([ji,Ht]),M4=(0,Ot.enterQuery)(x4),P4=(0,Ot.exitQuery)(x4),C4=new wt.Vector3,k4=new wt.Quaternion,O4=(0,Ot.defineQuery)([Li,Ht]),T4=(0,Ot.defineQuery)([Ii,Ht]),R4=(0,Ot.defineQuery)([Ni,Ht]),D4=(0,z.Z)("networkDebug");AFRAME.registerSystem("hubs-systems",{init(){L().then((()=>{this.DOMContentDidLoad=!0})),this.cursorTogglingSystem=new bK,this.interactionSfxSystem=new JK,this.superSpawnerSystem=new qK,this.cursorTargettingSystem=new gK,this.positionAtBorderSystem=new sb,this.physicsSystem=new PK(this.el.object3D),this.twoPointStretchingSystem=new RK,this.holdableButtonSystem=new DK,this.hoverButtonSystem=new BK,this.hoverMenuSystem=new WK,this.hapticFeedbackSystem=new QK,this.audioSystem=new $$(this.el),this.soundEffectsSystem=new jm(this.el),this.scenePreviewCameraSystem=new $K,this.spriteSystem=new y$(this.el),this.cameraSystem=new mf(this.el.camera,this.el.renderer),this.drawingMenuSystem=new UK(this.el),this.characterController=new F$(this.el),this.waypointSystem=new k$(this.el,this.characterController),this.cursorPoseTrackingSystem=new V$,this.menuAnimationSystem=new H$,this.audioSettingsSystem=new z$(this.el),this.animationMixerSystem=new ap,this.boneVisibilitySystem=new If,this.uvScrollSystem=new Pp,this.shadowSystem=new rJ(this.el),this.inspectYourselfSystem=new oJ,this.emojiSystem=new aJ(this.el),this.audioZonesSystem=new gJ,this.gainSystem=new wJ,this.environmentSystem=new RJ(this.el),this.nameTagSystem=new jJ(this.el),window.$S=this},remove(){this.cursorTargettingSystem.remove()}}),AFRAME.registerSystem("capture-system",{init(){this._gotAudioTrack=!1,this._recorderTimeout=null},_initRecorder(){if(!this.available())return;this._stream=new MediaStream;const e=this.el.canvas.captureStream().getVideoTracks()[0];this._stream.addTrack(e),this._recorder=new MediaRecorder(this._stream,{mimeType:"video/webm; codecs=vp8"});const t=[];this._recorder.ondataavailable=e=>{t.push(e.data)},this._recorder.onstop=()=>{if(0===t.length)return;const e=t[0].type,n=new Blob(t,{type:e});t.length=0,this.el.emit("add_media",new File([n],"capture",{type:e}))}},available:()=>(0,z.Z)("video_capture")&&window.MediaRecorder&&MediaRecorder.isTypeSupported("video/webm; codecs=vp8"),started(){return this._recorder&&"inactive"!==this._recorder.state},_tryAddingAudioTrack(){if(this._gotAudioTrack||!this.el.audioListener)return;const e=this.el.audioListener,t=e.context.createMediaStreamDestination();e.getInput().connect(t);const n=t.stream.getAudioTracks()[0];this._stream.addTrack(n),this._gotAudioTrack=!0},start(){this._recorder||this._initRecorder(),this._tryAddingAudioTrack(),this.started()||(this._recorder.start(),this._recorderTimeout=setTimeout((()=>{this.started()&&this._recorder.stop()}),15e3))},stop(){this.started()&&(clearTimeout(this._recorderTimeout),this._recorder.stop())}}),n(3273),AFRAME.registerSystem("linked-media",{init:function(){this.handlers=[],this.addLinkageHandler=this.addLinkageHandler.bind(this),this.syncLinkage=this.syncLinkage.bind(this)},addLinkageHandler(e,t){const n=()=>{t._handlingLinkage||(e._handlingLinkage=!0,this.syncLinkage(e,t),e._handlingLinkage=!1)};if(e.components["media-loader"].data)e.addEventListener("componentchanged",n);else{const t=i=>{"media-loader"===i.detail.name&&(e.removeEventListener("componentinitialized",t),e.addEventListener("componentchanged",n))};e.addEventListener("componentinitialized",t)}return n},registerLinkage:function(e,t){this.syncLinkage(e,t);const n=this.addLinkageHandler(e,t),i=this.addLinkageHandler(t,e);e.setAttribute("linked-media",""),t.setAttribute("linked-media",""),APP.mutedState.add(e);const r=APP.audios.get(e);r&&rm(e,r),this.handlers.push([e,t,n,i])},deregisterLinkage:function(e){for(const[t,n,i,r]of this.handlers){e!==t&&e!==n||(t.removeEventListener("componentchanged",i),n.removeEventListener("componentchanged",r)),APP.mutedState.delete(t);const o=APP.audios.get(t);o&&rm(t,o)}this.handlers=this.handlers.filter((t=>{let[n,i]=t;return n!==e&&i!==e}))},syncLinkage(e,t){if(t.components.networked&&!NAF.utils.isMine(t)&&!NAF.utils.takeOwnership(t))return;const{src:n,version:i}=e.components["media-loader"].data;if(t.setAttribute("media-loader",{src:n,version:i}),e.components["media-pdf"]){const{index:n}=e.components["media-pdf"].data;t.setAttribute("media-pdf",{index:n})}if(e.components["media-video"]){const{time:n,videoPaused:i,loop:r,hidePlaybackControls:o}=e.components["media-video"].data,s={time:n,videoPaused:i,loop:r,hidePlaybackControls:o};!t.components.networked&&(s.syncTolerance=.25),t.setAttribute("media-video",s),t.components["media-video"].updatePlaybackState(!0)}}}),AFRAME.registerComponent("linked-media",{remove:function(){this.system.deregisterLinkage(this.el)}});var j4=n(99477);const L4={distanceModel:gh.Inverse,maxDistance:0,refDistance:0,rolloffFactor:0,coneInnerAngle:0,coneOuterAngle:0};AFRAME.registerSystem("audio-debug",{schema:{enabled:{default:!1}},init(){if(this.maxDebugSources=64,this.unsupported=!1,Pt(this.el.sceneEl.renderer)<"2.0")this.unsupported=!0;else{const e=this.el.sceneEl.renderer.getContext(),t=e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS);this.maxDebugSources=Math.min(Math.floor(t/10),this.maxDebugSources)}window.APP.store.addEventListener("statechanged",this.updateState.bind(this)),this.onSceneLoaded=this.onSceneLoaded.bind(this),this.el.sceneEl.addEventListener("environment-scene-loaded",this.onSceneLoaded),this.navMeshObject=null,this.zones=[],this.material=new j4.ShaderMaterial({uniforms:{time:{value:0},colorInner:{value:new j4.Color("#7AFF59")},colorOuter:{value:new j4.Color("#FF6340")},colorGain:{value:new j4.Color("#70DBFF")},count:{value:0},maxDistance:{value:[]},refDistance:{value:[]},rolloffFactor:{value:[]},distanceModel:{value:[]},sourcePosition:{value:[]},sourceOrientation:{value:[]},coneInnerAngle:{value:[]},coneOuterAngle:{value:[]},gain:{value:[]},clipped:{value:[]}},vertexShader:T0,fragmentShader:R0}),this.material.side=j4.FrontSide,this.material.transparent=!0,this.material.uniforms.count.value=0,this.material.defines.MAX_DEBUG_SOURCES=this.maxDebugSources,this.sourcePositions=new Array(this.maxDebugSources),this.sourcePositions.fill(new j4.Vector3),this.sourceOrientations=new Array(this.maxDebugSources),this.sourceOrientations.fill(new j4.Vector3),this.distanceModels=new Array(this.maxDebugSources),this.distanceModels.fill(0),this.maxDistances=new Array(this.maxDebugSources),this.maxDistances.fill(0),this.refDistances=new Array(this.maxDebugSources),this.refDistances.fill(0),this.rolloffFactors=new Array(this.maxDebugSources),this.rolloffFactors.fill(0),this.coneInnerAngles=new Array(this.maxDebugSources),this.coneInnerAngles.fill(0),this.coneOuterAngles=new Array(this.maxDebugSources),this.coneOuterAngles.fill(0),this.gains=new Array(this.maxDebugSources),this.gains.fill(0),this.clipped=new Array(this.maxDebugSources),this.clipped.fill(0)},remove(){window.APP.store.removeEventListener("statechanged",this.updateState),this.el.sceneEl.removeEventListener("environment-scene-loaded",this.onSceneLoaded)},registerZone(e){this.zones.push(e)},unregisterZone(e){const t=this.zones.indexOf(e);-1!==t&&this.zones.splice(t,1)},tick:(()=>{const e=new j4.Vector3,t=new j4.Vector3;return function(n){if(!this.data.enabled)return;let i=0;for(const[n,r]of APP.audios.entries()){if(i>=this.maxDebugSources)continue;if(APP.isAudioPaused.has(n))continue;r.getWorldPosition(e),r.getWorldDirection(t),this.sourcePositions[i]=e,this.sourceOrientations[i]=t;const o=r.panner||L4;this.distanceModels[i]=0,o.distanceModel===gh.Linear?this.distanceModels[i]=0:o.distanceModel===gh.Inverse?this.distanceModels[i]=1:o.distanceModel===gh.Exponential&&(this.distanceModels[i]=2),this.maxDistances[i]=o.maxDistance,this.refDistances[i]=o.refDistance,this.rolloffFactors[i]=o.rolloffFactor,this.coneInnerAngles[i]=o.coneInnerAngle,this.coneOuterAngles[i]=o.coneOuterAngle,this.gains[i]=r.gain.gain.value,this.clipped[i]=APP.clippingState.has(n),i++}this.material.uniforms.time.value=n,this.material.uniforms.distanceModel.value=this.distanceModels,this.material.uniforms.maxDistance.value=this.maxDistances,this.material.uniforms.refDistance.value=this.refDistances,this.material.uniforms.rolloffFactor.value=this.rolloffFactors,this.material.uniforms.sourcePosition.value=this.sourcePositions,this.material.uniforms.sourceOrientation.value=this.sourceOrientations,this.material.uniforms.count.value=i,this.material.uniforms.coneInnerAngle.value=this.coneInnerAngles,this.material.uniforms.coneOuterAngle.value=this.coneOuterAngles,this.material.uniforms.gain.value=this.gains,this.material.uniforms.clipped.value=this.clipped}})(),enableDebugMode(e,t){if(void 0===t&&(t=!1),(void 0===e||e===this.data.enabled)&&!t||this.unsupported)return;this.zones.forEach((t=>{t.el.setAttribute("audio-zone","debuggable",e)}));const n=Array.from(this.el.sceneEl.querySelectorAll("[nav-mesh]")).map((function(e){return e.getObject3D("mesh")})).filter((function(e){return e}));n.length&&(this.data.enabled=e,n.forEach((t=>{t.isMesh&&(this.navMeshObject=t,t.parent.visible=e,t.material&&(e?(!t._hubs_audio_debug_prev_material&&(t._hubs_audio_debug_prev_material=t.material),t.material=this.material,t.material.needsUpdate=!0):t._hubs_audio_debug_prev_material&&(t.material=t._hubs_audio_debug_prev_material,t._hubs_audio_debug_prev_material=null,t.material.needsUpdate=!0),t.geometry.computeVertexNormals()))}))),this.navMeshObject||(this.data.enabled=!1)},updateState(e){let{force:t}=e;const n=window.APP.store.state.preferences.showAudioDebugPanel;(t||n!==this.data.enabled)&&this.enableDebugMode(n,t)},onSceneLoaded(){this.navMeshObject=null,this.updateState({force:!0})}});var I4=n(17967);function N4(e,t,n){const i=n[e];if(!i)throw new Error(`Component "${e}" is not public.`);const r=i.publicProperties[t];if(!r)throw new Error(`Component "${e}"'s property "${t}" is not public.`);return{mappedComponent:i.mappedComponent,mappedProperty:r.mappedProperty,getMappedValue:r.getMappedValue}}var F4,B4=n(99477);function V4(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function U4(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?V4(Object(n),!0).forEach((function(t){H4(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):V4(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function H4(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function z4(e,t,n,i,r,o,s){try{var a=e[o](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(i,r)}function W4(){var e;return e=function*(e,t,n,i,r){void 0===r&&(r=!0);let o=!0;if("link"===t&&(i.video||i.image))return;if(i.networked){o=n.controls||"link"===t;const r="model"===t||o||"video"===t||"audio"===t?"#static-controlled-media":"#static-media";e.setAttribute("networked",{template:r,owner:"scene",persistent:!0,networkId:i.networked.id})}const s={};if("video"!==t&&"image"!==t||(s.projection=n.projection,s.alphaMode=n.alphaMode,s.alphaCutoff=n.alphaCutoff),"video"===t||"audio"===t){if(s.videoPaused=!n.autoPlay,s.loop=n.loop,s.hidePlaybackControls=!o,n.audioType){APP.audioOverrides.set(e,{audioType:n.audioType,distanceModel:n.audioType===fh.Stereo?gh.Linear:n.distanceModel,rolloffFactor:n.audioType===fh.Stereo?0:n.rolloffFactor,refDistance:n.refDistance,maxDistance:n.maxDistance,coneInnerAngle:n.coneInnerAngle,coneOuterAngle:n.coneOuterAngle,coneOuterGain:n.coneOuterGain,gain:n.volume}),APP.sourceType.set(e,mh.MEDIA_VIDEO);const t=APP.audios.get(e);t&&rm(e,t)}e.setAttribute("video-pause-state",{paused:s.videoPaused})}"video"!==t&&"image"!==t||!i.link||(s.href=(0,I4.N)(i.link.href));const a="link"===t?n.href:n.src;e.setAttribute("media-loader",{src:(0,I4.N)(a),fitToBox:r,resolve:!0,fileIsOwned:!0,animate:!1,mediaOptions:s,moveTheParentNotTheMesh:!0})},W4=function(){var t=this,n=arguments;return new Promise((function(i,r){var o=e.apply(t,n);function s(e){z4(o,i,r,s,a,"next",e)}function a(e){z4(o,i,r,s,a,"throw",e)}s(void 0)}))},W4.apply(this,arguments)}AFRAME.GLTFModelPlus.registerComponent("duck","duck",(e=>{e.setAttribute("duck",""),e.setAttribute("quack",{quackPercentage:.1})})),AFRAME.GLTFModelPlus.registerComponent("quack","quack"),AFRAME.GLTFModelPlus.registerComponent("sound","sound"),AFRAME.GLTFModelPlus.registerComponent("css-class","css-class"),AFRAME.GLTFModelPlus.registerComponent("interactable","css-class",((e,t)=>{e.setAttribute(t,"interactable")})),AFRAME.GLTFModelPlus.registerComponent("super-spawner","super-spawner",((e,t,n)=>{e.setAttribute("is-remote-hover-target",""),e.setAttribute("tags",{isHandCollisionTarget:!0}),e.setAttribute("hoverable-visuals",""),e.setAttribute(t,n)})),AFRAME.GLTFModelPlus.registerComponent("gltf-model-plus","gltf-model-plus"),AFRAME.GLTFModelPlus.registerComponent("media-loader","media-loader"),AFRAME.GLTFModelPlus.registerComponent("body","body-helper",(e=>{e.setAttribute("body-helper",{mass:0,type:Lm.TYPE.STATIC,collisionFilterGroup:Ue.INTERACTABLES,collisionFilterMask:Ue.DEFAULT_SPAWNER})})),AFRAME.GLTFModelPlus.registerComponent("ammo-shape","shape-helper"),AFRAME.GLTFModelPlus.registerComponent("hide-when-quality","hide-when-quality"),AFRAME.GLTFModelPlus.registerComponent("light","light",((e,t,n)=>{0===n.distance&&(n.decay=0),e.setAttribute(t,n),n.castShadow&&setTimeout((()=>{e.components.light.light.shadow.camera.matrixNeedsUpdate=!0}),0)})),AFRAME.GLTFModelPlus.registerComponent("ambient-light","ambient-light"),AFRAME.GLTFModelPlus.registerComponent("directional-light","directional-light"),AFRAME.GLTFModelPlus.registerComponent("hemisphere-light","hemisphere-light"),AFRAME.GLTFModelPlus.registerComponent("point-light","point-light"),AFRAME.GLTFModelPlus.registerComponent("spot-light","spot-light"),AFRAME.GLTFModelPlus.registerComponent("billboard","billboard",(F4=Rh.billboard,(e,t,n)=>F4(APP.world,e.object3D.eid,n))),AFRAME.GLTFModelPlus.registerComponent("simple-water","simple-water"),AFRAME.GLTFModelPlus.registerComponent("skybox","skybox"),AFRAME.GLTFModelPlus.registerComponent("layers","layers"),AFRAME.GLTFModelPlus.registerComponent("shadow","shadow"),AFRAME.GLTFModelPlus.registerComponent("water","water"),AFRAME.GLTFModelPlus.registerComponent("scale-audio-feedback","scale-audio-feedback"),AFRAME.GLTFModelPlus.registerComponent("morph-audio-feedback","morph-audio-feedback"),AFRAME.GLTFModelPlus.registerComponent("animation-mixer","animation-mixer"),AFRAME.GLTFModelPlus.registerComponent("loop-animation","loop-animation"),AFRAME.GLTFModelPlus.registerComponent("uv-scroll","uv-scroll"),AFRAME.GLTFModelPlus.registerComponent("frustrum","frustrum"),AFRAME.GLTFModelPlus.registerComponent("mirror","mirror"),AFRAME.GLTFModelPlus.registerComponent("box-collider","shape-helper",(()=>{const e=new B4.Euler;return(t,n,i)=>{const{scale:r,rotation:o}=i;e.set(o.x,o.y,o.z);const s=(new B4.Quaternion).setFromEuler(e);t.setAttribute(n,{type:Lm.SHAPE.BOX,fit:Lm.FIT.MANUAL,offset:i.position,halfExtents:{x:r.x/2,y:r.y/2,z:r.z/2},orientation:{x:s.x,y:s.y,z:s.z,w:s.w}})}})()),AFRAME.GLTFModelPlus.registerComponent("visible","visible",((e,t,n)=>{"object"==typeof n?e.setAttribute(t,n.visible):e.setAttribute(t,n)})),AFRAME.GLTFModelPlus.registerComponent("spawn-point","spawn-point",(e=>{e.setAttribute("waypoint",{canBeSpawnPoint:!0,canBeOccupied:!1,canBeClicked:!1,willDisableMotion:!1,willDisableTeleporting:!1,willMaintainWorldUp:!0})})),AFRAME.GLTFModelPlus.registerComponent("nav-mesh","nav-mesh"),AFRAME.GLTFModelPlus.registerComponent("pinnable","pinnable"),AFRAME.GLTFModelPlus.registerComponent("waypoint","waypoint",((e,t,n,i)=>{n.canBeOccupied&&e.setAttribute("networked",{template:"#template-waypoint-avatar",attachTemplateToLocal:!1,owner:"scene",persistent:!0,networkId:i.networked.id}),e.setAttribute("waypoint",n)})),AFRAME.GLTFModelPlus.registerComponent("media-frame","media-frame",((e,t,n)=>{const i=Lh(APP.world,kh("entity",{mediaFrame:n}));(0,Ot.addComponent)(APP.world,Rt,i);const r=lp(e,"networked"),o=r&&r.components.networked.data.networkId||"scene";Nc(i,`${o}.${e.object3D.children[0].userData.gltfIndex}`,o),e.object3D.add(APP.world.eid2obj.get(i))})),AFRAME.GLTFModelPlus.registerComponent("media","media",((e,t,n)=>{n.id&&e.setAttribute("networked",{template:"#interactable-media",owner:"scene",persistent:!0,networkId:n.id});const i={src:(0,I4.N)(n.src),fitToBox:!n.contentSubtype,resolve:!0,fileIsOwned:!0,animate:!1,contentSubtype:n.contentSubtype};n.version&&(i.version=n.version),e.setAttribute("media-loader",i),n.pageIndex&&(e.setAttribute("media-pdf",{index:n.pageIndex}),e.setAttribute("media-pager",{index:n.pageIndex})),void 0!==n.paused&&e.setAttribute("media-video",{videoPaused:n.paused}),n.time&&e.setAttribute("media-video",{time:n.time})}));const q4=(e,t,n,i)=>function(e,t,n,i){return W4.apply(this,arguments)}(e,t,n,i,!1);AFRAME.GLTFModelPlus.registerComponent("model","model",q4),AFRAME.GLTFModelPlus.registerComponent("image","image",q4),AFRAME.GLTFModelPlus.registerComponent("audio","audio",q4,((e,t,n)=>"paused"===t?{name:"video-pause-state",property:t,value:n}:null)),AFRAME.GLTFModelPlus.registerComponent("video","video",q4,((e,t,n)=>"paused"===t?{name:"video-pause-state",property:t,value:n}:null)),AFRAME.GLTFModelPlus.registerComponent("link","link",q4),AFRAME.GLTFModelPlus.registerComponent("hoverable","is-remote-hover-target",(e=>{e.setAttribute("is-remote-hover-target",""),e.setAttribute("tags",{isHandCollisionTarget:!0})})),AFRAME.GLTFModelPlus.registerComponent("spawner","spawner",((e,t,n)=>{e.setAttribute("media-loader",{src:(0,I4.N)(n.src),resolve:!0,fileIsOwned:!0,animate:!1,moveTheParentNotTheMesh:!0}),e.setAttribute("css-class","interactable"),e.setAttribute("super-spawner",{src:(0,I4.N)(n.src),resolve:!0,template:"#interactable-media",mediaOptions:n.mediaOptions||{}}),e.setAttribute("hoverable-visuals",""),e.setAttribute("body-helper",{mass:0,type:Lm.TYPE.STATIC,collisionFilterGroup:Ue.INTERACTABLES,collisionFilterMask:Ue.DEFAULT_SPAWNER}),e.setAttribute("is-remote-hover-target",""),e.setAttribute("tags",{isHandCollisionTarget:!0})}));const Z4={video:{mappedComponent:"video-pause-state",publicProperties:{paused:{mappedProperty:"paused",getMappedValue:e=>!!e}}},"loop-animation":{mappedComponent:"loop-animation",publicProperties:{paused:{mappedProperty:"paused",getMappedValue:e=>!!e}}}};function G4(e,t,n,i,r,o,s){try{var a=e[o](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(i,r)}function Y4(e){return function(){var t=this,n=arguments;return new Promise((function(i,r){var o=e.apply(t,n);function s(e){G4(o,i,r,s,a,"next",e)}function a(e){G4(o,i,r,s,a,"throw",e)}s(void 0)}))}}AFRAME.GLTFModelPlus.registerComponent("trigger-volume","trigger-volume",((e,t,n,i,r)=>{const{size:o,target:s,enterComponent:a,enterProperty:l,enterValue:c,leaveComponent:d,leaveProperty:u,leaveValue:h}=n;let p,m,f;try{if(p=N4(a,l,Z4),m=N4(d,u,Z4),f="number"==typeof s?r[s]:null==s?void 0:s.el,!f)throw new Error(`Couldn't find target entity with index: ${s}.`)}catch(e){return void console.warn(`Error inflating gltf component "trigger-volume": ${e.message}`)}e.setAttribute("trigger-volume",{colliders:"#avatar-pov-node",size:o,target:f,enterComponent:p.mappedComponent,enterProperty:p.mappedProperty,enterValue:p.getMappedValue(c),leaveComponent:m.mappedComponent,leaveProperty:m.mappedProperty,leaveValue:m.getMappedValue(h)})})),AFRAME.GLTFModelPlus.registerComponent("heightfield","heightfield",((e,t,n)=>{e.setAttribute("shape-helper__heightfield",{type:Lm.SHAPE.HEIGHTFIELD,margin:.01,fit:Lm.FIT.MANUAL,heightfieldDistance:n.distance,offset:n.offset,heightfieldData:n.data})})),AFRAME.GLTFModelPlus.registerComponent("trimesh","trimesh",(e=>{e.setAttribute("shape-helper__trimesh",{type:Lm.SHAPE.MESH,margin:.01,fit:Lm.FIT.ALL,includeInvisible:!0})})),AFRAME.GLTFModelPlus.registerComponent("particle-emitter","particle-emitter"),AFRAME.GLTFModelPlus.registerComponent("networked-drawing-buffer","networked-drawing-buffer"),AFRAME.GLTFModelPlus.registerComponent("audio-settings","audio-settings",((e,t,n)=>{const i=e=>Object.entries(e).reduce(((e,t)=>{let[n,i]=t;return void 0!==i&&(e[n]=i),e}),{});APP.sceneAudioDefaults.set(mh.MEDIA_VIDEO,i({distanceModel:n.mediaDistanceModel,rolloffFactor:n.mediaRolloffFactor,refDistance:n.mediaRefDistance,maxDistance:n.mediaMaxDistance,coneInnerAngle:n.mediaConeInnerAngle,coneOuterAngle:n.mediaConeOuterAngle,coneOuterGain:n.mediaConeOuterGain,gain:n.mediaVolume})),APP.sceneAudioDefaults.set(mh.AVATAR_AUDIO_SOURCE,i({distanceModel:n.avatarDistanceModel,rolloffFactor:n.avatarRolloffFactor,refDistance:n.avatarRefDistance,maxDistance:n.avatarMaxDistance,coneInnerAngle:n.avatarConeInnerAngle,coneOuterAngle:n.avatarConeOuterAngle,coneOuterGain:n.avatarConeOuterGain,gain:n.avatarVolume}));for(const[e,t]of APP.audios.entries())rm(e,t)})),AFRAME.GLTFModelPlus.registerComponent("video-texture-target","video-texture-target",((e,t,n)=>{const{targetBaseColorMap:i,targetEmissiveMap:r,srcNode:o}=n;let s;void 0!==o&&(s=null==o?void 0:o.el,s||console.warn(`Error inflating gltf component "video-texture-srcEl": Couldn't find srcEl entity with index ${o}`)),e.setAttribute(t,{src:s?"el":"",targetBaseColorMap:i,targetEmissiveMap:r,srcEl:s})})),AFRAME.GLTFModelPlus.registerComponent("video-texture-source","video-texture-source"),AFRAME.GLTFModelPlus.registerComponent("text","text"),AFRAME.GLTFModelPlus.registerComponent("audio-target","audio-target",((e,t,n)=>{const{srcNode:i}=n;let r;if(void 0!==i&&(r=null==i?void 0:i.el,r||console.warn(`Error inflating gltf component ${t}: Couldn't find srcEl entity with index ${i}`)),void 0!==n.positional){APP.audioOverrides.set(e,{audioType:n.positional?fh.PannerNode:fh.Stereo,distanceModel:n.distanceModel,rolloffFactor:n.rolloffFactor,refDistance:n.refDistance,maxDistance:n.maxDistance,coneInnerAngle:n.coneInnerAngle,coneOuterAngle:n.coneOuterAngle,coneOuterGain:n.coneOuterGain,gain:n.gain}),APP.sourceType.set(e,mh.AUDIO_TARGET);const t=APP.audios.get(e);t&&rm(e,t)}e.setAttribute(t,{minDelay:n.minDelay,maxDelay:n.maxDelay,debug:n.debug,srcEl:r})})),AFRAME.GLTFModelPlus.registerComponent("zone-audio-source","zone-audio-source"),AFRAME.GLTFModelPlus.registerComponent("audio-params","audio-params",((e,t,n)=>{APP.audioOverrides.set(e,n);const i=APP.audios.get(e);i&&rm(e,i)})),AFRAME.GLTFModelPlus.registerComponent("audio-zone","audio-zone",((e,t,n)=>{e.setAttribute(t,U4({},n))})),AFRAME.GLTFModelPlus.registerComponent("background","background",((e,t,n)=>{console.warn("The `background` component is deprecated, use `backgroundColor` on the `environment-settings` component instead."),e.setAttribute("environment-settings",{backgroundColor:new B4.Color(n.color)})})),AFRAME.GLTFModelPlus.registerComponent("fog","fog",((e,t,n)=>{e.setAttribute("environment-settings",{fogType:n.type,fogColor:new B4.Color(n.color),fogNear:n.near,fogFar:n.far,fogDensity:n.density})})),AFRAME.GLTFModelPlus.registerComponent("environment-settings","environment-settings",((e,t,n)=>{e.setAttribute(t,U4(U4({},n),{},{backgroundColor:new B4.Color(n.backgroundColor)}))})),AFRAME.GLTFModelPlus.registerComponent("reflection-probe","reflection-probe",((e,t,n)=>{n.envMapTexture.flipY=!0,n.envMapTexture.mapping=B4.EquirectangularReflectionMapping,e.setAttribute(t,n)}));class Q4{constructor(e,t,n,i){this._signInAndPinOrUnpinElement=(e,t)=>{const n=t?()=>this._pinElement(e):()=>this.unpinElement(e);this.performConditionalSignIn((()=>this.hubChannel.signedIn),n,t?ZS.pin:ZS.unpin,(e=>{console.warn(`PinningHelper: Conditional sign-in failed. ${e}`)}))},this.hubChannel=e,this.authChannel=t,this.store=n,this.performConditionalSignIn=i}setPinned(e,t){var n=this;return Y4((function*(){NAF.utils.isMine(e)?n._signInAndPinOrUnpinElement(e,t):console.warn("PinningHelper: Attempted to set pin state on object that was not mine.")}))()}_pinElement(e){var t=this;return Y4((function*(){const{networkId:n}=e.components.networked.data,{fileId:i,src:r}=e.components["media-loader"].data;let o,s;if(i){o=new URL(r).searchParams.get("token");const e=Vl(i);e&&(s=e.promotionToken)}const a=function(e){if(!NAF.utils.isMine(e))return;const t=e.object3D,n=e.components,i=n.networked.data.networkId,r={},o={name:i,extensions:{HUBS_components:r}},s=(e,t)=>e.length===t.length&&e.every(((e,n)=>e===t[n])),a=t.quaternion.toArray(),l=t.position.toArray(),c=t.scale.toArray();if(s(a,[0,0,0,1])||(o.rotation=a),s(l,[0,0,0])||(o.translation=l),s(c,[1,1,1])||(o.scale=c),n["media-loader"]){const e=n["media-loader"].data.src,t=n["media-loader"].data.version,o=n["media-loader"].data.contentSubtype;if(e.startsWith("hubs://")&&e.endsWith("/video"))return null;r.media={src:e,version:t,contentSubtype:o,id:i},n["media-pdf"]&&(r.media.pageIndex=n["media-pdf"].data.index),n["media-video"]&&n["media-video"].data.videoPaused&&(r.media.paused=!0,r.media.time=n["media-video"].data.time)}return r.pinnable={pinned:!0},o}(e);if(a){e.setAttribute("networked",{persistent:!0}),e.setAttribute("media-loader",{fileIsOwned:!0});try{yield t.hubChannel.pin(n,a,i,o,s),NAF.utils.isMine(e)||NAF.utils.takeOwnership(e)||console.warn("PinningHelper: Pinning succeeded, but ownership was lost in the mean time"),e.setAttribute("pinnable","pinned",!0),e.emit("pinned",{el:e}),t.store.update({activity:{hasPinned:!0}})}catch(n){"invalid_token"===n.reason?(yield t.authChannel.signOut(t.hubChannel),t._signInAndPinOrUnpinElement(e)):console.warn("PinningHelper: Pin failed for unknown reason",n)}}else console.warn("PinningHelper: Entity did not produce a GLTF node.")}))()}unpinElement(e){const t=e.components,n=t.networked;if(!n||!n.data||!NAF.utils.isMine(e))return void console.warn("PinningHelper: Tried to unpin element that is not networked or not mine.");const i=t.networked.data.networkId;e.setAttribute("networked",{persistent:!1});const r=t["media-loader"],o=r.data&&r.data.fileId;this.hubChannel.unpin(i,o),e.setAttribute("pinnable","pinned",!1),e.emit("unpinned",{el:e})}}var X4=n(70410),K4=n.p+"assets/images/sprites/notice/play-18574f09350823db10a0..png",$4=n.p+"assets/images/sprites/notice/pause-cd55cc9fd50145a481b1..png";const J4=["trackRef","headRef"];function e6(){return e6=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},e6.apply(this,arguments)}const t6=zl.load(K4),n6=zl.load($4);function i6(e){let{trackRef:t,headRef:n}=e;return kh("entity",e6({},function(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}(e,J4),{name:"Slider"}),kh("entity",{name:"Slider:Track",videoMenuItem:!0,object3D:new wt.Mesh(new wt.PlaneBufferGeometry(1,.05),new wt.MeshBasicMaterial({opacity:.5,color:0,transparent:!0})),cursorRaycastable:!0,remoteHoverTarget:!0,holdable:!0,holdableButton:!0,ref:t},kh("entity",{name:"Slider:Head",object3D:new wt.Mesh(new wt.BoxBufferGeometry(.05,.05,.05),new wt.MeshBasicMaterial),ref:n})))}function r6(){const e=.001,t=Mh(),n=Mh(),i=Mh(),r=Mh(),o=Mh();return kh("entity",{name:"Video Menu",videoMenu:{timeLabelRef:t,headRef:n,trackRef:i,playIndicatorRef:r,pauseIndicatorRef:o}},kh(Yh,{name:"Time Label",text:{anchorY:"top",anchorX:"right"},ref:t,scale:[.5,.5,.5],position:[.48,.26125,e]}),kh(i6,{trackRef:i,headRef:n,position:[0,-.25625,e]}),kh("entity",{ref:r,position:[0,0,e],scale:[.25,.25,.25],image:{texture:t6,ratio:1,projection:Ya.FLAT,alphaMode:Ja.Blend,cacheKey:nl.key(K4,1)},visible:!1}),kh("entity",{ref:o,position:[0,0,e],scale:[.25,.25,.25],image:{texture:n6,ratio:1,projection:Ya.FLAT,alphaMode:Ja.Blend,cacheKey:nl.key($4,1)},visible:!1}))}function o6(){return o6=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},o6.apply(this,arguments)}const s6=.2,a6=[.4,.4,.4],l6=.25;function c6(e){return kh(Uh,o6({name:"Pin Button",scale:a6,width:.4,height:s6,type:Vh.ACTION,text:"pin"},e))}function d6(e){return kh(Uh,o6({name:"Unpin Button",scale:a6,width:.4,height:s6,type:Vh.ACTION,text:"unpin"},e))}function u6(e){return kh(Uh,o6({name:"Camera Focus Button",scale:a6,width:.4,height:s6,type:Vh.DEFAULT,text:"focus"},e))}function h6(e){return kh(Uh,o6({name:"Camera Track Button",scale:a6,width:.4,height:s6,type:Vh.DEFAULT,text:"track"},e))}function p6(e){return kh(Uh,o6({name:"Remove Button",scale:a6,width:.4,height:s6,type:Vh.DEFAULT,text:"delete"},e))}function m6(e){return kh(Uh,o6({name:"Drop Button",scale:a6,width:.4,height:s6,type:Vh.DEFAULT,text:"drop"},e))}function f6(e){return kh(Uh,o6({name:"Inspect Button",scale:a6,width:.4,height:s6,type:Vh.DEFAULT,text:"inspect"},e))}function g6(e){return kh(Uh,o6({name:"Deserialize Drawing Button",scale:a6,width:.4,height:s6,type:Vh.DEFAULT,text:"deserialize"},e))}function v6(e){return kh(Uh,o6({name:"Open Link Button",scale:a6,width:.4,height:s6,type:Vh.DEFAULT,text:"open link"},e))}function b6(e){return kh(Uh,o6({name:"Refresh Button",scale:a6,width:.4,height:s6,type:Vh.DEFAULT,text:"refresh"},e))}function y6(e){return kh(Uh,o6({name:"Clone Button",scale:a6,width:.4,height:s6,type:Vh.DEFAULT,text:"clone"},e))}function w6(e){return kh(Uh,o6({name:"Rotate Button",scale:a6,width:.4,height:s6,type:Vh.ACTION,text:"rotate"},e))}function _6(e){return kh(Uh,o6({name:"Mirror Button",scale:a6,width:.4,height:s6,type:Vh.ACTION,text:"mirror"},e))}function E6(e){return kh(Uh,o6({name:"Scale Button",scale:a6,width:.4,height:s6,type:Vh.ACTION,text:"scale"},e))}const A6={pin:[0,.125,l6],unpin:[0,.125,l6],focus:[-.25,.375,l6],track:[.25,.375,l6],remove:[0,-.375,l6],drop:[0,-.625,l6],inspect:[0,-.625,l6],deserializeDrawing:[-.3,-.625,l6],openLink:[.43,-.375,l6],refresh:[.43,-.6,l6],clone:[-.43,-.375,l6],rotate:[-.3,-.125,l6],mirror:[0,-.125,l6],scale:[.3,-.125,l6]};function S6(){const e={pin:Mh(),unpin:Mh(),focus:Mh(),track:Mh(),remove:Mh(),drop:Mh(),inspect:Mh(),deserializeDrawing:Mh(),openLink:Mh(),refresh:Mh(),clone:Mh(),rotate:Mh(),mirror:Mh(),scale:Mh()};return kh("entity",{name:"Interactable Object Menu",objectMenu:{pinButtonRef:e.pin,unpinButtonRef:e.unpin,cameraFocusButtonRef:e.focus,cameraTrackButtonRef:e.track,removeButtonRef:e.remove,dropButtonRef:e.drop,inspectButtonRef:e.inspect,deserializeDrawingButtonRef:e.deserializeDrawing,openLinkButtonRef:e.openLink,refreshButtonRef:e.refresh,cloneButtonRef:e.clone,rotateButtonRef:e.rotate,mirrorButtonRef:e.mirror,scaleButtonRef:e.scale}},kh(c6,{ref:e.pin,position:A6.pin}),kh(d6,{ref:e.unpin,position:A6.unpin}),kh(u6,{ref:e.focus,position:A6.focus}),kh(h6,{ref:e.track,position:A6.track}),kh(p6,{ref:e.remove,position:A6.remove}),kh(m6,{ref:e.drop,position:A6.drop}),kh(f6,{ref:e.inspect,position:A6.inspect}),kh(g6,{ref:e.deserializeDrawing,position:A6.deserializeDrawing}),kh(v6,{ref:e.openLink,position:A6.openLink}),kh(b6,{ref:e.refresh,position:A6.refresh}),kh(y6,{ref:e.clone,position:A6.clone}),kh(w6,{ref:e.rotate,position:A6.rotate}),kh(_6,{ref:e.mirror,position:A6.mirror}),kh(E6,{ref:e.scale,position:A6.scale}))}function x6(){return x6=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},x6.apply(this,arguments)}const M6=[1,1,1],P6=[0,0,.001];function C6(e){return kh(Uh,x6({name:"Link Button",height:.2,scale:M6,text:"open link",type:Vh.ACTION,width:.6},e))}function k6(){return k6=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},k6.apply(this,arguments)}const O6=[.4,.4,.4];function T6(e){return kh(Uh,k6({name:e.name,scale:O6,width:.3,height:.2,type:Vh.ACTION},e))}const R6=.001,D6=[-.45,0,R6],j6=[.45,0,R6],L6=[0,-.45,R6],I6=new wt.Color(.1,.1,.1);var N6=n.p+"assets/models/spawn-point-7766815ef106614477e6..glb";function F6(e,t,n,i,r,o,s){try{var a=e[o](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(i,r)}let B6;function V6(){var e;return e=function*(){B6=(yield ja(N6,null,!1)).scene},V6=function(){var t=this,n=arguments;return new Promise((function(i,r){var o=e.apply(t,n);function s(e){F6(o,i,r,s,a,"next",e)}function a(e){F6(o,i,r,s,a,"throw",e)}s(void 0)}))},V6.apply(this,arguments)}n(51274),n(20882),AFRAME.registerComponent("set-unowned-body-kinematic",{init(){this.setBodyKinematic=this.setBodyKinematic.bind(this)},play(){this.el.addEventListener("ownership-lost",this.setBodyKinematic),this.didThisOnce||(this.didThisOnce=!0,this.el.components.networked&&NAF.utils.isMine(this.el)||this.setBodyKinematic())},pause(){this.el.removeEventListener("ownership-lost",this.setBodyKinematic)},setBodyKinematic(){this.el.setAttribute("body-helper",{type:"kinematic",collisionFilterMask:Ue.UNOWNED_INTERACTABLE})}}),AFRAME.registerComponent("scalable-when-grabbed",{tick:function(){const e=AFRAME.scenes[0].systems.userinput,t=AFRAME.scenes[0].systems.interaction;let n;t.state.rightRemote.held===this.el&&(n=e.get(zm.actions.cursor.right.scaleGrabbedGrabbable)),t.state.leftRemote.held===this.el&&(n=e.get(zm.actions.cursor.left.scaleGrabbedGrabbable)),n&&(this.el.object3D.scale.addScalar(n).clampScalar(.1,100),this.el.object3D.matrixNeedsUpdate=!0)}}),n(94696),n(24842),n(69921);var U6=n(99477);const H6={"player-right-controller":{startDrawing:zm.actions.rightHand.startDrawing,stopDrawing:zm.actions.rightHand.stopDrawing,undoDrawing:zm.actions.rightHand.undoDrawing,switchDrawMode:zm.actions.rightHand.switchDrawMode,penNextColor:zm.actions.rightHand.penNextColor,penPrevColor:zm.actions.rightHand.penPrevColor,scalePenTip:zm.actions.rightHand.scalePenTip},"player-left-controller":{startDrawing:zm.actions.leftHand.startDrawing,stopDrawing:zm.actions.leftHand.stopDrawing,undoDrawing:zm.actions.leftHand.undoDrawing,switchDrawMode:zm.actions.leftHand.switchDrawMode,penNextColor:zm.actions.leftHand.penNextColor,penPrevColor:zm.actions.leftHand.penPrevColor,scalePenTip:zm.actions.leftHand.scalePenTip},"right-cursor":{pose:zm.actions.cursor.right.pose,startDrawing:zm.actions.cursor.right.startDrawing,stopDrawing:zm.actions.cursor.right.stopDrawing,undoDrawing:zm.actions.cursor.right.undoDrawing,penNextColor:zm.actions.cursor.right.penNextColor,penPrevColor:zm.actions.cursor.right.penPrevColor,scalePenTip:zm.actions.cursor.right.scalePenTip},"left-cursor":{pose:zm.actions.cursor.left.pose,startDrawing:zm.actions.cursor.left.startDrawing,stopDrawing:zm.actions.cursor.left.stopDrawing,undoDrawing:zm.actions.cursor.left.undoDrawing,penNextColor:zm.actions.cursor.left.penNextColor,penPrevColor:zm.actions.cursor.left.penPrevColor,scalePenTip:zm.actions.cursor.left.scalePenTip}};function z6(e,t,n){return Math.abs(t.x-n.x)<e&&Math.abs(t.y-n.y)<e&&Math.abs(t.z-n.z)<e}AFRAME.registerComponent("pen",{schema:{drawFrequency:{default:5},minDistanceBetweenPoints:{default:.01},camera:{type:"selector"},drawingManager:{type:"string"},color:{type:"color",default:"#FF0033"},availableColors:{default:["#FF0033","#FFFF00","#0099FF","#00FF33","#9900FF","#FF6600","#8D5524","#C68642","#E0AC69","#F1C27D","#FFDBAC","#FFFFFF","#222222","#111111","#000000"]},radius:{default:.01},minRadius:{default:.005},maxRadius:{default:.2},far:{default:100},near:{default:.01},drawMode:{default:0,oneOf:[0,1]},penVisible:{default:!0},penTipPosition:{default:{x:0,y:0,z:0}}},init(){this.timeSinceLastDraw=0,this.lastPosition=new U6.Vector3,this.lastPosition.copy(this.el.object3D.position),this.direction=new U6.Vector3(1,0,0),this.currentDrawing=null,this.normal=new U6.Vector3,this.worldPosition=new U6.Vector3,this.colorIndex=0,this.grabbed=!1,this.raycaster=new U6.Raycaster,this.raycaster.firstHitOnly=!0,this.originalPosition=this.el.object3D.position.clone(),this.lastIntersectionDistance=0,this.targets=[],this.setDirty=this.setDirty.bind(this),this.dirty=!0;let e=new U6.MeshStandardMaterial;e=yo(e,window.APP.store.state.preferences.materialQualitySetting),this.penTip=new U6.Mesh(new U6.SphereBufferGeometry(1,16,12),e),this.penTip.scale.setScalar(this.data.radius/this.el.parentEl.object3D.scale.x),this.penTip.matrixNeedsUpdate=!0,this.el.setObject3D("mesh",this.penTip),this.penLaserAttributesUpdated=!1,this.penLaserAttributes={color:"#FF0033",laserVisible:!1,laserInHand:!1,laserOrigin:{x:0,y:0,z:0},remoteLaserOrigin:{x:0,y:0,z:0},laserTarget:{x:0,y:0,z:0}},this.observer=new MutationObserver(this.setDirty),L().then((()=>{const e=document.querySelector("a-scene");this.observer.observe(e,{childList:!0,attributes:!0,subtree:!0}),e.addEventListener("object3dset",this.setDirty),e.addEventListener("object3dremove",this.setDirty)})),this.penSystem=this.el.sceneEl.systems["pen-tools"],this.penSystem.register(this.el)},play(){this.drawingManager=document.querySelector(this.data.drawingManager).components["drawing-manager"]},update(e){e.color!=this.data.color&&(this.penTip.material.color.set(this.data.color),this.penLaserAttributes.color=this.data.color,this.el.setAttribute("pen-laser",{color:this.data.color})),e.radius!=this.data.radius&&this.el.setAttribute("radius",this.data.radius),this.raycaster.far=this.data.far,this.raycaster.near=this.data.near},tick(e,t){const n=this.el.parentEl.components.networked.initialized&&this.el.parentEl.components.networked.isMine();if(this.penTip.material.visible!==n&&(this.penTip.material.visible=n),n){this._handleInput();const e=1!==this.data.drawMode||"right-cursor"!==this.grabberId&&"left-cursor"!==this.grabberId?null:AFRAME.scenes[0].systems.userinput.get(H6[this.grabberId].pose),n=this._getIntersection(e);this._updatePenTip(n);const i=1===this.data.drawMode&&!!n,r=this.el.sceneEl.is("vr-mode")&&i;this.penLaserAttributes.laserVisible!==i&&(this.penLaserAttributes.laserVisible=i,this.penLaserAttributesUpdated=!0),this.penLaserAttributes.laserInHand!==r&&(this.penLaserAttributes.laserInHand=r,this.penLaserAttributesUpdated=!0),i&&this._updateLaser(e,n);const o="left-cursor"!==this.grabberId&&"right-cursor"!==this.grabberId||!n;this._setPenVisible(o),this.el.setAttribute("pen",{penVisible:o}),this._doDraw(n,t),this.penLaserAttributesUpdated&&(this.penLaserAttributesUpdated=!1,this.el.setAttribute("pen-laser",this.penLaserAttributes,!0))}else this._setPenVisible(this.data.penVisible)},_handleInput(){const e=AFRAME.scenes[0].systems.userinput,t=AFRAME.scenes[0].systems.interaction;if(t.state.rightHand.held===this.el.parentNode?this.grabberId="player-right-controller":t.state.leftHand.held===this.el.parentNode?this.grabberId="player-left-controller":t.state.rightRemote.held===this.el.parentNode?(this.grabberId="right-cursor",this.data.drawMode=1):t.state.leftRemote.held===this.el.parentNode?(this.grabberId="left-cursor",this.data.drawMode=1):this.grabberId=null,this.grabberId&&H6[this.grabberId]){const t=this.el.sceneEl.systems["hubs-systems"].soundEffectsSystem,n=H6[this.grabberId];e.get(n.startDrawing)&&(this._startDraw(),t.playSoundOneShot(wm)),e.get(n.stopDrawing)&&(this._endDraw(),t.playSoundOneShot(dm));const i=e.get(n.scalePenTip);i&&this._changeRadius(i),e.get(n.penNextColor)&&(this._changeColor(1),t.playSoundOneShot(hm)),e.get(n.penPrevColor)&&(this._changeColor(-1),t.playSoundOneShot(hm)),e.get(n.undoDrawing)&&(this._undoDraw(),t.playSoundOneShot(um)),n.switchDrawMode&&e.get(n.switchDrawMode)&&(this.data.drawMode=0===this.data.drawMode?1:0)}},_getIntersection:(()=>{const e=[],t=new U6.Quaternion;return function(n){return e.length=0,1===this.data.drawMode&&(n?(this.raycaster.ray.origin.copy(n.position),this.raycaster.ray.direction.copy(n.direction)):null!==this.grabberId&&(So(this.el.parentEl.object3D,this.raycaster.ray.origin),i=this.el.parentEl.object3D,r=t,i.updateMatrices(),i.matrixWorld.decompose(Ao,r,Ao),this.raycaster.ray.direction.set(0,-1,0),this.raycaster.ray.direction.applyQuaternion(t)),null!==this.grabberId)?(this.raycaster.intersectObjects(this.targets,!0,e),e[0]):null;var i,r}})(),_updatePenTip(e){1===this.data.drawMode&&e?(this.el.object3D.position.copy(e.point),this.el.parentEl.object3D.worldToLocal(this.el.object3D.position),this.el.object3D.matrixNeedsUpdate=!0,this.worldPosition.copy(e.point)):(this.el.object3D.position.copy(this.originalPosition),this.el.object3D.matrixNeedsUpdate=!0,So(this.el.object3D,this.worldPosition))},_updateLaser:(()=>{const e=new U6.Vector3,t=new U6.Vector3,n=new U6.Vector3,i=new U6.Vector3;return function(r,o){r?e.copy(r.position):this.el.parentEl.object3D.getWorldPosition(e),t.copy(o.point),this.el.sceneEl.is("vr-mode")?i.copy(e):(this.data.camera.object3D.getWorldPosition(n),i.subVectors(t,n).normalize().multiplyScalar(.5),i.add(n)),z6(.001,this.penLaserAttributes.laserOrigin,e)||(this.penLaserAttributes.laserOrigin.x=e.x,this.penLaserAttributes.laserOrigin.y=e.y,this.penLaserAttributes.laserOrigin.z=e.z,this.penLaserAttributesUpdated=!0),z6(.001,this.penLaserAttributes.remoteLaserOrigin,i)||(this.penLaserAttributes.remoteLaserOrigin.x=i.x,this.penLaserAttributes.remoteLaserOrigin.y=i.y,this.penLaserAttributes.remoteLaserOrigin.z=i.z,this.penLaserAttributesUpdated=!0),z6(.001,this.penLaserAttributes.laserTarget,t)||(this.penLaserAttributes.laserTarget.x=t.x,this.penLaserAttributes.laserTarget.y=t.y,this.penLaserAttributes.laserTarget.z=t.z,this.penLaserAttributesUpdated=!0)}})(),_doDraw(e,t){if(this.currentDrawing&&this.lastIntersectedObject!==(e?e.object:null)&&(!e||Math.abs(e.distance-this.lastIntersectionDistance)>1)&&(this.worldPosition.copy(this.lastPosition),this._endDraw()),this.lastIntersectionDistance=e?e.distance:0,this.lastIntersectedObject=e?e.object:null,z6(.005,this.worldPosition,this.lastPosition)||(this.direction.subVectors(this.worldPosition,this.lastPosition).normalize(),this.lastPosition.copy(this.worldPosition)),this.currentDrawing){const e=this.timeSinceLastDraw+t;e>=this.data.drawFrequency&&this.currentDrawing.getLastPoint().distanceTo(this.worldPosition)>=this.data.minDistanceBetweenPoints&&(this._getNormal(this.normal,this.worldPosition,this.direction),this.currentDrawing.draw(this.worldPosition,this.direction,this.normal,this.data.color,this.data.radius)),this.timeSinceLastDraw=e%this.data.drawFrequency}this.currentDrawing&&!this.grabberId&&this._endDraw(),this.dirty&&(this.populateEntities(this.targets),this.dirty=!1)},_setPenVisible(e){this.el.parentEl.object3DMap.mesh&&this.el.parentEl.object3DMap.mesh.visible!==e&&(this.el.parentEl.object3DMap.mesh.visible=e)},_getNormal:(()=>{const e=new U6.Vector3;return function(t,n,i){e.subVectors(n,this.data.camera.object3D.position).normalize(),t.crossVectors(i,e)}})(),_startDraw(){this.drawingManager.getDrawing(this).then((e=>{this.currentDrawing=e,this._getNormal(this.normal,this.worldPosition,this.direction),this.currentDrawing.startDraw(this.worldPosition,this.direction,this.normal,this.data.color,this.data.radius)}))},_endDraw(){this.currentDrawing&&(this.timeSinceLastDraw=0,this._getNormal(this.normal,this.worldPosition,this.direction),this.currentDrawing.endDraw(this.worldPosition,this.direction,this.normal),this.drawingManager.returnDrawing(this),this.currentDrawing=null)},_undoDraw(){this.drawingManager.getDrawing(this).then((e=>{e.undoDraw(),this.drawingManager.returnDrawing(this)}))},_changeColor(e){this.colorIndex=(this.colorIndex+e+this.data.availableColors.length)%this.data.availableColors.length,this.data.color=this.data.availableColors[this.colorIndex],this.penTip.material.color.set(this.data.color),this.penLaserAttributes.color=this.data.color,this.penLaserAttributesUpdated=!0},_changeRadius(e){this.data.radius=Math.max(this.data.minRadius,Math.min(this.data.radius+e,this.data.maxRadius)),this.penTip.scale.setScalar(this.data.radius/this.el.parentEl.object3D.scale.x),this.penTip.matrixNeedsUpdate=!0},setDirty(){this.dirty=!0},populateEntities(e){e.length=0;const t=AFRAME.scenes[0].querySelectorAll(".collidable, .interactable, #environment-root");for(let n=0;n<t.length;n++)!t[n].classList.contains("pen")&&t[n].object3D&&e.push(t[n].object3D)},remove(){this.observer.disconnect(),AFRAME.scenes[0].removeEventListener("object3dset",this.setDirty),AFRAME.scenes[0].removeEventListener("object3dremove",this.setDirty),this.penSystem.deregister(this.el)}});var W6=n(99477);const q6=n(44586);function Z6(e,t,n){return Math.abs(t.x-n.x)<e&&Math.abs(t.y-n.y)<e&&Math.abs(t.z-n.z)<e}AFRAME.registerComponent("pen-laser",{schema:{color:{type:"color",default:"#FF0033"},laserVisible:{default:!1},laserInHand:{default:!1},laserOrigin:{default:{x:0,y:0,z:0}},remoteLaserOrigin:{default:{x:0,y:0,z:0}},laserTarget:{default:{x:0,y:0,z:0}}},init(){let e=new W6.MeshStandardMaterial({color:"red",opacity:.5,transparent:!0,visible:!0});e=yo(e,window.APP.store.state.preferences.materialQualitySetting);const t=e.clone();t.onBeforeRender=e.onBeforeRender;const n=new W6.LineCurve3(new W6.Vector3(0,0,0),new W6.Vector3(0,0,2)),i=new W6.TubeBufferGeometry(n,2,.003,8,!0);this.laser=new W6.Mesh(i,e),this.laserTip=new W6.Mesh(new W6.SphereBufferGeometry(1,8,6),t),this.laserTip.scale.setScalar(.01),this.laserTip.matrixNeedsUpdate=!0,this.laser.raycast=function(){},this.el.sceneEl.setObject3D(`pen-laser-${this.laser.uuid}`,this.laser),this.el.sceneEl.setObject3D(`pen-laser-tip-${this.laser.uuid}`,this.laserTip),this.originBuffer=new q6(q6.MODE_LERP,.1),this.targetBuffer=new q6(q6.MODE_LERP,.1)},update:(()=>{const e=new W6.Vector3,t=new W6.Vector3;return function(n){n.color!=this.data.color&&(this.laser.material.color.set(this.data.color),this.laserTip.material.color.set(this.data.color)),n.remoteLaserOrigin&&!Z6(.001,n.remoteLaserOrigin,this.data.remoteLaserOrigin)&&this.originBuffer.setPosition(e.set(this.data.remoteLaserOrigin.x,this.data.remoteLaserOrigin.y,this.data.remoteLaserOrigin.z)),n.laserTarget&&!Z6(.001,n.laserTarget,this.data.laserTarget)&&this.targetBuffer.setPosition(t.set(this.data.laserTarget.x,this.data.laserTarget.y,this.data.laserTarget.z))}})(),tick:(()=>{const e=new W6.Vector3,t=new W6.Vector3;return function(n,i){const r=this.el.parentEl.components.networked.initialized&&this.el.parentEl.components.networked.isMine();let o=!1;r&&this.data.laserVisible?(e.copy(this.data.laserOrigin),this.data.laserInHand||(e.y=e.y-.4),t.copy(this.data.laserTarget),o=!0):!r&&this.data.laserVisible&&(this.originBuffer.update(i),this.targetBuffer.update(i),e.copy(this.originBuffer.getPosition()),t.copy(this.targetBuffer.getPosition()),o=!0),o&&(this.laser.position.copy(e),this.laser.lookAt(t),this.laser.scale.set(1,1,e.distanceTo(t)),this.laser.matrixNeedsUpdate=!0,this.laserTip.position.copy(t),this.laserTip.matrixNeedsUpdate=!0),this.laser.material.visible!==o&&(this.laser.material.visible=o);const s=!(!o||r&&this.data.laserVisible);this.laserTip.material.visible!==s&&(this.laserTip.material.visible=s)}})(),remove(){this.el.sceneEl.removeObject3D(`pen-laser-${this.laser.uuid}`),this.el.sceneEl.removeObject3D(`pen-laser-tip-${this.laser.uuid}`)}});var G6=n(99477);class Y6{constructor(e,t){this.material=e,this.maxBufferSize=t,this.geometries=[],this.current=null,this.drawing=new G6.Object3D,this.addBuffer()}remove(e,t){if(this.idx.position>t.position)for(const n in this.idx){const i="index"===n?1:3;let r=e[n]*i;const o=(t[n]+1)*i,s=this.idx[n]*i;for(let e=o;e<s;e++)"index"===n?this.current.index.array[r++]=this.current.index.array[e]-t.position-1:this.current.attributes[n].array[r++]=this.current.attributes[n].array[e];const a=t[n]-e[n]+1;this.idx[n]-=a}else for(const n in this.idx){const i=t[n]-e[n];this.idx[n]-=i}this.update()}undo(e){this.idx=e,this.update()}addBuffer(){const e=new G6.BufferGeometry,t=new Float32Array(3*this.maxBufferSize),n=new Float32Array(3*this.maxBufferSize),i=new Float32Array(3*this.maxBufferSize),r=new Uint32Array(3*this.maxBufferSize),o=new G6.Mesh(e,this.material);o.frustumCulled=!1,o.vertices=t;const s=new G6.Object3D;this.drawing.add(s),s.add(o),e.setDrawRange(0,0),e.setAttribute("position",new G6.BufferAttribute(t,3).setUsage(G6.DynamicDrawUsage)),e.setAttribute("normal",new G6.BufferAttribute(n,3).setUsage(G6.DynamicDrawUsage)),e.setAttribute("color",new G6.BufferAttribute(i,3).setUsage(G6.DynamicDrawUsage)),e.setIndex(new G6.BufferAttribute(r,1).setUsage(G6.DynamicDrawUsage)),this.previous=null,this.geometries.length>0&&(this.previous=this.current),this.idx={position:0,normal:0,color:0,index:0},this.geometries.push(e),this.current=e}addColor(e,t,n){this.current.attributes.color.setXYZ(this.idx.color++,e,t,n)}addNormal(e,t,n){this.current.attributes.normal.setXYZ(this.idx.normal++,e,t,n)}addVertex(e,t,n){const i=this.current.attributes.position;this.idx.position===i.count&&console.error("maxBufferSize limit exceeded"),i.setXYZ(this.idx.position++,e,t,n)}addIndex(e,t,n){this.current.index.setXYZ(this.idx.index,e,t,n),this.idx.index+=3}update(){this.current.setDrawRange(0,this.idx.index),this.current.attributes.color.needsUpdate=!0,this.current.attributes.normal.needsUpdate=!0,this.current.attributes.position.needsUpdate=!0,this.current.index.needsUpdate=!0}computeBoundingSpheres(){for(let e=0;e<this.geometries.length;e++)this.geometries[e].computeBoundingSphere()}}class Q6{constructor(){this.sharedBuffers={}}addSharedBuffer(e,t,n){this.sharedBuffers[e]=new Y6(t,n)}getSharedBuffer(e){return this.sharedBuffers[e]}}var X6=n(94878),K6=n(99477);function $6(e,t,n,i,r,o,s){try{var a=e[o](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(i,r)}function J6(e,t,n,i){let r=n-1,o=-1;for(;r+1<=i;)t[++o]=e[++r]}AFRAME.registerComponent("networked-drawing",{schema:{segments:{default:8},defaultRadius:{default:.01},maxDrawTimeout:{default:6e5},maxLines:{default:50},maxPointsPerLine:{default:250}},init(){this._receiveData=this._receiveData.bind(this),this.networkBuffer=[],this.sendNetworkBufferQueue=[],this.drawStarted=!1,this.lineStarted=!1,this.remoteLineStarted=!1,this.receivedBufferParts=0,this.bufferIndex=0,this.connectedToOwner=!1,this.networkBufferInitialized=!1,this.color=new K6.Color,this.radius=this.data.defaultRadius,this.segments=this.data.segments;let e=new K6.MeshStandardMaterial({vertexColors:!0});e=yo(e,window.APP.store.state.preferences.materialQualitySetting),this.sharedBufferGeometryManager=new Q6;const t=Math.round(20*this.data.maxPointsPerLine*(this.data.maxLines+1)*.333);this.sharedBufferGeometryManager.addSharedBuffer(0,e,t),this.lastPoint=new K6.Vector3,this.lastSegments=[],this.currentSegments=[];for(let e=0;e<this.segments;e++)this.lastSegments[e]={position:new K6.Vector3,normal:new K6.Vector3},this.currentSegments[e]={position:new K6.Vector3,normal:new K6.Vector3};this.sharedBuffer=this.sharedBufferGeometryManager.getSharedBuffer(0),this.drawing=this.sharedBuffer.drawing,this.el.setObject3D("mesh",this.drawing),this.prevIdx=Object.assign({},this.sharedBuffer.idx),this.idx=Object.assign({},this.sharedBuffer.idx),this.vertexCount=0,this.indexCount=0,this.networkBufferCount=0,this.currentPointCount=0,this.invalidPointRead=!1,this.lastReadPointCount=0,this.networkBufferHistory=[],NAF.connection.onConnect((()=>{NAF.utils.getNetworkedEntity(this.el).then((e=>{this.networkedEl=e,this.networkId=NAF.utils.getNetworkId(this.networkedEl),this.drawingId="drawing-"+this.networkId,NAF.connection.subscribeToDataChannel(this.drawingId,this._receiveData)}))}))},play(){AFRAME.scenes[0].systems["hubs-systems"].drawingMenuSystem.registerDrawingMenu(this.el)},remove(){NAF.connection.unsubscribeToDataChannel(this.drawingId,this._receiveData),this.drawStarted=!1,this.el.removeObject3D("mesh"),this.el.sceneEl.querySelector("#drawing-manager").components["drawing-manager"].destroyDrawing(this),AFRAME.scenes[0].systems["hubs-systems"].drawingMenuSystem.unregisterDrawingMenu(this.el)},tick(e){const t=NAF.connection.isConnected()&&this.networkedEl,n=t&&NAF.utils.isMine(this.networkedEl);if(!this.connectedToOwner&&t){const e=NAF.utils.getNetworkOwner(this.networkedEl);!n&&NAF.connection.hasActiveDataChannel(e)&&(NAF.connection.sendDataGuaranteed(e,this.drawingId,{type:0,clientId:NAF.clientId}),this.connectedToOwner=!0)}if(this.networkBuffer.length>0&&t&&(n?this.bufferIndex<this.networkBuffer.length&&this._broadcastDrawing():this._drawFromNetwork()),n&&this.sendNetworkBufferQueue.length>0){const e=[];for(let t=0;t<this.sendNetworkBufferQueue.length;t++)NAF.connection.hasActiveDataChannel(this.sendNetworkBufferQueue[t])&&e.push(this.sendNetworkBufferQueue[t]);for(let t=0;t<e.length;t++){const n=this.sendNetworkBufferQueue.indexOf(e[t]);this._sendNetworkBuffer(e[t]),this.sendNetworkBufferQueue.splice(n,1)}}this._deleteExpiredLines(e)},cloneMesh(e){const t=e.current,n=e.idx,i=new K6.BufferGeometry,r=t.getAttribute("position").array.subarray(0,3*n.position),o=t.getAttribute("color").array.subarray(0,3*n.color),s=t.getAttribute("normal").array.subarray(0,3*n.normal),a=t.index.array.subarray(0,n.index);i.setAttribute("position",new K6.BufferAttribute(r,3)),i.setAttribute("color",new K6.BufferAttribute(o,3)),i.setAttribute("normal",new K6.BufferAttribute(s,3)),i.setIndex(new K6.BufferAttribute(a,1));const l=new K6.MeshStandardMaterial({vertexColors:K6.VertexColors});return new K6.Mesh(i,l)},serializeDrawing(){var e,t=this;return(e=function*(){const e=new X6.M,n=t.cloneMesh(t.sharedBuffer);n.userData.gltfExtensions={MOZ_hubs_components:{version:4,"networked-drawing-buffer":{buffer:t.networkBuffer}}};const i=yield new Promise(((t,i)=>{e.parse(n,t,i,{binary:!0,includeCustomExtensions:!0})})),r=new File([i],"drawing.glb",{type:"model/gltf-binary"}),{entity:o}=Nl(r,"#interactable-media",rl,"drawing",!1,!1),s=new K6.Vector3(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),a=new K6.Vector3(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY),l=new K6.Vector3,c=t.sharedBuffer.current.attributes.position;for(let e=0;e<t.sharedBuffer.idx.position;e++)l.set(c.getX(e),c.getY(e),c.getZ(e)),s.min(l),a.max(l);o.object3D.position.addVectors(s,a).multiplyScalar(.5),o.object3D.matrixNeedsUpdate=!0},function(){var t=this,n=arguments;return new Promise((function(i,r){var o=e.apply(t,n);function s(e){$6(o,i,r,s,a,"next",e)}function a(e){$6(o,i,r,s,a,"throw",e)}s(void 0)}))})()},deserializeDrawing:(()=>{const e=new K6.Vector3,t=new K6.Vector3,n=new K6.Vector3;return function(i){let r=i[0];for("-"===r&&(this._undoDraw(),i.shift(),r=i[0]);null!=r&&i.length>=11;)e.set(i[1],i[2],i[3]),t.set(i[4],i[5],i[6]),this.radius=Math.round(1e3*t.length())/1e3,t.normalize(),n.set(i[7],i[8],i[9]),this.color.setHex(Math.round(n.length())-1),n.normalize(),i.splice(0,10),this.drawStarted?null!==i[0]&&this.draw(e,t,n):this.startDraw(e,t,n),null===i[0]&&(this.endDraw(e,t,n),i.shift())}})(),_broadcastDrawing:(()=>{const e=[];return function(){e.length=0,J6(this.networkBuffer,e,this.bufferIndex,this.networkBuffer.length-1);let t=-1;for(;-1!=(t=this.networkBuffer.indexOf("-"));)this.networkBuffer.splice(t,1);this.bufferIndex=this.networkBuffer.length,NAF.connection.broadcastDataGuaranteed(this.drawingId,{type:1,buffer:e})}})(),_drawFromNetwork:(()=>{const e=new K6.Vector3,t=new K6.Vector3,n=new K6.Vector3;return function(){let i=this.networkBuffer[0];"-"===i&&(this._undoDraw(),this.networkBuffer.shift(),i=this.networkBuffer[0]);let r=!1;for(;null!=i&&this.networkBuffer.length>=11;){const i=this.networkBuffer[0];i!==this.lastReadPointCount+1&&(this.invalidPointRead=!0,console.error(`Draw networking error: ID ${this.drawingId} expected point ${this.lastReadPointCount+1} but received ${i}`)),this.lastReadPointCount=i,e.set(this.networkBuffer[1],this.networkBuffer[2],this.networkBuffer[3]),t.set(this.networkBuffer[4],this.networkBuffer[5],this.networkBuffer[6]),this.radius=Math.round(1e3*t.length())/1e3,t.normalize(),n.set(this.networkBuffer[7],this.networkBuffer[8],this.networkBuffer[9]),this.color.setHex(Math.round(n.length())-1),n.normalize(),this.networkBuffer.splice(0,10),this.remoteLineStarted||(this.startDraw(e,t,n),this.remoteLineStarted=!0),null===this.networkBuffer[0]?(this.invalidPointRead||this._endDraw(e,t,n),this.remoteLineStarted=!1,this.networkBuffer.shift(),this.lastReadPointCount=0,this.invalidPointRead=!1):this.invalidPointRead||(this._draw(e,t,n),r=!0)}r&&this._updateBuffer()}})(),_deleteExpiredLines(e){const t=this.networkBufferHistory.length;if(t>0){const n=this.networkBufferHistory[0].time;if(t>this.data.maxLines||n+this.data.maxDrawTimeout<=e){const e=this.networkBufferHistory[0];this.idx.position=e.vertexCount,this.idx.normal=e.vertexCount,this.idx.color=e.vertexCount,this.idx.index=e.indexCount,this.sharedBuffer.remove(this.prevIdx,this.idx),this.networkBufferHistory.shift(),this.networkedEl&&NAF.utils.isMine(this.networkedEl)&&(this.networkBuffer.splice(0,e.networkBufferCount),this.bufferIndex-=e.networkBufferCount)}}},_sendNetworkBuffer:(()=>{const e=[],t=3e3;return function(n){if(NAF.utils.isMine(this.networkedEl))if(this.networkBuffer.length<=t)NAF.connection.sendDataGuaranteed(n,this.drawingId,{type:2,parts:1,buffer:this.networkBuffer});else{let i=0,r=0;for(;r<this.networkBuffer.length;)r=Math.min(r+t,this.networkBuffer.length),e.length=0,J6(this.networkBuffer,e,i,r-1),i=r,NAF.connection.sendDataGuaranteed(n,this.drawingId,{type:2,parts:Math.ceil(this.networkBuffer.length/t),buffer:e})}}})(),_receiveData(e,t,n){switch(n.type){case 0:this.sendNetworkBufferQueue.push(n.clientId);break;case 1:this.networkBufferInitialized&&this.networkBuffer.push.apply(this.networkBuffer,n.buffer);break;case 2:this.networkBuffer.push.apply(this.networkBuffer,n.buffer),++this.receivedBufferParts>=n.parts&&(this.networkBufferInitialized=!0)}},getLastPoint(){return this.lastPoint},startDraw(e,t,n,i,r){NAF.connection.isConnected()&&(this.drawStarted=!0,i&&this.color.set(i),r&&(this.radius=r),this.lastPoint.copy(e),this._addToNetworkBuffer(e,t,n))},draw(e,t,n,i,r){NAF.connection.isConnected()&&this.drawStarted&&(i&&i!="#"+this.color.getHexString().toUpperCase()&&this.color.set(i),r&&(this.radius=r),this._addToNetworkBuffer(e,t,n),this._draw(e,t,n),this._updateBuffer())},_draw:(()=>{const e=new K6.Vector3;return function(t,n,i,r){if(void 0===r&&(r=1),this.lineStarted)this._generateSegments(this.currentSegments,t,n,i,this.radius*r),this._drawCylinder(),this.currentPointCount>this.data.maxPointsPerLine&&(this._drawProjectedEndCap(t,n),this._endLine());else{this._generateSegments(this.lastSegments,t,n,i,this.radius*r),e.copy(n).negate();for(let t=0;t<this.segments;t++)this.lastSegments[t].normal.add(e).multiplyScalar(.5);this._drawStartCap(this.lastPoint,this.lastSegments,e),this.lineStarted=!0}this.lastPoint.copy(t)}})(),undoDraw(){NAF.connection.isConnected()&&!this.drawStarted&&(this._undoDraw(),this._pushToNetworkBuffer("-"))},_undoDraw(){const e=this.networkBufferHistory.length;if(e>0){const t=this.networkBufferHistory.pop();this.idx.position=0,this.idx.normal=0,this.idx.color=0,this.idx.index=0,e>1&&(this.idx.position=this.sharedBuffer.idx.position-t.vertexCount-1,this.idx.normal=this.sharedBuffer.idx.normal-t.vertexCount-1,this.idx.color=this.sharedBuffer.idx.color-t.vertexCount-1,this.idx.index=this.sharedBuffer.idx.index-t.indexCount-1),this.sharedBuffer.remove(this.idx,this.sharedBuffer.idx),this.networkedEl&&NAF.utils.isMine(this.networkedEl)&&(this.networkBuffer.splice(this.networkBuffer.length-t.networkBufferCount,t.networkBufferCount),this.bufferIndex-=t.networkBufferCount)}},endDraw(e,t,n){this._endDraw(e,t,n),this._updateBuffer()},_endDraw(e,t,n){!this.lineStarted&&this.drawStarted?this._drawPoint(e):this.lineStarted&&this.drawStarted&&(this._addToNetworkBuffer(e,t,n),this._draw(e,t,n),this._drawProjectedEndCap(e,t)),this._endLine()},_drawProjectedEndCap:(()=>{const e=new K6.Vector3,t=new K6.Vector3;return function(n,i){this.lineStarted&&this.drawStarted&&(e.copy(i).multiplyScalar(this.radius),t.copy(n).add(e),this._drawEndCap(t,i))}})(),_endLine(){if(!this.drawStarted)return;this.networkedEl&&NAF.utils.isMine(this.networkedEl)&&this._pushToNetworkBuffer(null);const e={networkBufferCount:this.networkBufferCount,vertexCount:this.vertexCount-1,indexCount:this.indexCount-1,time:APP.world.time.elapsed};this.networkBufferHistory.push(e),this.vertexCount=0,this.indexCount=0,this.networkBufferCount=0,this.currentPointCount=0,this.lineStarted=!1,this.drawStarted=!1,this.sharedBuffer.computeBoundingSpheres()},_addToNetworkBuffer:(()=>{const e=new K6.Vector3,t=new K6.Vector3;return function(n,i,r){this.networkedEl&&NAF.utils.isMine(this.networkedEl)&&(++this.currentPointCount,this._pushToNetworkBuffer(this.currentPointCount),this._pushToNetworkBuffer(n.x),this._pushToNetworkBuffer(n.y),this._pushToNetworkBuffer(n.z),e.copy(i),e.setLength(this.radius),this._pushToNetworkBuffer(e.x),this._pushToNetworkBuffer(e.y),this._pushToNetworkBuffer(e.z),t.copy(r),t.setLength(this.color.getHex()+1),this._pushToNetworkBuffer(t.x),this._pushToNetworkBuffer(t.y),this._pushToNetworkBuffer(t.z))}})(),_pushToNetworkBuffer(e){"-"!==e&&++this.networkBufferCount,this.networkBuffer.push(e)},_drawCylinder(){for(let e=0;e<this.segments;e++)this.currentSegments[e].normal.add(this.lastSegments[e].normal).multiplyScalar(.5);for(let e=0;e<this.segments;e++)this._addVertex(this.currentSegments[e]);const e=this.sharedBuffer.idx.position;for(let t=0;t<this.segments;t++){const n=e-(this.segments+(this.segments-t)),i=t+1<this.segments?n+1:e-2*this.segments,r=e-(this.segments-t),o=t+1<this.segments?r+1:e-this.segments;this._addIndex(r,n,i),this._addIndex(r,i,o)}for(let e=0;e<this.segments;e++)this.lastSegments[e].position.copy(this.currentSegments[e].position),this.lastSegments[e].normal.copy(this.currentSegments[e].normal)},_drawPoint:(()=>{const e=new K6.Vector3(0,1,0),t=new K6.Vector3(0,-1,0),n=new K6.Vector3(1,0,0),i=new K6.Vector3,r=new K6.Vector3;return function(o){i.copy(e).multiplyScalar(.75*this.radius),r.copy(o).add(i),this.lastPoint.copy(r),i.copy(e).multiplyScalar(.5*this.radius),r.copy(o).add(i),this._draw(r,t,n,.75),this._draw(o,t,n),i.copy(t).multiplyScalar(.5*this.radius),r.copy(o).add(i),this._draw(r,t,n,.75),i.copy(t).multiplyScalar(.75*this.radius),r.copy(o).add(i),this._drawEndCap(r,t)}})(),_drawStartCap(e,t,n){this._addVertex({position:e,normal:n});for(let e=0;e<this.segments;e++)this._addVertex(t[e]);const i=this.sharedBuffer.idx.position,r=i-this.segments-1;for(let e=0;e<this.segments;e++){const t=i-(this.segments-e),n=e+1<this.segments?t+1:i-this.segments;this._addIndex(r,n,t)}},_drawEndCap(e,t){this._addVertex({position:e,normal:t});const n=this.sharedBuffer.idx.position,i=n-1;for(let e=0;e<this.segments;e++){const t=n-(this.segments-e)-1,r=e+1<this.segments?t+1:n-this.segments-1;this._addIndex(i,t,r)}},_updateBuffer(){this.sharedBuffer.update()},_addVertex(e){const t=e.position,n=e.normal;this.sharedBuffer.addVertex(t.x,t.y,t.z),this.sharedBuffer.addColor(this.color.r,this.color.g,this.color.b),n?this.sharedBuffer.addNormal(n.x,n.y,n.z):++this.sharedBuffer.idx.normal,++this.vertexCount},_addIndex(e,t,n){this.sharedBuffer.addIndex(e,t,n),this.indexCount+=3},_generateSegments(e,t,n,i,r){const o=2*Math.PI/this.segments;for(let s=0;s<this.segments;s++){const a=e[s].position;this._rotatePointAroundAxis(a,t,n,i,o*s,r),e[s].normal.subVectors(a,t).normalize()}},_rotatePointAroundAxis:(()=>{const e=new K6.Vector3;return function(t,n,i,r,o,s){e.copy(r),e.applyAxisAngle(i,o),t.copy(n).add(e.normalize().multiplyScalar(s))}})()}),AFRAME.registerComponent("networked-drawing-buffer",{schema:{buffer:{default:[]}},play(){const e=this._getDeserializeButton(this.el.parentEl);e&&(e.object3D.visible=!0,e.components["deserialize-drawing-button"].networkedDrawingBuffer=this)},_getDeserializeButton(e){return e.classList.contains("interactable")?e.querySelector(".deserialize-drawing"):e.parentEl?this._getDeserializeButton(e.parentEl):null}}),AFRAME.registerComponent("deserialize-drawing-button",{init(){const e=this.el.sceneEl.querySelector("#drawing-manager").components["drawing-manager"];this.networkedDrawingBuffer=null,this.onClick=()=>{if(!NAF.utils.isMine(this.targetEl)&&!NAF.utils.takeOwnership(this.targetEl))return;const t=()=>{e.drawing.deserializeDrawing(this.networkedDrawingBuffer.data.buffer),Yl(e.drawing.el.object3DMap.mesh,{x:.001,y:.001,z:.001}),this.targetEl.components.pinnable&&this.targetEl.components.pinnable.data.pinned&&window.APP.pinningHelper.setPinned(this.targetEl,!1),this.targetEl.parentEl.removeChild(this.targetEl),this.el.sceneEl.systems["hubs-systems"].soundEffectsSystem.playSoundOneShot(wm)};e.drawing?e.drawing.serializeDrawing().then((()=>{e.drawing.el.parentEl.removeChild(e.drawing.el),e.destroyDrawing(e.drawing),e.createDrawing().then(t)})):e.createDrawing().then(t)},this._updateUI=this._updateUI.bind(this),this._updateUIOnStateChange=this._updateUIOnStateChange.bind(this),this.el.sceneEl.addEventListener("stateadded",this._updateUIOnStateChange),this.el.sceneEl.addEventListener("stateremoved",this._updateUIOnStateChange),NAF.utils.getNetworkedEntity(this.el).then((e=>{this.targetEl=e,this._updateUI(),this.targetEl.addEventListener("pinned",this._updateUI),this.targetEl.addEventListener("unpinned",this._updateUI)}))},play(){this.el.object3D.addEventListener("interact",this.onClick)},pause(){this.el.object3D.removeEventListener("interact",this.onClick)},remove(){this.el.sceneEl.removeEventListener("stateadded",this._updateUIOnStateChange),this.el.sceneEl.removeEventListener("stateremoved",this._updateUIOnStateChange),this.targetEl&&(this.targetEl.removeEventListener("pinned",this._updateUI),this.targetEl.removeEventListener("unpinned",this._updateUI))},_updateUIOnStateChange(e){"frozen"===e.detail&&this._updateUI()},_updateUI(){if(this.networkedDrawingBuffer){const e=this.targetEl.components.pinnable&&this.targetEl.components.pinnable.data.pinned,t=window.APP.hubChannel.can("pin_objects")&&window.APP.hubChannel.signedIn;this.el.object3D.visible=(!e||t)&&window.APP.hubChannel.can("spawn_drawing")}else this.el.object3D.visible=!1}}),n(56493);const e8=Na.tl.ACTIVATION_STATE,t8=Na.tl.TYPE,n8=[e8.ACTIVE_TAG,e8.ISLAND_SLEEPING,e8.WANTS_DEACTIVATION,e8.DISABLE_DEACTIVATION,e8.DISABLE_SIMULATION];AFRAME.registerComponent("body-helper",{schema:{loadedEvent:{default:""},mass:{default:1},gravity:{type:"vec3",default:{x:0,y:-9.8,z:0}},linearDamping:{default:.01},angularDamping:{default:.01},linearSleepingThreshold:{default:1.6},angularSleepingThreshold:{default:2.5},angularFactor:{type:"vec3",default:{x:1,y:1,z:1}},activationState:{default:e8.ACTIVE_TAG,oneOf:n8},type:{default:"dynamic",oneOf:[t8.STATIC,t8.DYNAMIC,t8.KINEMATIC]},emitCollisionEvents:{default:!1},disableCollision:{default:!1},collisionFilterGroup:{default:1},collisionFilterMask:{default:1},scaleAutoUpdate:{default:!0}},init:function(){this.system=this.el.sceneEl.systems["hubs-systems"].physicsSystem,this.alive=!0,this.el.object3D.updateMatrices(),this.uuid=this.system.addBody(this.el.object3D,this.data);const e=this.el.object3D.eid;(0,Ot.addComponent)(APP.world,Ln,e),Ln.bodyId[e]=this.uuid},update:function(e){e&&this.system.updateBody(this.uuid,this.data)},remove:function(){this.system.removeBody(this.uuid);const e=this.el.object3D.eid;(0,Ot.removeComponent)(APP.world,Ln,e),this.alive=!1}}),AFRAME.registerComponent("shape-helper",{schema:{type:{default:Lm.SHAPE.HULL,oneOf:[Lm.SHAPE.BOX,Lm.SHAPE.CYLINDER,Lm.SHAPE.SPHERE,Lm.SHAPE.CAPSULE,Lm.SHAPE.CONE,Lm.SHAPE.HULL,Lm.SHAPE.HACD,Lm.SHAPE.VHACD,Lm.SHAPE.MESH,Lm.SHAPE.HEIGHTFIELD]},fit:{default:Lm.FIT.ALL,oneOf:[Lm.FIT.ALL,Lm.FIT.MANUAL]},halfExtents:{type:"vec3",default:{x:1,y:1,z:1}},minHalfExtent:{default:0},maxHalfExtent:{default:Number.POSITIVE_INFINITY},sphereRadius:{default:NaN},cylinderAxis:{default:"y",oneOf:["x","y","z"]},margin:{default:.01},offset:{type:"vec3",default:{x:0,y:0,z:0}},orientation:{type:"vec4",default:{x:0,y:0,z:0,w:1}},heightfieldData:{default:[]},heightfieldDistance:{default:1},includeInvisible:{default:!1}},multiple:!0,init:function(){this.system=this.el.sceneEl.systems["hubs-systems"].physicsSystem,this.uuid=-1,this.mesh=null;let e=this.el;for(this.bodyHelper=e.components["body-helper"]||null;!this.bodyHelper&&e.parentNode!=this.el.sceneEl;)e=e.parentNode,e.components["body-helper"]&&(this.bodyHelper=e.components["body-helper"]);if(this.bodyHelper&&null!==this.bodyHelper.uuid&&void 0!==this.bodyHelper.uuid){if(this.data.fit===Lm.FIT.ALL){if(!this.el.object3DMap.mesh)return void console.error("Cannot use FIT.ALL without object3DMap.mesh");this.mesh=this.el.object3DMap.mesh,this.mesh.updateMatrices()}this.uuid=this.system.addShapes(this.bodyHelper.uuid,this.mesh,this.data)}else console.error("body not found")},remove:function(){-1!==this.uuid&&this.bodyHelper.alive&&this.system.removeShapes(this.bodyHelper.uuid,this.uuid)}});var i8=n(99477),r8=n(28341),o8=n.n(r8);const s8=window.ga;var a8=n(3103);n(31942),n(74462),n(17689),n(75029),n(5547);class l8 extends Yy.Component{constructor(){super(...arguments),this.state={locale:y(),messages:w()},this.updateLocale=()=>{this.setState({locale:y(),messages:w()})}}componentDidMount(){this.updateLocale(),window.addEventListener("locale-updated",this.updateLocale)}componentWillUnmount(){window.removeEventListener("locale-updated",this.updateLocale)}render(){return Yy.createElement(a8.Z,{locale:this.state.locale,messages:this.state.messages},this.props.children)}}l8.propTypes={children:sw().node.isRequired};var c8={"oauth-screen":"OAuthScreen__oauth-screen__qY3Hq",oauthScreen:"OAuthScreen__oauth-screen__qY3Hq"};const d8=["provider","redirectUrl","termsUrl","privacyUrl"];function u8(){return u8=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},u8.apply(this,arguments)}const h8={discord:"Discord",slack:"Slack"};function p8(e){let{provider:t,redirectUrl:n,termsUrl:i,privacyUrl:r}=e,o=function(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}(e,d8);return Yy.createElement("div",u8({className:c8.oauthScreen},o),Yy.createElement(N_,{title:Yy.createElement(uw.Z,{id:"oauth-screen.title",defaultMessage:"Sign In To Continue"})},Yy.createElement(O_,{center:!0,padding:!0},Yy.createElement("p",null,Yy.createElement(uw.Z,{id:"oauth-screen.description",defaultMessage:"You'll need to sign in to {provider} to access this room.",values:{provider:h8[t]}})),Yy.createElement("p",null,Yy.createElement(uw.Z,{id:"oauth-screen.email-reason",defaultMessage:"We'll ask for access to your e-mail address so you can skip signing in next time."})),Yy.createElement("p",null,Yy.createElement("small",null,Yy.createElement(BS,{termsUrl:i,privacyUrl:r}))),Yy.createElement(t_,{as:"a",href:n,preset:"discord"===t?"accent5":"accent4"},Yy.createElement(uw.Z,{id:"oauth-screen.sign-in-button",defaultMessage:"Sign Into {provider}",values:{provider:h8[t]}})))))}function m8(e){let{oauthInfo:t}=e;const{url:n,type:i}=t[0];return Yy.createElement(p8,{provider:i,redirectUrl:n,termsUrl:k.feature("show_terms")&&k.link("terms_of_use",We),privacyUrl:k.feature("show_privacy")&&k.link("privacy_notice",ze)})}function f8(e,t,n,i,r,o,s){try{var a=e[o](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(i,r)}function g8(e){return function(){var t=this,n=arguments;return new Promise((function(i,r){var o=e.apply(t,n);function s(e){f8(o,i,r,s,a,"next",e)}function a(e){f8(o,i,r,s,a,"throw",e)}s(void 0)}))}}function v8(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function b8(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?v8(Object(n),!0).forEach((function(t){y8(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):v8(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function y8(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function w8(e,t){return I0().then((n=>{const i=Lh(APP.world,e),r=APP.world.eid2obj.get(i);n.add(r),r.visible=!!t}))}p8.propTypes={provider:sw().string.isRequired,redirectUrl:sw().string.isRequired,termsUrl:sw().string,privacyUrl:sw().string},m8.propTypes={oauthInfo:sw().array},console.log(`App version: ${k.IS_LOCAL_OR_CUSTOM_CLIENT?`Custom client or local client (undeploy custom client to run build ${{NODE_ENV:"production",SHORTLINK_DOMAIN:"hub.link",RETICULUM_SERVER:"dev.reticulum.io",THUMBNAIL_SERVER:"nearspark-dev.reticulum.io",CORS_PROXY_SERVER:"hubs-proxy.com",NON_CORS_PROXY_DOMAINS:"hubs.local,dev.reticulum.io,hubs-upload-cdn.com",BASE_ASSETS_PATH:"/"}.BUILD_VERSION})`:{NODE_ENV:"production",SHORTLINK_DOMAIN:"hub.link",RETICULUM_SERVER:"dev.reticulum.io",THUMBNAIL_SERVER:"nearspark-dev.reticulum.io",CORS_PROXY_SERVER:"hubs-proxy.com",NON_CORS_PROXY_DOMAINS:"hubs.local,dev.reticulum.io,hubs-upload-cdn.com",BASE_ASSETS_PATH:"/"}.BUILD_VERSION||"?"}`),wt.Cache.enabled=!1,wt.Object3D.DefaultMatrixAutoUpdate=!1,function(){if(/Android.+Firefox/.test(navigator.userAgent)){const e=WebGLRenderingContext.prototype.getExtension,t=function(){const e=new Mt.WebGLRenderer({forceWebVR:!0}),t=new Mt.Scene,n=new Float32Array(16),i=new Mt.DataTexture(n,2,2,Mt.RGBAFormat,Mt.FloatType),r=new Mt.Mesh(new Mt.PlaneBufferGeometry(1,1),new Mt.MeshBasicMaterial({map:i}));r.material.map.needsUpdate=!0,t.add(r),e.render(t,new Mt.Camera);const o=0===e.getContext().getError();return e.dispose(),o}();WebGLRenderingContext.prototype.getExtension=function(n){return"OES_texture_float"!==n||t?e.call(this,n):null}}}(),window.APP=new class{constructor(){this.scene=void 0,this.hubChannel=void 0,this.hub=void 0,this.mediaDevicesManager=void 0,this.entryManager=void 0,this.messageDispatch=void 0,this.store=void 0,this.componentRegistry=void 0,this.mediaSearchStore=new SE,this.audios=new Map,this.sourceType=new Map,this.audioOverrides=new Map,this.zoneOverrides=new Map,this.gainMultipliers=new Map,this.supplementaryAttenuation=new Map,this.clippingState=new Set,this.mutedState=new Set,this.isAudioPaused=new Set,this.audioDebugPanelOverrides=new Map,this.sceneAudioDefaults=new Map,this.moderatorAudioSource=new Set,this.world=(0,Ot.createWorld)(),this.str2sid=void 0,this.sid2str=void 0,this.nextSid=1,this.audioListener=void 0,this.dialog=new br,this.RENDER_ORDER={HUD_BACKGROUND:1,HUD_ICONS:2,CURSOR:3},this.fx={},this.store=ot,this.world.eid2obj=new Map,this.world.eid2mat=new Map,this.world.nid2eid=new Map,this.world.deletedNids=new Set,this.world.ignoredNids=new Set,this.world.nameToComponent={object3d:Ht,networked:Rt,owned:Dt,AEntity:Ut},(0,Ot.addEntity)(this.world),this.str2sid=new Map([[null,0]]),this.sid2str=new Map([[0,null]]),window.$O=e=>this.world.eid2obj.get(e)}getSid(e){if(!this.str2sid.has(e)){const t=this.nextSid;return this.nextSid=this.nextSid+1,this.str2sid.set(e,t),this.sid2str.set(t,e),t}return this.str2sid.get(e)}getString(e){return this.sid2str.get(e)}setupRenderer(e){const t=document.createElement("canvas");t.classList.add("a-canvas"),t.dataset.aframeCanvas="true",t.addEventListener("touchmove",(function(e){e.preventDefault()}));const n=this.store.state.preferences.enablePostEffects,i=new wt.WebGLRenderer({alpha:!0,antialias:!n,depth:!n,stencil:!1,powerPreference:"high-performance",canvas:t});i.info.autoReset=!1,i.setPixelRatio(window.devicePixelRatio),i.debug.checkShaderErrors=(0,z.Z)("checkShaderErrors"),i.physicallyCorrectLights=!0,i.outputEncoding=wt.sRGBEncoding,e.appendChild(i.domElement);const r=new wt.PerspectiveCamera(80,window.innerWidth/window.innerHeight,.05,1e4),o=new wt.AudioListener;this.audioListener=o;const s=(0,Ot.addEntity)(this.world);Oh(this.world,s,this.audioListener),r.add(o),this.world.time={delta:0,elapsed:0,tick:0},this.scene=e;const a=e.object3D;return this.world.scene=a,j0(a),a.autoUpdate=!1,n?this.fx=function(e,t,n,i,r,o){const s=new D0.xC(t,{frameBufferType:wt.HalfFloatType});s.autoRenderToScreen=!1,s.setSize(e.width,e.height,!1);const a=new D0.CD(i,n);a.clear=!0;const l=new D0.CD(i,n);l.clear=!1,l.ignoreBackground=!0;const c=new D0.KM;c.renderToScreen=!0;const d=new D0.H5(n);d.enabled=!1;const u=new D0.M4({mode:D0.hm.ACES_FILMIC});let h;if(o.state.preferences.enableBloom){const e=new D0.rk({mipmapBlur:!0});h=new D0.H5(n,e,u)}let p,m=new D0.H5(n,u),f=new D0.H5(n,new D0.fY);f.renderToScreen=!0;const g=new D0.a2((function(){p=n.layers.mask,n.layers.disable(_o.CAMERA_LAYER_UI),n.layers.disable(_o.CAMERA_LAYER_FX_MASK)})),v=new D0.a2((()=>{var e;n.layers.set(_o.CAMERA_LAYER_UI),n.layers.enable(_o.CAMERA_LAYER_FX_MASK),d.enabled=(null===(e=h)||void 0===e?void 0:e.enabled)||m.enabled})),b=new D0.a2((()=>{n.layers.mask=p}));function y(e){switch(f.enabled=e===He.SMAA,e){case He.NONE:case He.SMAA:s.multisampling=0;break;case He.MSAA_2X:s.multisampling=2;break;case He.MSAA_4X:s.multisampling=4;break;case He.MSAA_8X:s.multisampling=8}console.log(f.enabled,s.multisampling),c.enabled=!f.enabled}m.enabled=!1,h&&(h.enabled=!1),s.addPass(g),s.addPass(a),h&&s.addPass(h),s.addPass(m),s.addPass(v),s.addPass(d),s.addPass(l),s.addPass(b),s.addPass(c),s.addPass(f);const w=o.state.preferences.aaMode;let _,E,A;if(y(w),d.skipRendering=!1,d.needsSwap=!0,(0,z.Z)("envSettingsDebug")&&h){const t=h.effects[0],n=new wt.Scene;_=new wt.OrthographicCamera(0,e.width,0,e.height,.1,100),_.layers.enable(_o.CAMERA_LAYER_FX_MASK),_.matrixAutoUpdate=!0,_.position.z=5,E=[t.luminancePass.texture,t.texture].map((function(e){const t=tl(e,1);return t.material.depthTest=!1,n.add(t),t})),A=()=>{let t=10;for(const n of E){const i=200,r=i*(e.width/e.height);n.scale.x=r,n.scale.y=i,n.position.y=t+i/2,n.position.x=10+r/2,n.matrixNeedsUpdate=!0,t+=i+10}},A();const i=new D0.CD(n,_);i.ignoreBackground=!0,i.clear=!1,i.renderToScreen=!0,i.enabled=!1,s.addPass(i),setTimeout((function(){const e=r.systems["hubs-systems"].environmentSystem.debugGui.addFolder("Post Effects Debug");{const n=e.addFolder("Bloom");n.add(t.blendMode,"blendFunction",D0.YQ),n.add(t.blendMode.opacity,"value",0,1).name("Opacity")}e.add({aaMode:w},"aaMode",He).onChange(y),e.add(i,"enabled").name("debug")}),0)}return r.addEventListener("rendererresize",(function(e){let{detail:t}=e;s.setSize(t.width,t.height,!1),_&&(_.right=t.width,_.bottom=t.height,_.updateProjectionMatrix(),A())})),{composer:s,bloomAndTonemapPass:h,tonemapOnlyPass:m}}(t,i,r,a,e,this.store):e.addEventListener("rendererresize",(function(e){let{detail:t}=e;i.setSize(t.width,t.height,!1)})),e.addEventListener("loaded",(()=>{$d().then((()=>{this.world.time.elapsed=performance.now(),i.setAnimationLoop((function(e,t){!function(e,t,n,i){const r=APP.world,o=AFRAME.scenes[0],s=o.systems,a=s["hubs-systems"];if(!o.isPlaying&&!a.DOMContentDidLoad)return;(e=>{const{time:t}=e,n=performance.now();t.delta=n-t.elapsed,t.elapsed=n,t.tick++})(r);const l=r.time.elapsed,c=r.time.delta,d=o.behaviors.tick;for(let e=0;e<d.length;e++)d[e].el.isPlaying&&d[e].tick(l,c);const u=o.systemNames;for(let e=0;e<u.length;e++)s[u[e]].tick&&s[u[e]].tick(l,c);(function(e){if(yr){{const t=_r(e);Pr.forEach((n=>{t.filter((e=>Rt.creator[e]===n)).forEach((t=>{(0,Ot.removeEntity)(e,t),Cr.add(t)}))}))}for(let t=0;t<Sr.length;t++){const n=Sr[t];for(let t=0;t<n.deletes.length;t+=1){const i=APP.getSid(n.deletes[t]);if(e.deletedNids.has(i))continue;const r=e.nid2eid.get(i);!r||kr(r)?(e.deletedNids.add(i),r&&(ss(e,r)&&(console.warn("Received delete message for a persistent entity. Deleting its entity state..."),cs(APP.hubChannel,e,r)),wr.delete(r),e.nid2eid.delete(i),(0,Ot.removeEntity)(e,r)),ep.delete(i)):console.warn("Received delete message for a non network-instantiated entity. Ignoring it.")}}for(let t=0;t<Sr.length;t++){const n=Sr[t];for(let t=0;t<n.creates.length;t++){const{version:i,networkId:r,prefabName:o,initialData:s}=n.creates[t];if(1!==i){console.warn(`Received create message with unsupported version (${i}).`);continue}const a=n.fromClientId;if(!a)throw new Error("Received create message without a fromClientId.");const l=APP.getSid(r);e.deletedNids.has(l)?console.warn(`Received a create message for an entity I've already deleted. Skipping ${r}`):e.nid2eid.has(l)||(e.ignoredNids.has(l)?console.warn(`Received create message for nid I ignored. Skipping ${r}.`):Xh(a,o)?$h(e,o,s,r,a):(console.warn(`Received create from a user who does not have permission to spawn ${o}. Skipping ${r}.`),e.ignoredNids.add(l)))}}xr.forEach((t=>{let{nid:n,creator:i}=t;const r=e.nid2eid.get(APP.getSid(n));if(!r)return;const o=APP.getSid(i);if("reticulum"!==i&&!Er.has(o))return(0,Ot.removeEntity)(e,r),void Cr.add(r);Rt.creator[r]=APP.getSid(i)})),xr.length=0,tp(e).forEach((e=>{const t=Rt.id[e];if(ep.has(t)){const e=ep.get(t);for(let t=0;t<e.length;t++){const n=e[t];Ar.has(APP.getSid(n.owner))&&(n.owner=NAF.clientId,n.lastOwnerTime=n.timestamp+1)}Sr.unshift({creates:[],updates:e,deletes:[]}),ep.delete(t)}}));for(let t=0;t<Sr.length;t++){const n=Sr[t];for(let t=0;t<n.updates.length;t++){const i=n.updates[t],r=APP.getSid(i.nid);if(e.ignoredNids.has(r))continue;if(e.deletedNids.has(r))continue;if(!e.nid2eid.has(r)){const e=ep.get(r)||[];e.push(i),ep.set(r,e);continue}const o=e.nid2eid.get(r);if(!Jh(o,i))if(i.owner===NAF.clientId?(0,Ot.addComponent)(e,Dt,o):(0,Ot.hasComponent)(e,Dt,o)&&(0,Ot.removeComponent)(e,Dt,o),Rt.owner[o]=APP.getSid(i.owner),Rt.lastOwnerTime[o]=i.lastOwnerTime,Rt.timestamp[o]=i.timestamp,i.hasOwnProperty("componentIds")){i.data.cursor=0;for(let t=0;t<i.componentIds.length;t++){const n=i.componentIds[t];to.get(no[n]).deserialize(e,o,i.data)}delete i.data.cursor}else for(const e of to.values())if(i.data.hasOwnProperty(e.componentName)){const t=i.data[e.componentName];e.deserializeFromStorage?e.deserializeFromStorage(o,t):console.error(`Had stored data for a component with no \`deserializeForStorage\`: ${e.componentName}`)}}}Sr.length=0;{const t=_r(e);Pr.forEach((n=>{t.filter((e=>Rt.owner[e]===n)).forEach((t=>Nd(e,t)))})),Pr.length=0}}})(r),function(e){const t=AFRAME.scenes[0].systems["hubs-systems"].physicsSystem,n=qJ(e);for(let i=0;i<n.length;i++){const r=n[i];if((0,Ot.entityExists)(e,r)){for(let t=0;t<ZJ.length;t++){const n=ZJ[t];(0,Ot.removeComponent)(e,n,r)}(0,Ot.hasComponent)(e,Ln,r)&&t.updateBodyOptions(Ln.bodyId[r],GJ)}}}(r),function(e,t,n){n5(e).forEach((function(i){e5.add(i,(r=>function*(e,t,n,i,r){try{(0,Ot.addComponent)(e,Rt,t),Nc(t,"scene","reticulum");const o=APP.getString(Xn.src[t]);if(!o)throw new Error("Scene loading failed. No src url provided to load.");APP.sceneAudioDefaults.delete(mh.AVATAR_AUDIO_SOURCE),APP.sceneAudioDefaults.delete(mh.MEDIA_VIDEO);const s=yield*Uc(e,o,"model/gltf",!1);r(),ld(e,s,t),Ic(e,APP.getString(Rt.id[t]),s);let a,l=APP.scene,c=!1;if(e.eid2obj.get(s).traverse((t=>{if(t.isMesh&&(t.reflectionProbeMode="static"),t.isReflectionProbe&&(t.updateMatrices(),t.box.applyMatrix4(t.matrixWorld)),(0,Ot.hasComponent)(e,Qn,t.eid)){const e=t.getObjectByProperty("isMesh",!0);e!==t&&console.warn("The `nav-mesh` component should be placed directly on a mesh."),l.systems.nav.loadMesh(e,"character")}!a&&(0,Ot.hasComponent)(e,wi,t.eid)&&(a=t),!t.isMesh||t instanceof xu||t.name.startsWith("Floor_Plan")||t.name.startsWith("Ground_Plane")||!t.geometry.boundsTree||lU(t.geometry)&&(c=!0)})),!Qo(e,In,s)){let t;c&&(t=Qo(e,Qn,s)),t?(console.log("Mesh density exceeded, using floor plan only"),Za(e,t,{type:Fa.MESH,margin:.01,fit:Ba.ALL,includeInvisible:!0})):c?(Za(e,s,{type:Fa.BOX,margin:.01,fit:Ba.MANUAL,halfExtents:[4e3,.5,4e3],offset:[0,-.5,0]}),console.log("Adding default floor collision")):(Za(e,s,{type:Fa.MESH,margin:.01,fit:Ba.ALL}),console.log("Adding mesh shape for all visible meshes"))}const d={skybox:a};(0,Ot.hasComponent)(e,li,s)&&Object.assign(d,li.map.get(s)),n.updateEnvironmentSettings(d);const u=document.getElementById("scene-preview-node").object3D;(0,Ot.removeComponent)(e,ji,u.eid);const h=e.eid2obj.get(s).getObjectByName("scene-preview-camera");if(h)u.position.copy(h.position),u.rotation.copy(h.rotation),u.rotation.reorder("YXZ");else{const e=u.position;u.position.set(e.x,2.5,e.z)}u.matrixNeedsUpdate=!0,(0,Ot.addComponent)(e,ji,u.eid),ji.duration[u.eid]=60,ji.positionOnly[u.eid]=1,l.emit("environment-scene-loaded",s),document.querySelector(".a-canvas").classList.remove("a-hidden"),l.addState("visible"),l.is("entered")&&qd(e,i),document.getElementById("viewing-camera").components.fader.fadeIn(),(0,Ot.removeComponent)(e,Xn,t)}catch(e){var o;console.error(e),console.error("Failed to load the scene"),null===(o=APP.messageDispatch)||void 0===o||o.remountUI({roomUnavailableReason:jF.sceneError}),APP.entryManager.exitScene()}}(e,i,t,n,r)))})),i5(e).forEach((function(e){e5.stop(e)})),e5.tick()}(r,a.environmentSystem,a.characterController),function(e){pd(e).forEach((function(t){ud.add(t,(n=>function*(e,t,n){Zn.flags[t]&sd.IS_OBJECT_MENU_TARGET&&(0,Ot.addComponent)(e,mi,t);const i=yield*dd(e,t);n(),function(e,t,n){const i=Zn.flags[n]&sd.RESIZE,r=Zn.flags[n]&sd.RECENTER;if(!i&&!r)return;const o=e.eid2obj.get(t),s=new id.Box3;s.setFromObject(o);let a=1;if(i){const n=new id.Vector3;s.getSize(n),a=1/Math.max(n.x,n.y,n.z),(0,Ot.hasComponent)(e,zt,t)&&(a*=.5),o.scale.multiplyScalar(a),o.matrixNeedsUpdate=!0}if(r){const e=new id.Vector3;s.getCenter(e),o.position.copy(e).multiplyScalar(-1*a),o.matrixNeedsUpdate=!0}}(e,i,t),ld(e,i,t),Ic(e,APP.getString(Rt.id[t]),i),Zn.flags[t]&sd.ANIMATE_LOAD&&(yield*ad(e,i)),(0,Ot.removeComponent)(e,Zn,t),i&&Za(e,i,{type:(0,Ot.hasComponent)(e,zt,i)?Fa.HULL:Fa.BOX,minHalfExtent:.04})}(e,t,n)))})),md(e).forEach((function(e){ud.stop(e)})),ud.tick()}(r),v3(r,a.physicsSystem),function(e){const t=b1(e);for(let n=0;n<t.length;n++){const i=t[n],r=e.eid2obj.get(i);(0,Ot.hasComponent)(e,Dt,i)?(y1.fromArray(Vt.position[i]),y1.near(r.position,.001)||r.position.toArray(Vt.position[i]),w1.fromArray(Vt.rotation[i]),w1.near(r.quaternion,.001)||r.quaternion.toArray(Vt.rotation[i]),y1.fromArray(Vt.scale[i]),y1.near(r.scale,.001)||r.scale.toArray(Vt.scale[i])):(y1.fromArray(Vt.position[i]),y1.near(r.position)||((0,Ot.addComponent)(e,Li,i),Li.duration[i]=Rr,Li.targetX[i]=y1.x,Li.targetY[i]=y1.y,Li.targetZ[i]=y1.z),w1.fromArray(Vt.rotation[i]),w1.near(r.quaternion)||((0,Ot.addComponent)(e,Ii,i),Ii.duration[i]=Rr,Ii.targetX[i]=w1.x,Ii.targetY[i]=w1.y,Ii.targetZ[i]=w1.z,Ii.targetW[i]=w1.w),y1.fromArray(Vt.scale[i]),y1.near(r.scale)||((0,Ot.addComponent)(e,Ni,i),Ni.duration[i]=Rr,Ni.targetX[i]=y1.x,Ni.targetY[i]=y1.y,Ni.targetZ[i]=y1.z))}}(r),s.userinput.tick2(e),function(e,t,n,i){t.tick(n),function(e,t){const n=t.options;YJ(e,n.leftHand.entity.object3D.eid,QJ,ln),YJ(e,n.rightHand.entity.object3D.eid,XJ,an)}(e,i.interaction),function(e,t){o0(e,t,l0,pn,KJ),o0(e,t,d0,mn,JJ),o0(e,t,h0,un,t0),o0(e,t,m0,hn,i0),s0(e,t,a0,pn,$J),s0(e,t,c0,mn,e0),s0(e,t,u0,un,n0),s0(e,t,p0,hn,r0)}(e,i.userinput),function(e){_0(e).forEach((t=>(0,Ot.removeComponent)(e,mn,t))),w0(e).forEach((t=>(0,Ot.removeComponent)(e,pn,t))),A0(e).forEach((t=>(0,Ot.removeComponent)(e,dn,t))),E0(e).forEach((t=>(0,Ot.removeComponent)(e,cn,t)))}(e),function(e){f0(e,g0(e),cn),f0(e,v0(e),dn),f0(e,b0(e),an),f0(e,y0(e),ln)}(e),i.interaction.updateLegacyState()}(r,a.cursorTargettingSystem,l,s),function(e){(function(e){k1(e).forEach((function(t){const n=e.eid2obj.get(t),i=Zo(e,C1,t),r=M1[xn.type[t]];n.material.color.copy(i?r.hoverColor:r.color),(0,Ot.hasComponent)(e,Mn,t)&&(e.eid2obj.get(Mn.labelRef[t]).color=i?r.textHoverColor:r.textColor)}))})(e),function(e){const t=A1(e);for(let n=0;n<t.length;n++){const i=t[n];(0,Ot.removeComponent)(e,tn,i)}if(3===AFRAME.scenes[0].systems["hubs-systems"].cameraSystem.mode)return;const n=AFRAME.scenes[0].systems.interaction.options;E1(e,x1(e),zm.actions.cursor.left.grab,n.leftRemote.entity.object3D),E1(e,S1(e),zm.actions.cursor.right.grab,n.rightRemote.entity.object3D)}(e)}(r),function(e,t){Z1(e,t,qo(e,on),yn,D1(e)),Z1(e,t,qo(e,sn),wn,I1(e)),Z1(e,t,qo(e,nn),vn,B1(e)),Z1(e,t,qo(e,rn),bn,H1(e)),G1(e,_n,yn,t,qo(e,on),j1(e)),G1(e,_n,wn,t,qo(e,sn),N1(e)),G1(e,An,vn,t,qo(e,nn),V1(e)),G1(e,An,vn,t,qo(e,rn),z1(e))}(r,a.physicsSystem),a.animationMixerSystem.tick(c),function(e,t){const n=l5(e);if(n.length)if(c5){b5>=n.length&&(b5=0);const i=n[b5++];((e,t,n)=>{var i;const r=e.eid2obj.get(t);return!!r.visible&&((null===(i=APP.scene)||void 0===i?void 0:i.is("vr-mode"))||((e,t)=>(p5.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),h5.setFromProjectionMatrix(p5),m5.makeEmpty(),e.traverse(g5),h5.intersectsBox(m5)))(r,n))})(e,i,t)&&v5(e,i,t)}else n.forEach((n=>v5(e,n,t)))}(r,a.cameraSystem.viewingCamera),function(e){A5(e).forEach((t=>{x5.add(t,(()=>function*(e,t){let n=APP.sid2str.get(ki.src[t]);let i=(yield jl(n)).origin;i.startsWith("//")&&(i=location.protocol+i),n=zs(i);const r=yield zl.loadAsync(n),o=e.eid2obj.get(t);o.material.uniforms.map.value=r,o.visible=!0,o.updateParticles()}(e,t)))})),S5(e).forEach((function(e){x5.stop(e)})),E5(e).forEach((t=>{x5.tick();const n=e.eid2obj.get(t);n.visible&&n.update(e.time.delta/1e3)}))}(r),function(e,t,n){Qd(e).includes(Vd)&&(Vd=0),Bd(e).forEach((i=>{(0,Ot.hasComponent)(e,bi,i)&&(0,Ot.hasComponent)(e,Dt,i)&&i!==Vd&&bi.occupied[i]&&(bi.occupied[i]=0),(0,Ot.hasComponent)(e,tn,i)&&((0,Ot.hasComponent)(e,bi,i)?bi.occupied[i]?console.error("Interacted with an occupied waypoint. Doing nothing."):(Id(e,i),Ud(e,i),Zd(e,i,t,!1)):Zd(e,i,t,!1));const r=e.eid2obj.get(i);r.visible=n;const o=(0,Ot.hasComponent)(e,bi,i)&&bi.occupied[i];vi.flags[i]&Fd.canBeOccupied&&r.children.length&&r.children[0].material.color.setHex(o?16711850:16777215)}));const i=Yd(e)||Gd(e);if(Xd||(Xd=e.eid2obj.get(qo(e,yi))),Xd.visible=!!i.length,i.length){const t=i[0],n=e.eid2obj.get(t);n.updateMatrices(),Oo(Xd,n.matrixWorld)}Wd&&Wd().done&&(Wd=null)}(r,a.characterController,o.is("frozen")),a.characterController.tick(l,c),a.cursorTogglingSystem.tick(s.interaction,s.userinput,a.el),a.interactionSfxSystem.tick(s.interaction,s.userinput,a.soundEffectsSystem),a.superSpawnerSystem.tick(),function(e){Vu(e).forEach((t=>{Bu.has(t)||Bu.set(t,bc(function*(e,t){const n=Kh(e,"media",{src:APP.getString(_i.src[t]),recenter:!1,resize:!1,animateLoad:!1,isObjectMenuTarget:!0});_i.flags[t]&Fu.APPLY_GRAVITY&&(Un.flags[n]&=~Ou),(0,Ot.addComponent)(e,pn,n),(0,Ot.addComponent)(e,fn,n);const i=e.eid2obj.get(t);i.updateMatrices(),Oo(e.eid2obj.get(n),i.matrixWorld),yield*rd(e,n),i.visible=!1,yield I(1e3),i.visible=!0,yield*ad(e,i.children[0].eid)}(e,t)))})),Uu(e).forEach((function(e){Bu.delete(e)})),Bu.forEach(((e,t)=>{e().done&&Bu.delete(t)}))}(r),a.emojiSystem.tick(l,s.userinput),a.cursorPoseTrackingSystem.tick(),a.hoverMenuSystem.tick(),a.positionAtBorderSystem.tick(),a.twoPointStretchingSystem.tick(),(e=>{const t=AFRAME.scenes[0].systems["hubs-systems"].physicsSystem;Du(e).forEach((e=>{t.updateBodyOptions(Ln.bodyId[e],{type:"kinematic",gravity:{x:0,y:0,z:0}})})),Iu(e).forEach((e=>{t.updateBodyOptions(Ln.bodyId[e],{gravity:{x:0,y:0,z:0},type:"dynamic",collisionFilterMask:Ue.HANDS|Ue.MEDIA_FRAMES})})),Lu(e).forEach((n=>{if(!(0,Ot.entityExists)(e,n)||!(0,Ot.hasComponent)(e,Un,n)||!(0,Ot.hasComponent)(e,Ln,n))return;const i=Ln.bodyId[n],r=t.bodyUuidToData.get(i);Un.flags[n]&Ou?r.linearVelocity<1.85?(t.updateBodyOptions(i,{gravity:{x:0,y:0,z:0},angularDamping:Un.flags[n]&Tu?.89:.5,linearDamping:.95,linearSleepingThreshold:.1,angularSleepingThreshold:.1,collisionFilterMask:Ue.HANDS|Ue.MEDIA_FRAMES}),(0,Ot.addComponent)(e,Pu,n)):(t.updateBodyOptions(i,{gravity:{x:0,y:Un.releaseGravity[n],z:0},angularDamping:.01,linearDamping:.01,linearSleepingThreshold:1.6,angularSleepingThreshold:2.5,collisionFilterMask:Ue.DEFAULT_INTERACTABLE}),(0,Ot.removeComponent)(e,Pu,n)):t.updateBodyOptions(i,{collisionFilterMask:Ue.DEFAULT_INTERACTABLE,gravity:{x:0,y:-9.8,z:0}})})),Nu(e).forEach((t=>{(0,Ot.hasComponent)(e,Dt,t)?Hn.flags[t]=Un.flags[t]:Un.flags[t]=Hn.flags[t]})),function(e){const t=AFRAME.scenes[0].systems["hubs-systems"].physicsSystem;Cu(e).forEach((n=>{if(!(0,Ot.hasComponent)(e,Dt,n))return void(0,Ot.removeComponent)(e,Pu,n);const i=Ln.bodyId[n],r=t.bodyUuidToData.get(i);t.bodyInitialized(i)&&t.getLinearVelocity(i)<r.options.linearSleepingThreshold&&t.getAngularVelocity(i)<r.options.angularSleepingThreshold&&(Object.assign(r.options,{type:"kinematic"}),t.updateBody(i,r.options),(0,Ot.removeComponent)(e,Pu,n))}))}(e),function(e){const t=AFRAME.scenes[0].systems["hubs-systems"].physicsSystem;ku(e).forEach((n=>{(0,Ot.entityExists)(e,n)&&(0,Ot.hasComponent)(e,Dt,n)&&t.updateBodyOptions(Ln.bodyId[n],{type:"kinematic"})}))}(e)})(r),a.holdableButtonSystem.tick(),a.hoverButtonSystem.tick(),a.drawingMenuSystem.tick(),a.hapticFeedbackSystem.tick(a.twoPointStretchingSystem,!1,!1),a.soundEffectsSystem.tick(),a.scenePreviewCameraSystem.tick(),function(e,t){var n;P4(e).forEach((e=>{v4.delete(e),b4.delete(e),y4.delete(e),w4.delete(e),_4.delete(e),E4.delete(e),A4.delete(e)})),M4(e).forEach((n=>{const i=e.eid2obj.get(n);t.viewingCamera.position.copy(i.position),t.viewingCamera.rotation.copy(i.rotation),t.viewingCamera.rotation.reorder("YXZ"),t.viewingCamera.matrixNeedsUpdate=!0,v4.set(n,i.position.clone());const r=i.quaternion.clone();b4.set(n,r);const o=i.position.clone();o.y=Math.max(o.y-1.5,1),o.add(new wt.Vector3(2,0,-2)),y4.set(n,o);const s=new wt.Euler(-.15,0,.15),a=new wt.Quaternion;a.setFromEuler(s),a.premultiply(r),w4.set(n,a),_4.set(n,e.time.elapsed),E4.set(n,!1),A4.set(n,!1)})),t.viewingCamera&&(null===(n=APP.scene)||void 0===n?void 0:n.is("entered"))||3===t.mode||x4(e).forEach((n=>{const i=e.eid2obj.get(n);((e,t,n,i)=>{i.mode=4;const r=gf();if(r)Oo(n,r.matrixWorld),n.translateZ(-.1),n.matrixNeedsUpdate=!0;else{const i=_4.get(t),r=ji.duration[t];let o=(e.time.elapsed-i)/(1e3*r);o=Math.min(1,Math.max(0,o)),A4.get(t)?o=o<.5?2*o*o:(4-2*o)*o-1:o*=2-o;const s=v4.get(t),a=y4.get(t),l=b4.get(t),c=w4.get(t),d=E4.get(t),u=d?a:s,h=d?s:a,p=d?c:l,m=d?l:c;S4.slerpQuaternions(p,m,o),n.position.set((0,E3.t7)(u.x,h.x,o),(0,E3.t7)(u.y,h.y,o),(0,E3.t7)(u.z,h.z,o)),ji.positionOnly[t]||n.rotation.setFromQuaternion(S4),n.matrixNeedsUpdate=!0,o>=.9999&&(A4.set(t,!0),E4.set(t,!d),_4.set(t,e.time.elapsed))}})(e,n,i,t),i.updateMatrices(),Oo(t.viewingCamera,i.matrixWorld)}))}(r,a.cameraSystem),a.physicsSystem.tick(c),a.inspectYourselfSystem.tick(a.el,s.userinput,a.cameraSystem),a.cameraSystem.tick(a.el,c),function(e){c3(e).forEach((function(t){const n=new N2.WebGLRenderTarget(H2,z2,{format:N2.RGBAFormat,minFilter:N2.LinearFilter,magFilter:N2.NearestFilter,encoding:N2.sRGBEncoding});function i(){n.needsUpdate=!0}n.lastUpdated=0,n.needsUpdate=!0;const r=e.eid2obj.get(Wn.screenRef[t]);r.material.map=n.texture,r.material.onBeforeRender=i;const o=e.eid2obj.get(Wn.selfieScreenRef[t]);o.material.map=n.texture,o.material.onBeforeRender=i,e3.set(t,n)})),d3(e).forEach((function(t){e3.get(t).dispose(),e3.delete(t);const n=e.eid2obj.get(Wn.screenRef[t]);n.geometry.dispose(),n.material.dispose()})),l3(e).forEach(((t,n,i)=>{if(function(e,t){var n;const i=AFRAME.scenes[0].systems.userinput,r=AFRAME.scenes[0].systems["transform-selected-object"],o=AFRAME.scenes[0].systems["hubs-systems"].physicsSystem;if(!r.transforming&&(0,Ot.hasComponent)(e,cn,t)&&i.get(zm.device.mouse.buttonRight)){const n=qo(e,on);o.updateBodyOptions(Ln.bodyId[t],{type:"kinematic"}),r.startTransform(e.eid2obj.get(t),e.eid2obj.get(n),{mode:"cursor"})}else(null===(n=r.target)||void 0===n?void 0:n.eid)!==t||i.get(zm.device.mouse.buttonRight)||r.stopTransform()}(e,t),Wn.trackTarget[t]&&((0,Ot.entityExists)(e,Wn.trackTarget[t])?(e.eid2obj.get(Wn.trackTarget[t]).getWorldPosition(i3),e.eid2obj.get(t).lookAt(i3)):Wn.trackTarget[t]=0),Wn.state[t]===Y2&&((r3(Wn.snapRef[t])||function(e,t){const n=AFRAME.scenes[0].systems.userinput;return(0,Ot.hasComponent)(e,mn,t)&&n.get(zm.actions.cursor.left.takeSnapshot)||(0,Ot.hasComponent)(e,pn,t)&&n.get(zm.actions.cursor.right.takeSnapshot)||(0,Ot.hasComponent)(e,hn,t)&&n.get(zm.actions.leftHand.takeSnapshot)||(0,Ot.hasComponent)(e,un,t)&&n.get(zm.actions.rightHand.takeSnapshot)}(e,t))&&(Wn.state[t]=Q2,Wn.snapTime[t]=e.time.elapsed+3e3),r3(Wn.recVideoRef[t])&&(Wn.state[t]=X2,Wn.snapTime[t]=e.time.elapsed+3e3),r3(Wn.nextButtonRef[t])&&(Wn.captureDurIdx[t]=(Wn.captureDurIdx[t]+1)%J2.length),r3(Wn.prevButtonRef[t])&&(Wn.captureDurIdx[t]=0===Wn.captureDurIdx[t]?J2.length-1:Wn.captureDurIdx[t]-1),r3(Wn.sndToggleRef[t])&&(n3=!n3)),Wn.state[t]===Q2||Wn.state[t]===X2)if(r3(Wn.cancelRef[t]))Wn.state[t]=Y2;else if(e.time.elapsed>=Wn.snapTime[t])if(Wn.state[t]===X2){Wn.snapTime[t]=e.time.elapsed+1e3*J2[Wn.captureDurIdx[t]],Wn.state[t]=$2;const n=function(e){var t;let n;if(e&&null!==(t=APP.dialog._micProducer)&&void 0!==t&&t.track){var i;const e=N2.AudioContext.getContext(),t=e.createMediaStreamDestination();APP.audioListener&&APP.audioListener.getInput().connect(t),e.createMediaStreamSource(new MediaStream([null===(i=APP.dialog._micProducer)||void 0===i?void 0:i.track])).connect(t),n=t.stream.getAudioTracks()[0]}return new S2(AFRAME.scenes[0].renderer,B2,Z2,G2,25,n)}(n3);t3.set(t,n),n.start(),APP.hubChannel.beginRecording()}else Wn.state[t]=K2;else{const n=e.time.elapsed+.01,i=Wn.snapTime[t]-n,r=Wn.snapTime[t]-(n-e.time.delta);Math.floor(i/1e3)!==Math.floor(r/1e3)&&AFRAME.scenes[0].systems["hubs-systems"].soundEffectsSystem.playSoundOneShot(Om)}const r=e3.get(t),o=e.time.elapsed;(Wn.state[t]===K2||Wn.state[t]===$2&&o>r.lastUpdated+40||r.needsUpdate&&e.time.tick%i.length===n&&o>r.lastUpdated+166.66666666666666)&&(P2(e,r,Wn.cameraRef[t]),r.needsUpdate=!1,r.lastUpdated=e.time.elapsed,Wn.state[t]===$2&&t3.get(t).captureFrame(e3.get(t))),Wn.state[t]===K2?(function(e,t){a3||(a3=new Uint8Array(3686400));AFRAME.scenes[0].renderer.readRenderTargetPixels(e3.get(t),0,0,H2,z2,a3),function(e,t,n){return x2.apply(this,arguments)}(a3,H2,z2).then((n=>{o3(e.eid2obj.get(t),n,"photo")}))}(e,t),Wn.state[t]=Y2):Wn.state[t]===$2&&(r3(Wn.cancelRef[t])?(s3(e,t,!0),Wn.state[t]=Y2):e.time.elapsed>=Wn.snapTime[t]&&(s3(e,t,!1),Wn.state[t]=Y2)),function(e,t){const n=e.eid2obj.get(Wn.snapMenuRef[t]),i=e.eid2obj.get(Wn.snapRef[t]),r=e.eid2obj.get(Wn.recVideoRef[t]),o=e.eid2obj.get(Wn.cancelRef[t]),s=e.eid2obj.get(Wn.nextButtonRef[t]),a=e.eid2obj.get(Wn.prevButtonRef[t]),l=e.eid2obj.get(Wn.countdownLblRef[t]),c=e.eid2obj.get(Wn.captureDurLblRef[t]),d=e.eid2obj.get(Wn.screenRef[t]),u=e.eid2obj.get(Wn.selfieScreenRef[t]),h=e.eid2obj.get(Wn.sndToggleRef[t]),p=e.eid2obj.get(Mn.labelRef[Wn.sndToggleRef[t]]),m=Wn.state[t]===Y2,f=Wn.state[t]===Q2||Wn.state[t]===X2||Wn.state[t]===$2,g=!AFRAME.scenes[0].is("vr-mode")||(0,Ot.hasComponent)(e,fn,t)||!m;d.visible=g,u.visible=g;const v=Ho(e.eid2obj.get(t))?0:Math.PI;if(n.rotation.y!==v&&(n.rotation.y=v,n.matrixNeedsUpdate=!0),i.visible=m,r.visible=U2&&m,c.visible=U2&&m,s.visible=U2&&m,a.visible=U2&&m,h.visible=U2&&m,o.visible=f,l.visible=f,l.visible){const n=Math.ceil((Wn.snapTime[t]-e.time.elapsed)/1e3);l.text=n}c.visible&&(c.text=J2[Wn.captureDurIdx[t]]),h.visible&&(p.text=n3?"Sound ON":"Sound OFF")}(e,t)}))}(r),a.waypointSystem.tick(l,c),a.menuAnimationSystem.tick(l),a.spriteSystem.tick(l,c),a.uvScrollSystem.tick(c),function(e){(function(e){y5(e).forEach((function(t){const n=e.eid2obj.get(t);n.material?go(n,(function(n){(0,Ot.hasComponent)(e,Si,n.eid)?console.warn("Multiple uv-scroll instances added to objects sharing a material, only the speed/increment from the first one will have any effect"):((0,Ot.addComponent)(e,Si,n.eid),Si.speed[n.eid].set(Si.speed[t]),Si.increment[n.eid].set(Si.increment[t]))})):console.error("uv-scroll component added to an object without a Material"),(0,Ot.removeComponent)(e,Si,t)}))})(e),w5(e).forEach((function(t){const n=e.eid2mat.get(t).map;if(!n)return;const i=Si.offset[t],r=Si.speed[t],o=e.time.delta/1e3;i[0]=(i[0]+r[0]*o)%1,i[1]=(i[1]+r[1]*o)%1;const s=Si.increment[t];n.offset.x=s[0]?i[0]-i[0]%s[0]:i[0],n.offset.y=s[1]?i[1]-i[1]%s[1]:i[1]}))}(r),a.shadowSystem.tick(),function(e,t,n){const i=qo(e,ci);ci.targetRef[i]=function(e,t,n){if(!n)return 0;const i=Z3(e).map((t=>Yo(e,mi,t)))[0];return i||((0,Ot.entityExists)(e,ci.targetRef[t])?ci.targetRef[t]:0)}(e,i,t),ci.targetRef[i]&&(function(e,t){const n=e.eid2obj.get(ci.targetRef[t]);n.updateMatrices();Oo(e.eid2obj.get(t),n.matrixWorld)}(e,i),function(e,t,n){q3(e,ci.pinButtonRef[t])?function(e,t,n){as.apply(this,arguments)}(n,e,ci.targetRef[t]):q3(e,ci.unpinButtonRef[t])?cs(n,e,ci.targetRef[t]):q3(e,ci.cameraFocusButtonRef[t])?console.log("Clicked focus"):q3(e,ci.cameraTrackButtonRef[t])?console.log("Clicked track"):q3(e,ci.removeButtonRef[t])?U3(e,ci.targetRef[t]):q3(e,ci.dropButtonRef[t])?console.log("Clicked drop"):q3(e,ci.inspectButtonRef[t])?console.log("Clicked inspect"):q3(e,ci.deserializeDrawingButtonRef[t])?console.log("Clicked deserialize drawing"):q3(e,ci.openLinkButtonRef[t])?function(e,t){const{initialData:n}=wr.get(t),i=n.src;window.open(i)}(0,ci.targetRef[t]):q3(e,ci.refreshButtonRef[t])?console.log("Clicked refresh"):q3(e,ci.cloneButtonRef[t])?function(e,t){const{prefabName:n,initialData:i}=wr.get(t),r=Kh(e,n,i),o=e.eid2obj.get(r),s=AFRAME.scenes[0].systems["hubs-systems"].cameraSystem.viewingCamera;s.updateMatrices();const a=e.eid2obj.get(t);a.updateMatrices();const l=H3.setFromMatrixPosition(a.matrixWorld),c=z3.setFromMatrixPosition(s.matrixWorld);l.add(c.sub(l).normalize().multiplyScalar(.2));Oo(o,W3.copy(a.matrixWorld).setPosition(l))}(e,ci.targetRef[t]):q3(e,ci.rotateButtonRef[t])?console.log("Clicked rotate"):q3(e,ci.mirrorButtonRef[t])?console.log("Clicked mirror"):q3(e,ci.scaleButtonRef[t])&&console.log("Clicked scale")}(e,i,n)),function(e,t,n){const i=ci.targetRef[t],r=!(!i||!n);e.eid2obj.get(t).visible=r,e.eid2obj.get(ci.pinButtonRef[t]).visible=r&&!Or(i),e.eid2obj.get(ci.unpinButtonRef[t]).visible=r&&Or(i),[ci.cameraFocusButtonRef[t],ci.cameraTrackButtonRef[t],ci.removeButtonRef[t],ci.dropButtonRef[t],ci.inspectButtonRef[t],ci.deserializeDrawingButtonRef[t],ci.openLinkButtonRef[t],ci.refreshButtonRef[t],ci.cloneButtonRef[t],ci.rotateButtonRef[t],ci.mirrorButtonRef[t],ci.scaleButtonRef[t]].forEach((t=>{e.eid2obj.get(t).visible=r}))}(e,i,t)}(r,o.is("frozen"),APP.hubChannel),function(e,t){const n=A3(e)[0];if(ri.videoRef[n]&&(!(0,Ot.entityExists)(e,ri.videoRef[n])||!S3(e).length&&!M3(e).length&&!(0,Ot.hasComponent)(e,fn,ri.trackRef[n]))){const t=n;e.eid2obj.get(t).removeFromParent(),C3(e,t,!1),ri.videoRef[t]=0}x3(e).forEach((function(t){const i=n;ri.videoRef[i]=t;const r=e.eid2obj.get(i);e.eid2obj.get(t).add(r),C3(e,i,!0)})),A3(e).forEach((function(n){const i=ri.videoRef[n];if(!i)return;const r=e.eid2obj.get(n),o=e.eid2obj.get(i).material.map.image;if(t.get(zm.actions.cursor.right.togglePlayVideo)){(0,Ot.hasComponent)(e,ni,i)&&(Id(e,i),(0,Ot.addComponent)(e,jt,i));const t=e.eid2obj.get(ri.playIndicatorRef[n]),r=e.eid2obj.get(ri.pauseIndicatorRef[n]),s=x0.get(i);o.paused?(o.play(),APP.isAudioPaused.delete(s),t.visible=!0,r.visible=!1,O3=bc(j3(e,ri.playIndicatorRef[n]))):(o.pause(),APP.isAudioPaused.add(s),t.visible=!1,r.visible=!0,O3=bc(j3(e,ri.pauseIndicatorRef[n])))}const s=Ho(e.eid2obj.get(i))?0:Math.PI;r.rotation.y!==s&&(r.rotation.y=s,r.matrixNeedsUpdate=!0);const a=e.eid2obj.get(ri.headRef[n]);if((0,Ot.hasComponent)(e,pn,ri.trackRef[n])){const r=e.eid2obj.get(ri.trackRef[n]);if(k3(r,t.get(zm.actions.cursor.right.pose),T3),T3){const e=a.parent.worldToLocal(T3);o.currentTime=(0,E3.ZZ)((0,E3.uZ)(e.x,-.475,P3),-.475,P3,0,1)*o.duration}(0,Ot.hasComponent)(e,ni,i)&&(Id(e,i),(0,Ot.addComponent)(e,jt,i))}a.position.x=(0,E3.ZZ)(o.currentTime,0,o.duration,-.475,P3),a.matrixNeedsUpdate=!0,e.eid2obj.get(ri.timeLabelRef[n]).text=`${Dv(o.currentTime)} / ${Dv(o.duration)}`,O3&&O3().done&&(O3=null)}))}(r,s.userinput),function(e,t){f2(e).forEach((function(n){const i=e.eid2obj.get(n),r=i.material.map.image;ei.autoPlay[n]&&r.play().catch((()=>{console.error("Error auto-playing video.")}));const o=k0(e,n,mh.MEDIA_VIDEO,t);x0.set(n,o);const s=e.eid2obj.get(o);i.add(s)})),b2(e).forEach((t=>{const n=Yo(e,Di,t);if(n){const i=APP.audioOverrides.get(n),r=x0.get(t);APP.audioOverrides.set(r,i),M0.set(t,n),(0,Ot.addComponent)(e,si,r)}})),g2(e).forEach((e=>{const t=M0.get(e);t&&APP.audioOverrides.delete(t),M0.delete(e),x0.delete(e)})),p2(e).forEach((function(t){Rt.owner[t]===APP.getSid("reticulum")&&Nd(e,t)})),h2(e).forEach((function(t){const n=e.eid2obj.get(t).material.map.image;if((0,Ot.hasComponent)(e,Dt,t)){ni.time[t]=n.currentTime;let e=0;e|=n.paused?u2.PAUSED:0,ni.flags[t]=e}else{const e=!!(ni.flags[t]&u2.PAUSED);e!==n.paused&&(n.paused?n.play():n.pause()),(e||Math.abs(ni.time[t]-n.currentTime)>5)&&(n.currentTime=ni.time[t])}}))}(r,a.audioSystem),function(e,t){const n=qo(e,pi);(function(e,t,n){if(pi.targetRef[t]&&!(0,Ot.entityExists)(e,pi.targetRef[t])&&(pi.targetRef[t]=0),n)return void(pi.targetRef[t]=0);const i=Q3(e),r=i.map((t=>Yo(e,Jn,t)))[0]||0;if(r)return pi.targetRef[t]=r,void(pi.clearTargetTimer[t]=e.time.elapsed+1e3);i.some((t=>Yo(e,pi,t)))?pi.clearTargetTimer[t]=e.time.elapsed+1e3:e.time.elapsed>pi.clearTargetTimer[t]&&(pi.targetRef[t]=0)})(e,n,t),pi.targetRef[n]&&(function(e,t){const n=e.eid2obj.get(pi.targetRef[t]);n.updateMatrices();Oo(e.eid2obj.get(t),n.matrixWorld)}(e,n),function(e,t){if(G3(e,pi.nextButtonRef[t])){const n=pi.targetRef[t];Y3(e,n,$n.pageNumber[n]+1)}else if(G3(e,pi.prevButtonRef[t])){const n=pi.targetRef[t];Y3(e,n,$n.pageNumber[n]-1)}}(e,n)),function(e,t,n){const i=pi.targetRef[t],r=!(!i||n);if(e.eid2obj.get(t).visible=r,[pi.prevButtonRef[t],pi.nextButtonRef[t]].forEach((t=>{e.eid2obj.get(t).visible=r})),i){const n=zc.get(i).pdf.numPages;e.eid2obj.get(pi.pageLabelRef[t]).text=`${$n.pageNumber[i]} / ${n}`}}(e,n,t)}(r,o.is("frozen")),function(e){const t=qo(e,di),n=e.eid2obj.get(t);K3(e).forEach((i=>{di.targetObjectRef[t]=i,e.eid2obj.get(i).add(n)}));const i=X3(e).length>0||$3(e).length>0,r=di.targetObjectRef[t];i&&(0,Ot.entityExists)(e,r)?(n.visible=!0,J3(e).length>0&&window.open(APP.getString(hi.url[r]))):(n.visible=!1,null!==n.parent&&n.parent.remove(n),di.targetObjectRef[t]=0)}(r),function(e){Zc(e).forEach((function(t){Jn.pageNumber[t]!==$n.pageNumber[t]&&(Jn.pageNumber[t]=$n.pageNumber[t],qc.stop(t),qc.add(t,(()=>function*(e,t,n){const i=yield*Wc(zc.get(t),n),r=e.eid2obj.get(t);yield*rd(e,r.parent.eid),function(e,t){let{width:n,height:i}=t;const r=Math.sqrt(e.scale.x*e.scale.y/(n*i));e.scale.x=n*r,e.scale.y=i*r,e.matrixNeedsUpdate=!0}(r,i)}(e,t,$n.pageNumber[t]))))})),Gc(e).forEach((function(e){const t=zc.get(e);t.pdf.cleanup(),xo(t.material),zc.delete(e),qc.stop(e)})),qc.tick()}(r),function(e){X1(e).forEach((t=>{Rt.owner[t]===APP.getSid("reticulum")&&c2.set(t,setTimeout((()=>{Rt.owner[t]===APP.getSid("reticulum")&&Nd(e,t),c2.delete(t)}),1e4))})),K1(e).forEach((e=>{const t=c2.get(e);t&&(clearTimeout(t),c2.delete(e))}));const t=AFRAME.scenes[0].systems["hubs-systems"].physicsSystem,n=function(e,t){let n=0;for(let i=0;i<t.length;i++)n|=$1(e,t[i]);return n}(e,d2(e)),i=Q1(e);for(let r=0;r<i.length;r++){const o=i[r],s=e.nid2eid.get(It.capturedNid[o])||0,a=s&&i2(0,o,s);if(s&&(0,Ot.hasComponent)(e,Dt,s)&&!(0,Ot.hasComponent)(e,fn,s)&&a)r2(e,o,s),t.updateBodyOptions(Ln.bodyId[s],{type:"kinematic"});else if((0,Ot.hasComponent)(e,Dt,o)&&It.capturedNid[o]&&e.deletedNids.has(It.capturedNid[o])||s&&(0,Ot.hasComponent)(e,Dt,s)&&!a)Id(e,o),Lt.capturedNid[o]=0,Lt.scale[o].set(s2);else if(!Lt.capturedNid[o]){const n=n2(e,o);if(n&&((0,Ot.hasComponent)(e,Dt,n)||e2(e,n)&&(0,Ot.hasComponent)(e,Dt,o))&&!(0,Ot.hasComponent)(e,fn,n)&&!t2(e,o,n)){Id(e,o),Id(e,n),Lt.capturedNid[o]=Rt.id[n];const i=e.eid2obj.get(n);i.updateMatrices(),a2.setFromMatrixScale(i.matrixWorld).toArray(Lt.scale[o]),r2(e,o,n),t.updateBodyOptions(Ln.bodyId[n],{type:"kinematic"})}}Lt.capturedNid[o]!==It.capturedNid[o]&&s&&(0,Ot.entityExists)(e,s)&&(0,Ot.hasComponent)(e,Dt,s)&&(o2(e.eid2obj.get(s),It.scale[o]),t.updateBodyOptions(Ln.bodyId[s],{type:"dynamic"})),It.capturedNid[o]=Lt.capturedNid[o],It.scale[o].set(Lt.scale[o]),l2(e,o,n)}}(r),a.audioZonesSystem.tick(a.el),function(e){$5(e).forEach((e=>{const t=APP.world.eid2obj.get(e),n=new wt.Box3;t.getWorldPosition(Q5),t.getWorldScale(X5),n.setFromCenterAndSize(Q5,X5),G5.set(e,n),APP.store.state.preferences.showAudioDebugPanel&&!M5.has(e)&&O5(APP.world,e)})),J5(e).forEach((e=>{G5.delete(e),M5.delete(e),APP.audios.forEach(((e,t)=>{I5(t),q5.delete(t),Z5.delete(t)})),APP.store.state.preferences.showAudioDebugPanel&&M5.has(e)&&T5(APP.world,e)}));const t=K5(e);if(!t.length)return;const n=APP.audioListener.eid;APP.audioListener.getWorldPosition(Y5),t.forEach((e=>{!q5.has(n)&&q5.set(n,new Set),!Z5.has(n)&&Z5.set(n,new Set),z5(q5.get(n),e,Y5),APP.audios.forEach(((t,n)=>{!q5.has(n)&&q5.set(n,new Set),!Z5.has(n)&&Z5.set(n,new Set),z5(q5.get(n),e,L5(n))}))}));const i=j5(q5.get(n),Z5.get(n));APP.audios.forEach(((e,t)=>{const r=j5(q5.get(t),Z5.get(t));(i||r)&&V5(t,L5(t),q5.get(t),Y5,q5.get(n))})),APP.audios.forEach(((e,t)=>W5(t))),W5(APP.audioListener.eid)}(r),function(e,t){O0(e).forEach((function(n){const i=e.eid2obj.get(n),r=nm(n),o=P0(i);o||r.audioType!==fh.PannerNode?o&&r.audioType===fh.Stereo&&C0(e,t,n,wt.Audio):C0(e,t,n,wt.PositionalAudio),em(i,r),(0,Ot.removeComponent)(e,si,n)}))}(r,a.audioSystem),function(e,t){const n=u4(e),i=m4(e);h4(e).forEach((n=>{const r=APP.audioListener.context,o=k0(e,n,mh.AUDIO_TARGET,t);x0.set(n,o);const s=e.eid2obj.get(o);e.eid2obj.get(n).add(s);const a=Ti.maxDelay[n],l=Ti.minDelay[n];if(a>0){const e=APP.audios.get(o),t=r.createDelay(a);t.delayTime.value=t4.MathUtils.randFloat(l,a),e.setFilters([t])}const c=Ti.source[n];i.includes(c)&&r4(c,n);const d=APP.audioOverrides.get(n);APP.audioOverrides.set(o,d),(0,Ot.addComponent)(e,si,o)})),p4(e).forEach((e=>{x0.delete(e);const t=Ti.source[e];s4.delete(t),APP.audioOverrides.delete(e)})),f4(e).forEach((e=>{const t=n.find((t=>Ti.source[t]===e));t&&r4(e,t);const i=APP.world.eid2obj.get(e);i.updateMatrixWorld();const r=i.matrixWorld.getMaxScaleOnAxis();if(l4.set(e,r*r),Ri.flags[e]&lh){const t=new wt.LineSegments(new wt.WireframeGeometry(new wt.SphereBufferGeometry(r,10,10)));c4.set(e,t),i.add(t)}})),g4(e).forEach((e=>{i4(e),s4.delete(e);const t=o4.get(e);null==t||t.disconnect(),o4.delete(e),l4.delete(e),a4.delete(e),Ri.flags[e]&lh&&(c4.get(e).removeFromParent(),c4.delete(e))})),i.forEach((t=>{const n=APP.componentRegistry["player-info"];if(a4.has(t)){const i=a4.get(t);if(n.find((e=>e.el===i))){if(e.eid2obj.get(t).getWorldPosition(d4),i.object3D.position.distanceToSquared(d4)>l4.get(t)&&(a4.delete(t),Ri.flags[t]&lh)){const e=o4.get(t);n4(t,e)}}else if(a4.delete(t),Ri.flags[t]&lh){const e=o4.get(t);n4(t,e)}}else for(let i=0;i<n.length;i++){const r=n[i],o=r.el;if((!(Ri.flags[t]&sh)||r.can("amplify_audio"))&&(("avatar-rig"!==o.id||APP.scene.is("entered"))&&(e.eid2obj.get(t).getWorldPosition(d4),o.object3D.position.distanceToSquared(d4)<l4.get(t)))){a4.set(t,o);const e=Ri.flags[t]&ah,n="avatar-rig"===o.id;e&&n?i4(t):By(o).then((e=>{const n=APP.audioListener.context.createMediaStreamSource(e);n4(t,n)}))}}}))}(r,a.audioSystem),a.gainSystem.tick(),a.nameTagSystem.tick(),function(e){_5(e).forEach((t=>{e.eid2obj.get(t).update(e.time.elapsed/1e3)}))}(r),function(e){O4(e).forEach((t=>{const n=Li.duration[t],i=Li.targetX[t],r=Li.targetY[t],o=Li.targetZ[t],s=e.time.delta,a=e.eid2obj.get(t);s>=n?(a.position.set(i,r,o),(0,Ot.removeComponent)(e,Li,t)):(a.position.lerp(C4.set(i,r,o),s/n),Li.duration[t]=n-s),a.matrixNeedsUpdate=!0})),T4(e).forEach((t=>{const n=Ii.duration[t],i=Ii.targetX[t],r=Ii.targetY[t],o=Ii.targetZ[t],s=Ii.targetW[t],a=e.time.delta,l=e.eid2obj.get(t);a>=n?(l.quaternion.set(i,r,o,s),(0,Ot.removeComponent)(e,Ii,t)):(l.quaternion.slerp(k4.set(i,r,o,s),a/n),Ii.duration[t]=n-a),l.matrixNeedsUpdate=!0})),R4(e).forEach((t=>{const n=Ni.duration[t],i=Ni.targetX[t],r=Ni.targetY[t],o=Ni.targetZ[t],s=e.time.delta,a=e.eid2obj.get(t);s>=n?(a.scale.set(i,r,o),(0,Ot.removeComponent)(e,Ni,t)):(a.scale.lerp(C4.set(i,r,o),s/n),Ni.duration[t]=n-s),a.matrixNeedsUpdate=!0}))}(r),function(e){e4(e).forEach((t=>{e.eid2obj.get(t).sync()}))}(r),function(e){D2(e).forEach((function(t){let n=e.eid2obj.get(t);if(!n||!n.isCamera){const i=Do(n,(e=>e.isCamera));if(!i)return console.error("video-texture-source added to an entity without a camera"),void(0,Ot.removeComponent)(e,xi,t);console.warn("video-texture-source should be added directly to a camera, not it's ancestor."),n=i}n.layers.enable(_o.CAMERA_LAYER_THIRD_PERSON_ONLY);const i=xi.resolution[t];n.aspect=i[0]/i[1];const r=new wt.WebGLRenderTarget(i[0],i[1],{format:wt.RGBAFormat,minFilter:wt.LinearFilter,magFilter:wt.NearestFilter,encoding:wt.sRGBEncoding});r.texture.matrixAutoUpdate=!1,r.texture.matrix.scale(1,-1),r.texture.matrix.translate(0,1),O2.set(t,{renderTarget:r,lastUpdated:0,camera:n.eid,needsUpdate:!1})})),j2(e).forEach((function(e){const t=O2.get(e);t&&(t.renderTarget.dispose(),O2.delete(e))})),I2(e).forEach((function(t){T2.has(t)&&(0,Ot.entityExists)(e,t)&&k2(e,t),T2.delete(t)})),L2(e).forEach((function(t){const n=Mi.source[t];T2.has(t)?n&&(0,Ot.entityExists)(e,n)?n!==T2.get(t).boundTo&&(k2(e,t),C2(e,t)):(k2(e,t),Mi.source[t]=0):n&&(0,Ot.entityExists)(e,n)&&C2(e,t)})),R2(e).forEach((function(t){const n=O2.get(t);n.needsUpdate&&e.time.elapsed>n.lastUpdated+1e3/xi.fps[t]&&(P2(e,n.renderTarget,n.camera),n.lastUpdated=e.time.elapsed,n.needsUpdate=!1)}))}(r),function(e){if(!H0&&($0(e).forEach((t=>{G0(e,t)})),U0&&B0)){K0(e).forEach((t=>{U0&&Z0(e,t)}));let t=0;APP.audios.forEach(((e,n)=>{if(APP.isAudioPaused.has(n)||APP.mutedState.has(n))return;if(t>=z0)return;e.getWorldPosition(Y0),e.getWorldDirection(Q0);const i=P0(e)?e.panner:F0;B0.sourcePositions[t]=Y0.clone(),B0.sourceOrientations[t]=Q0.clone(),B0.distanceModels[t]=0,i.distanceModel===gh.Linear?B0.distanceModels[t]=0:i.distanceModel===gh.Inverse?B0.distanceModels[t]=1:i.distanceModel===gh.Exponential&&(B0.distanceModels[t]=2),B0.maxDistances[t]=i.maxDistance,B0.refDistances[t]=i.refDistance,B0.rolloffFactors[t]=i.rolloffFactor,B0.coneInnerAngles[t]=i.coneInnerAngle,B0.coneOuterAngles[t]=i.coneOuterAngle,B0.gains[t]=e.gain.gain.value,B0.clipped[t]=APP.clippingState.has(n)?1:0,t++})),V0.uniforms.time.value=e.time.elapsed,V0.uniforms.distanceModel.value=B0.distanceModels,V0.uniforms.maxDistance.value=B0.maxDistances,V0.uniforms.refDistance.value=B0.refDistances,V0.uniforms.rolloffFactor.value=B0.rolloffFactors,V0.uniforms.sourcePosition.value=B0.sourcePositions,V0.uniforms.sourceOrientation.value=B0.sourceOrientations,V0.uniforms.count.value=t,V0.uniforms.coneInnerAngle.value=B0.coneInnerAngles,V0.uniforms.coneOuterAngle.value=B0.coneOuterAngles,V0.uniforms.gain.value=B0.gains,V0.uniforms.clipped.value=B0.clipped}}(r),function(e,t){N3(e).forEach((function(e){V3.delete(e)})),t.get(zm.actions.cursor.right.deleteEntity)&&F3(e).forEach((t=>U3(e,t))),t.get(zm.actions.cursor.left.deleteEntity)&&B3(e).forEach((t=>U3(e,t))),V3.forEach((e=>e()))}(r,s.userinput),function(e){const t=_3(e);if(!t.length)return;const n=t[e.time.tick%t.length];e.eid2obj.get(n).getWorldPosition(w3),(w3.x<-1e3||w3.x>y3||w3.y<-1e3||w3.y>y3||w3.z<-1e3||w3.z>y3)&&(0,Ot.removeEntity)(e,n)}(r),function(e){const t=S0(e);for(let n=0;n<t.length;n++){const i=t[n],r=e.eid2obj.get(i),o=lp(r.el,"networked");EI(o.sceneEl,o),r.parent.visible=!1}}(r),function(e){function t(t){const n=e.eid2obj.get(t);e.eid2obj.delete(t),n.eid=0}const n=f1(e);n.forEach((t=>{const n=e.eid2obj.get(t);zo(n,(t=>!(t.eid&&(0,Ot.hasComponent)(e,ri,t.eid)||(t.eid&&(0,Ot.removeEntity)(e,t.eid),0)))),n.removeFromParent()})),n1(e),t1(e),i1(e),r1(e),o1(e),a1(e),l1(e),c1(e),s1(e),d1(e),u1(e),h1(e),p1(e),m1(e),n.forEach(t),f1(e).forEach(t),g1(e).forEach((function(t){const n=e.eid2mat.get(t);e.eid2mat.delete(t),n.eid=0}))}(r),a.boneVisibilitySystem.tick(),function(e,t){yr&&(HJ(e).forEach((function(t){(0,Ot.entityExists)(e,t)&&(0,Ot.hasComponent)(e,Dt,t)&&!(0,Ot.hasComponent)(e,gn,t)&&(0,Ot.addComponent)(e,jt,t)})),Array.from(WJ(e)).forEach((function(n){ss(e,n)&&(VJ.set(n,e.time.elapsed+500),UJ.has(n)||UJ.set(n,bc(function*(e,t,n,i){for(;t.time.elapsed<VJ.get(n)&&t.time.elapsed<i;)yield vc();ss(t,n)&&function(e,t,n){ls.apply(this,arguments)}(e,t,n)}(t,e,n,e.time.elapsed+3e3)))),(0,Ot.removeComponent)(e,jt,n)})),zJ(e).forEach((function(e){UJ.delete(e)})),UJ.forEach(((e,t)=>{e().done&&UJ.delete(t)})))}(r,APP.hubChannel),function(e){if(!yr)return;const t=performance.now();if(!(t<LJ)){t<LJ+Rr?LJ+=Rr:LJ=t+Rr;{const t=$i();IJ(e).forEach((e=>{Rt.timestamp[e]=t}))}if(Mr.length){const t=IJ(e),n=ao(e,_r(e).filter(Tr),t,t,[],!1);Mr.forEach((e=>{n&&NAF.connection.sendDataGuaranteed(APP.getString(e),"nn",n)})),Mr.length=0}{const t=BJ(e).filter(kr),n=t.filter((t=>!Cr.has(t)&&(!e.deletedNids.has(Rt.id[t])||Tr(t)))),i=ao(e,NJ(e).filter(Tr),IJ(e),FJ(e),n,!0);i&&NAF.connection.broadcastDataGuaranteed("nn",i),n.forEach((t=>{e.deletedNids.add(Rt.id[t])})),t.forEach((t=>{wr.delete(t),e.nid2eid.delete(Rt.id[t])})),Cr.clear()}}}(r),D4&&function(e,t){o5(e).forEach((n=>{(0,Ot.addComponent)(e,gi,n),gi.ref[n]=Lh(e,kh("entity",{text:{value:"{}",color:"#FFFFFF",fontSize:.05,outlineColor:"#000000",outlineWidth:"5%",textAlign:"left",anchorX:"center",anchorY:"middle"},networkDebug:!0}));const i=e.eid2obj.get(gi.ref[n]);t.add(i),i.renderOrder=999,mo(i,(function(e){e.depthTest=!1}))})),s5(e).forEach((t=>{(0,Ot.removeEntity)(e,gi.ref[t])})),r5(e).forEach((t=>{const n=e.eid2obj.get(t),i=e.eid2obj.get(gi.ref[t]);n.updateMatrices(),n.matrixWorld.decompose(i.position,i.quaternion,a5),i.matrixNeedsUpdate=!0,i.text=qB(n)+"\nNetworked "+YB(t,Rt)}))}(r,n),n.updateMatrixWorld(),t.info.reset(),APP.fx.composer?APP.fx.composer.render():t.render(n,i)}(t,i,a,r)})),e.renderStarted=!0}))})),{renderer:i,camera:r,audioListener:o}}},Lh(APP.world,r6()),Lh(APP.world,r6()),Jd(w8(function(){const e=Mh(),t=Mh(),n=Mh();return kh("entity",{name:"PDF Menu",pdfMenu:{prevButtonRef:e,nextButtonRef:t,pageLabelRef:n}},kh(T6,{name:"Previous Page Button",text:"<",ref:e,position:D6}),kh(T6,{name:"Next Page Button",text:">",ref:t,position:j6}),kh(Yh,{ref:n,position:L6,text:{color:I6}}))}(),!1)),Jd(w8(S6(),!1)),Jd(w8(S6(),!1)),Jd(w8(function(){const e=Mh();return kh("entity",{name:"Link Hover Menu",linkHoverMenu:{linkButtonRef:e}},kh(C6,{ref:e,position:P6,linkHoverMenuItem:!0}))}(),!1)),Jd(function(){return V6.apply(this,arguments)}().then((()=>w8(function(){if(!B6)throw new Error("Must load the model before creating waypoint preview entity.");return kh("entity",{name:"Waypoint Preview",waypointPreview:!0,model:{model:B6}})}(),!1))));const _8=window.APP.store;_8.update({preferences:{shouldPromptForRefresh:!1}});const E8=window.APP.mediaSearchStore,A8="ret-oauth-flow-perms-token",S8=new URLSearchParams(location.search),x8=AFRAME.utils.device.isMobile(),M8=AFRAME.utils.device.isMobileVR(),P8=window.self!==window.top;if(P8&&!S8.get("embed_token"))throw new Error("no embed token");const C8="phx-reliable";NAF.options.firstSyncSource=C8,NAF.options.syncSource=C8;let k8=!1;try{window.opener&&window.opener.doingTwitterOAuth&&(window.opener.postMessage("oauth-successful"),k8=!0,window.close())}catch(e){console.error("Exception in oauth processing code",e)}const O8=(0,z.Z)("bot"),T8=(0,z.Z)("disable_telemetry"),R8=(0,z.Z)("debug");O8||T8||function(e,t){const n=k.SENTRY_DSN,i=k.GA_TRACKING_ID;n&&(console.log("Tracking: Sentry DSN: "+n),o8().config(n).install()),s8&&i&&(console.log("Tracking: Google Analytics ID: "+i),s8("create",i,"auto"),e&&s8("set","page",e),t&&s8("set","title",t),s8("send","pageview"))}("/hub","Room Landing Page"),function(){if(!rU)return;let e=0;document.addEventListener("touchmove",(e=>{1!==e.scale&&e.preventDefault()})),document.addEventListener("touchend",(t=>{const n=(new Date).getTime(),i=n-e<=300;e=n,i&&t.preventDefault()}))}(),k8||function(e){void 0===e&&(e="global");const t=`___concurrent_load_detector_${e}`;localStorage.setItem(t,JSON.stringify({started_at:new Date}));const n=e=>{e.key===t&&(window.dispatchEvent(new CustomEvent("concurrentload")),window.removeEventListener("storage",n))};window.addEventListener("storage",n)}(),(0,z.Z)("ecsDebug")&&(window.$B=Ot,window.$C=i,window.$BitUtils=r);let D8={},j8=document.location.pathname.split("/").slice(0,2).join("/");document.location.pathname.includes("hub.html")&&(j8="/");const L8="/"===j8?(0,Xy.PP)():(0,Xy.lX)({basename:j8});window.APP.history=L8;const I8=S8.get("vr_entry_type");function N8(e){D8=b8(b8({},D8),e),function(e){void 0===e&&(e={});const t=document.querySelector("a-scene"),n=(0,z.Z)("allow_idle")||!1,i=I8;Gy.render(Yy.createElement(l8,null,Yy.createElement(pO,{store:_8},Yy.createElement(Qy.F0,{history:L8},Yy.createElement(Qy.AW,{render:r=>e.showOAuthScreen?Yy.createElement(m8,{oauthInfo:e.oauthInfo}):e.roomUnavailableReason?Yy.createElement(xV,{reason:e.roomUnavailableReason}):Yy.createElement(SV,b8(b8({scene:t,isBotMode:O8,disableAutoExitOnIdle:n,forcedVREntryType:i,store:_8,mediaSearchStore:E8},e),r))})))),document.getElementById("ui-root"))}(D8)}function F8(e){return B8.apply(this,arguments)}function B8(){return(B8=g8((function*(e){var t;let n,i;if(e.scene)i=!1,n=e.scene.model_url;else if(null===e.scene)n=yt;else{const t=e.topics[0],r=t.assets.find((e=>"glb"===e.asset_type)),o=t.assets.find((e=>"gltf_bundle"===e.asset_type));n=(r||o).src||yt;const s=/\.gltf/i.test(n)||/\.glb/i.test(n);i=!(r||s)}if((0,z.Z)("debugLocalScene")&&null!==(t=n)&&void 0!==t&&t.startsWith("blob:"))n=document.querySelector("a-scene").is("entered")?n:yt;else if(i){const e=yield fetch(n),t=yield e.json(),i=new URL(wt.LoaderUtils.extractUrlBase(n),window.location.href);n=new URL(t.assets[0].src,i).href}else n=zs(n);return n}))).apply(this,arguments)}function V8(e,t){return U8.apply(this,arguments)}function U8(){return(U8=g8((function*(e,t){console.log("Updating environment for hub");const n=yield F8(e);if((0,z.Z)("newLoader"))return console.log("Using new loading path for scenes."),void function(e,t){const n=qo(APP.world,Yn);n&&(0,Ot.removeEntity)(APP.world,n);const i=Lh(e,function(e){return kh("entity",{name:"Scene",sceneRoot:!0,sceneLoader:{src:e}})}(t));document.querySelector("#environment-scene").object3D.add(e.eid2obj.get(i))}(APP.world,n);const i=()=>{N8({roomUnavailableReason:jF.sceneError}),t.exitScene()},r=document.querySelector("#environment-scene"),o=document.querySelector("a-scene"),s=o.systems["hubs-systems"].environmentSystem;console.log(`Scene URL: ${n}`);const a=performance.now();let l=null;if(0===r.childNodes.length){const e=document.createElement("a-entity");e.addEventListener("model-loaded",(()=>{e.removeEventListener("model-error",i),console.log(`Scene file initial load took ${Math.round(performance.now()-a)}ms`),document.querySelector(".a-canvas").classList.remove("a-hidden"),o.addState("visible"),s.updateEnvironment(e),cU(e)}),{once:!0}),e.addEventListener("model-error",i,{once:!0}),e.setAttribute("gltf-model-plus",{src:n,useCache:!1,inflate:!0}),r.appendChild(e)}else{l=r.childNodes[0],wt.Cache.clear();const e=o.systems["hubs-systems"].waypointSystem;e.releaseAnyOccupiedWaypoints(),l.addEventListener("model-loaded",(()=>{l.addEventListener("model-loaded",(()=>{l.removeEventListener("model-error",i),s.updateEnvironment(l),console.log(`Scene file update load took ${Math.round(performance.now()-a)}ms`),cU(l),o.is("entered")&&e.moveToSpawnPoint();const t=document.getElementById("viewing-camera").components.fader;setTimeout((()=>t.fadeIn()),2e3)}),{once:!0}),l.removeAttribute("loop-animation"),o.emit("leaving_loading_environment"),l.components["gltf-model-plus"].data.src===n&&(console.warn("Updating environment to the same url."),l.setAttribute("gltf-model-plus",{src:""})),l.setAttribute("gltf-model-plus",{src:n})}),{once:!0}),o.is("entered")||l.addEventListener("model-error",i,{once:!0}),l.components["gltf-model-plus"].data.src===yt&&(console.warn("Transitioning to loading environment but was already in loading environment."),l.setAttribute("gltf-model-plus",{src:""})),l.setAttribute("gltf-model-plus",{src:yt})}}))).apply(this,arguments)}function H8(e,t){return z8.apply(this,arguments)}function z8(){return(z8=g8((function*(e,t){N8({hub:e,entryDisallowed:!t.canEnterRoom(e)})}))).apply(this,arguments)}const W8=function(){let e=[],t=0;return{on:(n,i)=>{const r=t++;return e.push({event:n,ref:r,callback:i}),r},off:(t,n)=>{e=e.filter((e=>!(e.event===t&&(void 0===n||n===e.ref))))},trigger:(t,n)=>{e.filter((e=>e.event===t)).forEach((e=>{e.callback(n)}))},getBindings:()=>e}}();function q8(){return q8=g8((function*(e,t){console.log("Running in bot mode...");const n=()=>{};for(e.renderer={setAnimationLoop:n,render:n,shadowMap:{},vr:{isPresenting:()=>!1},setSize:n};!NAF.connection.isConnected();)yield Ji();t.enterSceneWhenLoaded(!1,!1)})),q8.apply(this,arguments)}document.addEventListener("DOMContentLoaded",g8((function*(){if(k8)return;if(yield _8.initProfile(),document.querySelector(".a-canvas").classList.add("a-hidden"),(0,X4.M)())return;const e=(0,Ct.detectOS)(navigator.userAgent),t=(0,Ct.detect)();if(["iOS","Mac OS"].includes(e)&&["safari","ios"].includes(t.name))try{yield navigator.mediaDevices.getUserMedia({audio:!0})}catch(e){return void N8({showSafariMicDialog:!0})}const n=O();console.log(`Hub ID: ${n}`),!k.feature("default_room_id")&&k.feature("require_account_for_join")&&(!_8.state.credentials||!_8.state.credentials.token)&&(document.location=`/?sign_in&sign_in_destination=hub&sign_in_destination_url=${encodeURIComponent(document.location.toString())}`);const i=new $U(n);APP.subscriptions=i,i.register();const r=document.querySelector("a-scene"),o=()=>{const e=r.systems["hubs-systems"].physicsSystem;e.setDebug(R8||e.debug)};r.hasLoaded?o():r.addEventListener("loaded",o,{once:!0}),(yield Dg(_8.state.profile.avatarId))||(yield _8.resetToRandomDefaultAvatar());const s=new OV(_8),a=new BV(_8,n);window.APP.hubChannel=a;const l=new YU(a,s,L8);window.APP.entryManager=l,APP.dialog.on(gr,(()=>{r.emit("didConnectToDialog")})),APP.dialog.on(vr,(()=>{N8({roomUnavailableReason:jF.connectError}),APP.entryManager.exitScene()}));const c=r.systems["hubs-systems"].audioSystem;APP.mediaDevicesManager=new Gx(r,_8,c);const d=function(){var e=g8((function*(e,t,n,i){if(e())return t();var r;yield Cb(!0,(()=>N8({showSignInDialog:!1}))),N8({showSignInDialog:!0,signInMessage:n,onContinueAfterSignIn:(r=g8((function*(){N8({showSignInDialog:!1,onContinueAfterSignIn:null});let n=null;if(e())try{yield t()}catch(e){n=e}else n=new Error("Predicate failed post sign-in");n&&i&&i(n),Ob()})),function(){return r.apply(this,arguments)})})}));return function(t,n,i,r){return e.apply(this,arguments)}}();window.APP.pinningHelper=new Q4(a,s,_8,d),window.addEventListener("action_create_avatar",(()=>{d((()=>a.signedIn),(()=>ew(L8,"overlay","avatar-editor")),ZS.createAvatar)})),r.addEventListener("scene_media_selected",(e=>{const t=e.detail;d((()=>a.can("update_hub")),(()=>a.updateScene(t)),ZS.changeScene)})),r.addEventListener("hub_updated",g8((function*(){if(D()){const e=document.querySelector("#avatar-rig"),t=yield Le();e.setAttribute("player-info",{avatarSrc:yield Dg(t)})}else r.is("entered")&&l._setPlayerInfoFromProfile(!0)}))),N8({performConditionalSignIn:d,embed:P8,showPreload:P8}),l.performConditionalSignIn=d,l.init();const u=new iU(_8);window.dispatchEvent(new CustomEvent("hub_channel_ready"));const h=()=>!(!r.is("vr-mode")||r.is("vr-entered")||M8||(console.log("Pre-emptively exiting VR mode."),r.exitVR(),0));N8({availableVREntryTypes:yw,checkingForDeviceAvailability:!0});const p=vw();if(r.addEventListener("enter-vr",(()=>{if(h())return!0;M8&&N8({hide:!0}),document.body.classList.add("vr-mode"),p.then((e=>{(x8||M8)&&e.cardboard===fw.yes||document.body.classList.add("vr-mode-stretch")}))})),h(),window.addEventListener("vrdisplaypresentchange",(()=>{if(r.is("vr-entered"))return;if(r.is("vr-mode"))return;const e=AFRAME.utils.device.getVRDisplay();e&&e.isPresenting&&(r.is("vr-mode")||(console.warn("Hit A-Frame bug where VR display is presenting but A-Frame has not entered VR mode."),r.enterVR()))}),{once:!0}),r.addEventListener("exit-vr",(()=>{document.body.classList.remove("vr-mode"),document.body.classList.remove("vr-mode-stretch"),N8({hide:!1}),/OculusBrowser/i.test(window.navigator.userAgent)&&document.querySelectorAll("[media-video]").forEach((e=>{const t=e.components["media-video"];t&&(t._ignorePauseStateChanges=!0,setTimeout((()=>{const e=t.video;e&&e.paused&&!t.data.videoPaused&&e.play(),t._ignorePauseStateChanges=!1}),1e3))}))})),function(){const e=e=>()=>{let t=null;return n=>null===t?(t=new i8.Vector3(n.x,n.y,n.z),!0):!NAF.utils.almostEqualVec3(t,n,e)&&(t.copy(n),!0)};NAF.schemas.add({template:"#remote-avatar",components:[{component:"position",requiresNetworkUpdate:e(.001)},{component:"rotation",requiresNetworkUpdate:e(.5)},{component:"scale",requiresNetworkUpdate:e(.001)},"player-info","networked-avatar",{selector:".camera",component:"position",requiresNetworkUpdate:e(.001)},{selector:".camera",component:"rotation",requiresNetworkUpdate:e(.5)},{selector:".left-controller",component:"position",requiresNetworkUpdate:e(.001)},{selector:".left-controller",component:"rotation",requiresNetworkUpdate:e(.5)},{selector:".left-controller",component:"visible"},{selector:".right-controller",component:"position",requiresNetworkUpdate:e(.001)},{selector:".right-controller",component:"rotation",requiresNetworkUpdate:e(.5)},{selector:".right-controller",component:"visible"}]}),NAF.schemas.add({template:"#interactable-media",components:[{component:"position",requiresNetworkUpdate:e(.001)},{component:"rotation",requiresNetworkUpdate:e(.5)},{component:"scale",requiresNetworkUpdate:e(.001)},"media-loader",{component:"media-video",property:"time"},{component:"media-video",property:"videoPaused"},{component:"media-pdf",property:"index"},"pinnable"],nonAuthorizedComponents:[{component:"media-video",property:"time"},{component:"media-video",property:"videoPaused"},{component:"media-pager",property:"index"}]}),NAF.schemas.add({template:"#interactable-emoji",components:[{component:"position",requiresNetworkUpdate:e(.001)},{component:"rotation",requiresNetworkUpdate:e(.5)},{component:"emoji",property:"emitEndTime"},{component:"emoji",property:"particleEmitterConfig"},{component:"scale",requiresNetworkUpdate:e(.001)},"media-loader","pinnable",{selector:".particle-emitter",component:"particle-emitter"}]}),NAF.schemas.add({template:"#static-media",components:["media-loader",{component:"media-video",property:"time"}],nonAuthorizedComponents:[{component:"media-video",property:"time"}]}),NAF.schemas.add({template:"#static-controlled-media",components:["media-loader",{component:"media-video",property:"time"},{component:"media-video",property:"videoPaused"},{component:"media-pdf",property:"index"}],nonAuthorizedComponents:[{component:"media-video",property:"time"},{component:"media-video",property:"videoPaused"},{component:"media-pager",property:"index"}]}),NAF.schemas.add({template:"#interactable-drawing",components:[{component:"position",requiresNetworkUpdate:e(.001)},{component:"rotation",requiresNetworkUpdate:e(.5)},{component:"scale",requiresNetworkUpdate:e(.001)},"networked-drawing"]}),NAF.schemas.add({template:"#template-waypoint-avatar",components:[{component:"position",requiresNetworkUpdate:e(.001)},{component:"rotation",requiresNetworkUpdate:e(.5)},{component:"scale",requiresNetworkUpdate:e(.001)},"waypoint"],nonAuthorizedComponents:[{component:"position",requiresNetworkUpdate:e(.001)},{component:"rotation",requiresNetworkUpdate:e(.5)},{component:"scale",requiresNetworkUpdate:e(.001)},"waypoint"]}),NAF.schemas.add({template:"#interactable-pen",components:[{component:"position",requiresNetworkUpdate:e(.001)},{component:"rotation",requiresNetworkUpdate:e(.5)},{component:"scale",requiresNetworkUpdate:e(.001)},{selector:"#pen",component:"pen",property:"radius"},{selector:"#pen",component:"pen",property:"color"},{selector:"#pen",component:"pen",property:"drawMode"},{selector:"#pen",component:"pen",property:"penVisible"},{selector:"#pen",component:"pen-laser",property:"laserVisible"},{selector:"#pen",component:"pen-laser",property:"remoteLaserOrigin",requiresNetworkUpdate:e(.001)},{selector:"#pen",component:"pen-laser",property:"laserTarget",requiresNetworkUpdate:e(.001)}]})}(),N8({authChannel:s,hubChannel:a,linkChannel:u,subscriptions:i,enterScene:l.enterScene,exitScene:e=>{l.exitScene(),N8({roomUnavailableReason:e||jF.exited})}}),r.addEventListener("leave_room_requested",(()=>{l.exitScene(),N8({roomUnavailableReason:jF.left})})),r.addEventListener("hub_closed",(()=>{r.exitVR(),l.exitScene(),N8({roomUnavailableReason:jF.closed})})),r.addEventListener("action_camera_recording_started",(()=>a.beginRecording())),r.addEventListener("action_camera_recording_ended",(()=>a.endRecording())),S8.get("required_version")&&{NODE_ENV:"production",SHORTLINK_DOMAIN:"hub.link",RETICULUM_SERVER:"dev.reticulum.io",THUMBNAIL_SERVER:"nearspark-dev.reticulum.io",CORS_PROXY_SERVER:"hubs-proxy.com",NON_CORS_PROXY_DOMAINS:"hubs.local,dev.reticulum.io,hubs-upload-cdn.com",BASE_ASSETS_PATH:"/"}.BUILD_VERSION){const e={NODE_ENV:"production",SHORTLINK_DOMAIN:"hub.link",RETICULUM_SERVER:"dev.reticulum.io",THUMBNAIL_SERVER:"nearspark-dev.reticulum.io",CORS_PROXY_SERVER:"hubs-proxy.com",NON_CORS_PROXY_DOMAINS:"hubs.local,dev.reticulum.io,hubs-upload-cdn.com",BASE_ASSETS_PATH:"/"}.BUILD_VERSION.split(" ",1)[0];if(S8.get("required_version")!==e)return N8({roomUnavailableReason:jF.versionMismatch}),setTimeout((()=>document.location.reload()),5e3),void l.exitScene()}ve().then((e=>{if(console.log(`Reticulum @ ${e.phx_host}: v${e.version} on ${e.pool}`),S8.get("required_ret_version")&&(S8.get("required_ret_version")!==e.version||S8.get("required_ret_pool")!==e.pool))return N8({roomUnavailableReason:jF.versionMismatch}),setTimeout((()=>document.location.reload()),5e3),void l.exitScene()})),p.then(function(){var e=g8((function*(e){if(M8){if(N8({availableVREntryTypes:e,forcedVREntryType:I8||"vr",checkingForDeviceAvailability:!1}),/Oculus/.test(navigator.userAgent)&&"getVRDisplays"in navigator){const e=yield navigator.getVRDisplays(),t=e.length&&e[0];AFRAME.utils.device.getVRDisplay=()=>t}}else{const t=e.cardboard!==fw.no||e.generic!==fw.no||e.daydream!==fw.no;N8({availableVREntryTypes:e,forcedVREntryType:I8||(t?null:"2d"),checkingForDeviceAvailability:!1})}}));return function(t){return e.apply(this,arguments)}}());const m=document.querySelector("#environment-scene");m.addEventListener("model-loaded",(()=>{O8&&function(e,t){q8.apply(this,arguments)}(r,l)}),{once:!0}),m.addEventListener("model-loaded",(e=>{let{detail:{model:t}}=e;console.log("Environment scene has loaded"),r.is("entered")||function(){console.log("Setting up lobby camera");const e=document.getElementById("scene-preview-node"),t=document.getElementById("environment-scene").object3D.getObjectByName("scene-preview-camera");if(t)e.object3D.position.copy(t.position),e.object3D.rotation.copy(t.rotation),e.object3D.rotation.reorder("YXZ");else{const t=e.object3D.position;e.object3D.position.set(t.x,2.5,t.z)}e.object3D.matrixNeedsUpdate=!0,e.removeAttribute("scene-preview-camera"),e.setAttribute("scene-preview-camera","positionOnly: true; duration: 60")}(),N8({environmentSceneLoaded:!0}),r.emit("environment-scene-loaded",t);for(const e of m.children)er(e)}));let f=!1;window.addEventListener("beforeunload",(()=>f=!0));const g=yield Ee(R8);g.onClose((e=>{1e3!==e.code||f||(l.exitScene(),N8({roomUnavailableReason:jF.disconnected}))})),APP.retChannel=g.channel("ret",{hub_id:n}),APP.retChannel.join().receive("ok",(e=>{i.setVapidPublicKey(e.vapid_public_key)})).receive("error",(e=>{i.setVapidPublicKey(null),console.error(e)}));const v=yield i.getCurrentEndpoint();APP.hubChannelParamsForPermsToken=e=>function(e){let{permsToken:t,profile:n,pushSubscriptionEndpoint:i,isMobile:r,isMobileVR:o,isEmbed:s,hubInviteId:a,authToken:l}=e;return{profile:n,push_subscription_endpoint:i,auth_token:l||null,perms_token:t||null,context:{mobile:r||o,embed:s,hmd:o},hub_invite_id:a}}({profile:_8.state.profile,pushSubscriptionEndpoint:v,permsToken:e,isMobile:x8,isMobileVR:M8,isEmbed:P8,hubInviteId:S8.get("hub_invite_id"),authToken:_8.state.credentials&&_8.state.credentials.token});const b=function(){var e=g8((function*(e,t){let{ret_version:n,ret_pool:i}=e;if(console.log(`[reconnect] Reticulum deploy detected v${n} on ${i}.`),!(yield Oe({ret_version:n,ret_pool:i},t)))return void console.error(`[reconnect] Failed to reconnect. Did not get meta for v${n} on ${i}.`);console.log("[reconnect] Reconnect in progress. Updated reticulum meta.");const r=APP.retChannel.socket,o=yield Ee(R8,r.params());APP.retChannel=yield Ce(APP.retChannel,o),yield a.migrateToSocket(o,APP.hubChannelParamsForPermsToken()),s.setSocket(o),u.setSocket(o),yield I(1e4),r.teardown(),console.log("[reconnect] Reconnection successful.")}));return function(t,n){return e.apply(this,arguments)}}(),y=function(){let e=null;const t=function(){return!!e},n=function(){let n=!1;return function(){var i=g8((function*(){if(n||!e)return;n=!0;const i=Object.assign({},e);e=null;try{yield b(i,t)}catch{console.error("Failed to migrate to new reticulum server after deploy.",i)}finally{n=!1,r()}}));function r(){return i.apply(this,arguments)}return r}()}();return function(t){e=t,n()}}();APP.retChannel.on("notice",(e=>{"ret-deploy"===e.event&&y(e)}));const w=new TU(r,l,a,N8,E8);APP.messageDispatch=w,document.getElementById("avatar-rig").messageDispatch=w;const _=V().get(A8);_&&V().remove(A8);const E=g.channel(`hub:${n}`,APP.hubChannelParamsForPermsToken(_));a.channel=E,a.presence=new J.zA(E);const{rawOnJoin:A,rawOnLeave:S}=function(e){let{onJoin:t,onLeave:n,onChange:i}=e;return{rawOnJoin:(e,n,i)=>{void 0===n&&t(e,i.metas[0])},rawOnLeave:(e,t,r)=>{0===t.metas.length?n(e,r.metas[0]):i(e,r.metas[r.metas.length-1],t.metas[t.metas.length-1])}}}(function(e){return{onJoin:(t,n)=>{e.trigger("hub:join",{key:t,meta:n})},onLeave:(t,n)=>{e.trigger("hub:leave",{key:t,meta:n})},onChange:(t,n,i)=>{e.trigger("hub:change",{key:t,previous:n,current:i})}}}(W8));a.presence.onJoin(A),a.presence.onLeave(S),a.presence.onSync((()=>{W8.trigger("hub:sync",{presence:a.presence})})),W8.on("hub:join",(e=>{let{key:t,meta:n}=e;r.emit("presence_updated",{sessionId:t,profile:n.profile,roles:n.roles,permissions:n.permissions,streaming:n.streaming,recording:n.recording,hand_raised:n.hand_raised,typing:n.typing})})),W8.on("hub:join",(e=>{let{key:t,meta:n}=e;APP.hideHubPresenceEvents||t===a.channel.socket.params().session_id||a.presence.list().length>30||w.receive({type:"join",presence:n.presence,name:n.profile.displayName})})),W8.on("hub:leave",(e=>{let{meta:t}=e;APP.hideHubPresenceEvents||a.presence.list().length>30||w.receive({type:"leave",name:t.profile.displayName})})),W8.on("hub:change",(e=>{let{key:t,previous:n,current:i}=e;n.presence!==i.presence&&"room"===i.presence&&t!==a.channel.socket.params().session_id&&w.receive({type:"entered",presence:i.presence,name:i.profile.displayName})})),W8.on("hub:change",(e=>{let{previous:t,current:n}=e;t.profile.displayName!==n.profile.displayName&&w.receive({type:"display_name_changed",oldName:t.profile.displayName,newName:n.profile.displayName})})),W8.on("hub:change",(e=>{let{key:t,previous:n,current:i}=e;t===a.channel.socket.params().session_id&&n.profile.avatarId!==i.profile.avatarId&&w.log(jC)})),W8.on("hub:change",(e=>{let{key:t,current:n}=e;r.emit("presence_updated",{sessionId:t,profile:n.profile,roles:n.roles,permissions:n.permissions,streaming:n.streaming,recording:n.recording,hand_raised:n.hand_raised,typing:n.typing})}));const x={promise:null,resolve:null};var M,P;W8.on("hub:sync",(()=>{x.resolve()})),W8.on("hub:sync",(()=>{APP.hideHubPresenceEvents=!1})),W8.on("hub:sync",T),W8.on("hub:sync",(e=>{let{presence:t}=e;!function(e,t){Object.getOwnPropertyNames(e.state).length>1?t.addState("copresent"):t.removeState("copresent")}(t,r)})),W8.on("hub:sync",(e=>{let{presence:t}=e;N8({sessionId:g.params().session_id,presences:t.state,entryDisallowed:!a.canEnterRoom(D8.hub)})})),M=E,(P=W8).on("hub:join",Xo),P.on("hub:leave",Ko),M.on("naf",$o),M.on("nafr",Jo),M.on("entity_state_saved",ts),M.on("entity_state_updated",ns),M.on("entity_state_deleted",is),E.join().receive("ok",function(){var e=g8((function*(e){var t;t=APP.getSid(e.session_id),Er.add(t),yr=t,APP.hideHubPresenceEvents=!0,x.promise=new Promise((e=>{x.resolve=e})),g.params().session_id=e.session_id,g.params().session_token=e.session_token;const n=_||e.perms_token;a.setPermissionsFromToken(n),i.setHubChannel(a),i.setSubscribed(e.subscriptions.web_push),N8({hubIsBound:e.hub_requires_oauth,initialIsFavorited:e.subscriptions.favorites}),yield x.promise,function(e,t,n,i){const r=document.querySelector("a-scene");if(NAF.connection.isConnected())return r.is("entered")&&t.sendEnteredEvent(),void NAF.connection.entities.completeSync(null,!0);P8&&t.allowNAFTraffic(!1);const o=i.hubs[0];console.log(`Dialog host: ${o.host}:${o.port}`),N8({messageDispatch:n,onSendMessage:n.dispatch,onLoaded:()=>_8.executeOnLoadActions(r),onMediaSearchResultEntrySelected:(e,t)=>r.emit("action_selected_media_result_entry",{entry:e,selectAction:t}),onMediaSearchCancelled:e=>r.emit("action_media_search_cancelled",e),onAvatarSaved:e=>r.emit("action_avatar_saved",e)}),r.addEventListener("action_selected_media_result_entry",(e=>{const{entry:n,selectAction:i}=e.detail;"scene_listing"!==n.type&&"scene"!==n.type||"use"!==i||t.can("update_hub")&&t.updateScene(n.url)})),r.addEventListener("2d-interstitial-gesture-required",(()=>{N8({showInterstitialPrompt:!0,onInterstitialPromptClicked:()=>{N8({showInterstitialPrompt:!1,onInterstitialPromptClicked:null}),r.emit("2d-interstitial-gesture-complete")}})})),r.addEventListener("didConnectToNetworkedScene",(()=>{if((0,z.Z)("newLoader"))us(APP.hubChannel),co(o.hub_id);else{const e=document.querySelector("#objects-scene"),t=ge(`/${o.hub_id}/objects.gltf`),n=document.createElement("a-entity");n.setAttribute("gltf-model-plus",{src:t,useCache:!1,inflate:!0}),O8||e.appendChild(n)}}),{once:!0}),r.setAttribute("networked-scene",{room:o.hub_id,serverURL:`wss://${o.host}:${o.port}`,debug:!!R8,adapter:"phoenix"}),g8((function*(){for(;!r.components["networked-scene"]||!r.components["networked-scene"].data;)yield Ji();const n=()=>{console.log("Loading environment and connecting to dialog servers"),V8(o,e),APP.dialog.disconnect(),APP.dialog.connect({serverUrl:`wss://${o.host}:${o.port}`,roomId:o.hub_id,serverParams:{host:o.host,port:o.port,turn:o.turn},scene:r,clientId:i.session_id,forceTcp:S8.get("force_tcp"),forceTurn:S8.get("force_turn"),iceTransportPolicy:S8.get("force_tcp")||S8.get("force_turn")?"relay":"all"}),r.addEventListener("adapter-ready",(e=>{let{detail:n}=e;n.hubChannel=t,n.events=W8,n.session_id=i.session_id}),{once:!0}),r.components["networked-scene"].connect().then((()=>{r.emit("didConnectToNetworkedScene")})).catch((t=>{!function(e,t){console.error("An error occurred while attempting to connect to networked scene:",t),N8({roomUnavailableReason:t.msg&&t.msg.match(/\bfull\b/i)?jF.full:jF.connectError}),e.exitScene()}(e,t)}))};window.APP.hub=o,H8(o,t),r.emit("hub_updated",{hub:o}),P8?(console.log("Page is embedded so environment initialization will be deferred"),N8({onPreloadLoadClicked:()=>{console.log("Preload has been activated"),t.allowNAFTraffic(!0),N8({showPreload:!1}),n()}})):(console.log("Page is not embedded so environment initialization will start immediately"),n())}))()}(l,a,w,e)}));return function(t){return e.apply(this,arguments)}}()).receive("error",(e=>{"closed"===e.reason?(l.exitScene(),N8({roomUnavailableReason:jF.closed})):"oauth_required"===e.reason?(l.exitScene(),N8({oauthInfo:e.oauth_info,showOAuthScreen:!0})):"join_denied"===e.reason&&(l.exitScene(),N8({roomUnavailableReason:jF.denied})),console.error(e)})),E.on("message",(e=>{let{session_id:t,type:n,body:i,from:o}=e;const s={name:(()=>{const e=a.presence.state[t];return o||(e?e.metas[0].profile.displayName:"Mystery user")})(),type:n,body:i,maySpawn:r.is("entered"),sessionId:t,sent:t===g.params().session_id};r.is("vr-mode")&&function(e){JC.apply(this,arguments)}(s),w.receive(s)})),E.on("hub_refresh",(e=>{let{session_id:t,hubs:n,stale_fields:i}=e;const o=n[0],s=a.presence.state[t],c=s&&s.metas[0].profile.displayName||"API";if(window.APP.hub=o,H8(o,a),(i.includes("scene")||i.includes("scene_listing")||i.includes("default_environment_gltf_bundle_url"))&&(document.getElementById("viewing-camera").components.fader.fadeOut().then((()=>{r.emit("reset_scene"),V8(o,l)})),w.receive({type:"scene_changed",name:c,sceneName:o.scene?o.scene.name:"a custom URL"})),i.includes("member_permissions")&&a.fetchPermissions(),i.includes("name")){const e=document.title.split(" | ");e[0]=o.name,document.title=e.join(" | ");const t=L8.location.pathname.split("/")[1],{search:n,state:i}=L8.location,r=L8.location.pathname.replace(`/${t}`,`/${o.slug}`);L8.replace({pathname:r,search:n,state:i}),w.receive({type:"hub_name_changed",name:c,hubName:o.name})}"deny"===o.entry_mode&&r.emit("hub_closed"),r.emit("hub_updated",{hub:o})})),E.on("host_changed",(e=>{let{host:t,port:n,turn:i}=e;console.log("Dialog host changed. Disconnecting from current host and connecting to the new one.",{hub_id:APP.hub.hub_id,host:t,port:n,turn:i}),APP.dialog.disconnect(),APP.dialog.connect({serverUrl:`wss://${t}:${n}`,roomId:APP.hub.hub_id,serverParams:{host:t,port:n,turn:i},scene:r,clientId:APP.getString(yr),forceTcp:S8.get("force_tcp"),forceTurn:S8.get("force_turn"),iceTransportPolicy:S8.get("force_tcp")||S8.get("force_turn")?"relay":"all"})})),E.on("permissions_updated",(()=>a.fetchPermissions())),E.on("mute",(e=>{let{session_id:t}=e;t===NAF.clientId&&(APP.mediaDevicesManager.micEnabled=!1)})),s.setSocket(g),u.setSocket(g)})))},48711:function(){AFRAME.registerComponent("vr-mode-toggle-visibility",{schema:{invert:{type:"boolean",default:!1}},init(){this.updateComponentState=this.updateComponentState.bind(this)},play(){this.updateComponentState(),this.el.sceneEl.addEventListener("enter-vr",this.updateComponentState),this.el.sceneEl.addEventListener("exit-vr",this.updateComponentState)},pause(){this.el.sceneEl.removeEventListener("enter-vr",this.updateComponentState),this.el.sceneEl.removeEventListener("exit-vr",this.updateComponentState)},updateComponentState(){const e=this.el.sceneEl.is("vr-mode");this.el.setAttribute("visible",e!==this.data.invert)}}),AFRAME.registerComponent("vr-mode-toggle-playing",{multiple:!0,schema:{invert:{type:"boolean",default:!1}},init(){this.updateComponentState=this.updateComponentState.bind(this)},play(){this.updateComponentState(),this.el.sceneEl.addEventListener("enter-vr",this.updateComponentState),this.el.sceneEl.addEventListener("exit-vr",this.updateComponentState)},pause(){this.el.sceneEl.removeEventListener("enter-vr",this.updateComponentState),this.el.sceneEl.removeEventListener("exit-vr",this.updateComponentState)},updateComponentState(){const e=this.id,t=this.el.sceneEl.is("vr-mode");this.el.components[e][t!==this.data.invert?"play":"pause"]()}}),AFRAME.registerComponent("vr-mode-toggle-class",{multiple:!0,schema:{invert:{type:"boolean",default:!1},class:{type:"string",default:""}},init(){this.updateComponentState=this.updateComponentState.bind(this)},play(){this.updateComponentState(),this.el.sceneEl.addEventListener("enter-vr",this.updateComponentState),this.el.sceneEl.addEventListener("exit-vr",this.updateComponentState)},pause(){this.el.sceneEl.removeEventListener("enter-vr",this.updateComponentState),this.el.sceneEl.removeEventListener("exit-vr",this.updateComponentState)},updateComponentState(){this.el.sceneEl.is("vr-mode")?this.el.classList.add(this.data.class):this.el.classList.remove(this.data.class)}})},10713:function(){AFRAME.registerSystem("auto-pixel-ratio",{init(){this.enabled=window.devicePixelRatio>1&&/macintosh/i.test(navigator.userAgent),this.deltas=[],this.secondsSinceMeasurementStart=0,this.secondsSinceSceneVisible=0,this.maxPixelRatio=window.devicePixelRatio,this.pixelRatioToTimesDecreased={},this.disabledByPref=window.APP.store.state.preferences.disableAutoPixelRatio,this.onPreferenceChange=this.onPreferenceChange.bind(this),window.APP.store.addEventListener("statechanged",this.onPreferenceChange)},onPreferenceChange(){this.disabledByPref=window.APP.store.state.preferences.disableAutoPixelRatio},tick(e,t){if(this.enabled&&!this.disabledByPref&&1!==this.maxPixelRatio&&this.el.is("visible"))if(this.secondsSinceSceneVisible<30)this.secondsSinceSceneVisible+=t/1e3;else if("hidden"!==document.visibilityState&&(this.deltas.push(t),this.secondsSinceMeasurementStart+=t/1e3,this.secondsSinceMeasurementStart>5)){this.deltas.sort();const e=1e3/this.deltas[Math.floor(this.deltas.length/2)],t=this.el.renderer.getPixelRatio(),n=t>1&&e<30,i=t<this.maxPixelRatio&&e>48;if(n||i){const r=t+(1*i?1:-1);if(console.info(`Hubs auto-pixel-ratio: Median FPS (${e.toFixed()}) was ${i?"above 48":"below 30"}. Adjusting pixel ratio to ${r}.`),this.el.renderer.setPixelRatio(r),n){const e=(this.pixelRatioToTimesDecreased[t]||0)+1;this.pixelRatioToTimesDecreased[t]=e,e>=3&&(console.info(`Hubs auto-pixel-ratio: Attempts to maintain high frame rate with pixel ratio ${t} failed ${e} times and will not be attempted again. Lowering maximum pixel ratio to ${r}.`),this.maxPixelRatio=r)}}this.deltas.length=0,this.secondsSinceMeasurementStart=0}}})},8550:function(){AFRAME.registerSystem("exit-on-blur",{init(){this.onBlur=this.onBlur.bind(this),this.onFocus=this.onFocus.bind(this),this.onTimeout=this.onTimeout.bind(this),this.onEnterVR=this.onEnterVR.bind(this),this.isOculusBrowser=navigator.userAgent.match(/Oculus/),this.enteredVR=!1,window.addEventListener("blur",this.onBlur),window.addEventListener("focus",this.onFocus),this.el.addEventListener("enter-vr",this.onEnterVR),this.lastTimeoutCheck=0,this.exitTimeout=null},tick(e){this.isOculusBrowser&&this.enteredVR&&(0===this.lastTimeoutCheck||e-this.lastTimeoutCheck>=1e3)&&(this.lastTimeoutCheck=e,clearTimeout(this.exitTimeout),this.exitTimeout=setTimeout(this.onTimeout,3e4))},onEnterVR(){this.enteredVR=!0},onBlur(){this.el.isMobile&&(clearTimeout(this.exitTimeout),this.exitTimeout=setTimeout(this.onTimeout,3e4))},onFocus(){this.el.isMobile&&clearTimeout(this.exitTimeout)},onTimeout(){window.APP.store.state.preferences.disableIdleDetection||this.el.dispatchEvent(new CustomEvent("exit"))},remove(){clearTimeout(this.exitTimeout),window.removeEventListener("blur",this.onBlur)}})},34462:function(){AFRAME.registerSystem("frame-scheduler",{init(){this.registry=new Map,this.queues=[],this.frameIndex=0},schedule(e,t){this.registry.has(t)||(this.queues.push(t),this.registry.set(t,[])),this.registry.get(t).push(e)},unschedule(e){for(let t=0;t<this.queues.length;t++){const n=this.queues[t],i=this.registry.get(n),r=i.indexOf(e);r>=0&&i.splice(r,1)}},tick:function(){for(let e=0;e<this.queues.length;e++){const t=this.queues[e],n=this.registry.get(t);0!==n.length&&n[this.frameIndex%n.length]()}this.frameIndex++}})},3273:function(){AFRAME.registerSystem("listed-media",{init:function(){this.els=[]},register:function(e){this.els.push(e),this.el.emit("listed_media_changed")},unregister:function(e){this.els.splice(this.els.indexOf(e),1),this.el.emit("listed_media_changed")}}),AFRAME.registerComponent("listed-media",{init:function(){this.system.register(this.el)},remove:function(){this.system.unregister(this.el)}})},86767:function(){AFRAME.registerSystem("permissions",{onPermissionsUpdated(e){window.APP.hubChannel?window.APP.hubChannel.addEventListener("permissions_updated",e):window.addEventListener("hub_channel_ready",(()=>window.APP.hubChannel.addEventListener("permissions_updated",e)),{once:!0})},can:e=>!!window.APP.hubChannel.can(e),canOrWillIfCreator:e=>!!window.APP.hubChannel.canOrWillIfCreator(e),fetchPermissions:()=>window.APP.hubChannel.fetchPermissions()})},92874:function(__unused_webpack_module,__unused_webpack___webpack_exports__,__webpack_require__){"use strict";var _qs_truthy__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(67930);const showLog=(0,_qs_truthy__WEBPACK_IMPORTED_MODULE_0__.Z)("debug_log");if(showLog){const template=document.createElement("template");template.innerHTML='\n    <style>\n      #debug-log {\n        position: absolute;\n        top: 13em;\n        background: white;\n        opacity: 0.7;\n        z-index: 1000;\n      }\n      #debug-log, #debug-log-input {\n        font-family: monospace;\n        font-size: 11px;\n        width: 100%;\n      }\n\n      #debug-log-controls {\n        display: flex;\n        padding: 0.2em;\n      }\n\n      #debug-log-eval {\n        display: flex;\n        flex: 1;\n      }\n\n      #debug-log-log {\n        overflow: auto;\n        height: 30vh;\n      }\n      #debug-log-log.minimized {\n        height: auto;\n      }\n      #debug-log-log.minimized .entry {\n        display: none;\n      }\n      #debug-log-log.minimized .entry:last-child {\n        display: block;\n      }\n      #debug-log-log .entry {\n        border: 1px solid grey;\n        margin: 0.2em;\n        padding: 0.2em;\n      }\n      #debug-log-log .entry.error { background-color: pink; }\n      #debug-log-log .entry.warn { background-color: orange; }\n    </style>\n    <div id="debug-log">\n        <div id="debug-log-controls">\n          <form id="debug-log-eval">\n            <input id="debug-log-input" placeholder="&gt;&gt;" autocorrect="off" autocapitalize="none" />\n            <button>&gt;</button>\n          </form>\n          <button id="debug-log-minimize">_</button>\n        </div>\n        <div id="debug-log-log"></div>\n    </div>\n  ',document.addEventListener("DOMContentLoaded",(()=>{document.body.appendChild(template.content)}));const debugLog=template.content.querySelector("#debug-log-log");debugLog.addEventListener("wheel",(e=>e.stopPropagation()));const debugLogInput=template.content.querySelector("#debug-log-input"),debugLogEval=template.content.querySelector("#debug-log-eval");debugLogEval.onsubmit=e=>{e.preventDefault(),console.log(eval(`(${debugLogInput.value})`))};let minimized=!1;const debugLogMinimize=template.content.querySelector("#debug-log-minimize");debugLogMinimize.onclick=()=>{minimized=!minimized,debugLog.className=minimized?"minimized":"",debugLog.scrollTop=debugLog.scrollHeight-debugLog.clientHeight};const origConsoleInfo=console.info,origConsoleLog=console.log,origConsoleError=console.error,origConsoleWarn=console.warn,log=function(e,t){let n;debugLog.childNodes.length>1e3?n=debugLog.firstChild:(n=document.createElement("div"),n.classList.add("entry")),n.classList.remove("warn","error"),n.classList.add(e);const i=Array.from(t),r=i[0];let o;o="string"==typeof r&&r.includes("%c")?r.replace(/%c/g,""):r instanceof Error?`${r.message}\n${r.stack}`:i.map((e=>"string"==typeof e?e:JSON.stringify(e))).join(" ");const s=(new Date).toISOString().substring(11,23);n.textContent=`[${s}] ${o}`;const a=debugLog.scrollTop===debugLog.scrollHeight-debugLog.clientHeight;debugLog.append(n),a&&(debugLog.scrollTop=debugLog.scrollHeight-debugLog.clientHeight)};console.warn=function(){origConsoleWarn.apply(null,arguments),log("warn",arguments)},console.error=function(){origConsoleError.apply(null,arguments),log("error",arguments)},console.log=function(){origConsoleLog.apply(null,arguments),log("log",arguments)},console.info=function(){origConsoleInfo.apply(null,arguments),log("info",arguments)},window.onunhandledrejection=e=>log("error",[e.reason.message,e.reason.code,e.reason.name]),window.onerror=e=>log("error",[e])}},67930:function(e,t,n){"use strict";n.d(t,{Z:function(){return r},c:function(){return o}});const i=new URLSearchParams(location.search);function r(e){const t=i.get(e);return""===t||/1|on|true|yes/i.test(t)}function o(e){return i.get(e)}},15335:function(e,t,n){var i=n(99477);i.Water=function(e,t){i.Mesh.call(this,e);const n=this,r=void 0!==(t=t||{}).textureWidth?t.textureWidth:512,o=void 0!==t.textureHeight?t.textureHeight:512,s=void 0!==t.clipBias?t.clipBias:0,a=void 0!==t.alpha?t.alpha:1,l=void 0!==t.time?t.time:0,c=void 0!==t.waterNormals?t.waterNormals:null,d=void 0!==t.sunDirection?t.sunDirection:new i.Vector3(.70707,.70707,0),u=new i.Color(void 0!==t.sunColor?t.sunColor:16777215),h=new i.Color(void 0!==t.waterColor?t.waterColor:8355711),p=void 0!==t.eye?t.eye:new i.Vector3(0,0,0),m=void 0!==t.distortionScale?t.distortionScale:20,f=void 0!==t.side?t.side:i.FrontSide,g=void 0!==t.fog&&t.fog,v=new i.Plane,b=new i.Vector3,y=new i.Vector3,w=new i.Vector3,_=new i.Matrix4,E=new i.Vector3(0,0,-1),A=new i.Vector4,S=new i.Vector3,x=new i.Vector3,M=new i.Vector4,P=new i.Matrix4,C=new i.PerspectiveCamera,k={minFilter:i.LinearFilter,magFilter:i.LinearFilter,format:i.RGBAFormat,stencilBuffer:!1},O=new i.WebGLRenderTarget(r,o,k);i.MathUtils.isPowerOfTwo(r)&&i.MathUtils.isPowerOfTwo(o)||(O.texture.generateMipmaps=!1);const T={uniforms:i.UniformsUtils.merge([i.UniformsLib.fog,i.UniformsLib.lights,{normalSampler:{value:null},mirrorSampler:{value:null},alpha:{value:1},time:{value:0},size:{value:1},distortionScale:{value:20},textureMatrix:{value:new i.Matrix4},sunColor:{value:new i.Color(8355711)},sunDirection:{value:new i.Vector3(.70707,.70707,0)},eye:{value:new i.Vector3},waterColor:{value:new i.Color(5592405)}}]),vertexShader:["uniform mat4 textureMatrix;","uniform float time;","varying vec4 mirrorCoord;","varying vec4 worldPosition;",i.ShaderChunk.fog_pars_vertex,i.ShaderChunk.shadowmap_pars_vertex,"void main() {","\tmirrorCoord = modelMatrix * vec4( position, 1.0 );","\tworldPosition = mirrorCoord.xyzw;","\tmirrorCoord = textureMatrix * mirrorCoord;","\tvec4 mvPosition =  modelViewMatrix * vec4( position, 1.0 );","\tgl_Position = projectionMatrix * mvPosition;",i.ShaderChunk.fog_vertex,i.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform sampler2D mirrorSampler;","uniform float alpha;","uniform float time;","uniform float size;","uniform float distortionScale;","uniform sampler2D normalSampler;","uniform vec3 sunColor;","uniform vec3 sunDirection;","uniform vec3 eye;","uniform vec3 waterColor;","varying vec4 mirrorCoord;","varying vec4 worldPosition;","vec4 getNoise( vec2 uv ) {","\tvec2 uv0 = ( uv / 103.0 ) + vec2(time / 17.0, time / 29.0);","\tvec2 uv1 = uv / 107.0-vec2( time / -19.0, time / 31.0 );","\tvec2 uv2 = uv / vec2( 8907.0, 9803.0 ) + vec2( time / 101.0, time / 97.0 );","\tvec2 uv3 = uv / vec2( 1091.0, 1027.0 ) - vec2( time / 109.0, time / -113.0 );","\tvec4 noise = texture2D( normalSampler, uv0 ) +","\t\ttexture2D( normalSampler, uv1 ) +","\t\ttexture2D( normalSampler, uv2 ) +","\t\ttexture2D( normalSampler, uv3 );","\treturn noise * 0.5 - 1.0;","}","void sunLight( const vec3 surfaceNormal, const vec3 eyeDirection, float shiny, float spec, float diffuse, inout vec3 diffuseColor, inout vec3 specularColor ) {","\tvec3 reflection = normalize( reflect( -sunDirection, surfaceNormal ) );","\tfloat direction = max( 0.0, dot( eyeDirection, reflection ) );","\tspecularColor += pow( direction, shiny ) * sunColor * spec;","\tdiffuseColor += max( dot( sunDirection, surfaceNormal ), 0.0 ) * sunColor * diffuse;","}",i.ShaderChunk.common,i.ShaderChunk.packing,i.ShaderChunk.bsdfs,i.ShaderChunk.fog_pars_fragment,i.ShaderChunk.lights_pars_begin,i.ShaderChunk.shadowmap_pars_fragment,i.ShaderChunk.shadowmask_pars_fragment,"void main() {","\tvec4 noise = getNoise( worldPosition.xz * size );","\tvec3 surfaceNormal = normalize( noise.xzy * vec3( 1.5, 1.0, 1.5 ) );","\tvec3 diffuseLight = vec3(0.0);","\tvec3 specularLight = vec3(0.0);","\tvec3 worldToEye = eye-worldPosition.xyz;","\tvec3 eyeDirection = normalize( worldToEye );","\tsunLight( surfaceNormal, eyeDirection, 100.0, 2.0, 0.5, diffuseLight, specularLight );","\tfloat distance = length(worldToEye);","\tvec2 distortion = surfaceNormal.xz * ( 0.001 + 1.0 / distance ) * distortionScale;","\tvec3 reflectionSample = vec3( texture2D( mirrorSampler, mirrorCoord.xy / mirrorCoord.z + distortion ) );","\tfloat theta = max( dot( eyeDirection, surfaceNormal ), 0.0 );","\tfloat rf0 = 0.3;","\tfloat reflectance = rf0 + ( 1.0 - rf0 ) * pow( ( 1.0 - theta ), 5.0 );","\tvec3 scatter = max( 0.0, dot( surfaceNormal, eyeDirection ) ) * waterColor;","\tvec3 albedo = mix( ( sunColor * diffuseLight * 0.3 + scatter ) * getShadowMask(), ( vec3( 0.1 ) + reflectionSample * 0.9 + reflectionSample * specularLight ), reflectance);","\tvec3 outgoingLight = albedo;","\tgl_FragColor = vec4( outgoingLight, alpha );",i.ShaderChunk.tonemapping_fragment,i.ShaderChunk.fog_fragment,"}"].join("\n")},R=new i.ShaderMaterial({fragmentShader:T.fragmentShader,vertexShader:T.vertexShader,uniforms:i.UniformsUtils.clone(T.uniforms),transparent:!0,lights:!0,side:f,fog:g});R.uniforms.mirrorSampler.value=O.texture,R.uniforms.textureMatrix.value=P,R.uniforms.alpha.value=a,R.uniforms.time.value=l,R.uniforms.normalSampler.value=c,R.uniforms.sunColor.value=u,R.uniforms.waterColor.value=h,R.uniforms.sunDirection.value=d,R.uniforms.distortionScale.value=m,R.uniforms.eye.value=p,n.material=R,n.mirrorCamera=C,n.onBeforeRender=function(e,t,i){if(y.setFromMatrixPosition(n.matrixWorld),w.setFromMatrixPosition(i.matrixWorld),_.extractRotation(n.matrixWorld),b.set(0,0,1),b.applyMatrix4(_),S.subVectors(y,w),S.dot(b)>0)return;S.reflect(b).negate(),S.add(y),_.extractRotation(i.matrixWorld),E.set(0,0,-1),E.applyMatrix4(_),E.add(w),x.subVectors(y,E),x.reflect(b).negate(),x.add(y),C.position.copy(S),C.up.set(0,1,0),C.up.applyMatrix4(_),C.up.reflect(b),C.lookAt(x),C.far=i.far,C.matrixNeedsUpdate=!0,C.updateMatrixWorld(),C.projectionMatrix.copy(i.projectionMatrix),P.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),P.multiply(C.projectionMatrix),P.multiply(C.matrixWorldInverse),v.setFromNormalAndCoplanarPoint(b,y),v.applyMatrix4(C.matrixWorldInverse),A.set(v.normal.x,v.normal.y,v.normal.z,v.constant);const r=C.projectionMatrix;M.x=(Math.sign(A.x)+r.elements[8])/r.elements[0],M.y=(Math.sign(A.y)+r.elements[9])/r.elements[5],M.z=-1,M.w=(1+r.elements[10])/r.elements[14],A.multiplyScalar(2/A.dot(M)),r.elements[2]=A.x,r.elements[6]=A.y,r.elements[10]=A.z+1-s,r.elements[14]=A.w,p.setFromMatrixPosition(i.matrixWorld);const o=e.getRenderTarget(),a=e.xr.enabled,l=e.shadowMap.autoUpdate;n.visible=!1,e.xr.enabled=!1,e.shadowMap.autoUpdate=!1,e.setRenderTarget(O),e.render(t,C),e.setRenderTarget(null),n.visible=!0,e.xr.enabled=a,e.shadowMap.autoUpdate=l,e.setRenderTarget(o)}},i.Water.prototype=Object.create(i.Mesh.prototype),i.Water.prototype.constructor=i.Water},70410:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,{M:function(){return platformUnsupported}});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(67294),react_dom__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(73935),copy_to_clipboard__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(20640),copy_to_clipboard__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(copy_to_clipboard__WEBPACK_IMPORTED_MODULE_2__),detect_browser__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(82701),detect_browser__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(detect_browser__WEBPACK_IMPORTED_MODULE_3__),_react_components_styles_global_scss__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(55478),_assets_stylesheets_support_scss__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(85818);function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return _setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},_setPrototypeOf(e,t)}function _createSuper(e){var t=_isNativeReflectConstruct();return function(){var n,i=_getPrototypeOf(e);if(t){var r=_getPrototypeOf(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return _possibleConstructorReturn(this,n)}}function _possibleConstructorReturn(e,t){if(t&&("object"===_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(e)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf(e){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},_getPrototypeOf(e)}var SHORTHAND_INITIALIZER="var foo = 'bar'; var baz = { foo };",SPREAD_SYNTAX="var foo = {}; var baz = { ...foo };",CATCH_SYNTAX="try { foo(); } catch {}";function syntaxSupported(syntax){try{return eval(syntax),!0}catch(e){return!1}}function getPlatformSupport(){return[{name:"Web Assembly",supported:!!window.WebAssembly},{name:"Media Devices",supported:!!navigator.mediaDevices},{name:"Modern JavaScript Syntax",supported:syntaxSupported(CATCH_SYNTAX)&&syntaxSupported(SPREAD_SYNTAX)&&syntaxSupported(SHORTHAND_INITIALIZER)}]}function isInAppBrowser(){return"iOS"===(0,detect_browser__WEBPACK_IMPORTED_MODULE_3__.detectOS)(navigator.userAgent)&&!navigator.mediaDevices||/\bfb_iab\b/i.test(navigator.userAgent)}function platformUnsupported(){return getPlatformSupport().some((function(e){return!e.supported}))||isInAppBrowser()}var Support=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=t.apply(this,arguments)).state={showDetails:!1,hasCopied:!1},e.toggleDetails=function(t){t.preventDefault(),e.setState((function(e){return e.showDetails=!e.showDetails,e}))},e.onCopyClicked=function(t){t.preventDefault(),copy_to_clipboard__WEBPACK_IMPORTED_MODULE_2___default()(document.location),e.setState({hasCopied:!0})},e}return _createClass(n,[{key:"render",value:function(){var e=getPlatformSupport(),t=e.every((function(e){return e.supported})),n=isInAppBrowser();if(t&&!n)return null;var i=(0,detect_browser__WEBPACK_IMPORTED_MODULE_3__.detectOS)(navigator.userAgent);return react__WEBPACK_IMPORTED_MODULE_0__.createElement("div",{className:_assets_stylesheets_support_scss__WEBPACK_IMPORTED_MODULE_5__.Z.supportMain},react__WEBPACK_IMPORTED_MODULE_0__.createElement("div",{className:_assets_stylesheets_support_scss__WEBPACK_IMPORTED_MODULE_5__.Z.supportContent},react__WEBPACK_IMPORTED_MODULE_0__.createElement("h1",null,"Mozilla Hubs"),react__WEBPACK_IMPORTED_MODULE_0__.createElement("br",null),react__WEBPACK_IMPORTED_MODULE_0__.createElement("p",{className:_assets_stylesheets_support_scss__WEBPACK_IMPORTED_MODULE_5__.Z.unsupportedLangs},"· ",react__WEBPACK_IMPORTED_MODULE_0__.createElement("span",null,"Unsupported")," · ",react__WEBPACK_IMPORTED_MODULE_0__.createElement("span",null,"No Soportado")," · ",react__WEBPACK_IMPORTED_MODULE_0__.createElement("span",null,"Nicht Unterstützt")," · ",react__WEBPACK_IMPORTED_MODULE_0__.createElement("span",null,"Sem Suporte")," · ",react__WEBPACK_IMPORTED_MODULE_0__.createElement("span",null,"Non Compatible")," · ",react__WEBPACK_IMPORTED_MODULE_0__.createElement("span",null,"不支援")," · ",react__WEBPACK_IMPORTED_MODULE_0__.createElement("span",null,"не поддерживается")," · ",react__WEBPACK_IMPORTED_MODULE_0__.createElement("span",null,"サポートされていません")," ·"),react__WEBPACK_IMPORTED_MODULE_0__.createElement("br",null),react__WEBPACK_IMPORTED_MODULE_0__.createElement("p",null,react__WEBPACK_IMPORTED_MODULE_0__.createElement("span",null,"Your browser is missing required features."),react__WEBPACK_IMPORTED_MODULE_0__.createElement("br",null),n?"iOS"===i?react__WEBPACK_IMPORTED_MODULE_0__.createElement("span",null,"Copy and paste this link directly into Safari"):react__WEBPACK_IMPORTED_MODULE_0__.createElement("span",null,"Copy and paste this link directly into Chrome or Firefox"):react__WEBPACK_IMPORTED_MODULE_0__.createElement("span",null,"Please try switching or updating to a newer browser"),react__WEBPACK_IMPORTED_MODULE_0__.createElement("br",null),react__WEBPACK_IMPORTED_MODULE_0__.createElement("br",null),react__WEBPACK_IMPORTED_MODULE_0__.createElement("input",{type:"text",readOnly:!0,onFocus:function(e){return e.target.select()},value:document.location}),react__WEBPACK_IMPORTED_MODULE_0__.createElement("a",{className:"copy-link",href:"#",onClick:this.onCopyClicked},this.state.hasCopied?"copied!":"copy"),react__WEBPACK_IMPORTED_MODULE_0__.createElement("br",null),react__WEBPACK_IMPORTED_MODULE_0__.createElement("br",null),react__WEBPACK_IMPORTED_MODULE_0__.createElement("a",{className:_assets_stylesheets_support_scss__WEBPACK_IMPORTED_MODULE_5__.Z.detailsLink,href:"#",onClick:this.toggleDetails},react__WEBPACK_IMPORTED_MODULE_0__.createElement("span",null,"details"))),this.state.showDetails&&react__WEBPACK_IMPORTED_MODULE_0__.createElement("table",{className:_assets_stylesheets_support_scss__WEBPACK_IMPORTED_MODULE_5__.Z.details},react__WEBPACK_IMPORTED_MODULE_0__.createElement("tbody",null,e.sort((function(e,t){return e.supported&&!t.supported?1:-1})).map((function(e){return react__WEBPACK_IMPORTED_MODULE_0__.createElement("tr",{key:e.name},react__WEBPACK_IMPORTED_MODULE_0__.createElement("td",null,e.name),react__WEBPACK_IMPORTED_MODULE_0__.createElement("td",null,e.supported?"supported":"unsupported"))}))))))}}]),n}(react__WEBPACK_IMPORTED_MODULE_0__.Component);document.addEventListener("DOMContentLoaded",(function(){react_dom__WEBPACK_IMPORTED_MODULE_1__.render(react__WEBPACK_IMPORTED_MODULE_0__.createElement(Support,null),document.getElementById("support-root"))}))},85818:function(e,t){"use strict";t.Z={"support-main":"support__support-main__oWEp2",supportMain:"support__support-main__oWEp2","support-content":"support__support-content__6Fy7i",supportContent:"support__support-content__6Fy7i","unsupported-langs":"support__unsupported-langs__iVeQB",unsupportedLangs:"support__unsupported-langs__iVeQB",details:"support__details__dKlwm"}},55478:function(){},37472:function(e,t,n){var i={"./de.json":[33116,116],"./es.json":[27297,297],"./fr.json":[83056,56],"./ja.json":[23160,160],"./ko.json":[55540,540],"./pt.json":[10188,188],"./ru.json":[97441,441],"./zh-cn.json":[2030,30],"./zh-tw.json":[4076,76]};function r(e){if(!n.o(i,e))return Promise.resolve().then((function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=i[e],r=t[0];return n.e(t[1]).then((function(){return n.t(r,19)}))}r.keys=function(){return Object.keys(i)},r.id=37472,e.exports=r},93414:function(){},70172:function(){},67441:function(){},33779:function(){},66558:function(){},82258:function(){},69862:function(){},40964:function(){}},__webpack_module_cache__={},deferred,leafPrototypes,getProto,inProgress,dataWebpackPrefix;function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var n=__webpack_module_cache__[e]={id:e,loaded:!1,exports:{}};return __webpack_modules__[e].call(n.exports,n,n.exports,__webpack_require__),n.loaded=!0,n.exports}__webpack_require__.m=__webpack_modules__,__webpack_require__.amdO={},deferred=[],__webpack_require__.O=function(e,t,n,i){if(!t){var r=1/0;for(l=0;l<deferred.length;l++){t=deferred[l][0],n=deferred[l][1],i=deferred[l][2];for(var o=!0,s=0;s<t.length;s++)(!1&i||r>=i)&&Object.keys(__webpack_require__.O).every((function(e){return __webpack_require__.O[e](t[s])}))?t.splice(s--,1):(o=!1,i<r&&(r=i));if(o){deferred.splice(l--,1);var a=n();void 0!==a&&(e=a)}}return e}i=i||0;for(var l=deferred.length;l>0&&deferred[l-1][2]>i;l--)deferred[l]=deferred[l-1];deferred[l]=[t,n,i]},__webpack_require__.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return __webpack_require__.d(t,{a:t}),t},getProto=Object.getPrototypeOf?function(e){return Object.getPrototypeOf(e)}:function(e){return e.__proto__},__webpack_require__.t=function(e,t){if(1&t&&(e=this(e)),8&t)return e;if("object"==typeof e&&e){if(4&t&&e.__esModule)return e;if(16&t&&"function"==typeof e.then)return e}var n=Object.create(null);__webpack_require__.r(n);var i={};leafPrototypes=leafPrototypes||[null,getProto({}),getProto([]),getProto(getProto)];for(var r=2&t&&e;"object"==typeof r&&!~leafPrototypes.indexOf(r);r=getProto(r))Object.getOwnPropertyNames(r).forEach((function(t){i[t]=function(){return e[t]}}));return i.default=function(){return e},__webpack_require__.d(n,i),n},__webpack_require__.d=function(e,t){for(var n in t)__webpack_require__.o(t,n)&&!__webpack_require__.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},__webpack_require__.f={},__webpack_require__.e=function(e){return Promise.all(Object.keys(__webpack_require__.f).reduce((function(t,n){return __webpack_require__.f[n](e,t),t}),[]))},__webpack_require__.u=function(e){return"assets/js/"+e+"-"+{30:"6ac0d1f1f2ab12ac7acb",56:"365d70e890628cbdff90",76:"966e03a82a6aa54f47c6",116:"c51e85062c079aebe19b",160:"d76c46253b195558a884",188:"9e18e3a4f61c3aae40fb",297:"11bd1ad37903b4820d18",441:"bcfa805c563117ade7b6",540:"ff2f552046d8584b5997"}[e]+".js"},__webpack_require__.miniCssF=function(e){},__webpack_require__.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),__webpack_require__.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},inProgress={},dataWebpackPrefix="hubs:",__webpack_require__.l=function(e,t,n,i){if(inProgress[e])inProgress[e].push(t);else{var r,o;if(void 0!==n)for(var s=document.getElementsByTagName("script"),a=0;a<s.length;a++){var l=s[a];if(l.getAttribute("src")==e||l.getAttribute("data-webpack")==dataWebpackPrefix+n){r=l;break}}r||(o=!0,(r=document.createElement("script")).charset="utf-8",r.timeout=120,__webpack_require__.nc&&r.setAttribute("nonce",__webpack_require__.nc),r.setAttribute("data-webpack",dataWebpackPrefix+n),r.src=e),inProgress[e]=[t];var c=function(t,n){r.onerror=r.onload=null,clearTimeout(d);var i=inProgress[e];if(delete inProgress[e],r.parentNode&&r.parentNode.removeChild(r),i&&i.forEach((function(e){return e(n)})),t)return t(n)},d=setTimeout(c.bind(null,void 0,{type:"timeout",target:r}),12e4);r.onerror=c.bind(null,r.onerror),r.onload=c.bind(null,r.onload),o&&document.head.appendChild(r)}},__webpack_require__.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},__webpack_require__.nmd=function(e){return e.paths=[],e.children||(e.children=[]),e},__webpack_require__.j=488,__webpack_require__.p="/",function(){var e={488:0};__webpack_require__.f.j=function(t,n){var i=__webpack_require__.o(e,t)?e[t]:void 0;if(0!==i)if(i)n.push(i[2]);else{var r=new Promise((function(n,r){i=e[t]=[n,r]}));n.push(i[2]=r);var o=__webpack_require__.p+__webpack_require__.u(t),s=new Error;__webpack_require__.l(o,(function(n){if(__webpack_require__.o(e,t)&&(0!==(i=e[t])&&(e[t]=void 0),i)){var r=n&&("load"===n.type?"missing":n.type),o=n&&n.target&&n.target.src;s.message="Loading chunk "+t+" failed.\n("+r+": "+o+")",s.name="ChunkLoadError",s.type=r,s.request=o,i[1](s)}}),"chunk-"+t,t)}},__webpack_require__.O.j=function(t){return 0===e[t]};var t=function(t,n){var i,r,o=n[0],s=n[1],a=n[2],l=0;if(o.some((function(t){return 0!==e[t]}))){for(i in s)__webpack_require__.o(s,i)&&(__webpack_require__.m[i]=s[i]);if(a)var c=a(__webpack_require__)}for(t&&t(n);l<o.length;l++)r=o[l],__webpack_require__.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return __webpack_require__.O(c)},n=self.webpackChunkhubs=self.webpackChunkhubs||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))}();var __webpack_exports__=__webpack_require__.O(void 0,[495,542,119,666],(function(){return __webpack_require__(40177)}));__webpack_exports__=__webpack_require__.O(__webpack_exports__)})();
//# sourceMappingURL=hub-3d601f78d9dcdb6281f0.js.map